{"ast":null,"code":"/**\r\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { __awaiter, __generator } from \"tslib\";\nimport { ParamDefinition as PD } from '../../mol-util/param-definition';\nimport { StructureRepresentationStateBuilder } from './representation';\nimport { Structure, StructureElement, Bond } from '../../mol-model/structure';\nimport { Subject } from 'rxjs';\nimport { getNextMaterialId } from '../../mol-gl/render-object';\nimport { Theme } from '../../mol-theme/theme';\nimport { Task } from '../../mol-task';\nimport { EmptyLoci, Loci, isEveryLoci, isDataLoci, EveryLoci } from '../../mol-model/loci';\nimport { MarkerActions } from '../../mol-util/marker-action';\nimport { Overpaint } from '../../mol-theme/overpaint';\nimport { Clipping } from '../../mol-theme/clipping';\nimport { Transparency } from '../../mol-theme/transparency';\nexport function ComplexRepresentation(label, ctx, getParams, visualCtor) {\n  var version = 0;\n  var webgl = ctx.webgl;\n  var updated = new Subject();\n  var materialId = getNextMaterialId();\n  var renderObjects = [];\n\n  var _state = StructureRepresentationStateBuilder.create();\n\n  var visual;\n\n  var _structure;\n\n  var _params;\n\n  var _props;\n\n  var _theme = Theme.createEmpty();\n\n  function createOrUpdate(props, structure) {\n    var _this = this;\n\n    if (props === void 0) {\n      props = {};\n    }\n\n    if (structure && structure !== _structure) {\n      _params = getParams(ctx, structure);\n      _structure = structure;\n      if (!_props) _props = PD.getDefaultValues(_params);\n    }\n\n    _props = Object.assign({}, _props, props);\n    return Task.create('Creating or updating ComplexRepresentation', function (runtime) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var newVisual, promise;\n\n        var _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              newVisual = false;\n\n              if (!visual) {\n                visual = visualCtor(materialId, _structure, _props, webgl);\n                newVisual = true;\n              } else if ((_a = visual.mustRecreate) === null || _a === void 0 ? void 0 : _a.call(visual, _structure, _props, webgl)) {\n                visual.destroy();\n                visual = visualCtor(materialId, _structure, _props, webgl);\n                newVisual = true;\n              }\n\n              promise = visual.createOrUpdate({\n                webgl: webgl,\n                runtime: runtime\n              }, _theme, _props, structure);\n              if (!promise) return [3\n              /*break*/\n              , 2];\n              return [4\n              /*yield*/\n              , promise];\n\n            case 1:\n              _b.sent();\n\n              _b.label = 2;\n\n            case 2:\n              if (newVisual) setState(_state); // current state for new visual\n              // update list of renderObjects\n\n              renderObjects.length = 0;\n              if (visual && visual.renderObject) renderObjects.push(visual.renderObject); // increment version\n\n              updated.next(version++);\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    });\n  }\n\n  function getLoci(pickingId) {\n    if (pickingId === undefined) return Structure.Loci(_structure.target);\n    return visual ? visual.getLoci(pickingId) : EmptyLoci;\n  }\n\n  function mark(loci, action) {\n    if (!_structure) return false;\n    if (!MarkerActions.is(_state.markerActions, action)) return false;\n\n    if (Structure.isLoci(loci) || StructureElement.Loci.is(loci) || Bond.isLoci(loci)) {\n      if (!Structure.areRootsEquivalent(loci.structure, _structure)) return false; // Remap `loci` from equivalent structure to the current `_structure`\n\n      loci = Loci.remap(loci, _structure);\n\n      if (StructureElement.Loci.is(loci) && StructureElement.Loci.isWholeStructure(loci)) {\n        // Change to `EveryLoci` to allow for downstream optimizations\n        loci = EveryLoci;\n      }\n    } else if (!isEveryLoci(loci) && !isDataLoci(loci)) {\n      return false;\n    }\n\n    if (Loci.isEmpty(loci)) return false;\n    return visual ? visual.mark(loci, action) : false;\n  }\n\n  function setState(state) {\n    StructureRepresentationStateBuilder.update(_state, state);\n\n    if (state.visible !== undefined && visual) {\n      // hide visual when _unitTransforms is set and not the identity\n      visual.setVisibility(state.visible && (_state.unitTransforms === null || _state.unitTransforms.isIdentity));\n    }\n\n    if (state.alphaFactor !== undefined && visual) visual.setAlphaFactor(state.alphaFactor);\n    if (state.pickable !== undefined && visual) visual.setPickable(state.pickable);\n\n    if (state.overpaint !== undefined && visual) {\n      // Remap loci from equivalent structure to the current structure\n      var remappedOverpaint = Overpaint.remap(state.overpaint, _structure);\n      visual.setOverpaint(remappedOverpaint);\n    }\n\n    if (state.transparency !== undefined && visual) {\n      // Remap loci from equivalent structure to the current structure\n      var remappedTransparency = Transparency.remap(state.transparency, _structure);\n      visual.setTransparency(remappedTransparency);\n    }\n\n    if (state.clipping !== undefined && visual) {\n      // Remap loci from equivalent structure to the current structure\n      var remappedClipping = Clipping.remap(state.clipping, _structure);\n      visual.setClipping(remappedClipping);\n    }\n\n    if (state.transform !== undefined && visual) visual.setTransform(state.transform);\n\n    if (state.unitTransforms !== undefined && visual) {\n      // Since ComplexVisuals always renders geometries between units, the application\n      // of `unitTransforms` does not make sense. When given here and not the identity,\n      // it is ignored and sets the visual's visibility to `false`.\n      visual.setVisibility(_state.visible && (state.unitTransforms === null || state.unitTransforms.isIdentity));\n    }\n  }\n\n  function setTheme(theme) {\n    _theme = theme;\n  }\n\n  function destroy() {\n    if (visual) visual.destroy();\n  }\n\n  return {\n    label: label,\n\n    get groupCount() {\n      return visual ? visual.groupCount : 0;\n    },\n\n    get props() {\n      return _props;\n    },\n\n    get params() {\n      return _params;\n    },\n\n    get state() {\n      return _state;\n    },\n\n    get theme() {\n      return _theme;\n    },\n\n    renderObjects: renderObjects,\n    updated: updated,\n    createOrUpdate: createOrUpdate,\n    setState: setState,\n    setTheme: setTheme,\n    getLoci: getLoci,\n    mark: mark,\n    destroy: destroy\n  };\n}","map":{"version":3,"sources":["../../../src/mol-repr/structure/complex-representation.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { __awaiter, __generator } from \"tslib\";\r\nimport { ParamDefinition as PD } from '../../mol-util/param-definition';\r\nimport { StructureRepresentationStateBuilder } from './representation';\r\nimport { Structure, StructureElement, Bond } from '../../mol-model/structure';\r\nimport { Subject } from 'rxjs';\r\nimport { getNextMaterialId } from '../../mol-gl/render-object';\r\nimport { Theme } from '../../mol-theme/theme';\r\nimport { Task } from '../../mol-task';\r\nimport { EmptyLoci, Loci, isEveryLoci, isDataLoci, EveryLoci } from '../../mol-model/loci';\r\nimport { MarkerActions } from '../../mol-util/marker-action';\r\nimport { Overpaint } from '../../mol-theme/overpaint';\r\nimport { Clipping } from '../../mol-theme/clipping';\r\nimport { Transparency } from '../../mol-theme/transparency';\r\nexport function ComplexRepresentation(label, ctx, getParams, visualCtor) {\r\n    var version = 0;\r\n    var webgl = ctx.webgl;\r\n    var updated = new Subject();\r\n    var materialId = getNextMaterialId();\r\n    var renderObjects = [];\r\n    var _state = StructureRepresentationStateBuilder.create();\r\n    var visual;\r\n    var _structure;\r\n    var _params;\r\n    var _props;\r\n    var _theme = Theme.createEmpty();\r\n    function createOrUpdate(props, structure) {\r\n        var _this = this;\r\n        if (props === void 0) { props = {}; }\r\n        if (structure && structure !== _structure) {\r\n            _params = getParams(ctx, structure);\r\n            _structure = structure;\r\n            if (!_props)\r\n                _props = PD.getDefaultValues(_params);\r\n        }\r\n        _props = Object.assign({}, _props, props);\r\n        return Task.create('Creating or updating ComplexRepresentation', function (runtime) { return __awaiter(_this, void 0, void 0, function () {\r\n            var newVisual, promise;\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        newVisual = false;\r\n                        if (!visual) {\r\n                            visual = visualCtor(materialId, _structure, _props, webgl);\r\n                            newVisual = true;\r\n                        }\r\n                        else if ((_a = visual.mustRecreate) === null || _a === void 0 ? void 0 : _a.call(visual, _structure, _props, webgl)) {\r\n                            visual.destroy();\r\n                            visual = visualCtor(materialId, _structure, _props, webgl);\r\n                            newVisual = true;\r\n                        }\r\n                        promise = visual.createOrUpdate({ webgl: webgl, runtime: runtime }, _theme, _props, structure);\r\n                        if (!promise) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, promise];\r\n                    case 1:\r\n                        _b.sent();\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        if (newVisual)\r\n                            setState(_state); // current state for new visual\r\n                        // update list of renderObjects\r\n                        renderObjects.length = 0;\r\n                        if (visual && visual.renderObject)\r\n                            renderObjects.push(visual.renderObject);\r\n                        // increment version\r\n                        updated.next(version++);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); });\r\n    }\r\n    function getLoci(pickingId) {\r\n        if (pickingId === undefined)\r\n            return Structure.Loci(_structure.target);\r\n        return visual ? visual.getLoci(pickingId) : EmptyLoci;\r\n    }\r\n    function mark(loci, action) {\r\n        if (!_structure)\r\n            return false;\r\n        if (!MarkerActions.is(_state.markerActions, action))\r\n            return false;\r\n        if (Structure.isLoci(loci) || StructureElement.Loci.is(loci) || Bond.isLoci(loci)) {\r\n            if (!Structure.areRootsEquivalent(loci.structure, _structure))\r\n                return false;\r\n            // Remap `loci` from equivalent structure to the current `_structure`\r\n            loci = Loci.remap(loci, _structure);\r\n            if (StructureElement.Loci.is(loci) && StructureElement.Loci.isWholeStructure(loci)) {\r\n                // Change to `EveryLoci` to allow for downstream optimizations\r\n                loci = EveryLoci;\r\n            }\r\n        }\r\n        else if (!isEveryLoci(loci) && !isDataLoci(loci)) {\r\n            return false;\r\n        }\r\n        if (Loci.isEmpty(loci))\r\n            return false;\r\n        return visual ? visual.mark(loci, action) : false;\r\n    }\r\n    function setState(state) {\r\n        StructureRepresentationStateBuilder.update(_state, state);\r\n        if (state.visible !== undefined && visual) {\r\n            // hide visual when _unitTransforms is set and not the identity\r\n            visual.setVisibility(state.visible && (_state.unitTransforms === null || _state.unitTransforms.isIdentity));\r\n        }\r\n        if (state.alphaFactor !== undefined && visual)\r\n            visual.setAlphaFactor(state.alphaFactor);\r\n        if (state.pickable !== undefined && visual)\r\n            visual.setPickable(state.pickable);\r\n        if (state.overpaint !== undefined && visual) {\r\n            // Remap loci from equivalent structure to the current structure\r\n            var remappedOverpaint = Overpaint.remap(state.overpaint, _structure);\r\n            visual.setOverpaint(remappedOverpaint);\r\n        }\r\n        if (state.transparency !== undefined && visual) {\r\n            // Remap loci from equivalent structure to the current structure\r\n            var remappedTransparency = Transparency.remap(state.transparency, _structure);\r\n            visual.setTransparency(remappedTransparency);\r\n        }\r\n        if (state.clipping !== undefined && visual) {\r\n            // Remap loci from equivalent structure to the current structure\r\n            var remappedClipping = Clipping.remap(state.clipping, _structure);\r\n            visual.setClipping(remappedClipping);\r\n        }\r\n        if (state.transform !== undefined && visual)\r\n            visual.setTransform(state.transform);\r\n        if (state.unitTransforms !== undefined && visual) {\r\n            // Since ComplexVisuals always renders geometries between units, the application\r\n            // of `unitTransforms` does not make sense. When given here and not the identity,\r\n            // it is ignored and sets the visual's visibility to `false`.\r\n            visual.setVisibility(_state.visible && (state.unitTransforms === null || state.unitTransforms.isIdentity));\r\n        }\r\n    }\r\n    function setTheme(theme) {\r\n        _theme = theme;\r\n    }\r\n    function destroy() {\r\n        if (visual)\r\n            visual.destroy();\r\n    }\r\n    return {\r\n        label: label,\r\n        get groupCount() {\r\n            return visual ? visual.groupCount : 0;\r\n        },\r\n        get props() { return _props; },\r\n        get params() { return _params; },\r\n        get state() { return _state; },\r\n        get theme() { return _theme; },\r\n        renderObjects: renderObjects,\r\n        updated: updated,\r\n        createOrUpdate: createOrUpdate,\r\n        setState: setState,\r\n        setTheme: setTheme,\r\n        getLoci: getLoci,\r\n        mark: mark,\r\n        destroy: destroy\r\n    };\r\n}\r\n//# sourceMappingURL=complex-representation.js.map"]},"metadata":{},"sourceType":"module"}