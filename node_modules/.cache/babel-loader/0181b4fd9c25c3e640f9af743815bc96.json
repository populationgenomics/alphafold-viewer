{"ast":null,"code":"/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __assign } from \"tslib\";\nimport { Loci } from '../../../mol-model/loci';\nimport { Text } from '../../../mol-geo/geometry/text/text';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { ShapeRepresentation } from '../representation';\nimport { Representation } from '../../representation';\nimport { Shape } from '../../../mol-model/shape';\nimport { TextBuilder } from '../../../mol-geo/geometry/text/text-builder';\nimport { Sphere3D } from '../../../mol-math/geometry';\nimport { lociLabel } from '../../../mol-theme/label';\nimport { LociLabelTextParams } from './common';\n\nvar TextParams = __assign(__assign({}, LociLabelTextParams), {\n  offsetZ: PD.Numeric(2, {\n    min: 0,\n    max: 10,\n    step: 0.1\n  })\n});\n\nvar LabelVisuals = {\n  'text': function (ctx, getParams) {\n    return ShapeRepresentation(getTextShape, Text.Utils, {\n      modifyState: function (s) {\n        return __assign(__assign({}, s), {\n          pickable: false\n        });\n      }\n    });\n  }\n};\nexport var LabelParams = __assign(__assign({}, TextParams), {\n  scaleByRadius: PD.Boolean(true),\n  visuals: PD.MultiSelect(['text'], PD.objectToOptions(LabelVisuals))\n}); //\n\nvar tmpSphere = Sphere3D();\n\nfunction label(info, condensed) {\n  if (condensed === void 0) {\n    condensed = false;\n  }\n\n  return info.label || lociLabel(info.loci, {\n    hidePrefix: true,\n    htmlStyling: false,\n    condensed: condensed\n  });\n}\n\nfunction getLabelName(data) {\n  return data.infos.length === 1 ? label(data.infos[0]) : data.infos.length + \" Labels\";\n} //\n\n\nfunction buildText(data, props, text) {\n  var builder = TextBuilder.create(props, 128, 64, text);\n  var customLabel = props.customText.trim();\n\n  for (var i = 0, il = data.infos.length; i < il; ++i) {\n    var info = data.infos[i];\n    var sphere = Loci.getBoundingSphere(info.loci, tmpSphere);\n    if (!sphere) continue;\n    var center = sphere.center,\n        radius = sphere.radius;\n    var text_1 = customLabel || label(info, true);\n    builder.add(text_1, center[0], center[1], center[2], props.scaleByRadius ? radius / 0.9 : 0, props.scaleByRadius ? Math.max(1, radius) : 1, i);\n  }\n\n  return builder.getText();\n}\n\nfunction getTextShape(ctx, data, props, shape) {\n  var text = buildText(data, props, shape && shape.geometry);\n  var name = getLabelName(data);\n  var customLabel = props.customText.trim();\n  var getLabel = customLabel ? function (groupId) {\n    return customLabel;\n  } : function (groupId) {\n    return label(data.infos[groupId]);\n  };\n  return Shape.create(name, data, text, function () {\n    return props.textColor;\n  }, function () {\n    return props.textSize;\n  }, getLabel);\n}\n\nexport function LabelRepresentation(ctx, getParams) {\n  return Representation.createMulti('Label', ctx, getParams, Representation.StateBuilder, LabelVisuals);\n}","map":{"version":3,"sources":["../../../../src/mol-repr/shape/loci/label.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __assign } from \"tslib\";\r\nimport { Loci } from '../../../mol-model/loci';\r\nimport { Text } from '../../../mol-geo/geometry/text/text';\r\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\r\nimport { ShapeRepresentation } from '../representation';\r\nimport { Representation } from '../../representation';\r\nimport { Shape } from '../../../mol-model/shape';\r\nimport { TextBuilder } from '../../../mol-geo/geometry/text/text-builder';\r\nimport { Sphere3D } from '../../../mol-math/geometry';\r\nimport { lociLabel } from '../../../mol-theme/label';\r\nimport { LociLabelTextParams } from './common';\r\nvar TextParams = __assign(__assign({}, LociLabelTextParams), { offsetZ: PD.Numeric(2, { min: 0, max: 10, step: 0.1 }) });\r\nvar LabelVisuals = {\r\n    'text': function (ctx, getParams) { return ShapeRepresentation(getTextShape, Text.Utils, { modifyState: function (s) { return (__assign(__assign({}, s), { pickable: false })); } }); },\r\n};\r\nexport var LabelParams = __assign(__assign({}, TextParams), { scaleByRadius: PD.Boolean(true), visuals: PD.MultiSelect(['text'], PD.objectToOptions(LabelVisuals)) });\r\n//\r\nvar tmpSphere = Sphere3D();\r\nfunction label(info, condensed) {\r\n    if (condensed === void 0) { condensed = false; }\r\n    return info.label || lociLabel(info.loci, { hidePrefix: true, htmlStyling: false, condensed: condensed });\r\n}\r\nfunction getLabelName(data) {\r\n    return data.infos.length === 1 ? label(data.infos[0]) : data.infos.length + \" Labels\";\r\n}\r\n//\r\nfunction buildText(data, props, text) {\r\n    var builder = TextBuilder.create(props, 128, 64, text);\r\n    var customLabel = props.customText.trim();\r\n    for (var i = 0, il = data.infos.length; i < il; ++i) {\r\n        var info = data.infos[i];\r\n        var sphere = Loci.getBoundingSphere(info.loci, tmpSphere);\r\n        if (!sphere)\r\n            continue;\r\n        var center = sphere.center, radius = sphere.radius;\r\n        var text_1 = customLabel || label(info, true);\r\n        builder.add(text_1, center[0], center[1], center[2], props.scaleByRadius ? radius / 0.9 : 0, props.scaleByRadius ? Math.max(1, radius) : 1, i);\r\n    }\r\n    return builder.getText();\r\n}\r\nfunction getTextShape(ctx, data, props, shape) {\r\n    var text = buildText(data, props, shape && shape.geometry);\r\n    var name = getLabelName(data);\r\n    var customLabel = props.customText.trim();\r\n    var getLabel = customLabel\r\n        ? function (groupId) {\r\n            return customLabel;\r\n        } : function (groupId) {\r\n        return label(data.infos[groupId]);\r\n    };\r\n    return Shape.create(name, data, text, function () { return props.textColor; }, function () { return props.textSize; }, getLabel);\r\n}\r\nexport function LabelRepresentation(ctx, getParams) {\r\n    return Representation.createMulti('Label', ctx, getParams, Representation.StateBuilder, LabelVisuals);\r\n}\r\n//# sourceMappingURL=label.js.map"]},"metadata":{},"sourceType":"module"}