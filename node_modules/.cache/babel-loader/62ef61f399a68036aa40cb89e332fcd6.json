{"ast":null,"code":"/**\r\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __assign, __extends } from \"tslib\";\nimport { ParamDefinition as PD } from '../mol-util/param-definition';\nimport { StatefulPluginComponent } from '../mol-plugin-state/component';\nimport { PluginCommands } from './commands';\nvar regionStateOptions = [['full', 'Full'], ['collapsed', 'Collapsed'], ['hidden', 'Hidden']];\nvar simpleRegionStateOptions = [['full', 'Full'], ['hidden', 'Hidden']];\nexport var PluginLayoutStateParams = {\n  isExpanded: PD.Boolean(false),\n  showControls: PD.Boolean(true),\n  regionState: PD.Group({\n    left: PD.Select('full', regionStateOptions),\n    top: PD.Select('full', simpleRegionStateOptions),\n    right: PD.Select('full', simpleRegionStateOptions),\n    bottom: PD.Select('full', simpleRegionStateOptions)\n  }),\n  controlsDisplay: PD.Value('outside', {\n    isHidden: true\n  })\n};\n\nvar PluginLayout =\n/** @class */\nfunction (_super) {\n  __extends(PluginLayout, _super);\n\n  function PluginLayout(context) {\n    var _this = _super.call(this, __assign(__assign({}, PD.getDefaultValues(PluginLayoutStateParams)), context.spec.layout && context.spec.layout.initial)) || this;\n\n    _this.context = context;\n    _this.events = {\n      updated: _this.ev()\n    };\n    _this.rootState = void 0;\n    PluginCommands.Layout.Update.subscribe(context, function (e) {\n      return _this.updateProps(e.state);\n    }); // TODO how best make sure it runs on node.js as well as in the browser?\n\n    if (typeof document !== 'undefined') {\n      // <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />\n      _this.expandedViewport = document.createElement('meta');\n      _this.expandedViewport.name = 'viewport';\n      _this.expandedViewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0';\n    }\n\n    return _this;\n  }\n\n  PluginLayout.prototype.updateProps = function (state) {\n    var prevExpanded = !!this.state.isExpanded;\n    this.updateState(state);\n    if (this.root && typeof state.isExpanded === 'boolean' && state.isExpanded !== prevExpanded) this.handleExpand();\n    this.events.updated.next(void 0);\n  };\n\n  PluginLayout.prototype.setProps = function (props) {\n    this.updateState(props);\n  };\n\n  PluginLayout.prototype.setRoot = function (root) {\n    this.root = root;\n    if (this.state.isExpanded) this.handleExpand();\n  };\n\n  PluginLayout.prototype.getScrollElement = function () {\n    if (document.scrollingElement) return document.scrollingElement;\n    if (document.documentElement) return document.documentElement;\n    return document.body;\n  };\n\n  PluginLayout.prototype.handleExpand = function () {\n    try {\n      var body = document.getElementsByTagName('body')[0];\n      var head = document.getElementsByTagName('head')[0];\n      if (!body || !head || !this.root) return;\n\n      if (this.state.isExpanded) {\n        var children = head.children;\n        var viewports = [];\n        var hasExp = false;\n\n        for (var i = 0; i < children.length; i++) {\n          if (children[i] === this.expandedViewport) {\n            hasExp = true;\n          } else if ((children[i].name || '').toLowerCase() === 'viewport') {\n            viewports.push(children[i]);\n          }\n        }\n\n        for (var _i = 0, viewports_1 = viewports; _i < viewports_1.length; _i++) {\n          var v = viewports_1[_i];\n          head.removeChild(v);\n        }\n\n        if (!hasExp) head.appendChild(this.expandedViewport);\n        var s = body.style;\n        var doc = this.getScrollElement();\n        var scrollLeft = doc.scrollLeft;\n        var scrollTop = doc.scrollTop;\n        this.rootState = {\n          top: s.top,\n          bottom: s.bottom,\n          right: s.right,\n          left: s.left,\n          scrollTop: scrollTop,\n          scrollLeft: scrollLeft,\n          position: s.position,\n          overflow: s.overflow,\n          viewports: viewports,\n          zIndex: this.root.style.zIndex,\n          width: s.width,\n          height: s.height,\n          maxWidth: s.maxWidth,\n          maxHeight: s.maxHeight,\n          margin: s.margin,\n          marginLeft: s.marginLeft,\n          marginRight: s.marginRight,\n          marginTop: s.marginTop,\n          marginBottom: s.marginBottom\n        };\n        s.overflow = 'hidden';\n        s.position = 'fixed';\n        s.top = '0';\n        s.bottom = '0';\n        s.right = '0';\n        s.left = '0';\n        s.width = '100%';\n        s.height = '100%';\n        s.maxWidth = '100%';\n        s.maxHeight = '100%';\n        s.margin = '0';\n        s.marginLeft = '0';\n        s.marginRight = '0';\n        s.marginTop = '0';\n        s.marginBottom = '0'; // TODO: setting this breaks viewport controls for some reason. Is there a fix?\n        // this.root.style.zIndex = '100000';\n      } else {\n        var children = head.children;\n\n        for (var i = 0; i < children.length; i++) {\n          if (children[i] === this.expandedViewport) {\n            head.removeChild(this.expandedViewport);\n            break;\n          }\n        }\n\n        if (this.rootState) {\n          var t = this.rootState;\n\n          for (var _a = 0, _b = t.viewports; _a < _b.length; _a++) {\n            var v = _b[_a];\n            head.appendChild(v);\n          }\n\n          var s = body.style;\n          s.top = t.top;\n          s.bottom = t.bottom;\n          s.left = t.left;\n          s.right = t.right;\n          s.width = t.width;\n          s.height = t.height;\n          s.maxWidth = t.maxWidth;\n          s.maxHeight = t.maxHeight;\n          s.margin = t.margin;\n          s.marginLeft = t.marginLeft;\n          s.marginRight = t.marginRight;\n          s.marginTop = t.marginTop;\n          s.marginBottom = t.marginBottom;\n          s.position = t.position;\n          s.overflow = t.overflow || '';\n          var doc = this.getScrollElement();\n          doc.scrollTop = t.scrollTop;\n          doc.scrollLeft = t.scrollLeft;\n          this.rootState = void 0;\n          this.root.style.zIndex = t.zIndex;\n        }\n      }\n    } catch (e) {\n      var msg = 'Layout change error, you might have to reload the page.';\n      this.context.log.error(msg);\n      console.error(msg, e);\n    }\n  };\n\n  return PluginLayout;\n}(StatefulPluginComponent);\n\nexport { PluginLayout };","map":{"version":3,"sources":["../../src/mol-plugin/layout.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __assign, __extends } from \"tslib\";\r\nimport { ParamDefinition as PD } from '../mol-util/param-definition';\r\nimport { StatefulPluginComponent } from '../mol-plugin-state/component';\r\nimport { PluginCommands } from './commands';\r\nvar regionStateOptions = [\r\n    ['full', 'Full'],\r\n    ['collapsed', 'Collapsed'],\r\n    ['hidden', 'Hidden'],\r\n];\r\nvar simpleRegionStateOptions = [\r\n    ['full', 'Full'],\r\n    ['hidden', 'Hidden'],\r\n];\r\nexport var PluginLayoutStateParams = {\r\n    isExpanded: PD.Boolean(false),\r\n    showControls: PD.Boolean(true),\r\n    regionState: PD.Group({\r\n        left: PD.Select('full', regionStateOptions),\r\n        top: PD.Select('full', simpleRegionStateOptions),\r\n        right: PD.Select('full', simpleRegionStateOptions),\r\n        bottom: PD.Select('full', simpleRegionStateOptions),\r\n    }),\r\n    controlsDisplay: PD.Value('outside', { isHidden: true })\r\n};\r\nvar PluginLayout = /** @class */ (function (_super) {\r\n    __extends(PluginLayout, _super);\r\n    function PluginLayout(context) {\r\n        var _this = _super.call(this, __assign(__assign({}, PD.getDefaultValues(PluginLayoutStateParams)), (context.spec.layout && context.spec.layout.initial))) || this;\r\n        _this.context = context;\r\n        _this.events = {\r\n            updated: _this.ev()\r\n        };\r\n        _this.rootState = void 0;\r\n        PluginCommands.Layout.Update.subscribe(context, function (e) { return _this.updateProps(e.state); });\r\n        // TODO how best make sure it runs on node.js as well as in the browser?\r\n        if (typeof document !== 'undefined') {\r\n            // <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />\r\n            _this.expandedViewport = document.createElement('meta');\r\n            _this.expandedViewport.name = 'viewport';\r\n            _this.expandedViewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0';\r\n        }\r\n        return _this;\r\n    }\r\n    PluginLayout.prototype.updateProps = function (state) {\r\n        var prevExpanded = !!this.state.isExpanded;\r\n        this.updateState(state);\r\n        if (this.root && typeof state.isExpanded === 'boolean' && state.isExpanded !== prevExpanded)\r\n            this.handleExpand();\r\n        this.events.updated.next(void 0);\r\n    };\r\n    PluginLayout.prototype.setProps = function (props) {\r\n        this.updateState(props);\r\n    };\r\n    PluginLayout.prototype.setRoot = function (root) {\r\n        this.root = root;\r\n        if (this.state.isExpanded)\r\n            this.handleExpand();\r\n    };\r\n    PluginLayout.prototype.getScrollElement = function () {\r\n        if (document.scrollingElement)\r\n            return document.scrollingElement;\r\n        if (document.documentElement)\r\n            return document.documentElement;\r\n        return document.body;\r\n    };\r\n    PluginLayout.prototype.handleExpand = function () {\r\n        try {\r\n            var body = document.getElementsByTagName('body')[0];\r\n            var head = document.getElementsByTagName('head')[0];\r\n            if (!body || !head || !this.root)\r\n                return;\r\n            if (this.state.isExpanded) {\r\n                var children = head.children;\r\n                var viewports = [];\r\n                var hasExp = false;\r\n                for (var i = 0; i < children.length; i++) {\r\n                    if (children[i] === this.expandedViewport) {\r\n                        hasExp = true;\r\n                    }\r\n                    else if ((children[i].name || '').toLowerCase() === 'viewport') {\r\n                        viewports.push(children[i]);\r\n                    }\r\n                }\r\n                for (var _i = 0, viewports_1 = viewports; _i < viewports_1.length; _i++) {\r\n                    var v = viewports_1[_i];\r\n                    head.removeChild(v);\r\n                }\r\n                if (!hasExp)\r\n                    head.appendChild(this.expandedViewport);\r\n                var s = body.style;\r\n                var doc = this.getScrollElement();\r\n                var scrollLeft = doc.scrollLeft;\r\n                var scrollTop = doc.scrollTop;\r\n                this.rootState = {\r\n                    top: s.top, bottom: s.bottom, right: s.right, left: s.left,\r\n                    scrollTop: scrollTop,\r\n                    scrollLeft: scrollLeft,\r\n                    position: s.position, overflow: s.overflow,\r\n                    viewports: viewports,\r\n                    zIndex: this.root.style.zIndex,\r\n                    width: s.width, height: s.height,\r\n                    maxWidth: s.maxWidth, maxHeight: s.maxHeight,\r\n                    margin: s.margin, marginLeft: s.marginLeft, marginRight: s.marginRight, marginTop: s.marginTop, marginBottom: s.marginBottom\r\n                };\r\n                s.overflow = 'hidden';\r\n                s.position = 'fixed';\r\n                s.top = '0';\r\n                s.bottom = '0';\r\n                s.right = '0';\r\n                s.left = '0';\r\n                s.width = '100%';\r\n                s.height = '100%';\r\n                s.maxWidth = '100%';\r\n                s.maxHeight = '100%';\r\n                s.margin = '0';\r\n                s.marginLeft = '0';\r\n                s.marginRight = '0';\r\n                s.marginTop = '0';\r\n                s.marginBottom = '0';\r\n                // TODO: setting this breaks viewport controls for some reason. Is there a fix?\r\n                // this.root.style.zIndex = '100000';\r\n            }\r\n            else {\r\n                var children = head.children;\r\n                for (var i = 0; i < children.length; i++) {\r\n                    if (children[i] === this.expandedViewport) {\r\n                        head.removeChild(this.expandedViewport);\r\n                        break;\r\n                    }\r\n                }\r\n                if (this.rootState) {\r\n                    var t = this.rootState;\r\n                    for (var _a = 0, _b = t.viewports; _a < _b.length; _a++) {\r\n                        var v = _b[_a];\r\n                        head.appendChild(v);\r\n                    }\r\n                    var s = body.style;\r\n                    s.top = t.top;\r\n                    s.bottom = t.bottom;\r\n                    s.left = t.left;\r\n                    s.right = t.right;\r\n                    s.width = t.width;\r\n                    s.height = t.height;\r\n                    s.maxWidth = t.maxWidth;\r\n                    s.maxHeight = t.maxHeight;\r\n                    s.margin = t.margin;\r\n                    s.marginLeft = t.marginLeft;\r\n                    s.marginRight = t.marginRight;\r\n                    s.marginTop = t.marginTop;\r\n                    s.marginBottom = t.marginBottom;\r\n                    s.position = t.position;\r\n                    s.overflow = t.overflow || '';\r\n                    var doc = this.getScrollElement();\r\n                    doc.scrollTop = t.scrollTop;\r\n                    doc.scrollLeft = t.scrollLeft;\r\n                    this.rootState = void 0;\r\n                    this.root.style.zIndex = t.zIndex;\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            var msg = 'Layout change error, you might have to reload the page.';\r\n            this.context.log.error(msg);\r\n            console.error(msg, e);\r\n        }\r\n    };\r\n    return PluginLayout;\r\n}(StatefulPluginComponent));\r\nexport { PluginLayout };\r\n//# sourceMappingURL=layout.js.map"]},"metadata":{},"sourceType":"module"}