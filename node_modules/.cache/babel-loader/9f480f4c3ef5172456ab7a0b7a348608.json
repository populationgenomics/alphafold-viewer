{"ast":null,"code":"/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * Adapted from LiteMol (c) David Sehnal\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { __extends } from \"tslib\";\nimport { StatefulPluginComponent } from '../../mol-plugin-state/component';\nimport { OrderedMap } from 'immutable';\nimport { PluginCommands } from '../commands';\n\nvar PluginToastManager =\n/** @class */\nfunction (_super) {\n  __extends(PluginToastManager, _super);\n\n  function PluginToastManager(plugin) {\n    var _this = _super.call(this, {\n      entries: OrderedMap()\n    }) || this;\n\n    _this.events = {\n      changed: _this.ev()\n    };\n    _this.serialNumber = 0;\n    _this.serialId = 0;\n    PluginCommands.Toast.Show.subscribe(plugin, function (e) {\n      return _this.show(e);\n    });\n    PluginCommands.Toast.Hide.subscribe(plugin, function (e) {\n      return _this.hide(_this.findByKey(e.key));\n    });\n    return _this;\n  }\n\n  PluginToastManager.prototype.findByKey = function (key) {\n    return this.state.entries.find(function (e) {\n      return !!e && e.key === key;\n    });\n  };\n\n  PluginToastManager.prototype.show = function (toast) {\n    var _this = this;\n\n    var entries = this.state.entries;\n    var e = void 0;\n    var id = ++this.serialId;\n    var serialNumber;\n\n    if (toast.key && (e = this.findByKey(toast.key))) {\n      if (e.timeout !== void 0) clearTimeout(e.timeout);\n      serialNumber = e.serialNumber;\n      entries = entries.remove(e.id);\n    } else {\n      serialNumber = ++this.serialNumber;\n    }\n\n    e = {\n      id: id,\n      serialNumber: serialNumber,\n      key: toast.key,\n      title: toast.title,\n      message: toast.message,\n      timeout: this.timeout(id, toast.timeoutMs),\n      hide: function () {\n        return _this.hideId(id);\n      }\n    };\n    if (this.updateState({\n      entries: entries.set(id, e)\n    })) this.events.changed.next(void 0);\n  };\n\n  PluginToastManager.prototype.timeout = function (id, delay) {\n    var _this = this;\n\n    if (delay === void 0) return void 0;\n    if (delay < 0) delay = 500;\n    return setTimeout(function () {\n      var e = _this.state.entries.get(id);\n\n      e.timeout = void 0;\n\n      _this.hide(e);\n    }, delay);\n  };\n\n  PluginToastManager.prototype.hideId = function (id) {\n    this.hide(this.state.entries.get(id));\n  };\n\n  PluginToastManager.prototype.hide = function (e) {\n    if (!e) return;\n    if (e.timeout !== void 0) clearTimeout(e.timeout);\n    e.hide = void 0;\n    if (this.updateState({\n      entries: this.state.entries.delete(e.id)\n    })) this.events.changed.next(void 0);\n  };\n\n  return PluginToastManager;\n}(StatefulPluginComponent);\n\nexport { PluginToastManager };","map":{"version":3,"sources":["../../../src/mol-plugin/util/toast.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * Adapted from LiteMol (c) David Sehnal\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { __extends } from \"tslib\";\r\nimport { StatefulPluginComponent } from '../../mol-plugin-state/component';\r\nimport { OrderedMap } from 'immutable';\r\nimport { PluginCommands } from '../commands';\r\nvar PluginToastManager = /** @class */ (function (_super) {\r\n    __extends(PluginToastManager, _super);\r\n    function PluginToastManager(plugin) {\r\n        var _this = _super.call(this, { entries: OrderedMap() }) || this;\r\n        _this.events = {\r\n            changed: _this.ev()\r\n        };\r\n        _this.serialNumber = 0;\r\n        _this.serialId = 0;\r\n        PluginCommands.Toast.Show.subscribe(plugin, function (e) { return _this.show(e); });\r\n        PluginCommands.Toast.Hide.subscribe(plugin, function (e) { return _this.hide(_this.findByKey(e.key)); });\r\n        return _this;\r\n    }\r\n    PluginToastManager.prototype.findByKey = function (key) {\r\n        return this.state.entries.find(function (e) { return !!e && e.key === key; });\r\n    };\r\n    PluginToastManager.prototype.show = function (toast) {\r\n        var _this = this;\r\n        var entries = this.state.entries;\r\n        var e = void 0;\r\n        var id = ++this.serialId;\r\n        var serialNumber;\r\n        if (toast.key && (e = this.findByKey(toast.key))) {\r\n            if (e.timeout !== void 0)\r\n                clearTimeout(e.timeout);\r\n            serialNumber = e.serialNumber;\r\n            entries = entries.remove(e.id);\r\n        }\r\n        else {\r\n            serialNumber = ++this.serialNumber;\r\n        }\r\n        e = {\r\n            id: id,\r\n            serialNumber: serialNumber,\r\n            key: toast.key,\r\n            title: toast.title,\r\n            message: toast.message,\r\n            timeout: this.timeout(id, toast.timeoutMs),\r\n            hide: function () { return _this.hideId(id); }\r\n        };\r\n        if (this.updateState({ entries: entries.set(id, e) }))\r\n            this.events.changed.next(void 0);\r\n    };\r\n    PluginToastManager.prototype.timeout = function (id, delay) {\r\n        var _this = this;\r\n        if (delay === void 0)\r\n            return void 0;\r\n        if (delay < 0)\r\n            delay = 500;\r\n        return setTimeout(function () {\r\n            var e = _this.state.entries.get(id);\r\n            e.timeout = void 0;\r\n            _this.hide(e);\r\n        }, delay);\r\n    };\r\n    PluginToastManager.prototype.hideId = function (id) {\r\n        this.hide(this.state.entries.get(id));\r\n    };\r\n    PluginToastManager.prototype.hide = function (e) {\r\n        if (!e)\r\n            return;\r\n        if (e.timeout !== void 0)\r\n            clearTimeout(e.timeout);\r\n        e.hide = void 0;\r\n        if (this.updateState({ entries: this.state.entries.delete(e.id) }))\r\n            this.events.changed.next(void 0);\r\n    };\r\n    return PluginToastManager;\r\n}(StatefulPluginComponent));\r\nexport { PluginToastManager };\r\n//# sourceMappingURL=toast.js.map"]},"metadata":{},"sourceType":"module"}