{"ast":null,"code":"/**\r\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { StructureElement, Structure } from '../../structure';\nimport { StructureSelection } from '../selection';\nimport { HashSet } from '../../../../mol-data/generic';\nimport { structureUnion } from './structure-set';\n\nvar UniqueStructuresBuilder =\n/** @class */\nfunction () {\n  function UniqueStructuresBuilder(source) {\n    this.source = source;\n    this.set = HashSet(Structure.hashCode, Structure.areUnitIdsAndIndicesEqual);\n    this.structures = [];\n    this.allSingletons = true;\n  }\n\n  UniqueStructuresBuilder.prototype.add = function (s) {\n    if (!s.elementCount) return;\n    if (s.elementCount !== 1) this.allSingletons = false;\n\n    if (this.set.add(s)) {\n      this.structures[this.structures.length] = s;\n    }\n  };\n\n  UniqueStructuresBuilder.prototype.getSelection = function () {\n    if (this.allSingletons) return StructureSelection.Singletons(this.source, structureUnion(this.source, this.structures));\n    return StructureSelection.Sequence(this.source, this.structures);\n  };\n\n  return UniqueStructuresBuilder;\n}();\n\nexport { UniqueStructuresBuilder };\n\nvar LinearGroupingBuilder =\n/** @class */\nfunction () {\n  function LinearGroupingBuilder(source) {\n    this.source = source;\n    this.builders = [];\n    this.builderMap = new Map();\n  }\n\n  LinearGroupingBuilder.prototype.add = function (key, unit, element) {\n    var b = this.builderMap.get(key);\n\n    if (!b) {\n      b = this.source.subsetBuilder(true);\n      this.builders[this.builders.length] = b;\n      this.builderMap.set(key, b);\n    }\n\n    b.addToUnit(unit, element);\n  };\n\n  LinearGroupingBuilder.prototype.allSingletons = function () {\n    for (var i = 0, _i = this.builders.length; i < _i; i++) {\n      if (this.builders[i].elementCount > 1) return false;\n    }\n\n    return true;\n  };\n\n  LinearGroupingBuilder.prototype.singletonSelection = function () {\n    var builder = this.source.subsetBuilder(true);\n    var loc = StructureElement.Location.create(this.source);\n\n    for (var i = 0, _i = this.builders.length; i < _i; i++) {\n      this.builders[i].setSingletonLocation(loc);\n      builder.addToUnit(loc.unit.id, loc.element);\n    }\n\n    return StructureSelection.Singletons(this.source, builder.getStructure());\n  };\n\n  LinearGroupingBuilder.prototype.fullSelection = function () {\n    var structures = new Array(this.builders.length);\n\n    for (var i = 0, _i = this.builders.length; i < _i; i++) {\n      structures[i] = this.builders[i].getStructure();\n    }\n\n    return StructureSelection.Sequence(this.source, structures);\n  };\n\n  LinearGroupingBuilder.prototype.getSelection = function () {\n    var len = this.builders.length;\n    if (len === 0) return StructureSelection.Empty(this.source);\n    if (this.allSingletons()) return this.singletonSelection();\n    return this.fullSelection();\n  };\n\n  return LinearGroupingBuilder;\n}();\n\nexport { LinearGroupingBuilder };","map":{"version":3,"sources":["../../../../../src/mol-model/structure/query/utils/builders.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { StructureElement, Structure } from '../../structure';\r\nimport { StructureSelection } from '../selection';\r\nimport { HashSet } from '../../../../mol-data/generic';\r\nimport { structureUnion } from './structure-set';\r\nvar UniqueStructuresBuilder = /** @class */ (function () {\r\n    function UniqueStructuresBuilder(source) {\r\n        this.source = source;\r\n        this.set = HashSet(Structure.hashCode, Structure.areUnitIdsAndIndicesEqual);\r\n        this.structures = [];\r\n        this.allSingletons = true;\r\n    }\r\n    UniqueStructuresBuilder.prototype.add = function (s) {\r\n        if (!s.elementCount)\r\n            return;\r\n        if (s.elementCount !== 1)\r\n            this.allSingletons = false;\r\n        if (this.set.add(s)) {\r\n            this.structures[this.structures.length] = s;\r\n        }\r\n    };\r\n    UniqueStructuresBuilder.prototype.getSelection = function () {\r\n        if (this.allSingletons)\r\n            return StructureSelection.Singletons(this.source, structureUnion(this.source, this.structures));\r\n        return StructureSelection.Sequence(this.source, this.structures);\r\n    };\r\n    return UniqueStructuresBuilder;\r\n}());\r\nexport { UniqueStructuresBuilder };\r\nvar LinearGroupingBuilder = /** @class */ (function () {\r\n    function LinearGroupingBuilder(source) {\r\n        this.source = source;\r\n        this.builders = [];\r\n        this.builderMap = new Map();\r\n    }\r\n    LinearGroupingBuilder.prototype.add = function (key, unit, element) {\r\n        var b = this.builderMap.get(key);\r\n        if (!b) {\r\n            b = this.source.subsetBuilder(true);\r\n            this.builders[this.builders.length] = b;\r\n            this.builderMap.set(key, b);\r\n        }\r\n        b.addToUnit(unit, element);\r\n    };\r\n    LinearGroupingBuilder.prototype.allSingletons = function () {\r\n        for (var i = 0, _i = this.builders.length; i < _i; i++) {\r\n            if (this.builders[i].elementCount > 1)\r\n                return false;\r\n        }\r\n        return true;\r\n    };\r\n    LinearGroupingBuilder.prototype.singletonSelection = function () {\r\n        var builder = this.source.subsetBuilder(true);\r\n        var loc = StructureElement.Location.create(this.source);\r\n        for (var i = 0, _i = this.builders.length; i < _i; i++) {\r\n            this.builders[i].setSingletonLocation(loc);\r\n            builder.addToUnit(loc.unit.id, loc.element);\r\n        }\r\n        return StructureSelection.Singletons(this.source, builder.getStructure());\r\n    };\r\n    LinearGroupingBuilder.prototype.fullSelection = function () {\r\n        var structures = new Array(this.builders.length);\r\n        for (var i = 0, _i = this.builders.length; i < _i; i++) {\r\n            structures[i] = this.builders[i].getStructure();\r\n        }\r\n        return StructureSelection.Sequence(this.source, structures);\r\n    };\r\n    LinearGroupingBuilder.prototype.getSelection = function () {\r\n        var len = this.builders.length;\r\n        if (len === 0)\r\n            return StructureSelection.Empty(this.source);\r\n        if (this.allSingletons())\r\n            return this.singletonSelection();\r\n        return this.fullSelection();\r\n    };\r\n    return LinearGroupingBuilder;\r\n}());\r\nexport { LinearGroupingBuilder };\r\n//# sourceMappingURL=builders.js.map"]},"metadata":{},"sourceType":"module"}