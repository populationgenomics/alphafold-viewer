{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Loci } from '../../mol-model/loci';\nimport { StructureMeasurementParams } from '../../mol-plugin-state/manager/structure/measurement';\nimport { PluginCommands } from '../../mol-plugin/commands';\nimport { angleLabel, dihedralLabel, distanceLabel, lociLabel } from '../../mol-theme/label';\nimport { CollapsableControls, PurePluginUIComponent } from '../base';\nimport { ActionMenu } from '../controls/action-menu';\nimport { Button, ExpandGroup, IconButton, ToggleButton } from '../controls/common';\nimport { AddSvg, ArrowDownwardSvg, ArrowUpwardSvg, DeleteOutlinedSvg, HelpOutlineSvg, Icon, MoreHorizSvg, PencilRulerSvg, SetSvg, TuneSvg, VisibilityOffOutlinedSvg, VisibilityOutlinedSvg } from '../controls/icons';\nimport { ParameterControls } from '../controls/parameters';\nimport { UpdateTransformControl } from '../state/update-transform';\nimport { ToggleSelectionModeButton } from './selection'; // TODO details, options (e.g. change text for labels)\n\nvar StructureMeasurementsControls =\n/** @class */\nfunction (_super) {\n  __extends(StructureMeasurementsControls, _super);\n\n  function StructureMeasurementsControls() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  StructureMeasurementsControls.prototype.defaultState = function () {\n    return {\n      isCollapsed: false,\n      header: 'Measurements',\n      brand: {\n        accent: 'gray',\n        svg: PencilRulerSvg\n      }\n    };\n  };\n\n  StructureMeasurementsControls.prototype.renderControls = function () {\n    return _jsxs(_Fragment, {\n      children: [_jsx(MeasurementControls, {}, void 0), _jsx(MeasurementList, {}, void 0)]\n    }, void 0);\n  };\n\n  return StructureMeasurementsControls;\n}(CollapsableControls);\n\nexport { StructureMeasurementsControls };\n\nvar MeasurementList =\n/** @class */\nfunction (_super) {\n  __extends(MeasurementList, _super);\n\n  function MeasurementList() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  MeasurementList.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.managers.structure.measurement.behaviors.state, function () {\n      _this.forceUpdate();\n    });\n  };\n\n  MeasurementList.prototype.renderGroup = function (cells, header) {\n    var group = [];\n\n    for (var _a = 0, cells_1 = cells; _a < cells_1.length; _a++) {\n      var cell = cells_1[_a];\n      if (cell.obj) group.push(_jsx(MeasurementEntry, {\n        cell: cell\n      }, cell.obj.id));\n    }\n\n    return group.length ? _jsx(ExpandGroup, __assign({\n      header: header,\n      initiallyExpanded: true\n    }, {\n      children: group\n    }), void 0) : null;\n  };\n\n  MeasurementList.prototype.render = function () {\n    var measurements = this.plugin.managers.structure.measurement.state;\n    return _jsxs(\"div\", __assign({\n      style: {\n        marginTop: '6px'\n      }\n    }, {\n      children: [this.renderGroup(measurements.labels, 'Labels'), this.renderGroup(measurements.distances, 'Distances'), this.renderGroup(measurements.angles, 'Angles'), this.renderGroup(measurements.dihedrals, 'Dihedrals')]\n    }), void 0);\n  };\n\n  return MeasurementList;\n}(PurePluginUIComponent);\n\nexport { MeasurementList };\n\nvar MeasurementControls =\n/** @class */\nfunction (_super) {\n  __extends(MeasurementControls, _super);\n\n  function MeasurementControls() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      isBusy: false,\n      action: void 0\n    };\n\n    _this.measureDistance = function () {\n      var loci = _this.plugin.managers.structure.selection.additionsHistory;\n\n      _this.plugin.managers.structure.measurement.addDistance(loci[0].loci, loci[1].loci);\n    };\n\n    _this.measureAngle = function () {\n      var loci = _this.plugin.managers.structure.selection.additionsHistory;\n\n      _this.plugin.managers.structure.measurement.addAngle(loci[0].loci, loci[1].loci, loci[2].loci);\n    };\n\n    _this.measureDihedral = function () {\n      var loci = _this.plugin.managers.structure.selection.additionsHistory;\n\n      _this.plugin.managers.structure.measurement.addDihedral(loci[0].loci, loci[1].loci, loci[2].loci, loci[3].loci);\n    };\n\n    _this.addLabel = function () {\n      var loci = _this.plugin.managers.structure.selection.additionsHistory;\n\n      _this.plugin.managers.structure.measurement.addLabel(loci[0].loci);\n    };\n\n    _this.selectAction = function (item) {\n      _this.toggleAdd();\n\n      if (!item) return;\n      (item === null || item === void 0 ? void 0 : item.value)();\n    };\n\n    _this.toggleAdd = function () {\n      return _this.setState({\n        action: _this.state.action === 'add' ? void 0 : 'add'\n      });\n    };\n\n    _this.toggleOptions = function () {\n      return _this.setState({\n        action: _this.state.action === 'options' ? void 0 : 'options'\n      });\n    };\n\n    return _this;\n  }\n\n  MeasurementControls.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.selection.events.additionsHistoryUpdated, function () {\n      _this.forceUpdate();\n    });\n    this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\n      _this.setState({\n        isBusy: v\n      });\n    });\n  };\n\n  Object.defineProperty(MeasurementControls.prototype, \"selection\", {\n    get: function () {\n      return this.plugin.managers.structure.selection;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MeasurementControls.prototype, \"actions\", {\n    get: function () {\n      var history = this.selection.additionsHistory;\n      var ret = [{\n        kind: 'item',\n        label: \"Label \" + (history.length === 0 ? ' (1 selection required)' : ' (1st selection)'),\n        value: this.addLabel,\n        disabled: history.length === 0\n      }, {\n        kind: 'item',\n        label: \"Distance \" + (history.length < 2 ? ' (2 selections required)' : ' (top 2 selections)'),\n        value: this.measureDistance,\n        disabled: history.length < 2\n      }, {\n        kind: 'item',\n        label: \"Angle \" + (history.length < 3 ? ' (3 selections required)' : ' (top 3 selections)'),\n        value: this.measureAngle,\n        disabled: history.length < 3\n      }, {\n        kind: 'item',\n        label: \"Dihedral \" + (history.length < 4 ? ' (4 selections required)' : ' (top 4 selections)'),\n        value: this.measureDihedral,\n        disabled: history.length < 4\n      }];\n      return ret;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  MeasurementControls.prototype.highlight = function (loci) {\n    this.plugin.managers.interactivity.lociHighlights.highlightOnly({\n      loci: loci\n    }, false);\n  };\n\n  MeasurementControls.prototype.moveHistory = function (e, direction) {\n    this.plugin.managers.structure.selection.modifyHistory(e, direction, 4);\n  };\n\n  MeasurementControls.prototype.focusLoci = function (loci) {\n    this.plugin.managers.camera.focusLoci(loci);\n  };\n\n  MeasurementControls.prototype.historyEntry = function (e, idx) {\n    var _this = this;\n\n    var history = this.plugin.managers.structure.selection.additionsHistory;\n    return _jsxs(\"div\", __assign({\n      className: 'msp-flex-row'\n    }, {\n      children: [_jsxs(Button, __assign({\n        noOverflow: true,\n        title: 'Click to focus. Hover to highlight.',\n        onClick: function () {\n          return _this.focusLoci(e.loci);\n        },\n        style: {\n          width: 'auto',\n          textAlign: 'left'\n        },\n        onMouseEnter: function () {\n          return _this.highlight(e.loci);\n        },\n        onMouseLeave: function () {\n          return _this.plugin.managers.interactivity.lociHighlights.clearHighlights();\n        }\n      }, {\n        children: [idx, \". \", _jsx(\"span\", {\n          dangerouslySetInnerHTML: {\n            __html: e.label\n          }\n        }, void 0)]\n      }), void 0), history.length > 1 && _jsx(IconButton, {\n        svg: ArrowUpwardSvg,\n        small: true,\n        className: 'msp-form-control',\n        onClick: function () {\n          return _this.moveHistory(e, 'up');\n        },\n        flex: '20px',\n        title: 'Move up'\n      }, void 0), history.length > 1 && _jsx(IconButton, {\n        svg: ArrowDownwardSvg,\n        small: true,\n        className: 'msp-form-control',\n        onClick: function () {\n          return _this.moveHistory(e, 'down');\n        },\n        flex: '20px',\n        title: 'Move down'\n      }, void 0), _jsx(IconButton, {\n        svg: DeleteOutlinedSvg,\n        small: true,\n        className: 'msp-form-control',\n        onClick: function () {\n          return _this.plugin.managers.structure.selection.modifyHistory(e, 'remove');\n        },\n        flex: true,\n        title: 'Remove'\n      }, void 0)]\n    }), e.id);\n  };\n\n  MeasurementControls.prototype.add = function () {\n    var history = this.plugin.managers.structure.selection.additionsHistory;\n    var entries = [];\n\n    for (var i = 0, _i = Math.min(history.length, 4); i < _i; i++) {\n      entries.push(this.historyEntry(history[i], i + 1));\n    }\n\n    return _jsxs(_Fragment, {\n      children: [_jsx(ActionMenu, {\n        items: this.actions,\n        onSelect: this.selectAction\n      }, void 0), entries.length > 0 && _jsx(\"div\", __assign({\n        className: 'msp-control-offset'\n      }, {\n        children: entries\n      }), void 0), entries.length === 0 && _jsx(\"div\", __assign({\n        className: 'msp-control-offset msp-help-text'\n      }, {\n        children: _jsxs(\"div\", __assign({\n          className: 'msp-help-description'\n        }, {\n          children: [_jsx(Icon, {\n            svg: HelpOutlineSvg,\n            inline: true\n          }, void 0), \"Add one or more selections (toggle \", _jsx(ToggleSelectionModeButton, {\n            inline: true\n          }, void 0), \" mode)\"]\n        }), void 0)\n      }), void 0)]\n    }, void 0);\n  };\n\n  MeasurementControls.prototype.render = function () {\n    return _jsxs(_Fragment, {\n      children: [_jsxs(\"div\", __assign({\n        className: 'msp-flex-row'\n      }, {\n        children: [_jsx(ToggleButton, {\n          icon: AddSvg,\n          label: 'Add',\n          toggle: this.toggleAdd,\n          isSelected: this.state.action === 'add',\n          disabled: this.state.isBusy,\n          className: 'msp-btn-apply-simple'\n        }, void 0), _jsx(ToggleButton, {\n          icon: TuneSvg,\n          label: '',\n          title: 'Options',\n          toggle: this.toggleOptions,\n          isSelected: this.state.action === 'options',\n          disabled: this.state.isBusy,\n          style: {\n            flex: '0 0 40px',\n            padding: 0\n          }\n        }, void 0)]\n      }), void 0), this.state.action === 'add' && this.add(), this.state.action === 'options' && _jsx(MeasurementsOptions, {}, void 0)]\n    }, void 0);\n  };\n\n  return MeasurementControls;\n}(PurePluginUIComponent);\n\nexport { MeasurementControls };\n\nvar MeasurementsOptions =\n/** @class */\nfunction (_super) {\n  __extends(MeasurementsOptions, _super);\n\n  function MeasurementsOptions() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      isDisabled: false\n    };\n\n    _this.changed = function (options) {\n      _this.plugin.managers.structure.measurement.setOptions(options);\n    };\n\n    return _this;\n  }\n\n  MeasurementsOptions.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.managers.structure.measurement.behaviors.state, function () {\n      _this.forceUpdate();\n    });\n    this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\n      _this.setState({\n        isDisabled: v\n      });\n    });\n  };\n\n  MeasurementsOptions.prototype.render = function () {\n    var measurements = this.plugin.managers.structure.measurement.state;\n    return _jsx(\"div\", __assign({\n      className: 'msp-control-offset'\n    }, {\n      children: _jsx(ParameterControls, {\n        params: StructureMeasurementParams,\n        values: measurements.options,\n        onChangeValues: this.changed,\n        isDisabled: this.state.isDisabled\n      }, void 0)\n    }), void 0);\n  };\n\n  return MeasurementsOptions;\n}(PurePluginUIComponent);\n\nvar MeasurementEntry =\n/** @class */\nfunction (_super) {\n  __extends(MeasurementEntry, _super);\n\n  function MeasurementEntry() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      showUpdate: false\n    };\n\n    _this.delete = function () {\n      PluginCommands.State.RemoveObject(_this.plugin, {\n        state: _this.props.cell.parent,\n        ref: _this.props.cell.transform.parent,\n        removeParentGhosts: true\n      });\n    };\n\n    _this.toggleVisibility = function (e) {\n      e.preventDefault();\n      PluginCommands.State.ToggleVisibility(_this.plugin, {\n        state: _this.props.cell.parent,\n        ref: _this.props.cell.transform.parent\n      });\n      e.currentTarget.blur();\n    };\n\n    _this.highlight = function () {\n      var _a;\n\n      var selections = _this.selections;\n      if (!selections) return;\n\n      _this.plugin.managers.interactivity.lociHighlights.clearHighlights();\n\n      for (var _b = 0, _c = _this.lociArray; _b < _c.length; _b++) {\n        var loci = _c[_b];\n\n        _this.plugin.managers.interactivity.lociHighlights.highlight({\n          loci: loci\n        }, false);\n      }\n\n      _this.plugin.managers.interactivity.lociHighlights.highlight({\n        loci: (_a = _this.props.cell.obj) === null || _a === void 0 ? void 0 : _a.data.repr.getLoci()\n      }, false);\n    };\n\n    _this.clearHighlight = function () {\n      _this.plugin.managers.interactivity.lociHighlights.clearHighlights();\n    };\n\n    _this.toggleUpdate = function () {\n      return _this.setState({\n        showUpdate: !_this.state.showUpdate\n      });\n    };\n\n    _this.focus = function () {\n      var selections = _this.selections;\n      if (!selections) return;\n      var sphere = Loci.getBundleBoundingSphere({\n        loci: _this.lociArray\n      });\n\n      if (sphere) {\n        _this.plugin.managers.camera.focusSphere(sphere);\n      }\n    };\n\n    _this.selectAction = function (item) {\n      if (!item) return;\n\n      _this.setState({\n        showUpdate: false\n      });\n\n      (item === null || item === void 0 ? void 0 : item.value)();\n    };\n\n    return _this;\n  }\n\n  MeasurementEntry.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.state.events.cell.stateUpdated, function (e) {\n      _this.forceUpdate();\n    });\n  };\n\n  Object.defineProperty(MeasurementEntry.prototype, \"selections\", {\n    get: function () {\n      var _a;\n\n      return (_a = this.props.cell.obj) === null || _a === void 0 ? void 0 : _a.data.sourceData;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MeasurementEntry.prototype, \"lociArray\", {\n    get: function () {\n      var selections = this.selections;\n      if (!selections) return [];\n      if (selections.infos) return [selections.infos[0].loci];\n      if (selections.pairs) return selections.pairs[0].loci;\n      if (selections.triples) return selections.triples[0].loci;\n      if (selections.quads) return selections.quads[0].loci;\n      return [];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MeasurementEntry.prototype, \"label\", {\n    get: function () {\n      var selections = this.selections;\n      if (!selections) return '<empty>';\n      if (selections.infos) return lociLabel(selections.infos[0].loci, {\n        condensed: true\n      });\n      if (selections.pairs) return distanceLabel(selections.pairs[0], {\n        condensed: true,\n        unitLabel: this.plugin.managers.structure.measurement.state.options.distanceUnitLabel\n      });\n      if (selections.triples) return angleLabel(selections.triples[0], {\n        condensed: true\n      });\n      if (selections.quads) return dihedralLabel(selections.quads[0], {\n        condensed: true\n      });\n      return '<empty>';\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MeasurementEntry.prototype, \"actions\", {\n    get: function () {\n      var _this = this;\n\n      this.props.cell.sourceRef;\n      return [ActionMenu.Item('Select This', function () {\n        return _this.plugin.managers.structure.selection.fromSelections(_this.props.cell.sourceRef);\n      }, {\n        icon: SetSvg\n      })];\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  MeasurementEntry.prototype.render = function () {\n    var cell = this.props.cell;\n    var obj = cell.obj;\n    if (!obj) return null;\n    return _jsxs(_Fragment, {\n      children: [_jsxs(\"div\", __assign({\n        className: 'msp-flex-row',\n        onMouseEnter: this.highlight,\n        onMouseLeave: this.clearHighlight\n      }, {\n        children: [_jsx(\"button\", __assign({\n          className: 'msp-form-control msp-control-button-label msp-no-overflow',\n          title: 'Click to focus. Hover to highlight.',\n          onClick: this.focus,\n          style: {\n            width: 'auto',\n            textAlign: 'left'\n          }\n        }, {\n          children: _jsx(\"span\", {\n            dangerouslySetInnerHTML: {\n              __html: this.label\n            }\n          }, void 0)\n        }), void 0), _jsx(IconButton, {\n          svg: cell.state.isHidden ? VisibilityOffOutlinedSvg : VisibilityOutlinedSvg,\n          toggleState: false,\n          small: true,\n          className: 'msp-form-control',\n          onClick: this.toggleVisibility,\n          flex: true,\n          title: cell.state.isHidden ? 'Show' : 'Hide'\n        }, void 0), _jsx(IconButton, {\n          svg: DeleteOutlinedSvg,\n          small: true,\n          className: 'msp-form-control',\n          onClick: this.delete,\n          flex: true,\n          title: 'Delete',\n          toggleState: false\n        }, void 0), _jsx(IconButton, {\n          svg: MoreHorizSvg,\n          className: 'msp-form-control',\n          onClick: this.toggleUpdate,\n          flex: true,\n          title: 'Actions',\n          toggleState: this.state.showUpdate\n        }, void 0)]\n      }), obj.id), this.state.showUpdate && cell.parent && _jsx(_Fragment, {\n        children: _jsxs(\"div\", __assign({\n          className: 'msp-accent-offset'\n        }, {\n          children: [_jsx(ActionMenu, {\n            items: this.actions,\n            onSelect: this.selectAction,\n            noOffset: true\n          }, void 0), _jsx(ExpandGroup, __assign({\n            header: 'Options',\n            noOffset: true\n          }, {\n            children: _jsx(UpdateTransformControl, {\n              state: cell.parent,\n              transform: cell.transform,\n              customHeader: 'none',\n              autoHideApply: true\n            }, void 0)\n          }), void 0)]\n        }), void 0)\n      }, void 0)]\n    }, void 0);\n  };\n\n  return MeasurementEntry;\n}(PurePluginUIComponent);","map":{"version":3,"sources":["../../../src/mol-plugin-ui/structure/measurements.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __extends } from \"tslib\";\r\nimport { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\r\nimport { Loci } from '../../mol-model/loci';\r\nimport { StructureMeasurementParams } from '../../mol-plugin-state/manager/structure/measurement';\r\nimport { PluginCommands } from '../../mol-plugin/commands';\r\nimport { angleLabel, dihedralLabel, distanceLabel, lociLabel } from '../../mol-theme/label';\r\nimport { CollapsableControls, PurePluginUIComponent } from '../base';\r\nimport { ActionMenu } from '../controls/action-menu';\r\nimport { Button, ExpandGroup, IconButton, ToggleButton } from '../controls/common';\r\nimport { AddSvg, ArrowDownwardSvg, ArrowUpwardSvg, DeleteOutlinedSvg, HelpOutlineSvg, Icon, MoreHorizSvg, PencilRulerSvg, SetSvg, TuneSvg, VisibilityOffOutlinedSvg, VisibilityOutlinedSvg } from '../controls/icons';\r\nimport { ParameterControls } from '../controls/parameters';\r\nimport { UpdateTransformControl } from '../state/update-transform';\r\nimport { ToggleSelectionModeButton } from './selection';\r\n// TODO details, options (e.g. change text for labels)\r\nvar StructureMeasurementsControls = /** @class */ (function (_super) {\r\n    __extends(StructureMeasurementsControls, _super);\r\n    function StructureMeasurementsControls() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    StructureMeasurementsControls.prototype.defaultState = function () {\r\n        return {\r\n            isCollapsed: false,\r\n            header: 'Measurements',\r\n            brand: { accent: 'gray', svg: PencilRulerSvg }\r\n        };\r\n    };\r\n    StructureMeasurementsControls.prototype.renderControls = function () {\r\n        return _jsxs(_Fragment, { children: [_jsx(MeasurementControls, {}, void 0), _jsx(MeasurementList, {}, void 0)] }, void 0);\r\n    };\r\n    return StructureMeasurementsControls;\r\n}(CollapsableControls));\r\nexport { StructureMeasurementsControls };\r\nvar MeasurementList = /** @class */ (function (_super) {\r\n    __extends(MeasurementList, _super);\r\n    function MeasurementList() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    MeasurementList.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.managers.structure.measurement.behaviors.state, function () {\r\n            _this.forceUpdate();\r\n        });\r\n    };\r\n    MeasurementList.prototype.renderGroup = function (cells, header) {\r\n        var group = [];\r\n        for (var _a = 0, cells_1 = cells; _a < cells_1.length; _a++) {\r\n            var cell = cells_1[_a];\r\n            if (cell.obj)\r\n                group.push(_jsx(MeasurementEntry, { cell: cell }, cell.obj.id));\r\n        }\r\n        return group.length ? _jsx(ExpandGroup, __assign({ header: header, initiallyExpanded: true }, { children: group }), void 0) : null;\r\n    };\r\n    MeasurementList.prototype.render = function () {\r\n        var measurements = this.plugin.managers.structure.measurement.state;\r\n        return _jsxs(\"div\", __assign({ style: { marginTop: '6px' } }, { children: [this.renderGroup(measurements.labels, 'Labels'), this.renderGroup(measurements.distances, 'Distances'), this.renderGroup(measurements.angles, 'Angles'), this.renderGroup(measurements.dihedrals, 'Dihedrals')] }), void 0);\r\n    };\r\n    return MeasurementList;\r\n}(PurePluginUIComponent));\r\nexport { MeasurementList };\r\nvar MeasurementControls = /** @class */ (function (_super) {\r\n    __extends(MeasurementControls, _super);\r\n    function MeasurementControls() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = { isBusy: false, action: void 0 };\r\n        _this.measureDistance = function () {\r\n            var loci = _this.plugin.managers.structure.selection.additionsHistory;\r\n            _this.plugin.managers.structure.measurement.addDistance(loci[0].loci, loci[1].loci);\r\n        };\r\n        _this.measureAngle = function () {\r\n            var loci = _this.plugin.managers.structure.selection.additionsHistory;\r\n            _this.plugin.managers.structure.measurement.addAngle(loci[0].loci, loci[1].loci, loci[2].loci);\r\n        };\r\n        _this.measureDihedral = function () {\r\n            var loci = _this.plugin.managers.structure.selection.additionsHistory;\r\n            _this.plugin.managers.structure.measurement.addDihedral(loci[0].loci, loci[1].loci, loci[2].loci, loci[3].loci);\r\n        };\r\n        _this.addLabel = function () {\r\n            var loci = _this.plugin.managers.structure.selection.additionsHistory;\r\n            _this.plugin.managers.structure.measurement.addLabel(loci[0].loci);\r\n        };\r\n        _this.selectAction = function (item) {\r\n            _this.toggleAdd();\r\n            if (!item)\r\n                return;\r\n            (item === null || item === void 0 ? void 0 : item.value)();\r\n        };\r\n        _this.toggleAdd = function () { return _this.setState({ action: _this.state.action === 'add' ? void 0 : 'add' }); };\r\n        _this.toggleOptions = function () { return _this.setState({ action: _this.state.action === 'options' ? void 0 : 'options' }); };\r\n        return _this;\r\n    }\r\n    MeasurementControls.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.selection.events.additionsHistoryUpdated, function () {\r\n            _this.forceUpdate();\r\n        });\r\n        this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\r\n            _this.setState({ isBusy: v });\r\n        });\r\n    };\r\n    Object.defineProperty(MeasurementControls.prototype, \"selection\", {\r\n        get: function () {\r\n            return this.plugin.managers.structure.selection;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MeasurementControls.prototype, \"actions\", {\r\n        get: function () {\r\n            var history = this.selection.additionsHistory;\r\n            var ret = [\r\n                { kind: 'item', label: \"Label \" + (history.length === 0 ? ' (1 selection required)' : ' (1st selection)'), value: this.addLabel, disabled: history.length === 0 },\r\n                { kind: 'item', label: \"Distance \" + (history.length < 2 ? ' (2 selections required)' : ' (top 2 selections)'), value: this.measureDistance, disabled: history.length < 2 },\r\n                { kind: 'item', label: \"Angle \" + (history.length < 3 ? ' (3 selections required)' : ' (top 3 selections)'), value: this.measureAngle, disabled: history.length < 3 },\r\n                { kind: 'item', label: \"Dihedral \" + (history.length < 4 ? ' (4 selections required)' : ' (top 4 selections)'), value: this.measureDihedral, disabled: history.length < 4 },\r\n            ];\r\n            return ret;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    MeasurementControls.prototype.highlight = function (loci) {\r\n        this.plugin.managers.interactivity.lociHighlights.highlightOnly({ loci: loci }, false);\r\n    };\r\n    MeasurementControls.prototype.moveHistory = function (e, direction) {\r\n        this.plugin.managers.structure.selection.modifyHistory(e, direction, 4);\r\n    };\r\n    MeasurementControls.prototype.focusLoci = function (loci) {\r\n        this.plugin.managers.camera.focusLoci(loci);\r\n    };\r\n    MeasurementControls.prototype.historyEntry = function (e, idx) {\r\n        var _this = this;\r\n        var history = this.plugin.managers.structure.selection.additionsHistory;\r\n        return _jsxs(\"div\", __assign({ className: 'msp-flex-row' }, { children: [_jsxs(Button, __assign({ noOverflow: true, title: 'Click to focus. Hover to highlight.', onClick: function () { return _this.focusLoci(e.loci); }, style: { width: 'auto', textAlign: 'left' }, onMouseEnter: function () { return _this.highlight(e.loci); }, onMouseLeave: function () { return _this.plugin.managers.interactivity.lociHighlights.clearHighlights(); } }, { children: [idx, \". \", _jsx(\"span\", { dangerouslySetInnerHTML: { __html: e.label } }, void 0)] }), void 0), history.length > 1 && _jsx(IconButton, { svg: ArrowUpwardSvg, small: true, className: 'msp-form-control', onClick: function () { return _this.moveHistory(e, 'up'); }, flex: '20px', title: 'Move up' }, void 0), history.length > 1 && _jsx(IconButton, { svg: ArrowDownwardSvg, small: true, className: 'msp-form-control', onClick: function () { return _this.moveHistory(e, 'down'); }, flex: '20px', title: 'Move down' }, void 0), _jsx(IconButton, { svg: DeleteOutlinedSvg, small: true, className: 'msp-form-control', onClick: function () { return _this.plugin.managers.structure.selection.modifyHistory(e, 'remove'); }, flex: true, title: 'Remove' }, void 0)] }), e.id);\r\n    };\r\n    MeasurementControls.prototype.add = function () {\r\n        var history = this.plugin.managers.structure.selection.additionsHistory;\r\n        var entries = [];\r\n        for (var i = 0, _i = Math.min(history.length, 4); i < _i; i++) {\r\n            entries.push(this.historyEntry(history[i], i + 1));\r\n        }\r\n        return _jsxs(_Fragment, { children: [_jsx(ActionMenu, { items: this.actions, onSelect: this.selectAction }, void 0), entries.length > 0 && _jsx(\"div\", __assign({ className: 'msp-control-offset' }, { children: entries }), void 0), entries.length === 0 && _jsx(\"div\", __assign({ className: 'msp-control-offset msp-help-text' }, { children: _jsxs(\"div\", __assign({ className: 'msp-help-description' }, { children: [_jsx(Icon, { svg: HelpOutlineSvg, inline: true }, void 0), \"Add one or more selections (toggle \", _jsx(ToggleSelectionModeButton, { inline: true }, void 0), \" mode)\"] }), void 0) }), void 0)] }, void 0);\r\n    };\r\n    MeasurementControls.prototype.render = function () {\r\n        return _jsxs(_Fragment, { children: [_jsxs(\"div\", __assign({ className: 'msp-flex-row' }, { children: [_jsx(ToggleButton, { icon: AddSvg, label: 'Add', toggle: this.toggleAdd, isSelected: this.state.action === 'add', disabled: this.state.isBusy, className: 'msp-btn-apply-simple' }, void 0), _jsx(ToggleButton, { icon: TuneSvg, label: '', title: 'Options', toggle: this.toggleOptions, isSelected: this.state.action === 'options', disabled: this.state.isBusy, style: { flex: '0 0 40px', padding: 0 } }, void 0)] }), void 0), this.state.action === 'add' && this.add(), this.state.action === 'options' && _jsx(MeasurementsOptions, {}, void 0)] }, void 0);\r\n    };\r\n    return MeasurementControls;\r\n}(PurePluginUIComponent));\r\nexport { MeasurementControls };\r\nvar MeasurementsOptions = /** @class */ (function (_super) {\r\n    __extends(MeasurementsOptions, _super);\r\n    function MeasurementsOptions() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = { isDisabled: false };\r\n        _this.changed = function (options) {\r\n            _this.plugin.managers.structure.measurement.setOptions(options);\r\n        };\r\n        return _this;\r\n    }\r\n    MeasurementsOptions.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.managers.structure.measurement.behaviors.state, function () {\r\n            _this.forceUpdate();\r\n        });\r\n        this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\r\n            _this.setState({ isDisabled: v });\r\n        });\r\n    };\r\n    MeasurementsOptions.prototype.render = function () {\r\n        var measurements = this.plugin.managers.structure.measurement.state;\r\n        return _jsx(\"div\", __assign({ className: 'msp-control-offset' }, { children: _jsx(ParameterControls, { params: StructureMeasurementParams, values: measurements.options, onChangeValues: this.changed, isDisabled: this.state.isDisabled }, void 0) }), void 0);\r\n    };\r\n    return MeasurementsOptions;\r\n}(PurePluginUIComponent));\r\nvar MeasurementEntry = /** @class */ (function (_super) {\r\n    __extends(MeasurementEntry, _super);\r\n    function MeasurementEntry() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = { showUpdate: false };\r\n        _this.delete = function () {\r\n            PluginCommands.State.RemoveObject(_this.plugin, { state: _this.props.cell.parent, ref: _this.props.cell.transform.parent, removeParentGhosts: true });\r\n        };\r\n        _this.toggleVisibility = function (e) {\r\n            e.preventDefault();\r\n            PluginCommands.State.ToggleVisibility(_this.plugin, { state: _this.props.cell.parent, ref: _this.props.cell.transform.parent });\r\n            e.currentTarget.blur();\r\n        };\r\n        _this.highlight = function () {\r\n            var _a;\r\n            var selections = _this.selections;\r\n            if (!selections)\r\n                return;\r\n            _this.plugin.managers.interactivity.lociHighlights.clearHighlights();\r\n            for (var _b = 0, _c = _this.lociArray; _b < _c.length; _b++) {\r\n                var loci = _c[_b];\r\n                _this.plugin.managers.interactivity.lociHighlights.highlight({ loci: loci }, false);\r\n            }\r\n            _this.plugin.managers.interactivity.lociHighlights.highlight({ loci: (_a = _this.props.cell.obj) === null || _a === void 0 ? void 0 : _a.data.repr.getLoci() }, false);\r\n        };\r\n        _this.clearHighlight = function () {\r\n            _this.plugin.managers.interactivity.lociHighlights.clearHighlights();\r\n        };\r\n        _this.toggleUpdate = function () { return _this.setState({ showUpdate: !_this.state.showUpdate }); };\r\n        _this.focus = function () {\r\n            var selections = _this.selections;\r\n            if (!selections)\r\n                return;\r\n            var sphere = Loci.getBundleBoundingSphere({ loci: _this.lociArray });\r\n            if (sphere) {\r\n                _this.plugin.managers.camera.focusSphere(sphere);\r\n            }\r\n        };\r\n        _this.selectAction = function (item) {\r\n            if (!item)\r\n                return;\r\n            _this.setState({ showUpdate: false });\r\n            (item === null || item === void 0 ? void 0 : item.value)();\r\n        };\r\n        return _this;\r\n    }\r\n    MeasurementEntry.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.state.events.cell.stateUpdated, function (e) {\r\n            _this.forceUpdate();\r\n        });\r\n    };\r\n    Object.defineProperty(MeasurementEntry.prototype, \"selections\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.props.cell.obj) === null || _a === void 0 ? void 0 : _a.data.sourceData;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MeasurementEntry.prototype, \"lociArray\", {\r\n        get: function () {\r\n            var selections = this.selections;\r\n            if (!selections)\r\n                return [];\r\n            if (selections.infos)\r\n                return [selections.infos[0].loci];\r\n            if (selections.pairs)\r\n                return selections.pairs[0].loci;\r\n            if (selections.triples)\r\n                return selections.triples[0].loci;\r\n            if (selections.quads)\r\n                return selections.quads[0].loci;\r\n            return [];\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MeasurementEntry.prototype, \"label\", {\r\n        get: function () {\r\n            var selections = this.selections;\r\n            if (!selections)\r\n                return '<empty>';\r\n            if (selections.infos)\r\n                return lociLabel(selections.infos[0].loci, { condensed: true });\r\n            if (selections.pairs)\r\n                return distanceLabel(selections.pairs[0], { condensed: true, unitLabel: this.plugin.managers.structure.measurement.state.options.distanceUnitLabel });\r\n            if (selections.triples)\r\n                return angleLabel(selections.triples[0], { condensed: true });\r\n            if (selections.quads)\r\n                return dihedralLabel(selections.quads[0], { condensed: true });\r\n            return '<empty>';\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MeasurementEntry.prototype, \"actions\", {\r\n        get: function () {\r\n            var _this = this;\r\n            this.props.cell.sourceRef;\r\n            return [ActionMenu.Item('Select This', function () { return _this.plugin.managers.structure.selection.fromSelections(_this.props.cell.sourceRef); }, { icon: SetSvg })];\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    MeasurementEntry.prototype.render = function () {\r\n        var cell = this.props.cell;\r\n        var obj = cell.obj;\r\n        if (!obj)\r\n            return null;\r\n        return _jsxs(_Fragment, { children: [_jsxs(\"div\", __assign({ className: 'msp-flex-row', onMouseEnter: this.highlight, onMouseLeave: this.clearHighlight }, { children: [_jsx(\"button\", __assign({ className: 'msp-form-control msp-control-button-label msp-no-overflow', title: 'Click to focus. Hover to highlight.', onClick: this.focus, style: { width: 'auto', textAlign: 'left' } }, { children: _jsx(\"span\", { dangerouslySetInnerHTML: { __html: this.label } }, void 0) }), void 0), _jsx(IconButton, { svg: cell.state.isHidden ? VisibilityOffOutlinedSvg : VisibilityOutlinedSvg, toggleState: false, small: true, className: 'msp-form-control', onClick: this.toggleVisibility, flex: true, title: cell.state.isHidden ? 'Show' : 'Hide' }, void 0), _jsx(IconButton, { svg: DeleteOutlinedSvg, small: true, className: 'msp-form-control', onClick: this.delete, flex: true, title: 'Delete', toggleState: false }, void 0), _jsx(IconButton, { svg: MoreHorizSvg, className: 'msp-form-control', onClick: this.toggleUpdate, flex: true, title: 'Actions', toggleState: this.state.showUpdate }, void 0)] }), obj.id), this.state.showUpdate && cell.parent && _jsx(_Fragment, { children: _jsxs(\"div\", __assign({ className: 'msp-accent-offset' }, { children: [_jsx(ActionMenu, { items: this.actions, onSelect: this.selectAction, noOffset: true }, void 0), _jsx(ExpandGroup, __assign({ header: 'Options', noOffset: true }, { children: _jsx(UpdateTransformControl, { state: cell.parent, transform: cell.transform, customHeader: 'none', autoHideApply: true }, void 0) }), void 0)] }), void 0) }, void 0)] }, void 0);\r\n    };\r\n    return MeasurementEntry;\r\n}(PurePluginUIComponent));\r\n//# sourceMappingURL=measurements.js.map"]},"metadata":{},"sourceType":"module"}