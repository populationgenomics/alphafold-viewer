{"ast":null,"code":"import { __assign, __awaiter, __extends, __generator, __spreadArray } from \"tslib\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\n/**\r\n * Copyright (c) 2020-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\n\nimport { Model } from '../../mol-model/structure';\nimport { StateTransforms } from '../../mol-plugin-state/transforms';\nimport { StateSelection } from '../../mol-state';\nimport { CollapsableControls } from '../base';\nimport { ActionMenu } from '../controls/action-menu';\nimport { Button, ExpandGroup, IconButton } from '../controls/common';\nimport { BookmarksOutlinedSvg, MoleculeSvg } from '../controls/icons';\nimport { ParameterControls } from '../controls/parameters';\nimport { UpdateTransformControl } from '../state/update-transform';\nimport { StructureFocusControls } from './focus';\nimport { StructureSelectionStatsControls } from './selection';\n\nvar StructureSourceControls =\n/** @class */\nfunction (_super) {\n  __extends(StructureSourceControls, _super);\n\n  function StructureSourceControls() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.item = function (ref) {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n\n      var selected = _this.plugin.managers.structure.hierarchy.seletionSet;\n      var label;\n\n      switch (ref.kind) {\n        case 'model':\n          {\n            var model = (_a = ref.cell.obj) === null || _a === void 0 ? void 0 : _a.data;\n\n            if (model && Model.TrajectoryInfo.get(model).size > 1) {\n              label = ((_b = ref.cell.obj) === null || _b === void 0 ? void 0 : _b.data.entryId) + \" | Model \" + (Model.TrajectoryInfo.get(model).index + 1) + \" of \" + Model.TrajectoryInfo.get(model).size;\n            }\n\n            label = ((_c = ref.cell.obj) === null || _c === void 0 ? void 0 : _c.data.entryId) + \" | \" + ((_d = ref.cell.obj) === null || _d === void 0 ? void 0 : _d.label);\n            break;\n          }\n\n        case 'structure':\n          {\n            var model = (_e = ref.cell.obj) === null || _e === void 0 ? void 0 : _e.data.models[0];\n\n            if (model && Model.TrajectoryInfo.get(model).size > 1) {\n              label = model.entryId + \" | \" + ((_f = ref.cell.obj) === null || _f === void 0 ? void 0 : _f.label) + \" (Model \" + (Model.TrajectoryInfo.get(model).index + 1) + \" of \" + Model.TrajectoryInfo.get(model).size + \")\";\n              break;\n            } else if (model) {\n              label = model.entryId + \" | \" + ((_g = ref.cell.obj) === null || _g === void 0 ? void 0 : _g.label);\n              break;\n            } else {\n              label = \"\" + ((_h = ref.cell.obj) === null || _h === void 0 ? void 0 : _h.label);\n              break;\n            }\n          }\n\n        default:\n          label = (_j = ref.cell.obj) === null || _j === void 0 ? void 0 : _j.label;\n          break;\n      }\n\n      var item = {\n        kind: 'item',\n        label: label || ref.kind,\n        selected: selected.has(ref.cell.transform.ref),\n        value: [ref]\n      };\n      return item;\n    };\n\n    _this.getTrajectoryItems = function (t) {\n      var _a;\n\n      if (t.models.length === 0) return _this.item(t);\n      return __spreadArray([ActionMenu.Header((_a = t.cell.obj) === null || _a === void 0 ? void 0 : _a.label)], t.models.map(_this.getModelItems), true);\n    };\n\n    _this.getModelItems = function (m) {\n      var _a, _b, _c;\n\n      if (m.structures.length === 0) return _this.item(m);\n\n      if (m.structures.length === 1) {\n        var selected = _this.plugin.managers.structure.hierarchy.seletionSet;\n        var ref = m.structures[0];\n        return {\n          label: ((_a = m.cell.obj) === null || _a === void 0 ? void 0 : _a.label) + \" | \" + ((_b = ref.cell.obj) === null || _b === void 0 ? void 0 : _b.label),\n          selected: selected.has(ref.cell.transform.ref),\n          value: [m, ref]\n        };\n      }\n\n      return __spreadArray([ActionMenu.Header((_c = m.cell.obj) === null || _c === void 0 ? void 0 : _c.label)], m.structures.map(_this.item), true);\n    };\n\n    _this.selectHierarchy = function (items) {\n      if (!items || items.length === 0) return;\n      var refs = [];\n\n      for (var _i = 0, items_1 = items; _i < items_1.length; _i++) {\n        var i = items_1[_i];\n\n        for (var _a = 0, _b = i.value; _a < _b.length; _a++) {\n          var r = _b[_a];\n          refs.push(r);\n        }\n      }\n\n      _this.plugin.managers.structure.hierarchy.updateCurrent(refs, items[0].selected ? 'remove' : 'add');\n    };\n\n    _this.toggleHierarchy = function () {\n      return _this.setState({\n        show: _this.state.show !== 'hierarchy' ? 'hierarchy' : void 0\n      });\n    };\n\n    _this.togglePreset = function () {\n      return _this.setState({\n        show: _this.state.show !== 'presets' ? 'presets' : void 0\n      });\n    };\n\n    _this.applyPreset = function (item) {\n      _this.setState({\n        show: void 0\n      });\n\n      if (!item) return;\n      var mng = _this.plugin.managers.structure;\n      var trajectories = mng.hierarchy.selection.trajectories;\n      mng.hierarchy.applyPreset(trajectories, item.value);\n    };\n\n    _this.updateModelQueueParams = void 0;\n    _this.isUpdatingModel = false;\n\n    _this.updateStructureModel = function (params) {\n      _this.updateModelQueueParams = params;\n\n      _this._updateStructureModel();\n    };\n\n    _this.updateStructure = function (params) {\n      var selection = _this.plugin.managers.structure.hierarchy.selection;\n      var s = selection.structures[0];\n      return _this.plugin.managers.structure.hierarchy.updateStructure(s, params);\n    };\n\n    return _this;\n  }\n\n  StructureSourceControls.prototype.defaultState = function () {\n    return {\n      header: 'Structure',\n      isCollapsed: false,\n      isBusy: false,\n      brand: {\n        accent: 'purple',\n        svg: MoleculeSvg\n      }\n    };\n  };\n\n  StructureSourceControls.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection, function () {\n      return _this.forceUpdate();\n    });\n    this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\n      _this.setState({\n        isBusy: v\n      });\n    });\n  };\n\n  Object.defineProperty(StructureSourceControls.prototype, \"hierarchyItems\", {\n    get: function () {\n      var mng = this.plugin.managers.structure.hierarchy;\n      var current = mng.current;\n      var ret = [];\n\n      if (current.trajectories.length > 1) {\n        ret.push(__spreadArray([ActionMenu.Header('Trajectories')], current.trajectories.map(this.item), true));\n      }\n\n      if (current.models.length > 1 || current.trajectories.length > 1) {\n        ret.push(__spreadArray([ActionMenu.Header('Models')], current.models.map(this.item), true));\n      }\n\n      if (current.trajectories.length === 1 && current.models.length === 1) {\n        ret.push.apply(ret, current.structures.map(this.item));\n      } else if (current.structures.length > 0) {\n        ret.push(__spreadArray([ActionMenu.Header('Structures')], current.structures.map(this.item), true));\n      }\n\n      return ret;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StructureSourceControls.prototype, \"isEmpty\", {\n    get: function () {\n      var _a = this.plugin.managers.structure.hierarchy.current,\n          structures = _a.structures,\n          models = _a.models,\n          trajectories = _a.trajectories;\n      return trajectories.length === 0 && models.length === 0 && structures.length === 0;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StructureSourceControls.prototype, \"label\", {\n    get: function () {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;\n\n      var _q = this.plugin.managers.structure.hierarchy.selection,\n          structures = _q.structures,\n          models = _q.models,\n          trajectories = _q.trajectories;\n\n      if (structures.length === 1) {\n        var s = structures[0];\n        if (((_b = (_a = s.model) === null || _a === void 0 ? void 0 : _a.trajectory) === null || _b === void 0 ? void 0 : _b.models) && s.model.trajectory.models.length === 1) return (_c = s.cell.obj) === null || _c === void 0 ? void 0 : _c.data.label;\n        if (s.model) return ((_d = s.model.cell.obj) === null || _d === void 0 ? void 0 : _d.label) + \" | \" + ((_e = s.cell.obj) === null || _e === void 0 ? void 0 : _e.data.label);\n        return (_f = s.cell.obj) === null || _f === void 0 ? void 0 : _f.data.label;\n      }\n\n      if (structures.length > 1) {\n        var p = structures[0];\n        var t = (_g = p === null || p === void 0 ? void 0 : p.model) === null || _g === void 0 ? void 0 : _g.trajectory;\n        var sameTraj = true;\n\n        for (var _i = 0, structures_1 = structures; _i < structures_1.length; _i++) {\n          var s = structures_1[_i];\n\n          if (((_h = s === null || s === void 0 ? void 0 : s.model) === null || _h === void 0 ? void 0 : _h.trajectory) !== t) {\n            sameTraj = false;\n            break;\n          }\n        }\n\n        return sameTraj && t ? ((_j = t.cell.obj) === null || _j === void 0 ? void 0 : _j.label) + \" | \" + structures.length + \" structures\" : structures.length + \" structures\";\n      }\n\n      if (models.length > 0) {\n        var t = models[0].trajectory;\n\n        if (models.length === 1) {\n          var model = (_k = models[0].cell.obj) === null || _k === void 0 ? void 0 : _k.data;\n\n          if (model && Model.TrajectoryInfo.get(model).size > 1) {\n            return ((_l = t === null || t === void 0 ? void 0 : t.cell.obj) === null || _l === void 0 ? void 0 : _l.label) + \" | Model \" + (Model.TrajectoryInfo.get(model).index + 1) + \" of \" + Model.TrajectoryInfo.get(model).size;\n          } else {\n            return ((_m = t === null || t === void 0 ? void 0 : t.cell.obj) === null || _m === void 0 ? void 0 : _m.label) + \" | Model\";\n          }\n        }\n\n        var sameTraj = true;\n\n        for (var _r = 0, models_1 = models; _r < models_1.length; _r++) {\n          var m = models_1[_r];\n\n          if (m.trajectory !== t) {\n            sameTraj = false;\n            break;\n          }\n        }\n\n        return sameTraj ? ((_o = t === null || t === void 0 ? void 0 : t.cell.obj) === null || _o === void 0 ? void 0 : _o.label) + \" | \" + models.length + \" models\" : models.length + \" models\";\n      }\n\n      if (trajectories.length > 0) {\n        return trajectories.length === 1 ? ((_p = trajectories[0].cell.obj) === null || _p === void 0 ? void 0 : _p.label) + \" trajectory\" : trajectories.length + \" trajectories\";\n      }\n\n      if (trajectories.length === 0 && models.length === 0 && structures.length === 0) {\n        return 'Nothing Loaded';\n      }\n\n      return 'Nothing Selected';\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StructureSourceControls.prototype, \"presetActions\", {\n    get: function () {\n      var actions = [];\n      var trajectories = this.plugin.managers.structure.hierarchy.selection.trajectories;\n      if (trajectories.length === 0) return actions;\n      var providers = this.plugin.builders.structure.hierarchy.getPresets(trajectories[0].cell.obj);\n\n      if (trajectories.length > 1) {\n        var providerSet_1 = new Set(providers);\n\n        for (var i = 1; i < trajectories.length; i++) {\n          var providers_3 = this.plugin.builders.structure.hierarchy.getPresets(trajectories[i].cell.obj);\n          var current = new Set(providers_3);\n\n          for (var _i = 0, providers_1 = providers_3; _i < providers_1.length; _i++) {\n            var p = providers_1[_i];\n            if (!current.has(p)) providerSet_1.delete(p);\n          }\n        }\n\n        providers = providers.filter(function (p) {\n          return providerSet_1.has(p);\n        });\n      }\n\n      for (var _a = 0, providers_2 = providers; _a < providers_2.length; _a++) {\n        var p = providers_2[_a];\n        actions.push(ActionMenu.Item(p.display.name, p, {\n          description: p.display.description\n        }));\n      }\n\n      return actions;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StructureSourceControls.prototype._updateStructureModel = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var params, selection, m;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this.updateModelQueueParams || this.isUpdatingModel) return [2\n            /*return*/\n            ];\n            params = this.updateModelQueueParams;\n            this.updateModelQueueParams = void 0;\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1,, 3, 4]);\n\n            this.isUpdatingModel = true;\n            selection = this.plugin.managers.structure.hierarchy.selection;\n            m = selection.structures[0].model;\n            return [4\n            /*yield*/\n            , this.plugin.state.updateTransform(this.plugin.state.data, m.cell.transform.ref, params, 'Model Index')];\n\n          case 2:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            this.isUpdatingModel = false;\n\n            this._updateStructureModel();\n\n            return [7\n            /*endfinally*/\n            ];\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  Object.defineProperty(StructureSourceControls.prototype, \"modelIndex\", {\n    get: function () {\n      var _a, _b;\n\n      var selection = this.plugin.managers.structure.hierarchy.selection;\n      if (selection.structures.length !== 1) return null;\n      var m = selection.structures[0].model;\n      if (!m || m.cell.transform.transformer !== StateTransforms.Model.ModelFromTrajectory) return null;\n      if (!m.cell.obj || Model.TrajectoryInfo.get(m.cell.obj.data).size <= 1) return null;\n      var params = (_a = m.cell.params) === null || _a === void 0 ? void 0 : _a.definition;\n      if (!params) return null;\n      return _jsx(ParameterControls, {\n        params: params,\n        values: (_b = m.cell.params) === null || _b === void 0 ? void 0 : _b.values,\n        onChangeValues: this.updateStructureModel,\n        isDisabled: this.state.isBusy\n      }, void 0);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StructureSourceControls.prototype, \"structureType\", {\n    get: function () {\n      var _a;\n\n      var selection = this.plugin.managers.structure.hierarchy.selection;\n      if (selection.structures.length !== 1) return null;\n      var s = selection.structures[0];\n      var params = (_a = s.cell.params) === null || _a === void 0 ? void 0 : _a.definition;\n      if (!params || !s.cell.parent) return null;\n      return _jsx(UpdateTransformControl, {\n        state: s.cell.parent,\n        transform: s.cell.transform,\n        customHeader: 'none',\n        customUpdate: this.updateStructure,\n        noMargin: true,\n        autoHideApply: true\n      }, void 0);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StructureSourceControls.prototype, \"transform\", {\n    get: function () {\n      var selection = this.plugin.managers.structure.hierarchy.selection;\n      if (selection.structures.length !== 1) return null;\n      var pivot = selection.structures[0];\n      if (!pivot.cell.parent) return null;\n      var t = StateSelection.tryFindDecorator(this.plugin.state.data, pivot.cell.transform.ref, StateTransforms.Model.TransformStructureConformation);\n      if (!t) return;\n      return _jsx(ExpandGroup, __assign({\n        header: \"Conformation Transform\"\n      }, {\n        children: _jsx(UpdateTransformControl, {\n          state: t.parent,\n          transform: t.transform,\n          customHeader: 'none',\n          noMargin: true,\n          autoHideApply: true\n        }, void 0)\n      }), void 0);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StructureSourceControls.prototype.renderControls = function () {\n    var disabled = this.state.isBusy || this.isEmpty;\n    var presets = this.presetActions;\n    var label = this.label;\n    return _jsxs(_Fragment, {\n      children: [_jsxs(\"div\", __assign({\n        className: 'msp-flex-row',\n        style: {\n          marginTop: '1px'\n        }\n      }, {\n        children: [_jsx(Button, __assign({\n          noOverflow: true,\n          flex: true,\n          onClick: this.toggleHierarchy,\n          disabled: disabled,\n          title: label\n        }, {\n          children: label\n        }), void 0), presets.length > 0 && _jsx(IconButton, {\n          svg: BookmarksOutlinedSvg,\n          className: 'msp-form-control',\n          flex: '40px',\n          onClick: this.togglePreset,\n          title: 'Apply a structure presets to the current hierarchy.',\n          toggleState: this.state.show === 'presets',\n          disabled: disabled\n        }, void 0)]\n      }), void 0), this.state.show === 'hierarchy' && _jsx(ActionMenu, {\n        items: this.hierarchyItems,\n        onSelect: this.selectHierarchy,\n        multiselect: true\n      }, void 0), this.state.show === 'presets' && _jsx(ActionMenu, {\n        items: presets,\n        onSelect: this.applyPreset\n      }, void 0), this.modelIndex, this.structureType, this.transform, _jsxs(\"div\", __assign({\n        style: {\n          marginTop: '6px'\n        }\n      }, {\n        children: [_jsx(StructureFocusControls, {}, void 0), _jsx(StructureSelectionStatsControls, {\n          hideOnEmpty: true\n        }, void 0)]\n      }), void 0)]\n    }, void 0);\n  };\n\n  return StructureSourceControls;\n}(CollapsableControls);\n\nexport { StructureSourceControls };","map":{"version":3,"sources":["../../../src/mol-plugin-ui/structure/source.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __awaiter, __extends, __generator, __spreadArray } from \"tslib\";\r\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\r\n/**\r\n * Copyright (c) 2020-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { Model } from '../../mol-model/structure';\r\nimport { StateTransforms } from '../../mol-plugin-state/transforms';\r\nimport { StateSelection } from '../../mol-state';\r\nimport { CollapsableControls } from '../base';\r\nimport { ActionMenu } from '../controls/action-menu';\r\nimport { Button, ExpandGroup, IconButton } from '../controls/common';\r\nimport { BookmarksOutlinedSvg, MoleculeSvg } from '../controls/icons';\r\nimport { ParameterControls } from '../controls/parameters';\r\nimport { UpdateTransformControl } from '../state/update-transform';\r\nimport { StructureFocusControls } from './focus';\r\nimport { StructureSelectionStatsControls } from './selection';\r\nvar StructureSourceControls = /** @class */ (function (_super) {\r\n    __extends(StructureSourceControls, _super);\r\n    function StructureSourceControls() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.item = function (ref) {\r\n            var _a, _b, _c, _d, _e, _f, _g, _h, _j;\r\n            var selected = _this.plugin.managers.structure.hierarchy.seletionSet;\r\n            var label;\r\n            switch (ref.kind) {\r\n                case 'model': {\r\n                    var model = (_a = ref.cell.obj) === null || _a === void 0 ? void 0 : _a.data;\r\n                    if (model && Model.TrajectoryInfo.get(model).size > 1) {\r\n                        label = ((_b = ref.cell.obj) === null || _b === void 0 ? void 0 : _b.data.entryId) + \" | Model \" + (Model.TrajectoryInfo.get(model).index + 1) + \" of \" + Model.TrajectoryInfo.get(model).size;\r\n                    }\r\n                    label = ((_c = ref.cell.obj) === null || _c === void 0 ? void 0 : _c.data.entryId) + \" | \" + ((_d = ref.cell.obj) === null || _d === void 0 ? void 0 : _d.label);\r\n                    break;\r\n                }\r\n                case 'structure': {\r\n                    var model = (_e = ref.cell.obj) === null || _e === void 0 ? void 0 : _e.data.models[0];\r\n                    if (model && Model.TrajectoryInfo.get(model).size > 1) {\r\n                        label = model.entryId + \" | \" + ((_f = ref.cell.obj) === null || _f === void 0 ? void 0 : _f.label) + \" (Model \" + (Model.TrajectoryInfo.get(model).index + 1) + \" of \" + Model.TrajectoryInfo.get(model).size + \")\";\r\n                        break;\r\n                    }\r\n                    else if (model) {\r\n                        label = model.entryId + \" | \" + ((_g = ref.cell.obj) === null || _g === void 0 ? void 0 : _g.label);\r\n                        break;\r\n                    }\r\n                    else {\r\n                        label = \"\" + ((_h = ref.cell.obj) === null || _h === void 0 ? void 0 : _h.label);\r\n                        break;\r\n                    }\r\n                }\r\n                default:\r\n                    label = (_j = ref.cell.obj) === null || _j === void 0 ? void 0 : _j.label;\r\n                    break;\r\n            }\r\n            var item = { kind: 'item', label: label || ref.kind, selected: selected.has(ref.cell.transform.ref), value: [ref] };\r\n            return item;\r\n        };\r\n        _this.getTrajectoryItems = function (t) {\r\n            var _a;\r\n            if (t.models.length === 0)\r\n                return _this.item(t);\r\n            return __spreadArray([ActionMenu.Header((_a = t.cell.obj) === null || _a === void 0 ? void 0 : _a.label)], t.models.map(_this.getModelItems), true);\r\n        };\r\n        _this.getModelItems = function (m) {\r\n            var _a, _b, _c;\r\n            if (m.structures.length === 0)\r\n                return _this.item(m);\r\n            if (m.structures.length === 1) {\r\n                var selected = _this.plugin.managers.structure.hierarchy.seletionSet;\r\n                var ref = m.structures[0];\r\n                return { label: ((_a = m.cell.obj) === null || _a === void 0 ? void 0 : _a.label) + \" | \" + ((_b = ref.cell.obj) === null || _b === void 0 ? void 0 : _b.label), selected: selected.has(ref.cell.transform.ref), value: [m, ref] };\r\n            }\r\n            return __spreadArray([ActionMenu.Header((_c = m.cell.obj) === null || _c === void 0 ? void 0 : _c.label)], m.structures.map(_this.item), true);\r\n        };\r\n        _this.selectHierarchy = function (items) {\r\n            if (!items || items.length === 0)\r\n                return;\r\n            var refs = [];\r\n            for (var _i = 0, items_1 = items; _i < items_1.length; _i++) {\r\n                var i = items_1[_i];\r\n                for (var _a = 0, _b = i.value; _a < _b.length; _a++) {\r\n                    var r = _b[_a];\r\n                    refs.push(r);\r\n                }\r\n            }\r\n            _this.plugin.managers.structure.hierarchy.updateCurrent(refs, items[0].selected ? 'remove' : 'add');\r\n        };\r\n        _this.toggleHierarchy = function () { return _this.setState({ show: _this.state.show !== 'hierarchy' ? 'hierarchy' : void 0 }); };\r\n        _this.togglePreset = function () { return _this.setState({ show: _this.state.show !== 'presets' ? 'presets' : void 0 }); };\r\n        _this.applyPreset = function (item) {\r\n            _this.setState({ show: void 0 });\r\n            if (!item)\r\n                return;\r\n            var mng = _this.plugin.managers.structure;\r\n            var trajectories = mng.hierarchy.selection.trajectories;\r\n            mng.hierarchy.applyPreset(trajectories, item.value);\r\n        };\r\n        _this.updateModelQueueParams = void 0;\r\n        _this.isUpdatingModel = false;\r\n        _this.updateStructureModel = function (params) {\r\n            _this.updateModelQueueParams = params;\r\n            _this._updateStructureModel();\r\n        };\r\n        _this.updateStructure = function (params) {\r\n            var selection = _this.plugin.managers.structure.hierarchy.selection;\r\n            var s = selection.structures[0];\r\n            return _this.plugin.managers.structure.hierarchy.updateStructure(s, params);\r\n        };\r\n        return _this;\r\n    }\r\n    StructureSourceControls.prototype.defaultState = function () {\r\n        return {\r\n            header: 'Structure',\r\n            isCollapsed: false,\r\n            isBusy: false,\r\n            brand: { accent: 'purple', svg: MoleculeSvg }\r\n        };\r\n    };\r\n    StructureSourceControls.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection, function () { return _this.forceUpdate(); });\r\n        this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\r\n            _this.setState({ isBusy: v });\r\n        });\r\n    };\r\n    Object.defineProperty(StructureSourceControls.prototype, \"hierarchyItems\", {\r\n        get: function () {\r\n            var mng = this.plugin.managers.structure.hierarchy;\r\n            var current = mng.current;\r\n            var ret = [];\r\n            if (current.trajectories.length > 1) {\r\n                ret.push(__spreadArray([\r\n                    ActionMenu.Header('Trajectories')\r\n                ], current.trajectories.map(this.item), true));\r\n            }\r\n            if (current.models.length > 1 || current.trajectories.length > 1) {\r\n                ret.push(__spreadArray([\r\n                    ActionMenu.Header('Models')\r\n                ], current.models.map(this.item), true));\r\n            }\r\n            if (current.trajectories.length === 1 && current.models.length === 1) {\r\n                ret.push.apply(ret, current.structures.map(this.item));\r\n            }\r\n            else if (current.structures.length > 0) {\r\n                ret.push(__spreadArray([\r\n                    ActionMenu.Header('Structures')\r\n                ], current.structures.map(this.item), true));\r\n            }\r\n            return ret;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(StructureSourceControls.prototype, \"isEmpty\", {\r\n        get: function () {\r\n            var _a = this.plugin.managers.structure.hierarchy.current, structures = _a.structures, models = _a.models, trajectories = _a.trajectories;\r\n            return trajectories.length === 0 && models.length === 0 && structures.length === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(StructureSourceControls.prototype, \"label\", {\r\n        get: function () {\r\n            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;\r\n            var _q = this.plugin.managers.structure.hierarchy.selection, structures = _q.structures, models = _q.models, trajectories = _q.trajectories;\r\n            if (structures.length === 1) {\r\n                var s = structures[0];\r\n                if (((_b = (_a = s.model) === null || _a === void 0 ? void 0 : _a.trajectory) === null || _b === void 0 ? void 0 : _b.models) && s.model.trajectory.models.length === 1)\r\n                    return (_c = s.cell.obj) === null || _c === void 0 ? void 0 : _c.data.label;\r\n                if (s.model)\r\n                    return ((_d = s.model.cell.obj) === null || _d === void 0 ? void 0 : _d.label) + \" | \" + ((_e = s.cell.obj) === null || _e === void 0 ? void 0 : _e.data.label);\r\n                return (_f = s.cell.obj) === null || _f === void 0 ? void 0 : _f.data.label;\r\n            }\r\n            if (structures.length > 1) {\r\n                var p = structures[0];\r\n                var t = (_g = p === null || p === void 0 ? void 0 : p.model) === null || _g === void 0 ? void 0 : _g.trajectory;\r\n                var sameTraj = true;\r\n                for (var _i = 0, structures_1 = structures; _i < structures_1.length; _i++) {\r\n                    var s = structures_1[_i];\r\n                    if (((_h = s === null || s === void 0 ? void 0 : s.model) === null || _h === void 0 ? void 0 : _h.trajectory) !== t) {\r\n                        sameTraj = false;\r\n                        break;\r\n                    }\r\n                }\r\n                return sameTraj && t ? ((_j = t.cell.obj) === null || _j === void 0 ? void 0 : _j.label) + \" | \" + structures.length + \" structures\" : structures.length + \" structures\";\r\n            }\r\n            if (models.length > 0) {\r\n                var t = models[0].trajectory;\r\n                if (models.length === 1) {\r\n                    var model = (_k = models[0].cell.obj) === null || _k === void 0 ? void 0 : _k.data;\r\n                    if (model && Model.TrajectoryInfo.get(model).size > 1) {\r\n                        return ((_l = t === null || t === void 0 ? void 0 : t.cell.obj) === null || _l === void 0 ? void 0 : _l.label) + \" | Model \" + (Model.TrajectoryInfo.get(model).index + 1) + \" of \" + Model.TrajectoryInfo.get(model).size;\r\n                    }\r\n                    else {\r\n                        return ((_m = t === null || t === void 0 ? void 0 : t.cell.obj) === null || _m === void 0 ? void 0 : _m.label) + \" | Model\";\r\n                    }\r\n                }\r\n                var sameTraj = true;\r\n                for (var _r = 0, models_1 = models; _r < models_1.length; _r++) {\r\n                    var m = models_1[_r];\r\n                    if (m.trajectory !== t) {\r\n                        sameTraj = false;\r\n                        break;\r\n                    }\r\n                }\r\n                return sameTraj ? ((_o = t === null || t === void 0 ? void 0 : t.cell.obj) === null || _o === void 0 ? void 0 : _o.label) + \" | \" + models.length + \" models\" : models.length + \" models\";\r\n            }\r\n            if (trajectories.length > 0) {\r\n                return trajectories.length === 1 ? ((_p = trajectories[0].cell.obj) === null || _p === void 0 ? void 0 : _p.label) + \" trajectory\" : trajectories.length + \" trajectories\";\r\n            }\r\n            if (trajectories.length === 0 && models.length === 0 && structures.length === 0) {\r\n                return 'Nothing Loaded';\r\n            }\r\n            return 'Nothing Selected';\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(StructureSourceControls.prototype, \"presetActions\", {\r\n        get: function () {\r\n            var actions = [];\r\n            var trajectories = this.plugin.managers.structure.hierarchy.selection.trajectories;\r\n            if (trajectories.length === 0)\r\n                return actions;\r\n            var providers = this.plugin.builders.structure.hierarchy.getPresets(trajectories[0].cell.obj);\r\n            if (trajectories.length > 1) {\r\n                var providerSet_1 = new Set(providers);\r\n                for (var i = 1; i < trajectories.length; i++) {\r\n                    var providers_3 = this.plugin.builders.structure.hierarchy.getPresets(trajectories[i].cell.obj);\r\n                    var current = new Set(providers_3);\r\n                    for (var _i = 0, providers_1 = providers_3; _i < providers_1.length; _i++) {\r\n                        var p = providers_1[_i];\r\n                        if (!current.has(p))\r\n                            providerSet_1.delete(p);\r\n                    }\r\n                }\r\n                providers = providers.filter(function (p) { return providerSet_1.has(p); });\r\n            }\r\n            for (var _a = 0, providers_2 = providers; _a < providers_2.length; _a++) {\r\n                var p = providers_2[_a];\r\n                actions.push(ActionMenu.Item(p.display.name, p, { description: p.display.description }));\r\n            }\r\n            return actions;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StructureSourceControls.prototype._updateStructureModel = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var params, selection, m;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.updateModelQueueParams || this.isUpdatingModel)\r\n                            return [2 /*return*/];\r\n                        params = this.updateModelQueueParams;\r\n                        this.updateModelQueueParams = void 0;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, , 3, 4]);\r\n                        this.isUpdatingModel = true;\r\n                        selection = this.plugin.managers.structure.hierarchy.selection;\r\n                        m = selection.structures[0].model;\r\n                        return [4 /*yield*/, this.plugin.state.updateTransform(this.plugin.state.data, m.cell.transform.ref, params, 'Model Index')];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        this.isUpdatingModel = false;\r\n                        this._updateStructureModel();\r\n                        return [7 /*endfinally*/];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Object.defineProperty(StructureSourceControls.prototype, \"modelIndex\", {\r\n        get: function () {\r\n            var _a, _b;\r\n            var selection = this.plugin.managers.structure.hierarchy.selection;\r\n            if (selection.structures.length !== 1)\r\n                return null;\r\n            var m = selection.structures[0].model;\r\n            if (!m || m.cell.transform.transformer !== StateTransforms.Model.ModelFromTrajectory)\r\n                return null;\r\n            if (!m.cell.obj || Model.TrajectoryInfo.get(m.cell.obj.data).size <= 1)\r\n                return null;\r\n            var params = (_a = m.cell.params) === null || _a === void 0 ? void 0 : _a.definition;\r\n            if (!params)\r\n                return null;\r\n            return _jsx(ParameterControls, { params: params, values: (_b = m.cell.params) === null || _b === void 0 ? void 0 : _b.values, onChangeValues: this.updateStructureModel, isDisabled: this.state.isBusy }, void 0);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(StructureSourceControls.prototype, \"structureType\", {\r\n        get: function () {\r\n            var _a;\r\n            var selection = this.plugin.managers.structure.hierarchy.selection;\r\n            if (selection.structures.length !== 1)\r\n                return null;\r\n            var s = selection.structures[0];\r\n            var params = (_a = s.cell.params) === null || _a === void 0 ? void 0 : _a.definition;\r\n            if (!params || !s.cell.parent)\r\n                return null;\r\n            return _jsx(UpdateTransformControl, { state: s.cell.parent, transform: s.cell.transform, customHeader: 'none', customUpdate: this.updateStructure, noMargin: true, autoHideApply: true }, void 0);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(StructureSourceControls.prototype, \"transform\", {\r\n        get: function () {\r\n            var selection = this.plugin.managers.structure.hierarchy.selection;\r\n            if (selection.structures.length !== 1)\r\n                return null;\r\n            var pivot = selection.structures[0];\r\n            if (!pivot.cell.parent)\r\n                return null;\r\n            var t = StateSelection.tryFindDecorator(this.plugin.state.data, pivot.cell.transform.ref, StateTransforms.Model.TransformStructureConformation);\r\n            if (!t)\r\n                return;\r\n            return _jsx(ExpandGroup, __assign({ header: \"Conformation Transform\" }, { children: _jsx(UpdateTransformControl, { state: t.parent, transform: t.transform, customHeader: 'none', noMargin: true, autoHideApply: true }, void 0) }), void 0);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StructureSourceControls.prototype.renderControls = function () {\r\n        var disabled = this.state.isBusy || this.isEmpty;\r\n        var presets = this.presetActions;\r\n        var label = this.label;\r\n        return _jsxs(_Fragment, { children: [_jsxs(\"div\", __assign({ className: 'msp-flex-row', style: { marginTop: '1px' } }, { children: [_jsx(Button, __assign({ noOverflow: true, flex: true, onClick: this.toggleHierarchy, disabled: disabled, title: label }, { children: label }), void 0), presets.length > 0 && _jsx(IconButton, { svg: BookmarksOutlinedSvg, className: 'msp-form-control', flex: '40px', onClick: this.togglePreset, title: 'Apply a structure presets to the current hierarchy.', toggleState: this.state.show === 'presets', disabled: disabled }, void 0)] }), void 0), this.state.show === 'hierarchy' && _jsx(ActionMenu, { items: this.hierarchyItems, onSelect: this.selectHierarchy, multiselect: true }, void 0), this.state.show === 'presets' && _jsx(ActionMenu, { items: presets, onSelect: this.applyPreset }, void 0), this.modelIndex, this.structureType, this.transform, _jsxs(\"div\", __assign({ style: { marginTop: '6px' } }, { children: [_jsx(StructureFocusControls, {}, void 0), _jsx(StructureSelectionStatsControls, { hideOnEmpty: true }, void 0)] }), void 0)] }, void 0);\r\n    };\r\n    return StructureSourceControls;\r\n}(CollapsableControls));\r\nexport { StructureSourceControls };\r\n//# sourceMappingURL=source.js.map"]},"metadata":{},"sourceType":"module"}