var $NGL_shaderTextHash={};$NGL_shaderTextHash["SphereImpostor.frag"]=["#define STANDARD","#define IMPOSTOR","","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform mat4 projectionMatrix;","uniform float ortho;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","","#ifdef PICKING","    uniform float objectId;","    varying vec3 vPickingColor;","#else","    #include common","    #include color_pars_fragment","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","bool flag2 = false;","bool interior = false;","vec3 cameraPos;","vec3 cameraNormal;","","// Calculate depth based on the given camera position.","float calcDepth( in vec3 cameraPos ){","    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;","    return 0.5 + 0.5 * clipZW.x / clipZW.y;","}","","float calcClip( vec3 cameraPos ){","    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );","}","","bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){","","    vec3 cameraSpherePos = -vPointViewPosition;","    cameraSpherePos.z += vRadius;","","    vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );","    vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );","    vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );","","    float B = dot( rayDirection, cameraSphereDir );","    float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );","","    if( det < 0.0 ){","        discard;","        return false;","    }","        float sqrtDet = sqrt( det );","        float posT = mix( B + sqrtDet, B + sqrtDet, ortho );","        float negT = mix( B - sqrtDet, sqrtDet - B, ortho );","","        cameraPos = rayDirection * negT + rayOrigin;","","        #ifdef NEAR_CLIP","if( calcDepth( cameraPos ) <= 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    return false;","}else if( calcClip( cameraPos ) > 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    flag2 = true;","    return false;","}else{","    cameraNormal = normalize( cameraPos - cameraSpherePos );","}","        #else","if( calcDepth( cameraPos ) <= 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    return false;","}else{","    cameraNormal = normalize( cameraPos - cameraSpherePos );","}","        #endif","","        cameraNormal = normalize( cameraPos - cameraSpherePos );","        cameraNormal *= float(!interior) * 2.0 - 1.0;","         return !interior;","","}","","void main(void){","","    bool flag = Impostor( cameraPos, cameraNormal );","","    #ifdef NEAR_CLIP","        if( calcClip( cameraPos ) > 0.0 )","            discard;","    #endif","","    // FIXME not compatible with custom clipping plane","    //Set the depth based on the new cameraPos.","    gl_FragDepthEXT = calcDepth( cameraPos );","    if( !flag ){","","        // clamp to near clipping plane and add a tiny value to","        // make spheres with a greater radius occlude smaller ones","        #ifdef NEAR_CLIP","if( flag2 ){","    gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );","}else if( gl_FragDepthEXT >= 0.0 ){","    gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","}","        #else","if( gl_FragDepthEXT >= 0.0 ){","    gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","}","        #endif","","    }","","    // bugfix (mac only?)","    if (gl_FragDepthEXT < 0.0)","        discard;","    if (gl_FragDepthEXT > 1.0)","        discard;","","    #ifdef PICKING","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #else","","        vec3 vNormal = cameraNormal;","        vec3 vViewPosition = -cameraPos;","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","        #include roughnessmap_fragment","        #include metalnessmap_fragment","","        // don't use include normal_fragment","        vec3 normal = normalize( vNormal );","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","        //gl_FragColor = vec4( reflectedLight.directSpecular, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        //include fog_fragment","        #ifdef USE_FOG","            #ifdef USE_LOGDEPTHBUF_EXT","                float depth = gl_FragDepthEXT / gl_FragCoord.w;","            #else","                float depth = gl_FragCoord.z / gl_FragCoord.w;","            #endif","            #ifdef FOG_EXP2","                float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );","            #else","                float fogFactor = smoothstep( fogNear, fogFar, depth );","            #endif","            gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","        #endif","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["SphereImpostor.vert"]=["uniform mat4 projectionMatrixInverse;","uniform float nearClip;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","varying float fogDepth;","varying float fogNear;","varying float fogFar;","","attribute vec2 mapping;","//attribute vec3 position;","attribute float radius;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    #include color_pars_vertex","#endif","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","const mat4 D = mat4(","    1.0, 0.0, 0.0, 0.0,","    0.0, 1.0, 0.0, 0.0,","    0.0, 0.0, 1.0, 0.0,","    0.0, 0.0, 0.0, -1.0",");","","mat4 transpose( in mat4 inMatrix ) {","    vec4 i0 = inMatrix[0];","    vec4 i1 = inMatrix[1];","    vec4 i2 = inMatrix[2];","    vec4 i3 = inMatrix[3];","","    mat4 outMatrix = mat4(","        vec4(i0.x, i1.x, i2.x, i3.x),","        vec4(i0.y, i1.y, i2.y, i3.y),","        vec4(i0.z, i1.z, i2.z, i3.z),","        vec4(i0.w, i1.w, i2.w, i3.w)","    );","    return outMatrix;","}","","//------------------------------------------------------------------------------","// Compute point size and center using the technique described in:","// 'GPU-Based Ray-Casting of Quadratic Surfaces'","// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.","//","// Code based on","/*=========================================================================",""," Program:   Visualization Toolkit"," Module:    Quadrics_fs.glsl and Quadrics_vs.glsl",""," Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen"," All rights reserved."," See Copyright.txt or http://www.kitware.com/Copyright.htm for details.",""," This software is distributed WITHOUT ANY WARRANTY; without even"," the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR"," PURPOSE.  See the above copyright notice for more information.",""," =========================================================================*/","","// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl","// .SECTION Thanks","// <verbatim>","//","//  This file is part of the PointSprites plugin developed and contributed by","//","//  Copyright (c) CSCS - Swiss National Supercomputing Centre","//                EDF - Electricite de France","//","//  John Biddiscombe, Ugo Varetto (CSCS)","//  Stephane Ploix (EDF)","//","// </verbatim>","//","// Contributions by Alexander Rose","// - ported to WebGL","// - adapted to work with quads","void ComputePointSizeAndPositionInClipCoordSphere(){","","    vec2 xbc;","    vec2 ybc;","","    mat4 T = mat4(","        radius, 0.0, 0.0, 0.0,","        0.0, radius, 0.0, 0.0,","        0.0, 0.0, radius, 0.0,","        position.x, position.y, position.z, 1.0","    );","","    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );","    float A = dot( R[ 3 ], D * R[ 3 ] );","    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );","    float C = dot( R[ 0 ], D * R[ 0 ] );","    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;","","    A = dot( R[ 3 ], D * R[ 3 ] );","    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );","    C = dot( R[ 1 ], D * R[ 1 ] );","    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;","","    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );","    gl_Position.xy -= mapping * vec2( sx, sy );","    gl_Position.xy *= gl_Position.w;","","}","","void main(void){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        #include color_vertex","    #endif","","    vRadius = radius * matrixScale( modelViewMatrix );","","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    // avoid clipping, added again in fragment shader","    mvPosition.z -= vRadius;","","    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    ComputePointSizeAndPositionInClipCoordSphere();","","","    vRadiusSq = vRadius * vRadius;","    vec4 vPoint4 = projectionMatrixInverse * gl_Position;","    vPoint = vPoint4.xyz / vPoint4.w;","    vPointViewPosition = -mvPosition.xyz / mvPosition.w;","","}"].join("\n"),$NGL_shaderTextHash["CylinderImpostor.frag"]=["#define STANDARD","#define IMPOSTOR","","// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - custom clipping","// - three.js lighting","","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform mat4 projectionMatrix;","uniform float ortho;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","","#ifdef PICKING","    uniform float objectId;","    varying vec3 vPickingColor;","#else","    varying vec3 vColor1;","    varying vec3 vColor2;","    #include common","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","bool interior = false;","","float distSq3( vec3 v3a, vec3 v3b ){","    return (","        ( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +","        ( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +","        ( v3a.z - v3b.z ) * ( v3a.z - v3b.z )","    );","}","","// Calculate depth based on the given camera position.","float calcDepth( in vec3 cameraPos ){","    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;","    return 0.5 + 0.5 * clipZW.x / clipZW.y;","}","","float calcClip( vec3 cameraPos ){","    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );","}","","void main(){","","    vec3 point = w.xyz / w.w;","","    // unpacking","    vec3 base = base_radius.xyz;","    float vRadius = base_radius.w;","    vec3 end = end_b.xyz;","    float b = end_b.w;","","    vec3 end_cyl = end;","    vec3 surface_point = point;","","    vec3 ray_target = surface_point;","    vec3 ray_origin = vec3(0.0);","    vec3 ray_direction = mix(normalize(ray_origin - ray_target), vec3(0.0, 0.0, 1.0), ortho);","    mat3 basis = mat3( U, V, axis );","","    vec3 diff = ray_target - 0.5 * (base + end_cyl);","    vec3 P = diff * basis;","","    // angle (cos) between cylinder cylinder_axis and ray direction","    float dz = dot( axis, ray_direction );","","    float radius2 = vRadius*vRadius;","","    // calculate distance to the cylinder from ray origin","    vec3 D = vec3(dot(U, ray_direction),","                dot(V, ray_direction),","                dz);","    float a0 = P.x*P.x + P.y*P.y - radius2;","    float a1 = P.x*D.x + P.y*D.y;","    float a2 = D.x*D.x + D.y*D.y;","","    // calculate a dicriminant of the above quadratic equation","    float d = a1*a1 - a0*a2;","    if (d < 0.0)","        // outside of the cylinder","        discard;","","    float dist = (-a1 + sqrt(d)) / a2;","","    // point of intersection on cylinder surface","    vec3 new_point = ray_target + dist * ray_direction;","","    vec3 tmp_point = new_point - base;","    vec3 _normal = normalize( tmp_point - axis * dot(tmp_point, axis) );","","    ray_origin = mix( ray_origin, surface_point, ortho );","","    // test caps","    float front_cap_test = dot( tmp_point, axis );","    float end_cap_test = dot((new_point - end_cyl), axis);","","    // to calculate caps, simply check the angle between","    // the point of intersection - cylinder end vector","    // and a cap plane normal (which is the cylinder cylinder_axis)","    // if the angle < 0, the point is outside of cylinder","    // test front cap","","    #ifndef CAP","        vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","        vec3 tmp_point2 = new_point2 - base;","    #endif","","    // flat","    if (front_cap_test < 0.0)","    {","        // ray-plane intersection","        float dNV = dot(-axis, ray_direction);","        if (dNV < 0.0)","            discard;","        float near = dot(-axis, (base)) / dNV;","        vec3 front_point = ray_direction * near + ray_origin;","        // within the cap radius?","        if (dot(front_point - base, front_point-base) > radius2)","            discard;","","        #ifdef CAP","            new_point = front_point;","            _normal = axis;","        #else","            new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","            dNV = dot(-axis, ray_direction);","            near = dot(axis, end_cyl) / dNV;","            new_point2 = ray_direction * near + ray_origin;","            if (dot(new_point2 - end_cyl, new_point2-base) < radius2)","                discard;","            interior = true;","        #endif","    }","","    // test end cap","","","    // flat","    if( end_cap_test > 0.0 )","    {","        // ray-plane intersection","        float dNV = dot(axis, ray_direction);","        if (dNV < 0.0)","            discard;","        float near = dot(axis, end_cyl) / dNV;","        vec3 end_point = ray_direction * near + ray_origin;","        // within the cap radius?","        if( dot(end_point - end_cyl, end_point-base) > radius2 )","            discard;","","        #ifdef CAP","            new_point = end_point;","            _normal = axis;","        #else","            new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","            dNV = dot(-axis, ray_direction);","            near = dot(-axis, (base)) / dNV;","            new_point2 = ray_direction * near + ray_origin;","            if (dot(new_point2 - base, new_point2-base) < radius2)","                discard;","            interior = true;","        #endif","    }","","    gl_FragDepthEXT = calcDepth( new_point );","","    #ifdef NEAR_CLIP","        if( calcClip( new_point ) > 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            if( calcClip( new_point ) > 0.0 )","                discard;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );","            }","        }else if( gl_FragDepthEXT <= 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","            }","        }","    #else","        if( gl_FragDepthEXT <= 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","            }","        }","    #endif","","    // this is a workaround necessary for Mac","    // otherwise the modified fragment won't clip properly","    if (gl_FragDepthEXT < 0.0)","        discard;","    if (gl_FragDepthEXT > 1.0)","        discard;","","    #ifdef PICKING","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #else","","        vec3 vViewPosition = -new_point;","        vec3 vNormal = _normal;","        vec3 vColor;","","        if( distSq3( new_point, end_cyl ) < distSq3( new_point, base ) ){","            if( b < 0.0 ){","                vColor = vColor1;","            }else{","                vColor = vColor2;","            }","        }else{","            if( b > 0.0 ){","                vColor = vColor1;","            }else{","                vColor = vColor2;","            }","        }","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","     //ifdef USE_COLOR","     //diffuseColor.r *= vColor[0];","     //diffuseColor.g *= vColor[1];","     //diffuseColor.b *= vColor[2];","     //endif","        #include roughnessmap_fragment","        #include metalnessmap_fragment","","        // don't use include normal_fragment","        vec3 normal = normalize( vNormal );","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","        //gl_FragColor = vec4( reflectedLight.directSpecular, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        //include fog_fragment","        #ifdef USE_FOG","            #ifdef USE_LOGDEPTHBUF_EXT","                float depth = gl_FragDepthEXT / gl_FragCoord.w;","            #else","                float depth = gl_FragCoord.z / gl_FragCoord.w;","            #endif","            #ifdef FOG_EXP2","                float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );","            #else","                float fogFactor = smoothstep( fogNear, fogFar, depth );","            #endif","            gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","        #endif","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["CylinderImpostor.vert"]=["// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - shift","","attribute vec3 mapping;","attribute vec3 position1;","attribute vec3 position2;","attribute float radius;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","varying float fogDepth;","varying float fogNear;","varying float fogFar;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    //attribute vec3 color;","    attribute vec3 color2;","    varying vec3 vColor1;","    varying vec3 vColor2;","#endif","","uniform mat4 modelViewMatrixInverse;","uniform float ortho;","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","void main(){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        vColor1 = color;","        vColor2 = color2;","    #endif","","    // vRadius = radius;","    base_radius.w = radius * matrixScale( modelViewMatrix );","","    //vec3 center = position;","    vec3 center = ( position2 + position1 ) / 2.0;","    vec3 dir = normalize( position2 - position1 );","    float ext = length( position2 - position1 ) / 2.0;","","    // using cameraPosition fails on some machines, not sure why","    // vec3 cam_dir = normalize( cameraPosition - mix( center, vec3( 0.0 ), ortho ) );","    vec3 cam_dir;","    if( ortho == 0.0 ){","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;","    }else{","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;","    }","    cam_dir = normalize( cam_dir );","","    vec3 ldir;","","    float b = dot( cam_dir, dir );","    end_b.w = b;","    // direction vector looks away, so flip","    if( b < 0.0 )","        ldir = -ext * dir;","    // direction vector already looks in my direction","    else","        ldir = ext * dir;","","    vec3 left = normalize( cross( cam_dir, ldir ) );","    left = radius * left;","    vec3 up = radius * normalize( cross( left, ldir ) );","","    // transform to modelview coordinates","    axis = normalize( normalMatrix * ldir );","    U = normalize( normalMatrix * up );","    V = normalize( normalMatrix * left );","","    vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );","    base_radius.xyz = base4.xyz / base4.w;","","    vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );","    vec4 end4 = top_position;","    end_b.xyz = end4.xyz / end4.w;","","    w = modelViewMatrix * vec4(","        center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0","    );","","    gl_Position = projectionMatrix * w;","","    // avoid clipping (1.0 seems to induce flickering with some drivers)","    gl_Position.z = 0.99;","","}"].join("\n"),$NGL_shaderTextHash["SphereInstancing.frag"]=$NGL_shaderTextHash["SphereImpostor.frag"],$NGL_shaderTextHash["SphereInstancing.vert"]=["uniform mat4 projectionMatrixInverse;","uniform float nearClip;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","varying float fogDepth;","varying float fogNear;","varying float fogFar;","","attribute vec2 mapping;","//attribute vec3 position;","attribute float radius;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    #include color_pars_vertex","#endif","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","const mat4 D = mat4(","    1.0, 0.0, 0.0, 0.0,","    0.0, 1.0, 0.0, 0.0,","    0.0, 0.0, 1.0, 0.0,","    0.0, 0.0, 0.0, -1.0",");","","mat4 transpose( in mat4 inMatrix ) {","    vec4 i0 = inMatrix[0];","    vec4 i1 = inMatrix[1];","    vec4 i2 = inMatrix[2];","    vec4 i3 = inMatrix[3];","","    mat4 outMatrix = mat4(","        vec4(i0.x, i1.x, i2.x, i3.x),","        vec4(i0.y, i1.y, i2.y, i3.y),","        vec4(i0.z, i1.z, i2.z, i3.z),","        vec4(i0.w, i1.w, i2.w, i3.w)","    );","    return outMatrix;","}","","//------------------------------------------------------------------------------","// Compute point size and center using the technique described in:","// 'GPU-Based Ray-Casting of Quadratic Surfaces'","// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.","//","// Code based on","/*=========================================================================",""," Program:   Visualization Toolkit"," Module:    Quadrics_fs.glsl and Quadrics_vs.glsl",""," Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen"," All rights reserved."," See Copyright.txt or http://www.kitware.com/Copyright.htm for details.",""," This software is distributed WITHOUT ANY WARRANTY; without even"," the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR"," PURPOSE.  See the above copyright notice for more information.",""," =========================================================================*/","","// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl","// .SECTION Thanks","// <verbatim>","//","//  This file is part of the PointSprites plugin developed and contributed by","//","//  Copyright (c) CSCS - Swiss National Supercomputing Centre","//                EDF - Electricite de France","//","//  John Biddiscombe, Ugo Varetto (CSCS)","//  Stephane Ploix (EDF)","//","// </verbatim>","//","// Contributions by Alexander Rose","// - ported to WebGL","// - adapted to work with quads","void ComputePointSizeAndPositionInClipCoordSphere(vec4 updatePosition){","","    vec2 xbc;","    vec2 ybc;","","    mat4 T = mat4(","        radius, 0.0, 0.0, 0.0,","        0.0, radius, 0.0, 0.0,","        0.0, 0.0, radius, 0.0,","        updatePosition.x, updatePosition.y, updatePosition.z, 1.0","    );","","    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );","    float A = dot( R[ 3 ], D * R[ 3 ] );","    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );","    float C = dot( R[ 0 ], D * R[ 0 ] );","    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;","","    A = dot( R[ 3 ], D * R[ 3 ] );","    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );","    C = dot( R[ 1 ], D * R[ 1 ] );","    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;","","    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );","    gl_Position.xy -= mapping * vec2( sx, sy );","    gl_Position.xy *= gl_Position.w;","","}","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(void){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        #include color_vertex","    #endif","","    vRadius = radius * matrixScale( modelViewMatrix );","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition = matrix * vec4(position, 1.0);","","//    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vec4 mvPosition = modelViewMatrix * vec4( updatePosition.xyz, 1.0 );","    // avoid clipping, added again in fragment shader","    mvPosition.z -= vRadius;","","//    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    ComputePointSizeAndPositionInClipCoordSphere(updatePosition);","","","    vRadiusSq = vRadius * vRadius;","    vec4 vPoint4 = projectionMatrixInverse * gl_Position;","    vPoint = vPoint4.xyz / vPoint4.w;","    vPointViewPosition = -mvPosition.xyz / mvPosition.w;","","}"].join("\n"),$NGL_shaderTextHash["CylinderInstancing.frag"]=$NGL_shaderTextHash["CylinderImpostor.frag"],$NGL_shaderTextHash["CylinderInstancing.vert"]=["// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - shift","","attribute vec3 mapping;","attribute vec3 position1;","attribute vec3 position2;","attribute float radius;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","varying float fogDepth;","varying float fogNear;","varying float fogFar;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    //attribute vec3 color;","    attribute vec3 color2;","    varying vec3 vColor1;","    varying vec3 vColor2;","#endif","","uniform mat4 modelViewMatrixInverse;","uniform float ortho;","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        vColor1 = color;","        vColor2 = color2;","    #endif","","    // vRadius = radius;","    base_radius.w = radius * matrixScale( modelViewMatrix );","","    //vec3 center = ( position2 + position1 ) / 2.0;","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition1 = matrix * vec4(position1, 1.0);","    vec4 updatePosition2 = matrix * vec4(position2, 1.0);","    vec3 center = ( updatePosition2.xyz + updatePosition1.xyz ) / 2.0;","","    //vec3 dir = normalize( position2 - position1 );","    vec3 dir = normalize( updatePosition2.xyz - updatePosition1.xyz );","    float ext = length( position2 - position1 ) / 2.0;","","    // using cameraPosition fails on some machines, not sure why","    // vec3 cam_dir = normalize( cameraPosition - mix( center, vec3( 0.0 ), ortho ) );","    vec3 cam_dir;","    if( ortho == 0.0 ){","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;","    }else{","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;","    }","    cam_dir = normalize( cam_dir );","","    vec3 ldir;","","    float b = dot( cam_dir, dir );","    end_b.w = b;","    // direction vector looks away, so flip","    if( b < 0.0 )","        ldir = -ext * dir;","    // direction vector already looks in my direction","    else","        ldir = ext * dir;","","    vec3 left = normalize( cross( cam_dir, ldir ) );","    left = radius * left;","    vec3 up = radius * normalize( cross( left, ldir ) );","","    // transform to modelview coordinates","    axis = normalize( normalMatrix * ldir );","    U = normalize( normalMatrix * up );","    V = normalize( normalMatrix * left );","","    vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );","    base_radius.xyz = base4.xyz / base4.w;","","    vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );","    vec4 end4 = top_position;","    end_b.xyz = end4.xyz / end4.w;","","    w = modelViewMatrix * vec4(","        center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0","    );","","    gl_Position = projectionMatrix * w;","","    // avoid clipping (1.0 seems to induce flickering with some drivers)","    gl_Position.z = 0.99;","","}"].join("\n"),$NGL_shaderTextHash["Instancing.frag"]=["#define STANDARD","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform float clipRadius;","uniform mat4 projectionMatrix;","uniform float ortho;","varying float bCylinder;","","#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","    varying vec3 vViewPosition;","#endif","","#if defined( RADIUS_CLIP )","    varying vec3 vClipCenter;","#endif","","#if defined( PICKING )","    uniform float objectId;","    varying vec3 vPickingColor;","#elif defined( NOLIGHT )","    varying vec3 vColor;","#else","    #ifndef FLAT_SHADED","        varying vec3 vNormal;","    #endif","    #include common","    #include color_pars_fragment","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","void main(){","    #include nearclip_fragment","    #include radiusclip_fragment","","    #if defined( PICKING )","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #elif defined( NOLIGHT )","","        gl_FragColor = vec4( vColor, opacity );","","    #else","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","        #include roughnessmap_fragment","        #include metalnessmap_fragment","        #include normal_flip","        #include normal_fragment_begin","","        //include dull_interior_fragment","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        #include interior_fragment","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        #include fog_fragment","","        #include opaque_back_fragment","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["Instancing.vert"]=["#define STANDARD","","uniform mat4 projectionMatrixInverse;","uniform float nearClip;","uniform vec3 clipCenter;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","attribute float cylinder;","varying float bCylinder;","","#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","    varying vec3 vViewPosition;","#endif","","#if defined( RADIUS_CLIP )","    varying vec3 vClipCenter;","#endif","","#if defined( PICKING )","    #include unpack_color","    attribute float primitiveId;","    varying vec3 vPickingColor;","#elif defined( NOLIGHT )","    varying vec3 vColor;","#else","    #include color_pars_vertex","    #ifndef FLAT_SHADED","        varying vec3 vNormal;","    #endif","#endif","","#include common","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(){","    bCylinder = cylinder;","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition = matrix * vec4(position, 1.0);","","    #if defined( PICKING )","        vPickingColor = unpackColor( primitiveId );","    #elif defined( NOLIGHT )","        vColor = color;","    #else","        #include color_vertex","        //include beginnormal_vertex","        //vec3 objectNormal = vec3( normal );","        vec3 objectNormal = vec3(matrix * vec4(normal,0.0));","        #include defaultnormal_vertex","        // Normal computed with derivatives when FLAT_SHADED","        #ifndef FLAT_SHADED","            vNormal = normalize( transformedNormal );","        #endif","    #endif","","    //include begin_vertex","    vec3 transformed = updatePosition.xyz;","    //include project_vertex","    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","","    #if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","        vViewPosition = -mvPosition.xyz;","    #endif","","    #if defined( RADIUS_CLIP )","        vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;","    #endif","","    #include nearclip_vertex","","}"].join("\n"),THREE.RenderableObject=function(){"use strict";this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){"use strict";this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){"use strict";this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){"use strict";this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){"use strict";this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){"use strict";this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){"use strict";var e,t,i,o,n,r,a,s,c,d,l,u=[],p=0,f=[],v=0,h=[],m=0,g=[],y=0,E=[],_=0,b={objects:[],lights:[],elements:[]},w=(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),T=new THREE.Vector4,x=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),C=new THREE.Box3,R=new Array(3),S=(new Array(4),new THREE.Matrix4),L=new THREE.Matrix4,A=(new THREE.Matrix4,new THREE.Matrix3,new THREE.Frustum);new THREE.Vector4,new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pkRay=function(e,t){console.error("THREE.Projector: .pkRay() is now raycaster.setFromCamera().")};var I=new function(){var e=[],t=[],c=null,d=null,u=new THREE.Matrix3,p=function(e){var t=e.position,i=e.positionWorld,o=e.positionScreen;i.copy(t).applyMatrix4(l),o.copy(i).applyMatrix4(L);var n=1/o.w;o.x*=n,o.y*=n,o.z*=n,e.visible=o.x>=-1&&o.x<=1&&o.y>=-1&&o.y<=1&&o.z>=-1&&o.z<=1},E=function(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(R[0]=e.positionScreen,R[1]=t.positionScreen,R[2]=i.positionScreen,x.isIntersectionBox(C.setFromPoints(R)))},_=function(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0};return{setObject:function(i){d=(c=i).material,u.getNormalMatrix(c.matrixWorld),e.length=0,t.length=0},projectVertex:p,checkTriangleVisibility:E,checkBackfaceCulling:_,pushVertex:function(e,t,n){(i=function(){if(o===v){var e=new THREE.RenderableVertex;return f.push(e),v++,o++,e}return f[o++]}()).position.set(e,t,n),p(i)},pushNormal:function(t,i,o){e.push(t,i,o)},pushUv:function(e,i){t.push(e,i)},pushLine:function(e,t){var i=f[e],o=f[t];(a=function(){if(s===y){var e=new THREE.RenderableLine;return g.push(e),y++,s++,e}return g[s++]}()).id=c.id,a.v1.copy(i),a.v2.copy(o),a.z=(i.positionScreen.z+o.positionScreen.z)/2,a.material=c.material,b.elements.push(a)},pushTriangle:function(i,o,a){var s=f[i],l=f[o],p=f[a];if(!1!==E(s,l,p)&&(d.side===THREE.DoubleSide||!0===_(s,l,p))){(n=function(){if(r===m){var e=new THREE.RenderableFace;return h.push(e),m++,r++,e}return h[r++]}()).id=c.id,n.v1.copy(s),n.v2.copy(l),n.v3.copy(p),n.z=(s.positionScreen.z+l.positionScreen.z+p.positionScreen.z)/3;for(var v=0;v<3;v++){var g=3*arguments[v],y=n.vertexNormalsModel[v];y.set(e[g],e[g+1],e[g+2]),y.applyMatrix3(u).normalize();var w=2*arguments[v];n.uvs[v].set(t[w],t[w+1])}n.vertexNormalsLength=3,n.material=c.material,b.elements.push(n)}}}};function O(){if(d===_){var e=new THREE.RenderableSprite;return E.push(e),_++,d++,e}return E[d++]}function N(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(i,n,a,f){r=0,s=0,d=0,b.elements.length=0,!0===i.autoUpdate&&i.updateMatrixWorld(),void 0===n.parent&&n.updateMatrixWorld(),S.copy(n.matrixWorldInverse.copy(n.matrixWorld).invert()),L.multiplyMatrices(n.projectionMatrix,S),A.setFromMatrix(L),t=0,b.objects.length=0,b.lights.length=0,i.traverseVisible(function(i){if(i instanceof THREE.Light)b.lights.push(i);else if(i instanceof THREE.Mesh||i instanceof THREE.Line||i instanceof THREE.Sprite){if(!1===i.material.visible)return;!1!==i.frustumCulled&&!0!==A.intersectsObject(i)||((e=function(){if(t===p){var e=new THREE.RenderableObject;return u.push(e),p++,t++,e}return u[t++]}()).id=i.id,e.object=i,w.setFromMatrixPosition(i.matrixWorld),w.applyProjection(L),e.z=w.z,b.objects.push(e))}}),!0===a&&b.objects.sort(N);for(var v=0,h=b.objects.length;v<h;v++){var m=b.objects[v].object,g=m.geometry;if(I.setObject(m),l=m.matrixWorld,o=0,m instanceof THREE.Mesh){if(g instanceof THREE.BufferGeometry){var y=g.attributes,E=g.offsets;if(void 0===y.position)continue;for(var _=0,x=(z=y.position.array).length;_<x;_+=3)I.pushVertex(z[_],z[_+1],z[_+2]);if(void 0!==y.normal){var C=y.normal.array;for(_=0,x=C.length;_<x;_+=3)I.pushNormal(C[_],C[_+1],C[_+2])}if(void 0!==y.uv){var R=y.uv.array;for(_=0,x=R.length;_<x;_+=2)I.pushUv(R[_],R[_+1])}if(void 0!==y.index){var P=y.index.array;if(E.length>0)for(v=0;v<E.length;v++){var M=E[v],H=M.index;for(_=M.start,x=M.start+M.count;_<x;_+=3)I.pushTriangle(P[_]+H,P[_+1]+H,P[_+2]+H)}else for(_=0,x=P.length;_<x;_+=3)I.pushTriangle(P[_],P[_+1],P[_+2])}else for(_=0,x=z.length/3;_<x;_+=3)I.pushTriangle(_,_+1,_+2)}}else if(m instanceof THREE.Line){if(g instanceof THREE.BufferGeometry)if(void 0!==(y=g.attributes).position){var z;for(_=0,x=(z=y.position.array).length;_<x;_+=3)I.pushVertex(z[_],z[_+1],z[_+2]);if(void 0!==y.index)for(_=0,x=(P=y.index.array).length;_<x;_+=2)I.pushLine(P[_],P[_+1]);else{var D=m.mode===THREE.LinePieces?2:1;for(_=0,x=z.length/3-1;_<x;_+=D)I.pushLine(_,_+1)}}}else if(m instanceof THREE.Sprite){T.set(l.elements[12],l.elements[13],l.elements[14],1),T.applyMatrix4(L);var j=1/T.w;T.z*=j,T.z>=-1&&T.z<=1&&((c=O()).id=m.id,c.x=T.x*j,c.y=T.y*j,c.z=T.z,c.object=m,c.rotation=m.rotation,c.scale.x=m.scale.x*Math.abs(c.x-(T.x+n.projectionMatrix.elements[0])/(T.w+n.projectionMatrix.elements[12])),c.scale.y=m.scale.y*Math.abs(c.y-(T.y+n.projectionMatrix.elements[5])/(T.w+n.projectionMatrix.elements[13])),c.material=m.material,b.elements.push(c))}}return!0===f&&b.elements.sort(N),b}},THREE.TrackballControls=function(e,t,i){"use strict";var o=this;this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var n=new THREE.Vector3;this._state=this.STATE.NONE;var r=this.STATE.NONE,a=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var s=0,c=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var d={type:"change"},l={type:"start"},u={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var p,f,v,h,m,g,y,E,_,b=(p=new THREE.Vector2,function(e,t){return p.set((e-o.screen.left)/o.screen.width,(t-o.screen.top)/o.screen.height),p}),w=(f=new THREE.Vector3,v=new THREE.Vector3,h=new THREE.Vector3,function(e,t){h.set((e-.5*o.screen.width-o.screen.left)/(.5*o.screen.width),(.5*o.screen.height+o.screen.top-t)/(.5*o.screen.height),0);var i=h.length();return o.noRoll?i<Math.SQRT1_2?h.z=Math.sqrt(1-i*i):h.z=.5/i:i>1?h.normalize():h.z=Math.sqrt(1-i*i),a.copy(o.object.position).sub(o.target),f.copy(o.object.up).setLength(h.y),f.add(v.copy(o.object.up).cross(a).setLength(h.x)),f.add(a.setLength(h.z)),f});function T(e){!1===o.enabled||Object.keys(window).length<2||(window.removeEventListener("keydown",T),r=o._state,o._state===o.STATE.NONE&&(e.keyCode!==o.keys[o.STATE.ROTATE]||o.noRotate?e.keyCode!==o.keys[o.STATE.ZOOM]||o.noZoom?e.keyCode!==o.keys[o.STATE.PAN]||o.noPan||(o._state=o.STATE.PAN):o._state=o.STATE.ZOOM:o._state=o.STATE.ROTATE))}function x(e){!1===o.enabled||Object.keys(window).length<2||(e.stopPropagation(),o._state!==o.STATE.ROTATE||o.noRotate?o._state!==o.STATE.ZOOM||o.noZoom?o._state!==o.STATE.PAN||o.noPan||o._panEnd.copy(b(e.pageX,e.pageY)):o._zoomEnd.copy(b(e.pageX,e.pageY)):o._rotateEnd.copy(w(e.pageX,e.pageY)))}function C(e){!1===o.enabled||Object.keys(window).length<2||(e.stopPropagation(),o._state=o.STATE.NONE,document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",C),o.dispatchEvent(u))}function R(e){if(!(!1===o.enabled||Object.keys(window).length<2)){e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),o._zoomStart.y=.005*t,o.dispatchEvent(l),o.dispatchEvent(u)}}this.rotateCamera=(m=new THREE.Vector3,g=new THREE.Quaternion,function(e,t){var n;void 0===e&&(n=Math.acos(o._rotateStart.dot(o._rotateEnd)/o._rotateStart.length()/o._rotateEnd.length())),(n||void 0!==e)&&(void 0===e?(m.crossVectors(o._rotateStart,o._rotateEnd).normalize(),n*=o.rotateSpeed,g.setFromAxisAngle(m,-n)):g.copy(e),void 0===i||void 0===i.quaternion||void 0!==t&&!0!==t||i.quaternion.multiplyQuaternions(g,i.quaternion),a.applyQuaternion(g),o.object.up.applyQuaternion(g),o._rotateEnd.applyQuaternion(g),o.staticMoving?o._rotateStart.copy(o._rotateEnd):(g.setFromAxisAngle(m,n*(o.dynamicDampingFactor-1)),o._rotateStart.applyQuaternion(g)))}),this.zoomCamera=function(e,t){var n;o._state===o.STATE.TOUCH_ZOOM_PAN?(void 0!==e?n=e:(n=s/c,s=c),a.multiplyScalar(n),void 0===i||void 0===i._zoomFactor||void 0!==t&&!0!==t||(i._zoomFactor*=n,i.fogCls.setFog())):(n=void 0!==e?e:1+(o._zoomEnd.y-o._zoomStart.y)*o.zoomSpeed,void 0===i||void 0===i._zoomFactor||void 0!==t&&!0!==t||(i._zoomFactor*=n,i.fogCls.setFog()),1!==n&&(a.multiplyScalar(n),o.staticMoving?o._zoomStart.copy(o._zoomEnd):o._zoomStart.y+=(o._zoomEnd.y-o._zoomStart.y)*this.dynamicDampingFactor))},this.panCamera=(y=new THREE.Vector2,E=new THREE.Vector3,_=new THREE.Vector3,function(e,t){void 0!==e?(y=e,void 0===i||void 0===i.mouseChange||void 0!==t&&!0!==t||i.mouseChange.add(e)):(y.copy(o._panEnd).sub(o._panStart),void 0===i||void 0===i.mouseChange||void 0!==t&&!0!==t||i.mouseChange.add(o._panEnd).sub(o._panStart)),y.lengthSq()&&(y.multiplyScalar(a.length()*o.panSpeed),_.copy(a).cross(o.object.up).setLength(y.x),_.add(E.copy(o.object.up).setLength(y.y)),o.object.position.add(_),o.target.add(_),o.staticMoving?o._panStart.copy(o._panEnd):o._panStart.add(y.subVectors(o._panEnd,o._panStart).multiplyScalar(o.dynamicDampingFactor)))}),this.checkDistances=function(){o.noZoom&&o.noPan||(a.lengthSq()>o.maxDistance*o.maxDistance&&o.object.position.addVectors(o.target,a.setLength(o.maxDistance)),a.lengthSq()<o.minDistance*o.minDistance&&o.object.position.addVectors(o.target,a.setLength(o.minDistance)))},this.update=function(e){a.subVectors(o.object.position,o.target),o.noRotate||(void 0!==e&&void 0!==e.quaternion?o.rotateCamera(e.quaternion,e.update):o.rotateCamera()),o.noZoom||(void 0!==e&&void 0!==e._zoomFactor?o.zoomCamera(e._zoomFactor,e.update):o.zoomCamera()),o.noPan||(void 0!==e&&void 0!==e.mouseChange?o.panCamera(e.mouseChange,e.update):o.panCamera()),o.object.position.addVectors(o.target,a),o.checkDistances(),o.object.lookAt(o.target),n.distanceToSquared(o.object.position)>1e-6&&(o.dispatchEvent(d),n.copy(o.object.position))},this.reset=function(){o._state=o.STATE.NONE,r=o.STATE.NONE,o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.up.copy(o.up0),a.subVectors(o.object.position,o.target),o.object.lookAt(o.target),o.dispatchEvent(d),n.copy(o.object.position)},Object.keys(window).length>=2&&(this.domElement.addEventListener("contextmn",function(e){},!1),this.domElement.addEventListener("mousedown",function(e){!1===o.enabled||Object.keys(window).length<2||(e.stopPropagation(),o._state===o.STATE.NONE&&(o._state=e.button),o._state!==o.STATE.ROTATE||o.noRotate?o._state!==o.STATE.ZOOM||o.noZoom?o._state!==o.STATE.PAN||o.noPan||(o._panStart.copy(b(e.pageX,e.pageY)),o._panEnd.copy(o._panStart)):(o._zoomStart.copy(b(e.pageX,e.pageY)),o._zoomEnd.copy(o._zoomStart)):(o._rotateStart.copy(w(e.pageX,e.pageY)),o._rotateEnd.copy(o._rotateStart)),document.addEventListener("mousemove",x,!1),document.addEventListener("mouseup",C,!1),o.dispatchEvent(l))},!1),this.domElement.addEventListener("mousewheel",R,!1),this.domElement.addEventListener("DOMMouseScroll",R,!1),this.domElement.addEventListener("touchstart",function(e){if(!(!1===o.enabled||Object.keys(window).length<2)){switch(e.touches.length){case 1:o._state=o.STATE.TOUCH_ROTATE,o._rotateStart.copy(w(e.touches[0].pageX,e.touches[0].pageY)),o._rotateEnd.copy(o._rotateStart);break;case 2:o._state=o.STATE.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;c=s=Math.sqrt(t*t+i*i);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;o._panStart.copy(b(n,r)),o._panEnd.copy(o._panStart);break;default:o._state=o.STATE.NONE}o.dispatchEvent(l)}},!1),this.domElement.addEventListener("touchend",function(e){if(!(!1===o.enabled||Object.keys(window).length<2)){switch(e.touches.length){case 1:o._rotateEnd.copy(w(e.touches[0].pageX,e.touches[0].pageY)),o._rotateStart.copy(o._rotateEnd);break;case 2:s=c=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;o._panEnd.copy(b(t,i)),o._panStart.copy(o._panEnd)}o._state=o.STATE.NONE,o.dispatchEvent(u)}},!1),this.domElement.addEventListener("touchmove",function(e){if(!(!1===o.enabled||Object.keys(window).length<2))switch(e.stopPropagation(),e.touches.length){case 1:o._rotateEnd.copy(w(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;c=Math.sqrt(t*t+i*i);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;o._panEnd.copy(b(n,r));break;default:o._state=o.STATE.NONE}},!1),Object.keys(window).length>=2&&window.addEventListener("keydown",T,!1),Object.keys(window).length>=2&&window.addEventListener("keyup",function(e){!1===o.enabled||Object.keys(window).length<2||(o._state=r,window.addEventListener("keydown",T,!1))},!1)),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.OrthographicTrackballControls=function(e,t,i){this.icn3d;var o=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=.5,this.zoomSpeed=1.2;this.zoomSpeed*=.01,this.panSpeed=.03,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var r=new THREE.Vector3;this._state=n.NONE;var a=n.NONE,s=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var c=1,d=0,l=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0=new THREE.Vector2((this.left0+this.right0)/2,(this.top0+this.bottom0)/2);var u={type:"change"},p={type:"start"},f={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0.set((this.left0+this.right0)/2,(this.top0+this.bottom0)/2)},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var v,h,m,g,y,E,_,b,w,T=(v=new THREE.Vector2,function(e,t){return v.set((e-o.screen.left)/o.screen.width,(t-o.screen.top)/o.screen.height),v}),x=(h=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,function(e,t){g.set((e-.5*o.screen.width-o.screen.left)/(.5*o.screen.width),(.5*o.screen.height+o.screen.top-t)/(.5*o.screen.height),0);var i=g.length();return o.noRoll?i<Math.SQRT1_2?g.z=Math.sqrt(1-i*i):g.z=.5/i:i>1?g.normalize():g.z=Math.sqrt(1-i*i),s.copy(o.object.position).sub(o.target),h.copy(o.object.up).setLength(g.y),h.add(m.copy(o.object.up).cross(s).setLength(g.x)),h.add(s.setLength(g.z)),h});function C(e){!1===o.enabled||Object.keys(window).length<2||(window.removeEventListener("keydown",C),a=o._state,o._state===n.NONE&&(e.keyCode!==o.keys[n.ROTATE]||o.noRotate?e.keyCode!==o.keys[n.ZOOM]||o.noZoom?e.keyCode!==o.keys[n.PAN]||o.noPan||(o._state=n.PAN):o._state=n.ZOOM:o._state=n.ROTATE))}function R(e){!1===o.enabled||Object.keys(window).length<2||(e.stopPropagation(),o._state!==n.ROTATE||o.noRotate?o._state!==n.ZOOM||o.noZoom?o._state!==n.PAN||o.noPan||o._panEnd.copy(T(e.pageX,e.pageY)):o._zoomEnd.copy(T(e.pageX,e.pageY)):o._rotateEnd.copy(x(e.pageX,e.pageY)))}function S(e){!1===o.enabled||Object.keys(window).length<2||(e.stopPropagation(),o._state=n.NONE,document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",S),o.dispatchEvent(f))}function L(e){if(!(!1===o.enabled||Object.keys(window).length<2)){e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),o._zoomStart.y=.01*t,o.dispatchEvent(p),o.dispatchEvent(f)}}this.rotateCamera=(y=new THREE.Vector3,E=new THREE.Quaternion,function(e,t){var n;void 0===e&&(n=Math.acos(o._rotateStart.dot(o._rotateEnd)/o._rotateStart.length()/o._rotateEnd.length())),(n||void 0!==e)&&(void 0===e?(y.crossVectors(o._rotateStart,o._rotateEnd).normalize(),n*=o.rotateSpeed,E.setFromAxisAngle(y,-n)):E.copy(e),void 0===i||void 0===i.quaternion||void 0!==t&&!0!==t||i.quaternion.multiplyQuaternions(E,i.quaternion),s.applyQuaternion(E),o.object.up.applyQuaternion(E),o._rotateEnd.applyQuaternion(E),o.staticMoving?o._rotateStart.copy(o._rotateEnd):(E.setFromAxisAngle(y,n*(o.dynamicDampingFactor-1)),o._rotateStart.applyQuaternion(E)))}),this.zoomCamera=function(e,t){var r;o._state===n.TOUCH_ZOOM_PAN?void 0!==e?r=e:(r=d/l,d=l):r=void 0!==e?e:1+(o._zoomEnd.y-o._zoomStart.y)*o.zoomSpeed/.01,void 0===i||void 0===i._zoomFactor||void 0!==t&&!0!==t||(i._zoomFactor*=r),1!==r&&(c=r,o.object.left=c*o.left0+(1-c)*o.center0.x,o.object.right=c*o.right0+(1-c)*o.center0.x,o.object.top=c*o.top0+(1-c)*o.center0.y,o.object.bottom=c*o.bottom0+(1-c)*o.center0.y,o.staticMoving?o._zoomStart.copy(o._zoomEnd):o._zoomStart.y+=(o._zoomEnd.y-o._zoomStart.y)*this.dynamicDampingFactor)},this.panCamera=(_=new THREE.Vector2,b=new THREE.Vector3,w=new THREE.Vector3,function(e,t){void 0!==e?(_=e,void 0===i||void 0===i.mouseChange||void 0!==t&&!0!==t||i.mouseChange.add(e)):(_.copy(o._panEnd).sub(o._panStart),void 0===i||void 0===i.mouseChange||void 0!==t&&!0!==t||i.mouseChange.add(o._panEnd).sub(o._panStart)),_.lengthSq()&&(_.multiplyScalar(s.length()*o.panSpeed),w.copy(s).cross(o.object.up).setLength(_.x),w.add(b.copy(o.object.up).setLength(_.y)),o.object.position.add(w),o.target.add(w),o.staticMoving?o._panStart.copy(o._panEnd):o._panStart.add(_.subVectors(o._panEnd,o._panStart).multiplyScalar(o.dynamicDampingFactor)))}),this.update=function(e){s.subVectors(o.object.position,o.target),o.noRotate||(void 0!==e&&void 0!==e.quaternion?o.rotateCamera(e.quaternion,e.update):o.rotateCamera()),o.noZoom||(void 0!==e&&void 0!==e._zoomFactor?o.zoomCamera(e._zoomFactor,e.update):o.zoomCamera(),o.object.updateProjectionMatrix()),o.noPan||(void 0!==e&&void 0!==e.mouseChange?o.panCamera(e.mouseChange,e.update):o.panCamera()),o.object.position.addVectors(o.target,s),o.object.lookAt(o.target),r.distanceToSquared(o.object.position)>1e-6&&(o.dispatchEvent(u),r.copy(o.object.position))},this.reset=function(){o._state=n.NONE,a=n.NONE,o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.up.copy(o.up0),s.subVectors(o.object.position,o.target),o.object.left=o.left0,o.object.right=o.right0,o.object.top=o.top0,o.object.bottom=o.bottom0,o.object.lookAt(o.target),o.dispatchEvent(u),r.copy(o.object.position)},Object.keys(window).length>=2&&(this.domElement.addEventListener("contextmn",function(e){},!1),this.domElement.addEventListener("mousedown",function(e){!1===o.enabled||Object.keys(window).length<2||(e.stopPropagation(),o._state===n.NONE&&(o._state=e.button),o._state!==n.ROTATE||o.noRotate?o._state!==n.ZOOM||o.noZoom?o._state!==n.PAN||o.noPan||(o._panStart.copy(T(e.pageX,e.pageY)),o._panEnd.copy(o._panStart)):(o._zoomStart.copy(T(e.pageX,e.pageY)),o._zoomEnd.copy(o._zoomStart)):(o._rotateStart.copy(x(e.pageX,e.pageY)),o._rotateEnd.copy(o._rotateStart)),document.addEventListener("mousemove",R,!1),document.addEventListener("mouseup",S,!1),o.dispatchEvent(p))},!1),this.domElement.addEventListener("mousewheel",L,!1),this.domElement.addEventListener("DOMMouseScroll",L,!1),this.domElement.addEventListener("touchstart",function(e){if(!(!1===o.enabled||Object.keys(window).length<2)){switch(e.touches.length){case 1:o._state=n.TOUCH_ROTATE,o._rotateStart.copy(x(e.touches[0].pageX,e.touches[0].pageY)),o._rotateEnd.copy(o._rotateStart);break;case 2:o._state=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;l=d=Math.sqrt(t*t+i*i);var r=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;o._panStart.copy(T(r,a)),o._panEnd.copy(o._panStart);break;default:o._state=n.NONE}o.dispatchEvent(p)}},!1),this.domElement.addEventListener("touchend",function(e){if(!(!1===o.enabled||Object.keys(window).length<2)){switch(e.touches.length){case 1:o._rotateEnd.copy(x(e.touches[0].pageX,e.touches[0].pageY)),o._rotateStart.copy(o._rotateEnd);break;case 2:d=l=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;o._panEnd.copy(T(t,i)),o._panStart.copy(o._panEnd)}o._state=n.NONE,o.dispatchEvent(f)}},!1),this.domElement.addEventListener("touchmove",function(e){if(!(!1===o.enabled||Object.keys(window).length<2))switch(e.stopPropagation(),e.touches.length){case 1:o._rotateEnd.copy(x(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;l=Math.sqrt(t*t+i*i);var r=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;o._panEnd.copy(T(r,a));break;default:o._state=n.NONE}},!1),window.addEventListener("keydown",C,!1),window.addEventListener("keyup",function(e){!1===o.enabled||Object.keys(window).length<2||(o._state=a,window.addEventListener("keydown",C,!1))},!1)),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls;var MMTF={};function initIcn3dpyMMTF(e){function t(e,t,i){for(var o=(e.byteLength,0),n=i.length;n>o;o++){var r=i.charCodeAt(o);if(128>r)e.setUint8(t++,r>>>0&127|0);else if(2048>r)e.setUint8(t++,r>>>6&31|192),e.setUint8(t++,r>>>0&63|128);else if(65536>r)e.setUint8(t++,r>>>12&15|224),e.setUint8(t++,r>>>6&63|128),e.setUint8(t++,r>>>0&63|128);else{if(!(1114112>r))throw new Error("bad codepoint "+r);e.setUint8(t++,r>>>18&7|240),e.setUint8(t++,r>>>12&63|128),e.setUint8(t++,r>>>6&63|128),e.setUint8(t++,r>>>0&63|128)}}}function i(e){for(var t=0,i=0,o=e.length;o>i;i++){var n=e.charCodeAt(i);if(128>n)t+=1;else if(2048>n)t+=2;else if(65536>n)t+=3;else{if(!(1114112>n))throw new Error("bad codepoint "+n);t+=4}}return t}function o(e){var o=new ArrayBuffer(function e(t){var o=typeof t;if("string"===o){if(32>(n=i(t)))return 1+n;if(256>n)return 2+n;if(65536>n)return 3+n;if(4294967296>n)return 5+n}if(t instanceof Uint8Array){if(256>(n=t.byteLength))return 2+n;if(65536>n)return 3+n;if(4294967296>n)return 5+n}if("number"===o){if(Math.floor(t)!==t)return 9;if(t>=0){if(128>t)return 1;if(256>t)return 2;if(65536>t)return 3;if(4294967296>t)return 5;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return 1;if(t>=-128)return 2;if(t>=-32768)return 3;if(t>=-2147483648)return 5;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("boolean"===o||null===t)return 1;if("object"===o){var n,r=0;if(Array.isArray(t)){n=t.length;for(var a=0;n>a;a++)r+=e(t[a])}else{var s=Object.keys(t);for(n=s.length,a=0;n>a;a++){var c=s[a];r+=e(c)+e(t[c])}}if(16>n)return 1+r;if(65536>n)return 3+r;if(4294967296>n)return 5+r;throw new Error("Array or object too long 0x"+n.toString(16))}throw new Error("Unknown type "+o)}(e));return function e(o,n,r){var a=typeof o;if("string"===a){if(32>(s=i(o)))return n.setUint8(r,160|s),t(n,r+1,o),1+s;if(256>s)return n.setUint8(r,217),n.setUint8(r+1,s),t(n,r+2,o),2+s;if(65536>s)return n.setUint8(r,218),n.setUint16(r+1,s),t(n,r+3,o),3+s;if(4294967296>s)return n.setUint8(r,219),n.setUint32(r+1,s),t(n,r+5,o),5+s}if(o instanceof Uint8Array){var s=o.byteLength,c=new Uint8Array(n.buffer);if(256>s)return n.setUint8(r,196),n.setUint8(r+1,s),c.set(o,r+2),2+s;if(65536>s)return n.setUint8(r,197),n.setUint16(r+1,s),c.set(o,r+3),3+s;if(4294967296>s)return n.setUint8(r,198),n.setUint32(r+1,s),c.set(o,r+5),5+s}if("number"===a){if(!isFinite(o))throw new Error("Number not finite: "+o);if(Math.floor(o)!==o)return n.setUint8(r,203),n.setFloat64(r+1,o),9;if(o>=0){if(128>o)return n.setUint8(r,o),1;if(256>o)return n.setUint8(r,204),n.setUint8(r+1,o),2;if(65536>o)return n.setUint8(r,205),n.setUint16(r+1,o),3;if(4294967296>o)return n.setUint8(r,206),n.setUint32(r+1,o),5;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return n.setInt8(r,o),1;if(o>=-128)return n.setUint8(r,208),n.setInt8(r+1,o),2;if(o>=-32768)return n.setUint8(r,209),n.setInt16(r+1,o),3;if(o>=-2147483648)return n.setUint8(r,210),n.setInt32(r+1,o),5;throw new Error("Number too small -0x"+(-o).toString(16).substr(1))}if(null===o)return n.setUint8(r,192),1;if("boolean"===a)return n.setUint8(r,o?195:194),1;if("object"===a){var d=0,l=Array.isArray(o);if(l)s=o.length;else{var u=Object.keys(o);s=u.length}if(16>s?(n.setUint8(r,s|(l?144:128)),d=1):65536>s?(n.setUint8(r,l?220:222),n.setUint16(r+1,s),d=3):4294967296>s&&(n.setUint8(r,l?221:223),n.setUint32(r+1,s),d=5),l)for(var p=0;s>p;p++)d+=e(o[p],n,r+d);else for(p=0;s>p;p++){var f=u[p];d+=e(f,n,r+d),d+=e(o[f],n,r+d)}return d}throw new Error("Unknown type "+a)}(e,new DataView(o),0),new Uint8Array(o)}function n(e,t,i){return t?new e(t.buffer,t.byteOffset,t.byteLength/(i||1)):void 0}function r(e){return n(DataView,e)}function a(e){return n(Uint8Array,e)}function s(e){return n(Int8Array,e)}function c(e){return n(Int32Array,e,4)}function d(e,t){var i=e.length/2;t||(t=new Int16Array(i));for(var o=0,n=0;i>o;++o,n+=2)t[o]=e[n]<<8^e[n+1]<<0;return t}function l(e,t){var i=e.length/4;t||(t=new Int32Array(i));for(var o=0,n=0;i>o;++o,n+=4)t[o]=e[n]<<24^e[n+1]<<16^e[n+2]<<8^e[n+3]<<0;return t}function u(e,t){var i=e.length;t||(t=new Uint8Array(4*i));for(var o=r(t),n=0;i>n;++n)o.setInt32(4*n,e[n]);return a(t)}function p(e,t,i){var o=e.length,n=1/t;i||(i=new Float32Array(o));for(var r=0;o>r;++r)i[r]=e[r]*n;return i}function f(e,t,i){var o=e.length;i||(i=new Int32Array(o));for(var n=0;o>n;++n)i[n]=Math.round(e[n]*t);return i}function v(e,t){var i,o;if(!t){var n=0;for(i=0,o=e.length;o>i;i+=2)n+=e[i+1];t=new e.constructor(n)}var r=0;for(i=0,o=e.length;o>i;i+=2)for(var a=e[i],s=e[i+1],c=0;s>c;++c)t[r]=a,++r;return t}function h(e){if(0===e.length)return new Int32Array;var t,i,o=2;for(t=1,i=e.length;i>t;++t)e[t-1]!==e[t]&&(o+=2);var n=new Int32Array(o),r=0,a=1;for(t=1,i=e.length;i>t;++t)e[t-1]!==e[t]?(n[r]=e[t-1],n[r+1]=a,a=1,r+=2):++a;return n[r]=e[e.length-1],n[r+1]=a,n}function m(e,t){var i=e.length;t||(t=new e.constructor(i)),i&&(t[0]=e[0]);for(var o=1;i>o;++o)t[o]=e[o]+t[o-1];return t}function g(e,t){var i=e.length;t||(t=new e.constructor(i)),t[0]=e[0];for(var o=1;i>o;++o)t[o]=e[o]-e[o-1];return t}function y(e,t){var i,o,n=e instanceof Int8Array?127:32767,r=-n-1,a=e.length;if(!t){var s=0;for(i=0;a>i;++i)e[i]<n&&e[i]>r&&++s;t=new Int32Array(s)}for(i=0,o=0;a>i;){for(var c=0;e[i]===n||e[i]===r;)c+=e[i],++i;c+=e[i],++i,t[o]=c,++o}return t}function E(e,t,i){return p(y(e,c(i)),t,i)}function _(e,t,i){var o,r,a,s=y(e,c(i));return o=s,r=t,a=n(Float32Array,s,4),p(m(o,c(a)),r,a)}function b(e,t,i){return function(e,t){var i,o=t?127:32767,n=-o-1,r=e.length,a=0;for(i=0;r>i;++i)0===(d=e[i])?++a:d>0?(a+=Math.ceil(d/o),d%o==0&&(a+=1)):(a+=Math.ceil(d/n),d%n==0&&(a+=1));var s=t?new Int8Array(a):new Int16Array(a),c=0;for(i=0;r>i;++i){var d;if((d=e[i])>=0)for(;d>=o;)s[c]=o,++c,d-=o;else for(;n>=d;)s[c]=n,++c,d-=n;s[c]=d,++c}return s}(g(f(e,t),o),i);var o}function w(e,t,i,o){var n=new ArrayBuffer(12+o.byteLength),r=new Uint8Array(n),a=new DataView(n);return a.setInt32(0,e),a.setInt32(4,t),i&&r.set(i,8),r.set(o,12),r}function T(e){return w(2,e.length,void 0,a(e))}function x(e){return w(4,e.length,void 0,u(e))}function C(e,t){return w(5,e.length/t,u([t]),a(e))}function R(e){return w(6,e.length,void 0,u(h(e)))}function S(e){return w(8,e.length,void 0,u(h(g(e))))}function L(e,t){return w(9,e.length,u([t]),u(h(f(e,t))))}function A(e,t){return w(10,e.length,u([t]),function(e,t){var i=e.length;t||(t=new Uint8Array(2*i));for(var o=r(t),n=0;i>n;++n)o.setInt16(2*n,e[n]);return a(t)}(b(e,t)))}function I(e){var t={};return D.forEach(function(i){void 0!==e[i]&&(t[i]=e[i])}),e.bondAtomList&&(t.bondAtomList=x(e.bondAtomList)),e.bondOrderList&&(t.bondOrderList=T(e.bondOrderList)),t.xCoordList=A(e.xCoordList,1e3),t.yCoordList=A(e.yCoordList,1e3),t.zCoordList=A(e.zCoordList,1e3),e.bFactorList&&(t.bFactorList=A(e.bFactorList,100)),e.atomIdList&&(t.atomIdList=S(e.atomIdList)),e.altLocList&&(t.altLocList=R(e.altLocList)),e.occupancyList&&(t.occupancyList=L(e.occupancyList,100)),t.groupIdList=S(e.groupIdList),t.groupTypeList=x(e.groupTypeList),e.secStructList&&(t.secStructList=T(e.secStructList)),e.insCodeList&&(t.insCodeList=R(e.insCodeList)),e.sequenceIndexList&&(t.sequenceIndexList=S(e.sequenceIndexList)),t.chainIdList=C(e.chainIdList,4),e.chainNameList&&(t.chainNameList=C(e.chainNameList,4)),t}function O(e){function t(e){for(var t={},i=0;e>i;i++){t[r()]=r()}return t}function i(t){var i=e.subarray(a,a+t);return a+=t,i}function o(t){var i=e.subarray(a,a+t);a+=t;if(t>65535){for(var o=[],n=0;n<i.length;n+=65535)o.push(String.fromCharCode.apply(null,i.subarray(n,n+65535)));return o.join("")}return String.fromCharCode.apply(null,i)}function n(e){for(var t=new Array(e),i=0;e>i;i++)t[i]=r();return t}function r(){var r,c,d=e[a];if(0==(128&d))return a++,d;if(128==(240&d))return a++,t(c=15&d);if(144==(240&d))return a++,n(c=15&d);if(160==(224&d))return a++,o(c=31&d);if(224==(224&d))return r=s.getInt8(a),a++,r;switch(d){case 192:return a++,null;case 194:return a++,!1;case 195:return a++,!0;case 196:return c=s.getUint8(a+1),a+=2,i(c);case 197:return c=s.getUint16(a+1),a+=3,i(c);case 198:return c=s.getUint32(a+1),a+=5,i(c);case 202:return r=s.getFloat32(a+1),a+=5,r;case 203:return r=s.getFloat64(a+1),a+=9,r;case 204:return r=e[a+1],a+=2,r;case 205:return r=s.getUint16(a+1),a+=3,r;case 206:return r=s.getUint32(a+1),a+=5,r;case 208:return r=s.getInt8(a+1),a+=2,r;case 209:return r=s.getInt16(a+1),a+=3,r;case 210:return r=s.getInt32(a+1),a+=5,r;case 217:return c=s.getUint8(a+1),a+=2,o(c);case 218:return c=s.getUint16(a+1),a+=3,o(c);case 219:return c=s.getUint32(a+1),a+=5,o(c);case 220:return c=s.getUint16(a+1),a+=3,n(c);case 221:return c=s.getUint32(a+1),a+=5,n(c);case 222:return c=s.getUint16(a+1),a+=3,t(c);case 223:return c=s.getUint32(a+1),a+=5,t(c)}throw new Error("Unknown type 0x"+d.toString(16))}var a=0,s=new DataView(e.buffer);return r()}function N(e,t,i,o){switch(e){case 1:return function(e,t){var i=e.length;t||(t=new Float32Array(i/4));for(var o=r(t),n=r(e),a=0,s=0,c=i/4;c>a;++a,s+=4)o.setFloat32(s,n.getFloat32(s),!0);return t}(t);case 2:return s(t);case 3:return d(t);case 4:return l(t);case 5:return a(t);case 6:return v(l(t),new Uint8Array(i));case 7:return v(l(t));case 8:return m(v(l(t)),h);case 9:return n=l(t),u=l(o)[0],p(v(n,c(f)),u,f);case 10:return _(d(t),l(o)[0]);case 11:return p(d(t),l(o)[0]);case 12:return E(d(t),l(o)[0]);case 13:return E(s(t),l(o)[0]);case 14:return y(d(t));case 15:return y(s(t))}var n,u,f,h}function P(e,t){var i=(t=t||{}).ignoreFields,o={};return j.forEach(function(t){var n,a,s,c,d,l=!!i&&-1!==i.indexOf(t),u=e[t];l||void 0===u||(u instanceof Uint8Array?o[t]=N.apply(null,(a=r(n=u),s=a.getInt32(0),c=a.getInt32(4),d=n.subarray(8,12),[s,n=n.subarray(12),c,d])):o[t]=u)}),o}function M(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function H(e,t){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),P(e instanceof Uint8Array?O(e):e,t)}function z(e,t,i,o){var n=new XMLHttpRequest;n.addEventListener("load",function(){try{var e=H(n.response);i(e)}catch(e){o(e)}},!0),n.addEventListener("error",o,!0),n.responseType="arraybuffer",n.open("GET",t+e.toUpperCase()),n.send()}var D=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],j=D.concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]),F="//mmtf.rcsb.org/v1.0/",V=F+"full/",U=F+"reduced/";return e.encode=function(e){return o(I(e))},e.decode=H,e.traverse=function(e,t,i){var o,n,r,a,s,c,d=(i=i||{}).firstModelOnly,l=t.onModel,u=t.onChain,p=t.onGroup,f=t.onAtom,v=t.onBond,h=0,m=0,g=0,y=0,E=0,_=-1,b=e.chainNameList,w=e.secStructList,T=e.insCodeList,x=e.sequenceIndexList,C=e.atomIdList,R=e.bFactorList,S=e.altLocList,L=e.occupancyList,A=e.bondAtomList,I=e.bondOrderList;for(o=0,n=e.chainsPerModel.length;n>o&&!(d&&h>0);++o){var O=e.chainsPerModel[h];for(l&&l({chainCount:O,modelIndex:h}),r=0;O>r;++r){var N=e.groupsPerChain[m];if(u){var P=M(e.chainIdList.subarray(4*m,4*m+4)),H=null;b&&(H=M(b.subarray(4*m,4*m+4))),u({groupCount:N,chainIndex:m,modelIndex:h,chainId:P,chainName:H})}for(a=0;N>a;++a){var z=e.groupList[e.groupTypeList[g]],D=z.atomNameList.length;if(p){var j=null;w&&(j=w[g]);var F=null;e.insCodeList&&(F=String.fromCharCode(T[g]));var V=null;x&&(V=x[g]),p({atomCount:D,groupIndex:g,chainIndex:m,modelIndex:h,groupId:e.groupIdList[g],groupType:e.groupTypeList[g],groupName:z.groupName,singleLetterCode:z.singleLetterCode,chemCompType:z.chemCompType,secStruct:j,insCode:F,sequenceIndex:V})}for(s=0;D>s;++s){if(f){var U=null;C&&(U=C[y]);var k=null;R&&(k=R[y]);var G=null;S&&(G=String.fromCharCode(S[y]));var B=null;L&&(B=L[y]),f({atomIndex:y,groupIndex:g,chainIndex:m,modelIndex:h,atomId:U,element:z.elementList[s],atomName:z.atomNameList[s],formalCharge:z.formalChargeList[s],xCoord:e.xCoordList[y],yCoord:e.yCoordList[y],zCoord:e.zCoordList[y],bFactor:k,altLoc:G,occupancy:B})}y+=1}if(v){var X=z.bondAtomList;for(s=0,c=z.bondOrderList.length;c>s;++s)v({atomIndex1:y-D+X[2*s],atomIndex2:y-D+X[2*s+1],bondOrder:z.bondOrderList[s]})}g+=1}m+=1}if(E=_+1,_=y-1,v&&A)for(s=0,c=A.length;c>s;s+=2){var q=A[s],W=A[s+1];(q>=E&&_>=q||W>=E&&_>=W)&&v({atomIndex1:q,atomIndex2:W,bondOrder:I?I[s/2]:null})}h+=1}},e.fetch=function(e,t,i){z(e,V,t,i)},e.fetchReduced=function(e,t,i){z(e,U,t,i)},e.version="v1.0.1",e.fetchUrl=V,e.fetchReducedUrl=U,e.encodeMsgpack=o,e.encodeMmtf=I,e.decodeMsgpack=O,e.decodeMmtf=P,e}MMTF=initIcn3dpyMMTF(MMTF),function(e,t,i){var o,n="__instance__",r="firstChild",a=setTimeout;function s(e){return void 0!==e}function c(e){return"object"==typeof e}function d(e){return Object.keys(e).length}function l(e,t,i){return e<t?t:e>i?i:e}function u(e,t){return parseInt(e,t||10)}function p(e){return Math.round(e)}function f(e){var t,i,o,n,r,a,s,c,d=+e[0],l=+e[1],u=+e[2];switch(a=u*(1-l),s=u*(1-(r=6*d-(n=Math.floor(6*d)))*l),c=u*(1-(1-r)*l),n=n||0,s=s||0,c=c||0,n%6){case 0:t=u,i=c,o=a;break;case 1:t=s,i=u,o=a;break;case 2:t=a,i=u,o=c;break;case 3:t=a,i=s,o=u;break;case 4:t=c,i=a,o=u;break;case 5:t=u,i=a,o=s}return[p(255*t),p(255*i),p(255*o)]}function v(e){return m(f(e))}function h(e){var t,i=+e[0],o=+e[1],n=+e[2],r=Math.max(i,o,n),a=Math.min(i,o,n),s=r-a,c=0===r?0:s/r,d=r/255;switch(r){case a:t=0;break;case i:t=o-n+s*(o<n?6:0),t/=6*s;break;case o:t=n-i+2*s,t/=6*s;break;case n:t=i-o+4*s,t/=6*s}return[t,c,d]}function m(e){var t=+e[2]|+e[1]<<8|+e[0]<<16;return(t="000000"+t.toString(16)).slice(-6)}function g(e){return h(y(e))}function y(e){return 3===e.length&&(e=e.replace(/./g,"$&$&")),[u(e[0]+e[1],16),u(e[2]+e[3],16),u(e[4]+e[5],16)]}function E(e){return[+e[0]/360,+e[1]/100,+e[2]/100]}function _(e){return[p(360*+e[0]),p(100*+e[1]),p(100*+e[2])]}function b(e){if(c(e))return e;var t=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(e),i=/\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(e);return"#"===e[0]&&e.match(/^#([\da-f]{3}|[\da-f]{6})$/i)?g(e.slice(1)):i?E([+i[1],+i[2],+i[3]]):t?h([+t[1],+t[2],+t[3]]):[0,1,1]}(o=e.CP=function(i,o,u){var p=t.body,h=t.documentElement,m=this,g=e.CP,y=!1,E={},_=t.createElement("div"),b="touchstart mousedown",w="touchmove mousemove",T="touchend mouseup",x="orientationchange resize";if(!(m instanceof g))return new g(i,o);function C(e,t,i){for(var o=0,n=(e=e.split(/\s+/)).length;o<n;++o)t.addEventListener(e[o],i,!1)}function R(e,t,i){for(var o=0,n=(e=e.split(/\s+/)).length;o<n;++o)t.removeEventListener(e[o],i)}function S(e,t){var i="touches",o="clientX",n="clientY",r=t[i]?t[i][0][o]:t[o],a=t[i]?t[i][0][n]:t[n],s=L(e);return{x:r-s.l,y:a-s.t}}function L(t){var i,o,n;return t===e?(i=e.pageXOffset||h.scrollLeft,o=e.pageYOffset||h.scrollTop):(i=(n=t.getBoundingClientRect()).left,o=n.top),{l:i,t:o}}function A(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function I(e){e&&e.preventDefault()}function O(t){return t===e?{w:e.innerWidth,h:e.innerHeight}:{w:t.offsetWidth,h:t.offsetHeight}}function N(e){return y||!!s(e)&&e}function P(e){y=e}function M(e,t,i){if(!s(E[e]))return m;if(s(i))s(E[e][i])&&E[e][i].apply(m,t);else for(var o in E[e])E[e][o].apply(m,t);return m}g[n][i.id||i.name||d(g[n])]=m,s(o)&&!0!==o||(o=b),P(g.parse(i.getAttribute("data-color")||i.value||[0,1,1])),_.className="color-picker",_.innerHTML='<div class="color-picker-control"><span class="color-picker-h"><i></i></span><span class="color-picker-sv"><i></i></span></div>';var H,z=_[r].children,D=N([0,1,1]),j=z[0],F=z[1],V=j[r],U=F[r],k=0,G=0,B=0,X=0,q=0,W=0,Y=0,Z=0,Q=v(D);function K(e,t){e&&"h"!==e||M("change:h",t),e&&"sv"!==e||M("change:sv",t),M("change",t)}function $(){return _.parentNode}function J(n,r){n||((u||r||p).appendChild(_),m.visible=!0),Y=O(_).w,Z=O(_).h;var a=O(F),s=O(U),c=O(j).h,d=a.w,h=a.h,g=O(V).h,y=s.w,E=s.h;if(n){function L(e){var t=e.target,o=t===i||A(t,i)===i;o?J():m.exit(),M(o?"enter":"exit",[m])}_.style.left=_.style.top="-9999px",!1!==o&&C(o,i,L),m.create=function(){return J(1),M("create",[m]),m},m.destroy=function(){return!1!==o&&R(o,i,L),m.exit(),P(!1),M("destroy",[m]),m}}else ee();function z(e){f(D);var t=f([D[0],1,1]);F.style.backgroundColor="rgb("+t.join(",")+")",P(D),I(e)}function q(e){var t,i,o,n,r,a;B&&(i=l(S(j,t=e).y,0,c),D[0]=(c-i)/c,V.style.top=i-g/2+"px",z(t),Q=v(D),k||(M("drag:h",[Q,m]),M("drag",[Q,m]),K("h",[Q,m]))),X&&(n=S(F,o=e),r=l(n.x,0,d),a=l(n.y,0,h),D[1]=1-(d-r)/d,D[2]=(h-a)/h,U.style.right=d-r-y/2+"px",U.style.top=a-E/2+"px",z(o),Q=v(D),G||(M("drag:sv",[Q,m]),M("drag",[Q,m]),K("sv",[Q,m]))),k=0,G=0}function W(e){var t=e.target,n=B?"h":"sv",r=[v(D),m],a=t===i||A(t,i)===i,s=t===_||A(t,_)===_;a||s?s&&(M("stop:"+n,r),M("stop",r),K(n,r)):$()&&!1!==o&&(m.exit(),M("exit",[m]),K(0,r)),B=0,X=0}function te(e){k=1,B=1,q(e),I(e),M("start:h",[Q,m]),M("start",[Q,m]),K("h",[Q,m])}function ie(e){G=1,X=1,q(e),I(e),M("start:sv",[Q,m]),M("start",[Q,m]),K("sv",[Q,m])}H=function(){D=N(D),z(),V.style.top=c-g/2-c*+D[0]+"px",U.style.right=d-y/2-d*+D[1]+"px",U.style.top=h-E/2-h*+D[2]+"px"},m.exit=function(i){return $()&&($().removeChild(_),m.visible=!1),R(b,j,te),R(b,F,ie),R(w,t,q),R(T,t,W),R(x,e,ee),m},H(),n||(C(b,j,te),C(b,F,ie),C(w,t,q),C(T,t,W),C(x,e,ee))}function ee(){return m.fit()}return J(1),a(function(){var e=[v(D),m];M("create",e),K(0,e)},0),m.fit=function(t){var o=O(e),n=O(h),r=o.w-n.w,a=o.h-h.clientHeight,d=L(e),u=L(i);if(q=u.l+d.l,W=u.t+d.t+O(i).h,c(t))s(t[0])&&(q=t[0]),s(t[1])&&(W=t[1]);else{var p=d.l,f=d.t,v=d.l+o.w-Y-r,g=d.t+o.h-Z-a;q=l(q,p,v)>>0,W=l(W,f,g)>>0}return _.style.left=q+"px",_.style.top=W+"px",M("fit",[m]),m},m.set=function(e){return s(e)?("string"==typeof e&&(e=g.parse(e)),P(e),H(),m):N()},m.get=function(e){return N(e)},m.target=i,m.picker=_,m.visible=!1,m.on=function(e,t,i){return s(e)?s(t)?(s(E[e])||(E[e]={}),s(i)||(i=d(E[e])),E[e][i]=t,m):E[e]:E},m.off=function(e,t){return s(e)?s(t)?(delete E[e][t],m):(E[e]={},m):(E={},m)},m.fire=M,m.hooks=E,m.enter=function(e){return J(0,e)},m}).version="1.3.9",o[n]={},o.each=function(e,t){return a(function(){var t,i=o[n];for(t in i)e(i[t],t,i)},0===t?0:t||1),o},o.parse=b,o._HSV2RGB=f,o._HSV2HEX=v,o._RGB2HSV=h,o._HEX2HSV=g,o._HEX2RGB=function(e){return[+(t=y(e))[0]/255,+t[1]/255,+t[2]/255];var t},o.HSV2RGB=function(e){return f(E(e))},o.HSV2HEX=function(e){return v(E(e))},o.RGB2HSV=function(e){return _(h(e))},o.RGB2HEX=m,o.HEX2HSV=function(e){return _(g(e))},o.HEX2RGB=y}(window,document);var saveAs=function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},i=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,n=/constructor/i.test(e.HTMLElement)||e.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent),a=e.setImmediate||e.setTimeout,s=function(e){a(function(){throw e},0)},c=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},d=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},l=function(l,u,p){p||(l=d(l));var f,v=this,h="application/octet-stream"===(l?l.type:void 0),m=function(){!function(e,t,i){for(var o=(t=[].concat(t)).length;o--;){var n=e["on"+t[o]];if("function"==typeof n)try{n.call(e,i||e)}catch(e){s(e)}}}(v,"writestart progress write writeend".split(" "))};if(v.readyState=v.INIT,o)return f||(f=t().createObjectURL(l)),void a(function(){var e,t;i.href=f,i.download=u,e=i,t=new MouseEvent("click"),e.dispatchEvent(t),m(),c(f),v.readyState=v.DONE},0);!function(){if((r||h&&n)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=r?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,v.readyState=v.DONE,m()},i.readAsDataURL(l),void(v.readyState=v.INIT)}f||(f=t().createObjectURL(l)),h?e.location.href=f:e.open(f,"_blank")||(e.location.href=f);v.readyState=v.DONE,m(),c(f)}()},u=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return t=t||e.name||"download",i||(e=d(e)),navigator.msSaveOrOpenBlob(e,t)}:(u.abort=function(){},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,function(e,t,i){return new l(e,t||e.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this);!function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),o=i&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,r=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,a=(i||n)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,a,s,c,d,l,u,p,f;if(!(t=e.match(r)))throw new Error("invalid data URI");for(a=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),s=!!t[4],c=e.slice(t[0].length),d=s?atob(c):decodeURIComponent(c),l=new ArrayBuffer(d.length),u=new Uint8Array(l),p=0;p<d.length;p+=1)u[p]=d.charCodeAt(p);return i?new Blob([o?u:l],{type:a}):((f=new n).append(l),f.getBlob(a))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,i,o){var n=this;setTimeout(function(){o&&t.toDataURL&&a?e(a(n.toDataURL(i,o))):e(n.mozGetAsFile("blob",i))})}:t.toDataURL&&a&&(t.toBlob=function(e,t,i){var o=this;setTimeout(function(){e(a(o.toDataURL(t,i)))})})),"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof module&&module.exports?module.exports=a:e.dataURLtoBlob=a}(window);
var icn3d=function(e){"use strict";class t{constructor(e){this.icn3dui=e}cloneHash(e){this.icn3dui;let t={};void 0===e&&(e={});for(let s in e)t[s]=e[s];return t}intHash(e,t){this.icn3dui;let s={};if(void 0===e&&(e={}),void 0===t&&(t={}),Object.keys(e).length<Object.keys(t).length)for(let i in e)void 0!==t&&t[i]&&(s[i]=e[i]);else for(let i in t)void 0!==e&&e[i]&&(s[i]=t[i]);return s}exclHash(e,t){void 0===e&&(e={}),void 0===t&&(t={});let s=this.icn3dui.hashUtilsCls.cloneHash(e);for(let e in s)void 0!==t&&t[e]&&delete s[e];return s}unionHash(e,t){return this.icn3dui.hashUtilsCls.unionHashInPlace(e,t)}unionHashInPlace(e,t){return this.icn3dui,void 0===e&&(e={}),void 0===t&&(t={}),$.extend(e,t),e}unionHashNotInPlace(e,t){return this.icn3dui,$.extend({},e,t)}intHash2Atoms(e,t,s){let i=this.icn3dui;return i.hashUtilsCls.hash2Atoms(i.hashUtilsCls.intHash(e,t),s)}exclHash2Atoms(e,t,s){let i=this.icn3dui;return i.hashUtilsCls.hash2Atoms(i.hashUtilsCls.exclHash(e,t),s)}unionHash2Atoms(e,t,s){let i=this.icn3dui;return i.hashUtilsCls.hash2Atoms(i.hashUtilsCls.unionHash(e,t),s)}hash2Atoms(e,t){this.icn3dui;let s={};for(let i in e)s[i]=t[i];return s}hashvalue2array(e){this.icn3dui;let t=[];for(let s in e)t.push(e[s]);return t}}class s{constructor(e){this.icn3dui=e,this.glycanHash={GLC:{c:"1E90FF",s:"sphere"},BGC:{c:"1E90FF",s:"sphere"},NAG:{c:"1E90FF",s:"cube"},NDG:{c:"1E90FF",s:"cube"},GCS:{c:"1E90FF",s:"cube"},PA1:{c:"1E90FF",s:"cube"},GCU:{c:"1E90FF",s:"cone"},BDP:{c:"1E90FF",s:"cone"},G6D:{c:"1E90FF",s:"cone"},DDA:{c:"1E90FF",s:"cylinder"},B6D:{c:"1E90FF",s:"cylinder"},XXM:{c:"1E90FF",s:"cylinder"},MAN:{c:"00FF00",s:"sphere"},BMA:{c:"00FF00",s:"sphere"},BM3:{c:"00FF00",s:"cube"},"95Z":{c:"00FF00",s:"cube"},MAV:{c:"00FF00",s:"cone"},BEM:{c:"00FF00",s:"cone"},RAM:{c:"00FF00",s:"cone"},RM4:{c:"00FF00",s:"cone"},TYV:{c:"00FF00",s:"cylinder"},ARA:{c:"00FF00",s:"cylinder"},ARB:{c:"00FF00",s:"cylinder"},KDN:{c:"00FF00",s:"cylinder"},KDM:{c:"00FF00",s:"cylinder"},"6PZ":{c:"00FF00",s:"cylinder"},GMH:{c:"00FF00",s:"cylinder"},BDF:{c:"00FF00",s:"cylinder"},GAL:{c:"FFFF00",s:"sphere"},GLA:{c:"FFFF00",s:"sphere"},NGA:{c:"FFFF00",s:"cube"},A2G:{c:"FFFF00",s:"cube"},X6X:{c:"FFFF00",s:"cube"},"1GN":{c:"FFFF00",s:"cube"},ADA:{c:"FFFF00",s:"cone"},GTR:{c:"FFFF00",s:"cone"},LDY:{c:"FFFF00",s:"cylinder"},KDO:{c:"FFFF00",s:"cylinder"},T6T:{c:"FFFF00",s:"cylinder"},GUP:{c:"A52A2A",s:"sphere"},GL0:{c:"A52A2A",s:"sphere"},LGU:{c:"A52A2A",s:"cone"},ABE:{c:"A52A2A",s:"cylinder"},XYS:{c:"A52A2A",s:"cylinder"},XYP:{c:"A52A2A",s:"cylinder"},SOE:{c:"A52A2A",s:"cylinder"},PZU:{c:"FF69B4",s:"cylinder"},RIP:{c:"FF69B4",s:"cylinder"},"0MK":{c:"FF69B4",s:"cylinder"},ALL:{c:"8A2BE2",s:"sphere"},AFD:{c:"8A2BE2",s:"sphere"},NAA:{c:"8A2BE2",s:"cube"},SIA:{c:"8A2BE2",s:"cylinder"},SIB:{c:"8A2BE2",s:"cylinder"},AMU:{c:"8A2BE2",s:"cylinder"},X0X:{c:"1E90FF",s:"cone"},X1X:{c:"1E90FF",s:"cone"},NGC:{c:"1E90FF",s:"cylinder"},NGE:{c:"1E90FF",s:"cylinder"},"4N2":{c:"A0522D",s:"sphere"},HSQ:{c:"A0522D",s:"cube"},IDR:{c:"A0522D",s:"cone"},MUR:{c:"A0522D",s:"cylinder"},FUC:{c:"FF0000",s:"cone"},FUL:{c:"FF0000",s:"cone"}},this.nucleotidesArray=["  G","  A","  T","  C","  U"," DG"," DA"," DT"," DC"," DU","G","A","T","C","U","DG","DA","DT","DC","DU"],this.ionsArray=["  K"," NA"," MG"," AL"," CA"," TI"," MN"," FE"," NI"," CU"," ZN"," AG"," BA","  F"," CL"," BR","  I","K","NA","MG","AL","CA","TI","MN","FE","NI","CU","ZN","AG","BA","F","CL","BR","I"],this.cationsTrimArray=["K","NA","MG","AL","CA","TI","MN","FE","NI","CU","ZN","AG","BA"],this.anionsTrimArray=["F","CL","BR","I"],this.ionCharges={K:1,NA:1,MG:2,AL:3,CA:2,TI:3,MN:2,FE:3,NI:2,CU:2,ZN:2,AG:1,BA:2},this.vdwRadii={H:1.08,HE:1.34,LI:1.75,BE:2.05,B:1.47,C:1.49,N:1.41,O:1.4,F:1.39,NE:1.68,NA:1.84,MG:2.05,AL:2.11,SI:2.07,P:1.92,S:1.82,CL:1.83,AR:1.93,K:2.05,CA:2.21,SC:2.16,TI:1.87,V:1.79,CR:1.89,MN:1.97,FE:1.94,CO:1.92,NI:1.84,CU:1.86,ZN:2.1,GA:2.08,GE:2.15,AS:2.06,SE:1.93,BR:1.98,KR:2.12,RB:2.16,SR:2.24,Y:2.19,ZR:1.86,NB:2.07,MO:2.09,TC:2.09,RU:2.07,RH:1.95,PD:2.02,AG:2.03,CD:2.3,IN:2.36,SN:2.33,SB:2.25,TE:2.23,I:2.23,XE:2.21,CS:2.22,BA:2.51,LA:2.4,CE:2.35,PR:2.39,ND:2.29,PM:2.36,SM:2.29,EU:2.33,GD:2.37,TB:2.21,DY:2.29,HO:2.16,ER:2.35,TM:2.27,YB:2.42,LU:2.21,HF:2.12,TA:2.17,W:2.1,RE:2.17,OS:2.16,IR:2.02,PT:2.09,AU:2.17,HG:2.09,TL:2.35,PB:2.32,BI:2.43,PO:2.29,AT:2.36,RN:2.43,FR:2.56,RA:2.43,AC:2.6,TH:2.37,PA:2.43,U:2.4,NP:2.21,PU:2.56,AM:2.56,CM:2.56,BK:2.56,CF:2.56,ES:2.56,FM:2.56},this.covalentRadii={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69},this.atomColors={H:this.thr(16777215),He:this.thr(16761035),HE:this.thr(16761035),Li:this.thr(11674146),LI:this.thr(11674146),B:this.thr(65280),C:this.thr(11184810),N:this.thr(255),O:this.thr(15728640),F:this.thr(14329120),Na:this.thr(255),NA:this.thr(255),Mg:this.thr(2263842),MG:this.thr(2263842),Al:this.thr(8421520),AL:this.thr(8421520),Si:this.thr(14329120),SI:this.thr(14329120),P:this.thr(16753920),S:this.thr(16762930),Cl:this.thr(65280),CL:this.thr(65280),Ca:this.thr(8421520),CA:this.thr(8421520),Ti:this.thr(8421520),TI:this.thr(8421520),Cr:this.thr(8421520),CR:this.thr(8421520),Mn:this.thr(8421520),MN:this.thr(8421520),Fe:this.thr(16753920),FE:this.thr(16753920),Ni:this.thr(10824234),NI:this.thr(10824234),Cu:this.thr(10824234),CU:this.thr(10824234),Zn:this.thr(10824234),ZN:this.thr(10824234),Br:this.thr(10824234),BR:this.thr(10824234),Ag:this.thr(8421520),AG:this.thr(8421520),I:this.thr(10494192),Ba:this.thr(16753920),BA:this.thr(16753920),Au:this.thr(14329120),AU:this.thr(14329120)},this.defaultAtomColor=this.thr(13421772),this.stdChainColors=[this.thr(16711935),this.thr(255),this.thr(10053171),this.thr(65433),this.thr(16750848),this.thr(16737894),this.thr(3329330),this.thr(2003199),this.thr(16416882),this.thr(16753920),this.thr(52945),this.thr(16738740),this.thr(65280),this.thr(255),this.thr(16711680),this.thr(16776960),this.thr(65535),this.thr(16711935),this.thr(3978097),this.thr(4620980),this.thr(13458524),this.thr(16770229),this.thr(11529966),this.thr(15631086),this.thr(25600),this.thr(139),this.thr(9109504),this.thr(13468991),this.thr(35723),this.thr(9699539)],this.backgroundColors={black:this.thr(0),grey:this.thr(13421772),white:this.thr(16777215),transparent:this.thr(16777215)},this.residueColors={ALA:this.thr(13158600),ARG:this.thr(1334015),ASN:this.thr(56540),ASP:this.thr(15075850),CYS:this.thr(15132160),GLN:this.thr(56540),GLU:this.thr(15075850),GLY:this.thr(15461355),HIS:this.thr(8553170),ILE:this.thr(1016335),LEU:this.thr(1016335),LYS:this.thr(1334015),MET:this.thr(15132160),PHE:this.thr(3289770),PRO:this.thr(14456450),SER:this.thr(16422400),THR:this.thr(16422400),TRP:this.thr(11819700),TYR:this.thr(3289770),VAL:this.thr(1016335),ASX:this.thr(16738740),GLX:this.thr(16738740),G:this.thr(32768),A:this.thr(6324479),T:this.thr(16744448),C:this.thr(16711680),U:this.thr(16744448),DG:this.thr(32768),DA:this.thr(6324479),DT:this.thr(16744448),DC:this.thr(16711680),DU:this.thr(16744448)},this.residueArea={ALA:247,ARG:366,ASN:290,ASP:285,CYS:271,GLN:336,GLU:325,GLY:217,HIS:340,ILE:324,LEU:328,LYS:373,MET:346,PHE:366,PRO:285,SER:265,THR:288,TRP:414,TYR:387,VAL:293,ASX:290,GLX:336,G:520,A:507,T:515,C:467,U:482,DG:520,DA:507,DT:515,DC:467,DU:482},this.defaultResidueColor=this.thr(12492910),this.chargeColors={"  G":this.thr(16711680),"  A":this.thr(16711680),"  T":this.thr(16711680),"  C":this.thr(16711680),"  U":this.thr(16711680)," DG":this.thr(16711680)," DA":this.thr(16711680)," DT":this.thr(16711680)," DC":this.thr(16711680)," DU":this.thr(16711680),G:this.thr(16711680),A:this.thr(16711680),T:this.thr(16711680),C:this.thr(16711680),U:this.thr(16711680),DG:this.thr(16711680),DA:this.thr(16711680),DT:this.thr(16711680),DC:this.thr(16711680),DU:this.thr(16711680),ARG:this.thr(255),LYS:this.thr(255),ASP:this.thr(16711680),GLU:this.thr(16711680),HIS:this.thr(8421631),GLY:this.thr(8947848),PRO:this.thr(8947848),ALA:this.thr(8947848),VAL:this.thr(8947848),LEU:this.thr(8947848),ILE:this.thr(8947848),PHE:this.thr(8947848),SER:this.thr(8947848),THR:this.thr(8947848),ASN:this.thr(8947848),GLN:this.thr(8947848),TYR:this.thr(8947848),MET:this.thr(8947848),CYS:this.thr(8947848),TRP:this.thr(8947848)},this.hydrophobicColors={"  G":this.thr(16711680),"  A":this.thr(16711680),"  T":this.thr(16711680),"  C":this.thr(16711680),"  U":this.thr(16711680)," DG":this.thr(16711680)," DA":this.thr(16711680)," DT":this.thr(16711680)," DC":this.thr(16711680)," DU":this.thr(16711680),G:this.thr(16711680),A:this.thr(16711680),T:this.thr(16711680),C:this.thr(16711680),U:this.thr(16711680),DG:this.thr(16711680),DA:this.thr(16711680),DT:this.thr(16711680),DC:this.thr(16711680),DU:this.thr(16711680),ARG:this.thr(255),LYS:this.thr(255),ASP:this.thr(16711680),GLU:this.thr(16711680),HIS:this.thr(8421631),TRP:this.thr().setHSL(1/3,1,.5),PHE:this.thr().setHSL(1/3,1,.6945945945945946),TYR:this.thr().setHSL(1/3,1,.745945945945946),LEU:this.thr().setHSL(1/3,1,.5+.645/1.85),ILE:this.thr().setHSL(1/3,1,.5+.77/1.85),CYS:this.thr().setHSL(1/3,1,.5+.805/1.85),MET:this.thr().setHSL(1/3,1,.5+.81/1.85),GLY:this.thr().setHSL(1/6,1,.5+.285/.58),VAL:this.thr().setHSL(1/6,1,.5+.255/.58),SER:this.thr().setHSL(1/6,1,.8879310344827587),THR:this.thr().setHSL(1/6,1,.8793103448275862),ALA:this.thr().setHSL(1/6,1,.853448275862069),ASN:this.thr().setHSL(1/6,1,.6379310344827587),PRO:this.thr().setHSL(1/6,1,.6120689655172413),GLN:this.thr().setHSL(1/6,1,.5)},this.normalizedHPColors={"  G":this.thr(16777215),"  A":this.thr(16777215),"  T":this.thr(16777215),"  C":this.thr(16777215),"  U":this.thr(16777215)," DG":this.thr(16777215)," DA":this.thr(16777215)," DT":this.thr(16777215)," DC":this.thr(16777215)," DU":this.thr(16777215),G:this.thr(16777215),A:this.thr(16777215),T:this.thr(16777215),C:this.thr(16777215),U:this.thr(16777215),DG:this.thr(16777215),DA:this.thr(16777215),DT:this.thr(16777215),DC:this.thr(16777215),DU:this.thr(16777215),ARG:this.thr(16777215),LYS:this.thr(16777215),ASP:this.thr(16777215),GLU:this.thr(16777215),HIS:this.thr(16777215),TRP:this.thr().setHSL(1/3,1,.5),PHE:this.thr().setHSL(1/3,1,.644),TYR:this.thr().setHSL(1/3,1,.682),LEU:this.thr().setHSL(1/3,1,.758),ILE:this.thr().setHSL(1/3,1,.808),CYS:this.thr().setHSL(1/3,1,.5+.322),MET:this.thr().setHSL(1/3,1,.5+.324),GLY:this.thr().setHSL(1/3,1,.872),VAL:this.thr().setHSL(1/3,1,.884),SER:this.thr().setHSL(1/3,1,.896),THR:this.thr().setHSL(1/3,1,.898),ALA:this.thr().setHSL(1/3,1,.904),ASN:this.thr().setHSL(1/3,1,.954),PRO:this.thr().setHSL(1/3,1,.9600000000000001),GLN:this.thr().setHSL(1/3,1,.986)},this.ssColors={helix:this.thr(16711680),sheet:this.thr(32768),coil:this.thr(6324479)},this.ssColors2={helix:this.thr(16711680),sheet:this.thr(16762880),coil:this.thr(6324479)},this.resn2restype={ALA:1,ARG:4,ASN:7,ASP:10,CYS:13,GLN:16,GLU:19,GLY:22,HIS:25,ILE:28,LEU:31,LYS:34,MET:37,PHE:40,PRO:43,SER:46,THR:49,TRP:52,TYR:55,VAL:58},this.nuclMainArray=["C1'","C1*","C2'","C2*","C3'","C3*","C4'","C4*","C5'","C5*","O3'","O3*","O4'","O4*","O5'","O5*","P","OP1","O1P","OP2","O2P"],this.b62ResArray=["A","R","N","D","C","Q","E","G","H","I","L","K","M","F","P","S","T","W","Y","V","B","Z","X","*"],this.b62Matrix=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0,-4],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1,-4],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1,-4],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1,-4],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2,-4],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1,-4],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1,-4],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1,-4],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1,-4],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1,-4],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1,-4],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1,-4],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1,-4],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1,-4],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2,-4],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0,-4],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0,-4],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2,-4],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1,-4],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1,-4],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1,-4],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1,-4],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1,-4],[-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,1]]}thr(e){return this.icn3dui,"#0"==e&&(e="#000"),new THREE.Color(e)}}class i{constructor(e){this.icn3dui=e}isIE(){return this.icn3dui,!!(window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.match(/Trident.*rv\:11\./))}isMobile(){return this.icn3dui,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)}isMac(){return this.icn3dui,/Mac/i.test(window.navigator.userAgent)}isSessionStorageSupported(){return this.icn3dui,window.sessionStorage}hexToRgb(e,t){this.icn3dui;let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16),a:t}:null}isCalphaPhosOnly(e){this.icn3dui;let t=!1,s=0,i=0;for(let t in e){if(!(s<50))break;"CA"!==e[t].name&&"P"!==e[t].name&&"O3'"!==e[t].name&&"O3*"!==e[t].name&&++i,++s}return i<.5*s&&(t=!0),t}hasCovalentBond(e,t){let s=this.icn3dui,i=s.parasCls.covalentRadii[e.elem.toUpperCase()]+s.parasCls.covalentRadii[t.elem.toUpperCase()],l=e.coord.x-t.coord.x,n=e.coord.y-t.coord.y,r=e.coord.z-t.coord.z;return l*l+n*n+r*r<1.3*i*i}residueName2Abbr(e){this.icn3dui;let t=e.indexOf(" ");switch(t>0&&(e=e.substr(0,t)),e){case"  A":case" DA":case"DA":case"ALA":return"A";case"  C":case" DC":case"DC":case"CYS":return"C";case"  G":case" DG":case"DG":case"GLY":return"G";case"  T":case" DT":case"DT":case"THR":return"T";case"  U":case" DU":case"DU":case"SEC":return"U";case"  I":case" DI":case"DI":case"ILE":return"I";case"ARG":return"R";case"ASN":return"N";case"ASP":return"D";case"GLU":return"E";case"GLN":return"Q";case"HIS":return"H";case"LEU":return"L";case"LYS":return"K";case"MET":return"M";case"PHE":return"F";case"PRO":return"P";case"SER":return"S";case"TRP":return"W";case"TYR":return"Y";case"VAL":return"V";case"HOH":case"WAT":return"O";default:return e.trim()}}residueAbbr2Name(e){if(this.icn3dui,(e=e.toUpperCase()).length>1)return e;switch(e){case"A":return"ALA";case"R":return"ARG";case"N":return"ASN";case"D":return"ASP";case"C":return"CYS";case"E":return"GLU";case"Q":return"GLN";case"G":return"GLY";case"H":return"HIS";case"I":return"ILE";case"L":return"LEU";case"K":return"LYS";case"M":return"MET";case"F":return"PHE";case"P":return"PRO";case"S":return"SER";case"T":return"THR";case"W":return"TRP";case"Y":return"TYR";case"V":return"VAL";case"O":return"HOH";default:return e.trim()}}getJSONFromArray(e){this.icn3dui;let t="";for(let s=0,i=e.length;s<i;++s)t+=JSON.stringify(e[s]),s!=i-1&&(t+=", ");return t}checkFileAPI(){this.icn3dui,window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.")}getIdArray(e){this.icn3dui;let t=[];if(e){let s=e.indexOf("_"),i=e.lastIndexOf("_");t.push(e.substr(0,s)),t.push(e.substr(s+1,i-s-1)),t.push(e.substr(i+1))}return t}compResid(e,t,s){let i,l,n=this.icn3dui,r=e.split(","),o=t.split(",");"save1"==s?(i=n.utilsCls.getIdArray(r[0]),l=n.utilsCls.getIdArray(o[0])):"save2"==s&&(i=n.utilsCls.getIdArray(r[1]),l=n.utilsCls.getIdArray(o[1]));let a=i[0]+"_"+i[1],d=l[0]+"_"+l[1],c=parseInt(i[2]),h=parseInt(l[2]);return a>d?1:a<d?-1:a==d?c>h?1:c<h?-1:0:void 0}toggle(e,t,s,i){this.icn3dui;let l=[e,t];for(let e in l){let t=l[e];$("#"+t).toggleClass("ui-icon-plus"),$("#"+t).toggleClass("ui-icon-minus")}l=[e,t,s,i];for(let e in l){let t=l[e];$("#"+t).toggleClass("icn3d-shown"),$("#"+t).toggleClass("icn3d-hidden")}}setViewerWidthHeight(e,t){if(e.bNode)return e.htmlCls.WIDTH=400,void(e.htmlCls.HEIGHT=400);let s,i;e.htmlCls.WIDTH=$(window).width()-e.htmlCls.LESSWIDTH,e.htmlCls.HEIGHT=$(window).height()-e.htmlCls.EXTRAHEIGHT-e.htmlCls.LESSHEIGHT,t||void 0===e.oriWidth||-1!==e.cfg.width.toString().indexOf("%")?(s=$("#"+e.pre+"viewer").css("width"),i=$("#"+e.pre+"viewer").css("height"),s=s?s.replace(/px/g,""):e.htmlCls.WIDTH,i=i?i.replace(/px/g,""):e.htmlCls.HEIGHT,t||(-1!==e.cfg.width.toString().indexOf("%")?s=$(window).width()*e.cfg.width.substr(0,e.cfg.width.toString().indexOf("%"))/100-e.htmlCls.LESSWIDTH:e.cfg.width&&(s=parseInt(e.cfg.width)),-1!==e.cfg.height.toString().indexOf("%")?i=$(window).height()*e.cfg.height.substr(0,e.cfg.height.toString().indexOf("%"))/100-e.htmlCls.EXTRAHEIGHT-e.htmlCls.LESSHEIGHT:e.cfg.height&&(i=parseInt(e.cfg.height)))):(s=e.oriWidth,i=e.oriHeight),s&&e.htmlCls.WIDTH>s&&(e.htmlCls.WIDTH=s),i&&e.htmlCls.HEIGHT>i&&(e.htmlCls.HEIGHT=i)}sumArray(e){let t=0;for(let s=0,i=e.length;s<i;++s)t+=e[s];return t}}class l{constructor(e){this.icn3dui=e}onId(e,t,s){if(this.icn3dui,!(Object.keys(window).length<2)&&("#"==e.substr(0,1)&&(e=e.substr(1)),document.getElementById(e))){t.split(" ").forEach((t=>{document.getElementById(e).addEventListener(t,s)}))}}onIds(e,t,s){let i=this.icn3dui;Array.isArray(e)?e.forEach((e=>{i.myEventCls.onId(e,t,s)})):i.myEventCls.onId(e,t,s)}}class n{constructor(e){this.icn3dui=e}getRmsdSuprCls(e,t,s){let i,l,n,r,o,a,d,c,h,m,p,u,C,g=this.icn3dui,f=new Array(9),b=new THREE.Vector3,y=new THREE.Vector3,v=[],_=[],S=new Array(3),w=new Array(3),A=new Array(3),x=new Array(3),k=new Array(3),O=new Array(3);if(i=0,s<=1)return{rot:void 0,trans1:void 0,trans2:void 0,rmsd:999};let H=s;for(l=0;l<s;l++)void 0!==e[l]&&void 0!==t[l]?(v.push(e[l].clone()),_.push(t[l].clone()),b.add(e[l]),y.add(t[l])):--H;if((s=H)<=1)return{rot:void 0,trans1:void 0,trans2:void 0,rmsd:999};b.multiplyScalar(1/s),y.multiplyScalar(1/s);let D=b,R=y;for(l=0;l<s;l++)v[l].sub(b),_[l].sub(y);for(l=0,a=d=0;l<s;l++)a+=v[l].x*v[l].x+v[l].y*v[l].y+v[l].z*v[l].z,d+=_[l].x*_[l].x+_[l].y*_[l].y+_[l].z*_[l].z;a/=s,d/=s;let I=new Array(9);for(l=0;l<9;++l)I[l]=0;for(l=0;l<s;l++)I[0]+=v[l].x*_[l].x,I[1]+=v[l].x*_[l].y,I[2]+=v[l].x*_[l].z,I[3]+=v[l].y*_[l].x,I[4]+=v[l].y*_[l].y,I[5]+=v[l].y*_[l].z,I[6]+=v[l].z*_[l].x,I[7]+=v[l].z*_[l].y,I[8]+=v[l].z*_[l].z;for(l=0;l<9;++l)I[l]/=s;let E=g.rmsdSuprCls.getEigenVectors(I);return n=E.k,S=E.h1,w=E.h2,A=E.h3,x=E.k1,k=E.k2,O=E.k3,c=E.d1,h=E.d2,m=E.d3,r=E.flag,u=E.s,1!=n?(i=100,f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=0,f[7]=0,f[8]=1,{rot:f,trans1:D,trans2:R,rmsd:i}):(1==r?(x[0]=I[0]*S[0]+I[3]*S[1]+I[6]*S[2],x[1]=I[1]*S[0]+I[4]*S[1]+I[7]*S[2],x[2]=I[2]*S[0]+I[5]*S[1]+I[8]*S[2],o=Math.sqrt(c),x[0]/=o,x[1]/=o,x[2]/=o,k[0]=I[0]*w[0]+I[3]*w[1]+I[6]*w[2],k[1]=I[1]*w[0]+I[4]*w[1]+I[7]*w[2],k[2]=I[2]*w[0]+I[5]*w[1]+I[8]*w[2],o=Math.sqrt(h),k[0]/=o,k[1]/=o,k[2]/=o,O[0]=I[0]*A[0]+I[3]*A[1]+I[6]*A[2],O[1]=I[1]*A[0]+I[4]*A[1]+I[7]*A[2],O[2]=I[2]*A[0]+I[5]*A[1]+I[8]*A[2],o=Math.sqrt(m),O[0]/=o,O[1]/=o,O[2]/=o):2==r&&(S[0]=I[0]*x[0]+I[1]*x[1]+I[2]*x[2],S[1]=I[3]*x[0]+I[4]*x[1]+I[5]*x[2],S[2]=I[6]*x[0]+I[7]*x[1]+I[8]*x[2],o=Math.sqrt(c),S[0]/=o,S[1]/=o,S[2]/=o,w[0]=I[0]*k[0]+I[1]*k[1]+I[2]*k[2],w[1]=I[3]*k[0]+I[4]*k[1]+I[5]*k[2],w[2]=I[6]*k[0]+I[7]*k[1]+I[8]*k[2],o=Math.sqrt(h),w[0]/=o,w[1]/=o,w[2]/=o,A[0]=I[0]*O[0]+I[1]*O[1]+I[2]*O[2],A[1]=I[3]*O[0]+I[4]*O[1]+I[5]*O[2],A[2]=I[6]*O[0]+I[7]*O[1]+I[8]*O[2],o=Math.sqrt(m),A[0]/=o,A[1]/=o,A[2]/=o),u>0?(f[0]=x[0]*S[0]+k[0]*w[0]+O[0]*A[0],f[1]=x[0]*S[1]+k[0]*w[1]+O[0]*A[1],f[2]=x[0]*S[2]+k[0]*w[2]+O[0]*A[2],f[3]=x[1]*S[0]+k[1]*w[0]+O[1]*A[0],f[4]=x[1]*S[1]+k[1]*w[1]+O[1]*A[1],f[5]=x[1]*S[2]+k[1]*w[2]+O[1]*A[2],f[6]=x[2]*S[0]+k[2]*w[0]+O[2]*A[0],f[7]=x[2]*S[1]+k[2]*w[1]+O[2]*A[1],f[8]=x[2]*S[2]+k[2]*w[2]+O[2]*A[2]):(f[0]=x[0]*S[0]+k[0]*w[0]-O[0]*A[0],f[1]=x[0]*S[1]+k[0]*w[1]-O[0]*A[1],f[2]=x[0]*S[2]+k[0]*w[2]-O[0]*A[2],f[3]=x[1]*S[0]+k[1]*w[0]-O[1]*A[0],f[4]=x[1]*S[1]+k[1]*w[1]-O[1]*A[1],f[5]=x[1]*S[2]+k[1]*w[2]-O[1]*A[2],f[6]=x[2]*S[0]+k[2]*w[0]-O[2]*A[0],f[7]=x[2]*S[1]+k[2]*w[1]-O[2]*A[1],f[8]=x[2]*S[2]+k[2]*w[2]-O[2]*A[2]),c=Math.sqrt(c),h=Math.sqrt(h),m=Math.sqrt(m),C=c+h+u*m,p=a+d-2*C,i=p>0?Math.sqrt(p):void 0,{rot:f,trans1:D,trans2:R,rmsd:i})}eigen_values(e){let t,s,i,l,n,r,o,a,d,c,h,m,p,u,C,g,f,b,y,v;if(this.icn3dui,t=e[0],s=e[1],i=e[2],l=e[3],n=e[4],r=e[5],o=e[6],a=e[7],d=e[8],c=-(t+n+d),h=t*n+(t+n)*d-r*a-s*l-i*o,m=-t*n*d+t*r*a+s*l*d-s*r*o-i*l*a+i*n*o,p=-c*c/3+h,u=c*c*c/13.5-c*h/3+m,C=.25*u*u+p*p*p/27,C<0){let e,t;e=Math.sqrt(.25*u*u-C),t=Math.acos(-.5*u/e),b=2*Math.cbrt(e)*Math.cos(t/3)}else g=Math.cbrt(-.5*u+Math.sqrt(C)),f=Math.cbrt(-.5*u-Math.sqrt(C)),b=g+f;return b-=c/3,c+=b,m/=-b,y=.5*(-c+Math.sqrt(c*c-4*m)),v=.5*(-c-Math.sqrt(c*c-4*m)),y<v&&(C=v,v=y,y=v),b<y&&(C=y,y=b,b=C),y<v&&(C=v,v=y,y=v),{d1:b,d2:y,d3:v}}null_basis(e,t,s,i,l){let n,r,o,a,d,c,h,m,p,u,C,g,f,b,y,v,_,S;if(this.icn3dui,a=e[0],d=e[1],c=e[2],h=e[3],m=e[4],p=e[5],u=e[6],C=e[7],g=e[8],S=Math.abs(a),Math.abs(d)>S&&(S=Math.abs(d)),Math.abs(c)>S&&(S=Math.abs(c)),Math.abs(h)>S&&(S=Math.abs(h)),Math.abs(m)>S&&(S=Math.abs(m)),Math.abs(p)>S&&(S=Math.abs(p)),Math.abs(u)>S&&(S=Math.abs(u)),Math.abs(C)>S&&(S=Math.abs(C)),Math.abs(g)>S&&(S=Math.abs(g)),S<1e-10)return r=3,{k:r,v1:t,v2:s,v3:i};if(o=0,a/=S,d/=S,c/=S,h/=S,m/=S,p/=S,u/=S,C/=S,g/=S,Math.abs(a)<l&&Math.abs(h)<l&&Math.abs(u)<l)n=1,t[0]=1,t[1]=0,t[2]=0,Math.abs(d)<l&&Math.abs(m)<l&&Math.abs(C)<l?(n=2,s[0]=0,s[1]=1,s[2]=0,Math.abs(c)<l&&Math.abs(p)<l&&Math.abs(g)<l&&(n=3,i[0]=0,i[1]=0,i[2]=1)):(S=Math.abs(d),Math.abs(m)>S&&(_=a,a=h,h=_,_=d,d=m,m=_,_=c,c=p,p=_,S=Math.abs(d)),Math.abs(C)>S&&(_=a,a=u,u=_,_=d,d=C,C=_,_=c,c=g,g=_),y=p-m*c/d,v=g-C*c/d,Math.abs(y)<l&&Math.abs(v)<l&&(n=2,s[0]=0,s[1]=-c/d,s[2]=1,o=1));else if(S=Math.abs(a),Math.abs(d)>S&&(_=a,a=h,h=_,_=d,d=m,m=_,_=c,c=p,p=_,S=Math.abs(a)),Math.abs(c)>S&&(_=a,a=u,u=_,_=d,d=C,C=_,_=c,c=g,g=_),f=m-h*d/a,b=p-h*c/a,y=C-u*d/a,v=g-u*c/a,Math.abs(f)<l&&Math.abs(y)<l)n=1,t[0]=-d/a,t[1]=1,t[2]=0,Math.abs(b)<l&&Math.abs(v)<l&&(n=2,s[0]=-c/a,s[1]=0,s[2]=1,o=2);else{if(Math.abs(f)<Math.abs(y)&&(_=f,f=y,y=_,_=b,b=v,v=_),!(Math.abs(v-b*y/f)<l))return r=0,t[0]=0,t[1]=0,t[2]=0,{k:r,v1:t,v2:s,v3:i};n=1,t[0]=d/a*(b/f)-c/a,t[1]=-b/f,t[2]=1,o=3}return r=n,o>0&&(1==o?(a=s[0],d=s[1],c=s[2],_=Math.sqrt(a*a+d*d+c*c),s[0]=a/_,s[1]=d/_,s[2]=c/_):2==o?(a=t[0],d=t[1],c=t[2],h=s[0],m=s[1],p=s[2],_=a*h+d*m+c*p,Math.abs(_)>=l&&(s[0]=a+_*h,s[1]=d+_*m,s[2]=c+_*p,h=s[0],m=s[1],p=s[2]),_=Math.sqrt(a*a+d*d+c*c),t[0]=a/_,t[1]=d/_,t[2]=c/_,_=Math.sqrt(h*h+m*m+p*p),s[0]=h/_,s[1]=m/_,s[2]=p/_):(a=t[0],d=t[1],c=t[2],_=Math.sqrt(a*a+d*d+c*c),t[0]=a/_,t[1]=d/_,t[2]=c/_)),{k:r,v1:t,v2:s,v3:i}}getEigenForSelection(e,t){let s,i=this.icn3dui,l=new THREE.Vector3,n=[];for(s=0;s<t;s++)n.push(e[s]),l.add(e[s]);for(l.multiplyScalar(1/t),s=0;s<t;s++)n[s].sub(l);let r=new Array(9);for(s=0;s<9;++s)r[s]=0;for(s=0;s<t;s++)r[0]+=n[s].x*n[s].x,r[1]+=n[s].x*n[s].y,r[2]+=n[s].x*n[s].z,r[3]+=n[s].y*n[s].x,r[4]+=n[s].y*n[s].y,r[5]+=n[s].y*n[s].z,r[6]+=n[s].z*n[s].x,r[7]+=n[s].z*n[s].y,r[8]+=n[s].z*n[s].z;for(s=0;s<9;++s)r[s]/=t;return i.rmsdSuprCls.getEigenVectors(r)}getEigenVectors(e,t){let s,i,l,n,r,o,a,d=this.icn3dui,c=1e-8,h=new Array(9),m=new Array(3),p=new Array(3),u=new Array(3),C=new Array(3),g=new Array(3),f=new Array(3);l=e[0]*(e[4]*e[8]-e[5]*e[7]),l-=e[1]*(e[3]*e[8]-e[5]*e[6]),l+=e[2]*(e[3]*e[7]-e[4]*e[6]),a=l<0?-1:1;let b=new Array(3),y=new Array(3);for(let e=0;e<3;++e)b[e]=new THREE.Vector3,y[e]=new THREE.Vector3;b[0].x=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],b[0].y=e[0]*e[3]+e[1]*e[4]+e[2]*e[5],b[0].z=e[0]*e[6]+e[1]*e[7]+e[2]*e[8],b[1].x=b[0].y,b[1].y=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],b[1].z=e[3]*e[6]+e[4]*e[7]+e[5]*e[8],b[2].x=b[0].z,b[2].y=b[1].z,b[2].z=e[6]*e[6]+e[7]*e[7]+e[8]*e[8],y[0].x=e[0]*e[0]+e[3]*e[3]+e[6]*e[6],y[0].y=e[0]*e[1]+e[3]*e[4]+e[6]*e[7],y[0].z=e[0]*e[2]+e[3]*e[5]+e[6]*e[8],y[1].x=y[0].y,y[1].y=e[1]*e[1]+e[4]*e[4]+e[7]*e[7],y[1].z=e[1]*e[2]+e[4]*e[5]+e[7]*e[8],y[2].x=y[0].z,y[2].y=y[1].z,y[2].z=e[2]*e[2]+e[5]*e[5]+e[8]*e[8],h[0]=b[0].x,h[1]=b[0].y,h[2]=b[0].z,h[3]=b[1].x,h[4]=b[1].y,h[5]=b[1].z,h[6]=b[2].x,h[7]=b[2].y,h[8]=b[2].z;let v=d.rmsdSuprCls.eigen_values(h);n=v.d1,r=v.d2,o=v.d3,i=1,h[0]-=n,h[4]-=n,h[8]-=n;let _=d.rmsdSuprCls.null_basis(h,m,p,u,c);return s=_.k,m=_.v1,p=_.v2,u=_.v3,t||(1==s&&(h[0]+=n-r,h[4]+=n-r,h[8]+=n-r,_=d.rmsdSuprCls.null_basis(h,p,u,m,c),s=_.k,p=_.v1,u=_.v2,m=_.v3,1==s&&(h[0]+=r-o,h[4]+=r-o,h[8]+=r-o,_=d.rmsdSuprCls.null_basis(h,u,m,p,c),s=_.k,u=_.v1,m=_.v2,p=_.v3)),1!=s&&(h[0]=y[0].x,h[1]=y[0].y,h[2]=y[0].z,h[3]=y[1].x,h[4]=y[1].y,h[5]=y[1].z,h[6]=y[2].x,h[7]=y[2].y,h[8]=y[2].z,i=2,h[0]-=n,h[4]-=n,h[8]-=n,_=d.rmsdSuprCls.null_basis(h,C,g,f,c),s=_.k,C=_.v1,g=_.v2,f=_.v3,1==s&&(h[0]+=n-r,h[4]+=n-r,h[8]+=n-r,_=d.rmsdSuprCls.null_basis(h,g,f,C,c),s=_.k,g=_.v1,f=_.v2,C=_.v3,1==s&&(h[0]+=r-o,h[4]+=r-o,h[8]+=r-o,_=d.rmsdSuprCls.null_basis(h,f,C,g,c),s=_.k,f=_.v1,C=_.v2,g=_.v3)))),{k:s,h1:m,h2:p,h3:u,k1:C,k2:g,k3:f,d1:n,d2:r,d3:o,flag:i,s:a}}}class r{constructor(e){this.icn3dui=e}subdivide(e,t,s,i,l,n,r,o){let a=this.icn3dui,d=[],c=[],h=[],m=new Array,p=void 0!==n?n.length:0,u=void 0!==r?r.length:0;p>0&&Math.abs(n[0].x-e[0].x)<=6&&Math.abs(n[0].y-e[0].y)<=6&&Math.abs(n[0].z-e[0].z)<=6?(m.push(n[0]),p=1):p=0,m.push(e[0]);for(let t=1,s=e.length-1;t<s;++t){let s=e[t],i=e[t+1];m.push(s.smoothen?s.clone().add(i).multiplyScalar(.5):s)}m.push(e[e.length-1]);let C=0;u>0&&Math.abs(r[0].x-e[e.length-1].x)<=6&&Math.abs(r[0].y-e[e.length-1].y)<=6&&Math.abs(r[0].z-e[e.length-1].z)<=6&&(m.push(r[0]),++C),u>1&&Math.abs(r[0].x-r[1].x)<=6&&Math.abs(r[0].y-r[1].y)<=6&&Math.abs(r[0].z-r[1].z)<=6&&(m.push(r[1]),++C);let g=[],f=[],b=[];o&&(C=u>0?u-1:0);let y;for(let e=-1,l=m.length,n=1/s;e<=l-3;++e){y=e-p;let r=m[-1===e?0:e],o=m[e+1],u=m[e+2],v=m[e===l-3?l-1:e+3],_=0,S=a.subdivideCls.getKnot(1,_,r,o),w=a.subdivideCls.getKnot(1,S,o,u),A=a.subdivideCls.getKnot(1,w,u,v);S-_<1e-4&&(S=_+1),w-S<1e-4&&(w=S+1),A-w<1e-4&&(A=w+1),e>-1&&(void 0===i||i[y+1])&&e>=-1+p&&e<=l-3-C+1&&(d=d.concat(g),c=c.concat(f),h=h.concat(b)),g=[],f=[],b=[];let x=(w-S)*n;for(let n=0;n<s;++n){let m=S+x*n,k=a.subdivideCls.getValueFromKnot(m,_,S,w,A,r.x,o.x,u.x,v.x),O=a.subdivideCls.getValueFromKnot(m,_,S,w,A,r.y,o.y,u.y,v.y),H=a.subdivideCls.getValueFromKnot(m,_,S,w,A,r.z,o.z,u.z,v.z);i?(e>=-1+p&&e<=l-3-C&&i[y+1]&&n<=parseInt(s/2)&&(d.push(new THREE.Vector3(k,O,H)),c.push(i[y+1]),h.push(t[y+1])),e>=-1+p&&e<=l-3-C+1&&i[y+2]&&n>parseInt(s/2)&&(g.push(new THREE.Vector3(k,O,H)),f.push(i[y+2]),b.push(t[y+2]))):e>=-1+p&&e<=l-3-C&&(d.push(new THREE.Vector3(k,O,H)),c.push(y+1),h.push(t[y+1]))}}i&&!i[y+1]||(d=d.concat(g),c=c.concat(f),h=h.concat(b),d.push(m[m.length-1-C]),c.push(m.length-1-C),h.push(t[m.length-1-C])),g=[],f=[],b=[],m=[];let v=[];return v.push(d),v.push(c),v.push(h),v}getKnot(e,t,s,i){return this.icn3dui,s.distanceTo(i)+t}getValueFromKnot(e,t,s,i,l,n,r,o,a){this.icn3dui;let d,c,h=(r-n)/(s-t),m=(o-r)/(i-s),p=(a-o)/(l-i),u=(s+i)*(s+i)-4*(t*s+i*l-t*l);return 0==u?(d=9999,c=9999):(d=6*(3*m*s+2*h*l+p*s-2*h*s-2*m*l-m*i-p*s)/u,c=6*(3*m*i+2*p*t+h*s-2*m*t-2*p*i-h*i-m*s)/u),m*(e-s)+r+((2*d+c)/6/(s-i)*(e-s)*(e-i)*(e-i)+(2*c+d)/6/(i-s)*(e-s)*(e-s)*(e-i))}}class o{constructor(e){this.icn3dui=e}passFloat32(e,t){let s=this.icn3dui,i=e.length;t||(t=new Uint8Array(4*i));let l=s.convertTypeCls.getDataView(t);for(let t=0;t<i;++t)l.setFloat32(4*t,e[t],!0);return s.convertTypeCls.getUint8View(t)}passInt8(e,t){let s=this.icn3dui,i=e.length;t||(t=new Uint8Array(1*i));let l=s.convertTypeCls.getDataView(t);for(let t=0;t<i;++t)l.setInt8(1*t,e[t],!0);return s.convertTypeCls.getUint8View(t)}passInt16(e,t){let s=this.icn3dui,i=e.length;t||(t=new Uint8Array(2*i));let l=s.convertTypeCls.getDataView(t);for(let t=0;t<i;++t)l.setInt16(2*t,e[t],!0);return s.convertTypeCls.getUint8View(t)}passInt32(e,t){let s=this.icn3dui,i=e.length;t||(t=new Uint8Array(4*i));let l=s.convertTypeCls.getDataView(t);for(let t=0;t<i;++t)l.setInt32(4*t,e[t],!0);return s.convertTypeCls.getUint8View(t)}getUint8View(e){return this.icn3dui.convertTypeCls.getView(Uint8Array,e)}getDataView(e){return this.icn3dui.convertTypeCls.getView(DataView,e)}getView(e,t,s){return this.icn3dui,t?new e(t.buffer,t.byteOffset,t.byteLength/(s||1)):void 0}getBlobFromBufferAndText(e,t){let s=this.icn3dui,i=new Uint8Array(e),l=new Uint8Array(t.length);for(let e=0;e<t.length;++e)l[e]=s.convertTypeCls.passInt8([t.charCodeAt(e)])[0];let n=[];return n.push(new Blob([i],{type:"application/octet-stream"})),n.push(new Blob([l],{type:"application/octet-stream"})),new Blob(n,{type:"image/png"})}}class a{constructor(e){this.icn3d=e}setCamera(){let e=this.icn3d,t=e.icn3dui;if(e.bControlGl&&!t.bNode){window.cam=e.cams[e.opts.camera.toLowerCase()];let s=e.maxD;if(window.cam===e.perspectiveCamera){let i=void 0!==e.biomtMatrices&&e.biomtMatrices.length*e.cnt>e.maxatomcnt;i?window.camMaxDFactor=1:void 0!==window.camMaxDFactorFog?window.camMaxDFactor=window.camMaxDFactorFog:window.camMaxDFactor=3,window.cam_z>0?window.cam.position.z=s*window.camMaxDFactor:window.cam.position.z=-s*window.camMaxDFactor,"yes"===e.opts.slab?i?window.cam.near=.1:void 0!==window.camMaxDFactorFog?window.cam.near=s*window.camMaxDFactorFog-10:window.cam.near=s*window.camMaxDFactor:window.cam.near=.1,window.cam.far=1e4,e.bControlGl&&!t.bNode?window.controls=new THREE.TrackballControls(window.cam,void 0,e):t.bNode?e.controls=new THREE.TrackballControls(e.cam,document,e):e.controls=new THREE.TrackballControls(e.cam,document.getElementById(e.id),e)}else window.cam===e.orthographicCamera&&(void 0!==e.biomtMatrices&&e.biomtMatrices.length*e.cnt>10*e.maxatomcnt?window.cam.right=e.maxD/2*1.5:window.cam.right=e.maxD/2*2.5,window.cam.left=-window.cam.right,window.cam.top=window.cam.right/e.container.whratio,window.cam.bottom=-window.cam.right/e.container.whratio,"yes"===e.opts.slab?window.cam.near=2*e.maxD:window.cam.near=0,window.cam.far=1e4,e.bControlGl&&!t.bNode?window.controls=new THREE.OrthographicTrackballControls(window.cam,void 0,e):t.bNode?e.controls=new THREE.OrthographicTrackballControls(e.cam,document,e):e.controls=new THREE.OrthographicTrackballControls(e.cam,document.getElementById(e.id),e));window.cam.updateProjectionMatrix()}e.cam=e.cams[e.opts.camera.toLowerCase()];let s=e.maxD;if(e.cam===e.perspectiveCamera){let i=void 0!==e.biomtMatrices&&e.biomtMatrices.length*e.cnt>e.maxatomcnt;i?e.camMaxDFactor=1:void 0!==e.camMaxDFactorFog?e.camMaxDFactor=e.camMaxDFactorFog:e.camMaxDFactor=3,e.cam_z>0?e.cam.position.z=s*e.camMaxDFactor:e.cam.position.z=-s*e.camMaxDFactor,"yes"===e.opts.slab?i?e.cam.near=.1:void 0!==e.camMaxDFactorFog?e.cam.near=s*e.camMaxDFactorFog-10:e.cam.near=s*e.camMaxDFactor:e.cam.near=.1,e.cam.far=1e4,e.bControlGl&&!t.bNode?window.controls=new THREE.TrackballControls(e.cam,void 0,e):t.bNode?e.controls=new THREE.TrackballControls(e.cam,document,e):e.controls=new THREE.TrackballControls(e.cam,document.getElementById(e.id),e)}else e.cam===e.orthographicCamera&&(void 0!==e.biomtMatrices&&e.biomtMatrices.length*e.cnt>10*e.maxatomcnt?e.cam.right=e.maxD/2*1.5:e.cam.right=e.maxD/2*2.5,e.cam.left=-e.cam.right,e.cam.top=e.cam.right/e.container.whratio,e.cam.bottom=-e.cam.right/e.container.whratio,"yes"===e.opts.slab?e.cam.near=2*e.maxD:e.cam.near=0,e.cam.far=1e4,e.bControlGl&&!t.bNode?window.controls=new THREE.OrthographicTrackballControls(e.cam,void 0,e):t.bNode?e.controls=new THREE.OrthographicTrackballControls(e.cam,document,e):e.controls=new THREE.OrthographicTrackballControls(e.cam,document.getElementById(e.id),e));e.cam.updateProjectionMatrix()}}class d{constructor(e){this.icn3d=e}applyCenterOptions(e){let t,s=this.icn3d;switch(s.icn3dui,void 0===e&&(e=s.opts),e.rotationcenter.toLowerCase()){case"molecule center":void 0!==s.center&&this.setRotationCenter(s.center);break;case"pick center":void 0!==s.pAtom&&this.setRotationCenter(s.pAtom.coord);break;case"display center":t=this.centerAtoms(s.dAtoms).center,this.setRotationCenter(t);break;case"highlight center":t=this.centerAtoms(s.hAtoms).center,this.setRotationCenter(t)}}setRotationCenter(e){this.icn3d.icn3dui,this.setCenter(e)}setCenter(e){let t=this.icn3d;t.icn3dui,t.mdl.position.set(0,0,0),t.mdlImpostor.position.set(0,0,0),t.mdl_ghost.position.set(0,0,0),t.mdl.position.sub(e),t.mdlImpostor.position.sub(e),t.mdl_ghost.position.sub(e)}centerSelection(e){let t=this.icn3d,s=t.icn3dui;if(t.opts.rotationcenter="highlight center",void 0===e&&(e=s.hashUtilsCls.hash2Atoms(t.hAtoms,t.atoms)),t._zoomFactor=1,t.mouseChange=new THREE.Vector2(0,0),t.quaternion=new THREE.Quaternion(0,0,0,1),Object.keys(e).length>1){let s=this.centerAtoms(e);t.center=s.center,this.setCenter(t.center),t.cameraCls.setCamera()}}centerAtoms(e){let t=this.icn3d;t.icn3dui;let s=new THREE.Vector3(9999,9999,9999),i=new THREE.Vector3(-9999,-9999,-9999),l=new THREE.Vector3;for(let n in e){let e=t.atoms[n].coord;l.add(e),s.min(e),i.max(e)}let n=t.ParserUtilsCls.getGeoCenter(s,i);return{center:n,maxD:t.ParserUtilsCls.getStructureSize(e,s,i,n),pmin:s,pmax:i}}setWidthHeight(e,t){let s=this.icn3d;s.icn3dui,void 0===s.scaleFactor&&(s.scaleFactor=1),s.renderer.setSize(e*s.scaleFactor,t*s.scaleFactor),s.renderer.domElement.style.width=e*s.scaleFactor+"px",s.renderer.domElement.style.height=t*s.scaleFactor+"px",s.renderer.domElement.width=e*s.scaleFactor,s.renderer.domElement.height=t*s.scaleFactor,s.container.whratio=e/t}}class c{constructor(e){this.icn3d=e}setFog(e){let t=this.icn3d,s=t.icn3dui.parasCls.backgroundColors[t.opts.background.toLowerCase()];if(e){let e=t.applyCenterCls.centerAtoms(t.hAtoms);t.maxD=e.maxD,t.maxD<25&&(t.maxD=25)}let i=void 0!==t.biomtMatrices&&t.biomtMatrices.length*t.cnt>t.maxatomcnt;if("yes"===t.opts.fog)if("perspective"===t.opts.camera)if(i)t.scene.fog=void 0,t.bSetFog=!1;else{let e=t._zoomFactor>1?1*t._zoomFactor:t._zoomFactor;t.scene.fog=new THREE.Fog(s,2.5*t.maxD*e,4*t.maxD*e),t.bSetFog=!0,t.camMaxDFactorFog=3}else"orthographic"===t.opts.camera&&(t.scene.fog=void 0,t.bSetFog=!1);else t.scene.fog=void 0,t.bSetFog=!1}}class h{constructor(e){this.icn3d=e}getFirstAtomObj(e){let t=this.icn3d;if(t.icn3dui,void 0===e||0===Object.keys(e).length)return;let s=Object.keys(e)[0];return t.atoms[s]}getFirstCalphaAtomObj(e){let t,s=this.icn3d;if(s.icn3dui,void 0!==e&&0!==Object.keys(e).length){for(let i in e)if("CA"==s.atoms[i].name){t=i;break}return void 0!==t?s.atoms[t]:this.getFirstAtomObj(e)}}getFirstAtomObjByName(e,t){let s,i=this.icn3d;if(i.icn3dui,void 0===e||0===Object.keys(e).length)return i.atoms[0];for(let l in e)if(i.atoms[l].name==t){s=l;break}return void 0!==s?i.atoms[s]:void 0}getLastAtomObj(e){let t=this.icn3d;if(t.icn3dui,void 0===e||0===Object.keys(e).length)return t.atoms[0];let s=Object.keys(e),i=s[s.length-1];return t.atoms[i]}getResiduesFromAtoms(e){let t=this.icn3d;t.icn3dui;let s={};for(let i in e){s[t.atoms[i].structure+"_"+t.atoms[i].chain+"_"+t.atoms[i].resi]=1}return s}getResiduesFromCalphaAtoms(e){let t=this.icn3d;t.icn3dui;let s={};for(let i in e)if("CA"==t.atoms[i].name&&t.proteins.hasOwnProperty(i)||!t.proteins.hasOwnProperty(i)){s[t.atoms[i].structure+"_"+t.atoms[i].chain+"_"+t.atoms[i].resi]=1}return s}getChainsFromAtoms(e){let t=this.icn3d;t.icn3dui;let s={};for(let i in e){let e=t.atoms[i];s[e.structure+"_"+e.chain]=1}return s}getAtomFromResi(e,t){let s=this.icn3d;if(s.icn3dui,s.residues.hasOwnProperty(e))for(let i in s.residues[e])if(s.atoms[i].name===t&&!s.atoms[i].het)return s.atoms[i]}getAtomCoordFromResi(e,t){this.icn3d.icn3dui;let s=this.getAtomFromResi(e,t);if(void 0!==s){return void 0!==s.coord2?s.coord2:s.coord}}}class m{constructor(e){this.icn3d=e}createStrip(e,t,s,i,l,n,r,o,a,d,c,h,m,p){let u=this.icn3d,C=u.icn3dui;if(!(C.bNode||e.length<2)){if(i=i||u.axisDIV,m&&u.bDoublecolor&&!u.bCalphaOnly){let e=!1,t=C.subdivideCls.subdivide(m,s,i,o,n,c,h,e);m=t[0],this.setCalphaDrawnCoord(m,i,a);for(let e=0,t=p.length;e<t;++e)p[e].normalize();p=C.subdivideCls.subdivide(p,s,i,o,n,c,h,e)[0],s=t[2]}else{if(!r){let l=!1,r=C.subdivideCls.subdivide(e,s,i,o,n,c,h,l),a=C.subdivideCls.subdivide(t,s,i,o,n,c,h,l);e=r[0],t=a[0],s=r[2]}if(e.length<2)return;this.setCalphaDrawnCoord(e,i,a)}if(1===n){let s=u.coilWidth/2,i=4,l=!1;if(void 0!==d){let n,r,o=[],a=[];for(let c=0,h=e.length;c<h;++c){if(n=d[c],n!==r&&parseInt(n)!==parseInt(r)+1&&void 0!==r||c===h-1){let e=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(o),o.length,s,i,l),t=new THREE.Mesh(e,u.matShader);t.renderOrder=u.renderOrderPicking,u.mdl.add(t),u.prevHighlightObjects.push(t),e=null;let n=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(a),a.length,s,i,l);t=new THREE.Mesh(n,u.matShader),t.renderOrder=u.renderOrderPicking,u.mdl.add(t),u.prevHighlightObjects.push(t),n=null,o=[],a=[]}o.push(e[c]),a.push(t[c]),r=n}o=[],a=[]}else{let n=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(e),e.length,s,i,l),r=new THREE.Mesh(n,u.matShader);r.renderOrder=u.renderOrderPicking,u.mdl.add(r),u.prevHighlightObjects.push(r),n=null;let o=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(t),t.length,s,i,l);r=new THREE.Mesh(o,u.matShader),r.renderOrder=u.renderOrderPicking,u.mdl.add(r),u.prevHighlightObjects.push(r),o=null}}else{let i,r,o,a,d,c=new THREE.BufferGeometry,h=[],m=[],p=[],C=0,g=0,f=0;for(let n=0,c=e.length;n<c;++n)if(r=e[n],o=t[n],r&&o){for(let e=0;e<2;++e)h[C++]=r.x,h[C++]=r.y,h[C++]=r.z;for(let e=0;e<2;++e)h[C++]=o.x,h[C++]=o.y,h[C++]=o.z;n<c-1&&(i=t[n].clone().sub(e[n]).cross(e[n+1].clone().sub(e[n])).normalize().multiplyScalar(l)),a=e[n].clone().add(i),d=t[n].clone().add(i);for(let e=0;e<2;++e)h[C++]=a.x,h[C++]=a.y,h[C++]=a.z;for(let e=0;e<2;++e)h[C++]=d.x,h[C++]=d.y,h[C++]=d.z;for(let e=0;e<8;++e){let e=s[n]?s[n]:s[n-1]?s[n-1]:{r:0,g:0,b:0};m[g++]=e.r,m[g++]=e.g,m[g++]=e.b}}let b=[[0,2,-6,-8],[-4,-2,6,4],[7,3,-5,-1],[-3,-7,1,5]];for(let t=1,s=e.length;t<s;++t){let e=8*t;for(let t=0;t<4;++t)p[f++]=e+b[t][0],p[f++]=e+b[t][1],p[f++]=e+b[t][2],p[f++]=e+b[t][3],p[f++]=e+b[t][0],p[f++]=e+b[t][2]}let y,v=3,_=h.length/v-8;for(let t=0;t<4;++t){for(let e=0;e<v;++e)h[C++]=h[2*t*v+e];for(let e=0;e<v;++e)h[C++]=h[(_+2*t)*v+e];m[g++]=s[0].r,m[g++]=s[0].g,m[g++]=s[0].b;let i=s[e.length-1]?s[e.length-1]:s[e.length-2]?s[e.length-2]:{r:0,g:0,b:0};m[g++]=i.r,m[g++]=i.g,m[g++]=i.b}_+=8,p[f++]=_,p[f++]=_+2,p[f++]=_+6,p[f++]=_+4,p[f++]=_,p[f++]=_+6,p[f++]=_+1,p[f++]=_+5,p[f++]=_+7,p[f++]=_+3,p[f++]=_+1,p[f++]=_+7,c.setAttribute("position",new THREE.BufferAttribute(new Float32Array(h),v)),c.setAttribute("color",new THREE.BufferAttribute(new Float32Array(m),v)),c.setIndex(new THREE.BufferAttribute(new Uint32Array(p),1)),c.computeVertexNormals(),2===n?(y=new THREE.Mesh(c,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:u.frac,shininess:u.shininess,emissive:u.emissive,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),u.mdl.add(y),u.prevHighlightObjects.push(y)):(y=new THREE.Mesh(c,new THREE.MeshPhongMaterial({specular:u.frac,shininess:u.shininess,emissive:u.emissive,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),u.mdl.add(y),u.objects.push(y))}e=null,t=null}}setCalphaDrawnCoord(e,t,s){let i=this.icn3d;i.icn3dui;let l=0;if(void 0!==s)for(let n=0,r=e.length;n<r;n+=t){let t=s[l];i.atoms.hasOwnProperty(t)&&(i.atoms[t].coord2=e[n].clone()),++l}}}class p{constructor(e){this.icn3d=e}createCurveSub(e,t,s,i,l,n,r,o,a,d,c,h){let m,p=this.icn3d,u=p.icn3dui;if(!u.bNode&&0!==e.length){if(i=i||5,r)m=e;else{let t=!0,n=u.subdivideCls.subdivide(e,s,i,o,l,c,h,t);m=n[0],s=n[2]}if(0!==m.length){if(p.stripCls.setCalphaDrawnCoord(m,i,a),1===l){let e=p.coilWidth/2,t=4,s=!1;if(m.length>1)if(void 0!==d){let i,l,n=[];for(let r=0,o=m.length;r<o;++r){if(i=d[r],i!==l&&parseInt(i)!==parseInt(l)+1&&void 0!==l||r===o-1){let i=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(n),n.length,e,t,s),l=new THREE.Mesh(i,p.matShader);l.renderOrder=p.renderOrderPicking,p.mdl.add(l),p.prevHighlightObjects.push(l),i=null,n=[]}n.push(m[r]),l=i}n=[]}else{let i=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(m),m.length,e,t,s),l=new THREE.Mesh(i,p.matShader);l.renderOrder=p.renderOrderPicking,p.mdl.add(l),p.prevHighlightObjects.push(l),i=null}}else{let e,i=new THREE.BufferGeometry,r=[],o=[],a=0;if(2===l&&n)for(let t=0;t<m.length;++t,a+=3)m[t].addScalar(.6),r[a]=m[t].x,r[a+1]=m[t].y,r[a+2]=m[t].z,e=u.parasCls.thr(s[t]),o[a]=e.r,o[a+1]=e.g,o[a+2]=e.b;else for(let t=0;t<m.length;++t,a+=3)r[a]=m[t].x,r[a+1]=m[t].y,r[a+2]=m[t].z,e=u.parasCls.thr(s[t]),o[a]=e.r,o[a+1]=e.g,o[a+2]=e.b;let d=3;i.setAttribute("position",new THREE.BufferAttribute(new Float32Array(r),d)),i.setAttribute("color",new THREE.BufferAttribute(new Float32Array(o),d));let c=new THREE.Line(i,new THREE.LineBasicMaterial({linewidth:t,vertexColors:!0}));p.mdl.add(c),2===l?p.prevHighlightObjects.push(c):p.objects.push(c)}m=null}}}}class u{constructor(e){this.icn3d=e}createCurveSubArrow(e,t,s,i,l,n,r,o,a,d,c,h,m,p,u){if(this.icn3d.icn3dui.bNode)return;let C=[],g=[];C.push(e),g.push(o),this.prepareStrand(C,g,t,s,i,void 0,l,n,r,a,d,!1,c,h,m,p,u),C=[],g=[]}createStripArrow(e,t,s,i,l,n,r,o,a,d,c,h,m,p,u,C){if(this.icn3d.icn3dui.bNode)return;let g=[],f=[];g.push(e),g.push(t),f.push(o),f.push(a),this.prepareStrand(g,f,void 0,s,i,l,n,void 0,r,d,c,!0,h,m,p,u,C),g=[],f=[]}prepareStrand(e,t,s,i,l,n,r,o,a,d,c,h,m,p,u,C,g){let f=this.icn3d,b=f.icn3dui;if(1===d.length)return;let y=i,v=!u,_=[];_.push(i[i.length-2]),_.push(i[i.length-1]),l=l||f.axisDIV;let S,w,A,x,k=2/(a-1),O={};for(let e=0,s=t.length;e<s;++e)O[e]=[];let H=b.subdivideCls.subdivide(d,i,l,void 0,void 0,C,g)[0];if(1===H.length)return;let D,R=[],I=void 0===u||u?d.length-2:d.length;for(D=0;D<I;++D){for(let s=0,i=t.length;s<i;++s)O[s].push(e[s][D]);R.push(i[D])}if(R.push(i[D]),void 0===u||u)for(let e=0,s=t.length;e<s;++e)S=k*t[e]-1,w=H.length-1-l,A=d.length-2,x=new THREE.Vector3(H[w].x+c[A].x*S,H[w].y+c[A].y*S,H[w].z+c[A].z*S),O[e].push(x);let E,T=[];for(let e=0,s=t.length;e<s;++e)E=b.subdivideCls.subdivide(O[e],R,l,m,r),O[e]=E[0],i=E[2],0===e&&(T=E[1]);if(h?v?f.bDoublecolor?f.stripCls.createStrip(O[0],O[1],y,l,n,r,!0,void 0,p,T,C,g,d,c):f.stripCls.createStrip(O[0],O[1],i,l,n,r,!0,void 0,p,T,C,g,d,c):f.stripCls.createStrip(O[0],O[1],i,l,n,r,!0,void 0,p,T,C,g):f.curveCls.createCurveSub(O[0],s,i,l,r,o,!0,void 0,p,T,C,g),void 0===u||u){R=[],T=[];for(let e=0,s=t.length;e<s;++e){O[e]=[];for(let s=l*(d.length-2),i=l*(d.length-1);m[parseInt(s/l)]&&s<i;s+=l){let i=parseInt(s/l);for(let n=0;n<l;++n){let r=k*t[e]-1;r=r*1.8*(l-n)/l;let o=parseInt(s/l),a=new THREE.Vector3(H[s+n].x+c[o].x*r,H[s+n].y+c[o].y*r,H[s+n].z+c[o].z*r);a.smoothen=!0,O[e].push(a),R.push(_[0]),0===e&&T.push(i)}}let s=0,i=H.length-1,n=d.length-1,r=new THREE.Vector3(H[i].x+c[n].x*s,H[i].y+c[n].y*s,H[i].z+c[n].z*s);r.smoothen=!0,O[e].push(r),R.push(_[1]),0===e&&T.push(i)}H=[],h?f.stripCls.createStrip(O[0],O[1],R,l,n,r,!0,void 0,void 0,T,C,g):f.curveCls.createCurveSub(O[0],s,R,l,r,o,!0,void 0,void 0,T,C,g)}for(let e in O){for(let t=0,s=O[e].length;t<s;++t)O[e][t]=null;O[e]=[]}O={}}}class C{constructor(e){this.icn3d=e}createRepresentationSub(e,t,s){if(!this.icn3d.icn3dui.bNode)for(let i in e){let l=e[i];t&&t(l);for(let e in l.bonds){let t=this.icn3d.atoms[l.bonds[e]];void 0===t||t.serial<l.serial||t.chain===l.chain&&(t.resi===l.resi||"C"===l.name&&"N"===t.name||"O3'"===l.name&&"P"===t.name||"O3*"===l.name&&"P"===t.name||"SG"===l.name&&"SG"===t.name)&&s&&s(l,t)}}}}class g{constructor(e){this.icn3d=e}createBox(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui;if(o.bNode)return;void 0===t&&(t=.8),void 0===s&&(s=!1),void 0===i&&(i=.8),n?void 0===l&&(l=r.hColor):void 0===l&&(l=e.color);let a=s?t:(o.parasCls.vdwRadii[e.elem.toUpperCase()]||t)*(i||1);this.createBox_base(e.coord,a,l,n)}createBox_base(e,t,s,i,l,n){let r,o=this.icn3d;o.icn3dui.bNode||(new THREE.BoxGeometry(1,1,1),r=i||n?new THREE.Mesh(o.boxGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:o.frac,shininess:o.shininess,emissive:o.emissive,color:s})):new THREE.Mesh(o.boxGeometry,new THREE.MeshPhongMaterial({specular:o.frac,shininess:o.shininess,emissive:o.emissive,color:s})),r.scale.x=r.scale.y=r.scale.z=t,r.position.copy(e),o.mdl.add(r),i?o.prevHighlightObjects.push(r):l?o.prevOtherMesh.push(r):o.objects.push(r))}createBoxRepresentation_P_CA(e,t,s){let i=this.icn3d;if(i.icn3dui.bNode)return;let l=this;i.reprSubCls.createRepresentationSub(e,(function(e){"CA"!==e.name&&"O3'"!==e.name&&"O3*"!==e.name||l.createBox(e,void 0,void 0,t,void 0,s)}))}}class f{constructor(e){this.icn3d=e}createTube(e,t,s,i,l,n){let r=this.icn3d;if(r.icn3dui.bNode)return;let o,a,d,c,h,m=[],p=[],u=[],C=[],g=[],b=0,y=[];for(let n in e)if(c=e[n],c.name===t&&!c.het){if(0==b&&(d=c),c.structure,c.chain,(parseInt(c.resi)-1).toString(),b>0&&(o!==c.chain||Math.abs(c.coord.x-h.coord.x)>6||Math.abs(c.coord.y-h.coord.y)>6||Math.abs(c.coord.z-h.coord.z)>6||parseInt(a)+1<parseInt(c.resi)&&(Math.abs(c.coord.x-h.coord.x)>3||Math.abs(c.coord.y-h.coord.y)>3||Math.abs(c.coord.z-h.coord.z)>3))){if(2!==i){if(!isNaN(d.resi)&&!isNaN(h.resi)){let e=d.structure+"_"+d.chain+"_"+(parseInt(d.resi)-1).toString(),i=r.firstAtomObjCls.getAtomCoordFromResi(e,t);C=void 0!==i?[i]:[];let n=h.structure+"_"+h.chain+"_"+(parseInt(h.resi)+1).toString(),o=h.structure+"_"+h.chain+"_"+(parseInt(h.resi)+2).toString(),a=h.structure+"_"+h.chain+"_"+(parseInt(h.resi)+3).toString();if(r.residues.hasOwnProperty(n)){let e=r.firstAtomObjCls.getAtomFromResi(n,t);void 0!==e&&e.ssbegin&&(n=h.structure+"_"+h.chain+"_"+(parseInt(h.resi)+2).toString(),o=h.structure+"_"+h.chain+"_"+(parseInt(h.resi)+3).toString(),m.push(e.coord),l?u.push(f.getCustomtubesize(n)):u.push(this.getRadius(s,e)),p.push(e.color))}if(1==m.length&&r.residues.hasOwnProperty(n)){let e=r.firstAtomObjCls.getAtomFromResi(n,t);if(e){m.push(e.coord),p.push(e.color);let t=this.getRadius(s,c);u.push(t),n=o,o=a}}let b=r.firstAtomObjCls.getAtomCoordFromResi(n,t);void 0!==b&&g.push(b);let y=r.firstAtomObjCls.getAtomCoordFromResi(o,t);void 0!==y&&g.push(y)}y.push({pnts:m,colors:p,radii:u,prevone:C,nexttwo:g})}m=[],p=[],u=[],C=[],g=[],d=c,b=0}if(0==m.length&&!isNaN(c.resi)){let e=c.structure+"_"+c.chain+"_"+(parseInt(c.resi)-1).toString();r.residues.hasOwnProperty(e)&&(h=r.firstAtomObjCls.getAtomFromResi(e,t),void 0!==h&&h.ssend&&(m.push(h.coord),l?u.push(f.getCustomtubesize(e)):u.push(this.getRadius(s,h)),p.push(h.color)))}let e;m.push(c.coord),e=l?f.getCustomtubesize(c.structure+"_"+c.chain+"_"+c.resi):this.getRadius(s,c),u.push(e),p.push(c.color),1===b&&(p[p.length-2]=c.color),o=c.chain,a=c.resi;let n=1.2;2!==i||c.ssbegin||r.boxCls.createBox(c,void 0,void 0,n,void 0,i),++b,h=c}if(2!==i){if(C=[],void 0!==d&&!isNaN(d.resi)){let e=d.structure+"_"+d.chain+"_"+(parseInt(d.resi)-1).toString(),s=r.firstAtomObjCls.getAtomCoordFromResi(e,t);C=void 0!==s?[s]:[]}if(g=[],void 0!==c&&!isNaN(c.resi)){let e=c.structure+"_"+c.chain+"_"+(parseInt(c.resi)+1).toString(),i=c.structure+"_"+c.chain+"_"+(parseInt(c.resi)+2).toString(),l=c.structure+"_"+c.chain+"_"+(parseInt(c.resi)+3).toString();if(1==m.length&&r.residues.hasOwnProperty(e)){let n=r.firstAtomObjCls.getAtomFromResi(e,t);if(n){m.push(n.coord),p.push(n.color);let t=this.getRadius(s,c);u.push(t),e=i,i=l}}let n=r.firstAtomObjCls.getAtomCoordFromResi(e,t);void 0!==n&&g.push(n);let o=r.firstAtomObjCls.getAtomCoordFromResi(i,t);void 0!==o&&g.push(o)}y.push({pnts:m,colors:p,radii:u,prevone:C,nexttwo:g})}for(let e=0,t=y.length;e<t;++e){let t=y[e].pnts,s=y[e].colors,l=y[e].radii,r=y[e].prevone,o=y[e].nexttwo;this.createTubeSub(t,s,l,i,r,o,n)}y=[]}getCustomtubesize(e){let t=this.icn3d;t.icn3dui;let s=e.lastIndexOf("_"),i=e.substr(s+1),l=e.substr(0,s);return t.queryresi2score[l]&&t.queryresi2score[l].hasOwnProperty(i)?.01*t.queryresi2score[l][i]:t.coilWidth}createTubeSub(e,t,s,i,l,n,r){let o=this.icn3d,a=o.icn3dui;if(a.bNode)return;if(e.length<2)return;let d,c=o.tubeDIV,h=o.axisDIV,m=1/c,p=1/h,u=new THREE.BufferGeometry,C=[],g=[],f=[],b=0,y=0,v=0,_=a.subdivideCls.subdivide(e,t,h,void 0,void 0,l,n),S=_[0];t=_[2];let w,A=new THREE.Vector3;for(let e=0,i=S.length;e<i;++e){let l,n,r,o,h=(e-1)*p;if(0===e)l=s[0];else if(h%1==0)l=s[h];else{let e=Math.floor(h),t=h-e;l=s[e]*t+s[e+1]*(1-t)}e<i-1?(n=S[e].clone().sub(S[e+1]),r=new THREE.Vector3(0,-n.z,n.y).normalize().multiplyScalar(l),o=n.clone().cross(r).normalize().multiplyScalar(l),A.dot(r)<0&&(r.negate(),o.negate()),A=r,w=o):(r=A,o=w);for(let s=0;s<c;++s){let i=2*Math.PI*m*s,l=S[e].clone().add(r.clone().multiplyScalar(Math.cos(i))).add(o.clone().multiplyScalar(Math.sin(i)));C[b++]=l.x,C[b++]=l.y,C[b++]=l.z,d=e==t.length-1&&t.length>1?a.parasCls.thr(t[t.length-2]):a.parasCls.thr(t[e]),g[y++]=d.r,g[y++]=d.g,g[y++]=d.b}}let x,k=0;for(let e=0,t=S.length-1;e<t;++e){let e=0,t=3*k,s=new THREE.Vector3(C[t],C[t+1],C[t+2]);t=3*(k+c);let i=new THREE.Vector3(C[t],C[t+1],C[t+2]);t=3*(k+c+1);let l=new THREE.Vector3(C[t],C[t+1],C[t+2]),n=s.clone().sub(i).lengthSq(),r=s.clone().sub(l).lengthSq();n>r&&(n=r,e=1);for(let t=0;t<c;++t)f[v++]=k+t,f[v++]=k+(t+e)%c+c,f[v++]=k+(t+1)%c,f[v++]=k+(t+1)%c,f[v++]=k+(t+e)%c+c,f[v++]=k+(t+e+1)%c+c;k+=c}u.setAttribute("position",new THREE.BufferAttribute(new Float32Array(C),3)),u.setAttribute("color",new THREE.BufferAttribute(new Float32Array(g),3)),u.setIndex(new THREE.BufferAttribute(new Uint32Array(f),1)),u.computeVertexNormals(),2===i?(x=new THREE.Mesh(u,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:o.frac,shininess:o.shininess,emissive:o.emissive,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),o.mdl.add(x)):1===i?(x=new THREE.Mesh(u,o.matShader),x.renderOrder=o.renderOrderPicking,o.mdl.add(x)):(x=new THREE.Mesh(u,new THREE.MeshPhongMaterial({specular:o.frac,shininess:o.shininess,emissive:o.emissive,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),o.mdl.add(x)),1===i||2===i?o.prevHighlightObjects.push(x):o.objects.push(x)}getRadius(e,t){let s=this.icn3d;s.icn3dui;let i=e;return i=e||(t.b>0&&t.b<=100?.01*t.b:t.b>100?1:s.coilWidth),i}}class b{constructor(e){this.icn3d=e}createStrand(e,t,s,i,l,n,r,o,a){let d=this.icn3d,c=d.icn3dui;if(c.bNode)return;let h=!!i,m={};m=Object.keys(e).length<Object.keys(d.atoms).length?this.getSSExpandedAtoms(e):e,2===a&&(i?(i=!1,t=null,s=null,l=null,n=null,o=void 0):(i=!0,t=2,s=void 0,l=void 0,n=void 0,o=d.ribbonthickness)),t=t||d.strandDIV,s=s||d.axisDIV,l=l||d.coilWidth,r=r||!1,n=n||d.helixSheetWidth;let p={};for(let e=0;e<t;++e)p[e]=[];let u,C,g,f=[],b=[],y=[],v=[],_=[],S=null,w=null,A=null,x=null,k=null,O=null,H=null,D=null,R=!1,I=null,E=null,T=null,M=null,F=null,P=!1,L=!1,N={};d.bCalphaOnly=c.utilsCls.isCalphaPhosOnly(m);let $={};for(let e in m){let t=m[e];$[t.structure+"_"+t.chain+"_"+t.resi]=1}let U=Object.keys($).length,q=0,B=Object.keys(d.hAtoms).length==Object.keys(d.atoms).length,j=[];for(let c in m)if(g=m[c],("O"===g.name||"CA"===g.name)&&!g.het&&("CA"===g.name&&(e.hasOwnProperty(c)&&("helix"!==g.ss&&"sheet"!==g.ss||g.ssend||g.ssbegin)&&(N[c]=g),S=g.coord,A=g.color,M=g.serial,j.push(g.serial)),"O"===g.name||d.bCalphaOnly&&"CA"===g.name)){null==S&&(S=g.coord,A=g.color,M=g.serial),"O"===g.name&&(w=g.coord);let c=!0;if(u!==g.chain&&(c=!1),g.ssend&&"sheet"===g.ss?P=!0:g.ssend&&"helix"===g.ss&&(L=!0),k){1===a||2===a?_.push(d.hColor):_.push(O),C="coil"!==D&&"coil"===g.ss||R&&g.ssbegin||"coil"===D?l:n;let s,i,o=4;"O"===g.name?(s=k.clone(),null!=x?s.sub(x):(x=k.clone(),j.length>o+1?(s=x.clone(),i=d.atoms[j[j.length-1-o-1]].coord.clone(),i.sub(s)):s=new THREE.Vector3(Math.random(),Math.random(),Math.random()))):d.bCalphaOnly&&"CA"===g.name&&(j.length>o+1?(s=x.clone(),i=d.atoms[j[j.length-1-o-1]].coord.clone(),i.sub(s)):s=new THREE.Vector3(Math.random(),Math.random(),Math.random())),s.normalize(),s.multiplyScalar(C),null!==H&&s.dot(H)<0&&s.negate(),H=s;for(let e=0,s=2/(t-1);e<t;++e){let t=s*e-1,i=new THREE.Vector3(x.x+H.x*t,x.y+H.y*t,x.z+H.z*t);r||"sheet"!==D||(i.smoothen=!0),p[e].push(i)}f.push(x),b.push(H),e.hasOwnProperty(E)?(y.push(T),v.push(F)):(y.push(0),v.push(0)),++q}let m=6,N=!e.hasOwnProperty(g.serial)||x&&Math.abs(S.x-x.x)>m||x&&Math.abs(S.y-x.y)>m||x&&Math.abs(S.z-x.z)>m;if(N&&"sheet"===g.ss?P=!0:N&&"helix"===g.ss&&(L=!0),(g.ssbegin||g.ssend||q===U-1||N)&&p[0].length>0&&c){let c="CA",m=[],u=[];if(isNaN(d.atoms[E].resi))m=[];else{let e=d.atoms[E].structure+"_"+d.atoms[E].chain+"_"+(parseInt(d.atoms[E].resi)-1).toString(),t=d.firstAtomObjCls.getAtomCoordFromResi(e,c);m=void 0!==t?[t]:[]}if(!isNaN(d.atoms[E].resi)){let e=d.atoms[E].structure+"_"+d.atoms[E].chain+"_"+(parseInt(d.atoms[E].resi)+1).toString(),t=d.firstAtomObjCls.getAtomCoordFromResi(e,c);void 0!==t&&u.push(t);let s=d.atoms[E].structure+"_"+d.atoms[E].chain+"_"+(parseInt(d.atoms[E].resi)+2).toString(),i=d.firstAtomObjCls.getAtomCoordFromResi(s,c);void 0!==i&&u.push(i)}if(!N){1===a||2===a?_.push(d.hColor):_.push(O),C=g.ssend&&"sheet"===g.ss?0:"coil"===D&&g.ssbegin||R&&g.ssbegin||"coil"===g.ss?l:n;let s,i,o=4;"O"===g.name?(s=w.clone(),s.sub(S)):d.bCalphaOnly&&"CA"===g.name&&(j.length>o?(s=S.clone(),i=d.atoms[j[j.length-1-o]].coord.clone(),i.sub(s)):s=new THREE.Vector3(Math.random(),Math.random(),Math.random())),s.normalize(),s.multiplyScalar(C),null!==H&&s.dot(H)<0&&s.negate(),H=s;for(let e=0,s=2/(t-1);e<t;++e){let t=s*e-1,i=new THREE.Vector3(S.x+H.x*t,S.y+H.y*t,S.z+H.z*t);r||"sheet"!==D||(i.smoothen=!0),p[e].push(i)}I=g.serial,f.push(S),b.push(H),e.hasOwnProperty(I)?(y.push(g.resi),v.push(M)):(y.push(0),v.push(0))}for(let e=0;!i&&e<t;++e)P?d.curveStripArrowCls.createCurveSubArrow(p[e],1,_,s,a,h,t,e,f,b,y,v,!0,m,u):L&&(B?d.curveCls.createCurveSub(p[e],1,_,s,a,h,!1,y,v,void 0,m,u):d.curveStripArrowCls.createCurveSubArrow(p[e],1,_,s,a,h,t,e,f,b,y,v,!1,m,u));if(i)if(P){let e=0,i=t-1;d.curveStripArrowCls.createStripArrow(p[0],p[t-1],_,s,o,a,t,e,i,f,b,y,v,!0,m,u)}else if(L)if(B)d.stripCls.createStrip(p[0],p[t-1],_,s,o,a,!1,y,v,void 0,m,u,f,b);else{let e=0,i=t-1;d.curveStripArrowCls.createStripArrow(p[0],p[t-1],_,s,o,a,t,e,i,f,b,y,v,!1,m,u)}else 2===a&&d.stripCls.createStrip(p[0],p[t-1],_,s,o,a,!1,y,v,void 0,m,u,f,b);for(let e=0;e<t;++e)p[e]=[];_=[],f=[],b=[],y=[],v=[],P=!1,L=!1}if(u!==g.chain&&p[0].length>0){let e="CA",l=[],n=[];if(isNaN(d.atoms[E].resi))l=[];else{let t=d.atoms[E].structure+"_"+d.atoms[E].chain+"_"+(parseInt(d.atoms[E].resi)-1).toString();d.firstAtomObjCls.getAtomCoordFromResi(t,e)}for(let e=0;!i&&e<t;++e)P?d.curveStripArrowCls.createCurveSubArrow(p[e],1,_,s,a,h,t,e,f,b,y,v,!0,l,n):L&&(B?d.curveCls.createCurveSub(p[e],1,_,s,a,h,!1,y,v,void 0,l,n):d.curveStripArrowCls.createCurveSubArrow(p[e],1,_,s,a,h,t,e,f,b,y,v,!1,l,n));if(i)if(P){let e=0,i=t-1;d.curveStripArrowCls.createStripArrow(p[0],p[t-1],_,s,o,a,t,e,i,f,b,y,v,!0,l,n)}else if(L)if(B)d.stripCls.createStrip(p[0],p[t-1],_,s,o,a,!1,y,v,void 0,l,n,f,b);else{let e=0,i=t-1;d.curveStripArrowCls.createStripArrow(p[0],p[t-1],_,s,o,a,t,e,i,f,b,y,v,!1,l,n)}for(let e=0;e<t;++e)p[e]=[];_=[],f=[],b=[],y=[],v=[],P=!1,L=!1}u=g.chain,D=g.ss,R=g.ssend,E=g.serial,T=g.resi,F=M,x=S,k=g.coord,O=A}j=[],d.tubeCls.createTube(N,"CA",l,a),N={},p={}}getSSExpandedAtoms(e,t){let s,i,l,n,r,o,a,d,c=this.icn3d,h=c.icn3dui,m=0,p=Object.keys(e).length,u=h.hashUtilsCls.cloneHash(e);for(let C in e){if(s=e[C].structure+"_"+e[C].chain,i=e[C].resi,l=e[C],void 0===n&&(a=e[C]),s!==n&&void 0!==n||i!==r&&i!==parseInt(r)+1&&void 0!==r||m===p-1){s!==n&&void 0!==n||i!==r&&i!==parseInt(r)+1&&void 0!==r?d=o:m===p-1&&(d=l);let C=a.resi;if(!isNaN(a.resi)&&"coil"!==a.ss&&!a.ssbegin){for(let e=parseInt(a.resi)-1;e>0;--e){let t=a.structure+"_"+a.chain+"_"+e;if(!c.residues.hasOwnProperty(t))break;let s=c.firstAtomObjCls.getFirstCalphaAtomObj(c.residues[t]);if(s.ss===a.ss&&s.ssbegin){C=s.resi;break}}for(let e=C;e<a.resi;++e){let t=a.structure+"_"+a.chain+"_"+e;u=h.hashUtilsCls.unionHash(u,h.hashUtilsCls.hash2Atoms(c.residues[t],c.atoms))}}if(!isNaN(a.resi)&&3===c.pk&&1===t&&"coil"===a.ss){let t=a.structure+"_"+a.chain+"_"+(parseInt(a.resi)-1).toString();c.residues.hasOwnProperty(t)&&(u=h.hashUtilsCls.unionHash(u,h.hashUtilsCls.hash2Atoms(c.residues[t],c.atoms)),e=h.hashUtilsCls.unionHash(e,h.hashUtilsCls.hash2Atoms(c.residues[t],c.atoms)))}let g=d.resi;if(void 0!==d.ss&&"coil"!==d.ss&&!d.ssend&&!d.notshow){let e=c.firstAtomObjCls.getLastAtomObj(c.chains[d.structure+"_"+d.chain]).resi;for(let t=parseInt(d.resi)+1;t<=parseInt(e);++t){let e=d.structure+"_"+d.chain+"_"+t;if(!c.residues.hasOwnProperty(e))break;let s=c.firstAtomObjCls.getFirstCalphaAtomObj(c.residues[e]);if(s.ss===d.ss&&s.ssend){g=s.resi;break}}for(let e=parseInt(d.resi)+1;e<=parseInt(g);++e){let t=d.structure+"_"+d.chain+"_"+e;u=h.hashUtilsCls.unionHash(u,h.hashUtilsCls.hash2Atoms(c.residues[t],c.atoms))}}if(3===c.pk&&1===t&&"coil"===d.ss){let t=d.structure+"_"+d.chain+"_"+(parseInt(d.resi)+1).toString();c.residues.hasOwnProperty(t)&&(u=h.hashUtilsCls.unionHash(u,h.hashUtilsCls.hash2Atoms(c.residues[t],c.atoms)),e=h.hashUtilsCls.unionHash(e,h.hashUtilsCls.hash2Atoms(c.residues[t],c.atoms)))}d.notshow&&(d.notshow=void 0),a=l}n=s,r=i,o=l,++m}return u}}class y{constructor(e){this.icn3d=e}createBrick(e,t,s,i){let l=this.icn3d;if(l.icn3dui.bNode)return;let n=new THREE.CylinderGeometry(1,1,1,4,1),r=new THREE.Mesh(n,new THREE.MeshPhongMaterial({specular:l.frac,shininess:l.shininess,emissive:l.emissive,color:i}));r.position.copy(e).add(t).multiplyScalar(.5),r.matrixAutoUpdate=!1,r.lookAt(t.clone().sub(e)),r.updateMatrix(),r.matrix.multiply((new THREE.Matrix4).makeScale(s,s,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),l.mdl.add(r)}}class v{constructor(e){this.icn3d=e}createLineRepresentation(e,t){let s=this.icn3d;if(s.icn3dui.bNode)return;let i=new THREE.BufferGeometry,l=[],n=[],r=0,o=0;s.reprSubCls.createRepresentationSub(e,void 0,(function(e,t){if(e.color===t.color)l[r++]=e.coord.x,l[r++]=e.coord.y,l[r++]=e.coord.z,l[r++]=t.coord.x,l[r++]=t.coord.y,l[r++]=t.coord.z,n[o++]=e.color.r,n[o++]=e.color.g,n[o++]=e.color.b,n[o++]=t.color.r,n[o++]=t.color.g,n[o++]=t.color.b;else{let s=e.coord.clone().add(t.coord).multiplyScalar(.5);l[r++]=e.coord.x,l[r++]=e.coord.y,l[r++]=e.coord.z,l[r++]=s.x,l[r++]=s.y,l[r++]=s.z,l[r++]=t.coord.x,l[r++]=t.coord.y,l[r++]=t.coord.z,l[r++]=s.x,l[r++]=s.y,l[r++]=s.z,n[o++]=e.color.r,n[o++]=e.color.g,n[o++]=e.color.b,n[o++]=e.color.r,n[o++]=e.color.g,n[o++]=e.color.b,n[o++]=t.color.r,n[o++]=t.color.g,n[o++]=t.color.b,n[o++]=t.color.r,n[o++]=t.color.g,n[o++]=t.color.b}}));if(i.setAttribute("position",new THREE.BufferAttribute(new Float32Array(l),3)),i.setAttribute("color",new THREE.BufferAttribute(new Float32Array(n),3)),2!==t){let e;1===t||(e=new THREE.LineSegments(i,new THREE.LineBasicMaterial({linewidth:s.linewidth,vertexColors:!0})),s.mdl.add(e)),1===t?s.prevHighlightObjects.push(e):s.objects.push(e)}else 2===t&&s.boxCls.createBoxRepresentation_P_CA(e,.8,t)}createConnCalphSidechain(e,t){let s=this.icn3d;if(s.icn3dui.bNode)return;let i={};for(let s in e){let l=e[s];if(!l.het&&l.style2===t){i[l.structure+"_"+l.chain+"_"+l.resi]=1}}let l=[],n=[];for(let e in i){let t=s.firstAtomObjCls.getFirstAtomObjByName(s.residues[e],"CA");if(void 0!==t)for(let e=0,i=t.bonds.length;e<i;++e){let i=s.atoms[t.bonds[e]];("HA"===i.name||"C"!==i.name&&"N"!==i.name&&"H"!==i.elem&&i.resi==t.resi)&&(l.push(t.coord),l.push(i.coord),n.push(t.color),n.push(i.color))}if(t=s.firstAtomObjCls.getFirstAtomObjByName(s.residues[e],"N"),void 0!==t)for(let e=0,i=t.bonds.length;e<i;++e){let i=s.atoms[t.bonds[e]];"H"===i.name&&(l.push(t.coord),l.push(i.coord),n.push(t.color),n.push(i.color))}}for(let e=0,i=l.length;e<i;e+=2)if("ball and stick"===t||"stick"===t){let i="stick"===t?s.cylinderRadius:.5*s.cylinderRadius;s.cylinderCls.createCylinder(l[e],l[e+1],i,n[e+1])}else if("lines"===t){let t=this.createSingleLine(l[e],l[e+1],n[e+1],!1,.5);s.mdl.add(t)}}createSingleLine(e,t,s,i,l){if(this.icn3d.icn3dui.bNode)return;let n,r=new THREE.BufferGeometry,o=[];n=i?new THREE.LineDashedMaterial({linewidth:1,color:s,dashSize:l,gapSize:.5*l}):new THREE.LineBasicMaterial({linewidth:1,color:s}),o[0]=e.x,o[1]=e.y,o[2]=e.z,o[3]=t.x,o[4]=t.y,o[5]=t.z;r.setAttribute("position",new THREE.BufferAttribute(new Float32Array(o),3));let a=new THREE.LineSegments(r,n);return i&&a.computeLineDistances(),a}createLines(e){let t=this.icn3d,s=t.icn3dui;if(!s.bNode&&void 0!==e)for(let i in e){let l=e[i];for(let e=0,n=l.length;e<n;++e){let n=l[e],r=n.position1,o=n.position2,a=!!n.dashed&&n.dashed,d=.3,c=t.lineRadius,h="#"+n.color.replace(/\#/g,""),m=s.parasCls.thr(h);if(a){let e,s,l=r.distanceTo(o),n=parseInt(l/d),a=o.clone().sub(r).multiplyScalar(d/l);for(let l=0;l<n;++l)l%2==1&&(e=r.clone().add(a.clone().multiplyScalar(l)),s=r.clone().add(a.clone().multiplyScalar(l+1)),"stabilizer"==i?t.brickCls.createBrick(e,s,c,m):t.cylinderCls.createCylinder(e,s,c,m))}else"stabilizer"==i?t.brickCls.createBrick(r,o,c,m):t.cylinderCls.createCylinder(r,o,c,m)}}}}class _{constructor(e){this.icn3d=e}createSphere(e,t,s,i,l){let n=this.icn3d.icn3dui;if(n.bNode)return;void 0===t&&(t=.8),void 0===s&&(s=!1);let r=n.parasCls.vdwRadii[e.elem.toUpperCase()]||t;s&&(r=t,i=1),this.createSphereBase(e.coord,e.color,r,i,l)}createSphereBase(e,t,s,i,l,n){let r,o=this.icn3d,a=o.icn3dui;if(!a.bNode){if(void 0===i&&(i=1),2===l)i*=1.5,t=o.hColor,r=new THREE.Mesh(o.sphereGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:o.frac,shininess:o.shininess,emissive:o.emissive,color:t})),r.scale.x=r.scale.y=r.scale.z=s*(i||1),r.position.copy(e),o.mdl.add(r);else if(1===l)r=new THREE.Mesh(o.sphereGeometry,o.matShader),r.scale.x=r.scale.y=r.scale.z=s*(i||1),r.position.copy(e),r.renderOrder=o.renderOrderPicking,o.mdl.add(r);else if(void 0===t&&(t=a.parasCls.defaultAtomColor),r=n?new THREE.Mesh(o.sphereGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:o.frac,shininess:o.shininess,emissive:o.emissive,color:t})):new THREE.Mesh(o.sphereGeometry,new THREE.MeshPhongMaterial({specular:o.frac,shininess:o.shininess,emissive:o.emissive,color:t})),r.scale.x=r.scale.y=r.scale.z=s*(i||1),r.position.copy(e),o.bImpo&&!n){o.posArraySphere.push(e.x),o.posArraySphere.push(e.y),o.posArraySphere.push(e.z),o.colorArraySphere.push(t.r),o.colorArraySphere.push(t.g),o.colorArraySphere.push(t.b);let l=s*(i||1);o.radiusArraySphere.push(l),o.cnt<=o.maxatomcnt&&o.mdl_ghost.add(r)}else o.mdl.add(r);1===l||2===l?o.bImpo?o.cnt<=o.maxatomcnt&&o.prevHighlightObjects_ghost.push(r):o.prevHighlightObjects.push(r):o.bImpo?o.cnt<=o.maxatomcnt&&o.objects_ghost.push(r):o.objects.push(r)}}createSphereRepresentation(e,t,s,i,l){let n=this.icn3d;if(n.icn3dui.bNode)return;let r=this;n.reprSubCls.createRepresentationSub(e,(function(e){r.createSphere(e,t,s,i,l)}))}}class S{constructor(e){this.icn3d=e}createCylinder(e,t,s,i,l,n,r,o){let a,d=this.icn3d,c=d.icn3dui;c.bNode||(1===l?(a=new THREE.Mesh(d.cylinderGeometryOutline,d.matShader),a.position.copy(e).add(t).multiplyScalar(.5),a.matrixAutoUpdate=!1,a.lookAt(t.clone().sub(e)),a.updateMatrix(),a.matrix.multiply((new THREE.Matrix4).makeScale(s,s,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),a.renderOrder=d.renderOrderPicking,d.mdl.add(a),d.prevHighlightObjects.push(a)):(2===l?(a=new THREE.Mesh(d.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:d.frac,shininess:d.shininess,emissive:d.emissive,color:i})),s*=1.5):a=o?new THREE.Mesh(d.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:d.frac,shininess:d.shininess,emissive:d.emissive,color:i})):new THREE.Mesh(d.cylinderGeometry,new THREE.MeshPhongMaterial({specular:d.frac,shininess:d.shininess,emissive:d.emissive,color:i})),a.position.copy(e).add(t).multiplyScalar(.5),a.matrixAutoUpdate=!1,a.lookAt(t.clone().sub(e)),a.updateMatrix(),a.matrix.multiply((new THREE.Matrix4).makeScale(s,s,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),d.bImpo&&!o?(d.posArray.push(e.x),d.posArray.push(e.y),d.posArray.push(e.z),i||(i=c.parasCls.thr(16777215)),d.colorArray.push(i.r),d.colorArray.push(i.g),d.colorArray.push(i.b),d.pos2Array.push(t.x),d.pos2Array.push(t.y),d.pos2Array.push(t.z),void 0!==n?(d.color2Array.push(n.r),d.color2Array.push(n.g),d.color2Array.push(n.b)):(d.color2Array.push(i.r),d.color2Array.push(i.g),d.color2Array.push(i.b)),d.radiusArray.push(s),d.cnt<=d.maxatomcnt&&d.mdl_ghost.add(a)):d.mdl.add(a),2===l?d.bImpo?d.cnt<=d.maxatomcnt&&d.prevHighlightObjects_ghost.push(a):d.prevHighlightObjects.push(a):d.bImpo?d.cnt<=d.maxatomcnt&&d.objects_ghost.push(a):(void 0===r||r)&&d.objects.push(a)))}createCylinder_base(e,t,s,i,l,n,r){let o=this.icn3d;if(o.icn3dui.bNode)return;let a=new THREE.Mesh(o.cylinderGeometry,new THREE.MeshPhongMaterial({specular:o.frac,shininess:o.shininess,emissive:o.emissive,color:i}));return a.position.copy(e).add(t).multiplyScalar(.5),a.matrixAutoUpdate=!1,a.lookAt(t.clone().sub(e)),a.updateMatrix(),a.matrix.multiply((new THREE.Matrix4).makeScale(s,s,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),a}createCylinderHelix(e,t,s){let i=this.icn3d;if(i.icn3dui.bNode)return;let l,n,r,o=null,a={},d={};for(r in e){let c=e[r];c.het||(("helix"!==c.ss&&"sheet"!==c.ss||c.ssend||c.ssbegin)&&(a[c.serial]=c),"sheet"===c.ss&&(d[c.serial]=c),"CA"===c.name&&("helix"===c.ss&&c.ssend&&(null!==o&&l===c.chain&&n<c.resi&&(1===s||2===s?this.createCylinder(o.coord,c.coord,t,i.hColor,s):this.createCylinder(o.coord,c.coord,t,c.color)),o=null),null===o&&"helix"===c.ss&&c.ssbegin&&(o=c,l=c.chain,n=c.resi)))}1===s||2===s?(Object.keys(a).length>0&&i.tubeCls.createTube(a,"CA",i.coilWidth,s),Object.keys(d).length>0&&i.strandCls.createStrand(d,void 0,void 0,!0,0,i.helixSheetWidth,!1,2*i.ribbonthickness,s)):(Object.keys(a).length>0&&i.tubeCls.createTube(a,"CA",i.coilWidth),Object.keys(d).length>0&&i.strandCls.createStrand(d,void 0,void 0,!0,0,i.helixSheetWidth,!1,2*i.ribbonthickness))}createCylinderCurve(e,t,s,i,l){let n=this.icn3d;if(n.icn3dui.bNode)return;let r,o,a,d,c=null;for(a in e)if(d=e[a],!d.het&&-1!=t.indexOf(d.name)){if(null!==c&&r===d.chain&&o!=d.resi&&Math.abs(c.coord.x-d.coord.x)<8&&Math.abs(c.coord.y-d.coord.y)<8&&Math.abs(c.coord.z-d.coord.z)<8){let e=c.coord.clone().add(d.coord).multiplyScalar(.5);if(l)1===l&&(this.createCylinder(c.coord,e,s,c.color,l),this.createCylinder(e,d.coord,s,d.color,l),n.sphereCls.createSphere(d,s,!0,1,l));else if(i){let t=n.lineCls.createSingleLine(c.coord,e,c.color,!1);n.mdl.add(t),n.objects.push(t),t=n.lineCls.createSingleLine(e,d.coord,d.color,!1),n.mdl.add(t),n.objects.push(t)}else this.createCylinder(c.coord,e,s,c.color),this.createCylinder(e,d.coord,s,d.color),n.sphereCls.createSphere(d,s,!0,1,l)}c=d,r=d.chain,o=d.resi,n.sphereCls.createSphere(d,s,!0,1,l),2===l&&n.boxCls.createBox(d,void 0,void 0,void 0,void 0,l)}if(null!==c&&r===d.chain&&o!=d.resi&&Math.abs(c.coord.x-d.coord.x)<8&&Math.abs(c.coord.y-d.coord.y)<8&&Math.abs(c.coord.z-d.coord.z)<8){let e=c.coord.add(d.coord).multiplyScalar(.5);if(l)1===l&&(this.createCylinder(c.coord,e,s,c.color,l),this.createCylinder(e,d.coord,s,d.color,l),n.sphereCls.createSphere(d,s,!0,1,l));else if(i){let t=n.lineCls.createSingleLine(c.coord,e,c.color,!1);n.mdl.add(t),n.objects.push(t),t=n.lineCls.createSingleLine(e,d.coord,d.color,!1),n.mdl.add(t),n.objects.push(t)}else this.createCylinder(c.coord,e,s,c.color),this.createCylinder(e,d.coord,s,d.color)}}}class w{constructor(e){this.icn3d=e}applyClbondsOptions(e){let t=this.icn3d,s=t.icn3dui;if(void 0===e&&(e=t.opts),t.bCalcCrossLink||(t.clbondpnts={},t.clbondResid2serial={},this.applyClbondsOptions_base("chemical"),this.applyClbondsOptions_base("all"),t.bCalcCrossLink=!0),"yes"===e.clbonds.toLowerCase()&&"nothing"!==e.chemicals){let e="#006400",i=s.parasCls.thr(25600);if(t.lines.clbond=[],t.residuesHashClbonds={},t.structures){let l=Object.keys(t.structures);for(let n=0,r=l.length;n<r;++n){let r=l[n];if(t.clbondpnts[r])for(let l=0,n=t.clbondpnts[r].length;l<n;l+=2){let n=t.clbondpnts[r][l],o=t.clbondpnts[r][l+1],a={};if(a.color=e,a.dashed=!1,a.serial1=t.clbondResid2serial[n+","+o],a.serial2=t.clbondResid2serial[o+","+n],!t.dAtoms.hasOwnProperty(a.serial1)||!t.dAtoms.hasOwnProperty(a.serial2))continue;a.position1=t.atoms[a.serial1].coord,a.position2=t.atoms[a.serial2].coord,t.lines.clbond.push(a),t.cylinderCls.createCylinder(a.position1,a.position2,t.cylinderRadius,i);let d={};d=s.hashUtilsCls.unionHash(d,t.residues[n]),d=s.hashUtilsCls.unionHash(d,t.residues[o]);let c=s.hashUtilsCls.intHash(d,t.sidec);for(let e in c)t.atoms[e].style2="stick";t.residuesHashClbonds[n]=1,t.residuesHashClbonds[o]=1}}}}return t.residuesHashClbonds}applyClbondsOptions_base(e){let t=this.icn3d;t.icn3dui;for(let s in t.chemicals){let i=t.atoms[s],l=i.structure+"_"+i.chain+"_"+i.resi;for(let s in i.bonds){let n=t.atoms[i.bonds[s]];if(void 0!==n&&(n.chain!==i.chain||n.resi!==i.resi)){let s=n.structure+"_"+n.chain+"_"+n.resi;if("chemical"!=e||n.het){if("chemical"==e)continue;void 0===t.clbondpnts[i.structure]&&(t.clbondpnts[i.structure]=[]),t.clbondpnts[i.structure].push(l),t.clbondpnts[n.structure].push(s),t.clbondResid2serial[l+","+s]=i.serial,t.clbondResid2serial[s+","+l]=n.serial}}}}}}class A{constructor(e){this.icn3d=e}getAtomsWithinAtom(e,t,s,i,l,n,r){let o=this.icn3d;o.icn3dui;let a=this.getNeighboringAtoms(e,t,s,r);i&&(o.resid2Residhash={});let d={};for(let e in t){let c,h,m=o.atoms[e],p=m.structure+"_"+m.chain+"_"+m.resi;for(let e in o.residues[p])if(o.atoms[e]&&("CA"===o.atoms[e].name&&"C"===o.atoms[e].elem||"O3'"===o.atoms[e].name||"O3*"===o.atoms[e].name)){c=o.atoms[e];break}void 0===c&&(c=m),i&&(h=m.resn+" $"+m.structure+"."+m.chain+":"+m.resi,void 0===o.resid2Residhash[h]&&(o.resid2Residhash[h]={}));let u=m.structure+"_"+m.chain+"_"+m.resi;for(let e in a){let p=a[e];if(!o.crossstrucinter&&m.structure!=p.structure)continue;if(!r&&p.serial in t)continue;if(o.bOpm&&"DUM"===p.resn)continue;let C=p.coord.distanceTo(m.coord);if(C<s){let e,t;d[p.serial]=p,l&&(d[m.serial]=m);let s=p.structure+"_"+p.chain+"_"+p.resi;for(let t in o.residues[s])if("CA"===o.atoms[t].name&&"C"===o.atoms[t].elem||"O3'"===o.atoms[t].name||"O3*"===o.atoms[t].name){e=o.atoms[t];break}if(void 0===e&&(e=p),l&&(o.contactpnts.push({serial:e.serial,coord:e.coord}),o.contactpnts.push({serial:c.serial,coord:c.coord})),i){let s=p.structure+"_"+p.chain+"_"+p.resi;t=p.resn+" $"+p.structure+"."+p.chain+":"+p.resi;let i=C.toFixed(1),l=e.coord.distanceTo(c.coord).toFixed(1),r=u+"_"+m.resn+","+s+"_"+p.resn,a=h+","+t;if((void 0===o.resids2interAll[r]||void 0===o.resids2interAll[r].contact||!o.resids2interAll[r].contact.hasOwnProperty(a)||void 0!==o.resids2interAll[r].hbond&&!o.resids2interAll[r].hbond.hasOwnProperty(a)||void 0!==o.resids2interAll[r].ionic&&!o.resids2interAll[r].ionic.hasOwnProperty(a)||void 0!==o.resids2interAll[r].halogen&&!o.resids2interAll[r].halogen.hasOwnProperty(a)||void 0!==o.resids2interAll[r]["pi-cation"]&&!o.resids2interAll[r]["pi-cation"].hasOwnProperty(a)||void 0!==o.resids2interAll[r]["pi-stacking"]&&!o.resids2interAll[r]["pi-stacking"].hasOwnProperty(a))&&(void 0===o.resid2Residhash[h][t]||i<o.resid2Residhash[h][t].split("_")[0])){let e=void 0===o.resid2Residhash[h][t]?1:parseInt(o.resid2Residhash[h][t].split("_")[4])+1;o.resid2Residhash[h][t]=i+"_"+l+"_"+m.name+"_"+p.name+"_"+e,n||(void 0===o.resids2inter[r]&&(o.resids2inter[r]={}),void 0===o.resids2inter[r].contact&&(o.resids2inter[r].contact={}),o.resids2inter[r].contact[h+","+t]=i+"_"+l+"_"+m.name+"_"+p.name+"_"+e),void 0===o.resids2interAll[r]&&(o.resids2interAll[r]={}),void 0===o.resids2interAll[r].contact&&(o.resids2interAll[r].contact={}),o.resids2interAll[r].contact[h+","+t]=i+"_"+l+"_"+m.name+"_"+p.name+"_"+e}}}}}return d}getNeighboringAtoms(e,t,s,i){let l=this.icn3d;l.icn3dui;let n=this.getExtent(t),r=(n[2][0]-n[0][0])*(n[2][0]-n[0][0])+(n[2][1]-n[0][1])*(n[2][1]-n[0][1])+(n[2][2]-n[0][2])*(n[2][2]-n[0][2]),o=(n[2][0]-n[1][0])*(n[2][0]-n[1][0])+(n[2][1]-n[1][1])*(n[2][1]-n[1][1])+(n[2][2]-n[1][2])*(n[2][2]-n[1][2]),a=r>o?r:o,d=Math.sqrt(a),c=(d+s)*(d+s),h={};for(let r in e){let e=l.atoms[r];!i&&t.hasOwnProperty(e.serial)||(this.bOpm&&"DUM"===e.resn||e.coord.x<n[0][0]-s||e.coord.x>n[1][0]+s||e.coord.y<n[0][1]-s||e.coord.y>n[1][1]+s||e.coord.z<n[0][2]-s||e.coord.z>n[1][2]+s||(e.coord.x-n[2][0])*(e.coord.x-n[2][0])+(e.coord.y-n[2][1])*(e.coord.y-n[2][1])+(e.coord.z-n[2][2])*(e.coord.z-n[2][2])<c&&(h[e.serial]=e))}return h}getExtent(e){let t,s,i,l,n,r,o,a,d,c,h,m=this.icn3d;for(h in m.icn3dui,t=s=i=9999,l=n=r=-9999,o=a=d=c=0,e){let e=m.atoms[h];c++,o+=e.coord.x,a+=e.coord.y,d+=e.coord.z,t=t<e.coord.x?t:e.coord.x,s=s<e.coord.y?s:e.coord.y,i=i<e.coord.z?i:e.coord.z,l=l>e.coord.x?l:e.coord.x,n=n>e.coord.y?n:e.coord.y,r=r>e.coord.z?r:e.coord.z}return[[t,s,i],[l,n,r],[o/c,a/c,d/c]]}hideContact(){let e=this.icn3d;e.icn3dui,e.opts.contact="no",void 0===e.lines&&(e.lines={}),e.lines.contact=[],e.contactpnts=[];for(let t in e.atoms)e.atoms[t].style2="nothing";for(let t in e.sidec)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style2=e.opts.sidec);for(let t in e.water)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style=e.opts.water)}}class x{constructor(e){this.icn3d=e,this.ISDONE=2;this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}}x.prototype.march=function(e,t,s,i){let l=!!i.fulltable,n=i.hasOwnProperty("origin")&&i.origin.hasOwnProperty("x")?i.origin:{x:0,y:0,z:0},r=!!i.voxel,o=i.matrix,a=i.nX||0,d=i.nY||0,c=i.nZ||0,h=i.scale||1,m=null;m=i.unitCube?i.unitCube:{x:h,y:h,z:h};let p,u,C=new Int32Array(a*d*c);for(p=0,u=C.length;p<u;++p)C[p]=-1;let g=function(e,s,i,l,a,h){let p={x:0,y:0,z:0},u=a;!!!(l&1<<a)&&!!(l&1<<h)&&(u=h),1&u&&i++,2&u&&s++,4&u&&e++,o?(p=new THREE.Vector3(e,s,i),p=p.applyMatrix4(o),p={x:p.x,y:p.y,z:p.z}):(p.x=n.x+m.x*e,p.y=n.y+m.y*s,p.z=n.z+m.z*i);let g=(d*e+s)*c+i;return r?(t.push(p),t.length-1):(C[g]<0&&(C[g]=t.length,t.push(p)),C[g])},f=new Int32Array(12),b=l?this.edgeTable2:this.edgeTable,y=l?this.triTable2:this.triTable;for(p=0;p<a-1;++p)for(let i=0;i<d-1;++i)for(let l=0;l<c-1;++l){let n=0;for(let t=0;t<8;++t){n|=!!(e[(d*(p+((4&t)>>2))+i+((2&t)>>1))*c+l+(1&t)]&this.ISDONE)<<t}if(0===n||255===n)continue;let o=b[n];if(0===o)continue;let a=y[n];1&o&&(f[0]=g(p,i,l,n,0,1)),2&o&&(f[1]=g(p,i,l,n,1,3)),4&o&&(f[2]=g(p,i,l,n,3,2)),8&o&&(f[3]=g(p,i,l,n,2,0)),16&o&&(f[4]=g(p,i,l,n,4,5)),32&o&&(f[5]=g(p,i,l,n,5,7)),64&o&&(f[6]=g(p,i,l,n,7,6)),128&o&&(f[7]=g(p,i,l,n,6,4)),256&o&&(f[8]=g(p,i,l,n,0,4)),512&o&&(f[9]=g(p,i,l,n,1,5)),1024&o&&(f[10]=g(p,i,l,n,3,7)),2048&o&&(f[11]=g(p,i,l,n,2,6));for(let e=0;e<a.length;e+=3){let i=f[a[e]],l=f[a[e+1]],n=f[a[e+2]];r&&e>=3&&(t.push(t[i]),i=t.length-1,t.push(t[l]),l=t.length-1,t.push(t[n]),n=t.length-1),s.push(i),s.push(l),s.push(n)}}},x.prototype.laplacianSmooth=function(e,t,s){let i,l,n,r,o,a=new Array(t.length);for(i=0,l=t.length;i<l;i++)a[i]={x:0,y:0,z:0};let d,c=new Array(20);for(i=0;i<20;i++)c[i]=new Array(t.length);for(i=0,l=t.length;i<l;i++)c[0][i]=0;for(i=0,l=s.length/3;i<l;i++){let e=3*i,t=3*i+1,l=3*i+2;for(d=!0,n=0,r=c[0][s[e]];n<r;n++)if(s[t]==c[n+1][s[e]]){d=!1;break}for(d&&(c[0][s[e]]++,c[c[0][s[e]]][s[e]]=s[t]),d=!0,n=0,r=c[0][s[e]];n<r;n++)if(s[l]==c[n+1][s[e]]){d=!1;break}for(d&&(c[0][s[e]]++,c[c[0][s[e]]][s[e]]=s[l]),d=!0,n=0,r=c[0][s[t]];n<r;n++)if(s[e]==c[n+1][s[t]]){d=!1;break}for(d&&(c[0][s[t]]++,c[c[0][s[t]]][s[t]]=s[e]),d=!0,n=0,r=c[0][s[t]];n<r;n++)if(s[l]==c[n+1][s[t]]){d=!1;break}for(d&&(c[0][s[t]]++,c[c[0][s[t]]][s[t]]=s[l]),d=!0,n=0;n<c[0][s[l]];n++)if(s[e]==c[n+1][s[l]]){d=!1;break}for(d&&(c[0][s[l]]++,c[c[0][s[l]]][s[l]]=s[e]),d=!0,n=0,r=c[0][s[l]];n<r;n++)if(s[t]==c[n+1][s[l]]){d=!1;break}d&&(c[0][s[l]]++,c[c[0][s[l]]][s[l]]=s[t])}let h=.5;for(o=0;o<e;o++){for(i=0,l=t.length;i<l;i++)if(c[0][i]<3)a[i].x=t[i].x,a[i].y=t[i].y,a[i].z=t[i].z;else if(3==c[0][i]||4==c[0][i]){for(a[i].x=0,a[i].y=0,a[i].z=0,n=0,r=c[0][i];n<r;n++)a[i].x+=t[c[n+1][i]].x,a[i].y+=t[c[n+1][i]].y,a[i].z+=t[c[n+1][i]].z;a[i].x+=h*t[i].x,a[i].y+=h*t[i].y,a[i].z+=h*t[i].z,a[i].x/=h+c[0][i],a[i].y/=h+c[0][i],a[i].z/=h+c[0][i]}else{for(a[i].x=0,a[i].y=0,a[i].z=0,n=0,r=c[0][i];n<r;n++)a[i].x+=t[c[n+1][i]].x,a[i].y+=t[c[n+1][i]].y,a[i].z+=t[c[n+1][i]].z;a[i].x+=1*t[i].x,a[i].y+=1*t[i].y,a[i].z+=1*t[i].z,a[i].x/=1+c[0][i],a[i].y/=1+c[0][i],a[i].z/=1+c[0][i]}for(i=0,l=t.length;i<l;i++)t[i].x=a[i].x,t[i].y=a[i].y,t[i].z=a[i].z}};class k{constructor(e,t){this.icn3d=e,this.threshbox=t,this.dataArray={},this.header,this.data=void 0,this.matrix=void 0,this.isovalue=void 0,this.loadPhiFrom=void 0,this.vpColor=null,this.vpPot=null,this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.finalScaleFactor={},this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.vertnumber=0,this.facenumber=0,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.bCalcArea=!1,this.atomsToShow={},this.vdwRadii={H:1.2,LI:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.depty={},this.widxz={},this.faces=void 0,this.verts=void 0,this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],this.origextent=void 0,this.marchingCube=new x}}k.prototype.getVDWIndex=function(e){return e.elem&&void 0!==this.vdwRadii[e.elem.toUpperCase()]?e.elem:"X"},k.prototype.inOrigExtent=function(e,t,s){return!(e<this.origextent[0][0]||e>this.origextent[1][0])&&(!(t<this.origextent[0][1]||t>this.origextent[1][1])&&!(s<this.origextent[0][2]||s>this.origextent[1][2]))},k.prototype.getFacesAndVertices=function(){let e,t,s=this.verts;for(e=0,t=s.length;e<t;e++)s[e].x=s[e].x/this.scaleFactor-this.ptranx,s[e].y=s[e].y/this.scaleFactor-this.ptrany,s[e].z=s[e].z/this.scaleFactor-this.ptranz;let i=[];for(e=0,t=this.faces.length;e<t;e+=3){let t=this.faces[e],l=this.faces[e+1],n=this.faces[e+2],r=s[t].atomid,o=s[l].atomid,a=s[n].atomid;this.atomsToShow[r]&&this.atomsToShow[o]&&this.atomsToShow[a]&&(t!==l&&l!==n&&t!==n&&i.push({a:t,b:l,c:n}))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.vpColor=null,this.vpPot=null,{vertices:s,faces:i}},k.prototype.initparm=function(e,t,s,i,l,n,r,o,a){this.header=l,this.dataArray=n,this.matrix=r,this.isovalue=o,this.loadPhiFrom=a,this.bCalcArea=s;for(let e=0,t=i.length;e<t;e++)this.atomsToShow[i[e]]=1;let d=1/this.scaleFactor*5.5;this.origextent=e,this.pminx=e[0][0],this.pmaxx=e[1][0],this.pminy=e[0][1],this.pmaxy=e[1][1],this.pminz=e[0][2],this.pmaxz=e[1][2],t?(this.pminx-=this.probeRadius+d,this.pminy-=this.probeRadius+d,this.pminz-=this.probeRadius+d,this.pmaxx+=this.probeRadius+d,this.pmaxy+=this.probeRadius+d,this.pmaxz+=this.probeRadius+d):(this.pminx-=d,this.pminy-=d,this.pminz-=d,this.pmaxx+=d,this.pmaxy+=d,this.pmaxz+=d),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz;let c=129,h=this.pmaxx-this.pminx;this.pmaxy-this.pminy>h&&(h=this.pmaxy-this.pminy),this.pmaxz-this.pminz>h&&(h=this.pmaxz-this.pminz),this.scaleFactor=(c-1)/h,this.scaleFactor=this.defaultScaleFactor,(this.bCalcArea||this.defaultScaleFactor*h>this.threshbox)&&(c=Math.floor(this.threshbox),this.scaleFactor=(this.threshbox-1)/h),this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.finalScaleFactor.x=(this.pLength-1)/(this.pmaxx-this.pminx),this.finalScaleFactor.y=(this.pWidth-1)/(this.pmaxy-this.pminy),this.finalScaleFactor.z=(this.pHeight-1)/(this.pmaxz-this.pminz),this.boundingatom(t),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight),this.vpColor=[],this.vpPot=[]},k.prototype.boundingatom=function(e){let t,s,i,l,n=[];for(let r in this.vdwRadii){if(!this.vdwRadii.hasOwnProperty(r))continue;let o=this.vdwRadii[r];n[r]=e?(o+this.probeRadius)*this.scaleFactor+.5:o*this.scaleFactor+.5,i=n[r]*n[r],this.widxz[r]=Math.floor(n[r])+1,this.depty[r]=new Int32Array(this.widxz[r]*this.widxz[r]),l=0;for(let e=0;e<this.widxz[r];e++)for(let n=0;n<this.widxz[r];n++)t=e*e+n*n,t>i?this.depty[r][l]=-1:(s=Math.sqrt(i-t),this.depty[r][l]=Math.floor(s)),l++}},k.prototype.fillvoxels=function(e,t){let s,i,l,n;for(s=0,n=this.vpBits.length;s<n;s++)this.vpBits[s]=0,this.vpDistance[s]=-1,this.vpAtomID[s]=-1,this.vpColor[s]=new THREE.Color,this.vpPot[s]=0;for(s in t){let i=e[t[s]];void 0!==i&&"DUM"!==i.resn&&this.fillAtom(i,e)}if(this.dataArray){let e=0,t=this.header.xExtent-1,n=0,r=this.header.yExtent-1,o=0,a=this.header.zExtent-1,d=1,c=Math.floor(.5+d*(t-e))+1,h=Math.floor(.5+d*(r-n))+1,m=Math.floor(.5+d*(a-o))+1,p=h*m,u=m,C=new Float32Array(c*h*m);for(s=0;s<c;++s)for(i=0;i<h;++i)for(l=0;l<m;++l){let e,t=s*p+i*u+l;"phi"==this.header.filetype?e=l*p+i*u+s:"cube"==this.header.filetype&&(e=s*p+i*u+l),e<this.dataArray.length&&(C[t]=this.dataArray[e])}let g=this.pWidth*this.pHeight,f=this.pHeight;for(s=0;s<this.pLength;++s)for(i=0;i<this.pWidth;++i)for(l=0;l<this.pHeight;++l){let e=s/this.finalScaleFactor.x-this.ptranx,t=i/this.finalScaleFactor.y-this.ptrany,n=l/this.finalScaleFactor.z-this.ptranz,r=new THREE.Vector3(e,t,n);r.sub(this.header.ori).multiplyScalar(this.header.scale);let o=Math.floor(r.x),a=Math.ceil(r.x),d=Math.floor(r.y),b=Math.ceil(r.y),y=Math.floor(r.z),v=Math.ceil(r.z);a==o&&(a=o+1),b==d&&(b=d+1),v==y&&(v=y+1),a>c&&(a=c),b>h&&(b=h),v>m&&(v=m);let _,S=C[o*p+d*u+y],w=C[a*p+d*u+y],A=C[o*p+b*u+y],x=C[o*p+d*u+v],k=C[a*p+b*u+y],O=C[o*p+b*u+v],H=C[a*p+d*u+v],D=C[a*p+b*u+v],R=r.x-o,I=r.y-d,E=r.z-y,T=((S*(1-R)+w*R)*(1-I)+(A*(1-R)+k*R)*I)*(1-E)+((x*(1-R)+H*R)*(1-I)+(O*(1-R)+D*R)*I)*E,M=s*g+i*f+l;this.vpPot[M]=T,T>this.isovalue&&(T=this.isovalue),T<-this.isovalue&&(T=-this.isovalue),T>0?(T/=1*this.isovalue,_=new THREE.Color(1-T,1-T,1)):(T/=-1*this.isovalue,_=new THREE.Color(1,1-T,1-T)),this.vpColor[M]=_}}for(s=0,n=this.vpBits.length;s<n;s++)this.vpBits[s]&this.INOUT&&(this.vpBits[s]|=this.ISDONE)},k.prototype.fillAtom=function(e,t){let s,i,l,n,r,o,a,d,c,h,m,p,u,C,g,f,b,y,v;s=Math.floor(.5+this.scaleFactor*(e.coord.x+this.ptranx)),i=Math.floor(.5+this.scaleFactor*(e.coord.y+this.ptrany)),l=Math.floor(.5+this.scaleFactor*(e.coord.z+this.ptranz));let _=this.getVDWIndex(e),S=0,w=this.pWidth*this.pHeight;for(h=0,v=this.widxz[_];h<v;h++)for(m=0;m<v;m++){if(-1!=this.depty[_][S])for(f=-1;f<2;f++)for(b=-1;b<2;b++)for(y=-1;y<2;y++)if(0!==f&&0!==b&&0!==y)for(a=f*h,c=y*m,p=0;p<=this.depty[_][S];p++){if(d=p*b,u=s+a,C=i+d,g=l+c,u<0||C<0||g<0||u>=this.pLength||C>=this.pWidth||g>=this.pHeight)continue;let h=u*w+C*this.pHeight+g;if(this.vpBits[h]&this.INOUT){let m=t[this.vpAtomID[h]];m.serial!=e.serial&&(n=s+a-Math.floor(.5+this.scaleFactor*(m.x+this.ptranx)),r=i+d-Math.floor(.5+this.scaleFactor*(m.y+this.ptrany)),o=l+c-Math.floor(.5+this.scaleFactor*(m.z+this.ptranz)),a*a+d*d+c*c<n*n+r*r+o*o&&(this.vpAtomID[h]=e.serial))}else this.vpBits[h]|=this.INOUT,this.vpAtomID[h]=e.serial}S++}},k.prototype.fillvoxelswaals=function(e,t){let s,i;for(s=0,i=this.vpBits.length;s<i;s++)this.vpBits[s]&=~this.ISDONE;for(s in t){let i=e[t[s]];void 0!==i&&this.fillAtomWaals(i,e)}},k.prototype.fillAtomWaals=function(e,t){let s,i,l,n,r,o,a,d,c,h,m,p,u,C,g,f,b,y,v,_=0;s=Math.floor(.5+this.scaleFactor*(e.coord.x+this.ptranx)),i=Math.floor(.5+this.scaleFactor*(e.coord.y+this.ptrany)),l=Math.floor(.5+this.scaleFactor*(e.coord.z+this.ptranz));let S=this.getVDWIndex(e),w=this.pWidth*this.pHeight;for(u=0,v=this.widxz[S];u<v;u++)for(C=0;C<v;C++){if(-1!=this.depty[S][_])for(f=-1;f<2;f++)for(b=-1;b<2;b++)for(y=-1;y<2;y++)if(0!==f&&0!==b&&0!==y)for(a=f*u,c=y*C,g=0;g<=this.depty[S][_];g++){if(d=g*b,h=s+a,m=i+d,p=l+c,h<0||m<0||p<0||h>=this.pLength||m>=this.pWidth||p>=this.pHeight)continue;let u=h*w+m*this.pHeight+p;if(this.vpBits[u]&this.ISDONE){let h=t[this.vpAtomID[u]];h.serial!=e.serial&&(n=s+a-Math.floor(.5+this.scaleFactor*(h.x+this.ptranx)),r=i+d-Math.floor(.5+this.scaleFactor*(h.y+this.ptrany)),o=l+c-Math.floor(.5+this.scaleFactor*(h.z+this.ptranz)),a*a+d*d+c*c<n*n+r*r+o*o&&(this.vpAtomID[u]=e.serial))}else this.vpBits[u]|=this.ISDONE,this.vpAtomID[u]=e.serial}_++}},k.prototype.buildboundary=function(){let e=this.pWidth*this.pHeight;for(let t=0;t<this.pLength;t++)for(let s=0;s<this.pHeight;s++)for(let i=0;i<this.pWidth;i++){let l=t*e+i*this.pHeight+s;if(this.vpBits[l]&this.INOUT){let n=0;for(;n<26;){let r=t+this.nb[n][0],o=s+this.nb[n][2],a=i+this.nb[n][1];if(r>-1&&r<this.pLength&&a>-1&&a<this.pWidth&&o>-1&&o<this.pHeight&&!(this.vpBits[r*e+a*this.pHeight+o]&this.INOUT)){this.vpBits[l]|=this.ISBOUND;break}n++}}}},k.prototype.fastdistancemap=function(){let e,t,s,i,l,n=new function(e,t,s){let i=new Int32Array(e*t*s*3);this.set=function(e,l,n,r){let o=3*((e*t+l)*s+n);i[o]=r.ix,i[o+1]=r.iy,i[o+2]=r.iz},this.get=function(e,l,n){let r=3*((e*t+l)*s+n);return{ix:i[r],iy:i[r+1],iz:i[r+2]}}}(this.pLength,this.pWidth,this.pHeight),r=this.pWidth*this.pHeight,o=this.cutRadius*this.cutRadius,a=[],d=[];for(e=0;e<this.pLength;e++)for(t=0;t<this.pWidth;t++)for(s=0;s<this.pHeight;s++)if(l=e*r+t*this.pHeight+s,this.vpBits[l]&=~this.ISDONE,this.vpBits[l]&this.INOUT&&this.vpBits[l]&this.ISBOUND){let i={ix:e,iy:t,iz:s};n.set(e,t,s,i),a.push(i),this.vpDistance[l]=0,this.vpBits[l]|=this.ISDONE,this.vpBits[l]&=~this.ISBOUND}do{for(d=this.fastoneshell(a,n),a=[],e=0,i=d.length;e<i;e++)l=r*d[e].ix+this.pHeight*d[e].iy+d[e].iz,this.vpBits[l]&=~this.ISBOUND,this.vpDistance[l]<=1.0404*o&&a.push({ix:d[e].ix,iy:d[e].iy,iz:d[e].iz})}while(0!==a.length);a=[],d=[],n=null;let c=this.scaleFactor-.5;c<0&&(c=0);let h=o-.5/(.1+c);for(e=0;e<this.pLength;e++)for(t=0;t<this.pWidth;t++)for(s=0;s<this.pHeight;s++)l=e*r+t*this.pHeight+s,this.vpBits[l]&=~this.ISBOUND,this.vpBits[l]&this.INOUT&&(this.vpBits[l]&this.ISDONE&&!(this.vpBits[l]&this.ISDONE&&this.vpDistance[l]>=h)||(this.vpBits[l]|=this.ISBOUND))},k.prototype.fastoneshell=function(e,t){let s,i,l,n,r,o,a,d,c,h,m,p,u=[];if(0===e.length)return u;let C={ix:-1,iy:-1,iz:-1},g=this.pWidth*this.pHeight;for(a=0,c=e.length;a<c;a++)for(s=e[a].ix,i=e[a].iy,l=e[a].iz,m=t.get(s,i,l),d=0;d<6;d++)C.ix=s+this.nb[d][0],C.iy=i+this.nb[d][1],C.iz=l+this.nb[d][2],C.ix<this.pLength&&C.ix>-1&&C.iy<this.pWidth&&C.iy>-1&&C.iz<this.pHeight&&C.iz>-1&&(p=C.ix*g+this.pHeight*C.iy+C.iz,this.vpBits[p]&this.INOUT&&!(this.vpBits[p]&this.ISDONE)?(t.set(C.ix,C.iy,l+this.nb[d][2],m),n=C.ix-m.ix,r=C.iy-m.iy,o=C.iz-m.iz,h=n*n+r*r+o*o,this.vpDistance[p]=h,this.vpBits[p]|=this.ISDONE,this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})):this.vpBits[p]&this.INOUT&&this.vpBits[p]&this.ISDONE&&(n=C.ix-m.ix,r=C.iy-m.iy,o=C.iz-m.iz,h=n*n+r*r+o*o,h<this.vpDistance[p]&&(t.set(C.ix,C.iy,C.iz,m),this.vpDistance[p]=h,this.vpBits[p]&this.ISBOUND||(this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})))));for(a=0,c=e.length;a<c;a++)for(s=e[a].ix,i=e[a].iy,l=e[a].iz,m=t.get(s,i,l),d=6;d<18;d++)C.ix=s+this.nb[d][0],C.iy=i+this.nb[d][1],C.iz=l+this.nb[d][2],C.ix<this.pLength&&C.ix>-1&&C.iy<this.pWidth&&C.iy>-1&&C.iz<this.pHeight&&C.iz>-1&&(p=C.ix*g+this.pHeight*C.iy+C.iz,this.vpBits[p]&this.INOUT&&!(this.vpBits[p]&this.ISDONE)?(t.set(C.ix,C.iy,l+this.nb[d][2],m),n=C.ix-m.ix,r=C.iy-m.iy,o=C.iz-m.iz,h=n*n+r*r+o*o,this.vpDistance[p]=h,this.vpBits[p]|=this.ISDONE,this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})):this.vpBits[p]&this.INOUT&&this.vpBits[p]&this.ISDONE&&(n=C.ix-m.ix,r=C.iy-m.iy,o=C.iz-m.iz,h=n*n+r*r+o*o,h<this.vpDistance[p]&&(t.set(C.ix,C.iy,C.iz,m),this.vpDistance[p]=h,this.vpBits[p]&this.ISBOUND||(this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})))));for(a=0,c=e.length;a<c;a++)for(s=e[a].ix,i=e[a].iy,l=e[a].iz,m=t.get(s,i,l),d=18;d<26;d++)C.ix=s+this.nb[d][0],C.iy=i+this.nb[d][1],C.iz=l+this.nb[d][2],C.ix<this.pLength&&C.ix>-1&&C.iy<this.pWidth&&C.iy>-1&&C.iz<this.pHeight&&C.iz>-1&&(p=C.ix*g+this.pHeight*C.iy+C.iz,this.vpBits[p]&this.INOUT&&!(this.vpBits[p]&this.ISDONE)?(t.set(C.ix,C.iy,l+this.nb[d][2],m),n=C.ix-m.ix,r=C.iy-m.iy,o=C.iz-m.iz,h=n*n+r*r+o*o,this.vpDistance[p]=h,this.vpBits[p]|=this.ISDONE,this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})):this.vpBits[p]&this.INOUT&&this.vpBits[p]&this.ISDONE&&(n=C.ix-m.ix,r=C.iy-m.iy,o=C.iz-m.iz,h=n*n+r*r+o*o,h<this.vpDistance[p]&&(t.set(C.ix,C.iy,C.iz,m),this.vpDistance[p]=h,this.vpBits[p]&this.ISBOUND||(this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})))));return u},k.prototype.marchingcubeinit=function(e){for(let t=0,s=this.vpBits.length;t<s;t++)1==e?this.vpBits[t]&=~this.ISBOUND:4==e?(this.vpBits[t]&=~this.ISDONE,this.vpBits[t]&this.ISBOUND&&(this.vpBits[t]|=this.ISDONE),this.vpBits[t]&=~this.ISBOUND):2==e?this.vpBits[t]&this.ISBOUND&&this.vpBits[t]&this.ISDONE?this.vpBits[t]&=~this.ISBOUND:this.vpBits[t]&this.ISBOUND&&!(this.vpBits[t]&this.ISDONE)&&(this.vpBits[t]|=this.ISDONE):3==e&&(this.vpBits[t]&=~this.ISBOUND)},k.prototype.counter=function(){let e=Array(256);for(let t=0;t<256;t++)e[t]=[];this.incrementUsed=function(t,s){void 0===e[t][s]&&(e[t][s]={used:0,unused:0}),e[t][s].used++},this.incrementUnused=function(t,s){void 0===e[t][s]&&(e[t][s]={used:0,unused:0}),e[t][s].unused++};this.print=function(){let t=this.marchingCube.triTable,s=[];for(let i=0;i<t.length;i++){let l=[];for(let s=0;s<t[i].length;s+=3){let n=s/3;void 0!==e[i][n]&&e[i][n].unused||(l.push(t[i][s]),l.push(t[i][s+1]),l.push(t[i][s+2])),void 0===e[i][n]&&console.log("undef "+i+","+n)}s.push(l)}!function(e){let t="[";for(let s=0;s<e.length;s++){let i=0,l=e[s];for(let e=0;e<l.length;e++)i|=1<<l[e];t+="0x"+i.toString(16)+", "}t+="]"}(s)}},k.prototype.marchingcube=function(e){this.marchingcubeinit(e),this.verts=[],this.faces=[],this.marchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let t=this.pWidth*this.pHeight;for(let e=0,s=this.verts.length;e<s;e++)this.verts[e].atomid=this.vpAtomID[this.verts[e].x*t+this.pHeight*this.verts[e].y+this.verts[e].z],this.dataArray&&(this.verts[e].color=this.vpColor[this.verts[e].x*t+this.pHeight*this.verts[e].y+this.verts[e].z]),this.dataArray&&(this.verts[e].pot=this.vpPot[this.verts[e].x*t+this.pHeight*this.verts[e].y+this.verts[e].z]);let s,i,l=0;if(this.bCalcArea){let e={};s={};for(let t=0,i=this.faces.length;t<i;t+=3){let i=this.faces[t],n=this.faces[t+1],r=this.faces[t+2];if(i==n||n==r||i==r)continue;let o=Math.min(i,n,r),a=Math.max(i,n,r),d=o+"_"+(i+n+r-o-a)+"_"+a;if(e.hasOwnProperty(d))continue;e[d]=1;let c=this.verts[i].atomid,h=this.verts[n].atomid,m=this.verts[r].atomid;if(!this.atomsToShow[c]||!this.atomsToShow[h]||!this.atomsToShow[m])continue;let p=this.verts[i],u=this.verts[n],C=this.verts[r],g=(p.x-u.x)*(p.x-u.x)+(p.y-u.y)*(p.y-u.y)+(p.z-u.z)*(p.z-u.z),f=(p.x-C.x)*(p.x-C.x)+(p.y-C.y)*(p.y-C.y)+(p.z-C.z)*(p.z-C.z),b=(C.x-u.x)*(C.x-u.x)+(C.y-u.y)*(C.y-u.y)+(C.z-u.z)*(C.z-u.z),y=Math.min(g,f,b),v=Math.max(g,f,b),_=g+f+b-y-v,S=0;S=0==parseInt(100*(v-y))?.433*y:0==parseInt(100*(_-y))?.5*y:.707*y;let w=S/3;void 0===s[c]?s[c]=w:s[c]+=w,void 0===s[h]?s[h]=w:s[h]+=w,void 0===s[m]?s[m]=w:s[m]+=w,l+=S}i=Math.max(this.finalScaleFactor.x,this.finalScaleFactor.y,this.finalScaleFactor.z),l=l/i/i}return this.bCalcArea||this.marchingCube.laplacianSmooth(1,this.verts,this.faces),{area:l,serial2area:s,scaleFactor:i}};class O{constructor(e){this.icn3d=e,this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.isovalue=1.5,this.dataArray={},this.matrix=void 0,this.center=void 0,this.maxdist=void 0,this.pmin=void 0,this.pmax=void 0,this.water=void 0,this.header=void 0,this.type=void 0,this.rmsd_supr=void 0,this.loadPhiFrom=void 0,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.vertnumber=0,this.facenumber=0,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=void 0,this.verts=void 0,this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],this.marchingCube=new x}}O.prototype.getFacesAndVertices=function(e,t){let s,i,l={};for(s=0,i=t.length;s<i;s++)l[t[s]]=1;let n=this.verts;for(s=0,i=n.length;s<i;s++){let e;e="phi"==this.type?new THREE.Vector3(n[s].x,n[s].y,n[s].z).multiplyScalar(1/this.header.scale).applyMatrix4(this.matrix):new THREE.Vector3(n[s].x,n[s].y,n[s].z).applyMatrix4(this.matrix),n[s].x=e.x,n[s].y=e.y,n[s].z=e.z}let r=[];for(s=0,i=this.faces.length;s<i;s+=3){let e=this.faces[s],t=this.faces[s+1],i=this.faces[s+2];e!==t&&t!==i&&e!==i&&r.push({a:e,b:t,c:i})}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:n,faces:r}},O.prototype.initparm=function(e,t,s,i,l,n,r,o,a,d,c,h,m){this.header=e,this.loadPhiFrom=h,this.header&&void 0!==this.header.max?this.isovalue=this.header.min+(this.header.max-this.header.min)*i/100:this.header&&void 0!==this.header.mean?this.isovalue=this.header.mean+this.header.sigma*i:this.isovalue=i,this.dataArray=t,this.matrix=s,this.center=l,this.maxdist=n,this.pmin=r,this.pmax=o,this.water=a,this.type=d,this.rmsd_supr=c,this.pminx=0,this.pmaxx=this.header.xExtent-1,this.pminy=0,this.pmaxy=this.header.yExtent-1,this.pminz=0,this.pmaxz=this.header.zExtent-1,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz;let p=this.pmaxx-this.pminx;this.pmaxy-this.pminy>p&&(p=this.pmaxy-this.pminy),this.pmaxz-this.pminz>p&&(p=this.pmaxz-this.pminz),this.scaleFactor=1,this.pLength=Math.floor(.5+this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.floor(.5+this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.floor(.5+this.scaleFactor*(this.pmaxz-this.pminz))+1,this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Uint8Array(this.pLength*this.pWidth*this.pHeight)},O.prototype.transformMemPro=function(e,t,s,i){let l=e.clone();l.sub(s);let n=l.x*t[0]+l.y*t[1]+l.z*t[2]+i.x,r=l.x*t[3]+l.y*t[4]+l.z*t[5]+i.y,o=l.x*t[6]+l.y*t[7]+l.z*t[8]+i.z;return l.x=n,l.y=r,l.z=o,l},O.prototype.fillvoxels=function(e,t){let s,i,l,n,r,o;for(s=0,n=this.vpBits.length;s<n;s++)this.vpBits[s]=0,this.vpAtomID[s]=0;let a=this.pWidth*this.pHeight,d=this.pHeight;if("phi"!=this.type||this.header.bSurface){let c=(new THREE.Matrix4).copy(this.matrix).invert(),h=[];this.maxdist=parseInt(this.maxdist);let m,p,u,C=new Array(9);if(void 0!==this.rmsd_supr&&void 0!==this.rmsd_supr.rot){m=this.rmsd_supr.rot,p=this.rmsd_supr.trans1,u=this.rmsd_supr.trans2;let e=new THREE.Matrix3,t=new THREE.Matrix3;e.set(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8]),t.copy(e).invert(),C[0]=t.elements[0],C[1]=t.elements[3],C[2]=t.elements[6],C[3]=t.elements[1],C[4]=t.elements[4],C[5]=t.elements[7],C[6]=t.elements[2],C[7]=t.elements[5],C[8]=t.elements[8]}if("phi"==this.type&&this.header.bSurface){let n=new Float32Array(this.pLength*this.pWidth*this.pHeight);for(s=0;s<this.pLength;++s)for(i=0;i<this.pWidth;++i)for(l=0;l<this.pHeight;++l){let e,t=s*a+i*d+l;"phi"==this.header.filetype?e=l*a+i*d+s:"cube"==this.header.filetype&&(e=s*a+i*d+l),e<this.dataArray.length&&(n[t]=this.dataArray[e])}for(let s in t){let i=e[t[s]];if("DUM"===i.resn)continue;let l=i.coord.clone();if("delphi"!=this.loadPhiFrom)if(void 0!==this.rmsd_supr&&void 0!==this.rmsd_supr.rot){l=this.transformMemPro(i.coord,C,u,p).applyMatrix4(c)}else l=i.coord.clone().applyMatrix4(c);l.sub(this.header.ori).multiplyScalar(this.header.scale);let r=Math.floor(l.x),o=Math.ceil(l.x),h=Math.floor(l.y),m=Math.ceil(l.y),g=Math.floor(l.z),f=Math.ceil(l.z);o==r&&(o=r+1),m==h&&(m=h+1),f==g&&(f=g+1),o>this.pLength&&(o=this.pLength),m>this.pWidth&&(m=this.pWidth),f>this.pHeight&&(f=this.pHeight);let b,y=n[r*a+h*d+g],v=n[o*a+h*d+g],_=n[r*a+m*d+g],S=n[r*a+h*d+f],w=n[o*a+m*d+g],A=n[r*a+m*d+f],x=n[o*a+h*d+f],k=n[o*a+m*d+f],O=l.x-r,H=l.y-h,D=l.z-g,R=((y*(1-O)+v*O)*(1-H)+(_*(1-O)+w*O)*H)*(1-D)+((S*(1-O)+x*O)*(1-H)+(A*(1-O)+k*O)*H)*D;R>this.isovalue&&(R=this.isovalue),R<-this.isovalue&&(R=-this.isovalue),R>0?(R/=1*this.isovalue,b=new THREE.Color(1-R,1-R,1)):(R/=-1*this.isovalue,b=new THREE.Color(1,1-R,1-R)),this.icn3d.atoms[t[s]].color=b,this.icn3d.atomPrevColors[t[s]]=b}}else{for(let m in t){let g,f=e[t[m]];if("DUM"!==f.resn){if(void 0!==this.rmsd_supr&&void 0!==this.rmsd_supr.rot){g=this.transformMemPro(f.coord,C,u,p).applyMatrix4(c)}else g=f.coord.clone().applyMatrix4(c);for(s=Math.floor(g.x)-this.maxdist,n=Math.ceil(g.x)+this.maxdist;s<=n;++s)if(!(s<0||s>this.header.xExtent*this.scaleFactor-1))for(i=Math.floor(g.y)-this.maxdist,r=Math.ceil(g.y)+this.maxdist;i<=r;++i)if(!(i<0||i>this.header.yExtent*this.scaleFactor-1))for(l=Math.floor(g.z)-this.maxdist,o=Math.ceil(g.z)+this.maxdist;l<=o;++l){if(l<0||l>this.header.zExtent*this.scaleFactor-1)continue;let e=s*a+i*d+l;h.push(e)}}}for(s=0,n=h.length;s<n;++s){let e=h[s];"2fofc"==this.type?this.vpBits[e]=this.dataArray[e]>=this.isovalue?1:0:"fofc"==this.type?(this.vpBits[e]=this.dataArray[e]>=this.isovalue||this.dataArray[e]<=-this.isovalue?1:0,this.vpAtomID[e]=this.dataArray[e]>=0?1:0):"em"==this.type&&(this.vpBits[e]=this.dataArray[e]>=this.isovalue?1:0)}}}else for(s=0;s<this.pLength;++s)for(i=0;i<this.pWidth;++i)for(l=0;l<this.pHeight;++l){let e,t=s*a+i*d+l;"phi"==this.header.filetype?e=l*a+i*d+s:"cube"==this.header.filetype&&(e=s*a+i*d+l),e<this.dataArray.length&&(this.vpBits[t]=this.dataArray[e]>=this.isovalue||this.dataArray[e]<=-this.isovalue?1:0,this.vpAtomID[t]=this.dataArray[e]>=0?1:0)}for(s=0,n=this.vpBits.length;s<n;s++)this.vpBits[s]&this.INOUT&&(this.vpBits[s]|=this.ISDONE)},O.prototype.buildboundary=function(){let e,t,s,i=this.pWidth*this.pHeight;for(e=0;e<this.pLength;e++)for(t=0;t<this.pHeight;t++)for(s=0;s<this.pWidth;s++){let l=e*i+s*this.pHeight+t;if(this.vpBits[l]&this.INOUT){let n=0;for(;n<26;){let r=e+this.nb[n][0],o=t+this.nb[n][2],a=s+this.nb[n][1];if(r>-1&&r<this.pLength&&a>-1&&a<this.pWidth&&o>-1&&o<this.pHeight&&!(this.vpBits[r*i+a*this.pHeight+o]&this.INOUT)){this.vpBits[l]|=this.ISBOUND;break}n++}}}},O.prototype.marchingcubeinit=function(e){for(let t=0,s=this.vpBits.length;t<s;t++)1==e?this.vpBits[t]&=~this.ISBOUND:4==e?(this.vpBits[t]&=~this.ISDONE,this.vpBits[t]&this.ISBOUND&&(this.vpBits[t]|=this.ISDONE),this.vpBits[t]&=~this.ISBOUND):2==e?this.vpBits[t]&this.ISBOUND&&this.vpBits[t]&this.ISDONE?this.vpBits[t]&=~this.ISBOUND:this.vpBits[t]&this.ISBOUND&&!(this.vpBits[t]&this.ISDONE)&&(this.vpBits[t]|=this.ISDONE):this.vpBits[t]&=~this.ISBOUND},O.prototype.counter=function(){let e=Array(256);for(let t=0;t<256;t++)e[t]=[];this.incrementUsed=function(t,s){void 0===e[t][s]&&(e[t][s]={used:0,unused:0}),e[t][s].used++},this.incrementUnused=function(t,s){void 0===e[t][s]&&(e[t][s]={used:0,unused:0}),e[t][s].unused++};this.print=function(){let t=this.marchingCube.triTable,s=[];for(let i=0;i<t.length;i++){let l=[];for(let s=0;s<t[i].length;s+=3){let n=s/3;void 0!==e[i][n]&&e[i][n].unused||(l.push(t[i][s]),l.push(t[i][s+1]),l.push(t[i][s+2])),void 0===e[i][n]&&console.log("undef "+i+","+n)}s.push(l)}!function(e){let t="[";for(let s=0;s<e.length;s++){let i=0,l=e[s];for(let e=0;e<l.length;e++)i|=1<<l[e];t+="0x"+i.toString(16)+", "}t+="]"}(s)}},O.prototype.marchingcube=function(e){this.marchingcubeinit(e),this.verts=[],this.faces=[],this.marchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let t=this.pWidth*this.pHeight;for(let e=0,s=this.verts.length;e<s;e++)this.verts[e].atomid=this.vpAtomID[this.verts[e].x*t+this.pHeight*this.verts[e].y+this.verts[e].z];this.marchingCube.laplacianSmooth(1,this.verts,this.faces)};class H{constructor(e){this.icn3d=e}createSurfaceRepresentation(e,t,s,i){let l,n=this.icn3d,r=n.icn3dui,o=this;if(0==Object.keys(e).length)return;null==i&&(i=1),n.opacity=i;let a=n.contactCls.getExtent(e),d=[];if(n.bConsiderNeighbors){let t;t=r.hashUtilsCls.unionHash(t,e),t=r.hashUtilsCls.unionHash(t,n.contactCls.getAtomsWithinAtom(n.atoms,e,5)),d=Object.keys(t)}else d=Object.keys(e);let c,h=!(10==parseInt(10*i)||s||n.bInstanced&&Object.keys(n.atoms).length*n.biomtMatrices.length>n.maxatomcnt),m={allatoms:n.atoms,atomsToShow:Object.keys(e),extendedAtoms:d,water:n.water,center:n.center,maxdist:1,pmin:n.pmin,pmax:n.pmax,rmsd_supr:n.rmsd_supr};if(11==t)m.header=n.mapData.header2,m.data=n.mapData.data2,m.matrix=n.mapData.matrix2,m.isovalue=n.mapData.sigma2,m.type="2fofc",c=this.SetupMap(m);else if(12==t)m.header=n.mapData.header,m.data=n.mapData.data,m.matrix=n.mapData.matrix,m.isovalue=n.mapData.sigma,m.type="fofc",c=this.SetupMap(m);else if(13==t)m.maxdist=3,m.header=n.mapData.headerEm,m.data=n.mapData.dataEm,m.matrix=n.mapData.matrixEm,m.isovalue=n.mapData.sigmaEm,m.type="em",c=this.SetupMap(m);else if(14==t)m.header=n.mapData.headerPhi,m.data=n.mapData.dataPhi,m.matrix=n.mapData.matrixPhi,m.isovalue=n.mapData.contourPhi,m.type="phi",m.loadPhiFrom=n.loadPhiFrom,c=this.SetupMap(m);else{let s=r.hashUtilsCls.exclHash(e,n.water);d=r.hashUtilsCls.exclHash(d,n.water);let i=t;21==i?i=1:22==i?i=2:23==i&&(i=3),m={extent:a,allatoms:n.atoms,atomsToShow:Object.keys(s),extendedAtoms:d,type:i,threshbox:h?60:n.threshbox,bCalcArea:n.bCalcArea},m.header=n.mapData.headerPhi,m.data=n.mapData.dataPhi,m.matrix=n.mapData.matrixPhi,m.isovalue=n.mapData.contourPhi,m.loadPhiFrom=n.loadPhiFrom,c=this.SetupSurface(m)}if(n.bCalcArea){n.areavalue=c.area.toFixed(2);let e=c.serial2area,t=c.scaleFactor*c.scaleFactor;n.resid2area={};let s={},i={};for(let t in e){let l=n.atoms[t],r=l.structure+"_"+l.chain+"_"+l.resi+"_"+l.resn;s[l.structure]=1,i[l.structure+"_"+l.chain]=1,void 0===n.resid2area[r]?n.resid2area[r]=e[t]:n.resid2area[r]+=e[t]}let l='<table border="1" cellpadding="10" cellspacing="0">',o=Object.keys(s).length>1?"<th>Structure</th>":"",a=Object.keys(i).length>1?"<th>Chain</th>":"";l+="<tr>"+o+a+"<th>Residue</th><th>Number</th><th>SASA (&#8491;<sup>2</sup>)</th><th>Percent Out</th><th>In/Out</th></tr>";for(let e in n.resid2area){let d=e.lastIndexOf("_"),c=e.substr(d+1),h=r.utilsCls.getIdArray(e.substr(0,d));o=Object.keys(s).length>1?"<td>"+h[0]+"</td>":"",a=Object.keys(i).length>1?"<td>"+h[1]+"</td>":"";let m="",p="";n.resid2area[e]=(n.resid2area[e]/t).toFixed(2),r.parasCls.residueArea.hasOwnProperty(c)&&(p=parseInt(n.resid2area[e]/r.parasCls.residueArea[c]*100),p>100&&(p=100),p>=50&&(m="out"),p<20&&(m="in")),l+='<tr align="center">'+o+a+"<td>"+c+'</td><td align="right">'+h[2]+'</td><td align="right">'+n.resid2area[e]+'</td><td align="right">'+p+"%</td><td>"+m+"</td></tr>"}return l+="</table>",void(n.areahtml=l)}let p,u,C,g=c.vertices,f=c.faces,b=r.parasCls.thr("#00FFFF"),y=r.parasCls.thr("#00FF00"),v=r.parasCls.thr("#ff0000"),_=r.parasCls.thr("#00FFFF"),S=r.parasCls.thr("#0000FF"),w=r.parasCls.thr("#FF0000");11!=t&&12!=t&&13!=t&&14!=t||void 0===n.rmsd_supr||void 0===n.rmsd_supr.rot||(p=n.rmsd_supr.rot,u=n.rmsd_supr.trans1,C=n.rmsd_supr.trans2);let A=(11==t||12==t||13==t||14==t&&"delphi"!=n.loadPhiFrom)&&void 0!==n.rmsd_supr&&void 0!==n.rmsd_supr.rot;l=new THREE.BufferGeometry;let x,k=[],O=[],H=[],D=0;for(let e=0,s=g.length;e<s;++e,D+=3){let s=g[e],i=new THREE.Vector3(s.x,s.y,s.z);if(A&&(i=o.transformMemPro(i,p,u,C)),k[D]=i.x,k[D+1]=i.y,k[D+2]=i.z,11==t)x=b;else if(12==t)x=s.atomid?y:v;else if(13==t)x=_;else if(14==t)x=s.atomid?S:w;else if(21==t||22==t||23==t){x=s.color;let e=s.atomid;n.atoms[e].pot=s.pot}else{let e=s.atomid;x=n.atoms[e].color}O[D]=x.r,O[D+1]=x.g,O[D+2]=x.b}if(r.bNode)return;D=0;for(let e=0,t=f.length;e<t;++e,D+=3){let t=f[e];H[D]=t.a,H[D+1]=t.b,H[D+2]=t.c}if(l.setAttribute("position",new THREE.BufferAttribute(new Float32Array(k),3)),l.setAttribute("color",new THREE.BufferAttribute(new Float32Array(O),3)),l.setIndex(new THREE.BufferAttribute(new Uint32Array(H),1)),l.computeVertexNormals(),l.type="Surface",h){let e={};for(let t=0,s=f.length;t<s;++t){let s=f[t].a,i=f[t].b,l=f[t].c;void 0===e[s]&&(e[s]=[]),e[s].push(i),e[s].push(l)}for(let l in e){this.geometry=new THREE.BufferGeometry;let o=[],a=[],d=[],c=0,h=0,m=0,p=e[l],u=new THREE.Vector3(0,0,0),C=3,f=0;for(let e=0,s=p.length;e<s;e+=2){let s=p[e],i=p[e+1];o[c++]=g[l].x,o[c++]=g[l].y,o[c++]=g[l].z,o[c++]=g[s].x,o[c++]=g[s].y,o[c++]=g[s].z,o[c++]=g[i].x,o[c++]=g[i].y,o[c++]=g[i].z,21==t||22==t||23==t?(a[h++]=g[l].color.r,a[h++]=g[l].color.g,a[h++]=g[l].color.b,a[h++]=g[s].color.r,a[h++]=g[s].color.g,a[h++]=g[s].color.b,a[h++]=g[i].color.r,a[h++]=g[i].color.g,a[h++]=g[i].color.b):(a[h++]=n.atoms[g[l].atomid].color.r,a[h++]=n.atoms[g[l].atomid].color.g,a[h++]=n.atoms[g[l].atomid].color.b,a[h++]=n.atoms[g[s].atomid].color.r,a[h++]=n.atoms[g[s].atomid].color.g,a[h++]=n.atoms[g[s].atomid].color.b,a[h++]=n.atoms[g[i].atomid].color.r,a[h++]=n.atoms[g[i].atomid].color.g,a[h++]=n.atoms[g[i].atomid].color.b);let r=e/2*3;d[m++]=r,d[m++]=r+1,d[m++]=r+2,u=u.add(new THREE.Vector3(g[r].x,g[r].y,g[r].z)),u=u.add(new THREE.Vector3(g[r+1].x,g[r+1].y,g[r+1].z)),u=u.add(new THREE.Vector3(g[r+2].x,g[r+2].y,g[r+2].z)),f+=3}this.geometry.setAttribute("position",new THREE.BufferAttribute(new Float32Array(o),C)),this.geometry.setAttribute("color",new THREE.BufferAttribute(new Float32Array(a),C)),this.geometry.setIndex(new THREE.BufferAttribute(new Uint32Array(d),1)),this.geometry.computeVertexNormals(),this.geometry.type="Surface";let b,y=new THREE.Mesh(this.geometry,new THREE.MeshBasicMaterial({specular:n.frac,shininess:0,emissive:n.emissive,vertexColors:THREE.VertexColors,wireframe:s,opacity:i,transparent:!0,side:THREE.DoubleSide}));b=n.bControlGl&&!r.bNode?u.multiplyScalar(1/f).sub(n.oriCenter).applyMatrix4(window.cam.matrixWorldInverse):u.multiplyScalar(1/f).sub(n.oriCenter).applyMatrix4(n.cam.matrixWorldInverse),y.renderOrder=n.cam_z>0?-parseInt(b.z):parseInt(b.z),y.onBeforeRender=function(e,t,s,i,l,o){let a,d=new THREE.Vector3(0,0,0),c=i.getAttribute("position").array;for(let e=0,t=c.length;e<t;e+=3)d=d.add(new THREE.Vector3(c[e],c[e+1],c[e+2]));a=n.bControlGl&&!r.bNode?d.multiplyScalar(3/c.length).sub(n.oriCenter).applyMatrix4(window.cam.matrixWorldInverse):d.multiplyScalar(3/c.length).sub(n.oriCenter).applyMatrix4(n.cam.matrixWorldInverse),this.renderOrder=n.cam_z>0?-parseInt(a.z):parseInt(a.z)},n.mdl.add(y),11==t||12==t?n.prevMaps.push(y):13==t?n.prevEmmaps.push(y):14==t?n.prevPhimaps.push(y):n.prevSurfaces.push(y)}}else{let e=new THREE.Mesh(l,new THREE.MeshPhongMaterial({specular:n.frac,shininess:20,emissive:n.emissive,vertexColors:THREE.VertexColors,wireframe:s,opacity:i,transparent:!0,side:THREE.DoubleSide}));e.renderOrder=-2,n.mdl.add(e),11==t||12==t?n.prevMaps.push(e):13==t?n.prevEmmaps.push(e):14==t?n.prevPhimaps.push(e):n.prevSurfaces.push(e)}c=null,g=null,f=null,l=null}transformMemPro(e,t,s,i,l){this.icn3d.icn3dui;let n=e.clone();n.sub(s),l&&console.log("sub coord: "+JSON.stringify(n));let r=n.x*t[0]+n.y*t[1]+n.z*t[2]+i.x,o=n.x*t[3]+n.y*t[4]+n.z*t[5]+i.y,a=n.x*t[6]+n.y*t[7]+n.z*t[8]+i.z;return n.x=r,n.y=o,n.z=a,l&&console.log("out coord: "+JSON.stringify(n)),n}SetupSurface(e){let t=this.icn3d;t.icn3dui;let s=e.threshbox,i=new k(t,s);i.initparm(e.extent,1!==e.type,e.bCalcArea,e.atomsToShow,e.header,e.data,e.matrix,e.isovalue,e.loadPhiFrom),i.fillvoxels(e.allatoms,e.extendedAtoms),i.buildboundary(),2===e.type&&(i.fastdistancemap(),i.boundingatom(!1),i.fillvoxelswaals(e.allatoms,e.extendedAtoms));let l=i.marchingcube();i.vpBits=null,i.vpDistance=null,i.vpAtomID=null;let n=i.getFacesAndVertices(e.atomsToShow);return n.area=l.area,n.serial2area=l.serial2area,n.scaleFactor=l.scaleFactor,i.faces=null,i.verts=null,n}SetupMap(e){let t=this.icn3d;t.icn3dui;let s,i=new O(t);return i.initparm(e.header,e.data,e.matrix,e.isovalue,e.center,e.maxdist,e.pmin,e.pmax,e.water,e.type,e.rmsd_supr,e.loadPhiFrom,e.icn3d),i.fillvoxels(e.allatoms,e.extendedAtoms),e.header.bSurface||i.buildboundary(),e.header.bSurface||i.marchingcube(),i.vpBits=null,i.vpAtomID=null,e.header.bSurface||(s=i.getFacesAndVertices(e.allatoms,e.atomsToShow)),i.faces=null,i.verts=null,s}}class D{constructor(e){this.icn3d=e}shareLink(e,t){var s=this.icn3d,i=s.icn3dui;let l=this.shareLinkUrl(),n=l.length>4e3||0!==l.indexOf("http");e&&(l+="&random="+parseInt(1e3*Math.random()));let r=Object.keys(s.structures).join("_");if("STRU"==r&&(s.filename?r=s.filename:s.inputid&&(r=s.inputid)),e){if(t||s.bInputfile||n)return void s.saveFileCls.saveFile(r+"_icn3d_loadable.png","png")}else{if(s.bInputfile&&!s.bInputUrlfile)return void alert("Share Link does NOT work when the data are from custom files. Please save 'iCn3D PNG Image' in the File menu and open it in iCn3D.");if(n)return void alert("The url is more than 4000 characters and may not work. Please save 'iCn3D PNG Image' or 'State File' and open them in iCn3D.");i.htmlCls.clickMenuCls.setLogCmd("share link: "+l,!1)}$.ajax({url:"https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key=AIzaSyBxl9CgM0dY5lagHL4UOhEpLWE1fuwdnvc",type:"POST",data:{longDynamicLink:"https://icn3d.page.link/?link="+encodeURIComponent(l)},dataType:"json",success:function(t){let n="Problem in getting shortened URL";if(void 0!==t.shortLink&&(n=t.shortLink,e)){let e=n.split("/"),t=e[e.length-1];s.saveFileCls.saveFile(r+"-"+t+".png","png");let i='<div style="float:left; border: solid 1px #0000ff; padding: 5px; margin: 10px; text-align:center;">';i+='<a href="https://structure.ncbi.nlm.nih.gov/icn3d/share.html?'+t+'" target="_blank">',i+='<img style="height:300px" src ="'+r+"-"+t+'.png"><br>\n',i+="\x3c!--Start of your comments==================--\x3e\n";let l=s.yournote?": "+s.yournote.replace(/\n/g,"<br>").replace(/; /g,", "):"";i+="PDB "+r.toUpperCase()+l+"\n",i+="\x3c!--End of your comments====================--\x3e\n",i+="</a>",i+="</div>\n\n",s.saveFileCls.saveFile(r+"-"+t+".html","html",i)}e&&void 0===t.shortLink&&s.saveFileCls.saveFile(r+"_icn3d_loadable.png","png");let o=n.split("page.link/");2==o.length&&(n="https://structure.ncbi.nlm.nih.gov/icn3d/share.html?"+o[1]),$("#"+s.pre+"ori_url").val(l),$("#"+s.pre+"short_url").val(n),$("#"+s.pre+"short_url_title").val(n+"&t="+s.yournote),e||i.htmlCls.dialogCls.openDlg("dl_copyurl","Copy a Share Link URL")},error:function(t,n,r){let o="Problem in getting shortened URL";$("#"+s.pre+"ori_url").val(l),$("#"+s.pre+"short_url").val(o),$("#"+s.pre+"short_url_title").val(o+"&t="+s.yournote),e||i.htmlCls.dialogCls.openDlg("dl_copyurl","Copy a Share Link URL")}})}shareLinkUrl(e){var t=this.icn3d,s=t.icn3dui;let i=s.htmlCls.baseUrl+"icn3d/full.html?";if(s.cfg.bSidebyside&&(i=s.htmlCls.baseUrl+"icn3d/full2.html?"),t.bInputUrlfile){i=window.location.href.split("?")[0]+"?"+t.inputurl+"&"}let l,n={};for(let e in t.cfg){let s=t.cfg[e];"inpara"!==e&&"command"!==e&&"usepdbnum"!==e&&"date"!==e&&"v"!==e&&void 0!==s&&("width"===e&&"100%"===s||"height"===e&&"100%"===s||"resize"===e&&!0===s||"showmenu"===e&&!0===s||"showtitle"===e&&!0===s||"showcommand"===e&&!0===s||"simplemenu"===e&&!1===s||"mobilemenu"===e&&!1===s||"showanno"===e&&!1===s||"showseq"===e&&!1===s||"showalignseq"===e&&!1===s||"show2d"===e&&!1===s||"showsets"===e&&!1===s||"rotate"===e&&"right"===s||"command"!==e&&("options"===e?Object.keys(s).length>0&&(n[e]=JSON.stringify(s)):!0===s?n[e]=1:!1===s?n[e]=0:""!==s&&(n[e]=s)))}let r=-1;void 0!==s.cfg.inpara&&(r=s.cfg.inpara.indexOf("&command=")),l=-1!==r?s.cfg.inpara.substr(0,r):s.cfg.inpara;let o=!1;if(!t.bInputUrlfile){let e=l&&l.substr(1)?l.substr(1).split("&"):[];for(let t=0,s=e.length;t<s;++t){let s=e[t].split("=");2==s.length&&(n[s[0]]=s[1])}for(let e in n)"v"!==e&&("date"===e&&(o=!0),i+=e+"="+n[e]+"&")}let a=new Date,d=(a.getMonth()+1).toString();a.getMonth()+1<10&&(d="0"+d);let c=a.getDate().toString();a.getDate()<10&&(c="0"+c);let h=a.getFullYear().toString()+d+c;o||(i+="date="+h+"&"),i+="v="+s.REVISION+"&",i+="command=";let m=0;(e||t.bInputUrlfile)&&(m=0);let p={};p.factor=t._zoomFactor,p.mouseChange=t.mouseChange,p.quaternion=t.quaternion;let u,C="",g="toggle highlight",f=0;if(t.commands.length>m){u=t.commands[m].split("|||")[0].split("&command=")[0].trim(),-1!==u.indexOf(g)&&++f}let b,y=m+1,v="";for(let e=t.commands.length;y<e;++y){let e=t.commands[y].split("|||")[0].split("&command=")[0].trim();(-1!==u.indexOf("select saved atoms")||-1!==u.indexOf("select sets"))&&(0===e.indexOf("select")||0===e.indexOf("select"))&&-1===u.indexOf(" name ")||-1!==u.indexOf("pickatom")&&-1!==e.indexOf("pickatom")||"show selection"==u&&-1!=t.commands.slice(y).toString().indexOf("show selection")||(-1!==u.indexOf(g)?++f:y===m+1?void 0!==l&&t.inputid||(v+=u):v+=v?"; "+u:u),C+=u+"\n",u=e}return i+=v,u&&(v&&(i+="; "),f>0&&f%2==0&&u!==g&&(i+=g+"; "),i+=u+"|||"+t.transformCls.getTransformationStr(p),C+=u+"|||"+t.transformCls.getTransformationStr(p)+"\n"),C=C.replace(/!/g,Object.keys(t.structures)[0]+"_"),(t.bInputfile&&!t.bInputUrlfile||t.bInputUrlfile&&t.bAppend||i.length>4e3)&&(i=C),void 0!==t.structures&&1==Object.keys(t.structures).length&&void 0!==t.inputid&&(b=Object.keys(t.structures)[0],i=i.replace(new RegExp(b+"_","g"),"!")),void 0!==s.cfg.blast_rep_id&&(i=i.replace(new RegExp("blast_rep_id=!","g"),"blast_rep_id="+b+"_")),i}getPngText(){var e=this.icn3d;let t;e.icn3dui;let s="";if(e.bInputfile)t=this.shareLinkUrl(true),"http"==t.substr(0,4)?s+="\nShare Link: "+t:(s+="\nStart of type file======\n",s+=e.InputfileType+"\n",s+="End of type file======\n",s+="Start of data file======\n",s+=e.saveFileCls.getAtomPDB(e.atoms),s+="End of data file======\n",s+="Start of state file======\n",s+=t+"\n",s+="End of state file======\n");else{t=this.shareLinkUrl(),t.length>4e3||0!==t.indexOf("http")?(t=this.shareLinkUrl(true),s+="\nStart of state file======\n",s+=t+"\n",s+="End of state file======\n"):s+="\nShare Link: "+t}return s=s.replace(/!/g,Object.keys(e.structures)[0]+"_"),s}}class R{constructor(e){this.icn3d=e}addHlObjects(e,t,s){let i=this.icn3d,l=i.icn3dui,n=s?l.hashUtilsCls.intHash(s,i.dAtoms):l.hashUtilsCls.intHash(i.hAtoms,i.dAtoms);i.applyDisplayCls.applyDisplayOptions(i.opts,n,i.bHighlight),(t||i.bRender)&&i.drawCls.render()}removeHlObjects(){let e=this.icn3d;e.icn3dui;for(let t in e.prevHighlightObjects)e.mdl.remove(e.prevHighlightObjects[t]);e.prevHighlightObjects=[];for(let t in e.prevHighlightObjects_ghost)e.mdl.remove(e.prevHighlightObjects_ghost[t]);e.prevHighlightObjects_ghost=[]}}class I{constructor(e){this.icn3d=e}setThichknessFor3Dprint(){let e=this.icn3d,t=e.icn3dui;e.lineRadius=1,e.coilWidth=1.2,e.cylinderRadius=.8,e.traceRadius=1,e.dotSphereScale=.6,e.sphereRadius=1.5,e.ribbonthickness=1,e.helixSheetWidth=2,e.nucleicAcidWidth=1.4,t.htmlCls.setHtmlCls.setCookieForThickness()}prepareFor3Dprint(){let e=this.icn3d,t=e.icn3dui;if(e.bShowHighlight=!1,e.hlObjectsCls.removeHlObjects(),e.bDashedLines=!1,e.bSetThickness||void 0!==t.cfg.cid||this.setThichknessFor3Dprint(),void 0!==e.lines.hbond)for(let t=0,s=e.lines.hbond.length;t<s;++t){e.lines.hbond[t].dashed=!1,e.bDashedLines=!0}if(void 0!==e.lines.distance)for(let t=0,s=e.lines.distance.length;t<s;++t){e.lines.distance[t].dashed=!1,e.bDashedLines=!0}e.drawCls.draw()}resetAfter3Dprint(){let e=this.icn3d,t=e.icn3dui;if(void 0!==e.lines.hbond)for(let t=0,s=e.lines.hbond.length;t<s;++t){e.lines.hbond[t].dashed=!0}if(void 0!==e.lines.distance)for(let t=0,s=e.lines.distance.length;t<s;++t){e.lines.distance[t].dashed=!0}e.lineRadius=.1,e.coilWidth=.3,e.cylinderRadius=.4,e.traceRadius=.4,e.dotSphereScale=.3,e.sphereRadius=1.5,e.cylinderHelixRadius=1.6,e.ribbonthickness=.2,e.helixSheetWidth=1.3,e.nucleicAcidWidth=.8,t.htmlCls.setHtmlCls.setCookieForThickness()}removeOneStabilizer(e){let t,s=this.icn3d;s.icn3dui;for(let i=0,l=s.pairArray.length;i<l;i+=2){let l=this.getResidueRepAtom(s.pairArray[i]),n=this.getResidueRepAtom(s.pairArray[i+1]);if(null!=e)for(let s=0,r=e.length;s<r;s+=2){let r=this.getResidueRepAtom(e[s]),o=this.getResidueRepAtom(e[s+1]);if(l.serial==r.serial&&n.serial==o.serial||l.serial==o.serial&&n.serial==r.serial){t=i;break}}if(void 0!==t)break}void 0!==t&&s.pairArray.splice(t,2)}outputSelection(){let e=this.icn3d;e.icn3dui;let t={};for(let s in e.hAtoms){t[e.atoms[s].structure+"_"+e.atoms[s].chain+"_"+e.atoms[s].resi]=1}let s=Object.keys(t).sort((function(e,t){if(""!==e&&!isNaN(e))return parseInt(e)-parseInt(t);{let s=e.lastIndexOf("_"),i=t.lastIndexOf("_");if(e.substr(0,s)<t.substr(0,s))return-1;if(e.substr(0,s)>t.substr(0,s))return 1;if(e.substr(0,s)==t.substr(0,s)){if(parseInt(e.substr(s+1))<parseInt(t.substr(i+1)))return-1;if(parseInt(e.substr(s+1))>parseInt(t.substr(i+1)))return 1;if(parseInt(e.substr(s+1))==parseInt(t.substr(i+1)))return 0}}})),i="<table><tr><th>Structure</th><th>Chain</th><th>Residue Number</th></tr>";for(let e=0,t=s.length;e<t;++e){let t=s[e].indexOf("_"),l=s[e].lastIndexOf("_");i+="<tr><td>"+s[e].substr(0,t)+"</td><td>"+s[e].substr(t+1,l-t-1)+"</td><td>"+s[e].substr(l+1)+"</td></tr>"}let l=e.inputid?e.inputid:"custom";e.saveFileCls.saveFile(l+"_residues.txt","html",i)}addStabilizer(){let e=this.icn3d,t=e.icn3dui,s=3.5;if(Object.keys(e.dAtoms).length>0){let i,l={},n=12.25,r=3.2*3.2;for(let t in e.dAtoms){let s=e.atoms[t];!e.nucleotides.hasOwnProperty(s.serial)||"N1"!==s.name&&"N2"!==s.name&&"N3"!==s.name&&"N4"!==s.name&&"N6"!==s.name&&"O2"!==s.name&&"O6"!==s.name||(i=s.structure+"_"+s.chain+"_"+s.resi+"_"+s.name,l[i]=s)}let o=Object.keys(l),a=o.length;void 0===e.pairArray&&(e.pairArray=[]);for(let t=0;t<a;++t)for(let i=t+1;i<a;++i){let a=o[t],d=o[i],c=Math.abs(l[a].coord.x-l[d].coord.x);if(c>s)continue;let h=Math.abs(l[a].coord.y-l[d].coord.y);if(h>s)continue;let m=Math.abs(l[a].coord.z-l[d].coord.z);if(m>s)continue;let p=c*c+h*h+m*m;p>n||p<r||(e.pairArray.push(l[a].serial),e.pairArray.push(l[d].serial))}let d=6,c={};for(let t in e.dAtoms){let s=e.atoms[t];c[s.structure+"_"+s.chain+"_"+s.resi]=1}let h={};for(let t in e.chemicals){let s=e.atoms[t],i=s.structure+"_"+s.chain+"_"+s.resi;c.hasOwnProperty(i)&&(h[i]=1)}for(let t in e.ions){let s=e.atoms[t],i=s.structure+"_"+s.chain+"_"+s.resi;c.hasOwnProperty(i)&&(h[i]=1)}let m=Object.keys(e.chains);for(let t=0,s=m.length;t<s;++t){let s,i=m[t],l=0,n=0;for(let t=0,r=e.chainsSeq[i].length;t<r;++t)s=i+"_"+e.chainsSeq[i][t].resi,"c"!=e.secondaries[s]&&"E"!=e.secondaries[s]&&"H"!=e.secondaries[s]||(l%3!=0&&e.chainsSeq[i][t].resi==parseInt(n)+1||c.hasOwnProperty(s)&&(h[s]=1),++l,n=e.chainsSeq[i][t].resi);"c"!=e.secondaries[s]&&"E"!=e.secondaries[s]&&"H"!=e.secondaries[s]||c.hasOwnProperty(s)&&(h[s]=1)}let p=Object.keys(h);void 0===e.pairArray&&(e.pairArray=[]);let u=t.hashUtilsCls.exclHash(e.dAtoms,e.water);for(let s=0,i=p.length;s<i;++s){let i=p[s],l=e.secondaries[i],n=e.contactCls.getNeighboringAtoms(u,t.hashUtilsCls.hash2Atoms(e.residues[i],e.atoms),d),r=Object.keys(n).sort(),o=Object.keys(e.residues[i]).sort(),a=!1;if(e.proteins.hasOwnProperty(o[0])){o=[o[0]],a=!0;let t=parseInt(i.substr(i.lastIndexOf("_")+1)),s={};for(let i in n){if(e.chemicals.hasOwnProperty(i)||e.ions.hasOwnProperty(i))continue;let n=e.atoms[i];isNaN(n.resi)||("c"==l&&(n.resi>t+1||n.resi<t-1)||"E"==l&&(n.resi>t+2||n.resi<t-2)||"H"==l&&(n.resi>t+4||n.resi<t-4))&&(s[i]=1)}r=Object.keys(s).sort()}if(r.length>0&&o.length>0)if(a){let t=parseInt((r.length+.5)/2);e.pairArray.push(o[0]),e.pairArray.push(r[t])}else{let t=10,s=parseInt(r.length/(t+1));for(let i=0,l=o.length;i<l;++i)if(i%t==0){let l=parseInt(i/t)*s,n=l<r.length?l:r.length-1;e.pairArray.push(o[i]),e.pairArray.push(r[n]),o.length<t+1&&(e.pairArray.push(o[i]),e.pairArray.push(r[r.length-1]))}}}}}hideStabilizer(){let e=this.icn3d;e.icn3dui,e.pairArray=[],e.lines.stabilizer=[],e.stabilizerpnts=[];for(let t in e.water)e.atoms[t].style=e.opts.water}getResidueRepAtom(e){let t=this.icn3d;t.icn3dui;let s,i=t.atoms[e],l=i.structure+"_"+i.chain+"_"+i.resi;if(t.proteins.hasOwnProperty(e)||t.nucleotides.hasOwnProperty(e))for(let e in t.residues[l]){let i=t.atoms[e];if("CA"===i.name||"N3"===i.name){s=t.atoms[e];break}}else s=i;return void 0===s&&(s=i),s}}class E{constructor(e){this.icn3d=e}applySurfaceOptions(e){let t,s,i=this.icn3d,l=i.icn3dui;switch(void 0===e&&(e=i.opts),e.wireframe){case"yes":e.wireframe=!0;break;case"no":e.wireframe=!1}switch(e.opacity=parseFloat(e.opacity),t=l.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),"nothing"===e.water&&(t=l.hashUtilsCls.exclHash(t,i.water)),s=l.hashUtilsCls.hash2Atoms(t,i.atoms),e.surface.toLowerCase()){case"van der waals surface":case"van der waals surface with context":i.surfaceCls.createSurfaceRepresentation(s,1,e.wireframe,e.opacity);break;case"solvent accessible surface":case"solvent accessible surface with context":i.surfaceCls.createSurfaceRepresentation(s,3,e.wireframe,e.opacity);break;case"molecular surface":case"molecular surface with context":i.surfaceCls.createSurfaceRepresentation(s,2,e.wireframe,e.opacity);break;case"nothing":this.removeSurfaces()}}applyMapOptions(e){let t,s,i=this.icn3d,l=i.icn3dui;switch(void 0===e&&(e=i.opts),e.mapwireframe){case"yes":e.mapwireframe=!0;break;case"no":e.mapwireframe=!1}switch(t=l.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),s=l.hashUtilsCls.hash2Atoms(t,i.atoms),e.map.toLowerCase()){case"2fofc":i.surfaceCls.createSurfaceRepresentation(s,11,e.mapwireframe);break;case"fofc":i.surfaceCls.createSurfaceRepresentation(s,12,e.mapwireframe);break;case"nothing":this.removeMaps()}}applyEmmapOptions(e){let t,s,i=this.icn3d,l=i.icn3dui;switch(void 0===e&&(e=i.opts),e.emmapwireframe){case"yes":e.emmapwireframe=!0;break;case"no":e.emmapwireframe=!1}switch(t=l.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),s=l.hashUtilsCls.hash2Atoms(t,i.atoms),e.emmap.toLowerCase()){case"em":i.surfaceCls.createSurfaceRepresentation(s,13,e.emmapwireframe);break;case"nothing":this.removeEmmaps()}}applyPhimapOptions(e){let t,s,i=this.icn3d,l=i.icn3dui;switch(void 0===e&&(e=i.opts),e.phimapwireframe){case"yes":e.phimapwireframe=!0;break;case"no":e.phimapwireframe=!1}switch(t=l.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),s=l.hashUtilsCls.hash2Atoms(t,i.atoms),e.phimap.toLowerCase()){case"phi":i.surfaceCls.createSurfaceRepresentation(s,14,e.phimapwireframe);break;case"nothing":this.removePhimaps()}}applyphisurfaceOptions(e){let t,s,i=this.icn3d,l=i.icn3dui;switch(void 0===e&&(e=i.opts),i.phisurfwf){case"yes":e.phisurfwf=!0;break;case"no":e.phisurfwf=!1}switch(e.phisurfop=parseFloat(i.phisurfop),t=l.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),"nothing"===e.water&&(t=l.hashUtilsCls.exclHash(t,i.water)),s=l.hashUtilsCls.hash2Atoms(t,i.atoms),e.phisurface.toLowerCase()){case"phi":i.surfaceCls.createSurfaceRepresentation(s,parseInt(i.phisurftype),e.phisurfwf,e.phisurfop);break;case"nothing":this.removeSurfaces()}}removeSurfaces(){let e=this.icn3d;e.icn3dui;for(let t=0,s=e.prevSurfaces.length;t<s;++t)e.mdl.remove(e.prevSurfaces[t]);e.prevSurfaces=[]}removeLastSurface(){let e=this.icn3d;e.icn3dui,e.prevSurfaces.length>0&&(e.mdl.remove(e.prevSurfaces[e.prevSurfaces.length-1]),e.prevSurfaces.slice(e.prevSurfaces.length-1,1))}removeMaps(){let e=this.icn3d;e.icn3dui;for(let t=0,s=e.prevMaps.length;t<s;++t)e.mdl.remove(e.prevMaps[t]);e.prevMaps=[]}removeEmmaps(){let e=this.icn3d;e.icn3dui;for(let t=0,s=e.prevEmmaps.length;t<s;++t)e.mdl.remove(e.prevEmmaps[t]);e.prevEmmaps=[]}removePhimaps(){let e=this.icn3d;e.icn3dui;for(let t=0,s=e.prevPhimaps.length;t<s;++t)e.mdl.remove(e.prevPhimaps[t]);e.prevPhimaps=[]}removeLastMap(){let e=this.icn3d;e.icn3dui,e.prevMaps.length>0&&(e.mdl.remove(e.prevMaps[e.prevMaps.length-1]),e.prevMaps.slice(e.prevMaps.length-1,1))}removeLastEmmap(){let e=this.icn3d;e.icn3dui,e.prevEmmaps.length>0&&(e.mdl.remove(e.prevEmmaps[e.prevEmmaps.length-1]),e.prevEmmaps.slice(e.prevEmmaps.length-1,1))}removeLastPhimap(){let e=this.icn3d;e.icn3dui,e.prevPhimaps.length>0&&(e.mdl.remove(e.prevPhimaps[e.prevPhimaps.length-1]),e.prevPhimaps.slice(e.prevPhimaps.length-1,1))}}class T{constructor(e){this.icn3d=e}exportStlFile(e){let t=this.icn3d;t.icn3dui,void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&(t.threshbox=180/Math.pow(t.biomtMatrices.length,.33),t.applyMapCls.removeSurfaces(),t.applyMapCls.applySurfaceOptions(),t.applyMapCls.removeMaps(),t.applyMapCls.applyMapOptions(),t.applyMapCls.removeEmmaps(),t.applyMapCls.applyEmmapOptions());let s=this.saveStlFile(),i=t.inputid?t.inputid:"custom";if(t.saveFileCls.saveFile(i+e+".stl","binary",s),void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length>t.maxAtoms3DMultiFile){alert(t.biomtMatrices.length+" files will be generated for this assembly. Please merge these files using some software and 3D print the merged file.");let l=new THREE.Matrix4;l.identity();let n=1;for(let r=0;r<t.biomtMatrices.length;r++){let o=t.biomtMatrices[r];if(void 0===o)continue;if(o.equals(l))continue;let a=100*(r+1);setTimeout(function(l,n){s=this.saveStlFile(l),t.saveFileCls.saveFile(i+e+n+".stl","binary",s),s=""}.bind(this,o,n),a),++n}t.threshbox=180}}exportVrmlFile(e){let t=this.icn3d;t.icn3dui,void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&(t.threshbox=180/Math.pow(t.biomtMatrices.length,.33),t.applyMapCls.removeSurfaces(),t.applyMapCls.applySurfaceOptions(),t.applyMapCls.removeMaps(),t.applyMapCls.applyMapOptions(),t.applyMapCls.removeEmmaps(),t.applyMapCls.applyEmmapOptions());let s=this.saveVrmlFile(),i=t.inputid?t.inputid:"custom";if(t.saveFileCls.saveFile(i+e+".wrl","text",s),void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length>t.maxAtoms3DMultiFile){alert(t.biomtMatrices.length+" files will be generated for this assembly. Please merge these files using some software and 3D print the merged file.");let i=new THREE.Matrix4;i.identity();let l=1;for(let n=0;n<t.biomtMatrices.length;n++){let r=t.biomtMatrices[n];if(void 0===r)continue;if(r.equals(i))continue;let o=100*(n+1);setTimeout(function(i,l){s=this.saveVrmlFile(i),t.saveFileCls.saveFile(t.inputid+e+l+".wrl","text",s),s=""}.bind(this,r,l),o),++l}t.threshbox=180}}getFaceCnt(e){this.icn3d.icn3dui;let t=0;for(let s=0,i=e.children.length;s<i;++s){let i=e.children[s];"Sprite"!==i.type&&(t+=i.geometry.getIndex().array.length/3)}return t}saveStlFile(e){let t=this.icn3d,s=t.icn3dui;if(Object.keys(t.dAtoms).length>7e4)return alert("Please display a subset of the structure to export 3D files. Then merge the files for 3D printing..."),[""];t.threeDPrintCls.prepareFor3Dprint();let i=0;i+=this.getFaceCnt(t.mdl),i+=this.getFaceCnt(t.mdl_ghost);let l=[],n=new Uint8Array(84),r="STL file for the structure(s) ",o=Object.keys(t.structures);for(let e=0,t=o.length;e<t;++e)r+=o[e],e<t-1&&(r+=", ");r.length>80&&(r=r.substr(0,80));for(let e=0;e<80;++e)e<r.length?n[e]=s.convertTypeCls.passInt8([r.charCodeAt(e)])[0]:n[e]=s.convertTypeCls.passInt8([" ".charCodeAt(0)])[0];if(n=void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length<=t.maxAtoms3DMultiFile?this.updateArray(n,s.convertTypeCls.passInt32([i*t.biomtMatrices.length]),80):this.updateArray(n,s.convertTypeCls.passInt32([i]),80),l.push(new Blob([n],{type:"application/octet-stream"})),l=this.processStlMeshGroup(t.mdl,l,e),l=this.processStlMeshGroup(t.mdl_ghost,l,e),void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length<=t.maxAtoms3DMultiFile){let e=new THREE.Matrix4;e.identity();for(let s=0;s<t.biomtMatrices.length;s++){let i=t.biomtMatrices[s];void 0!==i&&(i.equals(e)||(l=this.processStlMeshGroup(t.mdl,l,i),l=this.processStlMeshGroup(t.mdl_ghost,l,i)))}}return t.threeDPrintCls.resetAfter3Dprint(),l}updateArray(e,t,s){this.icn3d.icn3dui;for(let i=0,l=t.length;i<l;++i)e[s+i]=t[i];return e}processStlMeshGroup(e,t,s){let i=this.icn3d.icn3dui;for(let l=0,n=e.children.length;l<n;++l){let n=e.children[l];if("Sprite"===n.type)continue;let r=n.geometry,o=r.getAttribute("position").array,a=r.getIndex().array,d=n.position,c=n.scale,h=n.matrix,m=new Uint8Array(a.length/3*50),p=0;for(let e=0,t=a.length;e<t;e+=3){let t,l,n,u=a[e],C=a[e+1],g=a[e+2],f=new THREE.Vector3(o[3*u],o[3*u+1],o[3*u+2]),b=new THREE.Vector3(o[3*C],o[3*C+1],o[3*C+2]),y=new THREE.Vector3(o[3*g],o[3*g+1],o[3*g+2]);"SphereGeometry"==r.type||"BoxGeometry"==r.type?(t=f.clone().multiply(c).add(d),l=b.clone().multiply(c).add(d),n=y.clone().multiply(c).add(d)):"CylinderGeometry"==r.type?(t=f.clone().applyMatrix4(h),l=b.clone().applyMatrix4(h),n=y.clone().applyMatrix4(h)):(t=f.clone(),l=b.clone(),n=y.clone()),m=this.updateArray(m,i.convertTypeCls.passFloat32([0,0,0]),p),p+=12,void 0!==s&&(t.applyMatrix4(s),l.applyMatrix4(s),n.applyMatrix4(s)),m=this.updateArray(m,i.convertTypeCls.passFloat32([t.x,t.y,t.z]),p),p+=12,m=this.updateArray(m,i.convertTypeCls.passFloat32([l.x,l.y,l.z]),p),p+=12,m=this.updateArray(m,i.convertTypeCls.passFloat32([n.x,n.y,n.z]),p),p+=12,t=l=n=void 0,m=this.updateArray(m,i.convertTypeCls.passInt16([0]),p),p+=2}t.push(new Blob([m],{type:"application/octet-stream"})),m=null}return t}saveVrmlFile(e){let t=this.icn3d;if(t.icn3dui,Object.keys(t.dAtoms).length>5e4)return alert("Please display a subset of the structure to export 3D files. Then merge the files for 3D printing..."),[""];t.threeDPrintCls.prepareFor3Dprint();let s=[];s.push("#VRML V2.0 utf8\n");let i=0,l=this.processVrmlMeshGroup(t.mdl,s,i,e);if(s=l.vrmlStrArray,i=l.vertexCnt,l=this.processVrmlMeshGroup(t.mdl_ghost,s,i,e),s=l.vrmlStrArray,i=l.vertexCnt,void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length<=t.maxAtoms3DMultiFile){let e=new THREE.Matrix4;e.identity();for(let n=0;n<t.biomtMatrices.length;n++){let r=t.biomtMatrices[n];void 0!==r&&(r.equals(e)||(l=this.processVrmlMeshGroup(t.mdl,s,i,r),s=l.vrmlStrArray,i=l.vertexCnt,l=this.processVrmlMeshGroup(t.mdl_ghost,s,i,r),s=l.vrmlStrArray,i=l.vertexCnt))}}return s}processVrmlMeshGroup(e,t,s,i){let l=this.icn3d.icn3dui;for(let s=0,n=e.children.length;s<n;++s){let n=e.children[s];if("Sprite"===n.type)continue;let r=n.geometry;n.material.type,r.type;let o=r.getAttribute("position").array,a=r.getAttribute("color")?r.getAttribute("color").array:[],d=r.getIndex().array,c=n.position,h=n.scale,m=n.matrix,p=l.parasCls.thr(1,1,1);"SphereGeometry"!=r.type&&"BoxGeometry"!=r.type&&"CylinderGeometry"!=r.type||void 0!==n.material&&(p=n.material.color),t.push("Shape {\n"),t.push("geometry IndexedFaceSet {\n"),t.push("coord Coordinate { point [ ");let u=[];for(let e=0,s=o.length;e<s;e+=3){let n,a=new THREE.Vector3(o[e],o[e+1],o[e+2]);n="SphereGeometry"==r.type||"BoxGeometry"==r.type?a.clone().multiply(h).add(c):"CylinderGeometry"==r.type?a.clone().applyMatrix4(m):a.clone(),void 0!==i&&n.applyMatrix4(i),t.push(n.x.toPrecision(5)+" "+n.y.toPrecision(5)+" "+n.z.toPrecision(5)),n=void 0,e<s-3&&t.push(", "),u.push(l.parasCls.thr(1,1,1))}t.push(" ] }\n");let C="",g="";for(let e=0,t=d.length;e<t;e+=3){let s,i=d[e],l=d[e+1],n=d[e+2];s="SphereGeometry"==r.type||"BoxGeometry"==r.type||"CylinderGeometry"==r.type?p:new THREE.Color(a[3*i],a[3*i+1],a[3*i+2]),C+=i+" "+l+" "+n,e<t-3&&(C+=", -1, "),u[i]=s,u[l]=s,u[n]=s}for(let e=0,t=u.length;e<t;++e){let s=u[e];g+=s.r.toPrecision(3)+" "+s.g.toPrecision(3)+" "+s.b.toPrecision(3),e<t-1&&(g+=", ")}t.push("coordIndex [ "+C+" ]\n"),t.push("color Color { color [ "+g+" ] } colorPerVertex TRUE\n"),t.push("  }\n"),t.push("}\n")}return{vrmlStrArray:t,vertexCnt:s}}}class M{constructor(e){this.icn3d=e}setProtNuclLigInMenu(){let e=this.icn3d;if(e.icn3dui,Object.keys(e.proteins).length>0&&(e.defNames2Residues.proteins=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.proteins)),e.defNames2Descr.proteins="proteins",e.defNames2Command.proteins="select :proteins"),Object.keys(e.nucleotides).length>0&&(e.defNames2Residues.nucleotides=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.nucleotides)),e.defNames2Descr.nucleotides="nucleotides",e.defNames2Command.nucleotides="select :nucleotides"),Object.keys(e.chemicals).length>0)if(e.bOpm){let t={},s={};for(let i in e.chemicals){let l=e.atoms[i],n=l.structure+"_"+l.chain+"_"+l.resi;"DUM"===l.resn?s[n]=1:t[n]=1}Object.keys(t).length>0&&(e.defNames2Residues.chemicals=Object.keys(t),e.defNames2Descr.chemicals="chemicals",e.defNames2Command.chemicals="select :chemicals"),Object.keys(s).length>0&&(e.defNames2Residues.membrane=Object.keys(s),e.defNames2Descr.membrane="membrane",e.defNames2Command.membrane="select :membrane")}else e.defNames2Residues.chemicals=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.chemicals)),e.defNames2Descr.chemicals="chemicals",e.defNames2Command.chemicals="select :chemicals";Object.keys(e.ions).length>0&&(e.defNames2Residues.ions=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.ions)),e.defNames2Descr.ions="ions",e.defNames2Command.ions="select :ions"),Object.keys(e.water).length>0&&(e.defNames2Residues.water=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.water)),e.defNames2Descr.water="water",e.defNames2Command.water="select :water"),this.setTransmemInMenu(e.halfBilayerSize,-e.halfBilayerSize)}setPredefinedInMenu(){let e=this.icn3d,t=e.icn3dui;if(this.setChainsInMenu(),this.setProtNuclLigInMenu(),void 0!==t.cfg.mmdbid||void 0!==t.cfg.gi||void 0!==t.cfg.chainalign||void 0!==t.cfg.mmdbafid)for(let t in e.tddomains)e.selectionCls.selectResidueList(e.tddomains[t],t,t,!1,!1);if((void 0!==t.cfg.align||void 0!==t.cfg.chainalign&&2==e.chainidArray.length)&&e.bFullUi){e.selectionCls.selectResidueList(e.consHash1,e.conservedName1,e.conservedName1,!1,!1),e.selectionCls.selectResidueList(e.consHash2,e.conservedName2,e.conservedName2,!1,!1),e.selectionCls.selectResidueList(e.nconsHash1,e.nonConservedName1,e.nonConservedName1,!1,!1),e.selectionCls.selectResidueList(e.nconsHash2,e.nonConservedName2,e.nonConservedName2,!1,!1),e.selectionCls.selectResidueList(e.nalignHash1,e.notAlignedName1,e.notAlignedName1,!1,!1),e.selectionCls.selectResidueList(e.nalignHash2,e.notAlignedName2,e.notAlignedName2,!1,!1);let s={};for(let i in e.alnChains)s=t.hashUtilsCls.unionHash(s,e.alnChains[i]);let i={},l={};for(let t in s){let s=e.atoms[t],n=s.structure+"_"+s.chain;i[n+"_"+s.resi]=1,l[n]=1}let n="protein_aligned",r="aligned protein and nucleotides",o="select "+e.resid2specCls.residueids2spec(Object.keys(i));e.selectionCls.addCustomSelection(Object.keys(i),n,r,o,!0)}}setAtomMenu(e){let t=this.icn3d;t.icn3dui;let s="",i=void 0!==t.defNames2Residues?Object.keys(t.defNames2Residues):[],l=void 0!==t.defNames2Atoms?Object.keys(t.defNames2Atoms):[],n=i.concat(l).sort(),r=[];n.forEach((e=>{-1===$.inArray(e,r)&&r.push(e)}));for(let i=0,l=r.length;i<l;++i){let l,n,o=r[i];if(void 0!==t.defNames2Atoms&&t.defNames2Atoms.hasOwnProperty(o)){let e=t.defNames2Atoms[o];e.length>0&&(l=t.atoms[e[0]])}else if(void 0!==t.defNames2Residues&&t.defNames2Residues.hasOwnProperty(o)){let e=t.defNames2Residues[o];e.length>0&&(n=t.residues[e[0]],n&&(l=t.atoms[Object.keys(n)[0]]))}let a=void 0===l||void 0===l.color||"FFFFFF"===l.color.getHexString().toUpperCase()?"DDDDDD":l.color.getHexString(),d=void 0!==l&&void 0!==l.color?a:"000000";-1!=e.indexOf(o)?s+="<option value='"+o+"' style='color:#"+d+"' selected='selected'>"+o+"</option>":s+="<option value='"+o+"' style='color:#"+d+"'>"+o+"</option>"}return s}setChainsInMenu(){let e=this.icn3d;e.icn3dui;for(let t in e.chains)if(e.chainsSeq[t]&&e.chainsSeq[t].length>1){e.defNames2Residues[t]=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.chains[t])),e.defNames2Descr[t]=t;let s=t.indexOf("_"),i=t.substr(0,s),l=t.substr(s+1);e.defNames2Command[t]="select $"+i+"."+l}if(1==Object.keys(e.structures)){let t=Object.keys(e.structures)[0];e.defNames2Residues[t]=Object.keys(e.residues),e.defNames2Descr[t]=t,e.defNames2Command[t]="select $"+t}else{let t=Object.keys(e.residues),s={};for(let e=0,i=t.length;e<i;++e){let i=t[e],l=i.indexOf("_"),n=i.substr(0,l);void 0===s[n]&&(s[n]=[]),s[n].push(i)}for(let t in s)e.defNames2Residues[t]=s[t],e.defNames2Descr[t]=t,e.defNames2Command[t]="select $"+t}}setTransmemInMenu(e,t,s){let i=this.icn3d;if(i.icn3dui,i.bOpm){let l={},n={},r={};for(let s in i.atoms){let o=i.atoms[s];if("DUM"===o.resn)continue;let a=o.structure+"_"+o.chain+"_"+o.resi;o.coord.z>e?n[a]=1:o.coord.z<t?r[a]=1:l[a]=1}let o=s?"2":"";Object.keys(l).length>0&&(i.defNames2Residues["transmembrane"+o]=Object.keys(l),i.defNames2Descr["transmembrane"+o]="transmembrane"+o,i.defNames2Command["transmembrane"+o]="select :transmembrane"+o),Object.keys(n).length>0&&(i.defNames2Residues["extracellular"+o]=Object.keys(n),i.defNames2Descr["extracellular"+o]="extracellular"+o,i.defNames2Command["extracellular"+o]="select :extracellular"+o),Object.keys(r).length>0&&(i.defNames2Residues["intracellular"+o]=Object.keys(r),i.defNames2Descr["intracellular"+o]="intracellular"+o,i.defNames2Command["intracellular"+o]="select :intracellular"+o)}}showSets(){let e=this.icn3d,t=e.icn3dui;t.bNode||(t.htmlCls.dialogCls.openDlg("dl_definedsets","Select sets"),$("#"+e.pre+"dl_setsmenu").show(),$("#"+e.pre+"dl_setoperations").show(),$("#"+e.pre+"dl_command").hide(),$("#"+e.pre+"atomsCustom").resizable());let s=t.hashUtilsCls.cloneHash(e.hAtoms),i=t.hashUtilsCls.cloneHash(e.dAtoms);void 0!==e.bSetChainsAdvancedMenu&&e.bSetChainsAdvancedMenu&&!e.bResetSets||(this.setPredefinedInMenu(),e.bSetChainsAdvancedMenu=!0),e.hAtoms=t.hashUtilsCls.cloneHash(s),e.dAtoms=t.hashUtilsCls.cloneHash(i),e.hlUpdateCls.updateHlMenus()}clickCustomAtoms(){let e=this.icn3d,t=e.icn3dui,s=this;$("#"+e.pre+"atomsCustom").change((function(e){let i=s.icn3d,l=$(this).val();if(i.nameArray=l,null!==l){let e=!1;s.changeCustomAtoms(l,e),t.htmlCls.clickMenuCls.setLogCmd("select sets "+l.join(" "+i.setOperation+" "),!0),i.bSelectResidue=!1}})),t.myEventCls.onIds("#"+e.pre+"atomsCustom","focus",(function(e){let i=s.icn3d;t.utilsCls.isMobile()&&$("#"+i.pre+"atomsCustom").val("")}))}deleteSelectedSets(){let e=this.icn3d;e.icn3dui;let t=$("#"+e.pre+"atomsCustom").val();for(let s=0;s<t.length;++s){let i=t[s];(void 0!==e.defNames2Atoms&&e.defNames2Atoms.hasOwnProperty(i)||void 0!==e.defNames2Residues&&e.defNames2Residues.hasOwnProperty(i))&&(void 0!==e.defNames2Atoms&&e.defNames2Atoms.hasOwnProperty(i)&&delete e.defNames2Atoms[i],void 0!==e.defNames2Residues&&e.defNames2Residues.hasOwnProperty(i)&&delete e.defNames2Residues[i])}e.hlUpdateCls.updateHlMenus()}changeCustomAtoms(e,t){let s=this.icn3d,i=s.icn3dui;s.hAtoms={};for(let t=0;t<e.length;++t){let l=e[t];if(void 0!==s.defNames2Atoms&&s.defNames2Atoms.hasOwnProperty(l)||void 0!==s.defNames2Residues&&s.defNames2Residues.hasOwnProperty(l)){if(void 0!==s.defNames2Atoms&&s.defNames2Atoms.hasOwnProperty(l)){let e=s.defNames2Atoms[l];for(let t=0,i=e.length;t<i;++t)s.hAtoms[e[t]]=1}if(void 0!==s.defNames2Residues&&s.defNames2Residues.hasOwnProperty(l)){let e=s.defNames2Residues[l],t={};for(let l=0,n=e.length;l<n;++l)t=i.hashUtilsCls.unionHash(t,s.residues[e[l]]);s.hAtoms=i.hashUtilsCls.unionHash(s.hAtoms,t)}}}s.hlUpdateCls.updateHlAll(e,t),s.annotationCls.showAnnoSelectedChains(),$("#"+s.pre+"command").val(""),$("#"+s.pre+"command_name").val("");for(let t=0,i=e.length;t<i;++t)if(s.defNames2Atoms[e[t]],s.defNames2Residues[e[t]],s.defNames2Descr[e[t]],0===t)$("#"+s.pre+"command").val("saved atoms "+e[t]),$("#"+s.pre+"command_name").val(e[t]);else{let i=$("#"+s.pre+"command").val();$("#"+s.pre+"command").val(i+" "+s.setOperation+" "+e[t]),i=$("#"+s.pre+"command_name").val(),$("#"+s.pre+"command_name").val(i+" "+s.setOperation+" "+e[t])}}setHAtomsFromSets(e,t){let s=this.icn3d,i=s.icn3dui;for(let l=0;l<e.length;++l){let n=e[l];if(void 0!==s.defNames2Atoms&&s.defNames2Atoms.hasOwnProperty(n)||void 0!==s.defNames2Residues&&s.defNames2Residues.hasOwnProperty(n)){if(void 0!==s.defNames2Atoms&&s.defNames2Atoms.hasOwnProperty(n)){let e=s.defNames2Atoms[n];if("or"===t)for(let t=0,i=e.length;t<i;++t)s.hAtoms[e[t]]=1;else if("and"===t){let t={};for(let s=0,i=e.length;s<i;++s)t[e[s]]=1;s.hAtoms=i.hashUtilsCls.intHash(s.hAtoms,t)}else if("not"===t){let t={};for(let s=0,i=e.length;s<i;++s)t[e[s]]=1;s.hAtoms=i.hashUtilsCls.exclHash(s.hAtoms,t)}}if(void 0!==s.defNames2Residues&&s.defNames2Residues.hasOwnProperty(n)){let e=s.defNames2Residues[n],l={};for(let t=0,n=e.length;t<n;++t)l=i.hashUtilsCls.unionHash(l,s.residues[e[t]]);"or"===t?s.hAtoms=i.hashUtilsCls.unionHash(s.hAtoms,l):"and"===t?s.hAtoms=i.hashUtilsCls.intHash(s.hAtoms,l):"not"===t&&(s.hAtoms=i.hashUtilsCls.exclHash(s.hAtoms,l))}}}}updateAdvancedCommands(e,t){let s=this.icn3d;s.icn3dui;let i=" "+t+" ";for(let l=0,n=e.length;l<n;++l)if(0===l&&"or"==t)$("#"+s.pre+"command").val("saved atoms "+e[l]),$("#"+s.pre+"command_name").val(e[l]);else{let t=$("#"+s.pre+"command").val();$("#"+s.pre+"command").val(t+i+e[l]),t=$("#"+s.pre+"command_name").val(),$("#"+s.pre+"command_name").val(t+i+e[l])}}combineSets(e,t,s,i){let l=this.icn3d,n=l.icn3dui;if(l.hAtoms={},this.setHAtomsFromSets(e,"or"),0==Object.keys(l.hAtoms).length&&(l.hAtoms=n.hashUtilsCls.cloneHash(l.atoms)),this.setHAtomsFromSets(t,"and"),this.setHAtomsFromSets(s,"not"),l.bInitial||l.hlUpdateCls.updateHlAll(),l.annotationCls.showAnnoSelectedChains(),$("#"+l.pre+"command").val(""),$("#"+l.pre+"command_name").val(""),this.updateAdvancedCommands(e,"or"),this.updateAdvancedCommands(t,"and"),this.updateAdvancedCommands(s,"not"),void 0!==i){let e="select "+$("#"+l.pre+"command").val();$("#"+l.pre+"command_name").val(i),l.selectionCls.addCustomSelection(Object.keys(l.hAtoms),i,i,e,!1)}}commandSelect(e){let t=this.icn3d,s=t.icn3dui,i=$("#"+t.pre+"command"+e).val(),l=$("#"+t.pre+"command_name"+e).val().replace(/;/g,"_").replace(/\s+/g,"_");i&&(t.selByCommCls.selectByCommand(i,l,l),s.htmlCls.clickMenuCls.setLogCmd("select "+i+" | name "+l,!0))}clickCommand_apply(){let e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+e.pre+"command_apply","click",(function(e){s.icn3d,e.preventDefault(),s.commandSelect("")})),t.myEventCls.onIds("#"+e.pre+"command_apply2","click",(function(e){s.icn3d,e.preventDefault(),s.commandSelect("2")}))}selectCombinedSets(e,t){this.icn3d.icn3dui;let s=e.split(" "),i=[],l=[],n=[],r="or";for(let e=0,t=s.length;e<t;++e)"or"!==s[e]&&"and"!==s[e]&&"not"!==s[e]?"or"===r?i.push(s[e]):"and"===r?l.push(s[e]):"not"===r&&n.push(s[e]):r=s[e];null!==s&&this.combineSets(i,l,n,t)}clickModeswitch(){let e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+e.pre+"modeswitch","click",(function(t){void 0!==$("#"+e.pre+"modeswitch")[0]&&$("#"+e.pre+"modeswitch")[0].checked?s.setModeAndDisplay("selection"):s.setModeAndDisplay("all")}))}setModeAndDisplay(e){let t=this.icn3d,s=t.icn3dui;"all"===e?(this.setMode("all"),t.prevHighlightAtoms=s.hashUtilsCls.cloneHash(t.hAtoms),s.htmlCls.clickMenuCls.setLogCmd("set mode all",!0),t.selectionCls.selectAll(),t.drawCls.draw()):(this.setMode("selection"),void 0!==t.prevHighlightAtoms?t.hAtoms=s.hashUtilsCls.cloneHash(t.prevHighlightAtoms):t.selectionCls.selectAll(),s.htmlCls.clickMenuCls.setLogCmd("set mode selection",!0),t.hlUpdateCls.updateHlAll())}setMode(e){let t=this.icn3d;t.icn3dui,"all"===e?($("#"+t.pre+"modeall").show(),$("#"+t.pre+"modeselection").hide(),void 0!==$("#"+t.pre+"modeswitch")[0]&&($("#"+t.pre+"modeswitch")[0].checked=!1),$("#"+t.pre+"style").hasClass("icn3d-modeselection")&&$("#"+t.pre+"style").removeClass("icn3d-modeselection"),$("#"+t.pre+"color").hasClass("icn3d-modeselection")&&$("#"+t.pre+"color").removeClass("icn3d-modeselection")):($("#"+t.pre+"modeall").hide(),$("#"+t.pre+"modeselection").show(),void 0!==$("#"+t.pre+"modeswitch")[0]&&($("#"+t.pre+"modeswitch")[0].checked=!0),$("#"+t.pre+"style").hasClass("icn3d-modeselection")||$("#"+t.pre+"style").addClass("icn3d-modeselection"),$("#"+t.pre+"color").hasClass("icn3d-modeselection")||$("#"+t.pre+"color").addClass("icn3d-modeselection"))}getAtomsFromOneSet(e){let t=this.icn3d,s=t.icn3dui,i={};if(void 0===t.defNames2Residues.proteins&&this.showSets(),-1!==Object.keys(t.chains).indexOf(e))i=s.hashUtilsCls.unionHash(i,t.chains[e]);else{if(void 0!==t.defNames2Residues[e]&&t.defNames2Residues[e].length>0)for(let l=0,n=t.defNames2Residues[e].length;l<n;++l){let n=t.defNames2Residues[e][l];i=s.hashUtilsCls.unionHash(i,t.residues[n])}if(void 0!==t.defNames2Atoms[e]&&t.defNames2Atoms[e].length>0)for(let s=0,l=t.defNames2Atoms[e].length;s<l;++s){i[t.defNames2Atoms[e][s]]=1}}return i}getAtomsFromNameArray(e){let t=this.icn3d,s=t.icn3dui,i={};for(let l=0,n=e.length;l<n;++l)if("non-selected"===e[l]){let e={};for(let s in t.atoms)!t.hAtoms.hasOwnProperty(s)&&t.dAtoms.hasOwnProperty(s)&&(e[s]=t.atoms[s]);i=s.hashUtilsCls.unionHash(i,e)}else i="selected"===e[l]?s.hashUtilsCls.unionHash(i,s.hashUtilsCls.hash2Atoms(t.hAtoms,t.atoms)):s.hashUtilsCls.unionHash(i,s.hashUtilsCls.hash2Atoms(this.getAtomsFromOneSet(e[l]),t.atoms));return 0==e.length&&(i=t.atoms),i}}class F{constructor(e){this.icn3d=e}isHbondDonorAcceptor(e){let t=this.icn3d;if(t.icn3dui,"N"==e.name&&!e.het||"N"==e.elem&&"Arg"==e.resn||"N"==e.elem&&"Asn"==e.resn||"N"==e.elem&&"Gln"==e.resn||"N"==e.elem&&"Lys"==e.resn||"N"==e.elem&&"Trp"==e.resn)return"donor";if("O"==e.name&&!e.het||"S"==e.elem&&"Met"==e.resn||"O"==e.elem&&"Asn"==e.resn||"O"==e.elem&&"Asp"==e.resn||"O"==e.elem&&"Gln"==e.resn||"O"==e.elem&&"Glu"==e.resn)return"acceptor";if("S"==e.elem&&"Cys"==e.resn||"N"==e.elem&&"His"==e.resn||"O"==e.elem&&"Ser"==e.resn||"O"==e.elem&&"Thr"==e.resn||"O"==e.elem&&"Tyr"==e.resn)return"both";if("Pro"==e.resn)return"none";if("N"==e.elem){if("Asn"==e.resn||"Gln"==e.resn)return"both";let s=0,i=0;for(let i=0,l=e.bonds.length;i<l;++i)"H"==t.atoms[e.bonds[i]].elem&&++s;if(2==s)return"donor";s=0;for(let l=0,n=e.bonds.length;l<n;++l){let n=t.atoms[e.bonds[l]];if("H"!=n.elem){++s;for(let e=0,s=n.bonds.length;e<s;++e)"N"==t.atoms[n.bonds[e]].elem&&++i}}return 1==s?"donor":2==s?i>1?"ring":"donor":"none"}if("O"==e.elem&&1==e.bonds.length){if("Asn"==e.resn||"Gln"==e.resn)return"both";for(let s=0,i=e.bonds.length;s<i;++s)if("H"==t.atoms[e.bonds[s]].elem)return"donor";let s=t.atoms[e.bonds[0]],i=0;for(let e=0,l=s.bonds.length;e<l;++e)"O"!=t.atoms[s.bonds[e]].elem&&"N"!=t.atoms[s.bonds[e]].elem&&"S"!=t.atoms[s.bonds[e]].elem||++i;return i>=2?"acceptor":"both"}if("O"==e.elem&&2==e.bonds.length){for(let s=0,i=e.bonds.length;s<i;++s)if("H"==t.atoms[e.bonds[s]].elem)return"donor";return"acceptor"}return"both"}calcAngles(e,t){let s=this.icn3d;s.icn3dui;let i=[],l=new THREE.Vector3,n=new THREE.Vector3;l.subVectors(t.coord,e.coord);for(let t=0,r=e.bonds.length;t<r;++t)"H"!=s.atoms[e.bonds[t]].elem&&(n.subVectors(s.atoms[e.bonds[t]].coord,e.coord),i.push(l.angleTo(n)));return i}calcPlaneAngle(e,t){let s=this.icn3d;s.icn3dui;let i=e,l=new THREE.Vector3;l.subVectors(t.coord,e.coord);let n=[new THREE.Vector3,new THREE.Vector3],r=0;for(let t=0,l=e.bonds.length;t<l&&!(r>1);++t)"H"!=s.atoms[e.bonds[t]].elem&&(i=s.atoms[e.bonds[t]],n[r++].subVectors(s.atoms[e.bonds[t]].coord,e.coord));if(1===r)for(let t=0,l=i.bonds.length;t<l&&!(r>1);++t)"H"!=s.atoms[i.bonds[t]].elem&&s.atoms[i.bonds[t]].serial!=e.serial&&n[r++].subVectors(s.atoms[i.bonds[t]].coord,e.coord);if(2!==r)return;let o=n[0].cross(n[1]);return Math.abs(Math.PI/2-o.angleTo(l))}isValidHbond(e,t,s){let i=this.icn3d;i.icn3dui;let l,n,r=this.isHbondDonorAcceptor(e),o=this.isHbondDonorAcceptor(t),a=(Math.PI,Math.PI,90*Math.PI/180),d=30*Math.PI/180;if("donor"==r&&("acceptor"==o||"both"==o||"ring"==o)||"acceptor"==o&&("donor"==r||"both"==r||"ring"==r))l=e,n=t;else if("acceptor"==r&&("donor"==o||"both"==o||"ring"==o)||"donor"==o&&("acceptor"==r||"both"==r||"ring"==r))n=e,l=t;else{if("both"!=r&&"ring"!=r||"both"!=o&&"ring"!=o)return!1;l=e,n=t,i.nucleotides.hasOwnProperty(e.serial)&&i.nucleotides.hasOwnProperty(t.serial)&&("ring"==r||"ring"==o)||(e.het||t.het)&&"ring"==r&&"ring"==o||(d=90*Math.PI/180)}let c=this.calcAngles(l,n),h=90*Math.PI/180;for(let e=0,t=c.length;e<t;++e)Math.abs(h-c[e]);let m=this.calcPlaneAngle(l,n);if(void 0!==m&&m>d)return!1;let p=this.calcAngles(n,l),u=90*Math.PI/180;for(let e=0,t=p.length;e<t;++e)Math.abs(u-p[e]);let C=this.calcPlaneAngle(n,l);return!(void 0!==C&&C>a)}calculateChemicalHbonds(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui;if(0===Object.keys(e).length||0===Object.keys(t).length)return;r.resid2Residhash={};let a,d,c={},h=s*s;for(let t in e){let s=e[t],l=i?"LYS"===s.resn&&"N"===s.elem&&"N"!==s.name||"ARG"===s.resn&&("NH1"===s.name||"NH2"===s.name)||("GLU"===s.resn||"ASP"===s.resn)&&"O"===s.elem&&"O"!==s.name||s.het&&("N"===s.elem||"O"===s.elem||"S"===s.elem):"N"===s.elem||"O"===s.elem||"S"===s.elem&&(s.het||"Cys"===s.resn||"Met"===s.resn);l=r.bOpm?l&&"DUM"!==s.resn:l,l&&(a=s.structure+"_"+s.chain+"_"+s.resi,d=a+"_"+s.name,c[d]=s)}let m={},p={},u=.5,C=-27.888,g={};for(let e in t){let f=t[e],b=i?"LYS"===f.resn&&"N"===f.elem&&"N"!==f.name||"ARG"===f.resn&&("NH1"===f.name||"NH2"===f.name)||("GLU"===f.resn||"ASP"===f.resn)&&"O"===f.elem&&"O"!==f.name||f.het&&("N"===f.elem||"O"===f.elem||"S"===f.elem):"N"===f.elem||"O"===f.elem||"S"===f.elem&&(f.het||"Cys"===f.resn||"Met"===f.resn);if(b=r.bOpm?b&&"DUM"!==f.resn:b,b){a=f.structure+"_"+f.chain+"_"+f.resi,d=a+"_"+f.name;let e=f.resn+" $"+f.structure+"."+f.chain+":"+f.resi+"@"+f.name;void 0===r.resid2Residhash[e]&&(r.resid2Residhash[e]={});for(let t in c){if(i&&!(("LYS"!==f.resn&&"ARG"!==f.resn||"LYS"!==c[t].resn&&"ARG"!==c[t].resn)&&("GLU"!==f.resn&&"ASP"!==f.resn||"GLU"!==c[t].resn&&"ASP"!==c[t].resn)))continue;if(!r.crossstrucinter&&f.structure!=c[t].structure)continue;if(a==t.substr(0,t.lastIndexOf("_")))continue;let d=Math.abs(f.coord.x-c[t].coord.x);if(d>s)continue;let b=Math.abs(f.coord.y-c[t].coord.y);if(b>s)continue;let y=Math.abs(f.coord.z-c[t].coord.z);if(y>s)continue;let v=d*d+b*b+y*y;if(v>h)continue;if(!r.proteins.hasOwnProperty(f.serial)||!r.proteins.hasOwnProperty(c[t].serial)||"N"!==f.name&&"O"!==f.name||"O"!==c[t].name&&"N"!==c[t].name){if(!this.isValidHbond(f,c[t],s))continue}else{if(f.name===c[t].name)continue;if(f.structure==c[t].structure&&f.chain==c[t].chain&&Math.abs(f.resi-c[t].resi)<=1)continue;let e,i="N"===f.name?f:c[t],l="O"===f.name?f:c[t];if("Pro"===i.resn)continue;if(void 0===i.hcoord){if(!this.isValidHbond(f,c[t],s))continue}else{let s,n=i.hcoord,o=i.coord,a=l.structure+"_"+l.chain+"_"+l.resi;for(let e in r.residues[a])if("C"===r.atoms[e].name){s=r.atoms[e];break}if(!s)continue;let d=s.coord,h=l.coord,m=n.distanceTo(h),p=n.distanceTo(d),g=o.distanceTo(d),b=o.distanceTo(h);e=m<u||p<u||g<u||b<u?-9.9:C/m-C/p+C/g-C/b,"helix"==f.ss&&c[t].ss}}if(g[f.serial]>2||g[c[t].serial]>2)continue;void 0===g[f.serial]?g[f.serial]=1:++g[f.serial],void 0===g[c[t].serial]?g[c[t].serial]=1:++g[c[t].serial],"graph"!==l&&(i?(r.saltbridgepnts.push({serial:f.serial,coord:f.coord}),r.saltbridgepnts.push({serial:c[t].serial,coord:c[t].coord})):(r.hbondpnts.push({serial:f.serial,coord:f.coord}),r.hbondpnts.push({serial:c[t].serial,coord:c[t].coord})));let _=c[t].structure+"_"+c[t].chain+"_"+c[t].resi;m=o.hashUtilsCls.unionHash(m,r.residues[a]),m=o.hashUtilsCls.unionHash(m,r.residues[_]),p[a]=1,p[_]=1;let S=c[t].resn+" $"+c[t].structure+"."+c[t].chain+":"+c[t].resi+"@"+c[t].name,w=a+"_"+f.resn+","+_+"_"+c[t].resn;void 0!==r.resids2interAll[w]&&void 0!==r.resids2interAll[w].ionic&&r.resids2interAll[w].ionic.hasOwnProperty(e+","+S)||(r.resid2Residhash[e][S]=v.toFixed(1),n||(void 0===r.resids2inter[w]&&(r.resids2inter[w]={}),void 0===r.resids2inter[w].hbond&&(r.resids2inter[w].hbond={}),r.resids2inter[w].hbond[e+","+S]=v.toFixed(1)),void 0===r.resids2interAll[w]&&(r.resids2interAll[w]={}),void 0===r.resids2interAll[w].hbond&&(r.resids2interAll[w].hbond={}),r.resids2interAll[w].hbond[e+","+S]=v.toFixed(1))}}}let f=Object.keys(p);if("graph"!==l)for(let e=0,t=f.length;e<t;++e)for(let t in r.residues[f[e]])r.atoms[t].style2="stick";return m}setHbondsContacts(e,t){let s=this.icn3d;s.icn3dui;let i=t,l="hbond"==t?"hbonds":t;if(s.lines[i]=[],"yes"===e[l].toLowerCase()){let e,l;"hbond"==t?(l=s.hbondpnts,e="#0F0"):"saltbridge"==t?(l=s.saltbridgepnts,e="#0FF"):"contact"==t?(l=s.contactpnts,e="#888"):"halogen"==t?(l=s.halogenpnts,e="#F0F"):"pi-cation"==t?(l=s.picationpnts,e="#F00"):"pi-stacking"==t&&(l=s.pistackingpnts,e="#00F");for(let t=0,n=Math.floor(l.length/2);t<n;t++){let n={};n.position1=l[2*t].coord,n.serial1=l[2*t].serial,n.position2=l[2*t+1].coord,n.serial2=l[2*t+1].serial,n.color=e,n.dashed=!0,(void 0===n.serial1||void 0===n.serial2||s.dAtoms.hasOwnProperty(n.serial1)||s.dAtoms.hasOwnProperty(n.serial2))&&s.lines[i].push(n)}}}hideHbonds(){let e=this.icn3d;e.icn3dui,e.opts.hbonds="no",void 0===e.lines&&(e.lines={}),e.lines.hbond=[],e.hbondpnts=[];for(let t in e.atoms)e.atoms[t].style2="nothing";for(let t in e.sidec)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style2=e.opts.sidec);for(let t in e.water)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style=e.opts.water)}}class P{constructor(e){this.icn3d=e}calculateHalogenPiInteractions(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui;if(0===Object.keys(e).length||0===Object.keys(t).length)return;let a={},d={},c={},h={};if("halogen"==l){for(let t in e){let s=e[t];a=o.hashUtilsCls.unionHash(a,this.getHalogenDonar(s)),c=o.hashUtilsCls.unionHash(c,this.getHalogenAcceptor(s))}for(let e in t){let s=t[e];h=o.hashUtilsCls.unionHash(h,this.getHalogenDonar(s)),d=o.hashUtilsCls.unionHash(d,this.getHalogenAcceptor(s))}}else if("pi-cation"==l){r.processedRes={};for(let t in e){let s=e[t];a=o.hashUtilsCls.unionHash(a,this.getPi(s,!1)),c=o.hashUtilsCls.unionHash(c,this.getCation(s))}r.processedRes={};for(let e in t){let s=t[e];h=o.hashUtilsCls.unionHash(h,this.getPi(s,!1)),d=o.hashUtilsCls.unionHash(d,this.getCation(s))}}else if("pi-stacking"==l){r.processedRes={};for(let t in e){let s=e[t];a=o.hashUtilsCls.unionHash(a,this.getPi(s,!0))}r.processedRes={};for(let e in t){let s=t[e];d=o.hashUtilsCls.unionHash(d,this.getPi(s,!0))}}let m={},p={};r.resid2Residhash={};let u=s*s;for(let e in a){let t=a[e],c=t.resn+" $"+t.structure+"."+t.chain+":"+t.resi+"@"+t.name;void 0===r.resid2Residhash[c]&&(r.resid2Residhash[c]={});for(let a in d){let h=d[a];if((r.crossstrucinter||t.structure==h.structure)&&e.substr(0,e.lastIndexOf("_"))!=a.substr(0,a.lastIndexOf("_"))){if("pi-cation"==l&&"ARG"===h.resn&&"NH1"===h.name){let e=h.structure+"_"+h.chain+"_"+h.resi,t=r.firstAtomObjCls.getFirstAtomObjByName(r.residues[e],"NH2"),s=h.coord.clone().add(t.coord).multiplyScalar(.5);h=o.hashUtilsCls.cloneHash(h),h.coord=s}"pi-stacking"==l&&void 0!==t.normal&&void 0!==h.normal&&Math.abs(t.normal.dot(h.normal)),this.getHalogenPiInteractions(t,h,i,l,s,u,c,n)&&(m=o.hashUtilsCls.unionHash(m,r.residues[t.structure+"_"+t.chain+"_"+t.resi]),m=o.hashUtilsCls.unionHash(m,r.residues[h.structure+"_"+h.chain+"_"+h.resi]),p[t.structure+"_"+t.chain+"_"+t.resi]=1,p[h.structure+"_"+h.chain+"_"+h.resi]=1)}}}for(let e in c){let t=c[e],a=t.resn+" $"+t.structure+"."+t.chain+":"+t.resi+"@"+t.name;if(void 0===r.resid2Residhash[a]&&(r.resid2Residhash[a]={}),"pi-cation"==l&&"ARG"===t.resn&&"NH1"===t.name){let e=t.structure+"_"+t.chain+"_"+t.resi,s=r.firstAtomObjCls.getFirstAtomObjByName(r.residues[e],"NH2"),i=t.coord.clone().add(s.coord).multiplyScalar(.5);t=o.hashUtilsCls.cloneHash(t),t.coord=i}for(let d in h){let c=h[d];(r.crossstrucinter||t.structure==c.structure)&&(e.substr(0,e.lastIndexOf("_"))!=d.substr(0,d.lastIndexOf("_"))&&this.getHalogenPiInteractions(t,c,i,l,s,u,a,n)&&(m=o.hashUtilsCls.unionHash(m,r.residues[t.structure+"_"+t.chain+"_"+t.resi]),m=o.hashUtilsCls.unionHash(m,r.residues[c.structure+"_"+c.chain+"_"+c.resi]),p[t.structure+"_"+t.chain+"_"+t.resi]=1,p[c.structure+"_"+c.chain+"_"+c.resi]=1))}}let C=Object.keys(p);if("graph"!==i)for(let e=0,t=C.length;e<t;++e)for(let t in r.residues[C[e]])r.atoms[t].style2="stick",r.ions.hasOwnProperty(t)&&(r.atoms[t].style2="sphere");return m}getHalogenDonar(e){this.icn3d.icn3dui;let t={};if("CL"===e.elem||"BR"===e.elem||"I"===e.elem){t[e.structure+"_"+e.chain+"_"+e.resi+"_"+e.name]=e}return t}getHalogenAcceptor(e){let t=this.icn3d;t.icn3dui;let s={},i="N"===e.elem||"O"===e.elem||"S"===e.elem;if(i=t.bOpm?i&&"DUM"!==e.resn:i,i){s[e.structure+"_"+e.chain+"_"+e.resi+"_"+e.name]=e}return s}getPi(e,t){let s=this.icn3d,i=s.icn3dui,l={},n=e.structure+"_"+e.chain+"_"+e.resi,r=e.het||s.nucleotides.hasOwnProperty(e.serial)||"PHE"===e.resn||"TYR"===e.resn||"TRP"===e.resn;if(t&&(r=r||"HIS"===e.resn),r&&!s.processedRes.hasOwnProperty(n)){if(e.het){let e=this.getAromaticPisLigand(n);l=i.hashUtilsCls.unionHash(l,e)}else{let t,i,r;r=s.nucleotides.hasOwnProperty(e.serial)?this.getAromaticRings(e.resn,n,"nucleotide"):this.getAromaticRings(e.resn,n,"protein"),void 0!==r&&(t=r.piPosArray,i=r.normalArray);for(let s=0,r=t.length;s<r;++s)l[n+"_pi"+s]={resn:e.resn,name:"pi"+s,coord:t[s],serial:e.serial,structure:e.structure,chain:e.chain,resi:e.resi,normal:i[s]}}s.processedRes[n]=1}return l}getCation(e){let t=this.icn3d,s=t.icn3dui,i={};if("ARG"===e.resn&&"NH2"===e.name)return;let l="LYS"===e.resn&&"N"===e.elem&&"N"!==e.name||"ARG"===e.resn&&("NH1"===e.name||"NH2"===e.name)||e.het&&-1!==s.parasCls.cationsTrimArray.indexOf(e.elem)||e.het&&"N"===e.elem&&(1==e.bonds.length||4==e.bonds.length);if(l=t.bOpm?l&&"DUM"!==e.resn:l,l){i[e.structure+"_"+e.chain+"_"+e.resi+"_"+e.name]=e}return i}getHalogenPiInteractions(e,t,s,i,l,n,r,o){let a=this.icn3d;a.icn3dui;let d=Math.abs(e.coord.x-t.coord.x);if(d>l)return!1;let c=Math.abs(e.coord.y-t.coord.y);if(c>l)return!1;let h=Math.abs(e.coord.z-t.coord.z);if(h>l)return!1;let m=d*d+c*c+h*h;if(m>n)return!1;"graph"!==s&&("halogen"==i?(a.halogenpnts.push({serial:e.serial,coord:e.coord}),a.halogenpnts.push({serial:t.serial,coord:t.coord})):"pi-cation"==i?(a.picationpnts.push({serial:e.serial,coord:e.coord}),a.picationpnts.push({serial:t.serial,coord:t.coord})):"pi-stacking"==i&&(a.pistackingpnts.push({serial:e.serial,coord:e.coord}),a.pistackingpnts.push({serial:t.serial,coord:t.coord})));let p=t.resn+" $"+t.structure+"."+t.chain+":"+t.resi+"@"+t.name;a.resid2Residhash[r][p]=m.toFixed(1);let u=e.structure+"_"+e.chain+"_"+e.resi+"_"+e.resn+","+t.structure+"_"+t.chain+"_"+t.resi+"_"+t.resn;return o||(void 0===a.resids2inter[u]&&(a.resids2inter[u]={}),void 0===a.resids2inter[u][i]&&(a.resids2inter[u][i]={}),a.resids2inter[u][i][r+","+p]=m.toFixed(1)),void 0===a.resids2interAll[u]&&(a.resids2interAll[u]={}),void 0===a.resids2interAll[u][i]&&(a.resids2interAll[u][i]={}),a.resids2interAll[u][i][r+","+p]=m.toFixed(1),!0}getRingNormal(e){if(this.icn3d.icn3dui,e.length<3)return;let t=e[0].clone().sub(e[1]),s=e[1].clone().sub(e[2]);return t.cross(s).normalize()}getAromaticRings(e,t,s){let i=this.icn3d;i.icn3dui;let l=[],n=[],r=[],o=[];if("nucleotide"==s){let s=new THREE.Vector3,a=new THREE.Vector3;if("A"==e.trim().toUpperCase()||"DA"==e.trim().toUpperCase()||"G"==e.trim().toUpperCase()||"DG"==e.trim().toUpperCase()){for(let e in i.residues[t]){let t=i.atoms[e];"N1"==t.name||"C2"==t.name||"N3"==t.name||"C6"==t.name?(s.add(t.coord),r.push(t.coord)):"C4"==t.name||"C5"==t.name?(s.add(t.coord),a.add(t.coord),r.push(t.coord),o.push(t.coord)):"N7"!=t.name&&"C8"!=t.name&&"N9"!=t.name||(a.add(t.coord),o.push(t.coord))}6==r.length&&(s.multiplyScalar(1/6),l.push(s),n.push(this.getRingNormal(r))),5==o.length&&(a.multiplyScalar(.2),l.push(a),n.push(this.getRingNormal(o)))}else if("C"==e.trim().toUpperCase()||"DC"==e.trim().toUpperCase()||"T"==e.trim().toUpperCase()||"DT"==e.trim().toUpperCase()||"U"==e.trim().toUpperCase()||"DU"==e.trim().toUpperCase()){for(let e in i.residues[t]){let t=i.atoms[e];"N1"==t.name||"C2"==t.name||"N3"==t.name||"C6"==t.name?(s.add(t.coord),r.push(t.coord)):"C4"!=t.name&&"C5"!=t.name||(s.add(t.coord),r.push(t.coord))}6==r.length&&(s.multiplyScalar(1/6),l.push(s),n.push(this.getRingNormal(r)))}}else if("protein"==s){let s=new THREE.Vector3,a=new THREE.Vector3;if("PHE"==e.toUpperCase()||"TYR"==e.toUpperCase()){for(let e in i.residues[t]){let t=i.atoms[e];"CG"!=t.name&&"CD1"!=t.name&&"CE1"!=t.name&&"CZ"!=t.name&&"CE2"!=t.name&&"CD2"!=t.name||(s.add(t.coord),r.push(t.coord))}6==r.length&&(s.multiplyScalar(1/6),l.push(s),n.push(this.getRingNormal(r)))}else if("HIS"==e.toUpperCase()){for(let e in i.residues[t]){let t=i.atoms[e];"CG"!=t.name&&"ND1"!=t.name&&"CE1"!=t.name&&"NE2"!=t.name&&"CD2"!=t.name||(s.add(t.coord),r.push(t.coord))}5==r.length&&(s.multiplyScalar(.2),l.push(s),n.push(this.getRingNormal(r)))}else if("TRP"==e.toUpperCase()){for(let e in i.residues[t]){let t=i.atoms[e];"CZ2"==t.name||"CH2"==t.name||"CZ3"==t.name||"CE3"==t.name?(s.add(t.coord),r.push(t.coord)):"CD2"==t.name||"CE2"==t.name?(s.add(t.coord),a.add(t.coord),r.push(t.coord),o.push(t.coord)):"CG"!=t.name&&"CD1"!=t.name&&"NE1"!=t.name||(a.add(t.coord),o.push(t.coord))}6==r.length&&(s.multiplyScalar(1/6),l.push(s),n.push(this.getRingNormal(r))),5==o.length&&(a.multiplyScalar(.2),l.push(a),n.push(this.getRingNormal(o)))}}return{piPosArray:l,normalArray:n}}dfs_cycle(e,t,s){let i=this.icn3d;if(i.icn3dui,2==i.ring_color[e])return s;if(1==i.ring_color[e]){s++;let l=t;for(i.ring_mark[l]=s;l!=e;)l=i.ring_par[l],i.ring_mark[l]=s;return s}if(i.ring_par[e]=t,i.ring_color[e]=1,void 0!==i.atoms[e])for(let t=0,l=i.atoms[e].bonds.length;t<l;++t){let l=i.atoms[e].bonds[t];l!=i.ring_par[e]&&(s=this.dfs_cycle(l,e,s))}return i.ring_color[e]=2,s}getAromaticPisLigand(e){let t=this.icn3d;t.icn3dui;let s={},i=Object.keys(t.residues[e]),l=i.length;t.ring_color={},t.ring_par={},t.ring_mark={};let n=0;n=this.dfs_cycle(i[1],i[0],n);let r={};for(let e=0;e<l;e++){let s=i[e];t.ring_mark[s]&&(void 0===r[t.ring_mark[s]]&&(r[t.ring_mark[s]]=[]),r[t.ring_mark[s]].push(s))}for(let i=1;i<=n;i++){let l,n=new THREE.Vector3,o=0,a=[];if(r.hasOwnProperty(i))for(let e=0,s=r[i].length;e<s;++e)l=r[i][e],n.add(t.atoms[l].coord),a.push(t.atoms[l].coord),++o;if(o>=3&&o<=6){let i=a[0].clone().sub(a[1]).normalize(),r=a[1].clone().sub(a[2]).normalize(),d=a[2].clone().sub(a[3]).normalize(),c=i.cross(r).normalize(),h=c.dot(d);if(Math.abs(h)<.052){n.multiplyScalar(1/o);let i=t.atoms[l];s[e+"_pi"+l]={resn:i.resn,name:"pi"+l,coord:n,serial:i.serial,structure:i.structure,chain:i.chain,resi:i.resi,normal:c}}}}return s}hideHalogenPi(){let e=this.icn3d;e.icn3dui,e.opts.halogen="no",e.opts["pi-cation"]="no",e.opts["pi-stacking"]="no",void 0===e.lines&&(e.lines={}),e.lines.halogen=[],e.lines["pi-cation"]=[],e.lines["pi-stacking"]=[],e.halogenpnts=[],e.picationpnts=[],e.pistackingpnts=[];for(let t in e.atoms)e.atoms[t].style2="nothing";for(let t in e.sidec)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style2=e.opts.sidec);for(let t in e.water)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style=e.opts.water)}}class L{constructor(e){this.icn3d=e}calculateIonicInteractions(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui;if(0===Object.keys(e).length||0===Object.keys(t).length)return;r.resid2Residhash={};let a,d,c={},h={},m=s*s;for(let t in e){let s=e[t];if("ARG"===s.resn&&"NH2"===s.name||"GLU"===s.resn&&"OE2"===s.name||"ASP"===s.resn&&"OD2"===s.name)continue;let i=("LYS"===s.resn||"HIS"===s.resn)&&"N"===s.elem&&"N"!==s.name||"ARG"===s.resn&&("NH1"===s.name||"NH2"===s.name)||s.het&&-1!==o.parasCls.cationsTrimArray.indexOf(s.elem)||s.het&&"N"===s.elem&&1==s.bonds.length,l=this.isAnion(s);i=r.bOpm?i&&"DUM"!==s.resn:i,l=r.bOpm?l&&"DUM"!==s.resn:l,(i||l)&&(a=s.structure+"_"+s.chain+"_"+s.resi,d=a+"_"+s.name,i&&(c[d]=s),l&&(h[d]=s))}let p={},u={};for(let e in t){let i=t[e];if("ARG"===i.resn&&"NH2"===i.name||"GLU"===i.resn&&"OE2"===i.name||"ASP"===i.resn&&"OD2"===i.name)continue;let C=("LYS"===i.resn||"HIS"===i.resn)&&"N"===i.elem&&"N"!==i.name||"ARG"===i.resn&&("NH1"===i.name||"NH2"===i.name)||i.het&&-1!==o.parasCls.cationsTrimArray.indexOf(i.elem),g=this.isAnion(i);if(C=r.bOpm?C&&"DUM"!==i.resn:C,g=r.bOpm?g&&"DUM"!==i.resn:g,C||g){a=i.structure+"_"+i.chain+"_"+i.resi,d=a+"_"+i.name;let e=i.resn+" $"+i.structure+"."+i.chain+":"+i.resi+"@"+i.name;void 0===r.resid2Residhash[e]&&(r.resid2Residhash[e]={});let t={};C?t=h:g&&(t=c);let f,b=i.structure+"_"+i.chain+"_"+i.resi;C&&"ARG"===i.resn&&"NH1"===i.name?f=r.firstAtomObjCls.getFirstAtomObjByName(r.residues[b],"NH2"):g&&"GLU"===i.resn&&"OE1"===i.name?f=r.firstAtomObjCls.getFirstAtomObjByName(r.residues[b],"OE2"):g&&"ASP"===i.resn&&"OD1"===i.name&&(f=r.firstAtomObjCls.getFirstAtomObjByName(r.residues[b],"OD2"));let y=void 0===f?i.coord:i.coord.clone().add(f.coord).multiplyScalar(.5);for(let d in t){if(a==d.substr(0,d.lastIndexOf("_")))continue;if(!r.crossstrucinter&&i.structure!=t[d].structure)continue;let c,h=t[d].structure+"_"+t[d].chain+"_"+t[d].resi;g&&"ARG"===t[d].resn&&"NH1"===t[d].name?c=r.firstAtomObjCls.getFirstAtomObjByName(r.residues[h],"NH2"):C&&"GLU"===t[d].resn&&"OE1"===t[d].name?c=r.firstAtomObjCls.getFirstAtomObjByName(r.residues[h],"OE2"):C&&"ASP"===t[d].resn&&"OD1"===t[d].name&&(c=r.firstAtomObjCls.getFirstAtomObjByName(r.residues[h],"OD2"));let f=void 0===c?t[d].coord:t[d].coord.clone().add(c.coord).multiplyScalar(.5),b=Math.abs(y.x-f.x);if(b>s)continue;let v=Math.abs(y.y-f.y);if(v>s)continue;let _=Math.abs(y.z-f.z);if(_>s)continue;let S=b*b+v*v+_*_;if(S>m)continue;"graph"!==l&&(r.saltbridgepnts.push({serial:i.serial,coord:y}),r.saltbridgepnts.push({serial:t[d].serial,coord:f}));let w=t[d].structure+"_"+t[d].chain+"_"+t[d].resi;p=o.hashUtilsCls.unionHash(p,r.residues[a]),p=o.hashUtilsCls.unionHash(p,r.residues[w]),u[a]=1,u[w]=1;let A=t[d].resn+" $"+t[d].structure+"."+t[d].chain+":"+t[d].resi+"@"+t[d].name;r.resid2Residhash[e][A]=S.toFixed(1);let x=a+"_"+i.resn+","+w+"_"+t[d].resn;n||(void 0===r.resids2inter[x]&&(r.resids2inter[x]={}),void 0===r.resids2inter[x].ionic&&(r.resids2inter[x].ionic={}),r.resids2inter[x].ionic[e+","+A]=S.toFixed(1)),void 0===r.resids2interAll[x]&&(r.resids2interAll[x]={}),void 0===r.resids2interAll[x].ionic&&(r.resids2interAll[x].ionic={}),r.resids2interAll[x].ionic[e+","+A]=S.toFixed(1)}}}let C=Object.keys(u);if("graph"!==l)for(let e=0,t=C.length;e<t;++e)for(let t in r.residues[C[e]])r.atoms[t].style2="stick",r.ions.hasOwnProperty(t)&&(r.atoms[t].style2="sphere");return p}isAnion(e){let t,s=this.icn3d,i=s.icn3dui;if(e.het&&"O"===e.elem&&1==e.bonds.length){let i=s.atoms[e.bonds[0]];for(let l=0;l<i.bonds.length;++l){let n=i.bonds[l];if("O"==s.atoms[n].elem&&n!=e.serial){t=!0;break}}}if("O"===e.elem&&1==e.bonds.length){let i=s.atoms[e.bonds[0]];"P"!=i.elem&&"S"!=i.elem||(t=!0)}return"GLU"===e.resn&&("OE1"===e.name||"OE2"===e.name)||"ASP"===e.resn&&("OD1"===e.name||"OD2"===e.name)||s.nucleotides.hasOwnProperty(e.serial)&&("OP1"===e.name||"OP2"===e.name||"O1P"===e.name||"O2P"===e.name)||e.het&&-1!==i.parasCls.anionsTrimArray.indexOf(e.elem)||t}hideSaltbridge(){let e=this.icn3d;e.icn3dui,e.opts.saltbridge="no",void 0===e.lines&&(e.lines={}),e.lines.saltbridge=[],e.saltbridgepnts=[];for(let t in e.atoms)e.atoms[t].style2="nothing";for(let t in e.sidec)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style2=e.opts.sidec);for(let t in e.water)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style=e.opts.water)}}class N{constructor(e){this.icn3d=e}getGraphData(e,t,s,i,l,n,r){let o=this.icn3d,a=o.icn3dui,d="",c="",h=[],m=[],p=this.getNodesLinksForSet(e,n,"a",r),u=this.getNodesLinksForSet(t,n,"b",r);h=p.node.concat(u.node);let C=[],g={},f=0;for(let e=0,t=h.length;e<t;++e){let t=h[e],s=JSON.parse(t);if(g.hasOwnProperty(s.id)){C[g[s.id]].s="ab"}else C.push(s),g[s.id]=f,++f}let b=[];for(let e=0,t=C.length;e<t;++e){let t=C[e];b.push(JSON.stringify(t))}d=b.join(", "),m=p.link.concat(u.link),c=m.join(", ");let y=a.hashUtilsCls.unionHash(a.hashUtilsCls.cloneHash(t),e),v="",_="",S="",w="",A="",x="";1==s.length&&1==i.length&&s[0]==i[0]||(v+=this.getHbondLinksForSet(e,n),v+=this.getHbondLinksForSet(t,n)),1==s.length&&1==i.length&&s[0]==i[0]||(_+=this.getIonicLinksForSet(e,n),_+=this.getIonicLinksForSet(t,n)),1==s.length&&1==i.length&&s[0]==i[0]||(S+=this.getHalogenPiLinksForSet(e,n),S+=this.getHalogenPiLinksForSet(t,n)),1==s.length&&1==i.length&&s[0]==i[0]||(w+=this.getContactLinksForSet(e,n),w+=this.getContactLinksForSet(t,n));for(let e in o.ssbondpnts)for(let t=0,s=o.ssbondpnts[e].length;t<s;t+=2){let s=o.ssbondpnts[e][t],i=o.ssbondpnts[e][t+1],l=o.firstAtomObjCls.getFirstAtomObj(o.residues[s]),r=o.firstAtomObjCls.getFirstAtomObj(o.residues[i]);if(y.hasOwnProperty(l.serial)&&y.hasOwnProperty(r.serial)){let e=a.utilsCls.residueName2Abbr(l.resn)+l.resi;"chain"!=n&&"structure"!=n||(e+="."+l.chain),"structure"==n&&(e+="."+l.structure);let t=a.utilsCls.residueName2Abbr(r.resn)+r.resi;"chain"!=n&&"structure"!=n||(t+="."+r.chain),"structure"==n&&(t+="."+r.structure),A+=', {"source": "'+e+'", "target": "'+t+'", "v": '+a.htmlCls.ssbondValue+', "c": "'+a.htmlCls.ssbondColor+'"}'}}for(let e in o.clbondpnts)for(let t=0,s=o.clbondpnts[e].length;t<s;t+=2){let s=o.clbondpnts[e][t],i=o.clbondpnts[e][t+1],l=o.firstAtomObjCls.getFirstAtomObj(o.residues[s]),r=o.firstAtomObjCls.getFirstAtomObj(o.residues[i]);if(y.hasOwnProperty(l.serial)&&y.hasOwnProperty(r.serial)){let e=a.utilsCls.residueName2Abbr(l.resn)+l.resi;"chain"!=n&&"structure"!=n||(e+="."+l.chain),"structure"==n&&(e+="."+l.structure);let t=a.utilsCls.residueName2Abbr(r.resn)+r.resi;"chain"!=n&&"structure"!=n||(t+="."+r.chain),"structure"==n&&(t+="."+r.structure),x+=', {"source": "'+e+'", "target": "'+t+'", "v": '+a.htmlCls.clbondValue+', "c": "'+a.htmlCls.clbondColor+'"}'}}let k='{"nodes": ['+d+'], "links": [';return k+=""==c?c+l.substr(1)+A+x+w+v+_+S:c+l+A+x+w+v+_+S,k+="]}",k}drawResNode(e,t,s,i,l,n,r,o,a,d){let c=this.icn3d;c.icn3dui;let h,m=e.r.substr(4);h=o?l-t*(s+i):l+t*(s+i),c.firstAtomObjCls.getFirstAtomObj(c.residues[m]);let p="#"+e.c.toUpperCase();c.hColor.getHexString().toUpperCase();let u=e.id.indexOf("."),C=-1==u?e.id:e.id.substr(0,u),g="a"==r?-7:10;t%2==1&&(g="a"==r?g-7:g+7),a&&(C=C.substr(1),o||(g+=4*s));let f="<g class='icn3d-node' resid='"+m+"' >";return f+="<title>"+e.id+"</title>",o?(f+="<circle cx='"+n+"' cy='"+h+"' r='"+s+"' fill='"+p+"' stroke-width='1' stroke='"+"#000' resid='"+m+"' />",f+="<text x='"+(n-20).toString()+"' y='"+(h+2).toString()+"' fill='"+"#000' stroke='none' style='font-size:6px; text-anchor:middle' >"+C+"</text>"):(f+="<circle cx='"+h+"' cy='"+n+"' r='"+s+"' fill='"+p+"' stroke-width='1' stroke='"+"#000' resid='"+m+"' />",f+="<text x='"+(h+0).toString()+"' y='"+(n+g).toString()+"' fill='"+"#000' stroke='none' style='font-size:6px; text-anchor:middle' >"+C+"</text>"),f+="</g>",f}getNodeTopBottom(e,t,s,i,l){let n=this.icn3d.icn3dui,r=this,o=[],a=[],d={};for(let s in e){let e=t[s];if(e){if(1==i||2==i){if(e=n.hashUtilsCls.cloneHash(e),1==i){let t=l[s]?l[s]:"-";e.id+="=>"+t}else{let t=l[s]?l[s]:"--";e.id+="==>"+t}d[e.id]=e}"a"==e.s?o.push(e):"b"==e.s?a.push(e):"ab"==e.s&&(o.push(e),a.push(e))}}return o.sort((function(e,t){return r.compNode(e,t)})),a.sort((function(e,t){return r.compNode(e,t,s)})),{nodeArray1:o,nodeArray2:a,name2node:d}}updateGraphJson(e,t,s,i,l){let n=this.icn3d.icn3dui,r="";return r+='"structure'+t+'": {"id": "'+e+'", "nodes1":[',r+=n.utilsCls.getJSONFromArray(s),r+='], \n"nodes2":[',r+=n.utilsCls.getJSONFromArray(i),r+='], \n"links":[',r+=n.utilsCls.getJSONFromArray(l),r+="]}",r}updateGraphColor(){let e=this.icn3d,t=e.icn3dui;if(void 0!==e.graphStr){let s=JSON.parse(e.graphStr),i={};for(let t in e.residues){let s=e.firstAtomObjCls.getFirstAtomObj(e.residues[t]);i[t]=s.color.getHexString().toUpperCase()}let l={};for(let e=0,n=s.nodes.length;e<n;++e){let n=s.nodes[e],r=[];r.push(""),r.push("");let o=n.r.substr(4);r=r.concat(t.utilsCls.getIdArray(o));let a=r[2]+"_"+r[3]+"_"+r[4];n.c=i[a],l[n.id]=a}for(let e=0,n=s.links.length;e<n;++e){let n=s.links[e];if(n.v==t.htmlCls.ssValue||n.v==t.htmlCls.coilValue){let e=l[n.target];n.c=i[e]}}e.graphStr=JSON.stringify(s)}e.bGraph&&e.drawGraphCls.drawGraph(e.graphStr,e.pre+"dl_graph"),e.bLinegraph&&e.lineGraphCls.drawLineGraph(e.graphStr),e.bScatterplot&&e.lineGraphCls.drawLineGraph(e.graphStr,!0)}handleForce(){let e=this.icn3d;0==e.icn3dui.htmlCls.force&&void 0!==e.simulation?(e.simulation.stop(),e.simulation.force("charge",null),e.simulation.force("x",null),e.simulation.force("y",null),e.simulation.force("r",null),e.simulation.force("link",null)):e.drawGraphCls.drawGraph(e.graphStr,e.pre+"dl_graph")}getNodesLinksForSet(e,t,s,i){let l=this.icn3d,n=l.icn3dui,r=[],o=[],a=0,d=n.htmlCls.coilValue,c="",h="",m=0,p={};for(let u in e){let e=l.atoms[u];if("DUM"!=e.chain&&(i||e.het||"CA"==e.name&&"C"==e.elem||"O3'"==e.name||"O3*"==e.name||"P"==e.name)){let i=e.structure+"_"+e.chain+"_"+e.resi;if(p.hasOwnProperty(i))continue;p[i]=1;let l=n.utilsCls.residueName2Abbr(e.resn)+e.resi;"chain"!=t&&"structure"!=t||(l+="."+e.chain),"structure"==t&&(l+="."+e.structure);let u="1_1_"+i;r.push('{"id": "'+l+'", "r": "'+u+'", "s": "'+s+'", "x": '+e.coord.x.toFixed(0)+', "y": '+e.coord.y.toFixed(0)+', "c": "'+e.color.getHexString().toUpperCase()+'"}'),a>0&&c==e.chain&&(parseInt(e.resi)==parseInt(m)+1||e.resi==m)&&(o.push('{"source": "'+h+'", "target": "'+l+'", "v": '+d+', "c": "'+e.color.getHexString().toUpperCase()+'"}'),e.ssbegin&&(d=n.htmlCls.ssValue),e.ssend&&(d=n.htmlCls.coilValue)),c=e.chain,h=l,m=e.resi,++a}}return{node:r,link:o}}getHbondLinksForSet(e,t){let s=this.icn3d,i=s.icn3dui,l={},n=parseFloat($("#"+s.pre+"hbondthreshold").val()),r=e,o=r;if(Object.keys(o).length>0&&Object.keys(r).length>0){let e=!1;s.hBondCls.calculateChemicalHbonds(i.hashUtilsCls.intHash2Atoms(s.dAtoms,o,s.atoms),i.hashUtilsCls.intHash2Atoms(s.dAtoms,r,s.atoms),parseFloat(n),e,"graph",!0),l=i.hashUtilsCls.cloneHash(s.resid2Residhash)}return this.getGraphLinks(l,l,i.htmlCls.hbondInsideColor,t,i.htmlCls.hbondValuehbondInsideValue)}getIonicLinksForSet(e,t){let s=this.icn3d,i=s.icn3dui,l={},n=parseFloat($("#"+s.pre+"saltbridgethreshold").val()),r=e,o=r;if(Object.keys(o).length>0&&Object.keys(r).length>0){let e=!1;s.saltbridgeCls.calculateIonicInteractions(i.hashUtilsCls.intHash2Atoms(s.dAtoms,o,s.atoms),i.hashUtilsCls.intHash2Atoms(s.dAtoms,r,s.atoms),parseFloat(n),e,"graph",!0),l=i.hashUtilsCls.cloneHash(s.resid2Residhash)}return this.getGraphLinks(l,l,i.htmlCls.ionicInsideColor,t,i.htmlCls.ionicInsideValue)}getHalogenPiLinksForSet(e,t){let s,i=this.icn3d,l=i.icn3dui,n={},r=e,o=r,a="";return s=parseFloat($("#"+i.pre+"halogenthreshold").val()),Object.keys(o).length>0&&Object.keys(r).length>0&&(i.piHalogenCls.calculateHalogenPiInteractions(l.hashUtilsCls.intHash2Atoms(i.dAtoms,r,i.atoms),l.hashUtilsCls.intHash2Atoms(i.dAtoms,o,i.atoms),parseFloat(s),"graph","halogen",!0),n=l.hashUtilsCls.cloneHash(i.resid2Residhash)),a+=this.getGraphLinks(n,n,l.htmlCls.halogenInsideColor,t,l.htmlCls.halogenInsideValue),s=parseFloat($("#"+i.pre+"picationthreshold").val()),Object.keys(o).length>0&&Object.keys(r).length>0&&(i.piHalogenCls.calculateHalogenPiInteractions(l.hashUtilsCls.intHash2Atoms(i.dAtoms,r,i.atoms),l.hashUtilsCls.intHash2Atoms(i.dAtoms,o,i.atoms),parseFloat(s),"graph","pi-cation",!0),n=l.hashUtilsCls.cloneHash(i.resid2Residhash)),a+=this.getGraphLinks(n,n,l.htmlCls.picationInsideColor,t,l.htmlCls.picationInsideValue),s=parseFloat($("#"+i.pre+"pistackingthreshold").val()),Object.keys(o).length>0&&Object.keys(r).length>0&&(i.piHalogenCls.calculateHalogenPiInteractions(l.hashUtilsCls.intHash2Atoms(i.dAtoms,r,i.atoms),l.hashUtilsCls.intHash2Atoms(i.dAtoms,o,i.atoms),parseFloat(s),"graph","pi-stacking",!0),n=l.hashUtilsCls.cloneHash(i.resid2Residhash)),a+=this.getGraphLinks(n,n,l.htmlCls.pistackingInsideColor,t,l.htmlCls.pistackingInsideValue),a}getContactLinksForSet(e,t,s){let i=this.icn3d;i.icn3dui;let l=[],n="",r="",o={};for(let t in e){let e=i.atoms[t];e.ss==n&&e.chain==r||(Object.keys(o).length>0&&l.push(o),o={}),o[e.serial]=1,n=e.ss,r=e.chain}Object.keys(o).length>0&&l.push(o);let a=l.length,d="";for(let e=0;e<a;++e)for(let i=e+1;i<a;++i)d+=this.getContactLinks(l[e],l[i],t,!0,s);return d}getContactLinks(e,t,s,i,l){let n=this.icn3d,r=n.icn3dui,o=parseFloat($("#"+n.pre+"contactthreshold").val());n.contactCls.getAtomsWithinAtom(t,e,parseFloat(o),!0,!1,i);let a=r.hashUtilsCls.cloneHash(n.resid2Residhash);return this.getGraphLinks(a,a,r.htmlCls.contactInsideColor,s,r.htmlCls.contactInsideValue,l)}compNode(e,t,s){let i=this.icn3d.icn3dui,l=e.r.substr(4),n=t.r.substr(4),r=i.utilsCls.getIdArray(l),o=i.utilsCls.getIdArray(n),a=r[0]+"_"+r[1],d=o[0]+"_"+o[1],c=parseInt(r[2]),h=parseInt(o[2]);return a>d?s?-1:1:a<d?s?1:-1:a==d?c>h?1:c<h?-1:0:void 0}getGraphLinks(e,t,s,i,l,n){var r=this.icn3d,o=r.icn3dui;let a="";l=void 0===l?1:l;let d="",c={};for(let h in e){h=h.trim();let e=h.indexOf(" "),m=h.indexOf(":"),p=h.indexOf("@"),u=-1!==p?p:h.length,C=h.indexOf("."),g=h.indexOf("$"),f=o.utilsCls.residueName2Abbr(h.substr(0,e))+h.substr(m+1,u-m-1);"chain"!=i&&"structure"!=i||(f+="."+h.substr(C+1,m-C-1)),"structure"==i&&(f+="."+h.substr(g+1,C-g-1));for(let e in t[h]){e=e.trim();let t=e.indexOf(" "),h=e.indexOf(":"),m=e.indexOf("@"),p=-1!==m?m:e.length,u=e.indexOf("."),C=e.indexOf("$"),g=o.utilsCls.residueName2Abbr(e.substr(0,t))+e.substr(h+1,p-h-1);if(e.substr(u+1,h-u-1),"chain"!=i&&"structure"!=i||(g+="."+e.substr(u+1,h-u-1)),"structure"==i&&(g+="."+e.substr(C+1,u-C-1)),n&&(f=r.resi2resirange[f],g=r.resi2resirange[g]),!c.hasOwnProperty(f+"_"+g)&&void 0!==f&&void 0!==g){let e=', {"source": "'+f+'", "target": "'+g+'", "v": '+l+', "c": "'+s+'"}';e!=d&&(a+=e),d=e,c[f+"_"+g]=1,c[g+"_"+f]=1}}}return a}convertLabel2Resid(e){this.icn3d.icn3dui,e.indexOf(" ");let t=e.indexOf("@"),s=-1!==t?t:e.length,i=e.indexOf("$"),l=e.indexOf("."),n=e.indexOf(":");return e.substr(i+1,l-i-1)+"_"+e.substr(l+1,n-l-1)+"_"+e.substr(n+1,s-n-1)}}class U{constructor(e){this.icn3d=e}drawLineGraph(e,t){let s,i=this.icn3d,l=i.icn3dui,n=JSON.parse(e),r=[],o=[],a=[],d={};for(let e=0,t=n.nodes.length;e<t;++e){let t=n.nodes[e];d[t.id]=t}let c={};for(let e=0,t=n.links.length;e<t;++e){let t=n.links[e];t.v!=l.htmlCls.hbondValue&&t.v!=l.htmlCls.ionicValue&&t.v!=l.htmlCls.halogenValue&&t.v!=l.htmlCls.picationValue&&t.v!=l.htmlCls.pistackingValue&&t.v!=l.htmlCls.contactValue||(r.push(t),c[t.source]=1,c[t.target]=1)}let h=i.getGraphCls.getNodeTopBottom(c,d);o=h.nodeArray1,a=h.nodeArray2,i.lineGraphStr="{\n";let m=i.resid2specCls.atoms2structureArray(i.hAtoms);if(m.length>1){let e={},n=[],o=[],a=[],c=[],h=[],p=[],u=[],C=[],g=[],f=[],b=[],y=[],v={};for(let t=0,s=m.length;t<s;++t)n[t]=[],o[t]=[],a[t]=[],c[t]={},h[t]=[],p[t]=[],u[t]=[],C[t]={},g[t]=[],f[t]=[],b[t]=[],y[t]={},e[m[t]]=t;for(let t=0,s=r.length;t<s;++t){let s=r[t],l=d[s.source],n=d[s.target];if(!(l&&n&&l.r&&n.r))continue;let o=this.getIdArrayFromNode(l),h=this.getIdArrayFromNode(n),p=e[o[2]];if(o[2]==m[p]&&h[2]==m[p]){a[p].push(s),c[p][s.source]=1,c[p][s.target]=1;let e,t,n=o[2]+"_"+o[3],r=h[2]+"_"+h[3],d=n+"_"+o[4],m=r+"_"+h[4];if(i.chainsMapping[n]&&i.chainsMapping[n][d]&&i.chainsMapping[r]&&i.chainsMapping[r][m]){e="a"==l.s?i.chainsMapping[n][d]:i.chainsMapping[r][m],t="a"==l.s?i.chainsMapping[r][m]:i.chainsMapping[n][d];let o=e+"_"+t+"_"+s.c;v.hasOwnProperty(o)?++v[o]:v[o]=1}}}let _="=>",S="==>",w="-",A="--";for(let t=0,s=r.length;t<s;++t){let s=r[t],n=d[s.source],o=d[s.target];if(!(n&&o&&n.r&&o.r))continue;let a=this.getIdArrayFromNode(n),c=this.getIdArrayFromNode(o),h=e[a[2]];if(a[2]==m[h]&&c[2]==m[h]){let e,t,r=a[2]+"_"+a[3],o=c[2]+"_"+c[3],d=r+"_"+a[4],p=o+"_"+c[4];if(i.chainsMapping[r]&&i.chainsMapping[r][d]&&i.chainsMapping[o]&&i.chainsMapping[o][p]){e="a"==n.s?i.chainsMapping[r][d]:i.chainsMapping[o][p],t="a"==n.s?i.chainsMapping[o][p]:i.chainsMapping[r][d];let a=e+"_"+t+"_"+s.c,c=l.hashUtilsCls.cloneHash(s);c.source+=i.chainsMapping[r][d]?_+i.chainsMapping[r][d]:_+w,c.target+=i.chainsMapping[o][p]?_+i.chainsMapping[o][p]:_+w;let g=l.hashUtilsCls.cloneHash(s);g.source+=i.chainsMapping[r][d]?S+i.chainsMapping[r][d]:S+A,g.target+=i.chainsMapping[o][p]?S+i.chainsMapping[o][p]:S+A,v[a]==m.length?u[h].push(c):b[h].push(g),C[h][s.source]=i.chainsMapping[r][d],C[h][s.target]=i.chainsMapping[o][p],y[h][s.source]=i.chainsMapping[r][d],y[h][s.target]=i.chainsMapping[o][p]}}}let x=[],k=[],O=0,H=[],D=1;for(let e=0,t=m.length;e<t;++e){let t=i.getGraphCls.getNodeTopBottom(c[e],d);n[e]=t.nodeArray1,o[e]=t.nodeArray2,Object.keys(i.chainsMapping).length>0&&(D=1,t=i.getGraphCls.getNodeTopBottom(c[e],d,void 0,D,C[e]),h[e]=t.nodeArray1,p[e]=t.nodeArray2,d=l.hashUtilsCls.unionHash(d,t.name2node),D=2,t=i.getGraphCls.getNodeTopBottom(c[e],d,void 0,D,y[e]),g[e]=t.nodeArray1,f[e]=t.nodeArray2,d=l.hashUtilsCls.unionHash(d,t.name2node)),x[e]=n[e].length,k[e]=o[e].length,O=Math.max(O,k[e]),H.push(m[e])}let R,I,E,T,M,F=1,P=3*F,L=7*F,N=10,$=10,U=30,q=20;t?(E=(l.utilsCls.sumArray(x)+2*H.length)*(P+L)+4*$+2*U+q*H.length,I=(O+2)*(P+L)+2*N+U):(R=110+q,E=R*H.length,I=(O+2)*(P+L)+2*N),Object.keys(i.chainsMapping).length>0&&(E*=3),t?(i.scatterplotWidth=2*I,M=i.scatterplotWidth,T=l.scatterplotid):(i.linegraphWidth=2*I,M=i.linegraphWidth,T=l.linegraphid),s=0==H.length?"No interactions found for each structure<br><br>":"2D integration graph for "+H.length+" structure(s) <b>"+H+'</b>. There are three sections: "Interactions", "Common interactions", and "Different interactions". Each section has '+H.length+" graphs.<br><br>",s+="<svg id='"+T+"' viewBox='0,0,"+I+","+E+"' width='"+M+"px'>";let B,j=0;D=0,B=this.drawGraphPerType(D,m,t,n,o,a,d,j,R,q,x,P,L,$),j=B.heightFinal,s+=B.html,Object.keys(i.chainsMapping).length>0&&(D=1,B=this.drawGraphPerType(D,m,t,h,p,u,d,j,R,q,x,P,L,$),j=B.heightFinal,s+=B.html,D=2,B=this.drawGraphPerType(D,m,t,g,f,b,d,j,R,q,x,P,L,$),j=B.heightFinal,s+=B.html),s+="</svg>"}else if(t){let e,t,n,c,h=m[0],p=o.length,u=a.length,C=1,g=3*C,f=7*C,b=30;t=(p+2)*(g+f)+2*10+b,e=(u+2)*(g+f)+2*10+b,i.scatterplotWidth=2*e,c=i.scatterplotWidth,n=l.scatterplotid,s=r.length>0?"":"No interactions found for these two sets<br><br>",s+="<svg id='"+n+"' viewBox='0,0,"+e+","+t+"' width='"+c+"px'>",s+=this.drawScatterplot_base(o,a,r,d,0),i.lineGraphStr+=i.getGraphCls.updateGraphJson(h,1,o,a,r),s+="</svg>"}else{let e=m[0],t=o.length,n=a.length,c=1,h=3*c,p=7*c,u=110,C=10,g=t>n?t*(h+p)+2*C:n*(h+p)+2*C;i.linegraphWidth=2*g,s=r.length>0?"":"No interactions found for these two sets<br><br>",s+="<svg id='"+l.linegraphid+"' viewBox='0,0,"+g+","+u+"' width='"+i.linegraphWidth+"px'>",s+=this.drawLineGraph_base(o,a,r,d,0),i.lineGraphStr+=i.getGraphCls.updateGraphJson(e,1,o,a,r),s+="</svg>"}return i.lineGraphStr+="}\n",i.scatterplotStr=i.lineGraphStr,t?$("#"+i.pre+"scatterplotDiv").html(s):$("#"+i.pre+"linegraphDiv").html(s),s}drawGraphPerType(e,t,s,i,l,n,r,o,a,d,c,h,m,p){let u=this.icn3d;u.icn3dui;let C,g,f="";0==e?(C="Interactions in ",g=""):1==e?(C="Common interactions in ",g="_common"):2==e&&(C="Different interactions in ",g="_diff");for(let b=0,y=t.length;b<y;++b)s?(f+=this.drawScatterplot_base(i[b],l[b],n[b],r,o,void 0,C+t[b],d),a=(c[b]+1)*(h+m)+2*p+d):f+=this.drawLineGraph_base(i[b],l[b],n[b],r,o,C+t[b],d),o+=a,e?b>0&&(u.lineGraphStr+=", \n"):u.lineGraphStr+=", \n",u.lineGraphStr+=u.getGraphCls.updateGraphJson(t[b],b+g,i[b],l[b],n[b]);return{heightFinal:o,html:f}}getIdArrayFromNode(e){let t=this.icn3d.icn3dui,s=[];s.push(""),s.push("");let i=e.r.substr(4);return s=s.concat(t.utilsCls.getIdArray(i)),s}drawLineGraph_base(e,t,s,i,l,n,r){let o,a,d=this.icn3d,c=d.icn3dui,h="",m=e.length,p=t.length;m>p?(o=10,a=10*Math.abs(m-p)*.5+10):(a=10,o=10*Math.abs(m-p)*.5+10),n&&(h+="<text x='10' y='"+(l+=r)+"' style='font-size:8px; font-weight:bold'>"+n+"</text>");let u=30+l,C=80+l,g="",f={},b={};for(let t=0;t<m;++t)g+=d.getGraphCls.drawResNode(e[t],t,3,7,o,u,"a"),f[e[t].id]={x:o+10*t,y:u};for(let e=0;e<p;++e)g+=d.getGraphCls.drawResNode(t[e],e,3,7,a,C,"b"),b[t[e].id]={x:a+10*e,y:C};for(let e=0,t=s.length;e<t;++e){let t=s[e],l=i[t.source],n=i[t.target];if(void 0===l||void 0===n)continue;let r,o,a=l.r.substr(4),d=n.r.substr(4),m=f[l.id],p=b[n.id];void 0!==m&&void 0!==p&&(r=t.v==c.htmlCls.contactValue?1:2,t.v==c.htmlCls.hbondValue?o="#"+c.htmlCls.hbondColor:t.v==c.htmlCls.ionicValue?o="#"+c.htmlCls.ionicColor:t.v==c.htmlCls.halogenValue?o="#"+c.htmlCls.halogenColor:t.v==c.htmlCls.picationValue?o="#"+c.htmlCls.picationColor:t.v==c.htmlCls.pistackingValue?o="#"+c.htmlCls.pistackingColor:t.v==c.htmlCls.contactValue&&(o="#"+c.htmlCls.contactColor),h+="<g class='icn3d-interaction' resid1='"+a+"' resid2='"+d+"' >",h+="<title>Interaction of residue "+l.id+" with residue "+n.id+"</title>",h+="<line x1='"+m.x+"' y1='"+m.y+"' x2='"+p.x+"' y2='"+p.y+"' stroke='"+o+"' stroke-width='"+r+"' /></g>")}return h+=g,h}drawScatterplot_base(e,t,s,i,l,n,r,o,a){let d=this.icn3d;d.icn3dui;let c="",h=e.length,m=t.length,p=n?3:7,u=(h+1)*(3+p)+30+40;r&&(c+="<text x='10' y='"+((l+=o)+15).toString()+"' style='font-size:8px; font-weight:bold'>"+r+"</text>");let C=l+u-(50+(3+p)),g=40+(3+p),f="",b={},y={};for(let t=0;t<h;++t)f+=d.getGraphCls.drawResNode(e[t],t,3,p,C,40,"a",!0,void 0,a),b[e[t].id]={x:40,y:C-t*(3+p)};let v=l+u-50;for(let e=0;e<m;++e)f+=d.getGraphCls.drawResNode(t[e],e,3,p,g,v,"b",!1,n,a),y[t[e].id]={x:g+e*(3+p),y:v};for(let e=0,t=s.length;e<t;++e){let t=s[e],l=i[t.source],r=i[t.target];l&&r&&(c+=this.drawOnePairNode(t,l,r,b,y,n,a),n&&!a&&(c+=this.drawOnePairNode(t,r,l,b,y,n,a)))}return c+=f,c}drawOnePairNode(e,t,s,i,l,n,r){let o,a,d=this.icn3d,c=d.icn3dui,h="",m=n?6:4.5,p=.5*m,u=t.r.substr(4),C=s.r.substr(4),g=i[t.id],f=l[s.id];return void 0===g||void 0===f||(e.v==c.htmlCls.hbondValue?o="#"+c.htmlCls.hbondColor:e.v==c.htmlCls.ionicValue?o="#"+c.htmlCls.ionicColor:e.v==c.htmlCls.halogenValue?o="#"+c.htmlCls.halogenColor:e.v==c.htmlCls.picationValue?o="#"+c.htmlCls.picationColor:e.v==c.htmlCls.pistackingValue?o="#"+c.htmlCls.pistackingColor:e.v==c.htmlCls.contactValue&&(o="#"+c.htmlCls.contactColor),n&&(o="#"+e.c),a=e.v==c.htmlCls.contactValue?1:2,r&&d.hex2skip[e.c]||(r&&d.hex2id[e.c]?(d.hex2id[e.c],h+="<rect class='icn3d-interaction' resid1='"+u+"' resid2='"+C+"' x='"+(f.x-p).toString()+"' y='"+(g.y-p).toString()+"' width='"+m+"' height='"+m+"' fill='"+o+"' stroke-width='"+a+"' stroke='"+o+"' />"):(h+="<g class='icn3d-interaction' resid1='"+u+"' resid2='"+C+"' >",h+="<title>Interaction of residue "+t.id+" with residue "+s.id+"</title>",h+=n?"<rect x='"+(f.x-p).toString()+"' y='"+(g.y-p).toString()+"' width='"+m+"' height='"+m+"' fill='"+o+"' stroke-width='"+a+"' stroke='"+o+"' />":"<rect x='"+(f.x-p).toString()+"' y='"+(g.y-p).toString()+"' width='"+m+"' height='"+m+"' fill='"+o+"' fill-opacity='0.6' stroke-width='"+a+"' stroke='"+o+"' />",h+="</g>"))),h}copyStylesInline(e,t){this.icn3d.icn3dui;let s=["svg","g"];for(let i=0;i<e.childNodes.length;i++){let l=e.childNodes[i];if(-1!=s.indexOf(l.tagName)){this.copyStylesInline(l,t.childNodes[i]);continue}let n=t.childNodes[i].currentStyle||window.getComputedStyle(t.childNodes[i]);if("undefined"!=n&&null!=n)for(let e=0;e<n.length;e++)l.style.setProperty(n[e],n.getPropertyValue(n[e]))}}}class q{constructor(e){this.icn3d=e}viewInteractionPairs(e,t,s,i,l,n,r,o,a,d,c){let h,m=this.icn3d,p=m.icn3dui;m.bRender=!1;let u,C={},g=p.hashUtilsCls.cloneHash(m.hAtoms),f="calpha"==i||"cbeta"==i||"heavyatoms"==i,b={},y={};if(f)for(let e in m.hAtoms){let t=m.atoms[e];"HOH"!=t.resn&&"WAT"!=t.resn&&"SOL"!=t.resn&&(("calpha"==i&&(t.het||"CA"==t.name||"O3'"==t.name||"O3*"==t.name)||"cbeta"==i&&(t.het||"CB"==t.name||"O3'"==t.name||"O3*"==t.name)||"heavyatoms"==i&&"H"!=t.elem)&&(b[e]=t,y[e]=t))}else b=m.definedSetsCls.getAtomsFromNameArray(e),y=m.definedSetsCls.getAtomsFromNameArray(t);let v=0,_=0;for(let e in m.structures){for(let t=0,s=m.structures[e].length;t<s;++t){let s=m.structures[e][t];for(let e in m.chains[s])if(b.hasOwnProperty(e)||y.hasOwnProperty(e)){++v;break}}++_}u=_>1?"structure":v>1?"chain":"residue";let S=[];if(l&&S.push("hbonds"),n&&S.push("salt bridge"),r&&S.push("interactions"),o&&S.push("halogen"),a&&S.push("pi-cation"),d&&S.push("pi-stacking"),s||(m.resids2inter={},m.resids2interAll={}),n){let l=parseFloat($("#"+m.pre+"saltbridgethreshold").val());l&&!isNaN(l)||(l=m.tsIonic),s||(m.hAtoms=p.hashUtilsCls.cloneHash(g),m.showInterCls.showIonicInteractions(l,e,t,s,!0,i)),C=p.hashUtilsCls.unionHash(C,m.hAtoms)}if(l){let l=parseFloat($("#"+m.pre+"hbondthreshold").val());l&&!isNaN(l)||(l=m.tsHbond),s||(m.hAtoms=p.hashUtilsCls.cloneHash(g),m.showInterCls.showHbonds(l,e,t,s,void 0,i)),C=p.hashUtilsCls.unionHash(C,m.hAtoms)}let w,A,x,k,O="";if(l&&(O+=this.exportHbondPairs(i,u)),n&&(O+=this.exportSaltbridgePairs(i,u)),o){let l=parseFloat($("#"+m.pre+"halogenthreshold").val());l&&!isNaN(l)||(l=m.tsHalogen),s||(m.hAtoms=p.hashUtilsCls.cloneHash(g),m.showInterCls.showHalogenPi(l,e,t,s,i,"halogen")),C=p.hashUtilsCls.unionHash(C,m.hAtoms),O+=this.exportHalogenPiPairs(i,u,"halogen")}if(a){let l=parseFloat($("#"+m.pre+"picationthreshold").val());l&&!isNaN(l)||(l=m.tsPication),s||(m.hAtoms=p.hashUtilsCls.cloneHash(g),m.showInterCls.showHalogenPi(l,e,t,s,i,"pi-cation")),C=p.hashUtilsCls.unionHash(C,m.hAtoms),O+=this.exportHalogenPiPairs(i,u,"pi-cation")}if(d){let l=parseFloat($("#"+m.pre+"pistackingthreshold").val());l&&!isNaN(l)||(l=m.tsPistacking),s||(m.hAtoms=p.hashUtilsCls.cloneHash(g),m.showInterCls.showHalogenPi(l,e,t,s,i,"pi-stacking")),C=p.hashUtilsCls.unionHash(C,m.hAtoms),O+=this.exportHalogenPiPairs(i,u,"pi-stacking")}if(r){let l=f?c:parseFloat($("#"+m.pre+"contactthreshold").val());if(l&&!isNaN(l)||(l=m.tsContact),1!=e.length||1!=t.length||e[0]!=t[0])s||(m.hAtoms=p.hashUtilsCls.cloneHash(g),m.showInterCls.pickCustomSphere(l,e,t,s,!0,i)),C=p.hashUtilsCls.unionHash(C,m.hAtoms),O+=this.exportSpherePairs(!0,i,u);else{if(!s){let n={},o={};if(f){let e=!0,t=m.showInterCls.pickCustomSphere_base(l,b,y,s,!0,void 0,void 0,!0,e);n=p.hashUtilsCls.unionHash(n,t.residues);for(let e in t.resid2Residhash)o[e]=p.hashUtilsCls.unionHash(o[e],t.resid2Residhash[e])}else{let r=[],a="",d="",c={};for(let e in b){let t=m.atoms[e];t.ss==a&&t.chain==d||(Object.keys(c).length>0&&r.push(c),c={}),c[t.serial]=1,a=t.ss,d=t.chain}Object.keys(c).length>0&&r.push(c);let h=r.length;A="interactions "+l+" | sets "+e+" "+t+" | true",m.opts.contact="yes";for(let e=0;e<h;++e)for(let t=e+1;t<h;++t){m.hAtoms=p.hashUtilsCls.cloneHash(g);let a=m.showInterCls.pickCustomSphere_base(l,r[e],r[t],s,!0,i,A,!0);n=p.hashUtilsCls.unionHash(n,a.residues);for(let e in a.resid2Residhash)o[e]=p.hashUtilsCls.unionHash(o[e],a.resid2Residhash[e])}}m.resid2ResidhashInteractions=o;let a,d,c=Object.keys(n);m.hAtoms={};for(let e=0,t=c.length;e<t;++e){let t=c[e];for(let e in m.residues[t])m.hAtoms[e]=1}let h=m.firstAtomObjCls.getFirstAtomObj(n);void 0!==h&&(a="sphere."+h.chain+":"+p.utilsCls.residueName2Abbr(h.resn.substr(0,3)).trim()+h.resi+"-"+radius+"A",r&&(a="interactions."+h.chain+":"+p.utilsCls.residueName2Abbr(h.resn.substr(0,3)).trim()+h.resi+"-"+$("#"+m.pre+"contactthreshold").val()+"A"),d=a,m.selectionCls.addCustomSelection(c,a,d,A,!0)),m.selectionCls.saveSelectionIfSelected(),m.drawCls.draw()}C=p.hashUtilsCls.unionHash(C,m.hAtoms),O+=this.exportSpherePairs(!0,i,u)}}m.hAtoms=p.hashUtilsCls.cloneHash(C),m.bRender=!0,m.drawCls.draw(),w=m.firstAtomObjCls.getResiduesFromAtoms(C),A="select "+m.resid2specCls.residueids2spec(Object.keys(w)),x="interface_all",k=x,m.selectionCls.addCustomSelection(Object.keys(w),x,k,A,!0);let H=p.hashUtilsCls.intHash(C,b);w=m.firstAtomObjCls.getResiduesFromAtoms(H),A="select "+m.resid2specCls.residueids2spec(Object.keys(w)),x="interface_1",k=x,m.selectionCls.addCustomSelection(Object.keys(w),x,k,A,!0);let D=p.hashUtilsCls.intHash(C,y);w=m.firstAtomObjCls.getResiduesFromAtoms(D),A="select "+m.resid2specCls.residueids2spec(Object.keys(w)),x="interface_2",k=x,m.selectionCls.addCustomSelection(Object.keys(w),x,k,A,!0);let R='<div style="text-align:center"><b>'+S.join(", ")+" between Two Sets:</b><br>",I=m.resid2specCls.atoms2residues(Object.keys(b)),E=m.resid2specCls.atoms2residues(Object.keys(y)),T="select "+m.resid2specCls.residueids2spec(I),M="select "+m.resid2specCls.residueids2spec(E);R+="Set 1: "+e+' <button class="'+m.pre+'selset" cmd="'+T+'">Highlight in 3D</button><br>',R+="Set 2: "+t+' <button class="'+m.pre+'selset" cmd="'+M+'">Highlight in 3D</button><br><br></div>',R+='<div style="text-align:center"><b>The interfaces are:</b><br>';let F=m.resid2specCls.atoms2residues(Object.keys(H)),P=m.resid2specCls.atoms2residues(Object.keys(D)),L="select "+m.resid2specCls.residueids2spec(F),N="select "+m.resid2specCls.residueids2spec(P);R+='interface_1 <button class="'+m.pre+'selset" cmd="'+L+'">Highlight in 3D</button><br>',R+='interface_2 <button class="'+m.pre+'selset" cmd="'+N+'">Highlight in 3D</button><br><br></div>',R+='<div><b>Note</b>: Each checkbox below selects the corresponding residue. You can click "Save Selection" in the "Select" menu to save the selection and click on "Highlight" button to clear the checkboxes.</div><br>';let U=R;if(("graph"==i||"linegraph"==i||"scatterplot"==i||f)&&(R=""),R+=O,"save1"==i||"save2"==i){R=U;let e="";"save1"==i?e="Set 1":"save2"==i&&(e="Set 2"),R+='<div style="text-align:center"><br><b>Interactions Sorted on '+e+'</b>: <button class="'+m.pre+'showintercntonly" style="margin-left:20px">Show Count Only</button><button class="'+m.pre+'showinterdetails" style="margin-left:20px">Show Details</button></div>';let t=this.getAllInteractionTable(i);R+=t.html,h=t.bondCnt,$("#"+m.pre+"dl_interactionsorted").html(R),p.htmlCls.dialogCls.openDlg("dl_interactionsorted","Show sorted interactions")}else if("view"==i)$("#"+m.pre+"dl_allinteraction").html(R),p.htmlCls.dialogCls.openDlg("dl_allinteraction","Show interactions");else if("linegraph"==i){p.htmlCls.dialogCls.openDlg("dl_linegraph","Show interactions between two lines of residue nodes"),m.graphStr=m.getGraphCls.getGraphData(b,y,e,t,R,u),m.bLinegraph=!0;let s=m.lineGraphCls.drawLineGraph(m.graphStr);$("#"+m.pre+"linegraphDiv").html(s)}else if("scatterplot"==i){p.htmlCls.dialogCls.openDlg("dl_scatterplot","Show interactions as scatterplot"),m.graphStr=m.getGraphCls.getGraphData(b,y,e,t,R,u),m.bScatterplot=!0;let s=m.lineGraphCls.drawLineGraph(m.graphStr,!0);$("#"+m.pre+"scatterplotDiv").html(s)}else if(f){p.htmlCls.dialogCls.openDlg("dl_contactmap","Show contact map");let s=!0,i=m.getGraphCls.getGraphData(b,y,e,t,R,u,s);m.bContactMap=!0;let l=m.contactMapCls.drawContactMap(i);$("#"+m.pre+"contactmapDiv").html(l)}else if("graph"==i)if(m.graphStr=m.getGraphCls.getGraphData(b,y,e,t,R,u),m.bGraph=!0,Object.keys(y).length+Object.keys(b).length>Object.keys(m.dAtoms).length&&(m.graphStr=m.getGraphCls.getGraphDataForDisplayed()),void 0===m.bD3){$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/icn3d/script/d3v4-force-all.min.js",dataType:"script",cache:!0,tryCount:0,retryLimit:0,success:function(e){m.bD3=!0,$("#"+p.svgid).empty(),p.htmlCls.dialogCls.openDlg("dl_graph","Force-directed graph"),m.drawGraphCls.drawGraph(m.graphStr,m.pre+"dl_graph"),void 0!==m.deferredGraphinteraction&&m.deferredGraphinteraction.resolve()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):void 0!==m.deferredGraphinteraction&&m.deferredGraphinteraction.resolve()}})}else $("#"+p.svgid).empty(),p.htmlCls.dialogCls.openDlg("dl_graph","Force-directed graph"),m.drawGraphCls.drawGraph(m.graphStr,m.pre+"dl_graph");return{interactionTypes:S.toString(),bondCnt:h}}clearInteractions(){let e=this.icn3d;e.icn3dui,e.lines.hbond=[],e.hbondpnts=[],e.lines.saltbridge=[],e.saltbridgepnts=[],e.lines.contact=[],e.contactpnts=[],e.lines.halogen=[],e.lines["pi-cation"]=[],e.lines["pi-stacking"]=[],e.halogenpnts=[],e.picationpnts=[],e.pistackingpnts=[]}resetInteractionPairs(){let e=this.icn3d;e.icn3dui,e.bHbondCalc=!1,e.showInterCls.hideHbondsContacts(),e.hlUpdateCls.clearHighlight(),e.resids2inter={},e.resids2interAll={}}retrieveInteractionData(){let e=this.icn3d,t=e.icn3dui;if(!e.b2DShown)if(void 0!==t.cfg.align){let t=Object.keys(e.structures);e.ParserUtilsCls.set2DDiagramsForAlign(t[0].toUpperCase(),t[1].toUpperCase())}else void 0!==t.cfg.chainalign?(Object.keys(e.structures),e.ParserUtilsCls.set2DDiagramsForChainalign(e.chainidArray)):e.ParserUtilsCls.download2Ddgm(e.inputid.toUpperCase())}getAllInteractionTable(e){let t=this.icn3d,s=t.icn3dui,i=[],l=Object.keys(t.resids2inter);("save1"==e||"save2"==e)&&l.sort((function(t,i){return s.utilsCls.compResid(t,i,e)}));let n="",r="",o="",a="",d="",c="",h="",m="",p="",u=0,C=0,g=0,f=0,b=0,y=0;for(let s=0,v=l.length;s<v;++s){let v=l[s],_=v.split(","),S="save1"==e?_[0]:_[1];"save1"==e?_[1]:_[0];let w,A,x=S.split("_");s>0&&S!=r&&(i.push({cntHbond:u,cntIonic:C,cntContact:g,cntHalegen:f,cntPication:b,cntPistacking:y}),n+=this.getInteractionPerResidue(o,a,d,c,h,m,p,u,C,g,f,b,y),a="",d="",c="",h="",m="",p="",u=0,C=0,g=0,f=0,b=0,y=0),w=t.resids2inter[v].hbond,A=this.getInteractionPairDetails(w,e,"hbond"),a+=A.html,u+=A.cnt,w=t.resids2inter[v].ionic,A=this.getInteractionPairDetails(w,e,"ionic"),d+=A.html,C+=A.cnt,w=t.resids2inter[v].contact,A=this.getContactPairDetails(w,e,"contact"),c+=A.html,g+=A.cnt,w=t.resids2inter[v].halogen,A=this.getInteractionPairDetails(w,e,"halogen"),h+=A.html,f+=A.cnt,w=t.resids2inter[v]["pi-cation"],A=this.getInteractionPairDetails(w,e,"pi-cation"),m+=A.html,b+=A.cnt,w=t.resids2inter[v]["pi-stacking"],A=this.getInteractionPairDetails(w,e,"pi-stacking"),p+=A.html,y+=A.cnt,r=S,o=x}i.push({cntHbond:u,cntIonic:C,cntContact:g,cntHalegen:f,cntPication:b,cntPistacking:y}),n+=this.getInteractionPerResidue(o,a,d,c,h,m,p,u,C,g,f,b,y);let v="";if(l.length>0){v+='<br><table class="icn3d-sticky" align=center border=1 cellpadding=10 cellspacing=0><thead>',v+="<tr><th rowspan=2>Residue</th><th rowspan=2># Hydrogen<br>Bond</th><th rowspan=2># Salt Bridge<br>/Ionic Interaction</th><th rowspan=2># Contact</th>",v+="<th rowspan=2># Halogen<br>Bond</th><th rowspan=2># &pi;-Cation</th><th rowspan=2># &pi;-Stacking</th>",v+="<th>Hydrogen Bond</th><th>Salt Bridge/Ionic Interaction</th><th>Contact</th>",v+="<th>Halogen Bond</th><th>&pi;-Cation</th><th>&pi;-Stacking</th></tr>",v+="<tr>";let e='<td><table width="100%" class="icn3d-border"><tr><td>Atom1</td><td>Atom2</td><td>Distance(&#8491;)</td><td>Highlight in 3D</td></tr></table></td>';v+=e,v+=e,v+='<td><table width="100%" class="icn3d-border"><tr><td>Atom1</td><td>Atom2</td><td># Contacts</td><td>Min Distance(&#8491;)</td><td>C-alpha Distance(&#8491;)</td><td>Highlight in 3D</td></tr></table></td>',v+=e,v+=e,v+=e,v+="</tr>",v+="</thead><tbody>",v+=n,v+="</tbody></table><br/>"}return{html:v,bondCnt:i}}getInteractionPerResidue(e,t,s,i,l,n,r,o,a,d,c,h,m){this.icn3d.icn3dui;let p="";p+='<tr align="center"><th>'+e[3]+e[2]+"</th><td>"+o+"</td><td>"+a+"</td><td>"+d+"</td><td>"+c+"</td><td>"+h+"</td><td>"+m+"</td>";let u=[t,s,i,l,n,r];for(let e in u){p+='<td valign="top"><table width="100%" class="icn3d-border">'+u[e]+"</table></td>"}return p+="</tr>",p}getInteractionPairDetails(e,t,s){let i=this.icn3d;i.icn3dui;let l="",n=0,r=' <span style="background-color:#',o='">&nbsp;&nbsp;&nbsp;</span>';if(void 0!==e)for(let a in e){let d=a.split(","),c="save1"==t?d[0]:d[1],h="save1"==t?d[1]:d[0],m=i.getGraphCls.convertLabel2Resid(c),p=i.firstAtomObjCls.getFirstAtomObj(i.residues[m]),u=p.color?p.color.getHexString():"",C=i.getGraphCls.convertLabel2Resid(h),g=i.firstAtomObjCls.getFirstAtomObj(i.residues[C]),f=g.color?g.color.getHexString():"",b=Math.sqrt(e[a]).toFixed(1);l+='<tr><td><span style="white-space:nowrap"><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+s+"2_"+n+'a" resid="'+c+'"/> '+c+r+u+o+'</span></td><td><span style="white-space:nowrap"><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+s+"2_"+n+'b" resid="'+h+'"/> '+h+r+f+o+'</span></td><td align="center">'+b+"</td>",l+='<td align="center"><button class="'+i.pre+'selres" resid="'+c+"|"+h+'">Highlight</button></td>',l+="</tr>",++n}return{html:l,cnt:n}}getContactPairDetails(e,t){let s=this.icn3d;s.icn3dui;let i="",l=0,n=' <span style="background-color:#',r='">&nbsp;&nbsp;&nbsp;</span>';if(void 0!==e)for(let o in e){let a=o.split(","),d="save1"==t?a[0]:a[1],c="save1"==t?a[1]:a[0],h=s.getGraphCls.convertLabel2Resid(d),m=s.firstAtomObjCls.getFirstAtomObj(s.residues[h]),p=m.color?m.color.getHexString():"",u=s.getGraphCls.convertLabel2Resid(c),C=s.firstAtomObjCls.getFirstAtomObj(s.residues[u]),g=C.color?C.color.getHexString():"",f=e[o].split("_"),b=f[0],y=f[1],v=f[2],_=f[3],S=f[4];i+='<tr><td><span style="white-space:nowrap"><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"inter2_"+l+'a" resid="'+d+'"/> '+d+"@"+v+n+p+r+'</span></td><td><span style="white-space:nowrap"><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"inter2_"+l+'b" resid="'+c+'"/> '+c+"@"+_+n+g+r+'</span></td><td align="center">'+S+'</td><td align="center">'+b+'</td><td align="center">'+y+"</td>",i+='<td align="center"><button class="'+s.pre+'selres" resid="'+d+"|"+c+'">Highlight</button></td>',i+="</tr>",l+=parseInt(S)}return{html:i,cnt:l}}exportInteractions(){var e=this.icn3d;e.icn3dui;let t='<html><body><div style="text-align:center"><br><b>Interacting residues</b>:<br/><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Base Chain: Residues</th><th>Interacting Chain</th></tr>';for(let s in e.chainname2residues)for(let i in e.chainname2residues[s]){let l=s.substr(0,s.indexOf("_"))+"_"+i.substr(0,i.indexOf(" "));t+="<tr><td>"+s+": ",t+=e.resid2specCls.residueids2spec(e.chainname2residues[s][i]),t+="</td><td>"+l+"</td></tr>"}t+="</table><br/></div></body></html>";let s=e.inputid?e.inputid:"custom";e.saveFileCls.saveFile(s+"_interactions.html","html",t)}exportSsbondPairs(){var e=this.icn3d;e.icn3dui;let t="",s=0;for(let i in e.structures){let l=e.ssbondpnts[i];if(void 0===l)break;for(let e=0,i=l.length;e<i;e+=2){t+="<tr><td>"+l[e]+" Cys</td><td>"+l[e+1]+" Cys</td></tr>",++s}}let i='<html><body><div style="text-align:center"><br><b>'+s+" disulfide pairs</b>:<br><br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Residue ID 1</th><th>Residue ID 2</th></tr>";i+=t,i+="</table><br/></div></body></html>";let l=e.inputid?e.inputid:"custom";e.saveFileCls.saveFile(l+"_disulfide_pairs.html","html",i)}exportClbondPairs(){var e=this.icn3d;e.icn3dui;let t="",s=0,i={};for(let l in e.structures){let n=e.clbondpnts[l];if(void 0===n)break;for(let l=0,r=n.length;l<r;l+=2){let r=n[l],o=n[l+1];if(!i.hasOwnProperty(r+"_"+o)){let i=e.firstAtomObjCls.getFirstAtomObj(e.residues[r]),l=e.firstAtomObjCls.getFirstAtomObj(e.residues[o]);t+="<tr><td>"+r+" "+i.resn+"</td><td>"+o+" "+l.resn+"</td></tr>",++s}i[r+"_"+o]=1,i[o+"_"+r]=1}}let l='<html><body><div style="text-align:center"><br><b>'+s+" cross-linkage pairs</b>:<br><br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Residue ID 1</th><th>Residue ID 2</th></tr>";l+=t,l+="</table><br/></div></body></html>";let n=e.inputid?e.inputid:"custom";e.saveFileCls.saveFile(n+"_crosslinkage_pairs.html","html",l)}exportHbondPairs(e,t){var s=this.icn3d,i=s.icn3dui;let l="",n=0,r=' <span style="background-color:#',o='">&nbsp;&nbsp;&nbsp;</span>';for(let t in s.resid2ResidhashHbond){let i=s.getGraphCls.convertLabel2Resid(t),a=s.firstAtomObjCls.getFirstAtomObj(s.residues[i]),d=a.color?a.color.getHexString():"";for(let i in s.resid2ResidhashHbond[t]){let a=s.getGraphCls.convertLabel2Resid(i),c=s.firstAtomObjCls.getFirstAtomObj(s.residues[a]),h=c.color?c.color.getHexString():"",m=Math.sqrt(s.resid2ResidhashHbond[t][i]).toFixed(1);l+='<tr><td><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"hbond_"+n+'a" resid="'+t+'"/> '+t+r+d+o+'</td><td><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"hbond_"+n+'b" resid="'+i+'"/> '+i+r+h+o+'</td><td align="center">'+m+"</td>","view"==e&&(l+='<td align="center"><button class="'+s.pre+'selres" resid="'+t+"|"+i+'">Highlight</button></td>'),l+="</tr>",++n}}let a='<div style="text-align:center"><br><b>'+n+" hydrogen bond pairs</b>:</div><br>";if(n>0&&(a+="<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Atom 1</th><th>Atom 2</th><th>Distance(&#8491;)</th>","view"==e&&(a+='<th align="center">Highlight in 3D</th>'),a+="</tr>",a+=l,a+="</table><br/>"),"graph"==e||"linegraph"==e||"scatterplot"==e){return s.getGraphCls.getGraphLinks(s.resid2ResidhashHbond,s.resid2ResidhashHbond,i.htmlCls.hbondColor,t,i.htmlCls.hbondValue)}return a}exportSaltbridgePairs(e,t){var s=this.icn3d,i=s.icn3dui;let l="",n=0,r=' <span style="background-color:#',o='">&nbsp;&nbsp;&nbsp;</span>';for(let t in s.resid2ResidhashSaltbridge){let i=s.getGraphCls.convertLabel2Resid(t),a=s.firstAtomObjCls.getFirstAtomObj(s.residues[i]),d=a.color?a.color.getHexString():"";for(let i in s.resid2ResidhashSaltbridge[t]){let a=s.getGraphCls.convertLabel2Resid(i),c=s.firstAtomObjCls.getFirstAtomObj(s.residues[a]),h=c.color?c.color.getHexString():"",m=Math.sqrt(s.resid2ResidhashSaltbridge[t][i]).toFixed(1);l+='<tr><td><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"saltb_"+n+'a" resid="'+t+'"/> '+t+r+d+o+'</td><td><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"saltb_"+n+'b" resid="'+i+'"/> '+i+r+h+o+'</td><td align="center">'+m+"</td>","view"==e&&(l+='<td align="center"><button class="'+s.pre+'selres" resid="'+t+"|"+i+'">Highlight</button></td>'),l+="</tr>",++n}}let a='<div style="text-align:center"><br><b>'+n+" salt bridge/ionic interaction pairs</b>:</div><br>";if(n>0&&(a+="<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Atom 1</th><th>Atom 2</th><th>Distance(&#8491;)</th>","view"==e&&(a+='<th align="center">Highlight in 3D</th>'),a+="</tr>",a+=l,a+="</table><br/>"),"graph"==e||"linegraph"==e||"scatterplot"==e){return s.getGraphCls.getGraphLinks(s.resid2ResidhashSaltbridge,s.resid2ResidhashSaltbridge,i.htmlCls.ionicColor,t,i.htmlCls.ionicValue)}return a}exportHalogenPiPairs(e,t,s){var i=this.icn3d,l=i.icn3dui;let n,r,o,a="",d=0,c=' <span style="background-color:#',h='">&nbsp;&nbsp;&nbsp;</span>';"halogen"==s?(n=i.resid2ResidhashHalogen,r=l.htmlCls.halogenColor,o=l.htmlCls.halogenValue):"pi-cation"==s?(n=i.resid2ResidhashPication,r=l.htmlCls.picationColor,o=l.htmlCls.picationValue):"pi-stacking"==s&&(n=i.resid2ResidhashPistacking,r=l.htmlCls.pistackingColor,o=l.htmlCls.pistackingValue);for(let t in n){let l=i.getGraphCls.convertLabel2Resid(t),r=i.firstAtomObjCls.getFirstAtomObj(i.residues[l]),o=r.color?r.color.getHexString():"";for(let l in n[t]){let r=i.getGraphCls.convertLabel2Resid(l),m=i.firstAtomObjCls.getFirstAtomObj(i.residues[r]),p=m.color?m.color.getHexString():"",u=Math.sqrt(n[t][l]).toFixed(1);a+='<tr><td><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+s+"_"+d+'a" resid="'+t+'"/> '+t+c+o+h+'</td><td><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+s+"_"+d+'b" resid="'+l+'"/> '+l+c+p+h+'</td><td align="center">'+u+"</td>","view"==e&&(a+='<td align="center"><button class="'+i.pre+'selres" resid="'+t+"|"+l+'">Highlight</button></td>'),a+="</tr>",++d}}let m='<div style="text-align:center"><br><b>'+d+" "+s+" pairs</b>:</div><br>";if(d>0&&(m+="<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Atom 1</th><th>Atom 2</th><th>Distance(&#8491;)</th>","view"==e&&(m+='<th align="center">Highlight in 3D</th>'),m+="</tr>",m+=a,m+="</table><br/>"),"graph"==e||"linegraph"==e||"scatterplot"==e){return i.getGraphCls.getGraphLinks(n,n,r,t,o)}return m}exportSpherePairs(e,t,s){var i=this.icn3d,l=i.icn3dui;let n="",r=0,o=e?i.resid2ResidhashInteractions:i.resid2ResidhashSphere,a=' <span style="background-color:#',d='">&nbsp;&nbsp;&nbsp;</span>';for(let s in o){let l=i.getGraphCls.convertLabel2Resid(s),c=i.firstAtomObjCls.getFirstAtomObj(i.residues[l]),h=c.color?c.color.getHexString():"";for(let l in o[s]){let m=i.getGraphCls.convertLabel2Resid(l),p=i.firstAtomObjCls.getFirstAtomObj(i.residues[m]),u=p.color?p.color.getHexString():"",C=o[s][l].split("_"),g=C[0],f=C[1];c=C[2],p=C[3];let b=C[4];e?(n+='<tr><td><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+"inter_"+r+'a" resid="'+s+'"/> '+s+"@"+c+a+h+d+'</td><td><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+"inter_"+r+'b" resid="'+l+'"/> '+l+"@"+p+a+u+d+'</td><td align="center">'+b+'</td><td align="center">'+g+'</td><td align="center">'+f+"</td>","view"==t&&(n+='<td align="center"><button class="'+i.pre+'selres" resid="'+s+"|"+l+'">Highlight</button></td>'),n+="</tr>"):n+="<tr><td>"+s+"</td><td>"+l+'</td><td align="center">'+b+'</td><td align="center">'+g+'</td><td align="center">'+f+"</td></tr>",++r}}let c='<div style="text-align:center"><br><b>'+r+" residue pairs in "+(e?"the contacts":"sphere")+"</b>:</div><br>";if(r>0&&(e?(c+='<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Residue 1</th><th>Residue 2</th><th align="center">Num Contacts</th><th align="center">Min Distance(&#8491;)</th><th align="center">C-alpha Distance(&#8491;)</th>',"view"==t&&(c+='<th align="center">Highlight in 3D</th>'),c+="</tr>"):c+='<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Residue 1</th><th>Residue 2</th><th align="center">Num Contacts</th><th align="center">Min Distance(&#8491;)</th><th align="center">C-alpha Distance(&#8491;)</th></tr>',c+=n,c+="</table><br/>"),"graph"==t||"linegraph"==t||"scatterplot"==t||"calpha"==t||"cbeta"==t||"heavyatoms"==t){return i.getGraphCls.getGraphLinks(o,o,l.htmlCls.contactColor,s,l.htmlCls.contactValue)}return c}}class B{constructor(e){this.icn3d=e}showInteractions(e){let t=this.icn3d,s=t.icn3dui,i=$("#"+t.pre+"atomsCustomHbond").val(),l=$("#"+t.pre+"atomsCustomHbond2").val();if(0==l.length)alert("Please select the first set");else{t.definedSetsCls.setMode("selection");let n=$("#"+t.pre+"analysis_hbond")[0].checked,r=$("#"+t.pre+"analysis_saltbridge")[0].checked,o=$("#"+t.pre+"analysis_contact")[0].checked,a=$("#"+t.pre+"analysis_halogen")[0].checked,d=$("#"+t.pre+"analysis_pication")[0].checked,c=$("#"+t.pre+"analysis_pistacking")[0].checked,h="threshold "+$("#"+t.pre+"hbondthreshold").val()+" "+$("#"+t.pre+"saltbridgethreshold").val()+" "+$("#"+t.pre+"contactthreshold").val()+" "+$("#"+t.pre+"halogenthreshold").val()+" "+$("#"+t.pre+"picationthreshold").val()+" "+$("#"+t.pre+"pistackingthreshold").val(),m=t.viewInterPairsCls.viewInteractionPairs(l,i,t.bHbondCalc,e,n,r,o,a,d,c).interactionTypes,p=t.bHbondCalc?"true":"false",u=l+" "+i+" | "+m+" | "+p+" | "+h;if("3d"==e)s.htmlCls.clickMenuCls.setLogCmd("display interaction 3d | "+u,!0);else if("view"==e)s.htmlCls.clickMenuCls.setLogCmd("view interaction pairs | "+u,!0);else if("save1"==e)s.htmlCls.clickMenuCls.setLogCmd("save1 interaction pairs | "+u,!0);else if("save2"==e)s.htmlCls.clickMenuCls.setLogCmd("save2 interaction pairs | "+u,!0);else if("linegraph"==e)s.htmlCls.clickMenuCls.setLogCmd("line graph interaction pairs | "+u,!0);else if("scatterplot"==e)s.htmlCls.clickMenuCls.setLogCmd("scatterplot interaction pairs | "+u,!0);else if("graph"==e){let e=parseInt($("#"+t.pre+"dist_ss").val()),n=parseInt($("#"+t.pre+"dist_coil").val()),r=parseInt($("#"+t.pre+"dist_hbond").val()),o=parseInt($("#"+t.pre+"dist_inter").val()),a=parseInt($("#"+t.pre+"dist_ssbond").val()),d=parseInt($("#"+t.pre+"dist_ionic").val()),c=parseInt($("#"+t.pre+"dist_halogen").val()),u=parseInt($("#"+t.pre+"dist_pication").val()),C=parseInt($("#"+t.pre+"dist_pistacking").val());s.htmlCls.clickMenuCls.setLogCmd("graph interaction pairs | "+l+" "+i+" | "+m+" | "+p+" | "+h+" | "+e+" "+n+" "+r+" "+o+" "+a+" "+d+" "+c+" "+u+" "+C,!0)}t.bHbondCalc=!0}}showHbonds(e,t,s,i,l,n){let r,o,a,d,c=this.icn3d,h=c.icn3dui;if(i)return;l?(r="saltbridge",o="salt bridge "+e+" | sets "+t+" "+s+" | "+i):(r="hbonds",o="hbonds "+e+" | sets "+t+" "+s+" | "+i),c.opts[r]="yes",c.opts.water="dot",a=c.definedSetsCls.getAtomsFromNameArray(t),d=c.definedSetsCls.getAtomsFromNameArray(s);let m=c.firstAtomObjCls.getFirstAtomObj(a);if(Object.keys(d).length>0&&Object.keys(a).length>0){let t,s=c.hBondCls.calculateChemicalHbonds(h.hashUtilsCls.intHash2Atoms(c.dAtoms,d,c.atoms),h.hashUtilsCls.intHash2Atoms(c.dAtoms,a,c.atoms),parseFloat(e),l);l?(c.resid2ResidhashSaltbridge=h.hashUtilsCls.cloneHash(c.resid2Residhash),t="all atoms that have salt bridges with the selected atoms"):(c.resid2ResidhashHbond=h.hashUtilsCls.cloneHash(c.resid2Residhash),t="all atoms that are hydrogen-bonded with the selected atoms");let i={};for(let e in s){i[c.atoms[e].structure+"_"+c.atoms[e].chain+"_"+c.atoms[e].resi]=1}c.hAtoms={};for(let e in i)for(let t in c.residues[e])c.hAtoms[t]=1,c.atoms[t].style2="stick";let n=r+"_"+m.serial;c.selectionCls.addCustomSelection(Object.keys(i),n,t,o,!0),c.selectionCls.saveSelectionIfSelected(),c.drawCls.draw()}}showHydrogens(){let e=this.icn3d;if(void 0!==e.icn3dui.cfg.cid)for(let t in e.hAtoms){let s=e.atoms[t];if("H"!==s.elem.substr(0,1)){e.atoms[s.serial].bonds=e.atoms[s.serial].bonds2.concat(),e.atoms[s.serial].bondOrder=e.atoms[s.serial].bondOrder2.concat();for(let t=0,i=e.atoms[s.serial].bonds.length;t<i;++t){let i=e.atoms[s.serial].bonds[t];"H"===s.elem.substr(0,1)&&(e.dAtoms[i]=1,e.hAtoms[i]=1)}}}else for(let t in e.atoms)e.dAtoms[t]=1,e.hAtoms[t]=1}hideHydrogens(){let e=this.icn3d;e.icn3dui;for(let t in e.hAtoms){let s=e.atoms[t];if("H"===s.elem.substr(0,1)){if(e.atoms[s.serial].bonds.length>0){let t=e.atoms[s.serial].bonds[0],i=e.atoms[t].bonds?e.atoms[t].bonds.indexOf(s.serial):-1;-1!==i&&(e.atoms[t].bonds.splice(i,1),e.atoms[t].bondOrder&&e.atoms[t].bondOrder.splice(i,1))}delete e.dAtoms[s.serial],delete e.hAtoms[s.serial]}}}hideHbondsContacts(){let e=this.icn3d,t=e.icn3dui,s="set hbonds off";t.htmlCls.clickMenuCls.setLogCmd(s,!0),e.hBondCls.hideHbonds(),s="set salt bridge off",t.htmlCls.clickMenuCls.setLogCmd(s,!0),e.saltbridgeCls.hideSaltbridge(),s="set contact off",t.htmlCls.clickMenuCls.setLogCmd(s,!0),e.contactCls.hideContact(),s="set halogen pi off",t.htmlCls.clickMenuCls.setLogCmd(s,!0),e.piHalogenCls.hideHalogenPi()}showIonicInteractions(e,t,s,i,l,n){let r,o,a,d,c=this.icn3d,h=c.icn3dui;if(i)return;r="saltbridge",o="salt bridge "+e+" | sets "+t+" "+s+" | "+i,c.opts.saltbridge="yes",a=c.definedSetsCls.getAtomsFromNameArray(t),d=c.definedSetsCls.getAtomsFromNameArray(s);let m=c.firstAtomObjCls.getFirstAtomObj(a);if(Object.keys(d).length>0&&Object.keys(a).length>0){let t,s=c.saltbridgeCls.calculateIonicInteractions(h.hashUtilsCls.intHash2Atoms(c.dAtoms,d,c.atoms),h.hashUtilsCls.intHash2Atoms(c.dAtoms,a,c.atoms),parseFloat(e),l);c.resid2ResidhashSaltbridge=h.hashUtilsCls.cloneHash(c.resid2Residhash),t="all atoms that have ionic interactions with the selected atoms";let i={};for(let e in s){i[c.atoms[e].structure+"_"+c.atoms[e].chain+"_"+c.atoms[e].resi]=1}c.hAtoms={};for(let e in i)for(let t in c.residues[e])c.hAtoms[t]=1,c.atoms[t].style2="stick",c.ions.hasOwnProperty(t)&&(c.atoms[t].style2="sphere");let n="saltbridge_"+m.serial;c.selectionCls.addCustomSelection(Object.keys(i),n,t,o,!0),c.selectionCls.saveSelectionIfSelected(),c.drawCls.draw()}}showHalogenPi(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui;if(i)return;let a,d,c=n+" "+e+" | sets "+t+" "+s+" | "+i;r.opts[n]="yes",a=r.definedSetsCls.getAtomsFromNameArray(t),d=r.definedSetsCls.getAtomsFromNameArray(s);let h=r.firstAtomObjCls.getFirstAtomObj(a);if(Object.keys(d).length>0&&Object.keys(a).length>0){let t,s=r.piHalogenCls.calculateHalogenPiInteractions(o.hashUtilsCls.intHash2Atoms(r.dAtoms,a,r.atoms),o.hashUtilsCls.intHash2Atoms(r.dAtoms,d,r.atoms),parseFloat(e),l,n);"halogen"==n?(r.resid2ResidhashHalogen=o.hashUtilsCls.cloneHash(r.resid2Residhash),t="all atoms that have halogen bonds with the selected atoms"):"pi-cation"==n?(r.resid2ResidhashPication=o.hashUtilsCls.cloneHash(r.resid2Residhash),t="all atoms that have pi-cation interactions with the selected atoms"):"pi-stacking"==n&&(r.resid2ResidhashPistacking=o.hashUtilsCls.cloneHash(r.resid2Residhash),t="all atoms that have pi-stacking with the selected atoms");let i={};for(let e in s){i[r.atoms[e].structure+"_"+r.atoms[e].chain+"_"+r.atoms[e].resi]=1}r.hAtoms={};for(let e in i)for(let t in r.residues[e])r.hAtoms[t]=1,r.atoms[t].style2="stick",r.ions.hasOwnProperty(t)&&(r.atoms[t].style2="sphere");let m=n+"_"+h.serial;r.selectionCls.addCustomSelection(Object.keys(i),m,t,c,!0),r.selectionCls.saveSelectionIfSelected(),r.drawCls.draw()}}showClbonds(){let e=this.icn3d,t=e.icn3dui;e.opts.clbonds="yes";let s=e.applyClbondsCls.applyClbondsOptions();for(let i in s)e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[i]);if(Object.keys(s).length>0){let t="clbonds",i="all atoms that have cross-linkages";e.selectionCls.addCustomSelection(Object.keys(s),t,i,"cross linkage",!0),e.selectionCls.saveSelectionIfSelected(),e.drawCls.draw()}}showSsbonds(){let e=this.icn3d,t=e.icn3dui;e.opts.ssbonds="yes";let s={},i=Object.keys(e.structures);for(let l=0,n=i.length;l<n;++l){let n=i[l];if(void 0!==e.ssbondpnts[n])for(let i=0,l=Math.floor(e.ssbondpnts[n].length/2);i<l;i++){let l=e.ssbondpnts[n][2*i],r=e.ssbondpnts[n][2*i+1];s[l]=1,s[r]=1,e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[l]),e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[r])}}if(Object.keys(s).length>0){let t="ssbonds",i="all atoms that have disulfide bonds";e.selectionCls.addCustomSelection(Object.keys(s),t,i,"disulfide bonds",!0),e.selectionCls.saveSelectionIfSelected(),e.drawCls.draw()}}pickCustomSphere(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui;if(i)return;let a,d,c="select zone cutoff "+e+" | sets "+t+" "+s+" | "+i;l&&(c="interactions "+e+" | sets "+t+" "+s+" | "+i,r.opts.contact="yes"),a=r.definedSetsCls.getAtomsFromNameArray(t),d=r.definedSetsCls.getAtomsFromNameArray(s);let h,m,p=this.pickCustomSphere_base(e,a,d,i,l,n,c,!0),u=Object.keys(p.residues);r.hAtoms={};for(let e=0,t=u.length;e<t;++e){let t=u[e];for(let e in r.residues[t])r.hAtoms[e]=1}let C=r.firstAtomObjCls.getFirstAtomObj(a);void 0!==C&&(h="sphere."+C.chain+":"+o.utilsCls.residueName2Abbr(C.resn.substr(0,3)).trim()+C.resi+"-"+e+"A",l&&(h="interactions."+C.chain+":"+o.utilsCls.residueName2Abbr(C.resn.substr(0,3)).trim()+C.resi+"-"+$("#"+r.pre+"contactthreshold").val()+"A"),m=h,r.selectionCls.addCustomSelection(u,h,m,c,!0)),r.selectionCls.saveSelectionIfSelected(),r.drawCls.draw()}pickCustomSphere_base(e,t,s,i,l,n,r,o,a){let d,c=this.icn3d,h=c.icn3dui;l?(d=c.contactCls.getAtomsWithinAtom(h.hashUtilsCls.intHash2Atoms(c.dAtoms,s,c.atoms),h.hashUtilsCls.intHash2Atoms(c.dAtoms,t,c.atoms),parseFloat(e),o,l,void 0,a),c.resid2ResidhashInteractions=h.hashUtilsCls.cloneHash(c.resid2Residhash)):(d=c.contactCls.getAtomsWithinAtom(s,t,parseFloat(e),o,l),c.resid2ResidhashSphere=h.hashUtilsCls.cloneHash(c.resid2Residhash));let m={};for(let e in d){let t=d[e];c.bOpm&&"DUM"===t.resn||(m[t.structure+"_"+t.chain+"_"+t.resi]=1)}return{residues:m,resid2Residhash:c.resid2Residhash}}}class j{constructor(e){this.icn3d=e}colorSpectrum(e){let t=this.icn3d,s=t.icn3dui,i=0,l=0;e=s.hashUtilsCls.intHash(e,t.hAtoms);for(let s in e){t.atoms[s].het||++l}let n=l>1?1/(l-1):1;for(let l in e){let e=t.atoms[l];e.color=e.het?s.parasCls.atomColors[e.elem]||s.parasCls.defaultAtomColor:s.parasCls.thr().setHSL(3/4*(1-i++*n),1,.45),t.atomPrevColors[l]=e.color}}colorRainbow(e){let t=this.icn3d,s=t.icn3dui,i=0,l=0;e=s.hashUtilsCls.intHash(e,t.hAtoms);for(let s in e){t.atoms[s].het||++l}let n=l>1?1/(l-1):1;for(let l in e){let e=t.atoms[l];e.color=e.het?s.parasCls.atomColors[e.elem]||s.parasCls.defaultAtomColor:s.parasCls.thr().setHSL(3/4*i++*n,1,.45),t.atomPrevColors[l]=e.color}}setColorBySets(e,t){let s=this.icn3d,i=s.icn3dui,l=0,n=e.length,r=n>1?1/(n-1):1;for(let n=0,o=e.length;n<o;++n){let o=s.definedSetsCls.getAtomsFromNameArray([e[n]]);for(let e in o){let n=s.atoms[e];n.color=t?i.parasCls.thr().setHSL(3/4*(1-l*r),1,.45):i.parasCls.thr().setHSL(3/4*l*r,1,.45),s.atomPrevColors[e]=n.color}++l}s.drawCls.draw()}setColorByOptions(e,t,s){let i=this.icn3d,l=i.icn3dui;if(void 0!==e)if(s)for(let e in t){let t=i.atoms[e];i.atomPrevColors[e]=t.color}else if(0===e.color.indexOf("#"))for(let s in t){let t=i.atoms[s];t.color=l.parasCls.thr().setStyle(e.color.toLowerCase()),i.atomPrevColors[s]=t.color}else{let s,n,r,o,a;switch("confidence"==e.color.toLowerCase()?$("#"+l.pre+"legend").show():$("#"+l.pre+"legend").hide(),e.color.toLowerCase()){case"rainbow":this.colorRainbow(t);break;case"rainbow for chains":for(let e in i.chains)this.colorRainbow(i.chains[e]);break;case"spectrum":this.colorSpectrum(t);break;case"spectrum for chains":for(let e in i.chains)this.colorSpectrum(i.chains[e]);break;case"structure":let d=-1,c="",h=l.parasCls.stdChainColors.length;for(let e in t){let t=i.atoms[e];t.structure!=c&&(++d,d%=h),t.het?(t.color=l.parasCls.atomColors[t.elem],i.atomPrevColors[e]=t.color):(t.color=l.parasCls.stdChainColors[d],i.atomPrevColors[e]=t.color),c=t.structure}break;case"chain":if(void 0!==i.chainsColor&&Object.keys(i.chainsColor).length>0)this.setMmdbChainColor();else{let e=-1,s="",n=l.parasCls.stdChainColors.length;for(let r in t){let t=i.atoms[r];t.chain!=s&&(++e,e%=n),t.het?(t.color=l.parasCls.atomColors[t.elem],i.atomPrevColors[r]=t.color):(t.color=l.parasCls.stdChainColors[e],Object.keys(i.chainsColor).length>0&&this.updateChainsColor(t),i.atomPrevColors[r]=t.color),s=t.chain}}break;case"domain":s=0,n=0;let m=Object.keys(i.tddomains);n=m.length,r=n>1?1/(n-1):1;for(let e=0,t=m.length;e<t;++e){let t=l.parasCls.thr().setHSL(3/4*(1-s++*r),1,.45);for(let s in i.tddomains[m[e]])for(let e in i.residues[s]){let s=i.atoms[e];s.color=t,i.atomPrevColors[e]=s.color}}break;case"defined sets":if(s=0,i.nameArray&&0!=i.nameArray.length){n=i.nameArray.length,r=n>1?1/(n-1):1;for(let e=0;e<n;++e){let t=i.nameArray[e],n=i.definedSetsCls.getAtomsFromNameArray([t]),o=l.parasCls.thr().setHSL(3/4*s++*r,1,.45);for(let e in n){let t=i.atoms[e];t.color=o,i.atomPrevColors[e]=t.color}}}else alert('Please first select sets in "Analysis > Defined Sets", and try it again.');break;case"secondary structure green":i.sheetcolor="green";for(let e in t){let t=i.atoms[e];t.color=t.het?l.parasCls.atomColors[t.elem]||l.parasCls.defaultAtomColor:l.parasCls.ssColors[t.ss]||l.parasCls.thr(16711935),i.atomPrevColors[e]=t.color}break;case"secondary structure yellow":case"secondary structure":i.sheetcolor="yellow";for(let e in t){let t=i.atoms[e];t.color=t.het?l.parasCls.atomColors[t.elem]||l.parasCls.defaultAtomColor:l.parasCls.ssColors2[t.ss]||l.parasCls.thr(16711935),i.atomPrevColors[e]=t.color}break;case"secondary structure spectrum":s=0,n=0;let p,u,C=[],g=-9999;for(let e in t){if(!i.proteins.hasOwnProperty(e))continue;let t=i.atoms[e];-9999==g&&(p=parseInt(e)),-9999!=g&&(t.ss!=u.ss||Math.abs(t.resi-u.resi)>1||t.ssbegin&&u.ssend)&&("coil"==u.ss||C.push([p,g]),p=e),g=parseInt(e),u=t}"coil"==u.ss||C.push([p,g]),n=C.length,r=n>1?1/(n-1):1;for(let e=0,t=C.length;e<t;++e){let t=l.parasCls.thr().setHSL(3/4*(1-s++*r),1,.45);for(let s=C[e][0];s<=C[e][1];++s){let e=i.atoms[s];e.color=t,i.atomPrevColors[s]=e.color}}break;case"residue":for(let e in t){let t=i.atoms[e];t.color=t.het?l.parasCls.atomColors[t.elem]||l.parasCls.defaultAtomColor:l.parasCls.residueColors[t.resn]||l.parasCls.defaultResidueColor,i.atomPrevColors[e]=t.color}break;case"residue custom":for(let e in t){let t=i.atoms[e];t.color=t.het?l.parasCls.atomColors[t.elem]||l.parasCls.defaultAtomColor:i.customResidueColors[t.resn]||l.parasCls.defaultResidueColor,i.atomPrevColors[e]=t.color}break;case"align custom":i.middB=50,i.spanBinv1=.02,i.spanBinv2=.02;for(let e in t){let t,s=i.atoms[e].structure+"_"+i.atoms[e].chain;if(void 0===i.queryresi2score||!i.queryresi2score.hasOwnProperty(s))continue;let n=i.atoms[e].resi;if(i.queryresi2score[s].hasOwnProperty(n)){let e=i.queryresi2score[s][n];e>100&&(e=100);let r=(i.middB-e)*i.spanBinv1,o=(e-i.middB)*i.spanBinv2;e<i.middB?"blue"==i.startColor?t="white"==i.midColor?l.parasCls.thr().setRGB(1-r,1-r,1):l.parasCls.thr().setRGB(0,0,r):"red"==i.startColor?t="white"==i.midColor?l.parasCls.thr().setRGB(1,1-r,1-r):l.parasCls.thr().setRGB(r,0,0):"green"==i.startColor&&(t="white"==i.midColor?l.parasCls.thr().setRGB(1-r,1,1-r):l.parasCls.thr().setRGB(0,r,0)):"red"==i.endColor?t="white"==i.midColor?l.parasCls.thr().setRGB(1,1-o,1-o):l.parasCls.thr().setRGB(o,0,0):"green"==i.endColor?t="white"==i.midColor?l.parasCls.thr().setRGB(1-o,1,1-o):l.parasCls.thr().setRGB(0,o,0):"blue"==i.endColor&&(t="white"==i.midColor?l.parasCls.thr().setRGB(1-o,1-o,1):l.parasCls.thr().setRGB(0,0,o))}else t=l.parasCls.defaultAtomColor;i.atoms[e].color=t,i.atomPrevColors[e]=t}break;case"charge":for(let e in t){let t=i.atoms[e];t.color=t.het?l.parasCls.defaultAtomColor:l.parasCls.chargeColors[t.resn]||l.parasCls.defaultResidueColor,i.atomPrevColors[e]=t.color}break;case"hydrophobic":for(let e in t){let t=i.atoms[e];t.color=t.het?l.parasCls.defaultAtomColor:l.parasCls.hydrophobicColors[t.resn]||l.parasCls.defaultResidueColor,i.atomPrevColors[e]=t.color}break;case"normalized hydrophobic":for(let e in t){let t=i.atoms[e];t.color=t.het?l.parasCls.defaultAtomColor:l.parasCls.normalizedHPColors[t.resn]||l.parasCls.defaultResidueColor,i.atomPrevColors[e]=t.color}break;case"atom":for(let e in t){let t=i.atoms[e];t.color=l.parasCls.atomColors[t.elem]||l.parasCls.defaultAtomColor,i.atomPrevColors[e]=t.color}break;case"confidence":for(let e in t){let t=i.atoms[e];if(void 0===t.b||0==parseInt(1e3*t.b))t.color=l.parasCls.thr().setRGB(0,1,0);else{let e=t.b;e>=90?t.color=l.parasCls.thr().setRGB(0,.325,.839):e>=70&&e<90?t.color=l.parasCls.thr().setRGB(.396,.572,.953):e>=50&&e<70?t.color=l.parasCls.thr().setRGB(1,.859,.075):e<50&&(t.color=l.parasCls.thr().setRGB(1,.49,.271))}i.atomPrevColors[e]=t.color}let f=l.htmlCls.clickMenuCls.setLegendHtml(!0);$("#"+l.pre+"dl_legend").html(f),l.htmlCls.dialogCls.openDlg("dl_legend","Color legend");break;case"b factor":i.middB=50,i.spanBinv1=.02,i.spanBinv2=.02;for(let e in t){let t=i.atoms[e];if(void 0===t.b||0==parseInt(1e3*t.b))t.color=l.parasCls.thr().setRGB(0,1,0);else{let e=t.b;e>100&&(e=100);let s=(i.middB-e)*i.spanBinv1,n=(e-i.middB)*i.spanBinv2;t.color=e<i.middB?l.parasCls.thr().setRGB(1-s,1-s,1):l.parasCls.thr().setRGB(1,1-n,1-n)}i.bOpm&&"DUM"==t.resn&&(t.color=l.parasCls.atomColors[t.elem]),i.atomPrevColors[e]=t.color}break;case"b factor percentile":if(o=1e3,a=-1e3,!i.bfactorArray){i.bfactorArray=[];for(let e in i.atoms){let t=i.atoms[e];o>t.b&&(o=t.b),a<t.b&&(a=t.b),i.bfactorArray.push(t.b)}i.bfactorArray.sort((function(e,t){return e-t}))}let b=i.bfactorArray.length;for(let e in t){let t=i.atoms[e];if(void 0===t.b||0==parseInt(1e3*t.b)||0==i.bfactorArray.length)t.color=l.parasCls.thr().setRGB(0,1,0);else{let e=i.bfactorArray.indexOf(t.b)/b;t.color=e<.5?l.parasCls.thr().setRGB(2*e,2*e,1):l.parasCls.thr().setRGB(1,2*(1-e),2*(1-e))}i.atomPrevColors[e]=t.color}break;case"area":if(void 0===i.resid2area){let e=l.hashUtilsCls.cloneHash(i.hAtoms);i.hAtoms=l.hashUtilsCls.cloneHash(i.atoms),i.bCalcArea=!0,i.opts.surface="solvent accessible surface",i.applyMapCls.applySurfaceOptions(),i.bCalcArea=!1,i.hAtoms=l.hashUtilsCls.cloneHash(e)}let y=void 0!==i.midpercent?i.midpercent:35;i.spanBinv1=.02,i.spanBinv2=.02;for(let e in t){let t=i.atoms[e],s=t.structure+"_"+t.chain+"_"+t.resi+"_"+t.resn,n=l.parasCls.residueArea.hasOwnProperty(t.resn)?i.resid2area[s]/l.parasCls.residueArea[t.resn]*100:y;n>100&&(n=100);let r=(y-n)*i.spanBinv1,o=(n-y)*i.spanBinv2;t.color=n<y?l.parasCls.thr().setRGB(1-r,1-r,1):l.parasCls.thr().setRGB(1,1-o,1-o),i.bOpm&&"DUM"==t.resn&&(t.color=l.parasCls.atomColors[t.elem]),i.atomPrevColors[e]=t.color}break;case"identity":case"conserved":this.setConservationColor(t,!0);break;case"conservation":this.setConservationColor(t,!1);break;case"white":this.setAtmClr(t,16777215);break;case"grey":this.setAtmClr(t,8947848);break;case"red":this.setAtmClr(t,16711680);break;case"green":this.setAtmClr(t,65280);break;case"blue":this.setAtmClr(t,255);break;case"magenta":this.setAtmClr(t,16711935);break;case"yellow":this.setAtmClr(t,16776960);break;case"cyan":this.setAtmClr(t,65535);break;case"custom":break;default:for(let s in t){let t=i.atoms[s];t.color=l.parasCls.thr().setStyle("#"+e.color.toLowerCase()),i.atomPrevColors[s]=t.color}}}}setAtmClr(e,t){let s=this.icn3d,i=s.icn3dui;for(let l in e){let e=s.atoms[l];e.color=i.parasCls.thr().setHex(t),s.atomPrevColors[l]=e.color}}updateChainsColor(e){let t=this.icn3d;t.icn3dui;let s=e.structure+"_"+e.chain;void 0!==t.chainsColor[s]&&(t.chainsColor[s]=e.color)}setMmdbChainColor(e){let t,s=this.icn3d,i=s.icn3dui,l=void 0===e?s.hAtoms:e;this.applyOriginalColor(i.hashUtilsCls.hash2Atoms(l,s.atoms)),t=i.hashUtilsCls.unionHash(t,s.chemicals),t=i.hashUtilsCls.unionHash(t,s.ions);for(let e in t){let t=s.atoms[e];t.color=i.parasCls.atomColors[t.elem]||i.parasCls.defaultAtomColor,s.atomPrevColors[e]=t.color}}setConservationColor(e,t){let s=this.icn3d,i=s.icn3dui;this.setMmdbChainColor(e);for(let l in s.alnChainsSeq){let n=s.alnChainsSeq[l];for(let r=0,o=n.length;r<o;++r){let o=l+"_"+n[r].resi;for(let l in s.residues[o])if(e.hasOwnProperty(l)){let e=t?i.parasCls.thr(n[r].color):i.parasCls.thr(n[r].color2);s.atoms[l].color=e,s.atomPrevColors[l]=e}}}}applyOriginalColor(e){let t=this.icn3d,s=t.icn3dui;void 0===e&&(e=t.atoms);for(let i in e){let l=e[i],n=l.structure+"_"+l.chain;t.chainsColor.hasOwnProperty(n)?l.color=t.chainsColor[n]:l.color=s.parasCls.atomColors[l.elem],t.atomPrevColors[i]=l.color}}applyPrevColor(){let e=this.icn3d;e.icn3dui;for(let t in e.atoms){e.atoms[t].color=e.atomPrevColors[t]}}setOutlineColor(e){this.icn3d.icn3dui;let t={outline:{vertex_shader:["uniform float offset;","void main() {","vec4 pos = modelViewMatrix * vec4( position + normal * offset, 1.0 );","gl_Position = projectionMatrix * pos;","}"].join("\n"),fragment_shader:["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n")}};"yellow"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"green"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 0.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"red"===e&&(t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","}"].join("\n"));let s=t.outline;return new THREE.ShaderMaterial({uniforms:{offset:{type:"f",value:.5}},vertexShader:s.vertex_shader,fragmentShader:s.fragment_shader,depthTest:!1,depthWrite:!1})}}class z{constructor(e){this.icn3d=e}buildAxes(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui;if(o.bNode)return;new THREE.Object3D;let a=0,d=0,c=0;n?(a=t.x,d=t.y,c=t.z):(a-=.3*e,d-=.3*e);let h,m,p,u,C,g,f,b,y,v=new THREE.Vector3(a,d,c),_=e/10,S=e/100;u=C=g=_,n&&(h=s.clone().sub(t),m=i.clone().sub(t),p=l.clone().sub(t),u=h.length(),C=m.length(),g=p.length(),S=u/100,S<.4&&(S=.4)),n?(f=r.cylinderCls.createCylinder_base(t,s,S,o.parasCls.thr(16711680)),b=r.cylinderCls.createCylinder_base(t,i,S,o.parasCls.thr(65280)),y=r.cylinderCls.createCylinder_base(t,l,S,o.parasCls.thr(255))):(f=r.cylinderCls.createCylinder_base(new THREE.Vector3(a,d,c),new THREE.Vector3(a+u,d,c),S,o.parasCls.thr(16711680)),b=r.cylinderCls.createCylinder_base(new THREE.Vector3(a,d,c),new THREE.Vector3(a,d+C,c),S,o.parasCls.thr(65280)),y=r.cylinderCls.createCylinder_base(new THREE.Vector3(a,d,c),new THREE.Vector3(a,d,c+g),S,o.parasCls.thr(255))),r.mdl.add(f),r.mdl.add(b),r.mdl.add(y);let w=n?h.normalize():new THREE.Vector3(1,0,0),A=n?s:new THREE.Vector3(v.x+_,v.y,v.z),x=this.createArrow(w,A,u,16711680,4*S,4*S);r.mdl.add(x);let k=n?m.normalize():new THREE.Vector3(0,1,0),O=n?i:new THREE.Vector3(v.x,v.y+_,v.z),H=this.createArrow(k,O,C,65280,4*S,4*S);r.mdl.add(H);let D=n?p.normalize():new THREE.Vector3(0,0,1),R=n?l:new THREE.Vector3(v.x,v.y,v.z+_),I=this.createArrow(D,R,g,255,4*S,4*S);r.mdl.add(I)}buildAllAxes(e,t){let s=this.icn3d;if(!s.icn3dui.bNode&&s.pc1)for(let i=0,l=s.axes.length;i<l;++i){let l=s.axes[i][0],n=s.axes[i][1],r=s.axes[i][2],o=s.axes[i][3];this.buildAxes(e,l,n,r,o,t)}}createArrow(e,t,s,i,l,n,r){let o=this.icn3d;if(o.icn3dui.bNode)return;let a,d=new THREE.CylinderBufferGeometry(0,.5,1,32,1);d.translate(0,.5,0),a=r?new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:o.frac,shininess:o.shininess,emissive:o.emissive,color:i}):new THREE.MeshPhongMaterial({specular:o.frac,shininess:o.shininess,emissive:o.emissive,side:THREE.DoubleSide,color:i});let c=new THREE.Mesh(d,a),h=new THREE.Quaternion;if(e.y>.99999)h.set(0,0,0,1);else if(e.y<-.99999)h.set(1,0,0,0);else{let t=new THREE.Vector3;t.set(e.z,0,-e.x).normalize();let s=Math.acos(e.y);h.setFromAxisAngle(t,s)}return c.applyQuaternion(h),c.scale.set(n,l,n),c.position.copy(t),c}setPc1Axes(){let e=this.icn3d,t=e.icn3dui;if(t.bNode)return;let s=t.hashUtilsCls.intHash(e.hAtoms,e.dAtoms),i=[],l=Object.keys(s).length<100;for(let t in s){let s=e.atoms[t],n=s.structure+"_"+s.chain+"_"+s.resi;(l||""!=n)&&i.push(s.coord.clone())}let n=t.rmsdSuprCls.getEigenForSelection(i,i.length),r=new THREE.Vector3(n.h1[0],n.h1[1],n.h1[2]);if(0==n.k&&e.bRender)return void alert("Can't determine the first principal component. Please select a subset and try it again.");let o=e.applyCenterCls.centerAtoms(s),a=o.maxD,d=o.center,c=d.clone().add(r.normalize().multiplyScalar(.4*a)),h=new THREE.Vector3(n.h2[0],n.h2[1],n.h2[2]),m=d.clone().add(h.normalize().multiplyScalar(.3*a)),p=new THREE.Vector3(n.h3[0],n.h3[1],n.h3[2]),u=d.clone().add(p.normalize().multiplyScalar(.3*a));this.buildAxes(void 0,d,c,m,u,!0);let C=[d,c,m,u];return e.axes.push(C),e.drawCls.draw(),C}}class G{constructor(e){this.icn3d=e}addResidueLabels(e,t,s,i){let l=this.icn3d,n=l.icn3dui;if(n.bNode)return;let r=n.hashUtilsCls.intHash(l.hAtoms,e);t?void 0===l.labels.schematic&&(l.labels.schematic=[]):void 0===l.labels.residue&&(l.labels.residue=[]);let o="";for(let e in r){let s=l.atoms[e],r={},a=s.structure+"_"+s.chain+"_"+s.resi;if(!s.het&&("CA"===s.name||"O3'"===s.name||"O3*"===s.name)||l.water.hasOwnProperty(s.serial)||l.ions.hasOwnProperty(s.serial)||l.chemicals.hasOwnProperty(s.serial)&&a!==o){r.position=s.coord,r.bSchematic=0,t&&(r.bSchematic=1),r.text=n.utilsCls.residueName2Abbr(s.resn),i&&(r.text+=s.resi),r.size=18,r.factor=.3;let e=s.color.getHexString().toUpperCase();r.color=i?"black"!=l.opts.background?l.colorWhitebkgd:l.colorBlackbkgd:"CCCCCC"===e||"C8C8C8"===e?"#888888":"#"+e,r.background="#FFFFFF",t?l.labels.schematic.push(r):l.labels.residue.push(r)}o=a}l.hlObjectsCls.removeHlObjects()}addNonCarbonAtomLabels(e){let t=this.icn3d,s=t.icn3dui;if(s.bNode)return;let i=s.hashUtilsCls.intHash(t.hAtoms,e);void 0===t.labels.schematic&&(t.labels.schematic=[]);for(let e in i){let s=t.atoms[e];if(!t.residues.hasOwnProperty(s.structure+"_"+s.chain+"_"+s.resi))continue;if("C"===s.elem)continue;let i={};i.position=s.coord,i.bSchematic=1,i.text=s.elem,i.size=18,i.color="black"!=t.opts.background?t.colorWhitebkgd:s.color.getHexString(),i.background="#FFFFFF",t.labels.schematic.push(i)}t.hlObjectsCls.removeHlObjects()}addAtomLabels(e,t){let s=this.icn3d,i=s.icn3dui;if(i.bNode)return;let l=i.hashUtilsCls.intHash(s.hAtoms,e);l=i.hashUtilsCls.intHash(s.dAtoms,l),void 0===s.labels.residue&&(s.labels.residue=[]);for(let e in l){let i=s.atoms[e],l={};l.position=i.coord,l.bSchematic=0,l.text=t?i.elem:i.name.padEnd(2," "),l.size=18,t&&(l.bSchematic=!0);let n=i.color.getHexString().toUpperCase();l.color="black"!=s.opts.background?s.colorWhitebkgd:s.colorBlackbkgd,t&&(l.color="CCCCCC"===n||"C8C8C8"===n?"#888888":"#"+n),l.background="#FFFFFF",s.labels.residue.push(l)}s.hlObjectsCls.removeHlObjects()}}class V{constructor(e){this.icn3d=e}CalcPhiUrl(e,t,s,i,l){let n=this.icn3d;n.icn3dui;let r=this,o=new XMLHttpRequest;o.open("GET",l,!0),o.responseType="text",o.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){let l=o.response;r.CalcPhi(e,t,s,i,l)}else alert("The PQR file is unavailable...");else n.ParserUtilsCls.showLoading()},o.send()}getPdbStr(e){let t=this.icn3d,s=t.icn3dui,i={},l={},n=s.hashUtilsCls.intHash(t.dAtoms,t.hAtoms);for(let e in n)t.atoms[e],t.ions.hasOwnProperty(e)?i[e]=1:l[e]=1;let r=Object.keys(l).length;if(s.utilsCls.isCalphaPhosOnly(s.hashUtilsCls.hash2Atoms(l,t.atoms)))return void(e?console.log("The potential will not be shown because the side chains are missing in the structure..."):alert("The potential will not be shown because the side chains are missing in the structure..."));if(r>3e4)return void(e?console.log("The maximum number of allowed atoms is 30,000. Please try it again with selected chains..."):alert("The maximum number of allowed atoms is 30,000. Please try it again with selected chains..."));let o="";return o+=s.cfg.cid?t.saveFileCls.getAtomPDB(l,!0):t.saveFileCls.getAtomPDB(l),o+=t.saveFileCls.getAtomPDB(i,!0,void 0,!0),o}CalcPhi(e,t,s,i,l){let n=this.icn3d,r=n.icn3dui,o=this;n.loadPhiFrom="delphi";let a=r.cfg.cid?r.cfg.cid:Object.keys(n.structures).toString(),d={};if(l)d={pqr2phi:l,gsize:e,salt:t,pdbid:a};else{d={pdb2phi:this.getPdbStr(),gsize:e,salt:t,pdbid:a}}$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/delphi/delphi.cgi",type:"POST",data:d,dataType:"binary",responseType:"arraybuffer",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){n.ParserUtilsCls.showLoading()},complete:function(){n.ParserUtilsCls.hideLoading()},success:function(e){o.loadPhiData(e,s,i),n.bAjaxPhi=!0,i?n.setOptionCls.setOption("phisurface","phi"):n.setOptionCls.setOption("phimap","phi"),void 0!==n.deferredDelphi&&n.deferredDelphi.resolve(),void 0!==n.deferredPhi&&n.deferredPhi.resolve()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}PhiParser(e,t,s,i){let l=this.icn3d;l.icn3dui;let n=this,r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="phiurl"==t||"phiurl2"==t?"arraybuffer":"text",r.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){let e=r.response;"phiurl"==t||"phiurl2"==t?n.loadPhiData(e,s,i):n.loadCubeData(e,s,i),l.bAjaxPhi=!0,i?l.setOptionCls.setOption("phisurface","phi"):l.setOptionCls.setOption("phimap","phi")}else alert("The potential file is unavailable...");void 0!==l.deferredPhi&&l.deferredPhi.resolve()}else l.ParserUtilsCls.showLoading()},r.send()}loadPhiData(e,t,s){let i=this.icn3d;i.icn3dui;let l={filetype:"phi"},n=e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e,r=new Float32Array(n.slice(n.byteLength-24,n.byteLength-8));l.scale=r[0];let o=r[1],a=r[2],d=r[3];l.n=new Int32Array(n.slice(n.byteLength-8,n.byteLength-4)),l.xExtent=l.yExtent=l.zExtent=l.n;let c=1/l.scale*((l.n-1)/2);l.ori=new THREE.Vector3(o-c,a-c,d-c);let h=new Float32Array(n.slice(110,n.byteLength-56));l.bSurface=s,i.mapData.headerPhi=l,i.mapData.dataPhi=h,i.mapData.contourPhi=t;let m=new THREE.Matrix4;m.identity(),m.multiply((new THREE.Matrix4).makeTranslation(l.ori.x,l.ori.y,l.ori.z)),i.mapData.matrixPhi=m}loadCubeData(e,t,s){let i=this.icn3d;i.icn3dui;let l={filetype:"cube"},n=e.split("\n"),r=[];r.push(parseFloat(n[0].substr(0,10))),r.push(parseFloat(n[0].substr(10,6))),r.push(parseFloat(n[0].substr(16,10))),r.push(parseFloat(n[0].substr(26,10))),r.push(parseFloat(n[0].substr(36,10))),l.scale=r[0];let o=r[2],a=r[3],d=r[4];l.n=r[1],l.xExtent=l.yExtent=l.zExtent=l.n;let c=1/l.scale*((l.n-1)/2);l.ori=new THREE.Vector3(o-c,a-c,d-c);let h=[];for(let e=7,t=n.length;e<t;++e){let t=n[e].split(/\s+/);for(let e=0,s=t.length;e<s;++e){let s=parseFloat(t[e]);isNaN(s)||h.push(s)}}h.length!=l.n*l.n*l.n&&console.log("the data array size "+h.length+" didn't match the grid size "+l.n*l.n*l.n+"..."),l.bSurface=s,i.mapData.headerPhi=l,i.mapData.dataPhi=h,i.mapData.contourPhi=t;let m=new THREE.Matrix4;m.identity(),m.multiply((new THREE.Matrix4).makeTranslation(l.ori.x,l.ori.y,l.ori.z)),i.mapData.matrixPhi=m}applyCommandPhi(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredPhi=$.Deferred((function(){let t=s.icn3d,i=e.split(" | "),l=i[0].split(" "),n=i[1].split(" "),r=i[2].split(" "),o=i[3].split(" "),a=i[4].split(" "),d=l[2],c=parseFloat(n[1]),h=r[1],m=o[1],p=a[1];if(8==i.length){let e=i[5].split(" "),s=i[6].split(" "),l=i[7].split(" ");t.phisurftype=e[1],t.phisurfop=parseFloat(s[1]),t.phisurfwf=l[1],$("#"+t.pre+"delphisurftype").val(t.phisurftype),$("#"+t.pre+"delphisurfop").val(t.phisurfop),$("#"+t.pre+"delphisurfwf").val(t.phisurfwf)}let u="pqrurl2"==d||"phiurl2"==d||"cubeurl2"==d;"pqrurl"==d||"pqrurl2"==d?s.CalcPhiUrl(m,p,c,u,h):s.PhiParser(h,d,c,u)})),t.deferredPhi.promise()}applyCommandDelphi(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredDelphi=$.Deferred((function(){let t=s.icn3d,i=e.split(" | "),l=i[0].split(" "),n=i[1].split(" "),r=i[2].split(" "),o=i[3].split(" "),a=l[2],d=n[1],c=r[1],h=o[1];if($("#"+t.pre+"delphigsize").val(c),$("#"+t.pre+"delphisalt").val(h),7==i.length){let e=i[4].split(" "),s=i[5].split(" "),l=i[6].split(" ");t.phisurftype=e[1],t.phisurfop=s[1],t.phisurfwf=l[1],$("#"+t.pre+"delphisurftype").val(t.phisurftype),$("#"+t.pre+"delphisurfop").val(t.phisurfop),$("#"+t.pre+"delphisurfwf").val(t.phisurfwf)}let m="surface"==a;s.CalcPhi(c,h,d,m)})),t.deferredDelphi.promise()}loadDelphiFile(e){let t=this.icn3d,s=t.icn3dui,i=$("#"+t.pre+"delphigsize").val(),l=$("#"+t.pre+"delphisalt").val(),n="delphi2"==e?$("#"+t.pre+"delphicontour2").val():$("#"+t.pre+"delphicontour").val(),r="delphi2"==e;this.CalcPhi(i,l,n,r);let o="delphi2"==e?"surface":"map";r?s.htmlCls.clickMenuCls.setLogCmd("set delphi "+o+" | contour "+n+" | gsize "+i+" | salt "+l+" | surface "+t.phisurftype+" | opacity "+t.phisurfop+" | wireframe "+t.phisurfwf,!0):s.htmlCls.clickMenuCls.setLogCmd("set delphi "+o+" | contour "+n+" | gsize "+i+" | salt "+l,!0)}loadPhiFile(e){let t,s=this.icn3d,i=s.icn3dui,l=this;"pqr"==e||"phi"==e||"cube"==e?t=$("#"+s.pre+e+"file")[0].files[0]:"pqr2"==e?t=$("#"+s.pre+"pqrfile2")[0].files[0]:"phi2"==e?t=$("#"+s.pre+"phifile2")[0].files[0]:"cube2"==e&&(t=$("#"+s.pre+"cubefile2")[0].files[0]);let n="pqr"==e||"phi"==e||"cube"==e?$("#"+s.pre+"phicontour").val():$("#"+s.pre+"phicontour2").val();if(t){i.utilsCls.checkFileAPI();let s=new FileReader;s.onload=function(t){let s=l.icn3d,r=t.target.result,o=0,a=0;if("pqr"==e||"pqr2"==e){let t="pqr2"==e;o=$("#"+s.pre+e+"gsize").val(),a=$("#"+s.pre+e+"salt").val(),l.CalcPhi(o,a,n,t,r)}else if("phi"==e||"phi2"==e){let t="phi2"==e;l.loadPhiData(r,n,t)}else if("cube"==e||"cube2"==e){let t="cube2"==e;l.loadCubeData(r,n,t)}s.bAjaxPhi=!0,bSurface?s.setOptionCls.setOption("phisurface","phi"):s.setOptionCls.setOption("phimap","phi"),bSurface?i.htmlCls.clickMenuCls.setLogCmd("load phi "+e+" | contour "+n+" | file "+$("#"+s.pre+e+"file").val()+" | gsize "+o+" | salt "+a+" | surface "+s.phisurftype+" | opacity "+s.phisurfop+" | wireframe "+s.phisurfwf,!1):i.htmlCls.clickMenuCls.setLogCmd("load phi "+e+" | contour "+n+" | file "+$("#"+s.pre+e+"file").val()+" | gsize "+o+" | salt "+a,!1)},"phi"==e||"phi2"==e?s.readAsArrayBuffer(t):s.readAsText(t)}else alert("Please select a file before clicking 'Load'")}loadPhiFileUrl(e){let t,s=this.icn3d,i=s.icn3dui;"pqrurl"==e||"phiurl"==e||"cubeurl"==e?t=$("#"+s.pre+e+"file").val():"pqrurl2"==e?t=$("#"+s.pre+"pqrurlfile2").val():"phiurl2"==e?t=$("#"+s.pre+"phiurlfile2").val():"cubeurl2"==e&&(t=$("#"+s.pre+"cubeurlfile2").val());let l="pqrurl"==e||"phiurl"==e||"cubeurl"==e?$("#"+s.pre+"phiurlcontour").val():$("#"+s.pre+"phiurlcontour2").val();if(t){let n="pqrurl2"==e||"phiurl2"==e||"cubeurl2"==e,r=0,o=0;"pqrurl"==e||"pqrurl2"==e?(r=$("#"+s.pre+e+"gsize").val(),o=$("#"+s.pre+e+"salt").val(),this.CalcPhiUrl(r,o,l,n,t)):this.PhiParser(t,e,l,n),n?i.htmlCls.clickMenuCls.setLogCmd("set phi "+e+" | contour "+l+" | url "+encodeURIComponent(t)+" | gsize "+r+" | salt "+o+" | surface "+s.phisurftype+" | opacity "+s.phisurfop+" | wireframe "+s.phisurfwf,!0):i.htmlCls.clickMenuCls.setLogCmd("set phi "+e+" | contour "+l+" | url "+encodeURIComponent(t)+" | gsize "+r+" | salt "+o,!0)}else alert("Please input the file URL before clicking 'Load'")}}class W{constructor(e){this.icn3d=e}applyCommandScapBase(e){this.icn3d.icn3dui;let t=e.substr(e.lastIndexOf(" ")+1);0==e.indexOf("scap 3d")?this.retrieveScap(t):0==e.indexOf("scap interaction")?this.retrieveScap(t,!0):0==e.indexOf("scap pdb")&&this.retrieveScap(t,void 0,!0)}applyCommandScap(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredScap=$.Deferred((function(){s.applyCommandScapBase(e)})),t.deferredScap.promise()}adjust2DWidth(e){let t=this.icn3d,s=t.icn3dui;e=t.pre+e;let i=$("#"+t.pre+"dl_selectannotations").hasClass("ui-dialog-content")?$("#"+t.pre+"dl_selectannotations").dialog("option","height"):s.htmlCls.HEIGHT,l=$("#"+t.pre+"dl_selectannotations").hasClass("ui-dialog-content")?250:.5*s.htmlCls.WIDTH;$("#"+e).dialog("option","width",l),$("#"+e).dialog("option","height",i);let n={my:"left-125 top+"+s.htmlCls.MENU_HEIGHT,at:"right top",of:"#"+t.pre+"viewer",collision:"none"};$("#"+e).dialog("option","position",n)}retrieveScap(e,t,s){let i=this.icn3d,l=i.icn3dui,n=this,r="",o=e.split(","),a={},d=[];for(let e=0,t=o.length;e<t;++e){let s=o[e].split("_"),n=s[0]+"_"+s[1]+"_"+s[2];a=l.hashUtilsCls.unionHash(a,i.residues[n]),d.push(n),r+=s[1]+"_"+s[2]+"_"+s[3],e!=t-1&&(r+=",")}let c=i.resid2specCls.residueids2spec(d),h="select "+c,m=i.showInterCls.pickCustomSphere_base(10,a,i.atoms,!1,!1,void 0,h,!1),p=Object.keys(m.residues);i.hAtoms={};for(let e=0,t=p.length;e<t;++e){let t=p[e];for(let e in i.residues[t])i.hAtoms[e]=1}i.hAtoms=l.hashUtilsCls.unionHash(i.hAtoms,a),i.hAtoms=l.hashUtilsCls.exclHash(i.hAtoms,i.chemicals);let u=i.saveFileCls.getAtomPDB(i.hAtoms),C=Object.keys(i.structures)[0],g={pdb:u,snp:r,pdbid:C,v:"2"};$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/scap/scap.cgi",type:"POST",data:g,dataType:"text",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(e){let o=e.indexOf("\n"),a=e.substr(0,o),h=e.substr(o+1);console.log("free energy: "+a+" kcal/mol");let m=l.hashUtilsCls.cloneHash(i.hAtoms);for(let e in m){let t=i.atoms[e],s=t.structure+"_"+t.chain,n=s+"_"+t.resi;i.chainsMapping.hasOwnProperty(s)||(i.chainsMapping[s]={}),i.chainsMapping[s][n]=l.utilsCls.residueName2Abbr(t.resn)+t.resi}i.hAtoms={},i.loadPDBCls.loadPDB(h,C,!1,!1,!0);let p=l.hashUtilsCls.cloneHash(i.hAtoms);i.hAtoms=l.hashUtilsCls.unionHash(i.hAtoms,m),i.dAtoms=i.hAtoms,i.transformCls.zoominSelection(),i.setOptionCls.setStyle("proteins","stick"),i.opts.color="chain",i.setColorCls.setColorByOptions(i.opts,i.dAtoms);for(let e in p){let t=i.atoms[e];if(!t.het){let s=t.structure.substr(0,t.structure.length-1)+"_"+t.chain+"_"+t.resi,l=i.firstAtomObjCls.getFirstAtomObj(i.residues[s]);i.atoms[e].color=l.color,i.atomPrevColors[e]=l.color}let s=t.structure+"_"+t.chain,n=s+"_"+t.resi,r=t.structure.substr(0,t.structure.length-1)+"_"+t.chain+"_"+t.resi;if(i.chainsMapping.hasOwnProperty(s)||(i.chainsMapping[s]={}),i.chainsMapping[s][n]=l.utilsCls.residueName2Abbr(t.resn)+t.resi,-1!=d.indexOf(r)){let e=i.firstAtomObjCls.getFirstAtomObj(i.residues[r]);i.chainsMapping[s][n]=l.utilsCls.residueName2Abbr(e.resn)+e.resi}}if(s){let e="";e+=i.saveFileCls.getAtomPDB(i.hAtoms);let t=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(t+"_"+r+".pdb","text",[e]),i.drawCls.draw()}else{let e=c,s="snp_"+r;if(i.selByCommCls.selectByCommand(e,s,s),i.opts.color="atom",i.setColorCls.setColorByOptions(i.opts,i.hAtoms),i.viewInterPairsCls.clearInteractions(),t){let e="linegraph";i.viewInterPairsCls.viewInteractionPairs(["selected"],["non-selected"],!1,e,!0,!0,!0,!0,!0,!0),n.adjust2DWidth("dl_linegraph")}i.hAtoms=i.dAtoms,i.drawCls.draw(),i.alertAlt||(i.alertAlt=!0,alert('Please press the letter "a" to alternate between wild type and mutant.'))}$("#"+i.pre+"mn2_alternateWrap").show();let u=i.pre+"selection";$("#"+u).show(),void 0!==i.deferredScap&&i.deferredScap.resolve()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):(alert("There are some problems in predicting the side chain of the mutant..."),i.ParserUtilsCls.hideLoading(),void 0!==i.deferredScap&&i.deferredScap.resolve())}})}}class Y{constructor(e){this.icn3d=e}applyCommandSymdBase(e){this.icn3d.icn3dui,this.retrieveSymd()}applyCommandSymd(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredSymd=$.Deferred((function(){s.applyCommandSymdBase(e)})),t.deferredSymd.promise()}retrieveSymd(){let e=this.icn3d,t=e.icn3dui,s=this,i=t.hashUtilsCls.intHash(e.dAtoms,e.hAtoms);i=t.hashUtilsCls.intHash(i,e.proteins);let l=Object.keys(i).length,n={};for(let t in i){let s=e.atoms[t],i=s.structure+"_"+s.chain+"_"+s.resi;n[i]=1}if(l>1e4)return void alert("The maximum number of allowed atoms is 10,000. Please try it again with smaller sets...");let r="";r+=e.saveFileCls.getAtomPDB(i);let o={pdb:r,pdbid:Object.keys(e.structures).toString()};$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/symd/symd.cgi",type:"POST",data:o,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){e.ParserUtilsCls.showLoading()},complete:function(){},success:function(i){let l=i.rcsb_struct_symmetry,r="none";if(void 0!==l){let o;void 0!==e.rmsd_supr&&void 0!==e.rmsd_supr.rot&&(e.rmsd_supr.rot,e.rmsd_supr.trans1,e.rmsd_supr.trans2),void 0===e.symdArray&&(e.symdArray=[]);for(let t=0,i=l.length;t<i;++t){if("C1"==l[t].symbol)continue;r=l[t].symbol+" ","Pseudo Symmetry"==l[t].kind?r=l[t].symbol+" (pseudo)":"Global Symmetry"==l[t].kind?r=l[t].symbol+" (global)":"Local Symmetry"==l[t].kind&&(r=l[t].symbol+" (local)");let i=l[t].rotation_axes,n=[];for(let e=0,r=i.length;e<r;++e){let r=[],a=new THREE.Vector3(i[e].start[0],i[e].start[1],i[e].start[2]),d=new THREE.Vector3(i[e].end[0],i[e].end[1],i[e].end[2]);o=i[e].order,r.push(a),r.push(d);let c=s.getAxisColor(l[t].symbol,i[e].order),h=s.getPolygonColor(l[t].symbol);r.push(c),r.push(h),r.push(i[e].order),r.push("selection"),n.push(r)}let a={};a[r]=n,e.symdArray.push(a)}if(0==e.symdArray.length)$("#"+e.pre+"dl_symd").html("<br>The selected residues have no detected symmetry with a Z score of "+i.zscore+" from the program <a href='https://symd.nci.nih.gov/' target='_blank'>SymD</a>."),t.htmlCls.dialogCls.openDlg("dl_symd","Dynamically Calculated Symmetry Using SymD");else{let r=i.seqalign.replace(/ /g,"").split(","),a=i.nres,d=i.shift,c=i.rmsd,h=Object.keys(n),m={},p={},u=[],C=[],g=0,f=0,b={};for(let e=0,s=r[0].length;e<s;++e){let s=r[0][e],i=r[1][e];if("-"!=s){if(s==s.toUpperCase()){m[h[g]]=1;let e=t.utilsCls.getIdArray(h[g]);u.push(s+" $"+e[0]+"."+e[1]+":"+e[2]);let i=e[0]+"_"+e[1];b.hasOwnProperty(i)||(b[i]=[]),b[i].push(u.length-1)}++g}if("-"!=i){if(i==i.toUpperCase()){let e=(f+d+a)%a;p[h[e]]=1;let s=t.utilsCls.getIdArray(h[e]);C.push(i+" $"+s[0]+"."+s[1]+":"+s[2])}++f}}let y={},v={},_=[],S=[],w=!1;if(1==Object.keys(b).length){w=!0;let e=parseInt(u.length/o+.5),t=Object.keys(m),s=Object.keys(p);for(let i=0;i<e;++i)y.hasOwnProperty(s[i])||(_.push(u[i]),S.push(C[i]),y[t[i]]=1,v[s[i]]=1)}else{let e,t=0;for(let s in b)b[s].length>t&&(t=b[s].length,e=s);let s=Object.keys(m),i=Object.keys(p);for(let t=0,l=b[e].length;t<l;++t){let l=b[e][t];y.hasOwnProperty(i[l])||(_.push(u[l]),S.push(C[l]),y[s[l]]=1,v[i[l]]=1)}}let A="<br>";A+="The symmetry "+l[0].symbol+" was calculated dynamically using the program <a href='https://symd.nci.nih.gov/' target='_blank'>SymD</a>. The Z score "+i.zscore+" is greater than the threshold Z score 8. The RMSD is "+c+' angstrom. <br><br>The following sequence alignment shows the residue mapping of the best aligned sets: "symOri" and "symPerm", which are also available in the menu "Analysis > Defined Sets".<br>',$("#"+e.pre+"symd_info").html(A),s.setSeqAlignForSymmetry(_,S,w);let x=!1,k=t.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(e.alnChains),void 0,void 0,x,w);A=$("#"+e.pre+"dl_sequence2").html()+k.sequencesHtml,$("#"+e.pre+"dl_sequence2").html(A),$("#"+e.pre+"dl_sequence2").width(t.htmlCls.RESIDUE_WIDTH*k.maxSeqCnt+200),t.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences from SymD");let O=Object.keys(e.defNames2Residues).length+Object.keys(e.defNames2Atoms).length,H="symOri"+O;e.selectionCls.selectResidueList(y,H,H),e.selectionCls.updateSelectionNameDesc(),t.htmlCls.clickMenuCls.setLogCmd("select "+e.resid2specCls.residueids2spec(Object.keys(y))+" | name "+H,!1),H="symPerm"+O,e.selectionCls.selectResidueList(v,H,H),e.selectionCls.updateSelectionNameDesc(),t.htmlCls.clickMenuCls.setLogCmd("select "+e.resid2specCls.residueids2spec(Object.keys(v))+" | name "+H,!1),H="symBoth"+O,y=t.hashUtilsCls.unionHash(y,v),e.selectionCls.selectResidueList(y,H,H),e.selectionCls.updateSelectionNameDesc(),t.htmlCls.clickMenuCls.setLogCmd("select "+e.resid2specCls.residueids2spec(Object.keys(y))+" | name "+H,!1)}}else $("#"+e.pre+"dl_symd").html("<br>The selected residues have no detected symmetry with a Z score of "+i.zscore+" from the program <a href='https://symd.nci.nih.gov/' target='_blank'>SymD</a>."),t.htmlCls.dialogCls.openDlg("dl_symd","Dynamically Calculated Symmetry Using SymD");e.symdtitle="none"===r?void 0:r,e.drawCls.draw(),void 0!==e.deferredSymd&&e.deferredSymd.resolve()},error:function(s,i,l){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):($("#"+e.pre+"dl_symd").html("<br>The web service can not determine the symmetry of the input set."),t.htmlCls.dialogCls.openDlg("dl_symd","Dynamically Calculated Symmetry Using SymD"),e.ParserUtilsCls.hideLoading(),void 0!==e.deferredSymd&&e.deferredSymd.resolve())}})}getResObj(e){this.icn3d.icn3dui;let t=e.substr(0,e.indexOf(" ")),s=e.indexOf("$"),i=e.indexOf("."),l=e.indexOf(":"),n=e.substr(s+1,i-s-1),r=e.substr(i+1,l-i-1),o=e.substr(l+1);return{resn:t,resid:n+"_"+r+"_"+o,resi:o,aligned:!0}}setSeqAlignForSymmetry(e,t,s){let i=this.icn3d,l=i.icn3dui;i.conservedName1="symOri_cons",i.conservedName2="symPerm_cons",i.consHash1={},i.consHash2={},i.alnChainsAnTtl={},i.alnChainsAnno={},i.alnChainsSeq={},i.alnChains={},i.alnChainsSeq={};let n={};for(let r=0,o=e.length;r<o;++r){let o,a=this.getResObj(e[r]),d=this.getResObj(t[r]),c=a.resid.substr(0,a.resid.lastIndexOf("_")),h=d.resid.substr(0,d.resid.lastIndexOf("_")),m=h;if(s){m=h.substr(0,h.indexOf("_"))+"2"+h.substr(h.indexOf("_"))}n[a.resid]=1,n[d.resid]=1,o=a.resn==d.resn?"#FF0000":"#0000FF";let p="#"+i.showAnnoCls.getColorhexFromBlosum62(a.resn,d.resn);a.color=o,d.color=o,a.color2=p,d.color2=p;for(let e in i.residues[a.resid])i.atoms[e].color=l.parasCls.thr(o),i.atomPrevColors[e]=l.parasCls.thr(o);for(let e in i.residues[d.resid])i.atoms[e].color=l.parasCls.thr(o),i.atomPrevColors[e]=l.parasCls.thr(o);void 0===i.alnChainsAnTtl[c]&&(i.alnChainsAnTtl[c]=[]);for(let e=0;e<3;++e)void 0===i.alnChainsAnTtl[c][e]&&(i.alnChainsAnTtl[c][e]=[]);for(let e=0;e<3;++e)i.alnChainsAnTtl[c][e].push("");void 0===i.alnChainsSeq[c]&&(i.alnChainsSeq[c]=[]),void 0===i.alnChainsSeq[m]&&(i.alnChainsSeq[m]=[]),i.alnChainsSeq[c].push(a),i.alnChainsSeq[m].push(d),void 0===i.alnChains[c]&&(i.alnChains[c]={}),void 0===i.alnChains[m]&&(i.alnChains[m]={}),$.extend(i.alnChains[c],i.residues[c+"_"+a.resi]),$.extend(i.alnChains[m],i.residues[m+"_"+d.resi]),i.consHash1[c+"_"+a.resi]=1,i.consHash2[m+"_"+d.resi]=1,void 0===i.alnChainsAnno[c]&&(i.alnChainsAnno[c]=[]);for(let e=0;e<3;++e)void 0===i.alnChainsAnno[c][e]&&(i.alnChainsAnno[c][e]=[]);let u=".";r%5==0&&(u="*"),r%10==0&&(u="|"),i.alnChainsAnno[c][0].push(u);let C="";r%10==0&&(C=r.toString()),i.alnChainsAnno[c][1].push(C)}}retrieveSymmetry(e){let t=this.icn3d,s=t.icn3dui,i=this,l="https://data.rcsb.org/rest/v1/core/assembly/"+e+"/1";$.ajax({url:l,dataType:"json",cache:!0,tryCount:0,retryLimit:0,success:function(e){let l,n,r,o=e.rcsb_struct_symmetry;if(void 0!==o){void 0!==t.rmsd_supr&&void 0!==t.rmsd_supr.rot&&(l=t.rmsd_supr.rot,n=t.rmsd_supr.trans1,r=t.rmsd_supr.trans2),t.symmetryHash={};for(let e=0,s=o.length;e<s;++e){if("C1"==o[e].symbol)continue;let s="no title";"Pseudo Symmetry"==o[e].kind?s=o[e].symbol+" (pseudo)":"Global Symmetry"==o[e].kind?s=o[e].symbol+" (global)":"Local Symmetry"==o[e].kind&&(s=o[e].symbol+" (local)");let a=o[e].rotation_axes,d=[];for(let s=0,c=a.length;s<c;++s){let c=[],h=new THREE.Vector3(a[s].start[0],a[s].start[1],a[s].start[2]),m=new THREE.Vector3(a[s].end[0],a[s].end[1],a[s].end[2]);void 0!==t.rmsd_supr&&void 0!==t.rmsd_supr.rot&&(h=t.surfaceCls.transformMemPro(h,l,n,r),m=t.surfaceCls.transformMemPro(m,l,n,r)),c.push(h),c.push(m);let p=i.getAxisColor(o[e].symbol,a[s].order),u=i.getPolygonColor(o[e].symbol);c.push(p),c.push(u),c.push(a[s].order),c.push(o[e].clusters[0].members[0].asym_id),d.push(c)}t.symmetryHash[s]=d}if(0==Object.keys(t.symmetryHash).length)$("#"+t.pre+"dl_symmetry").html("<br>This structure has no symmetry.");else{let e="<option value='none'>None</option>",s=0;for(let i in t.symmetryHash){e+="<option value='"+i+"' "+(0==s?"selected":"")+">"+i+"</option>",++s}$("#"+t.pre+"selectSymmetry").html(e)}}else $("#"+t.pre+"dl_symmetry").html("<br>This structure has no symmetry.");s.htmlCls.dialogCls.openDlg("dl_symmetry","Symmetry"),void 0!==t.deferredSymmetry&&t.deferredSymmetry.resolve()},error:function(e,i,l){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):($("#"+t.pre+"dl_symmetry").html("<br>This structure has no symmetry."),s.htmlCls.dialogCls.openDlg("dl_symmetry","Symmetry"),void 0!==t.deferredSymmetry&&t.deferredSymmetry.resolve())}})}getPolygonColor(e){let t=this.icn3d.icn3dui,s=e.substr(0,1);return"C"==s?t.parasCls.thr(16747520):"D"==s?t.parasCls.thr(65535):"T"==s?t.parasCls.thr(15631086):"O"==s?t.parasCls.thr(16753920):"I"==s?t.parasCls.thr(65280):t.parasCls.thr(11119017)}getAxisColor(e,t){let s=this.icn3d.icn3dui,i=e.substr(0,1);return"C"==i?s.parasCls.thr(16711680):"D"==i?2==t?s.parasCls.thr(65535):s.parasCls.thr(16711680):"T"==i?2==t?s.parasCls.thr(65535):s.parasCls.thr(65280):"O"==i||"I"==i?2==t?s.parasCls.thr(65535):3==t?s.parasCls.thr(65280):s.parasCls.thr(16711680):s.parasCls.thr(16711680)}}class X{constructor(e){this.icn3d=e}loadPDB(e,t,s,i,l,n,r,o){let a,d,c=this.icn3d,h=c.icn3dui,m={},p=!1,u=e.split("\n"),C={},g={};if(c.atoms||(n=!1),l||n){if(c.alertAlt){let e=c.oriNStru+1,t=c.structures[e-1];for(let e=0,s=t?t.length:0;e<s;++e){for(let s in c.chains[t[e]])delete c.atoms[s],delete c.hAtoms[s],delete c.dAtoms[s];delete c.chains[t[e]]}delete c.structures[e-1]}else c.oriNStru=c.structures?Object.keys(c.structures).length:0;d=c.oriNStru+1,a=c.atoms?Object.keys(c.atoms).length:0}else c.init(),d=1,a=0;let f,b,y,v,_,S,w,A=[],x=[],k=[],O=[],H=[],D=[],R="",I="",E="",T={},M=t||"STRU",F="",P="STRU",L=!1;for(let e in u){let t=u[e],r=t.substr(0,6);if("HEADER"!==r||L)if("TITLE "===r){let e=t.substr(10);c.molTitle+=e.trim()+" "}else if("HELIX "===r){c.bSecondaryStructure=!0;let e=""==t.substr(18,2).trim()?"A":t.substr(18,2).trim(),s=parseInt(t.substr(21,4)),i=parseInt(t.substr(33,4));for(let t=s;t<=i;++t){let l=P+"_"+e+"_"+t;O.push(l),t===s&&H.push(l),t===i&&D.push(l)}}else if("SHEET "===r){void 0!==s&&s||(c.bSecondaryStructure=!0);let e=""==t.substr(20,2).trim()?"A":t.substr(20,2).trim(),i=parseInt(t.substr(22,4)),l=parseInt(t.substr(33,4));for(let t=i;t<=l;++t){let s=P+"_"+e+"_"+t;A.push(s),t===i&&x.push(s),t===l&&k.push(s)}}else if("HBOND "===r)void 0!==s&&s||(c.bSecondaryStructure=!0);else if("SSBOND"===r){c.bSsbondProvided=!0;let e=M+"_"+(" "==t.substr(15,1)?"A":t.substr(15,1))+"_"+t.substr(17,4).trim(),s=M+"_"+(" "==t.substr(29,1)?"A":t.substr(29,1))+"_"+t.substr(31,4).trim();void 0===c.ssbondpnts[M]&&(c.ssbondpnts[M]=[]),c.ssbondpnts[M].push(e),c.ssbondpnts[M].push(s)}else if("REMARK"===r){let e=parseInt(t.substr(7,3));if(-1!==t.indexOf("1/2 of bilayer thickness:"))c.halfBilayerSize=parseFloat(t.substr(t.indexOf(":")+1).trim());else if(210==e)"EXPERIMENT TYPE"==t.substr(11,32).trim()&&"NMR"==t.substr(45).trim()&&(p=!0);else if(350==e&&"BIOMT"==t.substr(13,5)){let e=parseInt(t[18])-1,s=parseInt(t.substr(21,2))-1;null==c.biomtMatrices[s]&&(c.biomtMatrices[s]=(new THREE.Matrix4).identity()),c.biomtMatrices[s].elements[e]=parseFloat(t.substr(24,9)),c.biomtMatrices[s].elements[e+4]=parseFloat(t.substr(34,9)),c.biomtMatrices[s].elements[e+8]=parseFloat(t.substr(44,9)),c.biomtMatrices[s].elements[e+12]=parseFloat(t.substr(54,14))}else if(465==e&&" "==t.substr(18,1)&&" "==t.substr(20,1)&&"S"!=t.substr(21,1)){let e=t.substr(15,3),s=t.substr(18,2).trim(),i=t.substr(21,5),l=M+"_"+s;void 0===c.chainMissingResidueArray[l]&&(c.chainMissingResidueArray[l]=[]);let n={};n.resi=i,n.name=h.utilsCls.residueName2Abbr(e).toLowerCase(),""!=F&&s==F&&s!=F||(c.chainMissingResidueArray[l].push(n),F=s)}else 900==e&&void 0===c.emd&&"RELATED DB: EMDB"==t.substr(34).trim()&&(c.emd=t.substr(23,11).trim())}else if("SOURCE"===r&&void 0===c.organism&&"ORGANISM_COMMON"==t.substr(11,15).trim())c.organism=t.substr(28).toLowerCase().trim(),c.organism=c.organism.substr(0,c.organism.length-1);else if("ENDMDL"===r)++d,M="STRU",P=M,("STRU"==M||l)&&(P=1===d?M:M+d.toString()),p||(A=[],x=[],k=[],O=[],H=[],D=[]),L=!1;else if("JRNL  "===r)"PMID"===t.substr(12,4)&&(c.pmid=t.substr(19).trim());else if("ATOM  "===r||"HETATM"===r){P=M,("STRU"==M||l)&&(P=1===d?M:M+d.toString());let e=t.substr(16,1);++a,T[parseInt(t.substr(6,5))]=a;let n=t.substr(76,2).trim();""===n&&(n=t.substr(12,2).trim());let o=t.substr(12,4).trim(),u=t.substr(17,3),F=t.substr(20,2).trim();""===F&&(F="A");let L=t.substr(22,5).trim(),N=L;if(s&&"DUM"===u&&(n=o,F="MEM",N=1,L=1),i&&"DUM"===u)break;f=P+"_"+F,y=f+"_"+L,b=f+"_"+N;let $=parseFloat(t.substr(30,8)),U=parseFloat(t.substr(38,8)),q=parseFloat(t.substr(46,8)),B=new THREE.Vector3($,U,q),j={het:"H"===r[0],serial:a,name:o,alt:e,resn:u,structure:P,chain:F,resi:N,coord:B,b:parseFloat(t.substr(60,8)),elem:n,bonds:[],ss:"coil",ssbegin:!1,ssend:!1};if(j.het||"C"!==j.name||(v=a),j.het||"O"!==j.name||(S=a),!j.het&&"N"===j.name&&void 0!==_&&void 0!==w){let e=c.atoms[_].coord.distanceTo(c.atoms[w].coord),t=j.coord.x+(c.atoms[_].coord.x-c.atoms[w].coord.x)/e,s=j.coord.y+(c.atoms[_].coord.y-c.atoms[w].coord.y)/e,i=j.coord.z+(c.atoms[_].coord.z-c.atoms[w].coord.z)/e;j.hcoord=new THREE.Vector3(t,s,i)}c.atoms[a]=j,c.dAtoms[a]=1,c.hAtoms[a]=1,m[a]=1,this.isSecondary(b,A,p)?(c.atoms[a].ss="sheet",this.isSecondary(b,x,p)&&(c.atoms[a].ssbegin=!0),this.isSecondary(b,k,p)&&(c.atoms[a].ssend=!0)):this.isSecondary(b,O,p)&&(c.atoms[a].ss="helix",this.isSecondary(b,H,p)&&(c.atoms[a].ssbegin=!0),this.isSecondary(b,D,p)&&(c.atoms[a].ssend=!0));let z="-";if(z="helix"===c.atoms[a].ss?"H":"sheet"===c.atoms[a].ss?"E":!c.atoms[a].het&&h.parasCls.residueColors.hasOwnProperty(c.atoms[a].resn.toUpperCase())?"c":"o",c.secondaries[b]=z,y!==E){let e=h.utilsCls.residueName2Abbr(u);if(c.residueId2Name[b]=e,1!==a&&""!==I&&(c.residues[I]=g),b!==I&&(g={}),f!==R){_=void 0,w=void 0,1!==a&&""!==R&&(void 0===c.chains[R]&&(c.chains[R]={}),c.chains[R]=h.hashUtilsCls.unionHash(c.chains[R],C)),C={},void 0===c.structures[P.toString()]&&(c.structures[P.toString()]=[]),c.structures[P.toString()].includes(f)||c.structures[P.toString()].push(f),void 0===c.chainsSeq[f]&&(c.chainsSeq[f]=[]);let t={};t.resi=N,t.name=e,c.chainsSeq[f].push(t)}else{_=v,w=S;let t={};t.resi=N,t.name=e,c.chainsSeq[f].push(t)}}C[a]=1,g[a]=1,R=f,I=b,E=y}else if("CONECT"===r){let e=parseInt(t.substr(6,5));for(let s=0;s<4;++s){let i=parseInt(t.substr([11,16,21,26][s],5));isNaN(i)||void 0!==c.atoms[T[e]]&&c.atoms[T[e]].bonds.push(T[i])}}else"TER"===r.substr(0,3)&&++a;else M=t.substr(62).trim(),""==M&&(M=n?"STRU":c.inputid&&-1==c.inputid.indexOf("/")?c.inputid.substr(0,10):"STRU"),P=M,("STRU"==M||l)&&(P=1===d?M:M+d.toString()),c.molTitle="",L=!0}c.residues[b]=g,void 0===c.chains[f]&&(c.chains[f]={}),c.chains[f]=h.hashUtilsCls.unionHash2Atoms(c.chains[f],C,c.atoms),l||this.adjustSeq(c.chainMissingResidueArray);let N=Object.keys(c.structures);for(let e=0,t=N.length;e<t;++e){let t=N[e];if(t!=M&&(void 0===c.ssbondpnts[t]&&(c.ssbondpnts[t]=[]),void 0!==c.ssbondpnts[M]))for(let e=0,s=c.ssbondpnts[M].length;e<s;++e){let s=c.ssbondpnts[M][e],i=s.indexOf("_"),l=t+s.substr(i);c.ssbondpnts[t].push(l)}}if(!c.bSsbondProvided){let e={};for(let t in c.chainsSeq){let s=c.chainsSeq[t],i=t.substr(0,t.indexOf("_"));for(let l=0,n=s.length;l<n;++l)"C"==s[l].name&&(null==e[i]&&(e[i]=[]),e[i].push(t+"_"+s[l].resi))}this.setSsbond(e)}u=null;let U,q,B=[],j=function(e){let t=B.length;for(let s=0;s<t;++s){let i=B[s];for(let e=s+1;e<t;++e){let t=B[e];i.alt===t.alt&&h.utilsCls.hasCovalentBond(i,t)&&(i.bonds.push(t.serial),t.bonds.push(i.serial))}e&&e(i)}},z=new THREE.Vector3(9999,9999,9999),G=new THREE.Vector3(-9999,-9999,-9999),V=new THREE.Vector3,W=0,Y={};for(let e in c.atoms){let t=c.atoms[e],s=t.coord;V.add(s),z.min(s),G.max(s),++W,t.het?t.het&&("HOH"===t.resn||"WAT"===t.resn||"SOL"===t.resn?c.water[t.serial]=1:-1!==$.inArray(t.resn,h.parasCls.ionsArray)||t.elem.trim()===t.resn.trim()?c.ions[t.serial]=1:c.chemicals[t.serial]=1,t.color=h.parasCls.atomColors[t.elem]):-1!==$.inArray(t.resn,h.parasCls.nucleotidesArray)?(c.nucleotides[t.serial]=1,"O3'"!==t.name&&"O3*"!==t.name||(c.nucleotidesO3[t.serial]=1,c.secondaries[t.structure+"_"+t.chain+"_"+t.resi]="o"),-1===h.parasCls.nuclMainArray.indexOf(t.name)&&(c.ntbase[t.serial]=1)):("P"===t.elem&&(Y[t.structure+"_"+t.chain+"_"+t.resi]=1),c.proteins[t.serial]=1,"CA"===t.name&&(c.calphas[t.serial]=1),"N"!==t.name&&"CA"!==t.name&&"C"!==t.name&&"O"!==t.name&&(c.sidec[t.serial]=1)),U===t.chain&&q===t.resi||(j((function(e){("C"===e.name&&"N"===t.name||"O3'"===e.name&&"P"===t.name)&&h.utilsCls.hasCovalentBond(e,t)&&(e.bonds.push(t.serial),t.bonds.push(e.serial))})),U=t.chain,q=t.resi,B.length=0),B.push(t)}for(resid in Y){let e=c.residues[resid];for(a in e){let e=c.atoms[a];e.het=!0,c.chemicals[e.serial]=1,c.secondaries[resid]="o",delete c.proteins[e.serial],"CA"===e.name&&delete c.calphas[e.serial],"N"!==e.name&&"CA"!==e.name&&"C"!==e.name&&"O"!==e.name&&delete c.sidec[e.serial]}}return j(),c.pmin=z,c.pmax=G,c.cnt=W,c.center=c.ParserUtilsCls.getGeoCenter(c.pmin,c.pmax),c.maxD=c.ParserUtilsCls.getStructureSize(c.atoms,c.pmin,c.pmax,c.center),c.maxD<5&&(c.maxD=5),c.oriMaxD=c.maxD,c.oriCenter=c.center.clone(),"target"===r?(c.oriMaxD=c.maxD,c.center1=c.center):"query"===r&&(c.oriMaxD<c.maxD&&(c.oriMaxD=c.maxD),c.center2=c.center,c.center=new THREE.Vector3(0,0,0)),i?this.getChainCalpha(c.chains,c.atoms):m}adjustSeq(e){let t=this.icn3d;t.icn3dui;for(let s in t.chainsSeq){if(void 0===e[s])continue;let i,l,n,r=e[s],o=t.chainsSeq[s],a=r.length,d=o.length,c=new Array(a+d);for(i=0,l=0,n=0;i<a&&l<d;)parseInt(r[i].resi)<=parseInt(o[l].resi)?(c[n]=r[i],i++):(c[n]=o[l],l++),n++;if(i<a)for(let e=i;e<a;e++)c[n]=r[e],n++;else for(let e=l;e<d;e++)c[n]=o[e],n++;t.chainsSeq[s]=c}}setSsbond(e){let t=this.icn3d;t.icn3dui;for(let s in e){let i=e[s];for(let e=0,l=i.length;e<l;++e)for(let l=e+1,n=i.length;l<n;++l){let n,r,o=i[e],a=i[l];for(let e in t.residues[o])if("S"==t.atoms[e].elem){n=t.atoms[e].coord;break}for(let e in t.residues[a])if("S"==t.atoms[e].elem){r=t.atoms[e].coord;break}void 0!==n&&void 0!==r&&(Math.abs(n.x-r.x)>4||Math.abs(n.y-r.y)>4||Math.abs(n.z-r.z)>4||(n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y)+(n.z-r.z)*(n.z-r.z)<16&&(void 0===t.ssbondpnts[s]&&(t.ssbondpnts[s]=[]),t.ssbondpnts[s].push(o),t.ssbondpnts[s].push(a)))}}}getChainCalpha(e,t,s,i){let l=this.icn3d,n=l.icn3dui,r={};for(let o in e){if(void 0!==i){if(o.split("_")[0]!==i)continue}let a=Object.keys(e[o]),d=[],c=0,h=0;for(let e=0,i=a.length;e<i;++e){let i=t[a[e]];if(l.proteins.hasOwnProperty(a[e])&&"CA"==i.name||l.nucleotides.hasOwnProperty(a[e])&&("O3'"==i.name||"O3*"==i.name)){if(i.resi==h)continue;let e=i.resn.trim().length>3?i.resn.trim().substr(0,3):i.resn.trim();if(!n.parasCls.chargeColors.hasOwnProperty(e))continue;s?i.resi_ori:i.resi,d.push(i.coord.clone()),++c,h=i.resi}}if(c>0){r[t[a[0]].chain]=d}}return{chainresiCalphaHash:r,center:l.center.clone()}}isSecondary(e,t,s){if(this.icn3d.icn3dui,s){let s=e.substr(e.indexOf("_")+1),i=!1;for(let e=0,l=t.length;e<l;++e)if(s==t[e].substr(t[e].indexOf("_")+1)){i=!0;break}return i}return-1!=$.inArray(e,t)}}class J{constructor(e){this.icn3d=e}loadAtomDataIn(e,t,s,i,l,n,r,o,a){let d=this.icn3d,c=d.icn3dui;d.pmin=new THREE.Vector3(9999,9999,9999),d.pmax=new THREE.Vector3(-9999,-9999,-9999),d.psum=new THREE.Vector3;let h=e.atoms,m=d.atoms?Object.keys(d.atoms).length:0,p={},u={};d.pmid=e.pubmedId,void 0===d.chainid2title&&(d.chainid2title={}),void 0===d.chainid2sid&&(d.chainid2sid={});let C={},g={};if("align"===s){d.pmid="";let t=c.cfg.inpara&&-1!==c.cfg.inpara.indexOf("atype=1")?"Invariant Core ":"";d.molTitle=t+"Structure Alignment of ";let s=!1;for(let t=0,i=e.alignedStructures[0].length;t<i;++t){let i=e.alignedStructures[0][t];1===t&&(d.secondId=i.pdbId);let l=i.pdbId,n=i.mmdbId;for(let e=i.serialInterval[0],t=i.serialInterval[1];e<=t;++e)p[e]=l.toString(),u[n]=l;for(let e=0,t=i.molecules.length;e<t;++e){let t=i.molecules[e].chain,s=i.molecules[e].kind,n=i.molecules[e].name,r=i.molecules[e].sid,o=l+"_"+t;C[o]=s,d.chainid2title[o]=n,void 0!==r&&(d.chainid2sid[o]=r)}d.molTitle+='<a href="'+c.htmlCls.baseUrl+"mmdb/mmdbsrv.cgi?uid="+i.pdbId.toUpperCase()+'" target="_blank">'+i.pdbId.toUpperCase()+"</a>",void 0!==i.descr&&(d.pmid+=i.descr.pubmedid),0===t&&(d.molTitle+=" and ",void 0!==i.descr&&(d.pmid+="_")),s=!0}d.molTitle+=" from VAST+",s||(d.molTitle="")}else if(void 0!==e.descr&&(d.molTitle+=e.descr.name),"mmdbid"===s){let t=e.pdbId,s={};void 0===d.alignmolid2color&&(d.alignmolid2color=[]);let i=1;for(let n in e.moleculeInfor){if(0===Object.keys(e.moleculeInfor[n]).length)continue;let r=e.moleculeInfor[n].chain.trim(),o=t+"_"+r;s.hasOwnProperty(r)?(++s[r],o+=s[r]):s[r]=1,void 0!==d.mmdbid_q&&d.mmdbid_q===d.mmdbid_t&&"query"===l&&(o=t+c.htmlCls.postfix+"_"+r);let a=e.moleculeInfor[n].kind,h=e.moleculeInfor[n].color,m=e.moleculeInfor[n].sid;if(C[o]=a,g[o]=h,"protein"==a&&(d.organism=e.moleculeInfor[n].taxonomyName.toLowerCase()),void 0!==m&&(d.chainid2sid[o]=m),void 0===d.pdbid_chain2title&&(d.pdbid_chain2title={}),d.pdbid_chain2title[o]=e.moleculeInfor[n].name,r==o.substr(o.lastIndexOf("_"))){let e={};e[n]=i.toString(),d.alignmolid2color.push(e)}++i}}let f,b,y,v,_,S={},w="",A="",x="",k="",O="",H="",D=0,R=0,I="",E=!0,T=!1,M="",F=c.utilsCls.isCalphaPhosOnly(h),P=0,L={};for(let e in h){++m,S[e]=m;let i,n=h[e];n.serial=m,"mmdbid"===s||"mmcifid"===s?i=t:"align"===s&&(i=p[m]);let o=!1;if(void 0!==n.chain||"mmdbid"!==s&&"align"!==s)n.chain=""===n.chain?"Misc":n.chain;else if("mmdbid"===s)if(f=n.ids.m,void 0!==d.molid2chain[f]){let e=d.molid2chain[f].indexOf("_");n.chain=d.molid2chain[f].substr(e+1)}else{let e="Misc";("protein"===C[O]&&"nucleotide"===C[O]&&n.resi!=R||"protein"!==C[O]&&"nucleotide"!==C[O]&&(n.resn.substr(0,3)!=I.substr(0,3)||n.resi!=R||"solvent"===C[O]||"HOH"===n.resn))&&++P,n.resi_ori=n.resi,n.resi=P,o=!0,n.chain=e}else if("align"===s)if(f=n.ids.m,void 0!==d.pdbid_molid2chain[i+"_"+f])n.chain=d.pdbid_molid2chain[i+"_"+f];else{let e="Misc";("protein"===C[O]&&"nucleotide"===C[O]&&n.resi!=R||"protein"!==C[O]&&"nucleotide"!==C[O]&&(n.resn.substr(0,3)!=I.substr(0,3)||n.resi!=R||"solvent"===C[O]||"HOH"===n.resn))&&(++P,n.resi_ori=n.resi,n.resi=P,o=!0),n.chain=e}if(n.chain=n.chain.trim(),"mmdbid"!==s&&"align"!==s||(n.structure=i,"mmdbid"===s&&void 0!==d.mmdbid_q&&d.mmdbid_q===d.mmdbid_t&&"query"===l&&(n.structure+=c.htmlCls.postfix)),k=n.structure,O=k+"_"+n.chain,"mmdbid"===s||"align"===s){o||(n.resi_ori=n.resi,d.bUsePdbNum?(n.resi=n.resi_ori,d.chainid2offset&&!d.chainid2offset[O]&&(d.chainid2offset[O]=n.resi_ori-n.ids.r)):n.resi=n.ids.r);let e=n.resn.indexOf(" ");-1!==e&&0!=e&&(n.resn=n.resn.substr(0,e)),n.resiNCBI=n.ids.r,d.residNCBI2resid[O+"_"+n.resiNCBI]=O+"_"+n.resi}O!==A&&(D=0),n.resi!==D&&(O!==A?(y=void 0,_=void 0):(y=b,_=v)),"mmdbid"===s?(n.coord=new THREE.Vector3(n.coord[0],n.coord[1],n.coord[2]),void 0!==d.q_rotation&&d.t_trans_add.length>0&&!c.cfg.resnum&&!c.cfg.resdef&&r&&(n=d.chainalignParserCls.transformAtom(n,r,l))):n.coord=new THREE.Vector3(n.coord.x,n.coord.y,n.coord.z);let a=c.utilsCls.residueName2Abbr(n.resn.substr(0,3));"mmdbid"!==s&&"align"!==s||!d.bFullUi||(void 0===d.mmdbMolidResid2mmdbChainResi&&(d.mmdbMolidResid2mmdbChainResi={}),d.mmdbMolidResid2mmdbChainResi[i+"_"+n.ids.m+"_"+n.ids.r]=i+"_"+n.chain+"_"+n.resi),d.pmin.min(n.coord),d.pmax.max(n.coord),d.psum.add(n.coord);let u=void 0===c.cfg.mmcifid&&"mmcif"!=d.InputfileType?"protein"===C[O]:"p"===n.mt,N=void 0===c.cfg.mmcifid&&"mmcif"!=d.InputfileType?"nucleotide"===C[O]:"n"===n.mt,$=void 0===c.cfg.mmcifid&&"mmcif"!=d.InputfileType?"solvent"===C[O]:"s"===n.mt,U=void 0===c.cfg.mmcifid&&"mmcif"!=d.InputfileType?"ligand"===C[O]||void 0!==C[O]&&-1!==C[O].indexOf("other")||void 0===C[O]:"l"===n.mt;if("Misc"!==n.chain&&"other"!==C[O]||"protein"===L[O]||"nucleotide"===L[O]||("CA"===n.name&&"C"===n.elem?L[O]="protein":"P"===n.name&&"P"===n.elem?L[O]="nucleotide":L[O]="chemical"),u||N?(u?(d.proteins[m]=1,"CA"===n.name&&(d.calphas[m]=1),"N"!==n.name&&"CA"!==n.name&&"C"!==n.name&&"O"!==n.name&&(d.sidec[m]=1)):N&&(d.nucleotides[m]=1,("O3'"==n.name||"O3*"==n.name||F&&"P"==n.name)&&(d.nucleotidesO3[m]=1),-1===c.parasCls.nuclMainArray.indexOf(n.name)&&(d.ntbase[m]=1)),n.het=!1):$?(d.water[m]=1,n.het=!0):U&&("HOH"===n.resn||"O"===n.resn?d.water[m]=1:n.elem===n.resn?d.ions[m]=1:d.chemicals[m]=1,n.het=!0),"mmdbid"===s?n.het?n.color=c.parasCls.atomColors[n.elem]||c.parasCls.defaultAtomColor:n.color=void 0!==g[O]?c.parasCls.thr(g[O]):c.parasCls.chargeColors[n.resn]:void 0!==n.color&&(n.color=c.parasCls.thr(n.color))," "!==n.resn.charAt(0)&&" "===n.resn.charAt(1)&&(n.resn=n.resn.charAt(0)),n.het||"C"!==n.name||(b=m),n.het||"O"!==n.name||(v=m),!n.het&&"N"===n.name&&void 0!==y&&void 0!==_){let e=d.atoms[y].coord.distanceTo(d.atoms[_].coord),t=n.coord.x+(d.atoms[y].coord.x-d.atoms[_].coord.x)/e,s=n.coord.y+(d.atoms[y].coord.y-d.atoms[_].coord.y)/e,i=n.coord.z+(d.atoms[y].coord.z-d.atoms[_].coord.z)/e;n.hcoord=new THREE.Vector3(t,s,i)}"HOH"==n.resn&&(d.water[m]=1),d.atoms[m]=n,d.dAtoms[m]=1,d.hAtoms[m]=1;let q=n.structure+"_"+n.chain;void 0===d.chains[q]&&(d.chains[q]={}),d.chains[q][m]=1;let B=q+"_"+n.resi;void 0===d.residues[B]&&(d.residues[B]={}),d.residues[B][m]=1,H=O+"_"+n.resi,H!==x&&O!==A&&(E=!0,""!==w&&(void 0===d.structures[w]&&(d.structures[w]=[]),d.structures[w].push(A))),d.residueId2Name[B]=a;let j="-";if("helix"===n.ss?j="H":"sheet"===n.ss?j="E":n.het||N?j="o":(!n.het&&c.parasCls.residueColors.hasOwnProperty(n.resn.toUpperCase())||"coil"===n.ss)&&(j="c"),d.secondaries[n.structure+"_"+n.chain+"_"+n.resi]=j,(n.resi!=D||f!=M)&&d.bFullUi&&(void 0===d.chainsSeq[q]&&(d.chainsSeq[q]=[],E=!1),!isNaN(n.resi)))if(E&&!T&&void 0!==d.chainsSeq[q][n.resi-1])d.chainsSeq[q][n.resi-1].name=a;else if(!E||!d.chainsSeq[q].hasOwnProperty(n.resi-1)){let e={};e.resi=n.resi,e.name=a,n.resi%10==0&&n.resi.toString(),d.chainsSeq[q].push(e),T=!0}D=n.resi,R=n.resi_ori,I=n.resn,w=k,A=O,x=H,M=f}for(let e in L)if(!(Object.keys(d.chains[e]).length<10)&&"chemical"!==L[e])for(let t in d.chains[e]){let s=d.atoms[t];delete d.chemicals[t],s.het=!1,"protein"===L[e]?(d.proteins[t]=1,"CA"===s.name&&(d.calphas[t]=1),"N"!==s.name&&"CA"!==s.name&&"C"!==s.name&&"O"!==s.name&&(d.sidec[t]=1)):"nucleotide"===L[e]&&(d.nucleotides[t]=1,("O3'"==s.name||"O3*"==s.name||F&&"P"==s.name)&&(d.nucleotidesO3[t]=1),-1===c.parasCls.nuclMainArray.indexOf(s.name)&&(d.ntbase[t]=1))}if(void 0===d.structures[k]&&(d.structures[k]=[]),d.structures[k].push(O),d.bFullUi)if("mmdbid"===s||"mmcifid"===s)for(let i in e.sequences){let n=e.sequences[i],r=t+"_"+i;void 0!==d.mmdbid_q&&d.mmdbid_q===d.mmdbid_t&&"query"===l&&(r=t+c.htmlCls.postfix+"_"+i),d.ParserUtilsCls.getMissingResidues(n,s,r)}else if("align"===s)for(let e in d.chainid2seq){let t=d.chainid2seq[e];d.ParserUtilsCls.getMissingResidues(t,s,e)}if("mmcifid"!==s)for(let e in h){let t=S[e],s=void 0===d.atoms[t].bonds?0:d.atoms[t].bonds.length;for(let e=0;e<s;++e)d.atoms[t].bonds[e]=S[d.atoms[t].bonds[e]]}if(e.atoms={},d.cnt=m,(d.cnt>d.maxatomcnt||void 0!==d.biomtMatrices&&d.biomtMatrices.length*d.cnt>10*d.maxatomcnt)&&(d.opts.proteins="c alpha trace",d.opts.nucleotides="o3 trace"),d.center=d.ParserUtilsCls.getGeoCenter(d.pmin,d.pmax),d.maxD=d.ParserUtilsCls.getStructureSize(d.atoms,d.pmin,d.pmax,d.center),d.maxD<5&&(d.maxD=5),d.oriMaxD=d.maxD,"mmdbid"===s){let t=e.disulfides;if(void 0!==t)for(let e=0,s=t.length;e<s;++e){let s=t[e][0].ca,i=t[e][1].ca,l=d.atoms[s],n=d.atoms[i],r=l.chain,o=n.chain,a=l.structure+"_"+r+"_"+l.resi,c=n.structure+"_"+o+"_"+n.resi;void 0===d.ssbondpnts[l.structure]&&(d.ssbondpnts[l.structure]=[]),d.ssbondpnts[l.structure].push(a),d.ssbondpnts[l.structure].push(c)}}else if("mmcifid"===s){let s=e.disulfides;if(void 0!==s){void 0===d.ssbondpnts[t]&&(d.ssbondpnts[t]=[]);for(let e=0,i=s.length;e<i;++e){let i=s[e][0],l=s[e][1];d.ssbondpnts[t].push(i),d.ssbondpnts[t].push(l)}let e=Object.keys(d.structures);for(let s=0,i=e.length;s<i;++s){let i=e[s];if(i!=t){void 0===d.ssbondpnts[i]&&(d.ssbondpnts[i]=[]);for(let e=0,s=d.ssbondpnts[t].length;e<s;++e){let s=d.ssbondpnts[t][e],l=s.indexOf("_"),n=i+s.substr(l);d.ssbondpnts[i].push(n)}}}}}else if("align"===s){let e={};for(let t in d.chainid2seq)if("protein"==C[t]){let s=d.chainid2seq[t],i=t.substr(0,t.indexOf("_"));for(let l=0,n=s.length;l<n;++l)"C"==s[l][1]&&(null==e[i]&&(e[i]=[]),e[i].push(t+"_"+s[l][0]))}d.loadPDBCls.setSsbond(e)}("mmcifid"===s||"mmdbid"===s&&void 0===l)&&d.ParserUtilsCls.transformToOpmOri(t);let N={};if("align"===s&&void 0!==i&&d.bFullUi)d.setSeqAlignCls.setSeqAlign(i,e.alignedStructures);else if("mmdbid"!==s||"query"!==l||!d.bFullUi||void 0===d.q_rotation||c.cfg.resnum||c.cfg.resdef||a)"mmdbid"===s&&"target"===l&&(N=d.hAtoms);else if(r){d.setSeqAlignCls.setSeqAlignChain(n,r);let e=!1,t=c.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(d.alnChains),void 0,void 0,!1,void 0,e),s=$("#"+d.pre+"dl_sequence2").html();N=d.hAtoms,$("#"+d.pre+"dl_sequence2").html(s+t.sequencesHtml),$("#"+d.pre+"dl_sequence2").width(c.htmlCls.RESIDUE_WIDTH*t.maxSeqCnt+200)}else N=d.hAtoms;if("mmdbid"===s&&("target"===l||"query"===l)&&void 0===d.q_rotation){if("target"===l||"query"===l)for(let e in h){let t=h[e];t.coord.x-=d.center.x,t.coord.y-=d.center.y,t.coord.z-=d.center.z}"target"===l?(d.oriMaxD=d.maxD,d.center1=d.center):"query"===l&&(d.oriMaxD<d.maxD&&(d.oriMaxD=d.maxD),d.center2=d.center,d.center=new THREE.Vector3(0,0,0))}return d.oriCenter=d.center.clone(),d.saveFileCls.showTitle(),e={},N}}class K{constructor(e){this.icn3d=e}downloadCid(e){let t=this.icn3d,s=t.icn3dui,i=this,l="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/record/SDF/?record_type=3d&response_type=display";t.ParserUtilsCls.setYourNote("PubChem CID "+e+" in iCn3D"),t.bCid=!0,$.ajax({url:l,dataType:"text",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){},success:function(l){let n=i.loadSdfAtomData(l,e);void 0===s.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),n?(t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.atoms),t.ParserUtilsCls.renderStructure(),void 0!==s.cfg.rotate&&t.resizeCanvasCls.rotStruc(s.cfg.rotate,!0)):alert("The SDF of CID "+e+" has the wrong format...")},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}}).fail((function(){alert("This CID may not have 3D structure...")}))}loadSdfData(e){let t=this.icn3d,s=t.icn3dui,i=this.loadSdfAtomData(e);void 0===s.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.atoms),t.ParserUtilsCls.renderStructure(),void 0!==s.cfg.rotate&&t.resizeCanvasCls.rotStruc(s.cfg.rotate,!0)):alert("The SDF file has the wrong format...")}loadSdfAtomData(e,t){let s=this.icn3d;s.icn3dui;let i=e.split(/\r?\n|\r/);if(i.length<4)return!1;s.init();let l=t||1,n="LIG",r=l,o=l+"_A",a=o+"_1",d=parseInt(i[3].substr(0,3));if(isNaN(d)||d<=0)return!1;let c=parseInt(i[3].substr(3,3)),h=4;if(i.length<h+d+c)return!1;let m,p,u=d,C={},g={},f={},b=1;for(m=0;m<u;m++){p=i[h],h++;let e=p.substr(31,3).trim(),t=parseFloat(p.substr(0,10)),r=parseFloat(p.substr(10,10)),o=parseFloat(p.substr(20,10)),a={het:!0,serial:b,name:e,resn:n,structure:l,chain:"A",resi:1,coord:new THREE.Vector3(t,r,o),b:0,elem:e,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};s.atoms[b]=a,f[b]=1,C[m]=b,++b,"H"==e&&(g[m]=1)}s.dAtoms=f,s.hAtoms=f,s.structures[r]=[o],s.chains[o]=f,s.residues[a]=f,s.residueId2Name[a]=n,void 0===s.chainsSeq[o]&&(s.chainsSeq[o]=[]);let y={resi:1};for(y.name=n,s.chainsSeq[o].push(y),m=0;m<c;m++){p=i[h],h++;let e=parseInt(p.substr(0,3))-1+0,t=parseInt(p.substr(3,3))-1+0,l=p.substr(6,3).trim(),n=C[e],r=C[t];s.atoms[n].bonds.push(r),s.atoms[n].bondOrder.push(l),s.atoms[r].bonds.push(n),s.atoms[r].bondOrder.push(l),g.hasOwnProperty(e)||g.hasOwnProperty(t)||("2"==l?(s.doublebonds[n+"_"+r]=1,s.doublebonds[r+"_"+n]=1):"3"==l&&(s.triplebonds[n+"_"+r]=1,s.triplebonds[r+"_"+n]=1))}let v=!1;for(let e=i.length;h<e;++h)if(-1!=i[h].indexOf("PARTIAL_CHARGES")){v=!0;break}if(v){++h;let e=parseInt(i[h]);for(++h,m=0;m<e;++m,++h){p=i[h];let e=p.split(" "),t=parseInt(e[0]),l=parseFloat(e[1]);s.atoms[t].crg=l}}for(m in s.atoms)"H"!==s.atoms[m].name&&(s.atoms[m].bonds2=s.atoms[m].bonds.concat(),s.atoms[m].bondOrder2=s.atoms[m].bondOrder.concat());return s.ParserUtilsCls.setMaxD(),s.saveFileCls.showTitle(),!0}}class Q{constructor(e){this.icn3d=e}loadXyzData(e){let t=this.icn3d,s=t.icn3dui,i=this.loadXyzAtomData(e);void 0===s.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.atoms),t.ParserUtilsCls.renderStructure(),void 0!==s.cfg.rotate&&t.resizeCanvasCls.rotStruc(s.cfg.rotate,!0)):alert("The XYZ file has the wrong format...")}setXyzAtomSeq(e,t,s,i){let l=this.icn3d,n=l.icn3dui;l.dAtoms=n.hashUtilsCls.unionHash(l.dAtoms,e),l.hAtoms=n.hashUtilsCls.unionHash(l.hAtoms,e),l.structures[t]=[s],l.chains[s]=e,l.residues[i]=e,l.residueId2Name[i]="LIG",void 0===l.chainsSeq[s]&&(l.chainsSeq[s]=[]);let r={resi:1,name:"LIG"};l.chainsSeq[s].push(r);let o=Object.keys(e);for(let e=0,t=o.length;e<t;++e){let t=l.atoms[o[e]];for(let s=e+1,i=o.length;s<i;++s){let i=l.atoms[o[s]],r=1.2*(n.parasCls.covalentRadii[t.elem.toUpperCase()]+n.parasCls.covalentRadii[i.elem.toUpperCase()]);Math.abs(t.coord.x-i.coord.x)>r||(Math.abs(t.coord.y-i.coord.y)>r||Math.abs(t.coord.z-i.coord.z)>r||n.utilsCls.hasCovalentBond(t,i)&&(l.atoms[o[e]].bonds.push(o[s]),l.atoms[o[s]].bonds.push(o[e])))}}}loadXyzAtomData(e){let t=this.icn3d;t.icn3dui;let s=e.split(/\r?\n|\r/);if(s.length<3)return!1;t.init();let i,l,n,r={},o=0,a=1;t.molTitle="";for(let e=0,d=s.length;e<d;++e){let d=s[e].trim();if(""===d)continue;if(""===d||isNaN(d)||(0!==e&&this.setXyzAtomSeq(r,o,i,l),++o,r={},n=o,i=n+"_A",l=i+"_1",o>1&&(t.molTitle+="; "),t.molTitle+=s[e+1].trim(),e+=2),d=s[e].trim(),""===d)continue;let c=d.replace(/,/," ").replace(/\s+/g," ").split(" "),h=c[0],m=parseFloat(c[1]),p=parseFloat(c[2]),u=parseFloat(c[3]),C={het:!0,serial:a,name:h,resn:"LIG",structure:n,chain:"A",resi:1,coord:new THREE.Vector3(m,p,u),b:0,elem:h,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};t.atoms[a]=C,r[a]=1,++a}return this.setXyzAtomSeq(r,o,i,l),t.ParserUtilsCls.setMaxD(),t.saveFileCls.showTitle(),!0}}class Z{constructor(e){this.icn3d=e}loadMol2Data(e){let t=this.icn3d,s=t.icn3dui,i=this.loadMol2AtomData(e);void 0===s.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.atoms),t.ParserUtilsCls.renderStructure(),void 0!==s.cfg.rotate&&t.resizeCanvasCls.rotStruc(s.cfg.rotate,!0)):alert("The Mol2 file has the wrong format...")}loadMol2AtomData(e){let t=this.icn3d;t.icn3dui;let s=e.split(/\r?\n|\r/);if(s.length<4)return!1;t.init();let i,l,n="LIG",r={},o="1_A",a=0,d=0,c=1,h=!1,m=!1,p={},u={};for(let e=0,o=s.length;e<o;++e){let o=s[e].trim();if(""!==o&&"#"!==o.substr(0,1)){if("@<TRIPOS>MOLECULE"==o){t.molTitle=s[e+1].trim();let n=s[e+2].trim().replace(/\s+/g," ").split(" ");i=n[0],l=n[1],e+=4}else"@<TRIPOS>ATOM"==o?(c=1,h=!0,++e):"@<TRIPOS>BOND"==o?(m=!0,h=!1,++e):"@<TRIPOS>SUBSTRUCTURE"==o&&(m=!1,++e);if(o=s[e].trim(),""!==o&&"#"!==o.substr(0,1)){if(h&&a<i){let e=o.replace(/\s+/g," ").split(" "),s=parseInt(e[0]);p[s]=c;let i,l=e[1],d=parseFloat(e[2]),h=parseFloat(e[3]),m=parseFloat(e[4]),C=new THREE.Vector3(d,h,m),g=e[5],f=g.indexOf(".");if(i=-1===f?g:g.substr(0,f),"H"===i&&i===g)u[s]=1;else{let e={het:!0,serial:c,name:l,resn:n,structure:1,chain:"A",resi:1,coord:C,b:0,elem:i,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};t.atoms[c]=e,r[c]=1,++c}++a}if(m&&d<l){let e=o.replace(/\s+/g," ").split(" "),s=parseInt(e[1]),i=parseInt(e[2]),l=e[3],n=l;if("am"===l&&(n="1"),"ar"===l&&(n="1.5"),!(u.hasOwnProperty(s)||u.hasOwnProperty(i)||"1"!==n&&"2"!==n&&"3"!==n&&"1.5"!==n)){let e=n,l=p[s],r=p[i];t.atoms[l].bonds.push(r),t.atoms[l].bondOrder.push(e),t.atoms[r].bonds.push(l),t.atoms[r].bondOrder.push(e),"2"==e?(t.doublebonds[l+"_"+r]=1,t.doublebonds[r+"_"+l]=1):"3"==e?(t.triplebonds[l+"_"+r]=1,t.triplebonds[r+"_"+l]=1):"1.5"==e&&(t.aromaticbonds[l+"_"+r]=1,t.aromaticbonds[r+"_"+l]=1)}++d}}}}t.dAtoms=r,t.hAtoms=r,t.structures[1]=[o],t.chains["1_A"]=r,t.residues["1_A_1"]=r,t.residueId2Name["1_A_1"]=n,void 0===t.chainsSeq["1_A"]&&(t.chainsSeq["1_A"]=[]);let C={resi:1};return C.name=n,t.chainsSeq["1_A"].push(C),t.ParserUtilsCls.setMaxD(),t.saveFileCls.showTitle(),!0}}class ee{constructor(e){this.icn3d=e}applyDssp(e,t){let s=this.icn3d,i=s.icn3dui,l=this,n=e?"1":"0",r=Object.keys(s.structures),o=[];for(let e=0,t=r.length;e<t;++e){let t="",l={},a=s.structures[r[e]];for(let e=0,t=a.length;e<t;++e)l=i.hashUtilsCls.unionHash(l,s.chains[a[e]]);t+=s.saveFileCls.getAtomPDB(l,void 0,!0);let d=$.ajax({url:"/Structure/mmcifparser/mmcifparser.cgi",type:"POST",data:{dssp:"t",calphaonly:n,pdbfile:t},dataType:"jsonp",cache:!0});o.push(d)}$.when.apply(void 0,o).then((function(){let e=1==r.length?[arguments]:Array.from(arguments);l.parseDsspData(e,r,t)})).fail((function(){s.pdbParserCls.loadPdbDataRender(t),void 0!==s.deferredSecondary&&s.deferredSecondary.resolve()}))}parseDsspData(e,t,s){let i=this.icn3d;i.icn3dui;for(let s=0,l=e.length;s<l;++s){let l=e[s][0];if(void 0!==l&&-1===JSON.stringify(l).indexOf("Oops there was a problem"))for(let e in i.chainsSeq){let n=e.indexOf("_");if(e.substr(0,n)!=t[s])continue;let r,o=e.substr(n+1),a=i.chainsSeq[e],d="coil";for(let t=0,s=a.length;t<s;++t){let s,n=a[t].resi,c=o+"_"+n,h="c";l.hasOwnProperty(c)?h=l[c]:l.hasOwnProperty(" _"+n)?h=l[" _"+n]:l.hasOwnProperty("_"+n)&&(h=l["_"+n]),s="H"===h?"helix":"E"===h?"sheet":"coil";let m=e+"_"+n;i.secondaries[m]=h;let p,u,C=0;if(s!==d?"coil"===d?(p=!0,u=!1):"coil"===s?(C=2,p=!1,u=!1):("sheet"===d&&"helix"===s||"helix"===d&&"sheet"===s)&&(C=2,p=!0,u=!1):(p=!1,u=!1),1==C){let t=e+"_"+r;for(let e in i.residues[t])i.atoms[e].ssbegin=!0,i.atoms[e].ssend=!1}else if(2==C){let t=e+"_"+r;for(let e in i.residues[t])i.atoms[e].ssbegin=!1,i.atoms[e].ssend=!0}for(let e in i.residues[m])i.atoms[e].ss=s,i.atoms[e].ssbegin=p,i.atoms[e].ssend=u;d=s,r=n}}else console.log("DSSP calculation had a problem with this structure "+t[s]+"...")}i.pdbParserCls.loadPdbDataRender(s),void 0!==i.deferredMmdbaf&&i.deferredMmdbaf.resolve(),void 0!==i.deferredSecondary&&i.deferredSecondary.resolve()}}class te{constructor(e){this.icn3d=e}downloadPdb(e,t){let s,i,l=this.icn3d;l.icn3dui,t?(s="https://alphafold.ebi.ac.uk/files/AF-"+e+"-F1-model_v2.pdb",l.ParserUtilsCls.setYourNote(e.toUpperCase()+"(AlphaFold) in iCn3D")):(s="https://files.rcsb.org/view/"+e+".pdb",l.ParserUtilsCls.setYourNote(e.toUpperCase()+"(PDB) in iCn3D")),i="text",l.bCid=void 0,$.ajax({url:s,dataType:"text",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){l.ParserUtilsCls.showLoading()},complete:function(){},success:function(s){return l.deferredOpm=$.Deferred((function(){if(t){s="HEADER                                                        "+e+"\n"+s,l.opmParserCls.parseAtomData(s,e,void 0,"pdb",void 0)}else l.opmParserCls.loadOpmData(s,e,void 0,"pdb")})),l.deferredOpm.promise()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}downloadUrl(e,t,s){let i=this.icn3d,l=i.icn3dui,n=this,r=e.lastIndexOf("/");if(-1!=r){let t=e.lastIndexOf(".");i.filename=e.substr(r+1,t-r-1)}else{let t=e.lastIndexOf(".");i.filename=e.substr(0,t)}i.bCid=void 0,$.ajax({url:e,dataType:"text",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(e){i.InputfileData=i.InputfileData?i.InputfileData+"\nENDMDL\n"+e:e,i.InputfileType=t,"pdb"===t?(n.loadPdbData(e),i.loadScriptCls.loadScript(s)):"mol2"===t?i.mol2ParserCls.loadMol2Data(e):"sdf"===t?i.sdfParserCls.loadSdfData(e):"xyz"===t?i.xyzParserCls.loadXyzData(e):"mmcif"===t?i.mmcifParserCls.loadMmcifData(e):"icn3dpng"===t&&(i.mmcifParserCls.loadMmcifData(e),l.htmlCls.setHtmlCls.loadPng(e,s))},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}loadPdbData(e,t,s,i,l,n,r){let o=this.icn3d,a=o.icn3dui;if(!i&&(void 0===l||"target"===l)){let e=!!o.bCommandLoad;o.bStatefile||o.init(e)}let d=o.loadPDBCls.loadPDB(e,t,s,void 0,void 0,i,l,n);void 0===a.cfg.opmid&&o.ParserUtilsCls.transformToOpmOri(t),void 0!==o.biomtMatrices&&o.biomtMatrices.length>1?($("#"+o.pre+"assemblyWrapper").show(),o.asuCnt=o.biomtMatrices.length):$("#"+o.pre+"assemblyWrapper").hide(),void 0!==o.emd?($("#"+o.pre+"mapWrapper1").hide(),$("#"+o.pre+"mapWrapper2").hide(),$("#"+o.pre+"mapWrapper3").hide()):($("#"+o.pre+"emmapWrapper1").hide(),$("#"+o.pre+"emmapWrapper2").hide(),$("#"+o.pre+"emmapWrapper3").hide());let c=!1;return o.bSecondaryStructure&&1==Object.keys(o.structures).length?c=!1:a.cfg.mmtfid||a.cfg.pdbid||a.cfg.opmid||a.cfg.mmdbid||a.cfg.gi||a.cfg.uniprotid||a.cfg.blast_rep_id||a.cfg.cid||a.cfg.mmcifid||a.cfg.align||a.cfg.chainalign||(c=!0),(!o.bSecondaryStructure||c)&&Object.keys(o.proteins).length>0&&!r?this.applyCommandDssp(i):this.loadPdbDataRender(i),d}applyCommandDssp(e){let t=this.icn3d,s=t.icn3dui;return t.deferredSecondary=$.Deferred((function(){let i=s.utilsCls.isCalphaPhosOnly(s.hashUtilsCls.hash2Atoms(t.proteins,t.atoms));t.dsspCls.applyDssp(i,e)})),t.deferredSecondary.promise()}loadPdbDataRender(e){let t=this.icn3d,s=t.icn3dui;t.pmid=t.pmid,void 0===s.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),s.cfg.afid&&(t.opts.color="confidence"),t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.hAtoms),t.ParserUtilsCls.renderStructure(),t.saveFileCls.showTitle(),void 0!==s.cfg.rotate&&t.resizeCanvasCls.rotStruc(s.cfg.rotate,!0),e&&t.definedSetsCls.setModeAndDisplay("all")}}class se{constructor(e){this.icn3d=e}downloadMmtf(e){let t=this.icn3d;t.icn3dui,t.ParserUtilsCls.setYourNote(e.toUpperCase()+"(MMTF) in iCn3D"),t.bCid=void 0,MMTF.fetchReduced(e,(function(s){if(10*s.numAtoms>t.maxatomcnt){let i=!1;return 0==Object.keys(s).length?void alert("This PDB structure is not found at RCSB..."):(t.deferredOpm=$.Deferred((function(){t.opmParserCls.loadOpmData(s,e,i,"mmtf")})),t.deferredOpm.promise())}s=null,MMTF.fetch(e,(function(s){if(0!=Object.keys(s).length)return t.deferredOpm=$.Deferred((function(){t.opmParserCls.loadOpmData(s,e,true,"mmtf")})),t.deferredOpm.promise();alert("This PDB structure is not found at RCSB...")}),(function(e){}))}),(function(e){}))}parseMmtfData(e,t,s){let i=this.icn3d,l=i.icn3dui;e.numAtoms,i.init();let n=new THREE.Vector3(9999,9999,9999),r=new THREE.Vector3(-9999,-9999,-9999),o=new THREE.Vector3,a=e.structureId;if(i.molTitle=e.title,void 0!==e.bioAssemblyList&&void 0!==e.bioAssemblyList[0]&&e.bioAssemblyList[0].transformList.length>1){i.biomtMatrices=[];for(let t=0,s=e.bioAssemblyList[0].transformList.length;t<s;++t){let s=(new THREE.Matrix4).fromArray(e.bioAssemblyList[0].transformList[t].matrix).transpose();i.biomtMatrices.push(s)}}void 0!==i.biomtMatrices&&i.biomtMatrices.length>1?($("#"+i.pre+"assemblyWrapper").show(),i.asuCnt=i.biomtMatrices.length):$("#"+i.pre+"assemblyWrapper").hide();let d,c,h,m,p,u,C,g,f,b,y,v,_,S,w,A,x,k,O,H={},D=[],R="coil",I="",E=0,T=0,M={onModel:function(e){d=0===e.modelIndex?a:a+(e.modelIndex+1).toString()},onChain:function(e){c=e.chainName;let t=d+"_"+c;void 0===i.structures[d]&&(i.structures[d]=[]),i.structures[d].push(t)},onGroup:function(e){h=e.groupName,m=e.groupId;let t=d+"_"+c+"_"+m;p=0===e.secStruct||2===e.secStruct||4===e.secStruct?"helix":3===e.secStruct?"sheet":-1===e.secStruct?"other":"coil";let s=!1;if(c!==I){if(x=void 0,O=void 0,"coil"!==p&&"other"!==p?(u=!0,C=!1):(u=!1,C=!1),"coil"!==R&&"other"!==R){let e=d+"_"+I+"_"+E.toString();for(let t in i.residues[e])i.atoms[t].ssbegin=!1,i.atoms[t].ssend=!0}}else x=A,O=k,p!==R?"coil"===R||"other"===R?(u=!0,C=!1):"coil"===p||"other"===p?(s=!0,u=!1,C=!1):("sheet"===R&&"helix"===p||"helix"===R&&"sheet"===p)&&(s=!0,u=!0,C=!1):(u=!1,C=!1);if(s&&!isNaN(m)){let e=d+"_"+c+"_"+(m-1).toString();for(let t in i.residues[e])i.atoms[t].ssbegin=!1,i.atoms[t].ssend=!0}R=p,I=c,E=m,g=!1,f=!1,b=!1,"non-polymer"===e.chemCompType.toLowerCase()||"other"===e.chemCompType.toLowerCase()||-1!==e.chemCompType.toLowerCase().indexOf("saccharide")?g=!0:-1!==e.chemCompType.toLowerCase().indexOf("peptide")?f=!0:-1!==e.chemCompType.toLowerCase().indexOf("dna")||-1!==e.chemCompType.toLowerCase().indexOf("rna")?b=!0:f=!0;let n=d+"_"+c,r={};r.resi=m,r.name=l.utilsCls.residueName2Abbr(h),i.residueId2Name[t]=r.name,r.resi%10==0&&r.resi.toString();let o="-";"helix"===p?o="H":"sheet"===p?o="E":"coil"===p?o="c":"other"===p&&(o="o"),void 0===i.chainsSeq[n]&&(i.chainsSeq[n]=[]),i.bFullUi&&i.chainsSeq[n].push(r),i.secondaries[t]=o},onAtom:function(e){if(y=e.element,v=e.atomName,_=new THREE.Vector3(e.xCoord,e.yCoord,e.zCoord),S=e.bFactor,w=e.altLoc,"\0"===e.altLoc&&(w=""),""===w||"A"===w){++T,"SG"===v&&D.push(T),H[e.atomIndex]=T;let t={het:g,serial:T,name:v,alt:w,resn:h,structure:d,chain:c,resi:m,coord:_,b:S,elem:y,bonds:[],bondOrder:[],ss:p,ssbegin:u,ssend:C};if(t.het||"C"!==t.name||(A=T),t.het||"O"!==t.name||(k=T),!t.het&&"N"===t.name&&void 0!==x&&void 0!==O){let e=i.atoms[x].coord.distanceTo(i.atoms[O].coord),s=t.coord.x+(i.atoms[x].coord.x-i.atoms[O].coord.x)/e,l=t.coord.y+(i.atoms[x].coord.y-i.atoms[O].coord.y)/e,n=t.coord.z+(i.atoms[x].coord.z-i.atoms[O].coord.z)/e;t.hcoord=new THREE.Vector3(s,l,n)}i.atoms[T]=t,n.min(_),r.max(_),o.add(_);let a=d+"_"+c,R=a+"_"+m;void 0===i.chains[a]&&(i.chains[a]={}),i.chains[a][T]=1,void 0===i.residues[R]&&(i.residues[R]={}),i.residues[R][T]=1,f?(i.proteins[T]=1,"CA"===v&&(i.calphas[T]=1),"N"!==v&&"CA"!==v&&"C"!==v&&"O"!==v&&(i.sidec[T]=1)):b?(i.nucleotides[T]=1,(!s||"O3'"!=v&&"O3*"!=v)&&(s||"P"!=v)||(i.nucleotidesO3[T]=1),-1===l.parasCls.nuclMainArray.indexOf(v)&&(i.ntbase[T]=1)):y.toLowerCase()===h.toLowerCase()?i.ions[T]=1:"HOH"===h||"WAT"===h||"SQL"===h||"H2O"===h||"W"===h||"DOD"===h||"D3O"===h?i.water[T]=1:i.chemicals[T]=1,i.dAtoms[T]=1,i.hAtoms[T]=1}},onBond:function(e){let t=H[e.atomIndex1],s=H[e.atomIndex2];if(H.hasOwnProperty(e.atomIndex1)&&H.hasOwnProperty(e.atomIndex2)&&(i.atoms[t].bonds.push(s),i.atoms[s].bonds.push(t),g)){let l=e.bondOrder;i.atoms[t].bondOrder.push(l),i.atoms[s].bondOrder.push(l),2===l?(i.doublebonds[t+"_"+s]=1,i.doublebonds[s+"_"+t]=1):3===l&&(i.triplebonds[t+"_"+s]=1,i.triplebonds[s+"_"+t]=1)}}};MMTF.traverse(e,M);for(let e=0,t=D.length;e<t;++e)for(let s=e+1;s<t;++s){let t=D[e],l=D[s],n=i.atoms[t],r=i.atoms[l];if(-1!==$.inArray(l,n.bonds)){let e=n.structure+"_"+n.chain+"_"+n.resi,t=r.structure+"_"+r.chain+"_"+r.resi;void 0===i.ssbondpnts[n.structure]&&(i.ssbondpnts[n.structure]=[]),i.ssbondpnts[n.structure].push(e),i.ssbondpnts[n.structure].push(t)}}i.cnt=T,(i.cnt>i.maxatomcnt||void 0!==i.biomtMatrices&&i.biomtMatrices.length*i.cnt>10*i.maxatomcnt)&&(i.opts.proteins="c alpha trace",i.opts.nucleotides="o3 trace"),i.pmin=n,i.pmax=r,i.center=i.ParserUtilsCls.getGeoCenter(i.pmin,i.pmax),i.maxD=i.ParserUtilsCls.getStructureSize(i.atoms,i.pmin,i.pmax,i.center),i.maxD<5&&(i.maxD=5),i.oriMaxD=i.maxD,i.oriCenter=i.center.clone(),i.ParserUtilsCls.transformToOpmOri(t),void 0===l.cfg.align&&1==Object.keys(i.structures).length&&$("#"+i.pre+"alternateWrapper").hide(),i.setStyleCls.setAtomStyleByOptions(i.opts),i.setColorCls.setColorByOptions(i.opts,i.atoms),i.ParserUtilsCls.renderStructure(),i.saveFileCls.showTitle(),void 0!==l.cfg.rotate&&i.resizeCanvasCls.rotStruc(l.cfg.rotate,!0)}}class ie{constructor(e){this.icn3d=e}downloadAlignment(e){let t=this.icn3d,s=t.icn3dui,i=this;t.opts.proteins="c alpha trace";let l=e.split(","),n="ids="+e,r=s.htmlCls.baseUrl+"vastplus/vastplus.cgi?v=3&cmd=c&b=1&s=1&w3d&"+n;void 0!==s.cfg.inpara&&(r+=s.cfg.inpara),t.bCid=void 0,t.pdbid_chain2title={},void 0===t.chainids2resids&&(t.chainids2resids={});let o=$.ajax({url:r,dataType:"jsonp",cache:!0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){}}),a={};o.fail((function(){return alert("These two MMDB IDs "+l+' do not have 3D alignment data in the VAST+ database. You can try the VAST alignment by visiting the VAST+ page https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid=[PDB ID] (e.g., uid=1KQ2), and clicking "Original VAST"'),!1})).then((function(e){if(a=e.seqalign,void 0===a)return alert("These two MMDB IDs "+l+' do not have 3D alignment data in the VAST+ database. You can try the VAST alignment by visiting the VAST+ page https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid=[PDB ID] (e.g., uid=1KQ2), and clicking "Original VAST"'),!1;t.pdbid_molid2chain={},t.chainsColor={};for(let i=0,l=2;i<l;++i){let l=e.alignedStructures[0][i],n=void 0!==l.pdbId?l.pdbId:l.mmdbId,r={};for(let e=0,i=l.molecules.length;e<i;++e){let i=l.molecules[e],o=i.moleculeId,a=i.chain.trim();void 0===r[a]?r[a]=1:++r[a];let d=1===r[a]?a:a+r[a].toString();t.pdbid_molid2chain[n+"_"+o]=d,"p"!==i.kind&&"n"!==i.kind||(t.chainsColor[n+"_"+d]=s.parasCls.thr(s.htmlCls.GREY8))}}t.mmdbidArray=[];for(let s=0,i=2;s<i;++s){let i=e.alignedStructures[0][s],l=i.pdbId;t.mmdbidArray.push(l);let n=i.molecules;for(let e in n){let s=n[e].chain;t.pdbid_chain2title[l+"_"+s]=n[e].name}}t.alignmolid2color=[],s.parasCls.stdChainColors.length;for(let e=0,s=a.length;e<s;++e){let s=a[e][0].moleculeId,i=a[e][1].moleculeId,l={};l[s]=(e+1).toString(),t.alignmolid2color.push(l),l={},l[i]=(e+1).toString(),t.alignmolid2color.push(l)}let n=s.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&bu="+s.cfg.bu+"&uid="+t.mmdbidArray[0],r=s.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&bu="+s.cfg.bu+"&uid="+t.mmdbidArray[1],o=$.ajax({url:n,dataType:"jsonp",cache:!0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){}}),d=$.ajax({url:r,dataType:"jsonp",cache:!0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){}});$.when(o,d).then((function(s,l){let n=e,r=s[0],o=l[0];return void 0!==r.atoms&&void 0!==o.atoms?(t.deferredOpm=$.Deferred((function(){t.ParserUtilsCls.setYourNote((t.mmdbidArray[0]+","+t.mmdbidArray[1]).toUpperCase()+"(VAST+) in iCn3D");let e=n.transform.translate.master,s=new THREE.Vector3(e[0]/1,e[1]/1,e[2]/1),l=n.transform.translate.slave,d=new THREE.Vector3(l[0]/1,l[1]/1,l[2]/1),c=n.transform.rotate,h=[];for(let e=0,t=c.length;e<t;++e)h.push(c[e]/1);t.chainid2seq={};for(let e in r.sequences){let s=t.mmdbidArray[0]+"_"+e;t.chainid2seq[s]=r.sequences[e]}for(let e in o.sequences){let s=t.mmdbidArray[1]+"_"+e;t.chainid2seq[s]=o.sequences[e]}let m=r.atoms,p=o.atoms,u=r.atomCount,C=o.atomCount;for(let e=0,t=n.alignedStructures[0].length;e<t;++e){let t=n.alignedStructures[0][e];t.serialInterval=[],0==e?(t.serialInterval.push(1),t.serialInterval.push(u)):1==e&&(t.serialInterval.push(u+1),t.serialInterval.push(u+C))}let g={};for(let e in m){let t=m[e];t.coord=new THREE.Vector3(t.coord[0],t.coord[1],t.coord[2]),t.coord.add(s);let i=t.coord.x*h[0]+t.coord.y*h[1]+t.coord.z*h[2],l=t.coord.x*h[3]+t.coord.y*h[4]+t.coord.z*h[5],n=t.coord.x*h[6]+t.coord.y*h[7]+t.coord.z*h[8];t.coord.x=i,t.coord.y=l,t.coord.z=n,g[e]=t}for(let e in p){let t=p[e];t.coord=new THREE.Vector3(t.coord[0],t.coord[1],t.coord[2]),t.coord.add(d);for(let e=0,s=t.bonds.length;e<s;++e)t.bonds[e]+=u;g[(parseInt(e)+u).toString()]=t}let f={};f.alignedStructures=n.alignedStructures,f.alignment=n.alignment,f.atoms=g,i.loadOpmDataForAlign(f,a,t.mmdbidArray)})),t.deferredOpm.promise()):(alert("invalid atoms data."),!1)}))}))}downloadAlignmentPart2(e,t,s){let i=this.icn3d,l=i.icn3dui;i.loadAtomDataCls.loadAtomDataIn(e,void 0,"align",t),void 0===l.cfg.align&&1==Object.keys(i.structures).length&&$("#"+i.pre+"alternateWrapper").hide();let n={};for(let e in i.atoms)n[e]=1;i.dAtoms=n,i.hAtoms=n,i.setStyleCls.setAtomStyleByOptions(i.opts),i.setColorCls.setColorByOptions(i.opts,i.atoms),void 0!==s&&i.ParserUtilsCls.transformToOpmOriForAlign(i.selectedPdbid,s,!0),i.ParserUtilsCls.renderStructure(),void 0!==l.cfg.rotate&&i.resizeCanvasCls.rotStruc(l.cfg.rotate,!0),i.html2ddgm="",l.cfg.showalignseq&&l.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),l.cfg.show2d&&i.bFullUi&&i.ParserUtilsCls.set2DDiagramsForAlign(i.mmdbidArray[0].toUpperCase(),i.mmdbidArray[1].toUpperCase())}loadOpmDataForAlign(e,t,s){let i=this.icn3d;i.icn3dui;let l,n,r=this;l="https://opm-assets.storage.googleapis.com/pdb/"+s[0].toLowerCase()+".pdb",n="text",$.ajax({url:l,dataType:n,cache:!0,success:function(l){i.selectedPdbid=s[0],i.bOpm=!0;let n=i.loadPDBCls.loadPDB(l,s[0],i.bOpm,!0);$("#"+i.pre+"selectplane_z1").val(i.halfBilayerSize),$("#"+i.pre+"selectplane_z2").val(-i.halfBilayerSize),$("#"+i.pre+"extra_mem_z").val(i.halfBilayerSize),$("#"+i.pre+"intra_mem_z").val(-i.halfBilayerSize),i.init(),r.downloadAlignmentPart2(e,t,n),void 0!==i.deferredOpm&&i.deferredOpm.resolve()},error:function(l,o,a){let d="https://opm-assets.storage.googleapis.com/pdb/"+s[1].toLowerCase()+".pdb";$.ajax({url:d,dataType:n,cache:!0,success:function(l){i.selectedPdbid=s[1],i.bOpm=!0;let n=i.loadPDBCls.loadPDB(l,s[1],i.bOpm,!0);$("#"+i.pre+"selectplane_z1").val(i.halfBilayerSize),$("#"+i.pre+"selectplane_z2").val(-i.halfBilayerSize),$("#"+i.pre+"extra_mem_z").val(i.halfBilayerSize),$("#"+i.pre+"intra_mem_z").val(-i.halfBilayerSize),i.init(),r.downloadAlignmentPart2(e,t,n),void 0!==i.deferredOpm&&i.deferredOpm.resolve()},error:function(s,l,n){i.init(),r.downloadAlignmentPart2(e,t),void 0!==i.deferredOpm&&i.deferredOpm.resolve()}})}})}}class le{constructor(e){this.icn3d=e}downloadOpm(e){let t,s,i=this.icn3d;i.icn3dui,t="https://opm-assets.storage.googleapis.com/pdb/"+e.toLowerCase()+".pdb",i.ParserUtilsCls.setYourNote(e.toUpperCase()+"(OPM) in iCn3D"),s="text",i.bCid=void 0,i.bStopRotate=!0,$.ajax({url:t,dataType:"text",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(t){i.bOpm=!0,i.pdbParserCls.loadPdbData(t,e,i.bOpm),$("#"+i.pre+"selectplane_z1").val(i.halfBilayerSize),$("#"+i.pre+"selectplane_z2").val(-i.halfBilayerSize),$("#"+i.pre+"extra_mem_z").val(i.halfBilayerSize),$("#"+i.pre+"intra_mem_z").val(-i.halfBilayerSize)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):alert("This is probably not a transmembrane protein. It has no data in Orientations of Proteins in Membranes(OPM) database.")}})}loadOpmData(e,t,s,i,l){this.icn3d.icn3dui;let n,r,o=this;t||(t="STRU"),n="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&opm&uid="+t.toLowerCase(),r="jsonp",$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(n){o.setOpmData(n),o.parseAtomData(e,t,s,i,l)},error:function(n,r,a){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):o.parseAtomData(e,t,s,i,l)}})}setOpmData(e){let t=this.icn3d;t.icn3dui,void 0!==e.opm&&void 0!==e.opm.rot?(t.bOpm=!0,t.halfBilayerSize=e.opm.thickness,t.rmsd_supr={},t.rmsd_supr.rot=e.opm.rot,t.rmsd_supr.trans1=new THREE.Vector3(e.opm.trans1[0],e.opm.trans1[1],e.opm.trans1[2]),t.rmsd_supr.trans2=new THREE.Vector3(e.opm.trans2[0],e.opm.trans2[1],e.opm.trans2[2]),t.rmsd_supr.rmsd=e.opm.rmsd,$("#"+t.pre+"selectplane_z1").val(t.halfBilayerSize),$("#"+t.pre+"selectplane_z2").val(-t.halfBilayerSize),$("#"+t.pre+"extra_mem_z").val(t.halfBilayerSize),$("#"+t.pre+"intra_mem_z").val(-t.halfBilayerSize)):t.bOpm=!1}parseAtomData(e,t,s,i,l){let n=this.icn3d;n.icn3dui,"mmtf"===i?(n.mmtfParserCls.parseMmtfData(e,t,s),void 0!==n.deferredOpm&&n.deferredOpm.resolve()):"mmcif"===i?(n.loadAtomDataCls.loadAtomDataIn(e,e.mmcif,"mmcifid",void 0,void 0),n.mmcifParserCls.loadMmcifOpmDataPart2(e,t),void 0!==n.deferredOpm&&n.deferredOpm.resolve()):"pdb"===i?(n.pdbParserCls.loadPdbData(e,t),void 0!==n.deferredOpm&&n.deferredOpm.resolve()):"align"===i&&(n.bOpm?(n.alignParserCls.downloadAlignmentPart2(t),void 0!==n.deferredOpm&&n.deferredOpm.resolve()):void 0!==l?this.loadOpmData(e,l,s,i):(n.alignParserCls.downloadAlignmentPart2(t),void 0!==n.deferredOpm&&n.deferredOpm.resolve()))}}class ne{constructor(e){this.icn3d=e}parseMmdbDataPart1(e,t){let s=this.icn3d,i=s.icn3dui;if(void 0===e.atoms&&void 0===e.molid2rescount)return alert("invalid MMDB data."),!1;if(void 0===t||"target"===t){let e=!!s.bCommandLoad;s.bStatefile||s.init(e),s.chainsColor={},s.chainsGene={}}"query"===t||(s.interactionData={moleculeInfor:e.moleculeInfor,intrac:e.intrac,intracResidues:e.intracResidues}),"query"===t||(s.mmdb_data=e);let l=void 0!==e.pdbId?e.pdbId:e.mmdbId;"query"===t?s.inputid2=l:s.inputid=l;let n=e.moleculeInfor,r={},o={},a={},d={};for(let e in n){if(0===Object.keys(n[e]).length)continue;let c=void 0===n[e].color?"#CCCCCC":"#"+("000000"+n[e].color.toString(16)).slice(-6),h=void 0===n[e].chain?"":n[e].chain.trim();void 0===d[h]?d[h]=1:++d[h];let m=l+"_"+(1===d[h]?h:h+d[h].toString());r[e]=c,o[m]=e,a[e]=m,s.chainsColor[m]=void 0!==t?i.parasCls.thr(i.htmlCls.GREY8):i.parasCls.thr(c);let p=void 0===n[e].geneId?"":n[e].geneId,u=void 0===n[e].geneSymbol?"":n[e].geneSymbol,C=void 0===n[e].geneDesc?"":n[e].geneDesc;s.chainsGene[m]={geneId:p,geneSymbol:u,geneDesc:C}}s.molid2chain=a,$("#"+s.pre+"accordion5").show()}parseMmdbData(e,t,s,i,l,n){let r=this.icn3d;if(r.icn3dui,void 0!==t){this.parseMmdbDataPart1(e,t);let o=void 0!==e.pdbId?e.pdbId:e.mmdbId,a=r.loadAtomDataCls.loadAtomDataIn(e,o,"mmdbid",void 0,t,s,i,l,n);return this.loadMmdbOpmDataPart2(e,o,t),a}{let s=void 0!==e.pdbId?e.pdbId:e.mmdbId;this.loadMmdbOpmData(e,s,t)}}downloadMmdb(e,t){let s,i=this.icn3d,l=i.icn3dui,n=this;s=t?l.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&bu="+l.cfg.bu+"&simple=1&gi="+e:l.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&bu="+l.cfg.bu+"&simple=1&uid="+e,void 0!==l.cfg.blast_rep_id&&(s+="&bu=0"),i.bCid=void 0,void 0!==l.cfg.inpara&&(s+=l.cfg.inpara),void 0===i.chainids2resids&&(i.chainids2resids={}),$.ajax({url:s,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(r){if(0==Object.keys(r.atoms).length){let e=r.pdbId;return void i.mmtfParserCls.downloadMmtf(e)}l.utilsCls.isCalphaPhosOnly(r.atoms)||r.atomCount<=i.maxatomcnt?n.parseMmdbData(r):(r=null,$.ajax({url:s+"&complexity=2",dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(e){n.parseMmdbData(e)},error:function(s,i,n){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):t?alert("This gi "+e+" has no corresponding 3D structure..."):alert("This mmdbid "+e+" with the parameters "+l.cfg.inpara+" may not have 3D structure data. Please visit the summary page for details: "+l.htmlCls.baseUrl+"pdb/"+e)}}))},error:function(s,i,n){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):t?alert("This gi "+e+" has no corresponding 3D structure..."):alert("This mmdbid "+e+" with the parameters "+l.cfg.inpara+" may not have 3D structure data. Please visit the summary page for details: "+l.htmlCls.baseUrl+"pdb/"+e)}})}downloadMmdbPart2(e){let t=this.icn3d,s=t.icn3dui;t.bAssemblyUseAsu?$("#"+t.pre+"assemblyWrapper").show():$("#"+t.pre+"assemblyWrapper").hide(),void 0!==t.emd?($("#"+t.pre+"mapWrapper1").hide(),$("#"+t.pre+"mapWrapper2").hide(),$("#"+t.pre+"mapWrapper3").hide()):($("#"+t.pre+"emmapWrapper1").hide(),$("#"+t.pre+"emmapWrapper2").hide(),$("#"+t.pre+"emmapWrapper3").hide()),t.setStyleCls.setAtomStyleByOptions(t.opts),void 0!==s.cfg.blast_rep_id?t.setColorCls.setColorByOptions(t.opts,t.atoms):t.setColorCls.setColorByOptions(t.opts,t.atoms,!0),void 0===e&&(t.ParserUtilsCls.renderStructure(),void 0!==s.cfg.rotate&&t.resizeCanvasCls.rotStruc(s.cfg.rotate,!0),t.html2ddgm="",s.cfg.show2d&&(s.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),t.bFullUi&&t.ParserUtilsCls.download2Ddgm(t.inputid.toUpperCase()))),void 0!==s.cfg.align&&void 0!==s.cfg.chainalign&&void 0!==s.cfg.mmdbafid||1!=Object.keys(t.structures).length||null!==$("#"+t.pre+"alternateWrapper")&&$("#"+t.pre+"alternateWrapper").hide()}downloadGi(e){let t=this.icn3d;t.icn3dui,t.bCid=void 0;this.downloadMmdb(e,!0)}downloadBlast_rep_id(e){let t=this.icn3d,s=t.icn3dui;t.bCid=void 0;let i=e.split(",");s.cfg.query_id=i[0],s.cfg.blast_rep_id=i[1];let l=s.cfg.blast_rep_id.split("_")[0];this.downloadMmdb(l)}loadMmdbOpmData(e,t,s){let i=this.icn3d;i.icn3dui,void 0!==e.opm&&void 0!==e.opm.rot?(i.bOpm=!0,i.opmParserCls.setOpmData(e),this.parseMmdbDataPart1(e,s),i.loadAtomDataCls.loadAtomDataIn(e,t,"mmdbid",void 0,s),this.loadMmdbOpmDataPart2(e,t,s)):(this.parseMmdbDataPart1(e,s),i.loadAtomDataCls.loadAtomDataIn(e,t,"mmdbid",void 0,s),this.loadMmdbOpmDataPart2(e,t,s))}loadMmdbOpmDataPart2(e,t,s){let i=this.icn3d,l=i.icn3dui,n=this,r=e.pdbId;void 0===s&&i.ParserUtilsCls.setYourNote(r.toUpperCase()+"(MMDB) in iCn3D");let o=l.cfg.mmdbid||l.cfg.gi||l.cfg.align||l.cfg.chainalign||l.cfg.mmdbafid||l.cfg.blast_rep_id;for(let t in e.domains){let s=e.domains[t].chain,l=r+"_"+s,n=e.domains[t].domains;for(let e=0,t=n.length;e<t;++e){let t=r+"_"+s+"_3d_domain_"+(e+1).toString();i.tddomains[t]={};let a=n[e].intervals,d={},c={};for(let e=0,s=a.length;e<s;++e){let s=Math.round(a[e][0])-1,n=Math.round(a[e][1])-1;if(!d.hasOwnProperty(s)&&!c.hasOwnProperty(n)){d[s]=1,c[n]=1;for(let e=s;e<=n;++e){let s;if(o){let t=l+"_"+(e+1).toString();s=i.residNCBI2resid[t]}else s=l+"_"+(e+1+i.chainid2offset[l]).toString();s&&(i.tddomains[t][s]=1)}}}}}i.bAssemblyUseAsu=void 0!==e.asuAtomCount,void 0!==s?(i.bAssemblyUseAsu=!1,this.downloadMmdbPart2(s)):$.when(i.mmcifParserCls.downloadMmcifSymmetry(t)).then((function(){n.downloadMmdbPart2(s)}))}downloadUniprotid(e){let t=this.icn3d;t.icn3dui;let s="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=protein&retmode=json&id="+e;t.bCid=void 0,$.ajax({url:s,dataType:"json",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){},complete:function(){},success:function(e){let t="https://www.ncbi.nlm.nih.gov/structure?linkname=protein_structure&from_uid="+e.result.uids.join(",");window.open(t,"_self")},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}}class re{constructor(e){this.icn3d=e}realign(){let e=this.icn3d,t=e.icn3dui;e.selectionCls.saveSelectionPrep();let s="alseq_"+Object.keys(e.defNames2Atoms).length;e.selectionCls.saveSelection(s,s);let i={},l={};e.realignResid={};let n="";for(let s in e.hAtoms){let r=e.atoms[s];if(e.proteins.hasOwnProperty(s)&&"CA"==r.name||e.nucleotides.hasOwnProperty(s)&&("O3'"==r.name||"O3*"==r.name)){if(r.structure+"_"+r.resi==n)continue;i.hasOwnProperty(r.structure)||(i[r.structure]=[]),i[r.structure].push(r.coord.clone()),e.realignResid.hasOwnProperty(r.structure)||(e.realignResid[r.structure]=[]),e.realignResid[r.structure].push({resid:r.structure+"_"+r.chain+"_"+r.resi,resn:t.utilsCls.residueName2Abbr(r.resn.substr(0,3)).substr(0,1)}),l[r.structure]=r.structure+"_"+r.chain,n=r.structure+"_"+r.resi}}let r=Object.keys(i),o=r[0];for(let t=1,s=r.length;t<s;++t){let s=r[t],n=i[s],a=i[o],d=!0;e.ParserUtilsCls.alignCoords(n,a,s,d,l[o],l[s])}e.hlUpdateCls.updateHlAll()}parseChainRealignPredefined(e,t,s,i){let l=this.icn3d,n=l.icn3dui,r=e[0].substr(0,e[0].indexOf("_")),o={};l.realignResid={},l.opts.color="grey",l.setColorCls.setColorByOptions(l.opts,l.dAtoms);for(let a=0,d=e.length-1;a<d;++a){let d=e[0]+","+e[a+1],c=e[a+1].substr(0,e[a+1].indexOf("_"));if(r==c&&(c+=n.htmlCls.postfix),!t[d])continue;let h=t[d][r],m=t[d][c],p=s[d][r],u=s[d][c],C=i[d][r],g=i[d][c];l.realignResid[r]=[],l.realignResid[c]=[];for(let e=0,t=h.length;e<t;++e)l.realignResid[r].push({resid:C[e],resn:h[e]}),l.realignResid[c].push({resid:g[e],resn:m[e]});let f=e[0],b=e[a+1],y=!0,v=l.ParserUtilsCls.alignCoords(u,p,c,void 0,f,b,a+1,y);o=n.hashUtilsCls.unionHash(o,v)}l.chainalignParserCls.downloadChainalignmentPart3(void 0,e,o)}parseChainRealignData(e,t,s,i,l,n,r){let o=this.icn3d,a=o.icn3dui,d=s[0].substr(0,s[0].indexOf("_"));r||(d=d.toUpperCase());let c={};o.realignResid={},o.opts.color="grey",o.setColorCls.setColorByOptions(o.opts,o.dAtoms);for(let t=0,h=e.length;t<h;++t){let h=e[t][0];if(!h)continue;let m=s[t+1].substr(0,s[t+1].indexOf("_"));r||(m=m.toUpperCase()),d==m&&(m+=a.htmlCls.postfix);let p,u,C=i[d],g=i[m],f=l[d],b=l[m],y=n[d],v=n[m];if(void 0!==h.data){p=h.data[0].query;let e=Object.keys(h.data[0].targets)[0];u=h.data[0].targets[e],u=u.hsps[0]}if(void 0!==p&&void 0!==u){let e=[],i=[],l="",n="";o.realignResid[d]=[],o.realignResid[m]=[];let r=u.segs;for(let t=0,s=r.length;t<s;++t){let s=r[t],a="",c="";for(let t=0;t<=s.orito-s.orifrom;++t){let r=y[t+s.orifrom].substr(0,y[t+s.orifrom].lastIndexOf("_")),h=v[t+s.from].substr(0,v[t+s.from].lastIndexOf("_"));f[t+s.orifrom]&&b[t+s.from]&&(e.push(f[t+s.orifrom]),i.push(b[t+s.from]),l+=C[t+s.orifrom],n+=g[t+s.from],(0==t||a==r&&c==h||a!=r&&c!=h)&&(o.realignResid[d].push({resid:y[t+s.orifrom],resn:C[t+s.orifrom]}),o.realignResid[m].push({resid:v[t+s.from],resn:g[t+s.from]})),a=r,c=h)}}let h=s[0],p=s[t+1],_=!0,S=o.ParserUtilsCls.alignCoords(i,e,m,void 0,h,p,t+1,_);c=a.hashUtilsCls.unionHash(c,S)}else void 0!==m||a.cfg.command?C&&g&&((C.length<6||g.length<6)&&!a.cfg.command?alert("These sequences are too short for alignment"):C.length>=6&&g.length>=6&&!a.cfg.command&&alert("These sequences can not be aligned to each other")):alert("Please do not align residues in the same structure")}r?(o.dAtoms=c,o.hAtoms=c,o.opts.color="identity",o.setColorCls.setColorByOptions(o.opts,o.hAtoms),o.drawCls.draw(),o.hlUpdateCls.updateHlAll(),void 0!==o.deferredRealign&&o.deferredRealign.resolve()):o.chainalignParserCls.downloadChainalignmentPart3(t,s,c)}realignOnSeqAlign(){let e=this.icn3d;e.icn3dui;let t=e.firstAtomObjCls.getChainsFromAtoms(e.hAtoms),s=Object.keys(t),i=[],l="";for(let e=0,t=s.length;e<t;++e)s[e]!=l&&i.push(s[e]),l=s[e];this.realignChainOnSeqAlign(void 0,i,!0)}realignOnStructAlign(){let e=this.icn3d,t=e.icn3dui,s={};for(let i in e.structures){s[i]={};let l=e.structures[i];for(let n=0,r=l.length;n<r;++n){let r=l[n],o=t.hashUtilsCls.intHash(e.hAtoms,e.chains[r]),a=0;for(let t in o)if(e.atoms[t].ssbegin&&++a,3==a){s[i][r]=o;break}}}let i=[],l=[],n=t.htmlCls.baseUrl+"vastdyn/vastdyn.cgi",r=Object.keys(s);for(let t=0,o=r.length;t<o;++t){let o=r[t],a=Object.keys(s[o]);if(0!=a.length)for(let d=t+1,c=r.length;d<c;++d){let t=r[d],c=Object.keys(s[t]);if(0!=c.length)for(let r=0,d=a.length;r<d;++r){let d=a[r];for(let r=0,a=c.length;r<a;++r){let a=c[r],h=e.domain3dCls.getDomainJsonForAlign(s[o][d]),m=e.domain3dCls.getDomainJsonForAlign(s[t][a]),p=$.ajax({url:n,type:"POST",data:{domains1:m,domains2:h},dataType:"jsonp",cache:!0});i.push(p),l.push(d+","+a)}}}}$.when.apply(void 0,i).then((function(){let t=1==l.length?[arguments]:Array.from(arguments);e.chainalignParserCls.downloadChainalignmentPart2bRealign(t,l)})).fail((function(){alert("These structures can NOT be aligned to each other...")}))}realignChainOnSeqAlign(e,t,s,i){let l,n,r,o,a,d,c,h,m=this.icn3d,p=m.icn3dui,u=this,C={},g={},f={},b=[],y=p.htmlCls.baseUrl+"pwaln/pwaln.fcgi?from=chainalign";if(i&&(a=p.cfg.resdef.trim().replace(/\+/gi," ").split("; "),a.length!=t.length-1))alert("Please make sure the number of chains and the lines of predefined residues are the same...");else{for(let e=0,_=t.length;e<_;++e){let _=t[e].indexOf("_"),S=t[e].substr(0,_);s||(S=S.toUpperCase()),0==e?l=S:l==S&&(S+=p.htmlCls.postfix);let w=S+t[e].substr(_);if(0==e&&(n=w),m.chainsSeq[w])if(C.hasOwnProperty(S)||i||(C[S]="",g[S]=[],f[S]=[]),i)if(o=parseInt(m.chainsSeq[w][0].resi),0==e)r=o;else{d=a[e-1].split(" | ");let t=n+","+w;C[t]||(C[t]={}),g[t]||(g[t]={}),f[t]||(f[t]={}),h=d[0].split(","),c=u.getSeqCoorResid(h,n,r),C[t][l]||(C[t][l]=""),g[t][l]||(g[t][l]=[]),f[t][l]||(f[t][l]=[]),C[t][l]+=c.seq,g[t][l]=g[t][l].concat(c.coor),f[t][l]=f[t][l].concat(c.resid),h=d[1].split(","),c=u.getSeqCoorResid(h,w,o),C[t][S]||(C[t][S]=""),g[t][S]||(g[t][S]=[]),f[t][S]||(f[t][S]=[]),C[t][S]+=c.seq,g[t][S]=g[t][S].concat(c.coor),f[t][S]=f[t][S].concat(c.resid)}else if(0==e){if(o=parseInt(m.chainsSeq[w][0].resi),h=[],s){let e=m.firstAtomObjCls.getResiduesFromAtoms(m.hAtoms);for(var v in e){let e=v.substr(v.lastIndexOf("_")+1);v.substr(0,v.lastIndexOf("_"))==w&&h.push(e)}}else p.cfg.resnum&&(h=p.cfg.resnum.split(","));c=u.getSeqCoorResid(h,w,o),C[S]+=c.seq,g[S]=g[S].concat(c.coor),f[S]=f[S].concat(c.resid)}else{let e=!1;if(s){let t=m.firstAtomObjCls.getResiduesFromAtoms(m.hAtoms);for(var v in t){if(v.substr(0,v.lastIndexOf("_"))==w){e=!0;let t=m.firstAtomObjCls.getFirstAtomObj(m.residues[v]).resn;C[S]+=p.utilsCls.residueName2Abbr(t),g[S]=g[S].concat(this.getResCoorArray(v)),f[S].push(v)}}}if(!e)for(let e=0,t=m.chainsSeq[w].length;e<t;++e){C[S]+=m.chainsSeq[w][e].name;let t=w+"_"+m.chainsSeq[w][e].resi;g[S]=g[S].concat(this.getResCoorArray(t)),f[S].push(t)}let t=S,i=C[l],n=C[t],r=$.ajax({url:y,type:"POST",data:{targets:i,queries:n},dataType:"jsonp",cache:!0});b.push(r)}}i?u.parseChainRealignPredefined(t,C,g,f):$.when.apply(void 0,b).then((function(){let i=2==t.length?[arguments]:Array.from(arguments);u.parseChainRealignData(Array.from(i),e,t,C,g,f,s)})).fail((function(){alert("The realignment did not work...")}))}}getSeqCoorResid(e,t,s){let i=this.icn3d,l=i.icn3dui,n="",r=[],o=[];for(let a=0,d=e.length;a<d;++a)if(-1!=e[a].indexOf("-")){let d=e[a].split("-");for(let e=parseInt(d[0]);e<=parseInt(d[1]);++e){let a=e-s;if(i.bNCBI){let s=i.firstAtomObjCls.getFirstAtomObj(i.residues[t+"_"+e]);s&&s.resiNCBI&&(a=s.resiNCBI-1)}i.chainsSeq[t]&&i.chainsSeq[t][a]&&-1!=l.parasCls.b62ResArray.indexOf(i.chainsSeq[t][a].name.toUpperCase())&&(n+=i.chainsSeq[t][a].name.toUpperCase(),r=r.concat(this.getResCoorArray(t+"_"+e)),o.push(t+"_"+e))}}else{let l=parseInt(e[a]),d=l-s;if(i.bNCBI){let e=i.firstAtomObjCls.getFirstAtomObj(i.residues[t+"_"+l]);e&&e.resiNCBI&&(d=e.resiNCBI-1)}if(!i.chainsSeq[t][d])continue;let c=this.getResCoorArray(t+"_"+l);n+=i.chainsSeq[t][d].name.toUpperCase(),r=r.concat(c),o.push(t+"_"+l)}return{seq:n,coor:r,resid:o}}getResCoorArray(e){let t=this.icn3d;t.icn3dui;let s=[],i=!1;for(let l in t.residues[e]){let e=t.atoms[l];if(t.proteins.hasOwnProperty(l)&&"CA"==e.name&&"C"==e.elem||t.nucleotides.hasOwnProperty(l)&&("O3'"==e.name||"O3*"==e.name)&&"O"==e.elem){s.push(e.coord.clone()),i=!0;break}}return i||s.push(void 0),s}}class oe{constructor(e){this.icn3d=e}downloadChainalignmentPart2(e,t,s,i){let l,n,r=this.icn3d,o=r.icn3dui,a=this,d={},c={};l=i[0].substr(0,i[0].indexOf("_"));let h=!1;if(l.length>4){let t=!1,s=!0;d=r.pdbParserCls.loadPdbData(e,l,!1,t,"target",h,s)}else{let t=!0;d=r.mmdbParserCls.parseMmdbData(e,"target",i[0],0,h,t)}for(let e=0,s=t.length;e<s;++e){if(e==t.length-1&&(h=!0),n=i[e+1].substr(0,i[e+1].indexOf("_")),n.length>4){let s=!0,i=!0;c=r.pdbParserCls.loadPdbData(t[e],n,!1,s,"query",h,i)}else{let s=!0;c=r.mmdbParserCls.parseMmdbData(t[e],"query",i[e+1],e,h,s)}d=o.hashUtilsCls.unionHash(d,c)}o.cfg.resnum?r.realignParserCls.realignChainOnSeqAlign(s,i):o.cfg.resdef?r.realignParserCls.realignChainOnSeqAlign(s,i,void 0,!0):$.when(r.pdbParserCls.applyCommandDssp(!0)).then((function(){for(let e in r.pdbChainIndexHash){let t=r.pdbChainIndexHash[e].split("_");n=t[0],t[1],l=t[2],t[3],a.transformStructure(n,e-1,"query")}let e=[],t=[],c=[],h=o.htmlCls.baseUrl+"vastdyn/vastdyn.cgi";for(let s in r.afChainIndexHash){let i=r.afChainIndexHash[s].split("_");n=i[0];let o=i[1];l=i[2];let a=i[3],d=r.domain3dCls.getDomainJsonForAlign(r.chains[n+"_"+o]),m=r.domain3dCls.getDomainJsonForAlign(r.chains[l+"_"+a]),p=$.ajax({url:h,type:"POST",data:{domains1:d,domains2:m},dataType:"jsonp",cache:!0});e.push(p),t.push(s-1),c.push(n)}$.when.apply(void 0,e).then((function(){let e=1==t.length?[arguments]:Array.from(arguments);a.downloadChainalignmentPart2b(s,i,d,e,t,l,c)})).fail((function(){alert("These structures can NOT be aligned to each other...")}))}))}downloadChainalignmentPart2b(e,t,s,i,l,n,r){let o=this.icn3d,a=o.icn3dui,d=!!o.qt_start_end[0];for(let e=0,t=i.length;e<t;++e){let t=i[e][0],s=r[e],o=l[e],a=s==n,d=!1,c={};this.processAlign(t,o,c,a,d)}d||this.transformStructure(n,l[0],"target");for(let e=0,t=i.length;e<t;++e){let t=r[e],s=l[e];this.transformStructure(t,s,"query")}let c={},h={};for(let e=1,s=t.length;e<s;++e)if(o.bFullUi&&void 0!==o.q_rotation&&!a.cfg.resnum&&!a.cfg.resdef){c=o.setSeqAlignCls.setSeqAlignChain(t[e],e-1),h=a.hashUtilsCls.unionHash(h,c);let s=!1,i=a.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(o.alnChains),void 0,void 0,!1,void 0,s),l=$("#"+o.pre+"dl_sequence2").html();$("#"+o.pre+"dl_sequence2").html(l+i.sequencesHtml),$("#"+o.pre+"dl_sequence2").width(a.htmlCls.RESIDUE_WIDTH*i.maxSeqCnt+200)}o.hAtoms=a.hashUtilsCls.cloneHash(c),this.downloadChainalignmentPart3(e,t,o.hAtoms)}downloadChainalignmentPart2bRealign(e,t){let s=this.icn3d,i=s.icn3dui;s.t_trans_add=[],s.q_trans_sub=[],s.q_rotation=[],s.qt_start_end=[];let l={},n={},r=!1;for(let s=0,i=e.length;s<i;++s){let i=e[s][0],o=!1,a=!1,d={},c=t[s].split(","),h=c[0].substr(0,c[0].indexOf("_")),m=c[1].substr(0,c[1].indexOf("_"));if(n.hasOwnProperty(h+"_"+m))continue;let p=!0;this.processAlign(i,s,d,o,a,p)&&(r=!0,l[h]=void 0===l[h]?1:++l[h],l[m]=void 0===l[m]?1:++l[m],n[h+"_"+m]=c+","+s)}if(!r)return void 0!==s.deferredRealignByStruct&&s.deferredRealignByStruct.resolve(),void alert("These structures can NOT be aligned...");let o,a,d=0;for(let e in n){let t=e.split("_");l[t[0]]>d&&(d=l[t[0]],o=t[0]),l[t[1]]>d&&(d=l[t[1]],o=t[1])}let c={},h={},m={},p={};for(let e in n){let t,l,r=e.split("_"),d=n[e].split(","),u=d[2];o==r[0]?(t=r[0],l=r[1]):o==r[1]?(t=r[1],l=r[0]):(t=r[0],l=r[1]),m[t]=1,m.hasOwnProperty(l)||(m[l]=1,p[e]=n[e],a="target",this.transformStructure(t,u,a),a="query",this.transformStructure(l,u,a),c[d[0]]=1,c[d[1]]=1,h=i.hashUtilsCls.unionHash(h,s.chains[d[0]]),h=i.hashUtilsCls.unionHash(h,s.chains[d[1]]))}for(let e in p)if(void 0!==s.q_rotation){let t=p[e].split(","),l=[t[1],t[0],t[2]];s.setSeqAlignCls.setSeqAlignChain(void 0,void 0,l);let n=!1,r=i.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(s.alnChains),void 0,void 0,!1,void 0,n),o=$("#"+s.pre+"dl_sequence2").html();$("#"+s.pre+"dl_sequence2").html(o+r.sequencesHtml),$("#"+s.pre+"dl_sequence2").width(i.htmlCls.RESIDUE_WIDTH*r.maxSeqCnt+200)}s.dAtoms=h,s.hAtoms=h,s.opts.color="identity",s.setColorCls.setColorByOptions(s.opts,s.hAtoms),i.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),s.drawCls.draw(),s.hlUpdateCls.updateHlAll(),void 0!==s.deferredRealignByStruct&&s.deferredRealignByStruct.resolve()}transformStructure(e,t,s){let i=this.icn3d,l=i.icn3dui,n=i.structures[e];for(let e=0,r=n.length;e<r;++e)for(let r in i.chains[n[e]]){let e=i.atoms[r];void 0!==i.q_rotation&&i.t_trans_add.length>0&&!l.cfg.resnum&&!l.cfg.resdef&&(e=this.transformAtom(e,t,s))}}transformAtom(e,t,s){let i=this.icn3d;if(i.icn3dui,"target"===s);else if("query"===s){e.coord.x-=i.q_trans_sub[t].x,e.coord.y-=i.q_trans_sub[t].y,e.coord.z-=i.q_trans_sub[t].z;let s=e.coord.x*i.q_rotation[t].x1+e.coord.y*i.q_rotation[t].y1+e.coord.z*i.q_rotation[t].z1,l=e.coord.x*i.q_rotation[t].x2+e.coord.y*i.q_rotation[t].y2+e.coord.z*i.q_rotation[t].z2,n=e.coord.x*i.q_rotation[t].x3+e.coord.y*i.q_rotation[t].y3+e.coord.z*i.q_rotation[t].z3;s-=i.t_trans_add[t].x,l-=i.t_trans_add[t].y,n-=i.t_trans_add[t].z,e.coord.x=s,e.coord.y=l,e.coord.z=n}return e}downloadChainalignmentPart3(e,t,s){let i=this.icn3d,l=i.icn3dui,n={};for(let e in i.atoms)n[e]=1;if(i.dAtoms=n,i.hAtoms=n,i.setStyleCls.setAtomStyleByOptions(i.opts),i.opts.color="identity",i.setColorCls.setColorByOptions(i.opts,i.atoms),void 0!==e&&i.ParserUtilsCls.transformToOpmOriForAlign(i.selectedPdbid,e,!0),i.dAtoms=s,i.hAtoms=s,i.ParserUtilsCls.renderStructure(),t.length>2){let e={};for(let t in s){let s=i.atoms[t];e[s.structure+"_"+s.chain+"_"+s.resi]=1}let t="protein_aligned",l="protein aligned",n="select "+i.resid2specCls.residueids2spec(Object.keys(e));i.selectionCls.addCustomSelection(Object.keys(e),t,l,n,!0)}i.hlUpdateCls.updateHlAll(),void 0!==l.cfg.rotate&&i.resizeCanvasCls.rotStruc(l.cfg.rotate,!0),i.html2ddgm="",l.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),l.cfg.show2d&&i.bFullUi&&(l.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),i.bFullUi&&(i.bChainAlign?i.ParserUtilsCls.set2DDiagramsForChainalign(t):i.ParserUtilsCls.download2Ddgm(i.inputid.toUpperCase())))}downloadChainalignment(e,t,s){let i=this.icn3d,l=i.icn3dui,n=this;i.opts.proteins="c alpha trace";let r=e.split(","),o=l.cfg.domainids?l.cfg.domainids.split(","):[];o.length<r.length&&(o=[]);for(let e=0,t=r.length;e<t;++e){let t=r[e],s=t.indexOf("_");r[e]=t.substr(0,s).toUpperCase()+t.substr(s)}i.chainidArray=r;let a=r[0].indexOf("_");i.mmdbid_t=r[0].substr(0,a).toUpperCase(),i.chain_t=r[0].substr(a+1);let d,c,h=[];i.mmdbid_t.length>4?(c="https://alphafold.ebi.ac.uk/files/AF-"+i.mmdbid_t+"-F1-model_v2.pdb",d=$.ajax({url:c,dataType:"text",cache:!0})):(c=l.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&bu="+l.cfg.bu+"&uid="+i.mmdbid_t,void 0!==l.cfg.inpara&&(c+=l.cfg.inpara),d=$.ajax({url:c,dataType:"jsonp",cache:!0})),h.push(d),i.ParserUtilsCls.setYourNote(e.toUpperCase()+" in iCn3D"),i.bCid=void 0,i.pdbid_chain2title={},void 0===i.chainids2resids&&(i.chainids2resids={}),i.afChainIndexHash={},i.pdbChainIndexHash={};for(let e=1,t=r.length;e<t;++e){let t,s,n=r[e].indexOf("_");i.mmdbid_q=r[e].substr(0,n).toUpperCase(),i.chain_q=r[e].substr(n+1),i.mmdbid_q.length>4?(t="https://alphafold.ebi.ac.uk/files/AF-"+i.mmdbid_q+"-F1-model_v2.pdb",s=$.ajax({url:t,dataType:"text",cache:!0})):(t=l.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&bu="+l.cfg.bu+"&uid="+i.mmdbid_q,void 0!==l.cfg.inpara&&(t+=l.cfg.inpara),s=$.ajax({url:t,dataType:"jsonp",cache:!0})),h.push(s)}for(let e=1,t=r.length;e<t;++e){let t=r[e].indexOf("_");if(i.mmdbid_q=r[e].substr(0,t).toUpperCase(),i.chain_q=r[e].substr(t+1),!l.cfg.resnum&&!l.cfg.resdef){let t=i.mmdbid_q+"_"+i.chain_q+","+i.mmdbid_t+"_"+i.chain_t,s=o.length>0?o[e]+","+o[0]:void 0;if(4==i.mmdbid_t.length&&4==i.mmdbid_q.length){let n;n=o.length>0?l.htmlCls.baseUrl+"vastdyn/vastdyn.cgi?domainpairs="+s:l.htmlCls.baseUrl+"vastdyn/vastdyn.cgi?chainpairs="+t;let r=$.ajax({url:n,dataType:"jsonp",cache:!0});h.push(r),i.pdbChainIndexHash[e]=i.mmdbid_q+"_"+i.chain_q+"_"+i.mmdbid_t+"_"+i.chain_t}else i.afChainIndexHash[e]=i.mmdbid_q+"_"+i.chain_q+"_"+i.mmdbid_t+"_"+i.chain_t}}$.when.apply(void 0,h).then((function(){let e=1==r.length?[arguments]:Array.from(arguments);n.parseChainAlignData(e,r,i.mmdbid_t,i.chain_t)})).fail((function(){alert("These chains can not be aligned by VAST server. You can specify the residue range and try it again...")}))}parseChainAlignData(e,t,s,i){let l=this.icn3d,n=l.icn3dui,r=e[0][0],o="HEADER                                                        "+s+"\n";s.length>4&&(r=o+r),l.t_trans_add=[],l.q_trans_sub=[],l.q_rotation=[],l.qt_start_end=[],l.mmdbidArray=[],l.mmdbidArray.push(s);let a=[];for(let s=1,i=t.length;s<i;++s){let i=e[s][0],n=t[s].indexOf("_"),r=t[s].substr(0,n).toUpperCase(),o="HEADER                                                        "+r+"\n";if(r.length>4&&(i=o+i),void 0===i||-1!==JSON.stringify(i).indexOf("Oops there was a problem"))return void alert("The coordinate data can NOT be retrieved for the structure "+r+"...");l.mmdbidArray.push(r),a.push(i)}let d=0;for(let r=1,o=t.length;r<o;++r){let o=a[r-1],c=t[r].indexOf("_"),h=t[r].substr(0,c).toUpperCase(),m=t[r].substr(c+1);if(!n.cfg.resnum&&!n.cfg.resdef){let n=t.length+r-1;if(l.afChainIndexHash.hasOwnProperty(r))++d,l.t_trans_add[r-1]={x:0,y:0,z:0},l.q_trans_sub[r-1]={x:0,y:0,z:0},l.q_rotation[r-1]={x1:1,y1:0,z1:0,x2:0,y2:1,z2:0,x3:0,y3:0,z3:1},l.qt_start_end[r-1]=void 0;else{let t=e[n-d][0],l=h==s,a=m==i;this.processAlign(t,r-1,o,l,a)}}}l.mmdb_data_q=a,this.loadOpmDataForChainalign(r,a,t,l.mmdbidArray)}processAlign(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui,a=!1;if(!(e&&0!=e.length||n))return alert("These chains can not be aligned by VAST server."),a;if(void 0!==s&&-1===JSON.stringify(s).indexOf("Oops there was a problem")&&void 0!==e&&-1===JSON.stringify(e).indexOf("Oops there was a problem"))if((void 0===e||0==e.length)&&i&&l)r.t_trans_add[t]={x:0,y:0,z:0},r.q_trans_sub[t]={x:0,y:0,z:0},r.q_rotation[t]={x1:1,y1:0,z1:0,x2:0,y2:1,z2:0,x3:0,y3:0,z3:1},r.qt_start_end[t]=void 0;else if(void 0===e||0==e.length)o.cfg.command||n||alert('These two chains can not align to each other. Please select sequences from these two chains in the "Sequences & Annotations" window, and click "Realign Selection" in the "File" menu to align your selection.'),r.t_trans_add[t]={x:0,y:0,z:0},r.q_trans_sub[t]={x:0,y:0,z:0},r.q_rotation[t]={x1:1,y1:0,z1:0,x2:0,y2:1,z2:0,x3:0,y3:0,z3:1},r.qt_start_end[t]=void 0,o.cfg.showanno=1,o.cfg.showalignseq=0;else{r.t_trans_add[t]=e[0].t_trans_add,r.q_trans_sub[t]=e[0].q_trans_sub,r.q_rotation[t]=e[0].q_rotation,r.qt_start_end[t]=e[0].segs;let s=e[0].super_rmsd;o.htmlCls.clickMenuCls.setLogCmd("RMSD of alignment: "+s.toPrecision(4),!1),$("#"+r.pre+"realignrmsd").val(s.toPrecision(4)),o.cfg.bSidebyside||o.htmlCls.dialogCls.openDlg("dl_rmsd","RMSD of alignment"),a=!0}return a}loadOpmDataForChainalign(e,t,s,i){let l=this.icn3d,n=l.icn3dui,r=this;if(n.cfg.resnum||n.cfg.resdef)l.bCommandLoad||l.init(),this.downloadChainalignmentPart2(e,t,void 0,s),void 0!==l.deferredOpm&&l.deferredOpm.resolve();else{let o=n.htmlCls.baseUrl+"vastdyn/vastdyn.cgi?mmdbids2opm="+i.join("','");$.ajax({url:o,dataType:"jsonp",cache:!0,success:function(i){let n=i.mmdbid;if(l.selectedPdbid=n,n){let i="https://opm-assets.storage.googleapis.com/pdb/"+n.toLowerCase()+".pdb";$.ajax({url:i,dataType:"text",cache:!0,success:function(i){l.bOpm=!0;let o=l.loadPDBCls.loadPDB(i,n,l.bOpm,!0);$("#"+l.pre+"selectplane_z1").val(l.halfBilayerSize),$("#"+l.pre+"selectplane_z2").val(-l.halfBilayerSize),$("#"+l.pre+"extra_mem_z").val(l.halfBilayerSize),$("#"+l.pre+"intra_mem_z").val(-l.halfBilayerSize),l.bCommandLoad||l.init(),r.downloadChainalignmentPart2(e,t,o,s),void 0!==l.deferredOpm&&l.deferredOpm.resolve()},error:function(i,n,o){l.bCommandLoad||l.init(),r.downloadChainalignmentPart2(e,t,void 0,s),void 0!==l.deferredOpm&&l.deferredOpm.resolve()}})}else l.bCommandLoad||l.init(),r.downloadChainalignmentPart2(e,t,void 0,s),void 0!==l.deferredOpm&&l.deferredOpm.resolve()},error:function(i,n,o){l.bCommandLoad||l.init(),r.downloadChainalignmentPart2(e,t,void 0,s),void 0!==l.deferredOpm&&l.deferredOpm.resolve()}})}}downloadMmdbAf(e,t){let s=this.icn3d,i=s.icn3dui,l=this;return s.deferredMmdbaf=$.Deferred((function(){s.structArray=e.split(",");let n=[];for(let e=0,t=s.structArray.length;e<t;++e){let t,l,r=s.structArray[e];isNaN(r)&&r.length>4?(t="https://alphafold.ebi.ac.uk/files/AF-"+s.structArray[e]+"-F1-model_v2.pdb",l=$.ajax({url:t,dataType:"text",cache:!0})):(t=i.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&bu="+i.cfg.bu+"&uid="+r,void 0!==i.cfg.inpara&&(t+=i.cfg.inpara),l=$.ajax({url:t,dataType:"jsonp",cache:!0})),n.push(l)}s.ParserUtilsCls.setYourNote(s.structArray+" in iCn3D"),s.bCid=void 0,s.ParserUtilsCls.showLoading(),$.when.apply(void 0,n).then((function(){let e=1==s.structArray.length?[arguments]:Array.from(arguments);l.parseMMdbAfData(e,s.structArray,t),s.ParserUtilsCls.hideLoading()})).fail((function(){alert("There are some problems in retrieving the coordinates...")}))})),s.deferredMmdbaf.promise()}parseMMdbAfData(e,t,s){let i=this.icn3d,l=i.icn3dui,n=[];for(let s=0,i=t.length;s<i;++s){let i=e[s][0],l="HEADER                                                        "+t[s]+"\n";if(t[s].length>4&&(i=l+i),void 0===i||-1!==JSON.stringify(i).indexOf("Oops there was a problem"))return void alert("The coordinate data can NOT be retrieved for the structure "+t[s]+"...");n.push(i)}i.bCommandLoad||s||i.init();let r={},o={},a=!1;for(let e=0,d=t.length;e<d;++e){let d,c;if(e==t.length-1&&(a=!0),0!=e||s?(d="query",c=!0):(d="target",c=!1),t[e].length>4){let s=!0;o=i.pdbParserCls.loadPdbData(n[e],t[e],!1,c,d,a,s)}else{let t=!0;o=i.mmdbParserCls.parseMmdbData(n[e],d,void 0,void 0,a,t)}r=l.hashUtilsCls.unionHash(r,o)}s&&l.cfg.masterchain?$.when(i.pdbParserCls.applyCommandDssp(!0)).then((function(){i.realignParserCls.realignChainOnSeqAlign(void 0,i.chainidArray,!0,!0),$("#"+i.pre+"dl_annotations").html(""),i.bAnnoShown=!1,$("#"+i.pre+"dl_selectannotations").dialog("isOpen")&&$("#"+i.pre+"dl_selectannotations").dialog("close")})):i.pdbParserCls.applyCommandDssp(!0)}}class ae{constructor(e){this.icn3d=e}dsn6Parser(e,t,s){this.icn3d.icn3dui;let i="https://edmaps.rcsb.org/maps/"+e.toLowerCase()+"_"+t+".dsn6";this.dsn6ParserBase(i,t,s)}dsn6ParserBase(e,t,s){let i=this.icn3d;i.icn3dui;let l=this;if("2fofc"==t&&i.bAjax2fofc)i.mapData.sigma2=s,i.setOptionCls.setOption("map",t);else if("fofc"==t&&i.bAjaxfofc)i.mapData.sigma=s,i.setOptionCls.setOption("map",t);else{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){let e=n.response;l.loadDsn6Data(e,t,s),"2fofc"==t?i.bAjax2fofc=!0:"fofc"==t&&(i.bAjaxfofc=!0),i.setOptionCls.setOption("map",t)}else alert("RCSB server has no corresponding eletron density map for this structure.");void 0!==i.deferredMap&&i.deferredMap.resolve()}else i.ParserUtilsCls.showLoading()},n.send()}}loadDsn6Data(e,t,s){let i=this.icn3d;i.icn3dui;let l,n,r={},o=e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e,a=new Int16Array(o),d=new Uint8Array(o),c=String.fromCharCode.apply(null,d.subarray(0,512));if(0==c.indexOf(":-)"))r.xStart=parseInt(c.substr(10,5)),r.yStart=parseInt(c.substr(15,5)),r.zStart=parseInt(c.substr(20,5)),r.xExtent=parseInt(c.substr(32,5)),r.yExtent=parseInt(c.substr(38,5)),r.zExtent=parseInt(c.substr(42,5)),r.xRate=parseInt(c.substr(52,5)),r.yRate=parseInt(c.substr(58,5)),r.zRate=parseInt(c.substr(62,5)),r.xlen=1*parseFloat(c.substr(73,10)),r.ylen=1*parseFloat(c.substr(83,10)),r.zlen=1*parseFloat(c.substr(93,10)),r.alpha=parseFloat(c.substr(103,10)),r.beta=parseFloat(c.substr(113,10)),r.gamma=parseFloat(c.substr(123,10)),l=parseFloat(c.substr(138,12))/100,n=parseInt(c.substr(155,8)),r.sigma=100*parseFloat(c.substr(170,12));else{if(100!==a[18])for(let e=0,t=a.length;e<t;++e){let t=a[e];a[e]=(255&t)<<8|t>>8&255}r.zStart=a[2],r.xStart=a[0],r.yStart=a[1],r.xExtent=a[3],r.yExtent=a[4],r.zExtent=a[5],r.xRate=a[6],r.yRate=a[7],r.zRate=a[8];let e=1/a[17],t=1*e;r.xlen=a[9]*t,r.ylen=a[10]*t,r.zlen=a[11]*t,r.alpha=a[12]*e,r.beta=a[13]*e,r.gamma=a[14]*e,l=a[15]/a[18],n=a[16]}let h=new Float32Array(r.xExtent*r.yExtent*r.zExtent),m=512,p=Math.ceil(r.xExtent/8),u=Math.ceil(r.yExtent/8),C=Math.ceil(r.zExtent/8);for(let e=0;e<C;++e)for(let t=0;t<u;++t)for(let s=0;s<p;++s)for(let i=0;i<8;++i){let o=8*e+i;for(let e=0;e<8;++e){let i=8*t+e;for(let e=0;e<8;++e){let t=8*s+e;if(!(t<r.xExtent&&i<r.yExtent&&o<r.zExtent)){m+=8-e;break}h[(t*r.yExtent+i)*r.zExtent+o]=(d[m]-n)/l,++m}}}"2fofc"==t?(i.mapData.header2=r,i.mapData.data2=h,i.mapData.matrix2=this.getMatrix(r),i.mapData.type2=t,i.mapData.sigma2=s):(i.mapData.header=r,i.mapData.data=h,i.mapData.matrix=this.getMatrix(r),i.mapData.type=t,i.mapData.sigma=s)}getMatrix(e){this.icn3d.icn3dui;let t=e,s=[t.xlen,0,0],i=[t.ylen*Math.cos(Math.PI/180*t.gamma),t.ylen*Math.sin(Math.PI/180*t.gamma),0],l=[t.zlen*Math.cos(Math.PI/180*t.beta),t.zlen*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];l[2]=Math.sqrt(t.zlen*t.zlen*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-l[1]*l[1]);let n=[[],s,i,l],r=[0,t.xRate,t.yRate,t.zRate],o=[0,1,2,3],a=new THREE.Matrix4;return a.set(n[o[1]][0]/r[o[1]],n[o[2]][0]/r[o[2]],n[o[3]][0]/r[o[3]],0,n[o[1]][1]/r[o[1]],n[o[2]][1]/r[o[2]],n[o[3]][1]/r[o[3]],0,n[o[1]][2]/r[o[1]],n[o[2]][2]/r[o[2]],n[o[3]][2]/r[o[3]],0,0,0,0,1),a.multiply((new THREE.Matrix4).makeTranslation(t.xStart,t.yStart,t.zStart)),a}loadDsn6File(e){var t=this.icn3d,s=t.icn3dui;let i=this,l=$("#"+t.pre+"dsn6file"+e)[0].files[0],n=$("#"+t.pre+"dsn6sigma"+e).val();if(l){s.utilsCls.checkFileAPI();let t=new FileReader;t.onload=function(t){let l=i.icn3d,r=t.target.result;i.loadDsn6Data(r,e,n),"2fofc"==e?l.bAjax2fofc=!0:"fofc"==e&&(l.bAjaxfofc=!0),l.setOptionCls.setOption("map",e),s.htmlCls.clickMenuCls.setLogCmd("load dsn6 file "+$("#"+l.pre+"dsn6file"+e).val(),!1)},t.readAsArrayBuffer(l)}else alert("Please select a file before clicking 'Load'")}loadDsn6FileUrl(e){var t=this.icn3d,s=t.icn3dui;let i=$("#"+t.pre+"dsn6fileurl"+e).val(),l=$("#"+t.pre+"dsn6sigmaurl"+e).val();i?(this.dsn6ParserBase(i,e,l),s.htmlCls.clickMenuCls.setLogCmd("set map "+e+" sigma "+l+" | "+encodeURIComponent(i),!0)):alert("Please input the file URL before clicking 'Load'")}}class de{constructor(e){this.icn3d=e}draw2Dcartoon(e){this.icn3d.icn3dui.htmlCls.clickMenuCls.setLogCmd("cartoon 2d "+e,!0),this.draw2Dcartoon_base(e)}draw2Dcartoon_base(e,t){let s=this.icn3d,i=s.icn3dui,l=this;if(s.cartoon2dType=e,t){let t=l.getCartoonSvg(e,s.graphStr);$("#"+i.svgid_ct).html(t)}else if("domain"!=e||s.chainid2pssmid){this.getNodesLinksForSetCartoonBase(e),s.graphStr=l.getCartoonData(e,s.node_link);let t=l.getCartoonSvg(e,s.graphStr);$("#"+i.svgid_ct).html(t),l.setEventsForCartoon2d(),i.htmlCls.dialogCls.openDlg("dl_2dctn","2D Cartoon")}else $.when(l.getNodesLinksForSetCartoon(e)).then((function(){s.graphStr=l.getCartoonData(e,s.node_link);let t=l.getCartoonSvg(e,s.graphStr);$("#"+i.svgid_ct).html(t),l.setEventsForCartoon2d(),i.htmlCls.dialogCls.openDlg("dl_2dctn","2D Cartoon"),void 0!==s.deferredCartoon2d&&s.deferredCartoon2d.resolve()}))}getCartoonSvg(e,t){let s=this.icn3d,i=s.icn3dui,l="",n="",r=JSON.parse(t);s.ctnNodeHash={};for(let t=0,i=r.nodes.length;t<i;++t){let i=r.nodes[t];s.ctnNodeHash[i.id]=i,n+="secondary"==e?this.drawHelix(e,i.id,i.ss,i.x,i.y,i.x1,i.y1,i.x2,i.y2,i.len,i.ang,i.c):this.drawOval(e,i.id,i.x,i.y,i.rx,i.ry,i.ang,i.c,i.from,i.to)}s.nodeid2lineid={};for(let t=0,n=r.links.length;t<n;++t){let n=r.links[t].source,o=r.links[t].target,a=s.ctnNodeHash[n].x,d=i.htmlCls.width2d-s.ctnNodeHash[n].y,c=s.ctnNodeHash[o].x,h=i.htmlCls.width2d-s.ctnNodeHash[o].y;"chain"==e?l+="<g class='icn3d-ctinteraction' chainid1='"+s.ctnNodeHash[n].id+"' chainid2='"+s.ctnNodeHash[o].id+"' >":"domain"==e?l+="<g class='icn3d-ctinteraction' from1='"+s.ctnNodeHash[n].from+"' to1='"+s.ctnNodeHash[n].to+"' from2='"+s.ctnNodeHash[o].from+"' to2='"+s.ctnNodeHash[o].to+"' >":"secondary"==e&&(a=s.ctnNodeHash[n].x2,d=i.htmlCls.width2d-s.ctnNodeHash[n].y2,c=s.ctnNodeHash[o].x1,h=i.htmlCls.width2d-s.ctnNodeHash[o].y1,l+="<g class='icn3d-ctinteraction' range1='"+s.ctnNodeHash[n].range+"' range2='"+s.ctnNodeHash[o].range+"' >");let m=n+"--"+o;l+="<title>Interaction of "+e+" "+this.getLabelFromId(n,e)+" with "+e+" "+this.getLabelFromId(o,e)+"</title>",l+="<line class='icn3d-edge' id='"+m+"' x1='"+a+"' y1='"+d+"' x2='"+c+"' y2='"+h+"' stroke='#bbbbbb' stroke-width='1' /></g>",s.nodeid2lineid.hasOwnProperty(n)||(s.nodeid2lineid[n]=[]),s.nodeid2lineid.hasOwnProperty(o)||(s.nodeid2lineid[o]=[]),s.nodeid2lineid[n].push(m),s.nodeid2lineid[o].push(m)}return l+=n,l}setEventsForCartoon2d(){let e=this.icn3d,t=e.icn3dui;$("#"+t.svgid_ct+" .icn3d-ctnode").draggable({start:function(e,t){let s=parseFloat(e.target.getAttribute("cx")),i=parseFloat(e.target.getAttribute("cy"));e.target.setAttribute("cx",s),e.target.setAttribute("cy",i);let l=e.target.getAttribute("ang");if(l)e.target.setAttribute("transform","rotate("+l+","+s+","+i+")");else{let t=parseFloat(e.target.getAttribute("x1")),s=parseFloat(e.target.getAttribute("y1")),i=parseFloat(e.target.getAttribute("x2")),l=parseFloat(e.target.getAttribute("y2"));e.target.setAttribute("x1",t),e.target.setAttribute("y1",s),e.target.setAttribute("x2",i),e.target.setAttribute("y2",l)}},drag:function(s,i){let l=$("#"+t.svgid_ct).offset().left,n=$("#"+t.svgid_ct).offset().top,r=s.target.getAttribute("id"),o=s.target.getAttribute("ang"),a=s.clientX-l,d=s.clientY-n,c=parseFloat(s.target.getAttribute("cx")),h=parseFloat(s.target.getAttribute("cy")),m=(a-c)/e.resizeRatioX,p=(d-h)/e.resizeRatioY,u=parseFloat($("#"+r+"_text").attr("x")),C=parseFloat($("#"+r+"_text").attr("y"));if($("#"+r+"_text").attr("x",u+m),$("#"+r+"_text").attr("y",C+p),s.target.setAttribute("cx",a),s.target.setAttribute("cy",d),o)s.target.setAttribute("transform","rotate("+o+","+a+","+d+")");else{let e=parseFloat(s.target.getAttribute("x1")),t=parseFloat(s.target.getAttribute("y1")),i=parseFloat(s.target.getAttribute("x2")),l=parseFloat(s.target.getAttribute("y2"));if(s.target.setAttribute("x1",e+m),s.target.setAttribute("y1",t+p),s.target.setAttribute("x2",i+m),s.target.setAttribute("y2",l+p),"S"==r.substr(0,1)){let e=parseFloat($("#"+r+"_box").attr("x1")),t=parseFloat($("#"+r+"_box").attr("y1")),s=parseFloat($("#"+r+"_box").attr("x2")),i=parseFloat($("#"+r+"_box").attr("y2"));$("#"+r+"_box").attr("x1",e+m),$("#"+r+"_box").attr("y1",t+p),$("#"+r+"_box").attr("x2",s+m),$("#"+r+"_box").attr("y2",i+p)}}if(e.nodeid2lineid[r])for(let t=0,s=e.nodeid2lineid[r].length;t<s;++t){g(e.nodeid2lineid[r][t],r,o)}function g(e,t,s){if(e&&-1!=e.indexOf(t)){let t=e.split("--");if(2==t.length){let i,l;i=t[1],l=t[0];let n=s?"cx":"x1",r=s?"cy":"y1",o=$("#"+i).attr(n),a=$("#"+i).attr(r);$("#"+e).attr("x1",o),$("#"+e).attr("y1",a);let d=s?"cx":"x2",c=s?"cy":"y2",h=$("#"+l).attr(d),m=$("#"+l).attr(c);$("#"+e).attr("x2",h),$("#"+e).attr("y2",m)}}}}})}getLabelFromId(e,t){let s=e,i=s.indexOf("__");return-1!==i&&(s=s.substr(0,i)),s="secondary"==t?s.substr(0,s.indexOf("-")):s.substr(s.lastIndexOf("_")+1),s}drawHelix(e,t,s,i,l,n,r,o,a,d,c,h){let m=this.icn3d.icn3dui,p=this.getLabelFromId(t,e);l=m.htmlCls.width2d-l,r=m.htmlCls.width2d-r,a=m.htmlCls.width2d-a;let u="<g range='"+p.substr(1)+"' >";return u+="<title>"+e+" "+p+"</title>","H"==t.substr(0,1)?u+="<line id='"+t+"' class='icn3d-ctnode' x1='"+n+"' y1='"+r+"' x2='"+o+"' y2='"+a+"' cx='"+.5*(n+o).toFixed(1)+"' cy='"+.5*(r+a).toFixed(1)+"' stroke='#"+h+"' stroke-width='3' stroke-linecap='round' />":(u+="<line id='"+t+"_box' x1='"+n+"' y1='"+r+"' x2='"+o+"' y2='"+a+"' stroke='#"+h+"' stroke-width='3' stroke-linecap='square' />",u+="<line id='"+t+"' class='icn3d-ctnode' x1='"+n+"' y1='"+r+"' x2='"+o+"' y2='"+a+"' cx='"+.5*(n+o).toFixed(1)+"' cy='"+.5*(r+a).toFixed(1)+"' stroke='#FFF' stroke-width='1' stroke-linecap='square' />"),u+="<text id='"+t+"_text' x='"+(i-0).toString()+"' y='"+(l+4).toString()+"' style='fill:#000000; text-anchor:middle' class='icn3d-node-text8' >"+p+"</text>",u+="</g>",u}drawOval(e,t,s,i,l,n,r,o,a,d){let c=this.icn3d.icn3dui,h=this.getLabelFromId(t,e);i=c.htmlCls.width2d-i,r=180-r;let m="chain"==e?"<g chainid='"+t+"' >":"<g from='"+a+"' to='"+d+"' >";return m+="<title>"+e+" "+h+"</title>",m+="<defs>",m+="<linearGradient id='"+t+"_g_obj' x1='0%' y1='0%' x2='100%' y2='0%'>",m+="  <stop offset='0%' style='stop-color:rgb(255,255,255);stop-opacity:1' />",m+="  <stop offset='100%' style='stop-color:#"+o+";stop-opacity:1' />",m+="</linearGradient>",m+="</defs>",m+="<ellipse id='"+t+"' class='icn3d-ctnode' cx='"+s.toFixed(0)+"' cy='"+i.toFixed(0)+"' rx='"+l.toFixed(0)+"' ry='"+n.toFixed(0)+"' fill='url(#"+t+"_g_obj)' stroke-width='1' stroke='none' ",m+=" ang='"+r+"' transform='rotate("+r+","+s.toFixed(0)+","+i.toFixed(0)+")'",m+="chain"==e?" chainid='"+t+"' />":" from='"+a+"' to='"+d+"' />",m+="<text id='"+t+"_text' x='"+(s-0).toString()+"' y='"+(i+4).toString()+"' style='fill:#000000; text-anchor:middle' class='icn3d-node-text12' >"+h+"</text>",m+="</g>",m}getCartoonData(e,t){let s=this.icn3d;s.icn3dui;let i,l,n=[],r=[];n=t.node;let o=[],a={},d=0;for(let e=0,t=n.length;e<t;++e){let t=n[e],s=JSON.parse(t);a.hasOwnProperty(s.id)||(o.push(s),a[s.id]=d,++d)}let c=[];for(let e=0,t=o.length;e<t;++e){let t=o[e];c.push(JSON.stringify(t))}i=c.join(", "),r=t.link,l=r.join(", "),s.hAtoms;let h='{"nodes": ['+i+'], "links": [';return h+=l+"",h+='], "level": "'+(t.level?t.level:"")+'"}',h}getNodesLinksForSetCartoon(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredCartoonData=$.Deferred((function(){s.getNodesLinksForSetCartoonBase(e)})),t.deferredCartoonData.promise()}projectTo2d(e){let t=this.icn3d,s=t.icn3dui,i=e.project(t.cam);var l=new THREE.Vector3;return l.x=Math.round((i.x+1)*s.htmlCls.width2d*.5),l.y=Math.round(-i.y*s.htmlCls.width2d*.5),l.z=0,l.y>0?l.y=s.htmlCls.width2d-l.y:l.y=-l.y,l}getNodesLinksForSetCartoonBase(e){let t,s,i,l,n,r=this.icn3d,o=r.icn3dui,a=this,d=[],c=[],h=0,m=o.htmlCls.defaultValue,p="",u="",C="",g=!1,f=!0;if("chain"==e){let e={};for(let t in r.hAtoms){let s=r.atoms[t];if("DUM"==s.chain)continue;let i=s.structure+"_"+s.chain;(r.proteins.hasOwnProperty(t)||r.nucleotides.hasOwnProperty(t))&&(e.hasOwnProperty(i)||(e[i]={}),e[i][s.serial]=s)}let t=r.contactCls.getExtent(r.atoms),s=9999,i=9999,l=-9999,a=-9999,h=-9999,m=[];for(let d in e){r.hAtom={},r.hAtoms=o.hashUtilsCls.cloneHash(r.chains[d]);let e=r.axesCls.setPc1Axes(),c=e[0],p=e[1].distanceTo(e[0]),u=e[2].distanceTo(e[0]),C=180*new THREE.Vector2(e[1].x-e[0].x,e[1].y-e[0].y).angle()/Math.PI;C>180&&(C-=180);let g=Object.keys(r.hAtoms)[0],f=r.atoms[g];n=d,c=this.projectTo2d(c);let b=c.x,y=c.y;b<s&&(s=b),b>l&&(l=b),y<i&&(i=y),y>a&&(a=y);let v=.5;p=v*o.htmlCls.width2d*p/(t[1][0]-t[0][0]),u=v*o.htmlCls.width2d*u/(t[1][1]-t[0][1]),p>h&&(h=p),u>h&&(h=u),m.push({id:d,r:n,x:b,y:y,rx:p,ry:u,ang:C,c:f.color.getHexString()})}let p=h+2,u=l-s,C=a-i;for(let e=0,t=m.length;e<t;++e){let t=m[e],l=u<1?.5*o.htmlCls.width2d:(t.x-s)/u*(o.htmlCls.width2d-2*p)+p,n=C<1?.5*o.htmlCls.width2d:(t.y-i)/C*(o.htmlCls.width2d-2*p)+p;d.push('{"id": "'+t.id+'", "r": "'+t.r+'", "x": '+l.toFixed(0)+', "y": '+n.toFixed(0)+', "rx": '+t.rx.toFixed(0)+', "ry": '+t.ry.toFixed(0)+', "ang": '+t.ang.toFixed(0)+', "c": "'+t.c.toUpperCase()+'"}')}r.hAtoms=o.hashUtilsCls.cloneHash(r.dAtoms),r.node_link={node:d,link:c,level:"chain"}}else if("domain"==e){if(r.chainid2pssmid)return a.getNodesLinksForDomains(r.chainid2pssmid),void(void 0!==r.deferredCartoonData&&r.deferredCartoonData.resolve());$.when(r.loadScriptCls.applyCommandAnnotationsAndCddSite("view annotations")).then((function(){a.getNodesLinksForDomains(r.chainid2pssmid),void 0!==r.deferredCartoonData&&r.deferredCartoonData.resolve()}))}else if("secondary"==e){r.resi2resirange={};let e,a=[];r.contactCls.getExtent(r.atoms);let b="",y=9999,v=9999,_=-9999,S=-9999,w=2,A=[];for(let d in r.hAtoms){let w=r.atoms[d];if("DUM"!=w.chain&&((w.ssbegin||w.ssend)&&"CA"==w.name&&"C"==w.elem)){let d=w.structure+"_"+w.chain+"_"+w.resi;if(f&&w.ssbegin&&(g=!0,f=!1,t=w,b="helix"==w.ss?"H":"S",l=b+w.resi,n="1_1_"+d,C=w.chain),g&&(e=o.utilsCls.residueName2Abbr(w.resn)+w.resi,e+="__"+w.chain,Object.keys(r.structures).length>1&&(e+="__"+w.structure),a.push(e)),C==w.chain&&g&&w.ssend){let o=this.projectTo2d(t.coord.clone()),d=o.x,C=o.y,x=this.projectTo2d(w.coord.clone()),k=x.x,O=x.y;s=.5*(d+k),i=.5*(C+O),d=.5*(s+d),C=.5*(i+C),k=.5*(s+k),O=.5*(i+O),d<y&&(y=d),d>_&&(_=d),C<v&&(v=C),C>S&&(S=C),k<y&&(y=k),k>_&&(_=k),O<v&&(v=O),O>S&&(S=O),g=!1,f=!0,l+="-"+w.resi,n+="-"+w.resi,l+="__"+w.chain,Object.keys(r.structures).length>1&&(l+="__"+w.structure);for(let t=0,s=a.length;t<s;++t)e=a[t],r.resi2resirange[e]=l;a=[],h>0&&p==w.chain&&c.push('{"source": "'+u+'", "target": "'+l+'", "v": '+m+', "c": "'+t.color.getHexString().toUpperCase()+'"}'),A.push({id:l,r:n,ss:b,x:s,y:i,x1:d,y1:C,x2:k,y2:O,c:w.color.getHexString()}),p=w.chain,u=l,++h}}}let x=w+2,k=_-y,O=S-v;for(let e=0,t=A.length;e<t;++e){let t=A[e],s=k<1?.5*o.htmlCls.width2d:(t.x-y)/k*(o.htmlCls.width2d-2*x)+x,i=O<1?.5*o.htmlCls.width2d:(t.y-v)/O*(o.htmlCls.width2d-2*x)+x,l=k<1?.5*o.htmlCls.width2d:(t.x1-y)/k*(o.htmlCls.width2d-2*x)+x,n=O<1?.5*o.htmlCls.width2d:(t.y1-v)/O*(o.htmlCls.width2d-2*x)+x,r=k<1?.5*o.htmlCls.width2d:(t.x2-y)/k*(o.htmlCls.width2d-2*x)+x,a=O<1?.5*o.htmlCls.width2d:(t.y2-v)/O*(o.htmlCls.width2d-2*x)+x;d.push('{"id": "'+t.id+'", "r": "'+t.r+'", "x": '+s.toFixed(0)+', "y": '+i.toFixed(0)+', "x1": '+l.toFixed(0)+', "y1": '+n.toFixed(0)+', "x2": '+r.toFixed(0)+', "y2": '+a.toFixed(0)+', "c": "'+t.c.toUpperCase()+'"}')}r.node_link={node:d,link:c,level:"secondary"}}void 0!==r.deferredCartoonData&&r.deferredCartoonData.resolve()}getNodesLinksForDomains(e){let t=this.icn3d,s=t.icn3dui,i=[],l=[],n=s.htmlCls.defaultValue;t.resi2resirange={};let r={};for(let e in t.hAtoms){let s=t.atoms[e];"DUM"!=s.chain&&(r[s.structure+"_"+s.chain]=1)}let o=t.contactCls.getExtent(t.atoms),a=9999,d=9999,c=-9999,h=-9999,m=-9999,p=[];for(let i in r){if(!e.hasOwnProperty(i))continue;let r=e[i].pssmid2name,C=e[i].pssmid2fromArray,g=e[i].pssmid2toArray,f={};for(let e in r){let t=C[e];f[e]=t[0]}var u=Object.keys(f);let b,y;u.sort((function(e,t){return f[e]-f[t]}));for(let e=0,f=u.length;e<f;++e){let f=u[e],v=r[f];v+="__"+i.substr(i.indexOf("_")+1),Object.keys(t.structures).length>1&&(v+="__"+i.substr(0,i.indexOf("_")));let _=C[f],S=g[f];t.hAtoms={};for(let e=0,l=_.length;e<l;++e){let l=_[e]+1,n=S[e]+1;for(let e=l;e<=n;++e)t.hAtoms=s.hashUtilsCls.unionHash(t.hAtoms,t.residues[i+"_"+e])}if(0==Object.keys(t.hAtoms).length)continue;let w=t.axesCls.setPc1Axes(),A=w[0],x=w[1].distanceTo(w[0]),k=w[2].distanceTo(w[0]),O=180*new THREE.Vector2(w[1].x-w[0].x,w[1].y-w[0].y).angle()/Math.PI;O>180&&(O-=180);let H=Object.keys(t.hAtoms)[0],D=t.atoms[H];A=this.projectTo2d(A);let R=A.x,I=A.y;R<a&&(a=R),R>c&&(c=R),I<d&&(d=I),I>h&&(h=I);let E=.5;x=E*s.htmlCls.width2d*x/(o[1][0]-o[0][0]),k=E*s.htmlCls.width2d*k/(o[1][1]-o[0][1]),x>m&&(m=x),k>m&&(m=k),void 0!==b&&l.push('{"source": "'+b+'", "target": "'+v+'", "v": '+n+', "c": "'+y.color.getHexString().toUpperCase()+'"}'),p.push({id:v,from:_+"",to:S+"",x:R,y:I,rx:x,ry:k,ang:O,c:D.color.getHexString()}),b=v,y=D}}let C=m+2,g=c-a,f=h-d;for(let e=0,t=p.length;e<t;++e){let t=p[e],l=g<1?.5*s.htmlCls.width2d:(t.x-a)/g*(s.htmlCls.width2d-2*C)+C,n=f<1?.5*s.htmlCls.width2d:(t.y-d)/f*(s.htmlCls.width2d-2*C)+C;i.push('{"id": "'+t.id+'", "from": "'+t.from+'", "to": "'+t.to+'", "x": '+l.toFixed(0)+', "y": '+n.toFixed(0)+', "rx": '+t.rx.toFixed(0)+', "ry": '+t.ry.toFixed(0)+', "ang": '+t.ang.toFixed(0)+', "c": "'+t.c.toUpperCase()+'"}')}t.hAtoms=s.hashUtilsCls.cloneHash(t.dAtoms),t.node_link={node:i,link:l,level:"domain"}}getSelection(e,t,s){let i=this.icn3d,l=i.icn3dui,n={},r=[],o=t.toString().split(","),a=s.toString().split(","),d=3==e.length?e[2]:Object.keys(i.structures)[0],c=e.length>=2?d+"_"+e[1]:Object.keys(i.chains)[0];for(let e=0,t=o.length;e<t;++e){let t=parseInt(o[e])+1,s=parseInt(a[e])+1;for(let e=t;e<=s;++e){let t=c+"_"+e;n=l.hashUtilsCls.unionHash(n,i.residues[t]),r.push(t)}}return{atomSet:n,residArray:r}}click2Dcartoon(){let e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+t.pre+"2dctn_chain","click",(function(e){let i=t.icn3d;e.preventDefault(),s.initCartoonSvg(),i.cartoon2dCls.draw2Dcartoon("chain")})),t.myEventCls.onIds("#"+t.pre+"2dctn_domain","click",(function(e){let i=t.icn3d;e.preventDefault(),s.initCartoonSvg(),i.cartoon2dCls.draw2Dcartoon("domain")})),t.myEventCls.onIds("#"+t.pre+"2dctn_secondary","click",(function(e){let i=t.icn3d;e.preventDefault(),s.initCartoonSvg(),i.cartoon2dCls.draw2Dcartoon("secondary")})),$(document).on("click","#"+e.pre+"dl_2dctn .icn3d-ctnode",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");let l,n={},r=[],o=$(this).attr("id"),a=$(this).attr("chainid"),d=$(this).attr("from"),c=$(this).attr("to"),h=$(this).attr("x1");if(void 0!==a)l="chain",n=i.chains[a];else if(void 0!==d){l="domain";let e=o.split("__"),t=s.getSelection(e,d,c);n=t.atomSet,r=t.residArray}else if(void 0!==h){l="secondary";let e=o.split("__"),t=e[0].substr(1).split("-"),i=parseInt(t[0])-1,a=parseInt(t[1])-1,d=s.getSelection(e,i,a);n=d.atomSet,r=d.residArray}i.bCtrl||i.bShift||(i.selectionCls.removeSelection(),i.lineArray2d=[]),void 0!==i.alnChains[a]&&(Object.keys(i.alnChains[a]).length,Object.keys(i.chains[a]).length),i.bCtrl||i.bShift?i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,n):i.hAtoms=t.hashUtilsCls.cloneHash(n),"chain"==l?(i.bCtrl||i.bShift?(void 0===i.chainArray2d&&(i.chainArray2d=[]),i.chainArray2d.push(a)):i.chainArray2d=[a],i.hlUpdateCls.updateHlAll(i.chainArray2d)):i.hlUpdateCls.updateHlAll(),i.annotationCls.showAnnoSelectedChains();let m="chain"==l?"select chain "+a:"select "+i.resid2specCls.residueids2spec(r);t.htmlCls.clickMenuCls.setLogCmd(m,!0),i.bSelectResidue=!1}))}initCartoonSvg(){let e=this.icn3d,t=e.icn3dui;e.resizeRatioX=1,e.resizeRatioY=1,$("#"+t.svgid_ct).empty()}}class ce{constructor(e){this.icn3d=e}loadScript(e,t){let s=this.icn3d;s.icn3dui,s.bCommandLoad=!0,s.bRender=!1,s.bStopRotate=!0,e=t?e.replace(/\+/g," "):e.replace(/\+/g," ").replace(/;/g,"\n");let i=[];s.commands.length>0&&(i[0]=s.commands[0]);let l=e.trim().split("\n");s.commands=l;let n=l[0].indexOf("command=");if(t&&-1!=n){let e=l[0].substr(0,n-1);s.commands.splice(0,1,e)}s.STATENUMBER=s.commands.length,s.commands=i.concat(s.commands),s.STATENUMBER=s.commands.length,s.CURRENTNUMBER=0,s.bReplay?this.replayFirstStep(s.CURRENTNUMBER):this.execCommands(s.CURRENTNUMBER,s.STATENUMBER-1,s.STATENUMBER)}execCommands(e,t,s){let i=this.icn3d;i.icn3dui,i.bRender=!1,i.reinitAfterLoad(),this.execCommandsBase(e,t,s)}execCommandsBase(e,t,s,i){let l,n=this.icn3d,r=n.icn3dui,o=this;for(l=e;l<=t;++l){let i=l===s-1;if(n.commands[l].trim()&&(n.atoms||-1!=n.commands[l].indexOf("load"))){if(-1!==n.commands[l].indexOf("load"))return 0===t&&e===t?void(n.bNotLoadStructure?(n.hAtoms=r.hashUtilsCls.cloneHash(n.atoms),1===n.commands.length&&(n.bAddCommands=!0),i&&this.renderFinalStep(s)):$.when(o.applyCommandLoad(n.commands[l])).then((function(){1===n.commands.length&&(n.bAddCommands=!0),i&&o.renderFinalStep(s)}))):void(n.bNotLoadStructure?(n.hAtoms=r.hashUtilsCls.cloneHash(n.atoms),n.backForward&&this.renderFinalStep(1),this.execCommandsBase(l+1,t,s)):$.when(o.applyCommandLoad(n.commands[l])).then((function(){n.backForward&&o.renderFinalStep(1),o.execCommandsBase(l+1,t,s)})));if(0==n.commands[l].trim().indexOf("set map")&&-1==n.commands[l].trim().indexOf("set map wireframe")){let e=n.commands[l].split("|||"),i=e[0].trim().split(" | ")[0].substr(8).split(" ");if(3==i.length&&"sigma"==i[1]){i[2];let r=i[0];return void(("2fofc"!=r||void 0!==n.bAjax2fofc&&n.bAjax2fofc)&&("fofc"!=r||void 0!==n.bAjaxfofc&&n.bAjaxfofc)?(o.applyCommandMap(e[0].trim()),this.execCommandsBase(l+1,t,s)):$.when(o.applyCommandMap(e[0].trim())).then((function(){o.execCommandsBase(l+1,t,s)})))}}else if(0==n.commands[l].trim().indexOf("set emmap")&&-1==n.commands[l].trim().indexOf("set emmap wireframe")){let e=n.commands[l].split("|||"),i=e[0].trim().substr(10).split(" ");if(2==i.length&&"percentage"==i[0])return i[1],void(void 0!==n.bAjaxEm&&n.bAjaxEm?(o.applyCommandEmmap(e[0].trim()),this.execCommandsBase(l+1,t,s)):$.when(o.applyCommandEmmap(e[0].trim())).then((function(){o.execCommandsBase(l+1,t,s)})))}else{if(0==n.commands[l].trim().indexOf("set phi")){let e=n.commands[l].split("|||");return void $.when(n.delphiCls.applyCommandPhi(e[0].trim())).then((function(){o.execCommandsBase(l+1,t,s)}))}if(0==n.commands[l].trim().indexOf("set delphi")){let e=n.commands[l].split("|||");return void $.when(n.delphiCls.applyCommandDelphi(e[0].trim())).then((function(){o.execCommandsBase(l+1,t,s)}))}if(0==n.commands[l].trim().indexOf("view annotations")){let e=n.commands[l].split("|||");return void(Object.keys(n.proteins).length>0&&(void 0===n.bAjaxCddSite||!n.bAjaxCddSite)?$.when(o.applyCommandAnnotationsAndCddSite(e[0].trim())).then((function(){o.execCommandsBase(l+1,t,s)})):(Object.keys(n.proteins).length>0&&o.applyCommandAnnotationsAndCddSiteBase(e[0].trim()),this.execCommandsBase(l+1,t,s)))}if(0==n.commands[l].trim().indexOf("set annotation clinvar")){let e=n.commands[l].split("|||");return void(Object.keys(n.proteins).length>0&&(void 0===n.bAjaxClinvar||!n.bAjaxClinvar)?$.when(o.applyCommandClinvar(e[0].trim())).then((function(){o.execCommandsBase(l+1,t,s)})):(Object.keys(n.proteins).length>0&&o.applyCommandClinvar(e[0].trim()),this.execCommandsBase(l+1,t,s)))}if(0==n.commands[l].trim().indexOf("set annotation snp")){let e=n.commands[l].split("|||");return void(Object.keys(n.proteins).length>0&&(void 0===n.bAjaxSnp||!n.bAjaxSnp)?$.when(o.applyCommandSnp(e[0].trim())).then((function(){o.execCommandsBase(l+1,t,s)})):(Object.keys(n.proteins).length>0&&o.applyCommandSnp(e[0].trim()),this.execCommandsBase(l+1,t,s)))}if(0==n.commands[l].trim().indexOf("set annotation 3ddomain")){let e=n.commands[l].split("|||");return void(Object.keys(n.proteins).length>0&&void 0===n.mmdb_data&&(void 0===n.bAjax3ddomain||!n.bAjax3ddomain)?(o.applyCommand3ddomain(e[0].trim()),o.execCommandsBase(l+1,t,s)):(Object.keys(n.proteins).length>0&&o.applyCommand3ddomain(e[0].trim()),this.execCommandsBase(l+1,t,s)))}if(0==n.commands[l].trim().indexOf("set annotation all")){let e=n.commands[l].split("|||");return void(!(Object.keys(n.proteins).length>0)||void 0!==n.bAjaxClinvar&&n.bAjaxClinvar||void 0!==n.bAjaxSnp&&n.bAjaxSnp||void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data?!(Object.keys(n.proteins).length>0)||void 0!==n.bAjaxClinvar&&n.bAjaxClinvar||void 0!==n.bAjaxSnp&&n.bAjaxSnp?!(Object.keys(n.proteins).length>0)||void 0!==n.bAjaxClinvar&&n.bAjaxClinvar||void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data?!(Object.keys(n.proteins).length>0)||void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data||void 0!==n.bAjaxSnp&&n.bAjaxSnp?Object.keys(n.proteins).length>0&&(void 0===n.bAjaxClinvar||!n.bAjaxClinvar)?$.when(o.applyCommandClinvar(e[0].trim())).then((function(){n.annotationCls.setAnnoTabAll(),o.execCommandsBase(l+1,t,s)})):Object.keys(n.proteins).length>0&&(void 0===n.bAjaxSnp||!n.bAjaxSnp)?$.when(o.applyCommandSnp(e[0].trim())).then((function(){n.annotationCls.setAnnoTabAll(),o.execCommandsBase(l+1,t,s)})):Object.keys(n.proteins).length>0&&(void 0===n.bAjax3ddomain||!n.bAjax3ddomain||void 0===n.mmdb_data)?(o.applyCommand3ddomain(e[0].trim()),n.annotationCls.setAnnoTabAll(),o.execCommandsBase(l+1,t,s)):(Object.keys(n.proteins).length>0&&(n.bAjaxClinvar&&o.applyCommandClinvarBase(e[0].trim()),n.bAjaxSnp&&o.applyCommandSnpBase(e[0].trim()),(n.bAjax3ddomain||void 0!==n.mmdb_data)&&o.applyCommand3ddomainBase(e[0].trim())),n.annotationCls.setAnnoTabAll(),this.execCommandsBase(l+1,t,s)):$.when(o.applyCommandSnp(e[0].trim())).then((function(){o.applyCommand3ddomain(e[0].trim()),n.annotationCls.setAnnoTabAll(),o.execCommandsBase(l+1,t,s)})):$.when(o.applyCommandClinvar(e[0].trim())).then((function(){o.applyCommand3ddomain(e[0].trim()),n.annotationCls.setAnnoTabAll(),o.execCommandsBase(l+1,t,s)})):$.when(o.applyCommandClinvar(e[0].trim())).then(o.applyCommandSnp(e[0].trim())).then((function(){n.annotationCls.setAnnoTabAll(),o.execCommandsBase(l+1,t,s)})):$.when(o.applyCommandClinvar(e[0].trim())).then(o.applyCommandSnp(e[0].trim())).then((function(){o.applyCommand3ddomain(e[0].trim()),n.annotationCls.setAnnoTabAll(),o.execCommandsBase(l+1,t,s)})))}if(0==n.commands[l].trim().indexOf("view interactions")&&void 0!==r.cfg.align){let e=n.commands[l].split("|||");return void(void 0!==n.b2DShown&&n.b2DShown?this.execCommandsBase(l+1,t,s):$.when(o.applyCommandViewinteraction(e[0].trim())).then((function(){o.execCommandsBase(l+1,t,s)})))}if(0==n.commands[l].trim().indexOf("symmetry")){n.bAxisOnly=!1;let e=n.commands[l].split("|||")[0].trim(),i=e.substr(e.indexOf(" ")+1);return n.symmetrytitle="none"===i?void 0:i,void("none"!==i&&void 0===n.symmetryHash?$.when(o.applyCommandSymmetry(e)).then((function(){n.drawCls.draw(),o.execCommandsBase(l+1,t,s)})):(n.drawCls.draw(),this.execCommandsBase(l+1,t,s)))}if(0==n.commands[l].trim().indexOf("symd symmetry")){n.bAxisOnly=!1;let e=n.commands[l].split("|||")[0].trim();return void $.when(n.symdCls.applyCommandSymd(e)).then((function(){n.drawCls.draw(),o.execCommandsBase(l+1,t,s)}))}if(0==n.commands[l].trim().indexOf("scap")){let e=n.commands[l].split("|||")[0].trim();return void $.when(n.scapCls.applyCommandScap(e)).then((function(){o.execCommandsBase(l+1,t,s)}))}if(0==n.commands[l].trim().indexOf("realign on seq align")){let e=n.commands[l].split("|||")[0].trim(),i=e.split(" | ");if(2==i.length){let e=i[1].split(",");n.hAtoms=n.definedSetsCls.getAtomsFromNameArray(e)}return void $.when(o.applyCommandRealign(e)).then((function(){o.execCommandsBase(l+1,t,s)}))}if(0==n.commands[l].trim().indexOf("realign on structure align")){let e=n.commands[l].split("|||")[0].trim(),i=e.split(" | ");if(2==i.length){let e=i[1].split(",");n.hAtoms=n.definedSetsCls.getAtomsFromNameArray(e)}return void $.when(o.applyCommandRealignByStruct(e)).then((function(){o.execCommandsBase(l+1,t,s)}))}if(0==n.commands[l].trim().indexOf("graph interaction pairs")){let e=n.commands[l].split("|||")[0].trim();return void(void 0===n.bD3?$.when(o.applyCommandGraphinteraction(e)).then((function(){o.execCommandsBase(l+1,t,s)})):(this.applyCommandGraphinteraction(e),this.execCommandsBase(l+1,t,s)))}if(0==n.commands[l].trim().indexOf("cartoon 2d domain")){let e=n.commands[l].split("|||")[0].trim();return void(n.chainid2pssmid?(this.applyCommandCartoon2d(e),this.execCommandsBase(l+1,t,s)):$.when(o.applyCommandCartoon2d(e)).then((function(){o.execCommandsBase(l+1,t,s)})))}if(0==n.commands[l].trim().indexOf("set half pae map")){let e=n.commands[l].split("|||")[0].trim();return void $.when(o.applyCommandAfmap(e)).then((function(){o.execCommandsBase(l+1,t,s)}))}if(0==n.commands[l].trim().indexOf("set full pae map")){let e=n.commands[l].split("|||")[0].trim();return void $.when(o.applyCommandAfmap(e,!0)).then((function(){o.execCommandsBase(l+1,t,s)}))}n.applyCommandCls.applyCommand(n.commands[l])}}}(l===s||i)&&this.renderFinalStep(l)}pressCommandtext(){let e=this.icn3d,t=e.icn3dui,s=this;$("#"+e.pre+"logtext").keypress((function(e){let i=s.icn3d;if(i.bAddLogs=!1,13==(e.keyCode?e.keyCode:e.which)){e.preventDefault();let l=$(this).val();i.bRender=!0;let n=l.split("\n"),r=i.logs.length;for(let e=r,l=n.length;e<l;++e){let l=e==r?n[e].substr(2).trim():n[e].trim();if(""===l)continue;i.logs.push(l);let o={};if(o.factor=i._zoomFactor,o.mouseChange=i.mouseChange,o.quaternion=i.quaternion,i.commands.push(l+"|||"+i.transformCls.getTransformationStr(o)),i.optsHistory.push(t.hashUtilsCls.cloneHash(i.opts)),i.optsHistory[i.optsHistory.length-1].hlatomcount=Object.keys(i.hAtoms).length,t.utilsCls.isSessionStorageSupported()&&i.setStyleCls.saveCommandsToSession(),i.STATENUMBER=i.commands.length,-1!==l.indexOf("load"))s.applyCommandLoad(l);else if(-1!==l.indexOf("set map")&&-1===l.indexOf("set map wireframe"))s.applyCommandMap(l);else if(-1!==l.indexOf("set emmap")&&-1===l.indexOf("set emmap wireframe"))s.applyCommandEmmap(l);else if(-1!==l.indexOf("set phi"))i.delphiCls.applyCommandPhi(l);else if(-1!==l.indexOf("set delphi"))i.delphiCls.applyCommandDelphi(l);else if(0==l.indexOf("view annotations"))s.applyCommandAnnotationsAndCddSite(l);else if(0==l.indexOf("set annotation clinvar"))s.applyCommandClinvar(l);else if(0==l.indexOf("set annotation snp"))s.applyCommandSnp(l);else if(0==l.indexOf("set annotation 3ddomain"))s.applyCommand3ddomain(l);else if(0==l.indexOf("set annotation all"))$.when(s.applyCommandClinvar(l)).then(s.applyCommandSnp(l)).then((function(){s.applyCommand3ddomain(l),i.annotationCls.setAnnoTabAll()}));else if(0==l.indexOf("view interactions")&&void 0!==t.cfg.align)s.applyCommandViewinteraction(l);else if(0==l.indexOf("symmetry")){let e=l.substr(l.indexOf(" ")+1);i.symmetrytitle="none"===e?void 0:e,"none"!==e&&void 0===i.symmetryHash&&s.applyCommandSymmetry(l)}else if(0==l.indexOf("symd symmetry"))i.symdCls.applyCommandSymd(l);else if(0==l.indexOf("scap "))i.scapCls.applyCommandScap(l);else if(0==l.indexOf("realign on seq align")){let e=l.split(" | ");if(2==e.length){let t=e[1].split(",");i.hAtoms=i.definedSetsCls.getAtomsFromNameArray(t)}s.applyCommandRealign(l)}else if(0==l.indexOf("realign on structure align")){let e=l.split(" | ");if(2==e.length){let t=e[1].split(",");i.hAtoms=i.definedSetsCls.getAtomsFromNameArray(t)}s.applyCommandRealignByStruct(l)}else 0==l.indexOf("graph interaction pairs")?s.applyCommandGraphinteraction(l):i.applyCommandCls.applyCommand(l+"|||"+i.transformCls.getTransformationStr(o))}i.selectionCls.saveSelectionIfSelected(),i.drawCls.draw(),$("#"+i.pre+"logtext").val("> "+i.logs.join("\n> ")+"\n> ").scrollTop($("#"+i.pre+"logtext")[0].scrollHeight)}i.bAddLogs=!0}))}applyCommandLoad(e){let t=this.icn3d,s=t.icn3dui;if(!(void 0!==t.atoms&&Object.keys(t.atoms).length>0))return t.deferred2=$.Deferred((function(){t.bAddCommands=!1;let i=e.split("|||")[0].replace(/\s\s/g," ").trim();if(-1!==i.indexOf("load")){let e=i.split(" | "),l=e[0];if(e.length>1){let t=e[e.length-1].indexOf(" ");s.cfg.inpara=e[e.length-1].substr(t+1),"undefined"===s.cfg.inpara&&(s.cfg.inpara="")}let n=l.substr(l.lastIndexOf(" ")+1);if(t.inputid=n,-1!==i.indexOf("load mmtf"))s.cfg.mmtfid=n,t.mmtfParserCls.downloadMmtf(n);else if(-1!==i.indexOf("load pdb"))s.cfg.pdbid=n,t.pdbParserCls.downloadPdb(n);else if(-1!==i.indexOf("load af"))s.cfg.afid=n,t.pdbParserCls.downloadPdb(n,!0);else if(-1!==i.indexOf("load opm"))s.cfg.opmid=n,t.opmParserCls.downloadOpm(n);else if(-1!==i.indexOf("load mmcif"))s.cfg.mmcifid=n,t.mmcifParserCls.downloadMmcif(n);else if(-1!==i.indexOf("load mmdb")||-1!==i.indexOf("load mmdb1"))s.cfg.mmdbid=n,s.cfg.bu=1,t.mmdbParserCls.downloadMmdb(n);else if(-1!==i.indexOf("load mmdb0"))s.cfg.mmdbid=n,s.cfg.bu=0,t.mmdbParserCls.downloadMmdb(n);else if(-1!==i.indexOf("load mmdbaf1"))s.cfg.mmdbafid=n,s.cfg.bu=1,t.mmdbParserCls.downloadMmdbAf(n);else if(-1!==i.indexOf("load mmdbaf0"))s.cfg.mmdbafid=n,s.cfg.bu=0,t.mmdbParserCls.downloadMmdbAf(n);else if(-1!==i.indexOf("load gi"))s.cfg.gi=n,t.mmdbParserCls.downloadGi(n);else if(-1!==i.indexOf("load seq_struct_ids "))t.bSmithwm=!1,t.mmdbParserCls.downloadBlast_rep_id(n);else if(-1!==i.indexOf("load seq_struct_ids_smithwm "))t.bSmithwm=!0,t.mmdbParserCls.downloadBlast_rep_id(n);else if(-1!==i.indexOf("load cid"))s.cfg.cid=n,t.sdfParserCls.downloadCid(n);else if(-1!==i.indexOf("load alignment"))s.cfg.align=n,t.alignParserCls.downloadAlignment(n);else if(-1!==i.indexOf("load chainalignment")){let e=i.split(" | ");-1!=e[1].indexOf("resnum")&&(s.cfg.resnum=e[1].substr(e[1].indexOf("resnum")+7)),s.cfg.chainalign=n,t.chainalignParserCls.downloadChainalignment(n,s.cfg.resnum)}else if(-1!==i.indexOf("load url")){let i=e[1],l=void 0!==i?i.indexOf("type "):-1,r="pdb";-1!==l&&(r=i.substr(l+5)),s.cfg.url=n,t.pdbParserCls.downloadUrl(n,r)}}t.bAddCommands=!0})),t.deferred2.promise()}applyCommandMap(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredMap=$.Deferred((function(){let t=s.icn3d,i=e.split(" | "),l=i[0].substr(8).split(" ");if(3==l.length&&"sigma"==l[1]){let e=l[2],s=l[0];2==i.length?t.dsn6ParserCls.dsn6ParserBase(i[1],s,e):t.dsn6ParserCls.dsn6Parser(t.inputid,s,e)}})),t.deferredMap.promise()}applyCommandEmmap(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredEmmap=$.Deferred((function(){let t=s.icn3d,i=e.substr(10).split(" ");if(2==i.length&&"percentage"==i[0]){let e=i[1],s="em";t.densityCifParserCls.densityCifParser(t.inputid,s,e,t.emd)}})),t.deferredEmmap.promise()}applyCommandSymmetryBase(e){let t=this.icn3d;t.icn3dui,t.symdCls.retrieveSymmetry(Object.keys(t.structures)[0])}applyCommandSymmetry(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredSymmetry=$.Deferred((function(){s.applyCommandSymmetryBase(e)})),t.deferredSymmetry.promise()}applyCommandRealignBase(e){let t=this.icn3d;t.icn3dui,t.realignParserCls.realignOnSeqAlign()}applyCommandRealign(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredRealign=new $.Deferred((function(){s.applyCommandRealignBase(e)})),t.deferredRealign.promise()}applyCommandRealignByStructBase(e){let t=this.icn3d;t.icn3dui,t.realignParserCls.realignOnStructAlign()}applyCommandRealignByStruct(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredRealignByStruct=new $.Deferred((function(){s.applyCommandRealignByStructBase(e)})),t.deferredRealignByStruct.promise()}applyCommandAfmapBase(e,t){let s=this.icn3d;s.icn3dui;let i=e.substr(e.lastIndexOf(" ")+1);s.contactMapCls.afErrorMap(i,t)}applyCommandAfmap(e,t){let s=this.icn3d;s.icn3dui;let i=this;return s.deferredAfmap=new $.Deferred((function(){i.applyCommandAfmapBase(e,t)})),s.deferredAfmap.promise()}applyCommandGraphinteractionBase(e){let t=this.icn3d;t.icn3dui;let s=e.split(" | ");if(s.length>=3){let e,i=s[1].split(" "),l=i[0].split(","),n=i[1].split(","),r=-1!==s[2].indexOf("hbonds"),o=-1!==s[2].indexOf("salt bridge"),a=-1!==s[2].indexOf("interactions"),d=-1!==s[2].indexOf("halogen"),c=-1!==s[2].indexOf("pi-cation"),h=-1!==s[2].indexOf("pi-stacking");s.length>=4&&(e="true"==s[3]),t.applyCommandCls.setStrengthPara(s),t.viewInterPairsCls.viewInteractionPairs(l,n,e,"graph",r,o,a,d,c,h)}}applyCommandGraphinteraction(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredGraphinteraction=$.Deferred((function(){s.applyCommandGraphinteractionBase(e)})),t.deferredGraphinteraction.promise()}applyCommandCartoon2dBase(e){let t=this.icn3d;t.icn3dui;let s=e.substr(e.lastIndexOf(" ")+1);t.cartoon2dCls.draw2Dcartoon(s)}applyCommandCartoon2d(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredCartoon2d=$.Deferred((function(){s.applyCommandCartoon2dBase(e)})),t.deferredCartoon2d.promise()}applyCommandAnnotationsAndCddSiteBase(e){let t=this.icn3d;t.icn3dui,"view annotations"==e&&t.showAnnoCls.showAnnotations()}applyCommandAnnotationsAndCddSite(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredAnnoCddSite=$.Deferred((function(){s.applyCommandAnnotationsAndCddSiteBase(e)})),t.deferredAnnoCddSite.promise()}applyCommandClinvarBase(e){let t=this.icn3d;t.icn3dui;let s=e.lastIndexOf(" ");e.substr(s+1),t.annotationCls.setAnnoTabClinvar()}applyCommandSnpBase(e){let t=this.icn3d;t.icn3dui;let s=e.lastIndexOf(" ");e.substr(s+1),t.annotationCls.setAnnoTabSnp()}applyCommandClinvar(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredClinvar=$.Deferred((function(){s.applyCommandClinvarBase(e)})),t.deferredClinvar.promise()}applyCommandSnp(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredSnp=$.Deferred((function(){s.applyCommandSnpBase(e)})),t.deferredSnp.promise()}applyCommand3ddomainBase(e){let t=this.icn3d;t.icn3dui;let s=e.lastIndexOf(" "),i=e.substr(s+1);"3ddomain"!=i&&"all"!=i||t.annotationCls.setAnnoTab3ddomain()}applyCommand3ddomain(e){this.icn3d.icn3dui;this.applyCommand3ddomainBase(e)}applyCommandViewinteractionBase(e){let t=this.icn3d,s=t.icn3dui;if(void 0!==s.cfg.align||void 0!==s.cfg.chainalign){let e=Object.keys(t.structures);t.ParserUtilsCls.set2DDiagramsForAlign(e[0].toUpperCase(),e[1].toUpperCase())}}applyCommandViewinteraction(e){let t=this.icn3d;t.icn3dui;let s=this;return t.deferredViewinteraction=$.Deferred((function(){s.applyCommandViewinteractionBase(e)})),t.deferredViewinteraction.promise()}renderFinalStep(e){let t=this.icn3d,s=t.icn3dui;t.bCommandLoad=!1,t.ParserUtilsCls.hideLoading(),e+1===t.commands.length&&(t.bAddCommands=!0),t.bRender=!0;let i=t.commands[e-1]?t.commands[e-1].split("|||"):[];if(2==i.length){let e=JSON.parse(i[1]);t._zoomFactor=e.factor,t.mouseChange.x=e.mouseChange.x,t.mouseChange.y=e.mouseChange.y,t.quaternion._x=e.quaternion._x,t.quaternion._y=e.quaternion._y,t.quaternion._z=e.quaternion._z,t.quaternion._w=e.quaternion._w}if(t.selectionCls.oneStructurePerWindow(),1===e||Object.keys(t.hAtoms).length===Object.keys(t.atoms).length||void 0!==t.optsHistory[e-1]&&t.optsHistory[e-1].hasOwnProperty("hlatomcount")&&t.optsHistory[e-1].hlatomcount===Object.keys(t.atoms).length)if(t.optsHistory.length>=e){let s=t.optsHistory[e-1].pk;"no"===s?t.pk=0:"atom"===s?t.pk=1:"residue"===s?t.pk=2:"strand"===s&&(t.pk=3),t.hlUpdateCls.updateHlAll(),t.drawCls.draw()}else t.hlUpdateCls.updateHlAll(),t.drawCls.draw();else t.hlUpdateCls.updateHlAll(),t.drawCls.draw();s.cfg.closepopup&&(setTimeout((function(){t.resizeCanvasCls.closeDialogs()}),100),t.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH,s.htmlCls.HEIGHT,!0)),t.bTransparentSurface&&t.bRender&&t.drawCls.render(),void 0!==s.deferred&&s.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()}replayFirstStep(e){let t=this.icn3d,s=t.icn3dui;t.reinitAfterLoad(),this.execCommandsBase(e,e,t.STATENUMBER);let i=t.commands[e],l=t.commands[e].indexOf("|");-1!=l&&(i=t.commands[e].substr(0,l));let n=i.length>20?i.substr(0,20)+"...":i,r=t.applyCommandCls.getMenuFromCmd(i);$("#"+t.pre+"replay_cmd").html("Cmd: "+n),$("#"+t.pre+"replay_menu").html("Menu: "+r),s.htmlCls.clickMenuCls.setLogCmd(i,!0),t.bCommandLoad=!1,t.ParserUtilsCls.hideLoading(),t.bRender=!0,t.drawCls.draw()}}class he{constructor(e){this.icn3d=e}resizeCanvas(e,t,s,i){var l=this.icn3d,n=l.icn3dui;if(s||n.cfg.resize){let s=t;$("#"+l.pre+"canvas").width(e).height(s),$("#"+l.pre+"viewer").width(e).height(t),$("#"+l.divid+" div:has(#"+l.pre+"canvas)").width(e).height(s),l.applyCenterCls.setWidthHeight(e,s),(void 0===i||i)&&l.drawCls.draw()}}windowResize(){let e=this.icn3d.icn3dui,t=this;e.cfg.resize&&!e.utilsCls.isMobile()&&$(window).resize((function(){let s=t.icn3d;e.utilsCls.setViewerWidthHeight(s.icn3dui);let i=e.htmlCls.WIDTH,l=e.htmlCls.HEIGHT;void 0===s||s.bFullscreen||t.resizeCanvas(i,l)}))}openFullscreen(e){this.icn3d.icn3dui.bNode||document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())}rotStruc(e,t){var s=this.icn3d;s.icn3dui;let i=this;if(s.bStopRotate)return!1;if(s.transformCls.rotateCount>s.transformCls.rotateCountMax)return s.transformCls.resetOrientation(),!1;if(++s.transformCls.rotateCount,t)if("left"===e)s.ROT_DIR="left";else if("right"===e)s.ROT_DIR="right";else if("up"===e)s.ROT_DIR="up";else{if("down"!==e)return!1;s.ROT_DIR="down"}if("left"===e&&"left"===s.ROT_DIR)s.transformCls.rotateLeft(1);else if("right"===e&&"right"===s.ROT_DIR)s.transformCls.rotateRight(1);else if("up"===e&&"up"===s.ROT_DIR)s.transformCls.rotateUp(1);else{if("down"!==e||"down"!==s.ROT_DIR)return!1;s.transformCls.rotateDown(1)}setTimeout((function(){i.rotStruc(e)}),100)}back(){var e=this.icn3d;e.icn3dui,e.backForward=!0,e.STATENUMBER--,e.bAddCommands=!1,e.bAddLogs=!1,e.bNotLoadStructure=!0,e.STATENUMBER<1?e.STATENUMBER=1:e.loadScriptCls.execCommands(0,e.STATENUMBER-1,e.STATENUMBER,!0),e.setStyleCls.adjustIcon(),e.bAddCommands=!0,e.bAddLogs=!0}forward(){var e=this.icn3d;e.icn3dui,e.backForward=!0,e.STATENUMBER++,e.bAddCommands=!1,e.bAddLogs=!1,e.bNotLoadStructure=!0,e.STATENUMBER>e.commands.length?e.STATENUMBER=e.commands.length:e.loadScriptCls.execCommands(0,e.STATENUMBER-1,e.STATENUMBER,!0),e.setStyleCls.adjustIcon(),e.bAddCommands=!0,e.bAddLogs=!0}replayon(){var e=this.icn3d;e.icn3dui,e.CURRENTNUMBER=0,e.bReplay=1,$("#"+e.pre+"replay").show(),e.commands.length>0&&e.loadScriptCls.replayFirstStep(e.CURRENTNUMBER)}replayoff(){var e=this.icn3d;e.icn3dui,e.bReplay=0,$("#"+e.pre+"replay").hide(),++e.CURRENTNUMBER,e.loadScriptCls.execCommands(e.CURRENTNUMBER,e.STATENUMBER-1,e.STATENUMBER)}closeDialogs(){var e=this.icn3d,t=e.icn3dui;let s=["dl_2ddgm","dl_2dctn","dl_alignment","dl_sequence2","dl_definedsets","dl_setsmenu","dl_command","dl_setoperations","dl_vast","dl_foldseek","dl_mmtfid","dl_pdbid","dl_afid","dl_opmid","dl_pdbfile","dl_pdbfile_app","dl_rescolorfile","dl_customcolor","dl_align","dl_alignaf","dl_chainalign","dl_mutation","dl_mol2file","dl_sdffile","dl_xyzfile","dl_afmapfile","dl_urlfile","dl_mmciffile","dl_mmcifid","dl_mmdbid","dl_mmdbafid","dl_blast_rep_id","dl_yournote","dl_gi","dl_uniprotid","dl_cid","dl_pngimage","dl_state","dl_fixedversion","dl_selection","dl_dsn6","dl_dsn6url","dl_clr","dl_symmetry","dl_symd","dl_contact","dl_hbonds","dl_realign","dl_realignbystruct","dl_allinteraction","dl_interactionsorted","dl_linegraph","dl_linegraphcolor","dl_scatterplot","dl_scatterplotcolor","dl_contactmap","dl_alignerrormap","dl_elecmap2fofc","dl_elecmapfofc","dl_emmap","dl_aroundsphere","dl_adjustmem","dl_selectplane","dl_addlabel","dl_addlabelselection","dl_labelColor","dl_distance","dl_stabilizer","dl_disttwosets","dl_distmanysets","dl_stabilizer_rm","dl_thickness","dl_thickness2","dl_addtrack","dl_addtrack_tabs","dl_saveselection","dl_copyurl","dl_selectannotations","dl_annotations_tabs","dl_anno_view_tabs","dl_annotations","dl_graph","dl_svgcolor","dl_area","dl_colorbyarea","dl_rmsd","dl_buriedarea","dl_propbypercentout","dl_propbybfactor","dl_legend","dl_disttable"];for(let i in s){let l=s[i];t.cfg.notebook?$("#"+e.pre+l).hide():$("#"+e.pre+l).hasClass("ui-dialog-content")&&$("#"+e.pre+l).dialog("isOpen")&&$("#"+e.pre+l).dialog("close")}t.cfg.notebook||this.resizeCanvas(t.htmlCls.WIDTH,t.htmlCls.HEIGHT,!0)}}class me{constructor(e){this.icn3d=e,this.dcut=8,this.MAX_SSE=512,this.ctc_cnt=[];for(let e=0;e<this.MAX_SSE;++e)this.ctc_cnt[e]=[];this.elt_size=[],this.elt_size.length=this.MAX_SSE,this.group_num=[],this.group_num.length=this.MAX_SSE,this.split_ratio=0,this.min_size=0,this.min_sse=0,this.max_csz=0,this.mean_cts=0,this.c_delta=0,this.nc_fact=0,this.elements=[],this.elements.length=2*this.MAX_SSE,this.stack=[],this.stack.length=this.MAX_SSE,this.top=0,this.curr_prt0=[],this.curr_prt0.length=this.MAX_SSE,this.curr_prt1=[],this.curr_prt1.length=this.MAX_SSE,this.curr_ne0=0,this.curr_ne1=0,this.curr_ratio=0,this.curr_msize=0,this.parts=[],this.parts.length=2*this.MAX_SSE,this.np=0,this.n_doms=0,this.save_ratios=[],this.save_ratios.length=this.MAX_SSE,this.saved=0}update_partition(e,t,s){this.icn3d.icn3dui;let i,l,n,r,o,a,d,c,h,m,p,u,C,g,f=[],b=[],y=[],v=[];for(y.length=this.MAX_SSE,v.length=this.MAX_SSE,i=this.stack[this.top-1],l=this.elements.length;i<l;++i)f.push(this.elements[i]);for(i=c=h=m=0,b=y,r=-1;i<t;i++){for(n=r+1;n<=e[i];n++)b[c++]=f[n];r=e[i],b==y?(h=c,b=v,c=m):(m=c,b=y,c=h)}for(n=r+1;n<s;n++)b[c++]=f[n];if(b==y?h=c:m=c,h<this.min_sse&&m<this.min_sse)return e;for(i=0;i<h;i++)for(r=this.group_num[y[i]],n=0;n<m;n++)if(r==this.group_num[v[n]])return e;for(i=p=0;i<h;i++)p+=this.elt_size[y[i]];for(i=u=0;i<m;i++)u+=this.elt_size[v[i]];for(i=o=0;i<h;i++)for(n=i;n<h;n++)o+=this.ctc_cnt[y[i]][y[n]];for(i=a=0;i<m;i++)for(n=i;n<m;n++)a+=this.ctc_cnt[v[i]][v[n]];if(1*o/p<this.mean_cts||1*a/u<this.mean_cts)return e;for(o=Math.max(o,this.nc_fact*p),a=Math.max(a,this.nc_fact*u),i=d=0;i<h;i++)for(r=y[i],n=0;n<m;n++)d+=this.ctc_cnt[r][v[n]];if(C=Math.min(o,a),g=1*d/(C+1),g>=this.curr_ratio+.01||g>this.split_ratio)return e;if(g>this.curr_ratio-.01&&Math.min(p,u)<this.curr_msize)return e;for(i=0;i<h;i++)this.curr_prt0[i]=y[i];for(i=0;i<m;i++)this.curr_prt1[i]=v[i];return this.curr_ne0=h,this.curr_ne1=m,this.curr_ratio=g,this.curr_msize=Math.min(p,u),e}cut_size(e,t){this.icn3d.icn3dui;let s,i,l,n=[];for(n.length=this.MAX_SSE,s=0;s<e;s++)n[s]=s;for(;;){for(s=l=1;s<e;s++)if(n[s]-n[s-1]<=this.c_delta){l=0;break}for(l&&n[e-1]<t-1&&(n=this.update_partition(n,e,t)),i=e-1;i>=0&&n[i]==t-e+i;i--);if(i<0)break;for(n[i]++,s=i+1;s<e;s++)n[s]=n[s-1]+1}}process_set(){this.icn3d.icn3dui;let e,t,s,i,l,n,r=[];for(e=this.stack[this.top-1],t=this.elements.length;e<t;++e)r.push(this.elements[e]);for(i=0;i<r.length&&r[i]>-1;i++);for(n=Math.min(i-1,this.max_csz),this.curr_ne0=this.curr_ne1=0,this.curr_ratio=100,s=1;s<=n;s++)this.cut_size(s,i);if(this.top--,0==this.curr_ne0){for(l=this.stack[this.top],e=l;e<this.elements.length&&this.elements[e]>-1;e++)this.parts[this.np++]=this.elements[e];this.parts[this.np++]=-1,this.n_doms++}else{if(this.save_ratios[this.saved++]=this.curr_ratio,this.curr_ne0>this.min_sse){for(l=this.stack[this.top],e=0;e<this.curr_ne0;e++)this.elements[l++]=this.curr_prt0[e];this.elements[l++]=-1,this.stack[++this.top]=l}else{for(e=0;e<this.curr_ne0;e++)this.parts[this.np++]=this.curr_prt0[e];this.parts[this.np++]=-1,this.n_doms++}if(this.curr_ne1>this.min_sse){for(l=this.stack[this.top],e=0;e<this.curr_ne1;e++)this.elements[l++]=this.curr_prt1[e];this.elements[l++]=-1,this.stack[++this.top]=l}else{for(e=0;e<this.curr_ne1;e++)this.parts[this.np++]=this.curr_prt1[e];this.parts[this.np++]=-1,this.n_doms++}}}process_all(e){let t;for(this.icn3d.icn3dui,this.top=1,this.stack[0]=this.np=this.n_doms=0,this.saved=0,t=0;t<e;t++)this.elements[t]=t;for(this.elements[e]=-1;this.top>0;)this.process_set()}output(e){let t,s;this.icn3d.icn3dui;let i=[];for(t=0;t<2*e;t++)i.push(0);for(t=s=0;s<this.n_doms;t++)i[t]=this.parts[t]+1,this.parts[t]<0&&s++;return i}new_split_chain(e,t,s,i,l,n,r,o,a,d,c){let h;for(this.icn3d.icn3dui,this.split_ratio=t,this.min_size=s,this.min_sse=i,this.max_csz=l,this.mean_cts=n,this.c_delta=r,this.nc_fact=o,this.process_all(e),this.parts=this.output(e),d=this.saved,h=0;h<this.saved;h++)c[h]=this.save_ratios[h];return d}c2b_AlphaContacts(e,t,s,i,l){this.icn3d.icn3dui,l||(l=this.dcut);let n=[],r=[];for(let l=0;l<e;l++){if(!t[l]||!s[l]||!i[l])continue;let e={};e.rnum=l+1,e.x=t[l],e.y=s[l],e.z=i[l],r.push(e)}r.sort((function(e,t){return e.x-t.x}));let o,a,d=r.length;for(o=0;o<d;++o){let e=r[o],t=e.x,s=e.y,i=e.z;for(a=o+1;a<d;++a){let o=r[a];if(e.rnum-o.rnum<=3&&o.rnum-e.rnum<=3)continue;let d=o.x,c=o.y,h=o.z;if(d>t+l)break;let m=(t-d)*(t-d);m+=(s-c)*(s-c),m+=(i-h)*(i-h);let p=Math.sqrt(m);if(p>l)continue;let u={},C={};e.rnum<o.rnum?(C.first=e.rnum,C.second=o.rnum):(C.first=o.rnum,C.second=e.rnum),u.first=C,u.second=p,n.push(u)}}return n}c2b_ContactTable(e,t){this.icn3d.icn3dui;let s={},i=e.length;if(i!=t.length)return s;for(let l=0;l<i;l++){let i=e[l]+"_"+t[l];s[i]?s[i]++:s[i]=1}return s}countUtil(e,t,s){this.visited[e]=!0,this.groupnum2sheet[s]||(this.groupnum2sheet[s]=[]),this.groupnum2sheet[s].push(parseInt(e));for(let i in t[e])this.visited[i]||this.countUtil(i,t,s)}c2b_NewSplitChain(e,t){let s=this.icn3d;s.icn3dui;let i=[],l=[],n=[],r=[],o=[],a=[],d=s.firstAtomObjCls.getResiduesFromAtoms(e),c=Object.keys(d);c[0].substr(0,c[0].lastIndexOf("_"));let h={},m=0;for(let e=0;e<c.length;++e){let t=c[e],o=t.substr(t.lastIndexOf("_")+1);if(0==e){m=o-1;for(let e=0;e<m;++e)i.push(void 0),l.push(void 0),n.push(void 0)}let a=s.firstAtomObjCls.getFirstCalphaAtomObj(s.residues[t]);a?(i.push(a.coord.x),l.push(a.coord.y),n.push(a.coord.z)):(i.push(void 0),l.push(void 0),n.push(void 0)),a&&(a.ssend&&(h.To=parseInt(o),h.x2=a.coord.x,h.y2=a.coord.y,h.z2=a.coord.z,h.Sheet="sheet"==a.ss,r.push(h),h={}),a.ssbegin&&(h.From=parseInt(o),h.x1=a.coord.x,h.y1=a.coord.y,h.z1=a.coord.z))}let p=r.length;if(p<=3)return{subdomains:o,substruct:r};if(p>this.MAX_SSE)return{subdomains:o,substruct:r};let u=c.length+m,C=this.c2b_AlphaContacts(u,i,l,n,t),g=[];for(let e=0;e<u;e++)g.push(0);let f=!1;for(let e=0;e<r.length;e++){let t=r[e],s=t.From,i=t.To;this.elt_size[e]=i-s+1;for(let t=s;t<=i;t++)g[t-1]=e+1;t.Sheet&&(f=!0)}let b=[],y=[],v=[],_=[];for(let e=0,t=C.length;e<t;++e){let t=C[e].first,s=g[t.first-1],i=g[t.second-1];s<=0||i<=0||!s||!i||(b.push(s),y.push(i),s!=i&&(v.push(s),_.push(i)))}for(let e=0;e<v.length;e++)b.push(_[e]),y.push(v[e]);for(let e=0;e<p;e++)b.push(e+1),y.push(e+1);let S=this.c2b_ContactTable(b,y),w={};for(let e in S){let t=e.split("_"),s=parseInt(t[0]),i=parseInt(t[1]);r[s-1].Sheet&&r[i-1].Sheet&&(w[s]||(w[s]={}),w[i]||(w[i]={}),w[s][i]=1,w[i][s]=1)}let A=0,x={};this.groupnum2sheet={},this.visited={};for(let e in w)this.visited[e]=!1;for(let e in w)0==this.visited[e]&&(A++,this.countUtil(e,w,A));for(let e in this.groupnum2sheet){let t=this.groupnum2sheet[e].sort();for(let e=0,s=t.length;e<s;++e)x[t[e]]=t[0]}for(let e=0;e<p;e++)if(r[e].Sheet){let t={};x[e+1]?(t.sheet_num=x[e+1],t.adj_strand2=1,t.sse=e+1):(t.sheet_num=0,t.adj_strand2=0,t.sse=e+1),a.push(t)}for(let e=0;e<p;e++)for(let t=0;t<p;t++){let s=(e+1).toString()+"_"+(t+1).toString();if(S[s]){let i=S[s];e==t&&i--,this.ctc_cnt[e][t]=i,this.ctc_cnt[t][e]=i}else this.ctc_cnt[e][t]=0}if(f){let e=0;for(let t=0;t<a.length;t++){let s=a[t];s.sheet_num>0&&this.elt_size[s.sse-1]>=6&&0!=s.adj_strand2&&e++}for(let e=0;e<p;e++)this.group_num[e]=e+1;if(e>0)for(let e=0;e<a.length;e++){let t=a[e];this.group_num[t.sse-1]=t.sheet_num}}else for(let e=0;e<p;e++)this.group_num[e]=e+1;this.parts=[],this.parts.length=2*this.MAX_SSE;let k=[];k.length=this.MAX_SSE;let O=0;for(let e=0;e<p;e++)this.parts[2*e]=this.parts[2*e+1]=0,k[e]=0;O=this.new_split_chain(p,.25,25,3,4,0,3,0,this.parts,O,k);let H=[];if(O>0){let e=0;for(let t=0;t<=O;t++){let t=[];for(;e<2*p;){let s=this.parts[e++];if(0==s){H.push(t);break}t.push(s)}}}H.sort((function(e,t){return e[0]-t[0]}));for(let e=0,t=H.length;e<t;++e){let t=H[e],s=[];if(t.length<=2)continue;for(let e=0;e<u;e++)s.push(0);for(let e=0;e<t.length;e++){let i=t[e]-1;if(i<0||i>=r.length)return{subdomains:o,substruct:r};let l=r[i],n=l.From,a=l.To;for(let e=n;e<=a;e++)s[e-1]=1;if(0==i&&n>1)for(let e=1;e<n;e++)n-e<=10&&(s[e-1]=1);if(i==r.length-1&&a<u)for(let e=a+1;e<=u;e++)e-a<=10&&(s[e-1]=1);if(i>0){let e=r[i-1].To,t=parseInt(.5*(n-e-1));if(t>0)for(let e=n-t;e<=n-1;e++)s[e-1]=1}if(i<r.length-1){let e=r[i+1].From,t=parseInt(.5*(e-a-1)+.5);if(t>0)for(let e=a+1;e<=a+t;e++)s[e-1]=1}}let i,l=!1,n=[];for(let e=0;e<u;e++){let t=s[e];l||1!=t?l&&0==t&&(n.push(i),n.push(e),l=!1):(i=e+1,l=!0)}l&&(n.push(i),n.push(u)),o.push(n)}return{subdomains:o,substruct:r}}getDomainJsonForAlign(e){let t=this.icn3d,s=t.icn3dui,i=this.c2b_NewSplitChain(e),l=i.subdomains,n=i.substruct,r=t.firstAtomObjCls.getResiduesFromAtoms(e),o=Object.keys(r),a=o[0].substr(0,o[0].lastIndexOf("_"));l.push([parseInt(o[0].substr(o[0].lastIndexOf("_")+1)),parseInt(o[o.length-1].substr(o[o.length-1].lastIndexOf("_")+1))]);let d='{"data": [';for(let e=0,i=l.length;e<i;++e){e>0&&(d+=", "),d+='{"ss": [';let i=0;for(let s=0,r=l[e].length;s<r;s+=2){let r=l[e][s],o=l[e][s+1];for(let e=0,s=n.length;e<s;++e){let s=n[e].Sheet?2:1,l=n[e].From,c=n[e].To,h=a+"_"+l,m=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[h]);if(!m||!t.hAtoms.hasOwnProperty(m.serial))continue;let p=a+"_"+c,u=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[p]);u&&t.hAtoms.hasOwnProperty(u.serial)&&(l>=r&&c<=o&&(i>0&&(d+=", "),d+="["+s+","+l+","+c+","+n[e].x1.toFixed(2)+","+n[e].y1.toFixed(2)+","+n[e].z1.toFixed(2)+","+n[e].x2.toFixed(2)+","+n[e].y2.toFixed(2)+","+n[e].z2.toFixed(2)+"]",++i))}}d+="]",d+=', "domain": [';let r=0;for(let i=0,n=l[e].length;i<n;i+=2){let n=l[e][i],a=l[e][i+1];for(let e=0,i=o.length;e<i;++e){let i=o[e],l=i.substr(i.lastIndexOf("_")+1),c=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[i]);if(!c)continue;if(!t.hAtoms.hasOwnProperty(c.serial))continue;let h=s.parasCls.resn2restype[c.resn];void 0!==h&&l>=n&&l<=a&&(r>0&&(d+=", "),d+="["+l+","+h+","+c.coord.x.toFixed(2)+","+c.coord.y.toFixed(2)+","+c.coord.z.toFixed(2)+"]",++r)}}d+="]}"}return d+="]}",d}}class pe{constructor(e){this.icn3d=e}showSeq(e,t,s,i,l,n,r){let o,a=this.icn3d,d=a.icn3dui,c=!1;if(void 0===d.cfg.mmdbid&&void 0===d.cfg.gi&&void 0===d.cfg.blast_rep_id&&void 0===d.cfg.align&&void 0===d.cfg.chainalign&&void 0===d.cfg.mmdbafid){c=!0,o=[];for(let t=0;t<a.giSeq[e].length;++t)o.push(a.chainsSeq[e][t])}else o=a.giSeq[e];let h=[];for(let e=0,t=o.length;e<t;++e)o[e]&&h.push(o[e]);o=h;let m=d.htmlCls.RESIDUE_WIDTH*(a.giSeq[e].length+a.nTotalGap)+200,p=a.giSeq[e].length;p>a.maxAnnoLength&&(a.maxAnnoLength=p);let u=["giseq","cddsite","clinvar","snp","domain","interaction","custom","ssbond","crosslink","transmem"];for(let t in u){let s=u[t];$("#"+a.pre+s+"_"+e).length&&$("#"+a.pre+s+"_"+e).width(m)}let C,g="",f="",b="";if(g+='<div class="icn3d-dl_sequence">',b+='<div class="icn3d-dl_sequence">',a.giSeq[e].length>10){C='<div class="icn3d-residueLine" style="white-space:nowrap;">';let t=a.firstAtomObjCls.getFirstCalphaAtomObj(a.chains[e]);void 0===d.cfg.mmdbid&&void 0===d.cfg.gi&&void 0===d.cfg.blast_rep_id&&void 0===d.cfg.align&&void 0===d.cfg.chainalign&&void 0===d.cfg.mmdbafid||void 0===t.resi_ori||t.resi_ori==t.resi||-1!=e.indexOf("Misc")?C+='<div class="icn3d-annoTitle" anno="0"></div>':C+='<div class="icn3d-annoTitle" anno="0" title="NCBI Residue Numbers">NCBI Residue Numbers</div>',C+='<span class="icn3d-residueNum"></span>',b+=C+"<br>",g+=C+'<span class="icn3d-seqLine">';let s=0,i=0,l="";for(let t=0,n=o.length;t<n;++t){let n;g+=this.insertGap(e,t,"-"),n=c?o[t].resi:t>=a.matchedPos[e]&&t-a.matchedPos[e]<a.chainsSeq[e].length?a.chainsSeq[e][t-a.matchedPos[e]].resi:a.baseResi[e]+1+t,g+="<span>",n%10==0&&(g+=n);let r=e+"_"+n,d=n%10!=0&&n%10!=1&&n%10!=9;if(a.residues.hasOwnProperty(r)){let e=a.firstAtomObjCls.getFirstCalphaAtomObj(a.residues[r]);"H"==a.secondaries[r]&&e.ssbegin?(++s,l='<span class="icn3d-helix-color">H'+s+"</span>",d&&(g+=l,l="")):"E"==a.secondaries[r]&&e.ssbegin?(++i,"green"==a.sheetcolor?l='<span class="icn3d-sheet-color">S'+i+"</span>":"yellow"==a.sheetcolor&&(l='<span class="icn3d-sheet-colory">S'+i+"</span>"),d&&(g+=l,l="")):e.ssend&&(l=""),""!=l&&d&&(g+=l,l="")}g+="</span>"}g+='<span class="icn3d-residueNum"></span>',g+="</span>",g+="<br>",g+="</div>",b+="</div>"}C='<div class="icn3d-residueLine" style="white-space:nowrap;">',C+='<div class="icn3d-annoTitle" anno="0"></div>',C+='<span class="icn3d-residueNum"></span>',b+=C+"<br>",g+=C+'<span class="icn3d-seqLine">';for(let t=0,s=o.length;t<s;++t){g+=this.insertGap(e,t,"-");let s=e+"_"+(t>=a.matchedPos[e]&&t-a.matchedPos[e]<a.chainsSeq[e].length?a.chainsSeq[e][t-a.matchedPos[e]].resi:a.baseResi[e]+1+t);if(a.residues.hasOwnProperty(s))if("H"==a.secondaries[s])g+=t%2==0?'<span class="icn3d-helix">':'<span class="icn3d-helix2">',g+="&nbsp;</span>";else if("E"==a.secondaries[s]){a.firstAtomObjCls.getFirstCalphaAtomObj(a.residues[s]).ssend?"green"==a.sheetcolor?g+='<span class="icn3d-sheet2">':"yellow"==a.sheetcolor&&(g+='<span class="icn3d-sheet2y">'):"green"==a.sheetcolor?g+='<span class="icn3d-sheet">':"yellow"==a.sheetcolor&&(g+='<span class="icn3d-sheety">'),g+="&nbsp;</span>"}else"c"==a.secondaries[s]?g+='<span class="icn3d-coil">&nbsp;</span>':"o"==a.secondaries[s]&&(g+='<span class="icn3d-other">&nbsp;</span>');else g+="<span>-</span>"}g+='<span class="icn3d-residueNum"></span>',g+="</span>",g+="<br>",g+="</div>",g+="</div>",b+="</div></div>",C=d.cfg.blast_rep_id===e?'<div id="'+a.pre+'giseq_sequence" class="icn3d-dl_sequence" style="border: solid 1px #000">':'<div id="'+a.pre+'giseq_sequence" class="icn3d-dl_sequence">';let y="Protein",v="Protein";void 0!==s&&("nucleotide"==s?(y="Nucl.",v="Nucleotide"):"chemical"==s&&(y="Chem.",v="Chemical")),C+='<div class="icn3d-seqTitle icn3d-link icn3d-blue" gi="'+e+'" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+v+" "+e+'">'+y+" "+e+"</span></div>",C+='<span class="icn3d-residueNum" title="starting protein sequence number">'+(a.baseResi[e]+1).toString()+"</span>",b+=C+"<br>";let _='<span class="icn3d-seqLine">';g+=C+_,f+=C+_;let S,w=0;for(let t=0,s=o.length;t<s;++t){g+=this.insertGap(e,t,"-"),void 0!==a.targetGapHash&&a.targetGapHash.hasOwnProperty(t)&&(w+=a.targetGapHash[t].to-a.targetGapHash[t].from+1);let s=c?o[t].name:o[t],i=s;if(s.length>1&&(i=s[0]+".."),S=t>=a.matchedPos[e]&&t-a.matchedPos[e]<a.chainsSeq[e].length?a.chainsSeq[e][t-a.matchedPos[e]].resi:a.baseResi[e]+1+t,a.residues.hasOwnProperty(e+"_"+S)){let l="333333";if(d.cfg.blast_rep_id==e&&void 0!==a.fullpos2ConsTargetpos&&void 0!==a.fullpos2ConsTargetpos[t+w])l=a.fullpos2ConsTargetpos[t+w].color;else{let t=a.firstAtomObjCls.getFirstCalphaAtomObj(a.residues[e+"_"+S]),s=void 0===t.color||"FFFFFF"===t.color.getHexString()?"DDDDDD":t.color.getHexString();l=void 0!==t.color?s:"CCCCCC"}g+='<span id="giseq_'+a.pre+e+"_"+S+'" title="'+s+S+'" class="icn3d-residue" style="color:#'+l+'">'+i+"</span>"}else i=i.toLowerCase(),g+='<span title="'+s+S+'" class="icn3d-residue">'+i+"</span>"}d.cfg.blast_rep_id==e&&(a.opts.color="conservation",a.setColorCls.setColorByOptions(a.opts,a.atoms));let A=a.firstAtomObjCls.getFirstCalphaAtomObj(a.chains[e]),x=A.color?A.color.getHexString():"CCCCCC",k=Math.round(a.seqAnnWidth*o.length/a.maxAnnoLength);if(k<1&&(k=1),d.cfg.blast_rep_id!=e)f+='<div id="giseq_summary_'+a.pre+e+'" class="icn3d-seqTitle icn3d-link" gi chain="'+e+'" style="display:inline-block; color:white; font-weight:bold; background-color:#'+x+"; width:"+k+'px;">'+e+"</div>";else{let t=[],s=[];t.push(0);for(let e=0,i=o.length;e<i;++e)void 0!==a.targetGapHash&&a.targetGapHash.hasOwnProperty(e)&&(s.push(e-1),t.push(e));s.push(o.length-1),f+='<div id="giseq_summary_'+a.pre+e+'" class="icn3d-seqTitle icn3d-link" gi chain="'+e+'" style="width:'+k+'px;">';for(let i=0,l=t.length;i<l;++i)f+=this.insertGapOverview(e,t[i]),f+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+x+"; width:"+Math.round(a.seqAnnWidth*(s[i]-t[i]+1)/(a.maxAnnoLength+a.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" anno="sequence" gi chain="'+e+'" title="'+e+'">'+e+"</div>";f+="</div>"}if(C='<span class="icn3d-residueNum" title="ending protein sequence number">'+S+"</span>",C+="</span>",C+="<br>",g+=C,f+=C,d.cfg.blast_rep_id==e){if(void 0!==r&&""!==r){C='<div class="icn3d-seqTitle icn3d-link icn3d-blue" blast="" posarray="'+a.consrvResPosArray.toString()+'" title="'+l+'" setname="'+e+'_blast" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+l+'">'+l+"</span></div>",C+='<span class="icn3d-residueNum"></span>',b+=C+"<br>";let t='<span class="icn3d-seqLine">';g+=C+t,f+=C+t;let s=0,i=0,n=1;a.queryStart;for(let t=0,l=r.length;t<l;++t){let l=r[t];if("-"==l)g+="<span>-</span>";else if(" "==l)g+="<span> </span>";else{let r=a.fullpos2ConsTargetpos[t].pos;if(a.residues.hasOwnProperty(e+"_"+r)){let s=a.fullpos2ConsTargetpos[t].color;g+='<span id="giseq_'+a.pre+e+"_"+r+'" title="'+a.fullpos2ConsTargetpos[t].res+r+'" class="icn3d-residue" style="color:#'+s+'">'+l+"</span>"}else l=l.toLowerCase(),g+='<span class="icn3d-residue">'+l+"</span>";f+=this.insertGapOverview(e,t);let o=Math.round(a.seqAnnWidth*t/(a.maxAnnoLength+a.nTotalGap)-s-i);o>=0&&(f+='<div style="display:inline-block; width:'+o+'px;">&nbsp;</div>',f+='<div style="display:inline-block; background-color:#F00; width:'+n+'px;" title="'+l+r+'">&nbsp;</div>',s+=o,i+=n)}}C='<span class="icn3d-residueNum"></span>',C+="</span>",C+="<br>",g+=C,f+=C}C='<div class="icn3d-annoTitle" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+i+'">'+i+"</span></div>",C+='<span class="icn3d-residueNum" title="starting protein sequence number">'+a.queryStart+"</span>",b+=C+"<br>";let t='<span class="icn3d-seqLine" style="font-weight: bold;">';g+=C+t,f+=C+t;let s=a.queryStart;for(let t=0,i=n.length;t<i;++t){let i=n[t];" "==i||"-"==i?g+="<span>-</span>":(void 0===a.fullpos2ConsTargetpos||void 0===a.fullpos2ConsTargetpos[t]||a.residues.hasOwnProperty(e+"_"+a.fullpos2ConsTargetpos[t].pos)||(i=i.toLowerCase()),g+='<span title="'+i+s+'" class="icn3d-residue">'+i+"</span>",++s)}let o=a.firstAtomObjCls.getFirstCalphaAtomObj(a.chains[e]),d=void 0===o.color||"FFFFFF"===o.color.getHexString()?"DDDDDD":o.color.getHexString(),c=void 0!==o.color?d:"CCCCCC",h=[],m=[],p="-";for(let e=0,t=n.length;e<t;++e){let t=n[e];"-"!=t&&"-"==p?h.push(e):"-"==t&&"-"!=p&&m.push(e-1),p=t}"-"!=p&&m.push(n.length-1);for(let t=0,s=h.length;t<s;++t){f+='<div style="display:inline-block; width:'+(0==t?Math.round(a.seqAnnWidth*(h[t]-a.baseResi[e]-1)/(a.maxAnnoLength+a.nTotalGap)):Math.round(a.seqAnnWidth*(h[t]-m[t-1]-1)/(a.maxAnnoLength+a.nTotalGap)))+'px;">&nbsp;</div>',f+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+c+"; width:"+Math.round(a.seqAnnWidth*(m[t]-h[t]+1)/(a.maxAnnoLength+a.nTotalGap))+'px;" anno="sequence" chain="'+e+'" title="'+i+'">'+i+"</div>"}C='<span class="icn3d-residueNum" title="ending protein sequence number">'+a.queryEnd+"</span>",C+="</span>",C+="<br>",g+=C,f+=C}if(g+="</div>",f+="</div>",b+="</div>",a.giSeq[e].length>10){let t=a.firstAtomObjCls.getFirstCalphaAtomObj(a.chains[e]);if((void 0!==d.cfg.mmdbid||void 0!==d.cfg.gi||void 0!==d.cfg.blast_rep_id||void 0!==d.cfg.align||void 0!==d.cfg.chainalign||void 0!==d.cfg.mmdbafid)&&void 0!==t.resi_ori&&t.resi_ori!=t.resi&&-1==e.indexOf("Misc")){C='<div class="icn3d-dl_sequence">',C+='<div class="icn3d-residueLine" style="white-space:nowrap;">',C+='<div class="icn3d-annoTitle" anno="0" title="PDB Residue Numbers">PDB Residue Numbers</div>',C+='<span class="icn3d-residueNum"></span>',b+=C+"<br>",g+=C+'<span class="icn3d-seqLine">';for(let t=0,s=o.length;t<s;++t)if(g+=this.insertGap(e,t,"-"),t>=a.matchedPos[e]&&t-a.matchedPos[e]<a.chainsSeq[e].length){let s=e+"_"+a.chainsSeq[e][t-a.matchedPos[e]].resi;if(a.residues.hasOwnProperty(s)){let e=a.firstAtomObjCls.getFirstCalphaAtomObj(a.residues[s]).resi_ori;g+="<span>",e%10==0&&(g+=e+" "),g+="</span>"}else g+="<span></span>"}else g+="<span></span>";g+='<span class="icn3d-residueNum"></span>',g+="</span>",g+="<br>",g+="</div>",g+="</div>",b+="</div></div>"}}$("#"+a.pre+"dt_giseq_"+e).html(g),$("#"+a.pre+"ov_giseq_"+e).html(f),$("#"+a.pre+"tt_giseq_"+e).html(b)}insertGap(e,t,s,i){let l=this.icn3d;l.icn3dui;let n="";if(void 0!==l.targetGapHash&&l.targetGapHash.hasOwnProperty(t))for(let e=0;e<l.targetGapHash[t].to-l.targetGapHash[t].from+1;++e)n+=i?s:"<span>"+s+"</span>";return n}insertGapOverview(e,t){let s=this.icn3d,i="";if(s.icn3dui.cfg.blast_rep_id==e&&void 0!==s.targetGapHash&&s.targetGapHash.hasOwnProperty(t)){i+='<div style="display:inline-block; background-color:#333; width:'+s.seqAnnWidth*(s.targetGapHash[t].to-s.targetGapHash[t].from+1)/(s.maxAnnoLength+s.nTotalGap)+'px; height:3px;">&nbsp;</div>'}return i}setAlternativeSeq(e,t){let s=this.icn3d;s.icn3dui;let i=s.chainsSeq[e];s.giSeq[e]=[];for(let t=0,l=i.length;t<l;++t){let l=i[t].name;s.giSeq[e][t]=l}s.matchedPos[e]=0,s.baseResi[e]=s.chainsSeq[e][0].resi-s.matchedPos[e]-1}getProteinName(e){let t=this.icn3d,s=t.icn3dui,i="";if(void 0===s.cfg.mmdbid&&void 0===s.cfg.gi&&void 0===s.cfg.blast_rep_id||void 0===t.mmdb_data)(void 0!==s.cfg.align||void 0!==s.cfg.chainalign||void 0!==s.cfg.mmdbafid||t.bRealign||t.bSymd)&&void 0!==t.chainid2title&&void 0!==t.chainid2title[e]&&(i=t.chainid2title[e]);else{let s=t.mmdb_data.moleculeInfor,l=e.substr(e.indexOf("_")+1);for(let e in s)if(s[e].chain==l){i=s[e].name.replace(/\'/g,"&prime;");break}}return i}}class ue{constructor(e){this.icn3d=e}clickAddTrackButton(){let e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+e.pre+"addtrack_button1","click",(function(e){let t=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");let i=$("#"+t.pre+"track_chainid").val(),l=$("#"+t.pre+"track_gi").val(),n=isNaN(l)?"Acc "+l:"gi "+l;$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=track",type:"POST",data:{targets:i,queries:l},dataType:"jsonp",tryCount:0,retryLimit:0,success:function(e){s.alignSequenceToStructure(i,e,n)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})})),t.myEventCls.onIds("#"+e.pre+"addtrack_button2","click",(function(e){let t=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");let i=$("#"+t.pre+"track_chainid").val(),l=$("#"+t.pre+"track_fasta").val(),n=$("#"+t.pre+"fasta_title").val();$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=track",type:"POST",data:{targets:i,queries:l},dataType:"jsonp",tryCount:0,retryLimit:0,success:function(e){s.alignSequenceToStructure(i,e,n)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})})),t.myEventCls.onIds("#"+e.pre+"addtrack_button2b","click",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");let l=$("#"+i.pre+"track_chainid").val(),n=$("#"+i.pre+"fasta_startpos").val(),r="identity"==$("#"+i.pre+"colorseqby").val()?"identity":"custom",o=$("#"+i.pre+"track_fastaalign").val().split(">"),a=o[1].indexOf("\n");o[1].substr(0,a);let d,c=o[1].substr(a+1).replace(/\n/g,""),h=[],m=[];for(let e=2,t=o.length;e<t;++e){let t=o[e].indexOf("\n"),s=o[e].substr(0,t);h.push(s);let i=o[e].substr(t+1).replace(/\n/g,"");m.push(i)}for(let e=0,t=i.giSeq[l].length;e<t;++e){(e>=i.matchedPos[l]&&e-i.matchedPos[l]<i.chainsSeq[l].length?i.chainsSeq[l][e-i.matchedPos[l]].resi:i.baseResi[l]+1+e)==n&&(d=e)}void 0===d&&alert('Please double check the start position before clicking "Add Track"'),i.targetGapHash={};let p,u,C="-",g=0,f=0,b=0,y=!1,v=0,_=0;for(let e=0,t=c.length;e<t;++e)"-"==c[e]&&c[e]!=C&&(p=f,b=0),"-"==C&&c[e]!=C&&f>0&&(u=g,i.targetGapHash[p+d]={from:p+d,to:u+b-1+d}),C=c[e],g=f,"-"!=c[e]?(++f,_=e,y||(v=e,y=!0)):++b;i.annotationCls.resetAnnoAll();let S="",w=0;for(let e in i.targetGapHash)w>0&&(S+=" "),S+=e+"_"+i.targetGapHash[e].from+"_"+i.targetGapHash[e].to,++w;t.htmlCls.clickMenuCls.setLogCmd("msa | "+S,!0);let A={};for(let e=0,o=m.length;e<o;++e){let o=n,a="";for(let e=0;e<d;++e){if(i.targetGapHash.hasOwnProperty(e))for(let t=0;t<i.targetGapHash[e].to-i.targetGapHash[e].from+1;++t)a+="-";a+="-"}for(let t=v;t<=_;++t)0==e&&(A[o]=0),a+=m[e][t],"-"!=c[t]&&(c[t]==m[e][t]&&++A[o],++o);let p=h[e].length<20?h[e]:h[e].substr(0,20)+"...",u=!0;s.showNewTrack(l,p,a,void 0,void 0,r,void 0,u),t.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+l+" | title "+p+" | text "+s.simplifyText(a)+" | type "+r+" | color 0 | msa 1",!0)}if(m.length>0){void 0===i.queryresi2score&&(i.queryresi2score={}),void 0===i.queryresi2score[l]&&(i.queryresi2score[l]={});let e=m.length;for(let t in A){let s=parseInt(A[t]/e*100);i.queryresi2score[l][t]=s}let s=Object.keys(A),n=Math.min.apply(null,s),r=Math.max.apply(null,s),o="";for(let t=n;t<=r;++t)A.hasOwnProperty(t)?o+=Math.round(A[t]/e*9):o+="_";i.opts.color="align custom",i.setColorCls.setColorByOptions(i.opts,i.hAtoms),i.hlUpdateCls.updateHlAll(),i.drawCls.draw(),t.htmlCls.clickMenuCls.setLogCmd("color align custom | "+l+" | range "+n+"_"+r+" | "+o,!0)}})),t.myEventCls.onIds("#"+e.pre+"addtrack_button3","click",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");let l=$("#"+i.pre+"track_chainid").val(),n=$("#"+i.pre+"track_bed")[0].files[0];if(n){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");let e=new FileReader;e.onload=function(e){let n,r=e.target.result.split("\n"),o=!1,a=!1;for(let e=0,d=r.length;e<d;++e)if("browser"!=r[e].substr(0,7))if("track"==r[e].substr(0,5)){if(-1!=r[e].toLowerCase().indexOf("itemrgb")&&(o=!0),-1!=r[e].toLowerCase().indexOf("colorbystrand=")){a=!0;let t=r[e].toLowerCase().indexOf("colorbystrand="),s=r[e].substr(t),i=s.indexOf('"');if(-1!=i){let e=s.substr(i+1),t=e.indexOf('"');if(-1!=i){n=e.substr(0,t).split(" ")}}}}else{if(""==r[e])continue;let d=r[e].replace(/\s+/g," ").split(" ");(d.length>8||d.length<6)&&(a=!1),d.length<9&&(o=!1),d[0];let c,h,m=d[1],p=d[2],u=d[3];d.length,d.length>5&&(c=d[5]),d.length,d.length,d.length>8&&(h=d[8]),d.length,d.length,d.length;let C=u,g="51,51,51";o?g=h:a&&("+"==c&&n.length>0?g=n[0]:"-"==c&&n.length>1?g=n[1]:"."==c&&n.length>2&&(g=n[2]));let f="",b=[];for(let e=0,t=p;e<t;++e)e<m?(f+="-",b.push("")):(f+=i.giSeq[l][e],b.push("rgb("+g+")"));s.showNewTrack(l,C,f,b,void 0,void 0,g),t.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+l+" | title "+C+" | text "+s.simplifyText(f)+" | type bed | color "+g,!0)}},e.readAsText(n)}else alert("Please select a file...")})),t.myEventCls.onIds("#"+e.pre+"addtrack_button4","click",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");let l=$("#"+i.pre+"track_chainid").val(),n=$("#"+i.pre+"track_title").val(),r=$("#"+i.pre+"track_text").val(),o=this.getFullText(r);s.showNewTrack(l,n,o.text,void 0,void 0,"custom",void 0,void 0,o.fromArray,o.toArray),t.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+l+" | title "+n+" | text "+r+" | type custom",!0)})),t.myEventCls.onIds("#"+e.pre+"addtrack_button5","click",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");let l=$("#"+i.pre+"track_chainid").val(),n=$("#"+i.pre+"track_selection").val(),r="",o=t.hashUtilsCls.intHash(i.hAtoms,i.chains[l]),a=i.firstAtomObjCls.getResiduesFromCalphaAtoms(o),d=[];for(let e=0,t=i.giSeq[l].length;e<t;++e){let t=i.giSeq[l][e],s=t;t.length>1&&(s=t[0]);let n=e>=i.matchedPos[l]&&e-i.matchedPos[l]<i.chainsSeq[l].length?i.chainsSeq[l][e-i.matchedPos[l]].resi:i.baseResi[l]+1+e;if(a.hasOwnProperty(l+"_"+n)){let e=i.firstAtomObjCls.getFirstCalphaAtomObj(i.residues[l+"_"+n]),t=void 0===e.color||"FFFFFF"===e.color.getHexString().toUpperCase()?"DDDDDD":e.color.getHexString(),o=void 0!==e.color?t:"CCCCCC";r+=s,d.push("#"+o)}else r+="-",d.push("")}s.showNewTrack(l,n,r,d,void 0,"selection",void 0),t.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+l+" | title "+n+" | text "+s.simplifyText(r)+" | type selection",!0)}))}showNewTrack(e,t,s,i,l,n,r,o,a,d){let c=this.icn3d,h=c.icn3dui,m=!1;"cannot be aligned"==s&&(m=!0);let p=s.replace(/-/g,"").length;if(!o)if(s.length>c.giSeq[e].length)s=s.substr(0,c.giSeq[e].length);else if(s.length<c.giSeq[e].length&&!m){let t="";for(let i=0,l=c.giSeq[e].length-s.length;i<l;++i)t+="-";s+=t}let u=t.replace(/\s/g,"_").replace(/\./g,"dot").replace(/\W/g,"");u.length>20&&(u=u.substr(0,20));let C=h.htmlCls.RESIDUE_WIDTH*s.length+200;$("#"+c.pre+"dt_custom_"+e).append("<div id='"+c.pre+"dt_custom_"+e+"_"+u+"'></div>"),$("#"+c.pre+"dt_custom_"+e+"_"+u).width(C),$("#"+c.pre+"ov_custom_"+e).append("<div id='"+c.pre+"ov_custom_"+e+"_"+u+"'></div>"),$("#"+c.pre+"ov_custom_"+e+"_"+u).width(C),$("#"+c.pre+"tt_custom_"+e).append("<div id='"+c.pre+"tt_custom_"+e+"_"+u+"'></div>"),$("#"+c.pre+"tt_custom_"+e+"_"+u).width(C);let g='<div id="'+c.pre+'giseq_sequence" class="icn3d-dl_sequence">',f=g,b=g,y=parseInt(10*Math.random()),v='<div class="icn3d-seqTitle icn3d-link icn3d-blue" custom="'+(y+1).toString()+'" from="'+a+'" to="'+d+'" shorttitle="'+u+'" index="'+y+'" setname="'+e+"_custom_"+(y+1).toString()+'" anno="sequence" chain="'+e+'" title="'+t+'">'+u+" </div>",_='<span class="icn3d-residueNum" title="residue count">'+p.toString()+" Pos</span>";b+=v+_+"<br>";let S='<span class="icn3d-seqLine">';g+=v+_+S,f+=v+_+S;let w=e.indexOf("_"),A="cst"+e.substr(w+1),x=0,k=0,O=(void 0===n||"seq"===n||"custom"===n)&&-1==s.indexOf("cannot-be-aligned")&&-1==s.indexOf("cannot be aligned"),H="identity"===n&&-1==s.indexOf("cannot-be-aligned")&&-1==s.indexOf("cannot be aligned"),D={},R=0,I=1;v="";for(let t=0,a=s.length;t<a;++t){let a=t-R;o?c.targetGapHash.hasOwnProperty(a)&&!D.hasOwnProperty(a)&&(R+=c.targetGapHash[a].to-c.targetGapHash[a].from+1,D[a]=1):g+=c.showSeqCls.insertGap(e,t,"-");let d=s.charAt(t);if(" "!=d&&"-"!=d){let s,o=c.chainsSeq[e][a]?c.chainsSeq[e][a].name:" ",m=c.showAnnoCls.getColorhexFromBlosum62(d,o),p=d==o?"FF0000":"0000FF",u=c.baseResi[e]+I;if(void 0!==l&&(u=c.baseResi[e]+l[t]+1),void 0!==i&&""!=i[t])s='style="color:'+i[t]+'"';else if(r)s='style="color:rgb('+r+')"';else if(O||"seq"==n){if(s='style="color:#'+m+'"',"seq"==n)for(let t in c.residues[e+"_"+u]){let e=h.parasCls.thr("#"+m);c.atoms[t].color=e,c.atomPrevColors[t]=e}}else s=H?'style="color:#'+p+'"':"";g+='<span id="'+A+"_"+c.pre+e+"_"+u+'" title="'+d+u+'" class="icn3d-residue" '+s+">"+d+"</span>",v+=c.showSeqCls.insertGapOverview(e,t);let C=h.cfg.blast_rep_id==e?Math.round(c.seqAnnWidth*t/(c.maxAnnoLength+c.nTotalGap)-x-k):Math.round(c.seqAnnWidth*t/c.maxAnnoLength-x-k);C<0&&(C=0),v+='<div style="display:inline-block; width:'+C+'px;">&nbsp;</div>',s=void 0!==i&&""!=i[t]?i[t]:r?"rgb("+r+")":O?"#"+m:"#333",v+='<div style="display:inline-block; background-color:'+s+'; width:1px;" title="'+d+(t+1).toString()+'">&nbsp;</div>',x+=C,k+=1,++I}else g+=m?"<span>"+d+"</span>":"<span>-</span>"}if(void 0!==a){v="";let s=[],i=[];for(let e=0,t=a.length;e<t;++e){s.push(a[e]);for(let t=a[e];t<=d[e];++t)void 0!==c.targetGapHash&&c.targetGapHash.hasOwnProperty(t)&&(i.push(t-1),s.push(t));i.push(d[e])}c.nTotalGap=0;for(let e in c.targetGapHash)c.nTotalGap+=c.targetGapHash[e].to-c.targetGapHash[e].from+1;let l=c.firstAtomObjCls.getFirstCalphaAtomObj(c.chains[e]),n=void 0===l.color||"FFFFFF"===l.color.getHexString()?"DDDDDD":l.color.getHexString(),r=void 0!==l.color?n:"CCCCCC";for(let l=0,n=s.length;l<n;++l){v+=c.showSeqCls.insertGapOverview(e,s[l]),v+='<div style="display:inline-block; width:'+(0==l?Math.round(c.seqAnnWidth*(s[l]-c.baseResi[e]-1)/(c.maxAnnoLength+c.nTotalGap)):Math.round(c.seqAnnWidth*(s[l]-i[l-1]-1)/(c.maxAnnoLength+c.nTotalGap)))+'px;">&nbsp;</div>',v+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+r+"; width:"+Math.round(c.seqAnnWidth*(i[l]-s[l]+1)/(c.maxAnnoLength+c.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" custom="'+(y+1).toString()+'" from="'+s+'" to="'+i+'" shorttitle="'+u+'" index="'+y+'" setname="'+e+"_custom_"+(y+1).toString()+'" id="'+e+"_custom_"+y+'" anno="sequence" chain="'+e+'" title="'+t+'">'+t+"</div>"}}S='<span class="icn3d-residueNum" title="residue count">'+p.toString()+" Pos</span>",S+="</span>",S+="<br>",S+="</div>",g+=S,f+=v+S,b+="</div>",$("#"+c.pre+"dt_custom_"+e+"_"+u).html(g),$("#"+c.pre+"ov_custom_"+e+"_"+u).html(f),$("#"+c.pre+"tt_custom_"+e+"_"+u).html(b)}alignSequenceToStructure(e,t,s){let i,l,n=this.icn3d,r=n.icn3dui;void 0!==t.data&&(i=t.data[0].query,l=t.data[0].targets[e],l=l.hsps[0]);let o="",a=[],d={};if(void 0!==i&&void 0!==l){let c=l.scores.e_value.toPrecision(2);c>1e-200&&(c=parseFloat(c).toExponential()),l.scores.bit_score;let h=t.targets[e].seqdata,m=i.seqdata,p=l.segs;for(let e=0,t=p.length;e<t;++e){let t=p[e];for(let e=0;e<=t.orito-t.orifrom;++e)d[e+t.orifrom]=e+t.from}for(let t=0,s=h.length;t<s;++t)if(d.hasOwnProperty(t)){o+=m[d[t]];let s=n.showAnnoCls.getColorhexFromBlosum62(h[t],m[d[t]]);a.push("#"+s);let i=n.baseResi[e]+1+t;for(let t in n.residues[e+"_"+i]){let e=r.parasCls.thr("#"+s);n.atoms[t].color=e,n.atomPrevColors[t]=e}}else o+="-",a.push("");s+=", E: "+c}else o+="cannot be aligned";this.showNewTrack(e,s,o,a,d,"seq"),n.hlUpdateCls.updateHlAll(),n.drawCls.draw(),r.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+e+" | title "+s+" | text "+this.simplifyText(o)+" | type seq",!0)}defineSecondary(e,t){let s=this.icn3d,i=s.icn3dui;$("#"+s.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+s.pre+"dl_definedsets").dialog("isOpen")||(i.htmlCls.dialogCls.openDlg("dl_definedsets","Select sets"),$("#"+s.pre+"atomsCustom").resizable());let l,n,r={},o=!1,a=!0,d=0,c=0,h=e+"_C(Nterm";s.hAtoms={};for(let i=0,m=s.chainsSeq[e].length;i<m;++i){let m=e+"_"+s.chainsSeq[e][i].resi;if(s.residues.hasOwnProperty(m)){let i=s.firstAtomObjCls.getFirstCalphaAtomObj(s.residues[m]),p=s.secondaries[m];"H"==p?(i.ssbegin&&(++d,Object.keys(r).length>0&&(n=l+"H"+d+")","coil"==t&&(s.selectionCls.selectResidueList(r,n,n,o,a),o||(o=!0)),r={})),l=e+"_H"+d,r[m]=1,i.ssend&&(h=e+"_C(H"+d,"helix"==t&&(s.selectionCls.selectResidueList(r,l,l,o,a),o||(o=!0)),r={})):"E"==p?(i.ssbegin&&(++c,Object.keys(r).length>0&&(n=l+"S"+c+")","coil"==t&&(s.selectionCls.selectResidueList(r,n,n,o,a),o||(o=!0)),r={})),l=e+"_S"+c,r[m]=1,i.ssend&&(h=e+"_C(S"+c,"sheet"==t&&(s.selectionCls.selectResidueList(r,l,l,o,a),o||(o=!0)),r={})):(l=h+"-",r[m]=1)}}Object.keys(r).length>0&&(n=l+"Cterm)","coil"==t&&s.selectionCls.selectResidueList(r,n,n,o,a))}simplifyText(e){this.icn3d.icn3dui;let t,s,i="",l=!1,n=-1;for(t=0,s=e.length;t<s;++t)"-"==e[t]||" "==e[t]?(l&&t!==n&&(i+=n+1==t-1?(n+1+1).toString()+" "+e.substr(n+1,t-1-n)+", ":(n+1+1).toString()+"-"+(t-1+1).toString()+" "+e.substr(n+1,t-1-n)+", ",l=!1),n=t):l=!0;return l&&t==s&&(i+=n+1==t-1?(n+1+1).toString()+" "+e.substr(n+1,t-1-n)+", ":(n+1+1).toString()+"-"+(t-1+1).toString()+" "+e.substr(n+1,t-1-n)+", "),i}checkGiSeq(e,t,s,i,l,n,r){let o=this.icn3d;o.icn3dui;let a=this;if(r>20)return!1;if(void 0!==o.giSeq&&void 0!==o.giSeq[e]){let r=this.getFullText(s);return s=r.text,this.showNewTrack(e,t,s,void 0,void 0,i,l,n),!1}setTimeout((function(){a.checkGiSeq(e,t,s,i,l,n,r+1)}),100)}getFullText(e){this.icn3d.icn3dui;let t="",s=[],i=[],l=e.split(","),n=-1;for(let e=0,r=l.length;e<r;++e){let r=l[e].trim();if(0==r.length)continue;let o=r.split(" ");if(2!==o.length)continue;let a,d,c=o[1],h=o[0].split("-");if(2==h.length)a=h[0]-1,d=h[1]-1;else{if(1!=h.length)continue;a=h[0]-1,d=a}s.push(a),i.push(d);for(let e=0;e<a-n-1;++e)t+="-";let m=d-a+1;c.length>m?t+=c.substr(0,m):t+=c;for(let e=0;e<m-c.length;++e)t+="-";n=d}return{text:t,fromArray:s,toArray:i}}setCustomFile(e,t,s,i){var l=this.icn3d,n=l.icn3dui;let r=this,o=$("#"+l.pre+"customcolor_chainid").val(),a=$("#"+l.pre+"cstcolorfile")[0].files[0];if(a){n.utilsCls.checkFileAPI();let l=new FileReader;l.onload=function(l){let a=r.icn3d,d=l.target.result.split("\n");void 0===a.queryresi2score&&(a.queryresi2score={}),a.queryresi2score[o]={};for(let e=0,t=d.length;e<t;++e)if(""!==d[e].trim()){let t=d[e].split(/\s+/);a.queryresi2score[o][t[0]]=t[1]}let c=Object.keys(a.queryresi2score[o]),h=Math.min.apply(null,c),m=Math.max.apply(null,c),p="";for(let e=h;e<=m;++e)a.queryresi2score[o].hasOwnProperty(e)?p+=Math.round(a.queryresi2score[o][e]/11):p+="_";if("color"==e){a.opts.color="align custom",a.setColorCls.setColorByOptions(a.opts,a.hAtoms),a.hlUpdateCls.updateHlAll(),n.htmlCls.clickMenuCls.setLogCmd("color align custom | "+o+" | range "+h+"_"+m+" | "+p+" | colorrange "+t+" "+s+" "+i,!0);let e=n.htmlCls.clickMenuCls.setLegendHtml();$("#"+n.pre+"dl_legend").html(e),n.htmlCls.dialogCls.openDlg("dl_legend","Color range")}else"tube"==e&&(a.setOptionCls.setStyle("proteins","custom tube"),n.htmlCls.clickMenuCls.setLogCmd("color tube | "+o+" | range "+h+"_"+m+" | "+p,!0));a.drawCls.draw()},l.readAsText(a)}else alert("Please select a file before clicking 'Load'")}}class Ce{constructor(e){this.icn3d=e}calculateArea(){var e=this.icn3d,t=e.icn3dui;e.bCalcArea=!0,e.opts.surface="solvent accessible surface",e.applyMapCls.applySurfaceOptions(),$("#"+e.pre+"areavalue").val(e.areavalue),$("#"+e.pre+"areatable").html(e.areahtml),t.htmlCls.dialogCls.openDlg("dl_area","Surface area calculation"),e.bCalcArea=!1}calcBuriedSurface(e,t){var s=this.icn3d,i=s.icn3dui;if(0==e.length)alert("Please select the first set");else{let l=i.hashUtilsCls.cloneHash(s.hAtoms),n=s.definedSetsCls.getAtomsFromNameArray(e),r=s.definedSetsCls.getAtomsFromNameArray(t);s.bCalcArea=!0,s.opts.surface="solvent accessible surface",s.hAtoms=i.hashUtilsCls.cloneHash(n),s.applyMapCls.applySurfaceOptions();let o=s.areavalue,a=i.hashUtilsCls.cloneHash(s.resid2area);s.hAtoms=i.hashUtilsCls.cloneHash(r),s.applyMapCls.applySurfaceOptions();let d=s.areavalue,c=i.hashUtilsCls.cloneHash(s.resid2area);s.hAtoms=i.hashUtilsCls.unionHash(s.hAtoms,n),s.applyMapCls.applySurfaceOptions();let h=s.areavalue,m=i.hashUtilsCls.cloneHash(s.resid2area),p=0,u=0,C=0,g=0;for(let e in a)m.hasOwnProperty(e)&&(g+=parseFloat(m[e]));u=(o-g).toFixed(2);for(let e in c)m.hasOwnProperty(e)&&(C+=parseFloat(m[e]));p=(d-C).toFixed(2),s.bCalcArea=!1,s.hAtoms=i.hashUtilsCls.cloneHash(l);let f=(parseFloat(d)+parseFloat(o)-parseFloat(h)).toFixed(2),b="<br>Calculate solvent accessible surface area in the interface:<br><br>";b+="Set 1: "+e+", Surface: "+o+" &#8491;<sup>2</sup><br>",b+="Set 2: "+t+", Surface: "+d+" &#8491;<sup>2</sup><br>",b+="Total Surface: "+h+" &#8491;<sup>2</sup><br>",b+="<b>Buried Surface for Set 1</b>: "+u+" &#8491;<sup>2</sup><br>",b+="<b>Buried Surface for Set 2</b>: "+p+" &#8491;<sup>2</sup><br><br>",$("#"+s.pre+"dl_buriedarea").html(b),i.htmlCls.dialogCls.openDlg("dl_buriedarea","Buried solvent accessible surface area in the interface"),i.htmlCls.clickMenuCls.setLogCmd("buried surface "+f,!1)}}measureDistTwoSets(e,t){var s=this.icn3d,i=s.icn3dui;if(0==e.length||0==t.length)alert("Please select two sets");else{let l=i.hashUtilsCls.cloneHash(s.hAtoms),n=s.definedSetsCls.getAtomsFromNameArray(e),r=s.definedSetsCls.getAtomsFromNameArray(t),o=s.contactCls.getExtent(n),a=s.contactCls.getExtent(r),d=new THREE.Vector3(o[2][0],o[2][1],o[2][2]),c=new THREE.Vector3(a[2][0],a[2][1],a[2][2]);s.hAtoms=i.hashUtilsCls.cloneHash(l),void 0===s.distPnts&&(s.distPnts=[]),s.distPnts.push(d),s.distPnts.push(c);let h=$("#"+s.pre+"distancecolor2").val();this.addLine(d.x,d.y,d.z,c.x,c.y,c.z,h,!0,"distance");let m=0,p=0,u=d.clone().add(c).multiplyScalar(.5),C=(parseInt(10*d.distanceTo(c))/10).toString()+" A";this.addLabel(C,u.x,u.y,u.z,m,h,p,"distance"),s.drawCls.draw()}}measureDistManySets(e,t){var s=this.icn3d,i=s.icn3dui;if(0==e.length||0==t.length)alert("Please select sets for distance calculation...");else{let l=i.hashUtilsCls.cloneHash(s.hAtoms),n={};for(let i=0,l=e.length;i<l;++i){let l=e[i],r=[l];n[l]={};for(let e=0,i=t.length;e<i;++e){let i=t[e],o=[i];if(l==i)continue;let a=s.definedSetsCls.getAtomsFromNameArray(r),d=s.definedSetsCls.getAtomsFromNameArray(o),c=s.contactCls.getExtent(a),h=s.contactCls.getExtent(d),m=new THREE.Vector3(c[2][0],c[2][1],c[2][2]),p=new THREE.Vector3(h[2][0],h[2][1],h[2][2]),u=m.distanceTo(p);n[l][i]=u.toFixed(2)}}s.hAtoms=i.hashUtilsCls.cloneHash(l);let r="Note: Click on the distance to show a dashed line in 3D view.<br><br>";r+="<table align=center border=1 cellpadding=10 cellspacing=0><tr><th></th>";for(let e=0,s=t.length;e<s;++e){r+="<th><b>"+t[e]+"</b> (&#8491;)</th>"}r+="</tr>";for(let s=0,i=e.length;s<i;++s){let i=e[s];r+="<tr><th><b>"+i+"</b> (&#8491;)</th>";for(let e=0,s=t.length;e<s;++e){let s=t[e];n[i]&&n[i][s]?r+='<td><span class="icn3d-distance" sets="'+i+"|"+s+'">'+n[i][s]+"</span></td>":r+="<td>0</td>"}r+="</tr>"}r+="</table><br><br>",$("#"+i.pre+"dl_disttable").html(r)}}addLine(e,t,s,i,l,n,r,o,a){var d=this.icn3d;d.icn3dui;let c={};c.position1=new THREE.Vector3(e,t,s),c.position2=new THREE.Vector3(i,l,n),c.color=r,c.dashed=o,void 0===d.lines[a]&&(d.lines[a]=[]),void 0!==a?d.lines[a].push(c):(void 0===d.lines.custom&&(d.lines.custom=[]),d.lines.custom.push(c)),d.hlObjectsCls.removeHlObjects()}addLineFromPicking(e){var t=this.icn3d,s=t.icn3dui;let i=$("#"+t.pre+e+"color").val();t.pAtom.coord.x,t.pAtom2.coord.x,t.pAtom.coord.y,t.pAtom2.coord.y,t.pAtom.coord.z,t.pAtom2.coord.z;let l="stabilizer"!=e;s.htmlCls.clickMenuCls.setLogCmd("add line | x1 "+t.pAtom.coord.x.toPrecision(4)+" y1 "+t.pAtom.coord.y.toPrecision(4)+" z1 "+t.pAtom.coord.z.toPrecision(4)+" | x2 "+t.pAtom2.coord.x.toPrecision(4)+" y2 "+t.pAtom2.coord.y.toPrecision(4)+" z2 "+t.pAtom2.coord.z.toPrecision(4)+" | color "+i+" | dashed "+l+" | type "+e,!0),this.addLine(t.pAtom.coord.x,t.pAtom.coord.y,t.pAtom.coord.z,t.pAtom2.coord.x,t.pAtom2.coord.y,t.pAtom2.coord.z,i,l,e),t.pickpair=!1}addLabel(e,t,s,i,l,n,r,o){var a=this.icn3d;a.icn3dui;let d={};"0"!==l&&""!==l&&"undefined"!==l||(l=void 0),"0"!==n&&""!==n&&"undefined"!==n||(n=void 0),"0"!==r&&""!==r&&"undefined"!==r||(r=void 0);let c=new THREE.Vector3;c.x=t,c.y=s,c.z=i,d.position=c,d.text=e,d.size=l,d.color=n,d.background=r,void 0===a.labels[o]&&(a.labels[o]=[]),void 0!==o?a.labels[o].push(d):(void 0===a.labels.custom&&(a.labels.custom=[]),a.labels.custom.push(d)),a.hlObjectsCls.removeHlObjects()}addChainLabels(e){var t=this.icn3d;let s=t.icn3dui.hashUtilsCls.intHash(t.hAtoms,e);void 0===t.labels.chain&&(t.labels.chain=[]);let i=t.firstAtomObjCls.getChainsFromAtoms(s);for(let e in i){let s={};s.position=t.applyCenterCls.centerAtoms(t.chains[e]).center;let i=e.indexOf("_"),l=e.substr(i+1),n=t.showSeqCls.getProteinName(e);n.length>20&&(n=n.substr(0,20)+"..."),s.text="Chain "+l+": "+n,s.size=18,t.firstAtomObjCls.getFirstCalphaAtomObj(t.chains[e]).color.getHexString().toUpperCase(),s.color="black"!=t.opts.background?t.colorWhitebkgd:t.colorBlackbkgd,s.background="#FFFFFF",t.labels.chain.push(s)}t.hlObjectsCls.removeHlObjects()}addTerminiLabels(e){var t=this.icn3d,s=t.icn3dui;let i,l="#FFFFFF";i=s.hashUtilsCls.unionHash(i,t.proteins),i=s.hashUtilsCls.unionHash(i,t.nucleotides);let n=s.hashUtilsCls.intHash(t.dAtoms,i),r=s.hashUtilsCls.intHash(n,e);void 0===t.labels.chain&&(t.labels.chain=[]);let o=t.firstAtomObjCls.getChainsFromAtoms(r);for(let e in o){let i=s.hashUtilsCls.intHash(n,t.chains[e]),r=Object.keys(i),o=t.atoms[r[0]],a=t.atoms[r[r.length-1]],d={},c={};d.position=o.coord,c.position=a.coord,d.text="N-",c.text="C-",t.nucleotides.hasOwnProperty(o.serial)&&(d.text="5'",c.text="3'"),d.size=18,c.size=18,o.color.getHexString().toUpperCase(),a.color.getHexString().toUpperCase(),d.color="black"!=t.opts.background?t.colorWhitebkgd:t.colorBlackbkgd,c.color="black"!=t.opts.background?t.colorWhitebkgd:t.colorBlackbkgd,d.background=l,c.background=l,t.labels.chain.push(d),t.labels.chain.push(c)}t.hlObjectsCls.removeHlObjects()}}class ge{constructor(e){this.icn3d=e}showCddSiteAll(){let e=this.icn3d,t=e.icn3dui,s=this;e.chainid2pssmid={};let i=$.map(e.protein_chainid,(function(e){return e})),l=Object.keys(e.protein_chainid),n=t.htmlCls.baseUrl+"cdannots/cdannots.fcgi?fmt&queries="+i;if(1==Object.keys(e.structures).length&&(t.cfg.mmtfid||t.cfg.pdbid||t.cfg.opmid||t.cfg.mmdbid||t.cfg.gi||t.cfg.uniprotid||t.cfg.blast_rep_id||t.cfg.cid||t.cfg.mmcifid)||2==Object.keys(e.structures).length&&t.cfg.align)$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(t){s.parseCddData([t],l),void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()},error:function(t,l,n){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):(s.getNoCdd(i),void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve())}});else{let r=[];for(let s=0,i=l.length;s<i;++s){let i=Array.isArray(e.giSeq[l[s]])?e.giSeq[l[s]].join("").toUpperCase():e.giSeq[l[s]].toUpperCase();i=i.replace(/O/g,""),n=t.htmlCls.baseUrl+"cdannots/cdannots.fcgi?fmt&live=lcl&queries="+i;let o=$.ajax({url:n,dataType:"jsonp",cache:!0});r.push(o)}$.when.apply(void 0,r).then((function(){let t=1==l.length?[arguments]:Array.from(arguments);s.parseCddData(t,l,!0),void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()})).fail((function(){s.getNoCdd(i),void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()}))}}parseCddData(e,t,s){let i=this.icn3d,l=i.icn3dui,n=this,r={};for(let o=0,a=e.length;o<a;++o){let a=s?e[o][0]:e[o];for(let e=0,d=a.data.length;e<d;++e){let d=a.data[e];d._id;let c=s?t[o]:t[e];r[c]=1;let h='<div id="'+i.pre+c+'_cddseq_sequence" class="icn3d-cdd icn3d-dl_sequence">',m=h,p=h,u=d.doms,C=n.setDomainFeature(u,c,!0,h,m,p);i.chainid2pssmid[c]={pssmid2name:C.pssmid2name,pssmid2fromArray:C.pssmid2fromArray,pssmid2toArray:C.pssmid2toArray};let g=C.acc2domain;h=C.html+"</div>",m=C.html2+"</div>",p=C.html3+"</div>",$("#"+i.pre+"dt_cdd_"+c).html(h),$("#"+i.pre+"ov_cdd_"+c).html(m),$("#"+i.pre+"tt_cdd_"+c).html(p),h='<div id="'+i.pre+c+'_siteseq_sequence" class="icn3d-dl_sequence">',m=h,p=h;let f=d.motifs;C=n.setDomainFeature(f,c,!1,h,m,p,g),h=C.html,m=C.html2,p=C.html3;let b=a.data[e].sites,y=void 0!==b?b.length:0;for(let e=0;e<y;++e){b[e].srcdom,b[e].type;let t=b[e].sz,s="site: "+b[e].title;s.length>17&&(s=s.substr(0,17)+"...");let r,o=b[e].title,a=[];for(let t=0,s=b[e].locs.length;t<s;++t){r=b[e].locs[t].coords;for(let e=0,t=r.length;e<t;++e)i.bNCBI?a.push(Math.round(r[e])):a.push(n.getAdjustedResi(Math.round(r[e]),c,i.matchedPos,i.chainsSeq,i.baseResi)-1)}let d='<div class="icn3d-seqTitle icn3d-link icn3d-blue" site="site" posarray="'+a.toString()+'" shorttitle="'+s+'" setname="'+c+"_site_"+e+'" anno="sequence" chain="'+c+'" title="'+o+'">'+s+" </div>",u='<span class="icn3d-residueNum" title="residue count">'+t.toString()+" Res</span>",C='<span class="icn3d-seqLine">';p+=d+u+"<br>",h+=d+u+C,m+=d+u+C;let g="site"+e.toString(),f=0,y=0,v=1;for(let e=0,t=i.giSeq[c].length;e<t;++e)if(h+=i.showSeqCls.insertGap(c,e,"-"),-1!=r.indexOf(e)){let t=i.giSeq[c][e],s=t;t.length>1&&(s=t[0]+"..");let r=n.getAdjustedResi(e,c,i.matchedPos,i.chainsSeq,i.baseResi);h+='<span id="'+g+"_"+i.pre+c+"_"+r+'" title="'+s+r+'" class="icn3d-residue">'+t+"</span>",m+=i.showSeqCls.insertGapOverview(c,e);let o=l.cfg.blast_rep_id==c?Math.round(i.seqAnnWidth*e/(i.maxAnnoLength+i.nTotalGap)-f-y):Math.round(i.seqAnnWidth*e/i.maxAnnoLength-f-y);o>=0&&(m+='<div style="display:inline-block; width:'+o+'px;">&nbsp;</div>',m+='<div style="display:inline-block; background-color:#000; width:'+v+'px;" title="'+s+r+'">&nbsp;</div>',f+=o,y+=v)}else h+="<span>-</span>";C='<span class="icn3d-residueNum" title="residue count">&nbsp;'+t.toString()+" Residues</span>",C+="</span>",C+="<br>",h+=C,m+=C}h+="</div>",m+="</div>",p+="</div>",$("#"+i.pre+"dt_site_"+c).html(h),$("#"+i.pre+"ov_site_"+c).html(m),$("#"+i.pre+"tt_site_"+c).html(p)}}for(let e in i.protein_chainid)r.hasOwnProperty(e)||($("#"+i.pre+"dt_cdd_"+e).html(""),$("#"+i.pre+"ov_cdd_"+e).html(""),$("#"+i.pre+"tt_cdd_"+e).html(""),$("#"+i.pre+"dt_site_"+e).html(""),$("#"+i.pre+"ov_site_"+e).html(""),$("#"+i.pre+"tt_site_"+e).html(""));i.showAnnoCls.enableHlSeq(),i.bAjaxCddSite=!0}getNoCdd(e){let t=this.icn3d;t.icn3dui,console.log("No CDD data were found for the protein "+e+"...");for(let e in t.protein_chainid)$("#"+t.pre+"dt_cdd_"+e).html(""),$("#"+t.pre+"ov_cdd_"+e).html(""),$("#"+t.pre+"tt_cdd_"+e).html(""),$("#"+t.pre+"dt_site_"+e).html(""),$("#"+t.pre+"ov_site_"+e).html(""),$("#"+t.pre+"tt_site_"+e).html("");t.showAnnoCls.enableHlSeq(),t.bAjaxCddSite=!0}setDomainFeature(e,t,s,i,l,n,r){let o,a,d,c=this.icn3d,h=c.icn3dui,m=this;s&&(r={},o={},a={},d={});let p=void 0!==e?e.length:0,u=s?14:19,C=s?100:120;for(let g=0;g<p;++g){let p=s?e[g].pssmid:0,f=s?e[g].acc:e[g].srcdom,b=e[g].type;b=s?"domain":"feat";let y=s?e[g].title.split(":")[0]:e[g].title;y=y.replace(/\"/g,"``"),y=y.replace(/'/g,"`"),s&&(r[f]=y);let v=s?e[g].defline:"",_=b+": "+y;_.length>u&&(_=_.substr(0,u)+"...");let S=b+": "+y;s&&(o[p]=y);let w=e[g].locs;if(w)for(let e=0,r=w.length;e<r;++e){let r=[],o=[],u={},A=0,x=s?w[e].segs:[w[e]];for(let e=0,s=x.length;e<s;++e){let s=Math.round(x[e].from),i=Math.round(x[e].to);c.bNCBI?(r.push(s),o.push(i)):(r.push(m.getAdjustedResi(s,t,c.matchedPos,c.chainsSeq,c.baseResi)-1),o.push(m.getAdjustedResi(i,t,c.matchedPos,c.chainsSeq,c.baseResi)-1));for(let e=s;e<=i;++e)u[e]=1;A+=i-s+1}let k=t+"_"+y;s||(k+="_"+g+"_"+e),s&&(a[p]=r),s&&(d[p]=o);let O='<div class="icn3d-seqTitle icn3d-link icn3d-blue" '+b+'="'+f+'" from="'+r+'" to="'+o+'" shorttitle="'+_+'" setname="'+k+'" anno="sequence" chain="'+t+'" title="'+S+'">'+_+" </div>",H='<span class="icn3d-residueNum" title="residue count">'+A.toString()+" Res</span>";n+=O+H+"<br>";let D='<span class="icn3d-seqLine">';i+=O+H+D,s&&(l+='<div style="width:20px; display:inline-block;"><span id="'+c.pre+t+"_"+f+"_"+e+'_cddseq_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+c.pre+t+"_"+f+"_"+e+'_cddseq_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div>'),l+='<div style="width:'+C+'px!important;" class="icn3d-seqTitle icn3d-link icn3d-blue" '+b+'="'+f+'" from="'+r+'" to="'+o+'" shorttitle="'+_+'" index="'+g+'" setname="'+k+'" anno="sequence" chain="'+t+'" title="'+S+'">'+_+" </div>",l+=H+D;let R=b+g.toString();for(let e=0,s=c.giSeq[t].length;e<s;++e)if(i+=c.showSeqCls.insertGap(t,e,"-"),u.hasOwnProperty(e)){let s=c.giSeq[t][e],l=s;s.length>1&&(l=s[0]+"..");let n=m.getAdjustedResi(e,t,c.matchedPos,c.chainsSeq,c.baseResi);i+='<span id="'+R+"_"+c.pre+t+"_"+n+'" title="'+l+n+'" class="icn3d-residue">'+s+"</span>"}else i+="<span>-</span>";let I=c.firstAtomObjCls.getFirstCalphaAtomObj(c.chains[t]),E=void 0===I.color||"FFFFFF"===I.color.getHexString()?"DDDDDD":I.color.getHexString(),T=void 0!==I.color?E:"CCCCCC";if(h.cfg.blast_rep_id!=t)for(let s=0,i=r.length;s<i;++s){l+='<div style="display:inline-block; width:'+(0==s?Math.round(c.seqAnnWidth*(r[s]-c.baseResi[t]-1)/c.maxAnnoLength):Math.round(c.seqAnnWidth*(r[s]-o[s-1]-1)/c.maxAnnoLength))+'px;">&nbsp;</div>',l+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+T+"; width:"+Math.round(c.seqAnnWidth*(o[s]-r[s]+1)/c.maxAnnoLength)+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+(g+1).toString()+'" from="'+r+'" to="'+o+'" shorttitle="'+_+'" index="'+g+'" setname="'+k+'" id="'+t+"_domain_"+g+"_"+e+'" anno="sequence" chain="'+t+'" title="'+S+'">'+y+" </div>"}else{let s=[],i=[];for(let e=0,t=r.length;e<t;++e){s.push(r[e]);for(let t=r[e];t<=o[e];++t)void 0!==c.targetGapHash&&c.targetGapHash.hasOwnProperty(t)&&(i.push(t-1),s.push(t));i.push(o[e])}for(let n=0,r=s.length;n<r;++n){l+=c.showSeqCls.insertGapOverview(t,s[n]),l+='<div style="display:inline-block; width:'+(0==n?Math.round(c.seqAnnWidth*(s[n]-c.baseResi[t]-1)/(c.maxAnnoLength+c.nTotalGap)):Math.round(c.seqAnnWidth*(s[n]-i[n-1]-1)/(c.maxAnnoLength+c.nTotalGap)))+'px;">&nbsp;</div>',l+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+T+"; width:"+Math.round(c.seqAnnWidth*(i[n]-s[n]+1)/(c.maxAnnoLength+c.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+(g+1).toString()+'" from="'+s+'" to="'+i+'" shorttitle="'+_+'" index="'+g+'" setname="'+k+'" id="'+t+"_domain_"+g+"_"+e+'" anno="sequence" chain="'+t+'" title="'+S+'">'+y+" </div>"}}D='<span class="icn3d-residueNum" title="residue count">&nbsp;'+A.toString()+" Residues</span>",D+="</span>",D+="<br>",i+=D,l+=D,s&&(l+='<div id="'+c.pre+t+"_"+f+"_"+e+'_cddseq" style="display:none; white-space:normal;" class="icn3d-box">'+v+'(<a href="'+h.htmlCls.baseUrl+"cdd/cddsrv.cgi?uid="+f+'" target="_blank" class="icn3d-blue">open details view...</a>)</div>')}}return{html:i,html2:l,html3:n,acc2domain:r,pssmid2name:o,pssmid2fromArray:a,pssmid2toArray:d}}getAdjustedResi(e,t,s,i,l){let n=this.icn3d;return n.icn3dui,e>=s[t]&&e-s[t]<n.chainsSeq[t].length?n.chainsSeq[t][e-s[t]].resi:l[t]+1+e}showAnnoType(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui,a='<div id="'+r.pre+e+"_"+s+'seq_sequence" class="icn3d-dl_sequence">',d=a,c=a;if(0==l.length)return $("#"+r.pre+"dt_"+s+"_"+e).html(""),$("#"+r.pre+"ov_"+s+"_"+e).html(""),void $("#"+r.pre+"tt_"+s+"_"+e).html("");let h=i;i.length>17&&(i=i.substr(0,17)+"...");let m=[];for(let e=0,t=l.length;e<t;++e){let t=l[e],s=Math.round(t.substr(l[e].lastIndexOf("_")+1));m.push(s)}let p=m.length,u=s,C='<div class="icn3d-seqTitle icn3d-link icn3d-blue" '+s+'="" posarray="'+m.toString()+'" shorttitle="'+i+'" setname="'+e+"_"+u+'" anno="sequence" chain="'+e+'" title="'+h+'">'+i+" </div>",g='<span class="icn3d-residueNum" title="residue count">'+p.toString()+" Res</span>";c+=C+g+"<br>";let f='<span class="icn3d-seqLine">';a+=C+g+f,d+=C+g+f;let b=s,y=0,v=0;for(let t=0,i=r.giSeq[e].length;t<i;++t)if(a+=r.showSeqCls.insertGap(e,t,"-"),-1!=m.indexOf(t+1+r.baseResi[e])){let i=r.giSeq[e][t],l=i;i.length>1&&(l=i[0]+"..");let c=t>=r.matchedPos[e]&&t-r.matchedPos[e]<r.chainsSeq[e].length?r.chainsSeq[e][t-r.matchedPos[e]].resi:r.baseResi[e]+1+t,h=e+"_"+(t+1+r.baseResi[e]).toString(),m=i+(t+1+r.baseResi[e]).toString();if("ssbond"==s){if(m="Residue "+h+" has disulfide bond with",void 0!==n[h])for(let e=0,t=n[h].length;e<t;++e)m+=" residue "+n[h][e]}else if("crosslink"==s&&(m="Residue "+h+" has cross-linkage with",void 0!==n[h]))for(let e=0,t=n[h].length;e<t;++e)m+=" residue "+n[h][e];a+='<span id="'+b+"_"+r.pre+e+"_"+c+'" title="'+m+'" class="icn3d-residue">'+l+"</span>",d+=r.showSeqCls.insertGapOverview(e,t);let p=o.cfg.blast_rep_id==e?Math.round(r.seqAnnWidth*t/(r.maxAnnoLength+r.nTotalGap)-y-v):Math.round(r.seqAnnWidth*t/r.maxAnnoLength-y-v);p>=0&&(d+='<div style="display:inline-block; width:'+p+'px;">&nbsp;</div>',d+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+m+'">&nbsp;</div>',y+=p,v+=1)}else a+="<span>-</span>";f='<span class="icn3d-residueNum" title="residue count">&nbsp;'+p.toString()+" Residues</span>",f+="</span>",f+="<br>",a+=f,d+=f,a+="</div>",d+="</div>",c+="</div>",$("#"+r.pre+"dt_"+s+"_"+e).html(a),$("#"+r.pre+"ov_"+s+"_"+e).html(d),$("#"+r.pre+"tt_"+s+"_"+e).html(c)}setToolTip(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"snp]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"ssbond]").add("[id^="+e.pre+"crosslink]").tooltip({content:function(){return $(this).prop("title")},show:null,close:function(e,t){t.tooltip.hover((function(){$(this).stop(!0).fadeTo(400,1)}),(function(){$(this).fadeOut("400",(function(){$(this).remove()}))}))}})}}class fe{constructor(e){this.icn3d=e}showSsbond(e,t){let s=this.icn3d;s.icn3dui;let i=this;void 0===s.ssbondpnts?setTimeout((function(){i.showSsbond_base(e,t)}),1e3):this.showSsbond_base(e,t)}showSsbond_base(e,t){let s=this.icn3d;s.icn3dui;let i=t,l={},n=i.substr(0,i.indexOf("_")),r=s.ssbondpnts[n];if(void 0===r)return $("#"+s.pre+"dt_ssbond_"+e).html(""),$("#"+s.pre+"ov_ssbond_"+e).html(""),void $("#"+s.pre+"tt_ssbond_"+e).html("");for(let e=0,t=r.length;e<t;e+=2){let t=r[e],s=r[e+1],n=t.substr(0,t.lastIndexOf("_")),o=s.substr(0,s.lastIndexOf("_"));i===n&&(void 0===l[t]&&(l[t]=[]),l[t].push(s)),i===o&&(void 0===l[s]&&(l[s]=[]),l[s].push(t))}let o=Object.keys(l);s.annoCddSiteCls.showAnnoType(e,t,"ssbond","Disulfide Bonds",o,l)}}class be{constructor(e){this.icn3d=e}showPicking(e,t,s){let i=this.icn3d,l=i.icn3dui;if(void 0!==l.cfg.cid&&0!=i.pk&&(i.pk=1),i.highlightlevel=i.pk,this.showPickingBase(e,t,s),0!=i.pk)if(void 0!==t&&void 0!==s){null!=l.cfg.showmenu&&1==l.cfg.showmenu&&(s+=l.htmlCls.MENU_HEIGHT);let n=1==i.pk?e.resn+e.resi+"@"+e.name:e.resn+e.resi;void 0!==i.structures&&Object.keys(i.structures).length>1?(n=e.structure+"_"+e.chain+" "+n,$("#"+i.pre+"popup").css("width","160px")):$("#"+i.pre+"popup").css("width","80px"),$("#"+i.pre+"popup").html(n),$("#"+i.pre+"popup").css("top",s).css("left",t+20).show()}else{i.hlUpdateCls.updateHlAll();let t={};t.factor=i._zoomFactor,t.mouseChange=i.mouseChange,t.quaternion={},t.quaternion._x=parseFloat(i.quaternion._x).toPrecision(5),t.quaternion._y=parseFloat(i.quaternion._y).toPrecision(5),t.quaternion._z=parseFloat(i.quaternion._z).toPrecision(5),t.quaternion._w=parseFloat(i.quaternion._w).toPrecision(5),l.htmlCls.clickMenuCls.setLogCmd("pickatom "+e.serial,!0),i.bSphereCalc=!1,i.bHbondCalc=!1}}showPickingBase(e,t,s){this.icn3d.icn3dui,void 0===t&&void 0===s&&this.showPickingHilight(e)}showPickingHilight(e){let t=this.icn3d,s=t.icn3dui;if(t.bShift||t.bCtrl||t.hlObjectsCls.removeHlObjects(),t.pickedAtomList={},1===t.pk)t.pickedAtomList[e.serial]=1;else if(2===t.pk){let s=e.structure+"_"+e.chain+"_"+e.resi;t.pickedAtomList=t.residues[s]}else if(3===t.pk)t.pickedAtomList=this.selectStrandHelixFromAtom(e);else if(4===t.pk)t.pickedAtomList=this.select3ddomainFromAtom(e);else if(5===t.pk){let s=e.structure+"_"+e.chain;t.pickedAtomList=t.chains[s]}0===t.pk?t.bShowHighlight=!1:t.bShowHighlight=!0;let i=Object.keys(t.hAtoms).length==Object.keys(t.atoms).length?{}:s.hashUtilsCls.intHash(t.hAtoms,t.pickedAtomList),l=Object.keys(i).length;if(t.bShift||t.bCtrl)if(t.bShift){if(void 0===t.prevPickedAtomList)t.hAtoms=s.hashUtilsCls.unionHash(t.hAtoms,t.pickedAtomList);else{let e=t.firstAtomObjCls.getFirstAtomObj(t.prevPickedAtomList),i=t.firstAtomObjCls.getFirstAtomObj(t.pickedAtomList);if(e.structure+"_"+e.chain!=i.structure+"_"+i.chain)t.hAtoms=s.hashUtilsCls.unionHash(t.hAtoms,t.pickedAtomList);else{let e;e=s.hashUtilsCls.unionHash(e,t.prevPickedAtomList),e=s.hashUtilsCls.unionHash(e,t.pickedAtomList);let i=t.firstAtomObjCls.getFirstAtomObj(e),l=t.firstAtomObjCls.getLastAtomObj(e);for(let e=i.serial;e<=l.serial;++e)t.hAtoms[e]=1}}t.prevPickedAtomList=s.hashUtilsCls.cloneHash(t.pickedAtomList)}else t.bCtrl&&(t.hAtoms=l>0?s.hashUtilsCls.exclHash(t.hAtoms,t.pickedAtomList):s.hashUtilsCls.unionHash(t.hAtoms,t.pickedAtomList));else t.hAtoms=s.hashUtilsCls.cloneHash(t.pickedAtomList);t.hlObjectsCls.removeHlObjects(),t.hlObjectsCls.addHlObjects()}select3ddomainFromAtom(e){let t,s=this.icn3d,i=s.icn3dui,l=e.structure+"_"+e.chain,n=l+"_"+e.resi;for(let e in s.tddomains){let i=e.indexOf("_3d_domain");if(e.substr(0,i)==l&&-1!==Object.keys(s.tddomains[e]).indexOf(n)){t=e;break}}let r={};for(let e in s.tddomains[t])r=i.hashUtilsCls.unionHash(r,s.residues[e]);return r}selectStrandHelixFromAtom(e){let t=this.icn3d,s=t.icn3dui,i=e,l=e,n={},r=i.resi;if(!i.ssbegin&&!isNaN(i.resi)){for(let e=i.resi-1;e>0;--e){let s=i.structure+"_"+i.chain+"_"+e;if(!t.residues.hasOwnProperty(s))break;let l=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[s]);if(r=l.resi,"coil"!==i.ss&&l.ss===i.ss&&l.ssbegin||"coil"===i.ss&&l.ss!==i.ss){"coil"===i.ss&&l.ss!==i.ss&&(r=parseInt(l.resi)+1);break}}for(let e=r;e<=i.resi;++e){let l=i.structure+"_"+i.chain+"_"+e;n=s.hashUtilsCls.unionHash(n,s.hashUtilsCls.hash2Atoms(t.residues[l],t.atoms))}}let o=l.resi,a=t.firstAtomObjCls.getLastAtomObj(t.chains[l.structure+"_"+l.chain]).resi;for(let e=parseInt(l.resi)+1;e<=parseInt(a);++e){let s=l.structure+"_"+l.chain+"_"+e;if(!t.residues.hasOwnProperty(s))break;let i=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[s]);if(o=i.resi,"coil"!==l.ss&&i.ss===l.ss&&i.ssend||"coil"===l.ss&&i.ss!==l.ss){"coil"!==l.ss||i.ss===l.ss||isNaN(i.resi)||(o=i.resi-1);break}}for(let e=parseInt(l.resi)+1;e<=parseInt(o);++e){let i=l.structure+"_"+l.chain+"_"+e;n=s.hashUtilsCls.unionHash(n,s.hashUtilsCls.hash2Atoms(t.residues[i],t.atoms))}return n}}class ye{constructor(e){this.icn3d=e}applyCommand(e){let t=this.icn3d,s=t.icn3dui;t.bAddCommands=!1;let i=e.split("|||")[0].split("%7C%7C%7C")[0].replace(/\s+/g," ").trim(),l=i.toLowerCase();if("share link"==l)t.shareLinkCls.shareLink();else if("export state file"==l);else if(0==l.indexOf("export canvas"))setTimeout((function(){let e=l.substr(13).trim();t.scaleFactor=""===e?1:parseInt(e);let s=""!==e;t.shareLinkCls.shareLink(!0,s)}),500);else if("export interactions"==l)t.viewInterPairsCls.exportInteractions();else if("export stl file"==l)setTimeout((function(){t.export3DCls.exportStlFile("")}),500);else if("export vrml file"==l)setTimeout((function(){t.export3DCls.exportVrmlFile("")}),500);else if("export stl stabilizer file"==l)setTimeout((function(){t.threeDPrintCls.hideStabilizer(),t.threeDPrintCls.resetAfter3Dprint(),t.threeDPrintCls.addStabilizer(),t.export3DCls.exportStlFile("_stab")}),500);else if("export vrml stabilizer file"==l)setTimeout((function(){t.threeDPrintCls.hideStabilizer(),t.threeDPrintCls.resetAfter3Dprint(),t.threeDPrintCls.addStabilizer(),t.export3DCls.exportVrmlFile("_stab")}),500);else if("export pdb"==l)s.htmlCls.setHtmlCls.exportPdb();else if("export secondary structure"==l)s.htmlCls.setHtmlCls.exportSecondary();else if("select all"==l)t.selectionCls.selectAll();else if("show all"==l)t.selectionCls.showAll();else if("select complement"==l)t.resid2specCls.selectComplement();else if("set pk atom"==l)t.pk=1,t.opts.pk="atom";else if("set pk off"==l)t.pk=0,t.opts.pk="no",t.drawCls.draw(),t.hlObjectsCls.removeHlObjects();else if("set pk residue"==l)t.pk=2,t.opts.pk="residue";else if("set pk strand"==l)t.pk=3,t.opts.pk="strand";else if("set pk domain"==l)t.pk=4,t.opts.pk="domain";else if("set pk chain"==l)t.pk=5,t.opts.pk="chain";else if("set surface wireframe on"==l)t.opts.wireframe="yes",t.applyMapCls.applySurfaceOptions();else if("set surface wireframe off"==l)t.opts.wireframe="no",t.applyMapCls.applySurfaceOptions();else if("set map wireframe on"==l)t.opts.mapwireframe="yes",t.applyMapCls.applyMapOptions();else if("set map wireframe off"==l)t.opts.mapwireframe="no",t.applyMapCls.applyMapOptions();else if("set emmap wireframe on"==l)t.opts.emmapwireframe="yes",t.applyMapCls.applyEmmapOptions();else if("set emmap wireframe off"==l)t.opts.emmapwireframe="no",t.applyMapCls.applyEmmapOptions();else if("set surface neighbors on"==l)t.bConsiderNeighbors=!0,t.applyMapCls.applySurfaceOptions();else if("set surface neighbors off"==l)t.bConsiderNeighbors=!1,t.applyMapCls.applySurfaceOptions();else if("set axis on"==l)t.opts.axis="yes";else if("set pc1 axis"==l)t.pc1=!0,t.axesCls.setPc1Axes();else if("set axis off"==l)t.opts.axis="no",t.pc1=!1;else if("set fog on"==l)t.opts.fog="yes",t.fogCls.setFog(!0);else if("set fog off"==l)t.opts.fog="no",t.fogCls.setFog(!0);else if("set slab on"==l)t.opts.slab="yes";else if("set slab off"==l)t.opts.slab="no";else if("set assembly on"==l)t.bAssembly=!0;else if("set assembly off"==l)t.bAssembly=!1;else if("set chemicalbinding show"==l)t.setOptionCls.setOption("chemicalbinding","show");else if("set chemicalbinding hide"==l)t.setOptionCls.setOption("chemicalbinding","hide");else if("set hbonds off"==l)t.hBondCls.hideHbonds(),t.drawCls.draw();else if("set salt bridge off"==l)t.saltbridgeCls.hideSaltbridge(),t.drawCls.draw();else if("set contact off"==l)t.contactCls.hideContact(),t.drawCls.draw();else if("set halogen pi off"==l)t.piHalogenCls.hideHalogenPi(),t.drawCls.draw();else if("hydrogens"==l)t.showInterCls.showHydrogens(),t.drawCls.draw();else if("set hydrogens off"==l)t.showInterCls.hideHydrogens(),t.drawCls.draw();else if("close popup"==l)t.resizeCanvasCls.closeDialogs();else if("set stabilizer off"==l)t.threeDPrintCls.hideStabilizer(),t.drawCls.draw();else if("set disulfide bonds off"==l)t.opts.ssbonds="no",t.drawCls.draw();else if("set cross linkage off"==l)t.opts.clbonds="no",t.drawCls.draw();else if("set lines off"==l)t.labels.distance=[],t.lines.distance=[],t.drawCls.draw();else if("set labels off"==l){for(let e in t.labels)t.labels[e]=[];t.drawCls.draw()}else if("set mode all"==l)t.definedSetsCls.setModeAndDisplay("all");else if("set mode selection"==l)t.definedSetsCls.setModeAndDisplay("selection");else if("set view detailed view"==l)t.annotationCls.setAnnoViewAndDisplay("detailed view");else if("set view overview"==l)t.annotationCls.setAnnoViewAndDisplay("overview");else if("set annotation custom"==l)t.annotationCls.setAnnoTabCustom();else if("set annotation interaction"==l)t.annotationCls.setAnnoTabInteraction();else if("set annotation cdd"==l)t.annotationCls.setAnnoTabCdd();else if("set annotation site"==l)t.annotationCls.setAnnoTabSite();else if("set annotation ssbond"==l)t.annotationCls.setAnnoTabSsbond();else if("set annotation crosslink"==l)t.annotationCls.setAnnoTabCrosslink();else if("set annotation transmembrane"==l)t.annotationCls.setAnnoTabTransmem();else if("highlight level up"==l)t.resid2specCls.switchHighlightLevelUp();else if("highlight level down"==l)t.resid2specCls.switchHighlightLevelDown();else if(0==l.indexOf("hide annotation")){let e=l.lastIndexOf(" "),s=l.substr(e+1);"all"==s?t.annotationCls.hideAnnoTabAll():"custom"==s?t.annotationCls.hideAnnoTabCustom():"clinvar"==s?t.annotationCls.hideAnnoTabClinvar():"snp"==s?t.annotationCls.hideAnnoTabSnp():"cdd"==s?t.annotationCls.hideAnnoTabCdd():"3ddomain"==s?t.annotationCls.hideAnnoTab3ddomain():"site"==s?t.annotationCls.hideAnnoTabSite():"interaction"==s?t.annotationCls.hideAnnoTabInteraction():"ssbond"==s?t.annotationCls.hideAnnoTabSsbond():"crosslink"==s?t.annotationCls.hideAnnoTabCrosslink():"transmembrane"==s&&t.annotationCls.hideAnnoTabTransmem()}else if("add residue labels"==l)t.residueLabelsCls.addResidueLabels(t.hAtoms),t.drawCls.draw();else if("add residue number labels"==l)t.residueLabelsCls.addResidueLabels(t.hAtoms,void 0,void 0,!0),t.drawCls.draw();else if("add atom labels"==l)t.residueLabelsCls.addAtomLabels(t.hAtoms),t.drawCls.draw();else if("add element labels"==l)t.residueLabelsCls.addAtomLabels(t.hAtoms,!0),t.drawCls.draw();else if("add chain labels"==l)t.analysisCls.addChainLabels(t.hAtoms),t.drawCls.draw();else if("add terminal labels"==l)t.analysisCls.addTerminiLabels(t.hAtoms),t.drawCls.draw();else if("rotate left"==l)t.bStopRotate=!1,t.ROT_DIR="left",t.resizeCanvasCls.rotStruc("left");else if("rotate right"==l)t.bStopRotate=!1,t.ROT_DIR="right",t.resizeCanvasCls.rotStruc("right");else if("rotate up"==l)t.bStopRotate=!1,t.ROT_DIR="up",t.resizeCanvasCls.rotStruc("up");else if("rotate down"==l)t.bStopRotate=!1,t.ROT_DIR="down",t.resizeCanvasCls.rotStruc("down");else if("rotate x"==l){let e=new THREE.Vector3(1,0,0),s=.5*Math.PI;t.transformCls.setRotation(e,s)}else if("rotate y"==l){let e=new THREE.Vector3(0,1,0),s=.5*Math.PI;t.transformCls.setRotation(e,s)}else if("rotate z"==l){let e=new THREE.Vector3(0,0,1),s=.5*Math.PI;t.transformCls.setRotation(e,s)}else if("reset"===l)t.selectionCls.resetAll();else if("reset orientation"===l)t.transformCls.resetOrientation(),t.drawCls.draw();else if("reset thickness"==l)t.threeDPrintCls.resetAfter3Dprint(),t.drawCls.draw();else if("clear selection"==l)t.hlObjectsCls.removeHlObjects(),t.hlUpdateCls.removeHl2D(),t.bShowHighlight=!1,t.bSelectResidue=!1;else if("zoom selection"==l)t.transformCls.zoominSelection(),t.drawCls.draw();else if("center selection"==l)t.applyCenterCls.centerSelection(),t.drawCls.draw();else if("show selection"==l)t.selectionCls.showSelection();else if("hide selection"==l)t.selectionCls.hideSelection();else if("output selection"==l)t.threeDPrintCls.outputSelection();else if("toggle selection"==l)t.selectionCls.toggleSelection();else if("toggle highlight"==l)t.hlUpdateCls.toggleHighlight();else if("stabilizer"==l)t.threeDPrintCls.addStabilizer(),t.threeDPrintCls.prepareFor3Dprint();else if("disulfide bonds"==l)t.showInterCls.showSsbonds();else if("cross linkage"==l)t.showInterCls.showClbonds();else if("back"==l)t.resizeCanvasCls.back();else if("forward"==l)t.resizeCanvasCls.forward();else if("clear all"==l)t.selectionCls.selectAll();else if("defined sets"==l)t.definedSetsCls.showSets();else if("delete selected sets"==l)t.definedSetsCls.deleteSelectedSets();else if("view interactions"==l)void 0===s.cfg.mmdbid&&void 0===s.cfg.gi||t.ParserUtilsCls.set2DDiagrams(t.inputid);else if("show annotations all chains"==l)t.annotationCls.showAnnoAllChains();else if("save color"==l)t.setOptionCls.saveColor();else if("apply saved color"==l)t.setOptionCls.applySavedColor();else if("save style"==l)t.setOptionCls.saveStyle();else if("apply saved style"==l)t.setOptionCls.applySavedStyle();else if("select main chains"==l)t.selectionCls.selectMainChains();else if("select side chains"==l)t.selectionCls.selectSideChains();else if("select main side chains"==l)t.selectionCls.selectMainSideChains();else if("realign"==l)t.realignParserCls.realign();else if("area"==l)t.analysisCls.calculateArea();else if("table inter count only"==l)$(".icn3d-border").hide();else if("table inter details"==l)$(".icn3d-border").show();else if("setoption map nothing"==l)t.setOptionCls.setOption("map","nothing");else if("setoption emmap nothing"==l)t.setOptionCls.setOption("emmap","nothing");else if("setoption phimap nothing"==l)t.setOptionCls.setOption("phimap","nothing");else if("setoption phisurface nothing"==l)t.setOptionCls.setOption("phisurface","nothing");else if("clear symd symmetry"==l)t.symdArray=[];else if("show axis"==l)t.bAxisOnly=!0;else if(0==i.indexOf("define helix sets")){let e=i.split(" | ")[1].split(" ")[1];t.addTrackCls.defineSecondary(e,"helix")}else if(0==i.indexOf("define sheet sets")){let e=i.split(" | ")[1].split(" ")[1];t.addTrackCls.defineSecondary(e,"sheet")}else if(0==i.indexOf("define coil sets")){let e=i.split(" | ")[1].split(" ")[1];t.addTrackCls.defineSecondary(e,"coil")}else if(0==i.indexOf("select interaction")){let e=i.substr(i.lastIndexOf(" ")+1).split(",");if(null!==e){let s=e[0].split("_")[0];t.b2DShown||t.ParserUtilsCls.download2Ddgm(s.toUpperCase()),t.diagram2dCls.selectInteraction(e[0],e[1])}}else if(0==i.indexOf("select saved atoms")||0==i.indexOf("select sets")){i=i.replace(/aligned_protein/g,"protein_aligned");let e=i.split(" | "),s=e[0].replace(/,/g," or "),l=19;0==i.indexOf("select sets")&&(l=12);let n=s.substr(l),r=n;2==e.length&&(r=e[1].substr(5)),t.definedSetsCls.selectCombinedSets(n,r)}else if(-1!==i.indexOf("select chain")){let e=i.substr(i.lastIndexOf(" ")+1).split(",");for(let s=0,i=e.length;s<i;++s)t.selectionCls.selectAChain(e[s],e[s],!1)}else if(-1!==i.indexOf("select alignChain")){let e=i.substr(i.lastIndexOf(" ")+1).split(",");for(let s=0,i=e.length;s<i;++s)t.selectionCls.selectAChain(e[s],"align_"+e[s],!0)}else if(0==i.indexOf("select zone cutoff")){let e=this.getThresholdNameArrays(i);t.showInterCls.pickCustomSphere(e.threshold,e.nameArray2,e.nameArray,e.bHbondCalc),t.bSphereCalc=!0}else if(0==l.indexOf("set surface opacity")){let e=l.substr(l.lastIndexOf(" ")+1);t.opts.opacity=parseFloat(e),t.applyMapCls.applySurfaceOptions(),parseInt(100*e)<100&&(t.bTransparentSurface=!0)}else if(0==l.indexOf("set label scale")){let e=l.substr(l.lastIndexOf(" ")+1);t.labelScale=parseFloat(e)}else if(0==l.indexOf("set surface")){let e=l.substr(12);t.opts.surface=e,t.applyMapCls.applySurfaceOptions()}else if(0==l.indexOf("set camera")){let e=l.substr(l.lastIndexOf(" ")+1);t.opts.camera=e}else if(0==l.indexOf("set background")){let e=l.substr(l.lastIndexOf(" ")+1);t.opts.background=e,"black"==e?($("#"+t.pre+"title").css("color",s.htmlCls.GREYD),$("#"+t.pre+"titlelink").css("color",s.htmlCls.GREYD)):($("#"+t.pre+"title").css("color","black"),$("#"+t.pre+"titlelink").css("color","black"))}else if(0==l.indexOf("set label color"))t.labelcolor=l.substr(l.lastIndexOf(" ")+1);else if(0==i.indexOf("set thickness")){let e=l.split(" | ");t.bSetThickness=!0;for(let s=1,i=e.length;s<i;++s){let i=e[s].split(" "),l=i[0],n=parseFloat(i[1]);"linerad"==l&&(t.lineRadius=n),"coilrad"==l&&(t.coilWidth=n),"stickrad"==l&&(t.cylinderRadius=n),"tracerad"==l&&(t.traceRadius=n),"ballscale"==l&&(t.dotSphereScale=n),"ribbonthick"==l&&(t.ribbonthickness=n),"proteinwidth"==l&&(t.helixSheetWidth=n),"nucleotidewidth"==l&&(t.nucleicAcidWidth=n),t.drawCls.draw()}}else if(0==i.indexOf("set light")){let e=l.split(" | ");for(let s=1,i=e.length;s<i;++s){let i=e[s].split(" "),l=i[0],n=parseFloat(i[1]);"light1"==l&&(t.light1=n),"light2"==l&&(t.light2=n),"light3"==l&&(t.light3=n),t.drawCls.draw()}}else if(0==i.indexOf("set shininess")){let e=l.lastIndexOf(" ");t.shininess=parseFloat(l.substr(e+1)),t.drawCls.draw()}else if(0==i.indexOf("set glycan")){let e=l.lastIndexOf(" ");t.bGlycansCartoon=parseInt(l.substr(e+1)),t.drawCls.draw()}else if(0==i.indexOf("set membrane")){let e=l.lastIndexOf(" ");t.bMembrane=parseInt(l.substr(e+1)),t.drawCls.draw()}else if(0==l.indexOf("set highlight color")){let e=l.substr(20);"yellow"===e?(t.hColor=s.parasCls.thr(16776960),t.matShader=t.setColorCls.setOutlineColor("yellow")):"green"===e?(t.hColor=s.parasCls.thr(65280),t.matShader=t.setColorCls.setOutlineColor("green")):"red"===e&&(t.hColor=s.parasCls.thr(16711680),t.matShader=t.setColorCls.setOutlineColor("red")),t.drawCls.draw()}else if(0==l.indexOf("set highlight style")){let e=l.substr(20);"outline"===e?t.bHighlight=1:"3d"===e&&(t.bHighlight=2),t.drawCls.draw()}else if(0==l.indexOf("add line")){let e=l.split(" | "),s=e[1].split(" "),i=e[2].split(" "),n=e[3].substr(e[3].lastIndexOf(" ")+1),r="true"===e[4].substr(e[4].lastIndexOf(" ")+1),o=e[5].substr(e[5].lastIndexOf(" ")+1);t.analysisCls.addLine(parseFloat(s[1]),parseFloat(s[3]),parseFloat(s[5]),parseFloat(i[1]),parseFloat(i[3]),parseFloat(i[5]),n,r,o),t.drawCls.draw()}else if(0==i.indexOf("add label")){let e,l,n,r,o,a,d,c=i.split(" | "),h=c[0].substr("add label".length+1),m=!1;for(let t=1,s=c.length;t<s;++t){let s=c[t].split(" ");"x"==s[0]?(m=!0,e=s[1],l=s[3],n=s[5]):"size"==s[0]?r=c[t].substr(c[t].lastIndexOf(" ")+1):"color"==s[0]?o=c[t].substr(c[t].lastIndexOf(" ")+1):"background"==s[0]?a=c[t].substr(c[t].lastIndexOf(" ")+1):"type"==s[0]&&(d=c[t].substr(c[t].lastIndexOf(" ")+1))}if(!m){let i=t.applyCenterCls.centerAtoms(s.hashUtilsCls.hash2Atoms(t.hAtoms,t.atoms));e=i.center.x,l=i.center.y,n=i.center.z}t.analysisCls.addLabel(h,e,l,n,r,o,a,d),t.drawCls.draw()}else if(0==i.indexOf("msa")){let e=i.split(" | ")[1].split(" ");t.targetGapHash={};for(let s=0,i=e.length;s<i;++s){let i=e[s].split("_");t.targetGapHash[parseInt(i[0])]={from:parseInt(i[1]),to:parseInt(i[2])}}t.annotationCls.resetAnnoAll()}else if(0==i.indexOf("add track")){let e,s,l,n=i.split(" | "),r=n[1].substr(8),o=n[2].substr(6),a=n[3].substr(5);n.length>=5&&(e=n[4].substr(5)),n.length>=6&&(s=n[5].substr(6)),n.length>=7&&(l=n[6].substr(4)),$("#"+t.pre+"anno_custom")[0].checked=!0,$("[id^="+t.pre+"custom]").show(),"0"==s&&(s=void 0),t.addTrackCls.checkGiSeq(r,o,a,e,s,l,0)}else if(0==l.indexOf("remove one stabilizer")){let e=l.split(" | ")[1].split(" "),s=[];s.push(parseInt(e[0])),s.push(parseInt(e[1])),t.threeDPrintCls.removeOneStabilizer(s),t.drawCls.draw()}else if(0==l.indexOf("add one stabilizer")){let e=l.split(" | ")[1].split(" ");void 0===t.pairArray&&(t.pairArray=[]),t.pairArray.push(parseInt(e[0])),t.pairArray.push(parseInt(e[1])),t.drawCls.draw()}else if(0==l.indexOf("select planes z-axis")){let e=l.split(" ");if(5==e.length){let s=parseFloat(e[3]),i=parseFloat(e[4]);t.selectionCls.selectBtwPlanes(s,i)}}else if(0==l.indexOf("adjust membrane z-axis")){let e=l.split(" ");if(5==e.length){let s=parseFloat(e[3]),i=parseFloat(e[4]);t.selectionCls.adjustMembrane(s,i)}}else if(0==l.indexOf("toggle membrane"))t.selectionCls.toggleMembrane();else if(0==i.indexOf("calc buried surface")){let e=i.split(" | ");if(2==e.length){let s=e[1].split(" ");if(2==s.length){let e=s[0].split(","),i=s[1].split(",");t.analysisCls.calcBuriedSurface(e,i)}}}else if(0==i.indexOf("dist ")){let e=i.split(" | ");if(2==e.length){let s=e[1].split(" ");if(2==s.length){let e=s[0].split(","),i=s[1].split(",");t.analysisCls.measureDistTwoSets(e,i)}}}else if(0==i.indexOf("disttable")){let e=i.split(" | ");if(2==e.length){let i=e[1].split(" ");if(2==i.length){let e=i[0].split(","),l=i[1].split(",");t.analysisCls.measureDistManySets(e,l),s.htmlCls.dialogCls.openDlg("dl_disttable","Distance among the sets")}}}else if(0==i.indexOf("display interaction 3d")||0==i.indexOf("view interaction pairs")||0==i.indexOf("save1 interaction pairs")||0==i.indexOf("save2 interaction pairs")||0==i.indexOf("line graph interaction pairs")||0==i.indexOf("scatterplot interaction pairs")){let e=i.split(" | ");if(e.length>=3){let s=e[1].split(" ");if(2==s.length){let l,n,r=s[0].split(","),o=s[1].split(","),a=-1!==e[2].indexOf("hbonds"),d=-1!==e[2].indexOf("salt bridge"),c=-1!==e[2].indexOf("interactions"),h=-1!==e[2].indexOf("halogen"),m=-1!==e[2].indexOf("pi-cation"),p=-1!==e[2].indexOf("pi-stacking");if(e.length>=4&&(l="true"==e[3]),e.length>=5){let s=e[4].split(" ");s.length>=4&&($("#"+t.pre+"hbondthreshold").val(s[1]),$("#"+t.pre+"saltbridgethreshold").val(s[2]),$("#"+t.pre+"contactthreshold").val(s[3]),7==s.length&&($("#"+t.pre+"halogenthreshold").val(s[4]),$("#"+t.pre+"picationthreshold").val(s[5]),$("#"+t.pre+"pistackingthreshold").val(s[6])))}0==i.indexOf("display interaction 3d")?n="3d":0==i.indexOf("view interaction pairs")?n="view":0==i.indexOf("save1 interaction pairs")?n="save1":0==i.indexOf("save2 interaction pairs")?n="save2":0==i.indexOf("line graph interaction pairs")?n="linegraph":0==i.indexOf("scatterplot interaction pairs")&&(n="scatterplot"),t.viewInterPairsCls.viewInteractionPairs(r,o,l,n,a,d,c,h,m,p)}}}else if(0==i.indexOf("export pairs")){let e=i.split(" | ");if(3==e.length){let s=e[1].split(" ");if(2==s.length){let i=s[0].split(","),l=s[1].split(","),n=e[2].split(" ")[1];t.showInterCls.pickCustomSphere(n,i,l,t.bSphereCalc),t.bSphereCalc=!0;let r=t.viewInterPairsCls.exportSpherePairs(),o=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(o+"_sphere_pairs.html","html",r)}}}else if(0==i.indexOf("export pqr"))s.htmlCls.setHtmlCls.exportPqr();else if(0==l.indexOf("graph label")){let e=l.lastIndexOf(" "),t=l.substr(e+1);$("#"+s.svgid+"_label").val(t),$("#"+s.svgid+" text").removeClass(),$("#"+s.svgid+" text").addClass(t)}else if(0==l.indexOf("cartoon label")){let e=l.lastIndexOf(" "),t=l.substr(e+1);$("#"+s.svgid_ct+"_label").val(t),$("#"+s.svgid_ct+" text").removeClass(),$("#"+s.svgid_ct+" text").addClass(t)}else if(0==l.indexOf("cartoon 2d chain")||0==l.indexOf("cartoon 2d secondary")){let e=l.lastIndexOf(" "),s=l.substr(e+1);t.cartoon2dCls.draw2Dcartoon(s)}else if(0==l.indexOf("line graph scale")){let e=l.lastIndexOf(" "),i=l.substr(e+1);$("#"+s.linegraphid+"_scale").val(i),$("#"+s.linegraphid).attr("width",(t.linegraphWidth*parseFloat(i)).toString()+"px")}else if(0==l.indexOf("scatterplot scale")){let e=l.lastIndexOf(" "),i=l.substr(e+1);$("#"+s.scatterplotid+"_scale").val(i),$("#"+s.scatterplotid).attr("width",(t.scatterplotWidth*parseFloat(i)).toString()+"px")}else if(0==l.indexOf("contactmap scale")){let e=l.lastIndexOf(" "),i=l.substr(e+1);$("#"+s.contactmapid+"_scale").val(i),$("#"+s.contactmapid).attr("width",(t.contactmapWidth*parseFloat(i)).toString()+"px")}else if(0==l.indexOf("alignerrormap scale")){let e=l.lastIndexOf(" "),i=l.substr(e+1);$("#"+s.alignerrormapid+"_scale").val(i),$("#"+s.alignerrormapid).attr("width",(t.alignerrormapWidth*parseFloat(i)).toString()+"px")}else if(0==l.indexOf("graph force")){let e=l.lastIndexOf(" ");s.htmlCls.force=parseInt(l.substr(e+1)),$("#"+s.svgid+"_force").val(s.htmlCls.force),t.getGraphCls.handleForce()}else if(0==l.indexOf("hide edges")){let e=l.lastIndexOf(" ");s.htmlCls.hideedges=parseInt(l.substr(e+1)),$("#"+s.svgid+"_hideedges").val(s.htmlCls.hideedges),s.htmlCls.hideedges?(s.htmlCls.contactInsideColor="FFF",s.htmlCls.hbondInsideColor="FFF",s.htmlCls.ionicInsideColor="FFF"):(s.htmlCls.contactInsideColor="DDD",s.htmlCls.hbondInsideColor="AFA",s.htmlCls.ionicInsideColor="8FF"),void 0!==t.graphStr&&t.bRender&&s.htmlCls.force&&t.drawGraphCls.drawGraph(t.graphStr,t.pre+"dl_graph")}else if(0==l.indexOf("reset interaction pairs"))t.viewInterPairsCls.resetInteractionPairs();else if(0==l.indexOf("side by side")){let e=l.split(" | ")[1];window.open(e,"_blank")}else if(0==i.indexOf("your note")){let e=i.split(" | ");t.yournote=e[1],$("#"+t.pre+"yournote").val(t.yournote),s.cfg.shownote&&(document.title=t.yournote)}else if(0==l.indexOf("cross structure interaction"))t.crossstrucinter=parseInt(l.substr(l.lastIndexOf(" ")+1)),$("#"+t.pre+"crossstrucinter").val(t.crossstrucinter);else if("replay on"==l)t.resizeCanvasCls.replayon();else if("replay off"==l)t.resizeCanvasCls.replayoff();else if(0==l.indexOf("contact map")){let e=l.split(" | ");if(3===e.length){let s=parseFloat(e[1].split(" ")[1]),i=e[2].split(" ")[1];t.contactMapCls.contactMap(s,i)}}else if(0==l.indexOf("pickatom")){let e=parseInt(l.substr(l.lastIndexOf(" ")+1));t.pAtom=t.atoms[e],t.pickingCls.showPicking(t.pAtom)}else if(0==i.indexOf("set color spectrum")){let e=i.split(" | ");if(2==e.length){let s=e[1].split(","),i=!0;t.setColorCls.setColorBySets(s,i)}}else if(0==i.indexOf("set color rainbow")){let e=i.split(" | ");if(2==e.length){let s=e[1].split(","),i=!1;t.setColorCls.setColorBySets(s,i)}}else if(0==i.indexOf("color")){let e=i.split(" | "),l=e[0].substr(e[0].indexOf(" ")+1);if(t.opts.color=l,"residue custom"==l&&2==e.length){t.customResidueColors=JSON.parse(e[1]);for(let e in t.customResidueColors)t.customResidueColors[e.toUpperCase()]=s.parasCls.thr("#"+t.customResidueColors[e])}else if("align custom"==l&&3==e.length){let s=e[1],i=e[2].split(", ");t.queryresi2score={},t.queryresi2score[s]={};for(let e=0,l=i.length;e<l;++e){let l=i[e].split(" ");t.queryresi2score[s][l[0]]=l[1]}}else"align custom"==l&&e.length>=4?this.setQueryresi2score(e):"area"==l&&2==e.length&&(t.midpercent=e[1],$("#"+t.pre+"midpercent").val(t.midpercent));t.setColorCls.setColorByOptions(t.opts,t.hAtoms),t.hlUpdateCls.updateHlAll(),t.getGraphCls.updateGraphColor()}else if(0==i.indexOf("remove legend"))$("#"+s.pre+"legend").hide();else if(0==i.indexOf("custom tube")){let e=i.split(" | ");this.setQueryresi2score(e),t.setOptionCls.setStyle("proteins","custom tube")}else if(0==l.indexOf("style")){let e=l.substr(l.indexOf(" ")+1),s=e.substr(0,e.indexOf(" ")),i=e.substr(e.indexOf(" ")+1);t.setOptionCls.setStyle(s,i)}else if(0==l.indexOf("window")){let e=l.substr(l.indexOf(" ")+1);"aligned sequences"==e?s.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"):"interaction table"==e?s.htmlCls.dialogCls.openDlg("dl_allinteraction","Show interactions"):"interaction graph"==e?s.htmlCls.dialogCls.openDlg("dl_linegraph","Show interactions between two lines of residue nodes"):"interaction scatterplot"==e?s.htmlCls.dialogCls.openDlg("dl_scatterplot","Show interactions as scatterplot"):"force-directed graph"==e&&s.htmlCls.dialogCls.openDlg("dl_graph","Force-directed graph")}else if(0==l.indexOf("set theme")){let e=l.substr(l.lastIndexOf(" ")+1);s.htmlCls.setMenuCls.setTheme(e)}else if(0==l.indexOf("set double color")){let e=l.substr(l.lastIndexOf(" ")+1);"on"==e?(t.bDoublecolor=!0,t.setOptionCls.setStyle("proteins","ribbon")):"off"==e&&(t.bDoublecolor=!1)}else if(0==l.indexOf("adjust dialog")){let e=l.substr(l.lastIndexOf(" ")+1);t.scapCls.adjust2DWidth(e)}else if(0==l.indexOf("glycans cartoon")){let e=l.substr(l.lastIndexOf(" ")+1);t.bGlycansCartoon="yes"==e}else if(0==l.indexOf("save html")){let e=l.substr(l.lastIndexOf(" ")+1);s.htmlCls.eventsCls.saveHtml(e)}else if(-1!==l.indexOf("select displayed set"))t.hAtoms=s.hashUtilsCls.cloneHash(t.viewSelectionAtoms),t.hlUpdateCls.updateHlAll();else if(-1!==l.indexOf("select prop")){let e,s,l=i.split(" | "),n=l[0].substr("select prop".length+1);if(2==l.length){let t=l[1].split("_");e=t[0],s=t[1]}t.resid2specCls.selectProperty(n,e,s)}else if(0==l.indexOf("select")&&-1!==l.indexOf("name")){let e=i.split(" | "),s="",l="",n="";for(let t=0,i=e.length;t<i;++t){let i=e[t];-1!==i.indexOf("select")?s=i.substr(i.indexOf(" ")+1):-1!==i.indexOf("name")&&(l=i.substr(i.indexOf(" ")+1))}n=l,t.selByCommCls.selectByCommand(s,l,n)}else if(-1!==l.indexOf("select $")||-1!==l.indexOf("select .")||-1!==l.indexOf("select :")||-1!==l.indexOf("select @")){let e=i.split(" | "),s=e[0].substr(e[0].indexOf(" ")+1),l="",n="";e.length>1&&(l=e[1].substr(e[1].indexOf(" ")+1)),e.length>2&&(n=e[2].substr(e[2].indexOf(" ")+1)),-1!==s.indexOf(" or ")?t.selByCommCls.selectByCommand(s,l,n):t.selByCommCls.selectBySpec(s,l,n)}s.htmlCls.clickMenuCls.setLogCmd(i,!1),t.bAddCommands=!0}setStrengthPara(e){let t=this.icn3d;if(t.icn3dui,e.length>=5){let s=e[4].split(" ");s.length>=4&&($("#"+t.pre+"hbondthreshold").val(s[1]),$("#"+t.pre+"saltbridgethreshold").val(s[2]),$("#"+t.pre+"contactthreshold").val(s[3]),s.length>=7&&($("#"+t.pre+"halogenthreshold").val(s[4]),$("#"+t.pre+"picationthreshold").val(s[5]),$("#"+t.pre+"pistackingthreshold").val(s[6])))}if(6==e.length){let s=e[5].split(" ");s.length>=6&&($("#"+t.pre+"dist_ss").val(s[0]),$("#"+t.pre+"dist_coil").val(s[1]),$("#"+t.pre+"dist_hbond").val(s[2]),$("#"+t.pre+"dist_inter").val(s[3]),$("#"+t.pre+"dist_ssbond").val(s[4]),$("#"+t.pre+"dist_ionic").val(s[5]),9==s.length&&($("#"+t.pre+"dist_halogen").val(s[6]),$("#"+t.pre+"dist_pication").val(s[7]),$("#"+t.pre+"dist_pistacking").val(s[8])))}}getThresholdNameArrays(e){let t=this.icn3d,s=t.icn3dui;if(void 0===t.bSetChainsAdvancedMenu||!t.bSetChainsAdvancedMenu){let e=s.hashUtilsCls.cloneHash(t.hAtoms);t.definedSetsCls.setPredefinedInMenu(),t.bSetChainsAdvancedMenu=!0,t.hAtoms=s.hashUtilsCls.cloneHash(e)}let i,l=e.split(" | "),n=parseFloat(l[0].substr(l[0].lastIndexOf(" ")+1)),r=[],o=[];if(l.length>=2&&l[1].length>4){let e=l[1].split(" ");e.length>1&&(o=e[1].split(",")),e.length>2&&(r=e[2].split(","))}else o=["selected"],r=["non-selected"];return 3==l.length&&(i="true"==l[2]),{threshold:n,nameArray2:o,nameArray:r,bHbondCalc:i}}setQueryresi2score(e){let t=this.icn3d,s=t.icn3dui,i=e[1],l=e[2].split(" ")[1].split("_"),n=e[3];void 0===t.queryresi2score&&(t.queryresi2score={}),t.queryresi2score[i]={};for(let e=parseInt(l[0]),s=0;e<=parseInt(l[1]);++e,++s)"_"!=n[s]&&(t.queryresi2score[i][e]=11.11111111111111*parseInt(n[s]));if(e.length>4){let i=e[4].split(" ");t.startColor=i[1],t.midColor=i[2],t.endColor=i[3];let l=s.htmlCls.clickMenuCls.setLegendHtml();$("#"+s.pre+"dl_legend").html(l),s.htmlCls.dialogCls.openDlg("dl_legend","Color Range")}}getMenuFromCmd(e){this.icn3d.icn3dui;let t="Windows > View Sequences & Annotations",s="Analysis > H-Bonds & Interactions",i=s+" > 2D Graph(Force-Directed)",l="View > Rotate > Auto Rotation > Rotate ",n="View > Rotate > Rotate 90 deg > ",r="Select > Select on 3D > ",o="Analysis > Label > ",a="File > 3D Printing > ";return 0==(e=e.trim()).indexOf("load")?"File > Retrieve by ID, Align":0==e.indexOf("set map")&&-1==e.indexOf("set map wireframe")?"Style > Electron Density":0==e.indexOf("set emmap")&&-1==e.indexOf("set emmap wireframe")?"Style > EM Density Map":0==e.indexOf("set phi")?"Analysis > Load Potential > URL(Same Host) Phi/Cube":0==e.indexOf("set delphi")?"Analysis > DelPhi Potential":0==e.indexOf("setoption map")?"Style > Remove Map":0==e.indexOf("setoption emmap")?"Style > Remove EM Map":0==e.indexOf("view annotations")?t:0==e.indexOf("set annotation all")?t+': "All" checkbox':0==e.indexOf("set annotation clinvar")?t+': "ClinVar" checkbox':0==e.indexOf("set annotation snp")?t+': "SNP" checkbox':0==e.indexOf("set annotation 3ddomain")?t+': "3D Domains" checkbox':0==e.indexOf("view interactions")?"Windows > View 2D Diagram":0==e.indexOf("symmetry")?"Analysis > Symmetry":0==e.indexOf("realign on seq align")?"File > Realign Selection > on Sequence Alignment":0==e.indexOf("realign")?"File > Realign Selection > Residue by Residue":0==e.indexOf("graph interaction pairs")?s+" > 2D Graph(Force-Directed)":0==e.indexOf("export canvas")?"File > Save Files > iCn3D PNG Image":"export stl file"==e?a+"STL":"export vrml file"==e?a+"VRML(Color)":"export stl stabilizer file"==e?a+"STL W/ Stabilizers":"export vrml stabilizer file"==e?a+"VRML(Color, W/ Stabilizers)":"select all"==e?'Select > All; or Toggle to "All"(next to "Help")':"show all"==e?"View > View Full Structure":"select complement"==e?"Select > Inverse":"set pk atom"==e?r+"Atom":"set pk residue"==e?r+"Residue":"set pk strand"==e?r+"Strand/Helix":"set pk domain"==e?r+"3D Domain":"set pk chain"==e?r+"Chain":"set surface wireframe on"==e?"Style > Surface Wireframe > Yes":"set surface wireframe off"==e?"Style > Surface Wireframe > No":"set map wireframe on"==e?"Style > Map Wireframe > Yes":"set map wireframe off"==e?"Style > Map Wireframe > No":"set emmap wireframe on"==e?"Style > EM Map Wireframe > Yes":"set emmap wireframe off"==e?"Style > EM Map Wireframe > No":"set surface neighbors on"==e?"Style > Surface Type > ... with Context":"set axis on"==e?"View > XYZ-axes > Show":"set axis off"==e?"View > XYZ-axes > Hide":"set fog on"==e?"View > Fog for Selection > On":"set fog off"==e?"View > Fog for Selection > Off":"set slab on"==e?"View > Slab for Selection > On":"set slab off"==e?"View > Slab for Selection > Off":"set assembly on"==e?"Analysis > Assembly > Biological Assembly":"set assembly off"==e?"Analysis > Assembly > Asymmetric Unit":"set chemicalbinding show"==e?"Analysis > Chem. Binding > Show":"set chemicalbinding hide"==e?"Analysis > Chem. Binding > Hide":"set hbonds off"==e||"set salt bridge off"==e||"set contact off"==e||"set halogen pi off"==e?s+" > Reset":"hydrogens"==e?"Style > Hydrogens > Show":"set hydrogens off"==e?"Style > Hydrogens > Hide":"set stabilizer off"==e?"File > 3D Printing > Remove All Stabilizers":"set disulfide bonds off"==e?"Analysis > Disulfide Bonds > Hide":"set cross linkage off"==e?"Analysis > Cross-Linkages > Hide":"set lines off"==e?"Analysis > Distance > Hide":"set labels off"==e?"Analysis > Label > Remove":"set mode all"==e?'Toggle to "All"(next to "Help")':"set mode selection"==e?'Toggle to "Selection"(next to "Help")':"set view detailed view"==e?t+': "Details" tab':"set view overview"==e?t+': "Summary" tab':"set annotation custom"==e?t+': "Custom" checkbox':"set annotation interaction"==e?t+': "Interactions" checkbox':"set annotation cdd"==e?t+': "Conserved Domains" checkbox':"set annotation site"==e?t+': "Functional Sites" checkbox':"set annotation ssbond"==e?t+': "Disulfide Bonds" checkbox':"set annotation crosslink"==e?t+': "Cross-Linkages" checkbox':"set annotation transmembrane"==e?t+': "Transmembrane" checkbox':"highlight level up"==e?"Keyboard Arrow Up":"highlight level down"==e?"Keyboard Arrow Down":0==e.indexOf("hide annotation")?t+": checkboxes off":"add residue labels"==e?o+"per Residue":"add residue number labels"==e?o+"per Residue & Number":"add atom labels"==e?o+"per Atom":"add chain labels"==e?o+"per Chain":"add terminal labels"==e?o+"N- & C- Termini":"rotate left"==e?l+"Left; or Key l":"rotate right"==e?l+"Right; or Key j":"rotate up"==e?l+"Up; or Key i":"rotate down"==e?l+"Down; or Key m":"rotate x"==e?n+"X-axis":"rotate y"==e?n+"Y-axis":"rotate z"==e?n+"Z-axis":"reset"==e?"View > Reset > All":"reset orientation"==e?"View > Reset > Orientation":"clear selection"==e?"Select > Clear Selection":"zoom selection"==e?"Select > Zoom in Selection":"center selection"==e?"Select > Center Selection":"show selection"==e?"Select > View Only Selection":"hide selection"==e?"Select > Hide Selection":"output selection"==e?"Select > Clear Selection":"toggle highlight"==e?"Select > Toggle Highlight":"stabilizer"==e?"File > 3D Printing > Add all Stabilizers":"disulfide bonds"==e?"Analysis > Disulfide Bonds > Show":"cross linkage"==e?"Analysis > Cross-Linkages > Show":"back"==e?"View > Undo":"forward"==e?"View > Redo":"clear all"==e?"Select > Clear Selection":"defined sets"==e?"Windows > Defined Sets":"delete selected sets"==e?'Windows > Defined Sets: "Delete Selected Sets" button':"view interactions"==e?"Windows > View Interactions":"show annotations all chains"==e?t+': "Show All Chains" button':"save color"==e?"Color > Save Color":"apply saved color"==e?"Color > Apply Saved Color":"save style"==e?"Style > Save Style":"apply saved style"==e?"Style > Apply Saved Style":"select main chains"==e?"Select > Main Chains":"select side chains"==e?"Select > Side Chains":"select main side chains"==e?"Select > Main & Side Chains":"area"==e?"View > Surface Area":"table inter count only"==e?s+': "Set 1" button: "Show Count Only" button':"table inter details"==e?s+': "Set 1" button: "Show Details" button':0==e.indexOf("define helix sets")?t+': "Helix Sets" button':0==e.indexOf("define sheet sets")?t+': "Sheet Sets" button':0==e.indexOf("define coil sets")?t+': "Coil Sets" button':0==e.indexOf("select interaction")?"Windows > View 2D Diagram: click on edges":0==e.indexOf("select saved atoms")||0==e.indexOf("select sets")?"Windows > Defined Sets: select in menu":-1!==e.indexOf("select chain")?t+": click on chain names":-1!==e.indexOf("select alignChain")?"Windows > View Aligned Sequences: click on chain names":0==e.indexOf("select zone cutoff")?"Select > by Distance":0==e.indexOf("set surface opacity")?"Style > Surface Opacity":0==e.indexOf("set label scale")?"View > Label Scale":0==e.indexOf("set surface")?"Style > Surface Type":0==e.indexOf("set camera")?"View > Camera":0==e.indexOf("set background")?"Style > Background":0==e.indexOf("set thickness")?"File > 3D Printing > Set Thickness":0==e.indexOf("set highlight color")?"Select > Highlight Color":0==e.indexOf("set highlight style")?"Select > Highlight Style":0==e.indexOf("add line")||0==e.indexOf("add label")?"Analysis > Distance > between Two Atoms":0==e.indexOf("dist")?"Analysis > Distance > between Two Sets":0==e.indexOf("msa")?t+': "Add Track" button: "FASTA Alignment" button':0==e.indexOf("add track")?t+': "Add Track" button':0==e.indexOf("remove one stabilizer")?"File > 3D Printing > Remove One Stablizer":0==e.indexOf("add one stabilizer")?"File > 3D Printing > Add One Stablizer":0==e.indexOf("select planes z-axis")?"View > Select between Two X-Y Planes":0==e.indexOf("adjust membrane z-axis")?"View > Adjust Membrane":0==e.indexOf("toggle membrane")?"View > Toggle Membrane":0==e.indexOf("calc buried surface")?s+': "Buried Surface Area" button':0==e.indexOf("display interaction 3d")?s+': "3D Display Interactions" button':0==e.indexOf("view interaction pairs")?s+': "Highlight Interactions in Table" button':0==e.indexOf("save1 interaction pairs")?s+': "Set 1" button':0==e.indexOf("save2 interaction pairs")?s+': "Set 2" button':0==e.indexOf("line graph interaction pairs")?s+': "2D Interaction Network" button':0==e.indexOf("scatterplot interaction pairs")?s+': "2D Interaction Map" button':0==e.indexOf("graph label")?i+': "Label Size" menu':0==e.indexOf("graph force")?i+': "Force on Nodes" menu':0==e.indexOf("hide edges")?i+': "Internal Edges" menu':0==e.indexOf("reset interaction pairs")?s+" > Reset":0==e.indexOf("side by side")?"View > Side by Side":0==e.indexOf("your note")?"Windows > Your Notes / Window Title":0==e.indexOf("pickatom")?"Hold Alt key and click on 3D structure":0==e.indexOf("color")?"Color menu":0==e.indexOf("custom tube")?t+': "Custom Color/Tube" button: "Custom Tube" button':0==e.indexOf("style")?"Style menu":-1!==e.indexOf("select displayed set")?"Select > Displayed Set":-1!==e.indexOf("select prop")?"Select > by Property":0==e.indexOf("select")&&-1!==e.indexOf("name")?t+": drag on residues to select":-1!==e.indexOf("select $")||-1!==e.indexOf("select .")||-1!==e.indexOf("select :")||-1!==e.indexOf("select @")?"Select > Advanced; or other selection":-1!==e.indexOf("replay on")?"File > Replay Each Step > On":-1!==e.indexOf("replay off")?"File > Replay Each Step > Off":-1!==e.indexOf("set theme")?"Style > Theme Color":-1!==e.indexOf("set double color")?"Style > Two-color Helix":""}}class ve{constructor(e){this.icn3d=e}selectByCommand(e,t,s){let i=this.icn3d,l=i.icn3dui;if(0===e.indexOf("saved atoms")){let s=12,l=e.substr(s);i.definedSetsCls.selectCombinedSets(l,t)}else{let n=e.replace(/ AND /g," and ").replace(/ OR /g," or ").replace(/ or and /g," and ").replace(/ and /g," or and ").replace(/ or not /g," not ").replace(/ not /g," or not "),r=("select"===n.trim().substr(0,6)?n.trim().substr(7):n.trim()).split(" or "),o={};for(let e=0,t=r.length;e<t;++e){let t=r[e].trim().replace(/\s+/g," "),s=t.indexOf(" ");i.hAtoms={},"and"===t.substr(0,s).toLowerCase()?(i.applyCommandCls.applyCommand("select "+t.substr(s+1)),o=l.hashUtilsCls.intHash(o,i.hAtoms)):"not"===t.substr(0,s).toLowerCase()?(i.applyCommandCls.applyCommand("select "+t.substr(s+1)),o=l.hashUtilsCls.exclHash(o,i.hAtoms)):(i.applyCommandCls.applyCommand("select "+t),o=l.hashUtilsCls.unionHash(o,i.hAtoms))}i.hAtoms=l.hashUtilsCls.cloneHash(o);let a=Object.keys(i.hAtoms);if(""!==t){i.selectionCls.addCustomSelection(a,t,s,e,!1);let l=[t];i.definedSetsCls.changeCustomAtoms(l)}}}selectBySpec(e,t,s,i){let l=this.icn3d,n=l.icn3dui;e="select"===e.trim().substr(0,6)?e.trim().substr(7):e.trim(),l.hAtoms={};let r,o=e.replace(/\s+/g," ").replace(/ AND /g," and ").split(" and "),a={},d={},c=!0;for(let e=0,t=o.length;e<t;++e){let t,s,i,r,h=o[e].indexOf("$"),m=o[e].indexOf("."),p=o[e].indexOf(":"),u=o[e].indexOf("@"),C=o[e];-1===u?r=["*"]:(r=C.substr(u+1).split(","),C=C.substr(0,u)),-1===p?i="*":(i=C.substr(p+1),C=C.substr(0,p)),-1===m?s="*":(s=C.substr(m+1),C=C.substr(0,m)),-1===h?t="*":(t=C.substr(h+1),C=C.substr(0,h)),1==r.length&&"*"!==r[0]&&(c=!1);let g,f,b,y,v=[],_=[];if(v="*"===t?Object.keys(l.structures):t.split(","),"*"===s){let e=Object.keys(l.chains);for(let t=0,s=e.length;t<s;++t){f=e[t],g=f.substr(0,f.indexOf("_")),-1!==v.map((function(e){return e.toLowerCase()})).indexOf(g.toLowerCase())&&_.push(f)}}else for(let e=0,t=v.length;e<t;++e){g=v[e];let t=s.split(",");for(let e in t)_.push(g+"_"+t[e])}let S=i.split(",");for(let t=0,s=S.length;t<s;++t){let s,i,o=!1,c=S[t].lastIndexOf("-"),h=!1,m=!1,p=!1;if(-1!==c)b=S[t].substr(0,c),y=S[t].substr(c+1),o=!0;else if("3"===S[t][0]&&S[t].length>1&&(S[t].length-1)%3==0){i=S[t].toUpperCase().substr(1),p=!0}else if(""===S[t]||isNaN(parseInt(S[t]))){if("*"===S[t])h=!0;else if("proteins"!==S[t]&&"nucleotides"!==S[t]&&"chemicals"!==S[t]&&"ions"!==S[t]&&"water"!==S[t]){s=S[t].toUpperCase(),m=!0}}else b=S[t],y=b,o=!0;for(let c=0,u=_.length;c<u;++c)if(f=_[c],o){b=isNaN(b)?b:parseInt(b),y=isNaN(y)?y:parseInt(y);for(let t=b;t<=y;++t){let s=f+"_"+t;0===e?a[s]=1:a.hasOwnProperty(s)||delete a[s];for(let t in l.residues[s])for(let s=0,i=r.length;s<i;++s){let i=r[s];"*"!==i&&i!==l.atoms[t].name||(0===e?d[t]=1:d.hasOwnProperty(t)||delete d[t])}}}else if(f in l.chains){let o=l.chains[f];for(let s in o)if(l.atoms[s].resn.substr(0,3).toUpperCase(),h||"proteins"===S[t]&&s in l.proteins||"nucleotides"===S[t]&&s in l.nucleotides||"chemicals"===S[t]&&s in l.chemicals||"ions"===S[t]&&s in l.ions||"water"===S[t]&&s in l.water){if(0===e)a[f+"_"+l.atoms[s].resi]=1;else{let e=f+"_"+l.atoms[s].resi;a.hasOwnProperty(e)||delete a[e]}for(let t=0,i=r.length;t<i;++t){let i=r[t];"*"!==i&&i!==l.atoms[s].name||(0===e?d[s]=1:d.hasOwnProperty(s)||delete d[s])}}if(m||p){let t=m?1:3,o=m?s:i,c="",h=[];for(let e=0,t=l.chainsSeq[f].length;e<t;++e){if(m)c+=1==l.chainsSeq[f][e].name.length?l.chainsSeq[f][e].name:" ";else if(p){let t=n.utilsCls.residueAbbr2Name(l.chainsSeq[f][e].name);c+=3==t.length?t:"   "}h.push(l.chainsSeq[f][e].resi)}c=c.toUpperCase();let u=o.replace(/x/gi,"."),C=[],g=new RegExp(u,"i"),b=c,y=b.search(g),v=y/t;for(;-1!==y;)C.push(v),b=b.substr(y+t),y=b.search(g),v+=y/t+1;for(let s=0,i=C.length;s<i;++s){let i=C[s];for(let s=0,n=o.length/t;s<n;s+=t){let n=f+"_"+h[s/t+i];0===e?a[n]=1:a.hasOwnProperty(n)||delete a[n];for(let t in l.residues[n])for(let s=0,i=r.length;s<i;++s){let i=r[s];"*"!==i&&i!==l.atoms[t].name||(0===e?d[t]=1:d.hasOwnProperty(t)||delete d[t])}}}}}}}if(l.hAtoms=n.hashUtilsCls.cloneHash(d),0==Object.keys(l.hAtoms).length&&console.log("No residues were selected. Please try another search."),(void 0===i||i)&&l.hlUpdateCls.updateHlAll(),r=c?Object.keys(a):Object.keys(d),""!=t){l.selectionCls.addCustomSelection(r,t,s,e,c);let i=[t];l.definedSetsCls.changeCustomAtoms(i)}}}class _e{constructor(e){this.icn3d=e}residueids2spec(e){var t=this.icn3d;t.icn3dui;let s="";if(void 0!==e){let i,l,n,r,o,a,d,c=e.sort((function(e,t){if(""!==e&&!isNaN(e))return parseInt(e)-parseInt(t);{let s=e.lastIndexOf("_"),i=t.lastIndexOf("_");if(e.substr(0,s)<t.substr(0,i))return-1;if(e.substr(0,s)>t.substr(0,i))return 1;if(e.substr(0,s)==t.substr(0,i)){if(parseInt(e.substr(s+1))<parseInt(t.substr(i+1)))return-1;if(parseInt(e.substr(s+1))>parseInt(t.substr(i+1)))return 1;if(parseInt(e.substr(s+1))==parseInt(t.substr(i+1)))return 0}}})),h="",m=0,p=1!=Object.keys(t.structures).length;for(let e=0,t=c.length;e<t;++e){let t=c[e];if(n=t.lastIndexOf("_"),i=t.substr(0,n),l=t.substr(n+1),r=h.indexOf("_"),o=h.substr(0,r),a=h.substr(r+1),h!==i)e>0&&(s+=m===d?p?"$"+o+"."+a+":"+d+" or ":"."+a+":"+d+" or ":p?"$"+o+"."+a+":"+d+"-"+m+" or ":"."+a+":"+d+"-"+m+" or "),d=l;else if(h===i){l!=(isNaN(m)?m:parseInt(m))+1&&(s+=m===d?p?"$"+o+"."+a+":"+d+" or ":"."+a+":"+d+" or ":p?"$"+o+"."+a+":"+d+"-"+m+" or ":"."+a+":"+d+"-"+m+" or ",d=l)}h=i,m=l}r=h.indexOf("_"),o=h.substr(0,r),a=h.substr(r+1),s+=m===d?p?"$"+o+"."+a+":"+d:"."+a+":"+d:p?"$"+o+"."+a+":"+d+"-"+m:"."+a+":"+d+"-"+m}return s}atoms2spec(e){var t=this.icn3d;t.icn3dui;let s,i="",l=0,n={},r={},o={};for(let a in e)s=t.atoms[a],l>0&&(i+=" or "),i+="$"+s.structure+"."+s.chain+":"+s.resi+"@"+s.name,n[s.structure]=1,r[s.structure+"_"+s.chain]=1,o[s.structure+"_"+s.chain+"_"+s.resi]=1,++l;if(1==Object.keys(o).length){let e="\\$"+s.structure+"\\."+s.chain+":"+s.resi;i=i.replace(new RegExp(e,"g"),"")}else if(1==Object.keys(r).length){let e="\\$"+s.structure+"\\."+s.chain;i=i.replace(new RegExp(e,"g"),"")}else if(1==Object.keys(n).length){let e="\\$"+s.structure;i=i.replace(new RegExp(e,"g"),"")}return i}atoms2residues(e){var t=this.icn3d;t.icn3dui;let s={};for(let t=0,i=e.length;t<i;++t)s[e[t]]=1;let i=t.firstAtomObjCls.getResiduesFromAtoms(s);return Object.keys(i)}atoms2structureArray(e){var t=this.icn3d;t.icn3dui;let s={};for(let i in e){s[t.atoms[i].structure]=1}return Object.keys(s)}selectProperty(e,t,s){var i=this.icn3d,l=i.icn3dui;let n=l.hashUtilsCls.cloneHash(i.hAtoms);if("positive"==e){let e=":r,k,h";i.hAtoms={},i.selByCommCls.selectBySpec(e,e,e)}else if("negative"==e){let e=":d,e";i.hAtoms={},i.selByCommCls.selectBySpec(e,e,e),i.hAtoms=l.hashUtilsCls.unionHash(i.hAtoms,i.nucleotides)}else if("hydrophobic"==e){let e=":w,f,y,l,i,c,m";i.hAtoms={},i.selByCommCls.selectBySpec(e,e,e),i.hAtoms=l.hashUtilsCls.intHash(i.hAtoms,i.proteins)}else if("polar"==e){let e=":g,v,s,t,a,n,p,q";i.hAtoms={},i.selByCommCls.selectBySpec(e,e,e),i.hAtoms=l.hashUtilsCls.intHash(i.hAtoms,i.proteins)}else if("b factor"==e){let e=l.hashUtilsCls.cloneHash(i.calphas);e=l.hashUtilsCls.unionHash(e,i.nucleotidesO3),e=l.hashUtilsCls.unionHash(e,i.chemicals),e=l.hashUtilsCls.unionHash(e,i.ions),e=l.hashUtilsCls.unionHash(e,i.water),i.hAtoms={};for(let n in e){let e=i.atoms[n];e.b>=t&&e.b<=s&&(i.hAtoms=l.hashUtilsCls.unionHash(i.hAtoms,i.residues[e.structure+"_"+e.chain+"_"+e.resi]))}}else if("percent out"==e){i.bCalcArea=!0,i.opts.surface="solvent accessible surface",i.applyMapCls.applySurfaceOptions(),i.bCalcArea=!1,i.hAtoms={};for(let e in i.resid2area){let n=e.lastIndexOf("_"),r=e.substr(n+1);if(l.parasCls.residueArea.hasOwnProperty(r)){let o=parseInt(i.resid2area[e]/l.parasCls.residueArea[r]*100);if(o>=t&&o<=s){let t=e.substr(0,n);i.hAtoms=l.hashUtilsCls.unionHash(i.hAtoms,i.residues[t])}}}}i.hAtoms=l.hashUtilsCls.intHash(i.hAtoms,n),i.drawCls.draw(),i.hlUpdateCls.updateHlAll()}selectComplement(){let e=this.icn3d,t=e.icn3dui,s={};for(let t in e.atoms)e.hAtoms.hasOwnProperty(t)||(s[t]=1);e.hAtoms=t.hashUtilsCls.cloneHash(s),e.hlUpdateCls.updateHlAll()}switchHighlightLevel(){var e=this.icn3d.icn3dui;if(e.bNode)return;let t=this;document.addEventListener("keydown",(function(s){let i=t.icn3d;38===s.keyCode?(s.preventDefault(),0!=Object.keys(i.pickedAtomList).length&&i.hAtoms.hasOwnProperty(i.firstAtomObjCls.getFirstAtomObj(i.pickedAtomList).serial)||(i.pickedAtomList=e.hashUtilsCls.cloneHash(i.hAtoms)),t.switchHighlightLevelUp(),e.htmlCls.clickMenuCls.setLogCmd("highlight level up",!0)):40===s.keyCode&&(s.preventDefault(),0!=Object.keys(i.pickedAtomList).length&&i.hAtoms.hasOwnProperty(i.firstAtomObjCls.getFirstAtomObj(i.pickedAtomList).serial)||(i.pickedAtomList=e.hashUtilsCls.cloneHash(i.hAtoms)),t.switchHighlightLevelDown(),e.htmlCls.clickMenuCls.setLogCmd("highlight level down",!0))}))}switchHighlightLevelUp(){var e=this.icn3d,t=e.icn3dui;if(!t.bNode){if(e.bShift||e.bCtrl||e.hlObjectsCls.removeHlObjects(),void 0!==e.pickedAtomList&&0!==Object.keys(e.pickedAtomList).length||(e.pickedAtomList=t.hashUtilsCls.cloneHash(e.hAtoms)),0===Object.keys(e.pickedAtomList).length&&(e.pickedAtomList=e.dAtoms),1===e.highlightlevel){e.highlightlevel=2;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[s.structure+"_"+s.chain+"_"+s.resi]):e.hAtoms=t.hashUtilsCls.cloneHash(e.residues[s.structure+"_"+s.chain+"_"+s.resi])}else if(2===e.highlightlevel){e.highlightlevel=3;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.pickingCls.selectStrandHelixFromAtom(s)):e.hAtoms=t.hashUtilsCls.cloneHash(e.pickingCls.selectStrandHelixFromAtom(s))}else if(3===e.highlightlevel){let s;if(void 0!==t.cfg.mmdbid||void 0!==t.cfg.gi){e.highlightlevel=4;let i=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);s=e.pickingCls.select3ddomainFromAtom(i),e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,s):e.hAtoms=t.hashUtilsCls.cloneHash(s)}if(void 0===t.cfg.mmdbid&&void 0===t.cfg.gi||0==Object.keys(s).length){e.highlightlevel=5;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[s.structure+"_"+s.chain]):e.hAtoms=t.hashUtilsCls.cloneHash(e.chains[s.structure+"_"+s.chain])}}else if(4===e.highlightlevel){e.highlightlevel=5;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[s.structure+"_"+s.chain]):e.hAtoms=t.hashUtilsCls.cloneHash(e.chains[s.structure+"_"+s.chain])}else if(5===e.highlightlevel||6===e.highlightlevel){e.highlightlevel=6;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl||(e.hAtoms={});let i=e.structures[s.structure];for(let s=0,l=i.length;s<l;++s)e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[i[s]])}e.hlObjectsCls.addHlObjects(),e.hlUpdateCls.updateHlAll()}}switchHighlightLevelDown(){var e=this.icn3d,t=e.icn3dui;if(!t.bNode){if(e.hlObjectsCls.removeHlObjects(),void 0!==e.pickedAtomList&&0!==Object.keys(e.pickedAtomList).length||(e.pickedAtomList=t.hashUtilsCls.cloneHash(e.hAtoms)),2!==e.highlightlevel&&1!==e.highlightlevel||1!==Object.keys(e.pickedAtomList).length){if(3===e.highlightlevel){let s={};for(let t in e.pickedAtomList)residueid=e.atoms[t].structure+"_"+e.atoms[t].chain+"_"+e.atoms[t].resi,s[residueid]=1;if(1===Object.keys(s).length){e.highlightlevel=2;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[s.structure+"_"+s.chain+"_"+s.resi]):e.hAtoms=t.hashUtilsCls.cloneHash(e.residues[s.structure+"_"+s.chain+"_"+s.resi])}}else if(4===e.highlightlevel){e.highlightlevel=3;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.pickingCls.selectStrandHelixFromAtom(s)):e.hAtoms=t.hashUtilsCls.cloneHash(e.pickingCls.selectStrandHelixFromAtom(s))}else if(5===e.highlightlevel){let s;if(void 0!==t.cfg.mmdbid||void 0!==t.cfg.gi){e.highlightlevel=4;let i=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);s=e.pickingCls.select3ddomainFromAtom(i),e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,s):e.hAtoms=t.hashUtilsCls.cloneHash(s)}if(void 0===t.cfg.mmdbid&&void 0===t.cfg.gi||0==Object.keys(s).length){e.highlightlevel=3;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.pickingCls.selectStrandHelixFromAtom(s)):e.hAtoms=t.hashUtilsCls.cloneHash(e.pickingCls.selectStrandHelixFromAtom(s))}}else if(6===e.highlightlevel){e.highlightlevel=5;let s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[s.structure+"_"+s.chain]):e.hAtoms=t.hashUtilsCls.cloneHash(e.chains[s.structure+"_"+s.chain])}}else e.highlightlevel=1,e.hAtoms=t.hashUtilsCls.cloneHash(e.pickedAtomList),e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.pickedAtomList):e.hAtoms=t.hashUtilsCls.cloneHash(e.pickedAtomList);e.hlObjectsCls.addHlObjects(),e.hlUpdateCls.updateHlAll()}}}class Se{constructor(e){this.icn3d=e}setSeqAlign(e,t){let s=this.icn3d,i=s.icn3dui,l=t[0][0].pdbId,n=t[0][1].pdbId;s.conservedName1=l+"_cons",s.nonConservedName1=l+"_ncons",s.notAlignedName1=l+"_nalign",s.conservedName2=n+"_cons",s.nonConservedName2=n+"_ncons",s.notAlignedName2=n+"_nalign",s.consHash1={},s.nconsHash1={},s.nalignHash1={},s.consHash2={},s.nconsHash2={},s.nalignHash2={};for(let t=0,r=e.length;t<r;++t){let r=e[t][0],o=r.moleculeId,a=s.pdbid_molid2chain[l+"_"+o],d=l+"_"+a,c={},h=r.sequence.length,m=-1,p=!1;for(let e=0,t=r.sequence.length;e<t;++e){let t=s.chainid2offset[d]?s.chainid2offset[d]:0,i=s.bUsePdbNum?r.sequence[e][0]+t:r.sequence[e][0],l="~"===r.sequence[e][2]?"-":r.sequence[e][2];l=" "===l||""===l?"X":l;let n=r.sequence[e][3]?1:0;1==n&&(e<h&&!p&&(h=e,p=!0),e>m&&(m=e)),c[e]={resi:i,resn:l,aligned:n}}r=e[t][1];let u=r.moleculeId,C=s.pdbid_molid2chain[n+"_"+u],g=n+"_"+C;void 0===s.alnChainsAnTtl[d]&&(s.alnChainsAnTtl[d]=[]),void 0===s.alnChainsAnTtl[d][0]&&(s.alnChainsAnTtl[d][0]=[]),void 0===s.alnChainsAnTtl[d][1]&&(s.alnChainsAnTtl[d][1]=[]),void 0===s.alnChainsAnTtl[d][2]&&(s.alnChainsAnTtl[d][2]=[]),void 0===s.alnChainsAnTtl[d][3]&&(s.alnChainsAnTtl[d][3]=[]),void 0===s.alnChainsAnTtl[d][4]&&(s.alnChainsAnTtl[d][4]=[]),void 0===s.alnChainsAnTtl[d][5]&&(s.alnChainsAnTtl[d][5]=[]),void 0===s.alnChainsAnTtl[d][6]&&(s.alnChainsAnTtl[d][6]=[]),s.alnChainsAnTtl[d][0].push(g),s.alnChainsAnTtl[d][1].push(d),s.alnChainsAnTtl[d][2].push(""),s.alnChainsAnTtl[d][3].push(""),s.alnChainsAnTtl[d][4].push(g),s.alnChainsAnTtl[d][5].push(d),s.alnChainsAnTtl[d][6].push("");let f=1;s.chainsMapping[d]||(s.chainsMapping[d]={}),s.chainsMapping[g]||(s.chainsMapping[g]={});for(let e=h;e<=m;++e){let t,o,m,p=s.chainid2offset[g]?s.chainid2offset[g]:0,u=s.bUsePdbNum?r.sequence[e][0]+p:r.sequence[e][0],b="~"===r.sequence[e][2]?"-":r.sequence[e][2],y=r.sequence[e][3]?1:0,v=c[e].aligned+y;2===v?(c[e].resn===b?(t="#FF0000",m="icn3d-cons",s.consHash1[d+"_"+c[e].resi]=1,s.consHash2[g+"_"+u]=1):(t="#0000FF",m="icn3d-ncons",s.nconsHash1[d+"_"+c[e].resi]=1,s.nconsHash2[g+"_"+u]=1),s.chainsMapping[d][d+"_"+c[e].resi]=c[e].resn+c[e].resi,s.chainsMapping[g][g+"_"+u]=c[e].resn+c[e].resi,o="#"+s.showAnnoCls.getColorhexFromBlosum62(c[e].resn,b)):(t=i.htmlCls.GREY8,m="icn3d-nalign",s.nalignHash1[d+"_"+c[e].resi]=1,s.nalignHash2[g+"_"+u]=1),void 0===s.alnChainsSeq[d]&&(s.alnChainsSeq[d]=[]);let _={};_.mmdbid=l,_.chain=a,_.resi=c[e].resi,_.resn=""===_.resi||"icn3d-nalign"===m?c[e].resn.toLowerCase():c[e].resn,_.aligned=v,_.color=""===_.resi?i.htmlCls.GREYC:t,_.color2=""===_.resi?i.htmlCls.GREYC:o,_.class=m,s.alnChainsSeq[d].push(_),""!==c[e].resi&&(void 0===s.alnChains[d]&&(s.alnChains[d]={}),$.extend(s.alnChains[d],s.residues[d+"_"+c[e].resi])),void 0===s.alnChainsSeq[g]&&(s.alnChainsSeq[g]=[]),_={},_.mmdbid=n,_.chain=C,_.resi=u,_.resn=""===_.resi||"icn3d-nalign"===m?b.toLowerCase():b,_.aligned=v,_.color=""===_.resi?i.htmlCls.GREYC:t,_.color2=""===_.resi?i.htmlCls.GREYC:o,_.class=m,s.alnChainsSeq[g].push(_),""!==_.resi&&(void 0===s.alnChains[g]&&(s.alnChains[g]={}),$.extend(s.alnChains[g],s.residues[g+"_"+u])),void 0===s.alnChainsAnno[d]&&(s.alnChainsAnno[d]=[]),void 0===s.alnChainsAnno[d][0]&&(s.alnChainsAnno[d][0]=[]),void 0===s.alnChainsAnno[d][1]&&(s.alnChainsAnno[d][1]=[]),void 0===s.alnChainsAnno[d][2]&&(s.alnChainsAnno[d][2]=[]),void 0===s.alnChainsAnno[d][3]&&(s.alnChainsAnno[d][3]=[]),e===h&&(void 0===s.alnChainsAnno[d][4]&&(s.alnChainsAnno[d][4]=[]),void 0===s.alnChainsAnno[d][5]&&(s.alnChainsAnno[d][5]=[]),void 0===s.alnChainsAnno[d][6]&&(s.alnChainsAnno[d][6]=[]),s.alnChainsAnno[d][4].push(s.pdbid_chain2title[g]),s.alnChainsAnno[d][5].push(s.pdbid_chain2title[d]),s.alnChainsAnno[d][6].push(""));let S=d+"_"+c[e].resi,w=g+"_"+u,A=s.secondaries[S],x=s.secondaries[w];void 0!==x?s.alnChainsAnno[d][0].push(x):s.alnChainsAnno[d][0].push("-"),void 0!==A?s.alnChainsAnno[d][1].push(A):s.alnChainsAnno[d][1].push("-");let k=".";f%5==0&&(k="*"),f%10==0&&(k="|"),s.alnChainsAnno[d][2].push(k);let O="";f%10==0&&(O=f.toString()),s.alnChainsAnno[d][3].push(O),++f}}e={}}setSeqAlignChain(e,t,s){let i,l,n,r,o,a,d,c,h,m,p,u,C,g=this.icn3d,f=g.icn3dui,b={};if(s){if(o=s[1],a=s[0],t=s[2],d=o.indexOf("_"),c=a.indexOf("_"),i=o.substr(0,d).toUpperCase(),l=a.substr(0,c).toUpperCase(),n=o.substr(d+1),r=a.substr(d+1),i==l&&n==r){let e=g.chainsSeq[l+"_"+r].length;g.qt_start_end[t]={q_start:1,q_end:e,t_start:1,t_end:e}}void 0!==l&&l===i&&(a=l+f.htmlCls.postfix+"_"+r)}else{let s=g.chainidArray[0].indexOf("_"),d=e.indexOf("_");if(i=g.mmdbid_t,l=e.substr(0,d).toUpperCase(),n=g.chainidArray[0].substr(s+1),r=e.substr(d+1),i==l&&n==r){let e=g.chainsSeq[g.mmdbid_q+"_"+g.chain_q].length;g.qt_start_end[t]={q_start:1,q_end:e,t_start:1,t_end:e}}o=i+"_"+n,a=l+"_"+r,void 0!==l&&l===g.mmdbid_t&&(a=l+f.htmlCls.postfix+"_"+r)}g.conservedName1=o+"_cons",g.nonConservedName1=o+"_ncons",g.notAlignedName1=o+"_nalign",g.conservedName2=a+"_cons",g.nonConservedName2=a+"_ncons",g.notAlignedName2=a+"_nalign",g.consHash1={},g.nconsHash1={},g.nalignHash1={},g.consHash2={},g.nconsHash2={},g.nalignHash2={},g.alnChains={},g.alnChainsSeq[o]=[],g.alnChains[o]={},g.alnChainsAnno[o]=[],g.alnChainsAnTtl[o]=[],void 0===g.alnChainsAnTtl[o]&&(g.alnChainsAnTtl[o]=[]);for(let e=0;e<7;++e)void 0===g.alnChainsAnTtl[o][e]&&(g.alnChainsAnTtl[o][e]=[]);if(g.alnChainsAnTtl[o][0].push(a),g.alnChainsAnTtl[o][1].push(o),g.alnChainsAnTtl[o][2].push(""),g.alnChainsAnTtl[o][3].push(""),g.alnChainsAnTtl[o][4].push(a),g.alnChainsAnTtl[o][5].push(o),g.alnChainsAnTtl[o][6].push(""),void 0===g.qt_start_end[t])return;let y=1;g.chainsMapping[o]||(g.chainsMapping[o]={}),g.chainsMapping[a]||(g.chainsMapping[a]={});for(let e=0,s=g.qt_start_end[t].length;e<s;++e){let s=g.qt_start_end[t][e].t_start-1,i=g.qt_start_end[t][e].q_start-1,l=g.qt_start_end[t][e].t_end-1,n=g.qt_start_end[t][e].q_end-1;if(e>0){let e=y;for(let t=u+1,i=s;t<i&&void 0!==g.chainsSeq[o];++t){let s=g.chainsSeq[o][t].resi,i=g.chainsSeq[o][t].name.toLowerCase();h=f.htmlCls.GREY8,p="icn3d-nalign",g.nalignHash1[o+"_"+s]=1,this.setSeqPerResi(o,o,a,s,i,!1,h,void 0,p,!0,!1,e),++e}let t=y;for(let e=C+1,s=i;e<s&&void 0!==g.chainsSeq[a];++e){let s=g.chainsSeq[a][e].resi,i=g.chainsSeq[a][e].name.toLowerCase();h=f.htmlCls.GREY8,p="icn3d-nalign",g.nalignHash2[a+"_"+s]=1,this.setSeqPerResi(a,o,a,s,i,!1,h,void 0,p,!1,!1,t),++t}if(e<t){y=t;for(let s=0;s<t-e;++s){let t="",i="-";h=f.htmlCls.GREY8,p="icn3d-nalign",this.setSeqPerResi(o,o,a,t,i,!1,h,void 0,p,!0,!1,e+s)}}else{y=e;for(let s=0;s<e-t;++s){let e="",i="-";h=f.htmlCls.GREY8,p="icn3d-nalign",this.setSeqPerResi(a,o,a,e,i,!1,h,void 0,p,!1,!1,t+s)}}}for(let t=0;t<=l-s&&(void 0!==g.chainsSeq[o]&&void 0!==g.chainsSeq[a]);++t){if(void 0===g.chainsSeq[o][t+s]||void 0===g.chainsSeq[a][t+i])continue;let l=g.chainsSeq[o][t+s].resi,n=g.chainsSeq[a][t+i].resi,r=g.chainsSeq[o][t+s].name.toUpperCase(),d=g.chainsSeq[a][t+i].name.toUpperCase();r===d?(h="#FF0000",p="icn3d-cons",g.consHash1[o+"_"+l]=1,g.consHash2[a+"_"+n]=1):(h="#0000FF",p="icn3d-ncons",g.nconsHash1[o+"_"+l]=1,g.nconsHash2[a+"_"+n]=1),b=f.hashUtilsCls.unionHash(b,g.residues[o+"_"+l]),b=f.hashUtilsCls.unionHash(b,g.residues[a+"_"+n]),g.chainsMapping[o][o+"_"+l]=r+l,g.chainsMapping[a][a+"_"+n]=r+l,m="#"+g.showAnnoCls.getColorhexFromBlosum62(r,d);let c=0===e&&0===t;this.setSeqPerResi(o,o,a,l,r,!0,h,m,p,!0,c,y),this.setSeqPerResi(a,o,a,n,d,!0,h,m,p,!1,c,y),++y}u=l,C=n}return b}setSeqAlignForRealign(e,t,s){let i=this.icn3d,l=i.icn3dui,n=e.substr(0,e.indexOf("_")),r=t.substr(0,t.indexOf("_"));n==r&&(r+=l.htmlCls.postfix),i.conservedName1=n+"_cons",i.conservedName2=r+"_cons",i.consHash1={},i.consHash2={},i.alnChainsAnTtl={},i.alnChainsAnno={},void 0===i.alnChainsSeq&&(i.alnChainsSeq={}),i.alnChains={},i.alnChainsSeq[e]=[],i.alnChains[e]={},i.alnChainsAnno[e]=[],i.alnChainsAnTtl[e]=[],i.alnChainsSeq[t]=[],i.alnChains[t]={};let o={};i.chainsMapping[e]||(i.chainsMapping[e]={}),i.chainsMapping[t]||(i.chainsMapping[t]={});for(let s=0,a=i.realignResid[n].length;s<a;++s){let a=i.realignResid[n][s],d=a.resid.lastIndexOf("_"),c=a.resid.substr(0,d),h=a.resid.substr(d+1);a.resi=h,a.aligned=!0;let m,p=i.realignResid[r][s],u=p.resid.lastIndexOf("_"),C=p.resid.substr(0,u),g=p.resid.substr(u+1);p.resi=g,p.aligned=!0,o[a.resid]=1,o[p.resid]=1,m=a.resn.toUpperCase()==p.resn.toUpperCase()?"#FF0000":"#0000FF",i.chainsMapping[e][e+"_"+a.resi]=a.resn+a.resi,i.chainsMapping[t][t+"_"+p.resi]=a.resn+a.resi;let f="#"+i.showAnnoCls.getColorhexFromBlosum62(a.resn,p.resn);a.color=m,p.color=m,a.color2=f,p.color2=f;for(let e in i.residues[a.resid])i.atoms[e].color=l.parasCls.thr(m);for(let e in i.residues[p.resid])i.atoms[e].color=l.parasCls.thr(m);void 0===i.alnChainsAnTtl[c]&&(i.alnChainsAnTtl[c]=[]);for(let e=0;e<3;++e)void 0===i.alnChainsAnTtl[c][e]&&(i.alnChainsAnTtl[c][e]=[]);for(let e=0;e<3;++e)i.alnChainsAnTtl[c][e].push("");void 0===i.alnChainsSeq[c]&&(i.alnChainsSeq[c]=[]),void 0===i.alnChainsSeq[C]&&(i.alnChainsSeq[C]=[]),i.alnChainsSeq[c].push(a),i.alnChainsSeq[C].push(p),void 0===i.alnChains[c]&&(i.alnChains[c]={}),void 0===i.alnChains[C]&&(i.alnChains[C]={}),$.extend(i.alnChains[c],i.residues[c+"_"+a.resi]),$.extend(i.alnChains[C],i.residues[C+"_"+p.resi]),i.consHash1[c+"_"+a.resi]=1,i.consHash2[C+"_"+p.resi]=1,void 0===i.alnChainsAnno[c]&&(i.alnChainsAnno[c]=[]);for(let e=0;e<3;++e)void 0===i.alnChainsAnno[c][e]&&(i.alnChainsAnno[c][e]=[]);let b=".";s%5==0&&(b="*"),s%10==0&&(b="|"),i.alnChainsAnno[c][0].push(b);let y="";s%10==0&&(y=s.toString()),i.alnChainsAnno[c][1].push(y)}let a="select "+i.resid2specCls.residueids2spec(Object.keys(o));i.selectionCls.addCustomSelection(Object.keys(o),"protein_aligned","protein aligned",a,!0)}setSeqPerResi(e,t,s,i,l,n,r,o,a,d,c,h){let m=this.icn3d,p=m.icn3dui;void 0===m.alnChainsSeq[e]&&(m.alnChainsSeq[e]=[]);let u={},C=e.indexOf("_");if(u.mmdbid=e.substr(0,C),u.chain=e.substr(C+1),u.resi=i,u.resn=""===u.resi||"icn3d-nalign"===a?l.toLowerCase():l,u.aligned=n,u.color=""===u.resi?p.htmlCls.GREYC:r,u.color2=""===u.resi?p.htmlCls.GREYC:o,u.class=a,m.alnChainsSeq[e].push(u),""!==u.resi&&(void 0===m.alnChains[e]&&(m.alnChains[e]={}),$.extend(m.alnChains[e],m.residues[e+"_"+u.resi])),d){if(void 0===m.alnChainsAnno[e]&&(m.alnChainsAnno[e]=[]),void 0===m.alnChainsAnno[e][0]&&(m.alnChainsAnno[e][0]=[]),void 0===m.alnChainsAnno[e][1]&&(m.alnChainsAnno[e][1]=[]),void 0===m.alnChainsAnno[e][2]&&(m.alnChainsAnno[e][2]=[]),void 0===m.alnChainsAnno[e][3]&&(m.alnChainsAnno[e][3]=[]),c){void 0===m.alnChainsAnno[e][4]&&(m.alnChainsAnno[e][4]=[]),void 0===m.alnChainsAnno[e][5]&&(m.alnChainsAnno[e][5]=[]),void 0===m.alnChainsAnno[e][6]&&(m.alnChainsAnno[e][6]=[]);let t=m.pdbid_chain2title&&m.pdbid_chain2title.hasOwnProperty(s)?m.pdbid_chain2title[s]:"",i=m.pdbid_chain2title&&m.pdbid_chain2title.hasOwnProperty(e)?m.pdbid_chain2title[e]:"";m.alnChainsAnno[e][4].push(t),m.alnChainsAnno[e][5].push(i),m.alnChainsAnno[e][6].push("")}let t=".";h%5==0&&(t="*"),h%10==0&&(t="|"),m.alnChainsAnno[e][2].push(t);let l="";h%10==0&&(l=h.toString()),m.alnChainsAnno[e][3].push(l);let n=e+"_"+i,r=m.secondaries[n];void 0!==r?m.alnChainsAnno[e][1].push(r):m.alnChainsAnno[e][1].push("-")}else{let s=e+"_"+i,l=m.secondaries[s];m.alnChainsAnno.hasOwnProperty(t)&&m.alnChainsAnno[t].length>0?void 0!==l?m.alnChainsAnno[t][0].push(l):m.alnChainsAnno[t][0].push("-"):console.log("Error: ic.alnChainsAnno[chainid1] is undefined")}}}class we{constructor(e){this.icn3d=e}alignCoords(e,t,s,i,l,n,r,o){let a=this.icn3d,d=a.icn3dui,c=e.length<t.length?e.length:t.length,h={};if(c<4&&alert("Please select at least four residues in each structure..."),c>=4&&(a.rmsd_suprTmp=d.rmsdSuprCls.getRmsdSuprCls(e,t,c),void 0!==a.rmsd_suprTmp.rot)){let e=a.rmsd_suprTmp.rot;null===e[0]&&alert("Please select more residues in each structure...");let t=a.rmsd_suprTmp.trans1,i=a.rmsd_suprTmp.trans2,c=a.rmsd_suprTmp.rmsd;c&&(d.htmlCls.clickMenuCls.setLogCmd("realignment RMSD: "+c.toPrecision(4),!1),$("#"+a.pre+"realignrmsd").val(c.toPrecision(4)),d.cfg.bSidebyside||d.htmlCls.dialogCls.openDlg("dl_rmsd","Realignment RMSD"));let m={};for(let l=0,n=a.structures[s].length;l<n;++l){let n=a.structures[s][l];if(!m.hasOwnProperty(n)){for(let s in a.chains[n]){let l=a.atoms[s];l.coord=a.surfaceCls.transformMemPro(l.coord,e,t,i)}m[n]=1}}a.bRealign=!0,a.setSeqAlignCls.setSeqAlignForRealign(l,n,r);let p=!1,u=d.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(a.alnChains),void 0,void 0,p),C=1===r?"":$("#"+a.pre+"dl_sequence2").html();$("#"+a.pre+"dl_sequence2").html(C+u.sequencesHtml),$("#"+a.pre+"dl_sequence2").width(d.htmlCls.RESIDUE_WIDTH*u.maxSeqCnt+200),d.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),o||(a.opts.color="identity",a.setColorCls.setColorByOptions(a.opts,a.hAtoms)),h=a.hAtoms}return h}getMissingResidues(e,t,s){let i=this.icn3d,l=i.icn3dui;if(i.chainsSeq[s]=[],"mmdbid"===t||"align"===t)for(let t=0,s=e.length;t<s;++t)if(0!=e[t][0]){e[t][0];break}let n=0;for(let r=0,o=e.length;r<o;++r){let o,a;"mmdbid"===t?(o=e[r][1],a=0):"mmcifid"===t?(o=e[r][1],o=l.utilsCls.residueName2Abbr(o),a=0):"align"===t&&(o=e[r][1],a=0),""===o&&(o="x");let d={};if(i.bUsePdbNum){let l=i.chainid2offset[s]?i.chainid2offset[s]:0;d.resi="mmdbid"===t||"align"===t?"0"==e[r][a]?r+1+l:e[r][a]:"0"==e[r][a]?parseInt(n)+1:e[r][a]}else d.resi=r+1;d.name="align"===t?o.toLowerCase():o,i.chainsSeq[s].push(d),n=d.resi}}set2DDiagramsForAlign(e,t){let s=this.icn3d,i=s.icn3dui;i.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions");let l=i.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+e+"&intrac=1",n=i.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+t+"&intrac=1";void 0!==i.cfg.inpara&&(l+=i.cfg.inpara,n+=i.cfg.inpara),$.ajax({url:l,dataType:"jsonp",cache:!0}).then((function(t){return s.interactionData1=t,s.html2ddgm="",s.diagram2dCls.draw2Ddgm(t,e,0),i.cfg.show2d&&i.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),$.ajax({url:n,dataType:"jsonp",cache:!0})})).done((function(e){s.interactionData2=e,s.diagram2dCls.draw2Ddgm(e,t,1),s.html2ddgm+="<br>"+s.diagram2dCls.set2DdgmNote(!0),$("#"+s.pre+"dl_2ddgm").html(s.html2ddgm),s.b2DShown=!0,void 0!==s.deferredViewinteraction&&s.deferredViewinteraction.resolve()}))}set2DDiagramsForChainalign(e){let t=this.icn3d.icn3dui,s=this;t.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions");let i=[];for(let s=0,l=e.length;s<l;++s){let l=e[s].indexOf("_"),n=e[s].substr(0,l).toUpperCase(),r=t.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+n+"&intrac=1";void 0!==t.cfg.inpara&&(r+=t.cfg.inpara);let o=$.ajax({url:r,dataType:"jsonp",cache:!0});i.push(o)}$.when.apply(void 0,i).then((function(){let t=1==e.length?[arguments]:Array.from(arguments);s.parse2DDiagramsData(t,e)})).fail((function(){}))}parse2DDiagramsData(e,t){let s=this.icn3d,i=s.icn3dui;s.html2ddgm="";for(let i=0,l=t.length;i<l;++i){let l=e[i][0],n=t[i].substr(0,t[i].indexOf("_"));s.diagram2dCls.draw2Ddgm(l,n,0)}s.html2ddgm+="<br>"+s.diagram2dCls.set2DdgmNote(!0),s.b2DShown=!0,$("#"+s.pre+"dl_2ddgm").html(s.html2ddgm),i.cfg.show2d&&i.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),void 0!==s.deferredViewinteraction&&s.deferredViewinteraction.resolve()}download2Ddgm(e,t){this.set2DDiagrams(e)}set2DDiagrams(e){let t=this.icn3d;t.icn3dui.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),void 0!==t.b2DShown&&t.b2DShown||(t.html2ddgm="",t.diagram2dCls.draw2Ddgm(t.interactionData,e),t.html2ddgm+="<br>"+t.diagram2dCls.set2DdgmNote(),$("#"+t.pre+"dl_2ddgm").html(t.html2ddgm)),t.b2DShown=!0}showLoading(){let e=this.icn3d;e.icn3dui,$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").show(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").hide(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").hide()}hideLoading(){let e=this.icn3d;e.icn3dui,$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").hide(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").show(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").show()}setYourNote(e){let t=this.icn3d,s=t.icn3dui;t.yournote=e,$("#"+t.pre+"yournote").val(t.yournote),s.cfg.shownote&&(document.title=t.yournote)}transformToOpmOri(e){let t=this.icn3d;if(t.icn3dui,void 0!==t.rmsd_supr&&void 0!==t.rmsd_supr.rot){let s=t.rmsd_supr.rot,i=t.rmsd_supr.trans1,l=t.rmsd_supr.trans2;t.rmsd_supr.rmsd;let n=0;for(let e in t.atoms){let r=t.atoms[e];r.coord=t.surfaceCls.transformMemPro(r.coord,s,i,l);let o=r.coord.x*r.coord.x+r.coord.y*r.coord.y;Math.abs(r.coord.z)<=25&&o>n&&(n=o)}this.addMemAtoms(t.halfBilayerSize,e,Math.sqrt(n)),t.bStopRotate=!0,t.bOpm=!0,$("#"+t.pre+"togglememli").show(),$("#"+t.pre+"adjustmemli").show(),$("#"+t.pre+"selectplaneli").show(),$("#"+t.pre+"anno_transmemli").show()}else t.bOpm=!1}transformToOpmOriForAlign(e,t,s){let i=this.icn3d,l=i.icn3dui;if(void 0!==t){let n=i.loadPDBCls.getChainCalpha(i.chains,i.atoms,s,e),r=1==Object.keys(n.chainresiCalphaHash).length||1==Object.keys(t.chainresiCalphaHash).length,o=[],a=[];for(let e in n.chainresiCalphaHash)if(t.chainresiCalphaHash.hasOwnProperty(e)){let s=n.chainresiCalphaHash[e],i=t.chainresiCalphaHash[e];if((s.length==i.length||r)&&(o=o.concat(s),a=a.concat(i)),o.length>500)break}let d=o.length<a.length?o.length:a.length;if(d>=4)if(i.rmsd_supr=l.rmsdSuprCls.getRmsdSuprCls(o,a,d),void 0!==i.rmsd_supr.rot&&i.rmsd_supr.rmsd<.1){let s=i.rmsd_supr.rot,n=i.rmsd_supr.trans1,r=i.rmsd_supr.trans2,o=i.rmsd_supr.rmsd;l.htmlCls.clickMenuCls.setLogCmd("RMSD of alignment to OPM: "+o.toPrecision(4),!1),$("#"+i.pre+"realignrmsd").val(o.toPrecision(4)),l.cfg.bSidebyside||l.htmlCls.dialogCls.openDlg("dl_rmsd","RMSD of alignment to OPM");let a=0;for(let e in i.atoms){let t=i.atoms[e];t.coord=i.surfaceCls.transformMemPro(t.coord,s,n,r);let l=t.coord.x*t.coord.x+t.coord.y*t.coord.y;Math.abs(t.coord.z)<=25&&l>a&&(a=l)}i.center=t.center,i.oriCenter=i.center.clone(),this.addMemAtoms(i.halfBilayerSize,e,Math.sqrt(a)),i.bStopRotate=!0,i.bOpm=!0,$("#"+i.pre+"togglememli").show(),$("#"+i.pre+"adjustmemli").show(),$("#"+i.pre+"selectplaneli").show(),$("#"+i.pre+"anno_transmemli").show()}else i.bOpm=!1;else i.bOpm=!1}}addOneDumAtom(e,t,s,i,l,n){let r=this.icn3d,o=r.icn3dui,a={het:!0,serial:++n,name:t,alt:void 0,resn:"DUM",structure:e,chain:"MEM",resi:1,coord:new THREE.Vector3(s,i,l),b:void 0,elem:t,bonds:[],ss:"",ssbegin:!1,ssend:!1,color:o.parasCls.atomColors[t]};return r.atoms[n]=a,r.chains[e+"_MEM"][n]=1,r.residues[e+"_MEM_1"][n]=1,r.chemicals[n]=1,r.dAtoms[n]=1,r.hAtoms[n]=1,n}addMemAtoms(e,t,s){let i=this.icn3d;if(i.icn3dui,!t)return;t=t?t.toUpperCase():"STRU",i.structures[t].push(t+"_MEM"),i.chains[t+"_MEM"]={},i.residues[t+"_MEM_1"]={},i.chainsSeq[t+"_MEM"]=[{name:"DUM",resi:1}];let l=Object.keys(i.atoms).length;for(let e=0;e<1e3;++e)if(!i.atoms.hasOwnProperty(l+e)){l=l+e-1;break}for(let i=0;i<81;++i)for(let n=0;n<81;++n){let r=2*i-80,o=2*n-80;if(Math.sqrt(r*r+o*o)<s){let s=-e-.4;l=this.addOneDumAtom(t,"N",r,o,s,l),s=e+.4,l=this.addOneDumAtom(t,"O",r,o,s,l)}}}setMaxD(){let e=this.icn3d;e.icn3dui;let t=new THREE.Vector3(9999,9999,9999),s=new THREE.Vector3(-9999,-9999,-9999),i=new THREE.Vector3,l=0;for(let n in e.atoms){let r=e.atoms[n],o=r.coord;i.add(o),t.min(o),s.max(o),++l,r.het&&(0==r.bonds.length?e.ions[r.serial]=1:e.chemicals[r.serial]=1)}e.pmin=t,e.pmax=s,e.cnt=l,e.center=this.getGeoCenter(e.pmin,e.pmax),e.maxD=this.getStructureSize(e.atoms,e.pmin,e.pmax,e.center),e.maxD<5&&(e.maxD=5),e.oriMaxD=e.maxD,e.oriCenter=e.center.clone()}renderStructure(){let e=this.icn3d,t=e.icn3dui;if(e.bInitial){if(e.bOpm&&(void 0!==t.cfg.align||void 0!==t.cfg.chainalign)){let s=e.selectedPdbid+"_MEM_1";for(let i in e.residues[s]){let s=e.atoms[i];s.style="stick",s.color=t.parasCls.atomColors[s.name],e.atomPrevColors[i]=s.color,e.dAtoms[i]=1}}if(void 0!==t.cfg.command&&""!==t.cfg.command?(e.bRender=!1,e.drawCls.draw()):(e.selectionCls.oneStructurePerWindow(),e.drawCls.draw()),e.bOpm){let t=new THREE.Vector3(1,0,0),s=-.5*Math.PI;e.transformCls.setRotation(t,s)}$("#"+e.pre+"alternate").show()}else e.selectionCls.saveSelectionIfSelected(),e.drawCls.draw();if(!e.bCommandLoad&&e.bInitial&&void 0!==t.cfg.command&&""!==t.cfg.command){if(1==Object.keys(e.structures).length){let s=Object.keys(e.structures)[0];t.cfg.command=t.cfg.command.replace(new RegExp("!","g"),s+"_")}void 0===t.cfg.mmdbafid&&e.loadScriptCls.loadScript(t.cfg.command)}else void 0!==t.deferred&&t.deferred.resolve(),void 0!==e.deferred2&&e.deferred2.resolve();Object.keys(e.structures).length>=2?($("#"+e.pre+"mn2_alternateWrap").show(),$("#"+e.pre+"mn2_realignWrap").show()):($("#"+e.pre+"mn2_alternateWrap").hide(),$("#"+e.pre+"mn2_realignWrap").hide()),setTimeout((function(){if(e.bInitial){if(t.cfg.showsets&&e.definedSetsCls.showSets(),void 0!==t.cfg.align||void 0!==t.cfg.chainalign){let s=e.pre+"selection";if($("#"+s).show(),$("#"+s+"_expand").hide(),$("#"+s+"_shrink").show(),void 0!==t.cfg.align){let s=!1,i=t.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(e.alnChains),void 0,void 0,s);$("#"+e.pre+"dl_sequence2").html(i.sequencesHtml),$("#"+e.pre+"dl_sequence2").width(t.htmlCls.RESIDUE_WIDTH*i.maxSeqCnt+200)}}if(t.cfg.showanno){let s="view annotations";t.htmlCls.clickMenuCls.setLogCmd(s,!0),e.showAnnoCls.showAnnotations()}t.cfg.closepopup&&e.resizeCanvasCls.closeDialogs()}else e.hlUpdateCls.updateHlAll();$("#"+e.pre+"atomsCustom").length>0&&$("#"+e.pre+"atomsCustom")[0].blur(),e.bInitial=!1}),0)}getMassCenter(e,t){return this.icn3d.icn3dui,e.multiplyScalar(1/t)}getGeoCenter(e,t){return this.icn3d.icn3dui,e.clone().add(t).multiplyScalar(.5)}getStructureSize(e,t,s,i){let l=this.icn3d;l.icn3dui;let n=0;for(let r in e){let e=l.atoms[r].coord;if(Math.round(t.x)==Math.round(e.x)||Math.round(t.y)==Math.round(e.y)||Math.round(t.z)==Math.round(e.z)||Math.round(s.x)==Math.round(e.x)||Math.round(s.y)==Math.round(e.y)||Math.round(s.z)==Math.round(e.z)){let t=2*e.distanceTo(i);t>n&&(n=t)}}return n}}class Ae{constructor(e){this.icn3d=e}downloadMmcif(e){let t,s,i=this.icn3d,l=i.icn3dui,n=this;t="https://files.rcsb.org/view/"+e+".cif",s="text",i.bCid=void 0,i.ParserUtilsCls.setYourNote(e.toUpperCase()+"(MMCIF) in iCn3D"),$.ajax({url:t,dataType:"text",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(s){t=l.htmlCls.baseUrl+"mmcifparser/mmcifparser.cgi",$.ajax({url:t,type:"POST",data:{mmciffile:s},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(t){n.loadMmcifData(t,e)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}downloadMmcifSymmetry(e,t){let s=this.icn3d;s.icn3dui;let i=this;return s.deferredSymmetry=$.Deferred((function(){i.downloadMmcifSymmetryBase(e,t)})),s.deferredSymmetry.promise()}downloadMmcifSymmetryBase(e,t){let s,i,l=this.icn3d,n=l.icn3dui,r=this;s="https://files.rcsb.org/header/"+e+".cif",i="text",l.bCid=void 0,$.ajax({url:s,dataType:"text",cache:!0,tryCount:0,retryLimit:0,success:function(i){if(n.cfg.notebook){let s=i.split("\n"),o=!1,a=!1,d=!1,c=!1,h=0,m="",p="",u=!1,C=!1,g="",f="";for(let e in s){let t=s[e];if("EMDB  EMD-"==t.substr(0,10))l.emd=t.substr(6).trim();else if("_entity_src_nat.common_name"==t.substr(0,27))l.organism=t.substr(27).trim(),l.organism&&(o=!0),a=!0;else if(a&&!o&&"_entity_src_nat.details"==f.substr(0,23)){let e=t.split(/\s+/);l.organism=e.length>5?e[5]:"",o=!0}else if("_pdbx_struct_oper_list.vector"==f.substr(0,29)&&t.split(/\s+/).length>2){c=!0,++h;let e=t.indexOf(" "),s=t.indexOf("' ");p+=t.substr(0,e)+t.substr(s+1),m+="["}else if(c&&"#"==t.trim())"["!=m&&(m=m.substr(0,m.length-1)),m+="]",d=!0,c=!1;else if(c&&!d)if(++h,h%2==0){p+=t;let e=p.split(/\s+/);if("X0"!=e[0]&&"P"!=e[0]&&e.length>14){let t=e[3],s=e[4],i=e[5],l=e[6],n=e[7],r=e[8],o=e[9],a=e[10];m+="["+t+","+n+","+e[11]+", 0, "+s+","+r+","+e[12]+", 0, "+i+","+o+","+e[13]+", 0, "+l+","+a+","+e[14]+", 1],"}p=""}else{let e=t.indexOf(" "),s=t.indexOf("' ");p+=t.substr(0,e)+t.substr(s+1)}else if(C&&"#"==t.trim())"["!=g&&(g=g.substr(0,g.length-1)),g+="]",u=!0,C=!1;else if("_pdbx_poly_seq_scheic.hetero"==f.trim()||C&&!u){"_pdbx_poly_seq_scheic.hetero"==f.trim()&&(C=!0,g+="[");let e=t.split(/\s+/),s=e[3],i=e[9],l=e[5];"?"==e[6]&&(g+='{"resn": "'+s+'", "chain": "'+i+'", "resi": '+l+"},")}if(o&&d&&u)break;f=t}l.bAssemblyUseAsu&&r.loadMmcifSymmetry(JSON.parse(m)),""==g&&(g="[]");let b=JSON.parse(g);if("mmtfid"===t&&void 0!==b){let t=0,s="";for(let i=0,r=b.length;i<r;++i){let r=b[i].resn,o=b[i].chain,a=b[i].resi,d=e+"_"+o;void 0===l.chainMissingResidueArray[d]&&(l.chainMissingResidueArray[d]=[]);let c={};c.resi=a,c.name=n.utilsCls.residueName2Abbr(r).toLowerCase(),o!=s&&(t=0),!isNaN(a)&&(""==s||o!=s||o==s&&a>t)&&(l.chainMissingResidueArray[d].push(c),t=a,s=o)}l.loadPDBCls.adjustSeq(l.chainMissingResidueArray)}void 0!==l.deferredSymmetry&&l.deferredSymmetry.resolve()}else s=n.htmlCls.baseUrl+"mmcifparser/mmcifparser.cgi",$.ajax({url:s,type:"POST",data:{mmcifheader:i},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(s){if(void 0!==s.emd&&(l.emd=s.emd),void 0!==s.organism&&(l.organism=s.organism),l.bAssemblyUseAsu&&r.loadMmcifSymmetry(s.assembly),"mmtfid"===t&&void 0!==s.missingseq){let t=0,i="";for(let r=0,o=s.missingseq.length;r<o;++r){let o=s.missingseq[r].resn,a=s.missingseq[r].chain,d=s.missingseq[r].resi,c=e+"_"+a;void 0===l.chainMissingResidueArray[c]&&(l.chainMissingResidueArray[c]=[]);let h={};h.resi=d,h.name=n.utilsCls.residueName2Abbr(o).toLowerCase(),a!=i&&(t=0),!isNaN(d)&&(""==i||a!=i||a==i&&d>t)&&(l.chainMissingResidueArray[c].push(h),t=d,i=a)}l.loadPDBCls.adjustSeq(l.chainMissingResidueArray)}void 0!==l.deferredSymmetry&&l.deferredSymmetry.resolve()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):void 0!==l.deferredSymmetry&&l.deferredSymmetry.resolve()}})},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):void 0!==l.deferredSymmetry&&l.deferredSymmetry.resolve()}})}loadMmcifData(e,t){let s=this.icn3d;return s.icn3dui,t||(t=e.mmcif),t||(t="STRU"),void 0!==e.atoms&&(s.init(),void 0!==e.emd&&(s.emd=e.emd),void 0!==e.organism&&(s.organism=e.organism),void 0!==s.emd?($("#"+s.pre+"mapWrapper1").hide(),$("#"+s.pre+"mapWrapper2").hide(),$("#"+s.pre+"mapWrapper3").hide()):($("#"+s.pre+"emmapWrapper1").hide(),$("#"+s.pre+"emmapWrapper2").hide(),$("#"+s.pre+"emmapWrapper3").hide()),s.deferredOpm=$.Deferred((function(){s.opmParserCls.loadOpmData(e,t,void 0,"mmcif")})),s.deferredOpm.promise())}loadMmcifSymmetry(e){let t=this.icn3d,s=t.icn3dui;for(let s=0,i=e.length;s<i;++s){let i=new THREE.Matrix4;i.fromArray(e[s]),t.biomtMatrices[s]=i}t.asuCnt=t.biomtMatrices.length,1==s.cfg.bu&&Object.keys(t.atoms).length*t.asuCnt>t.maxatomcnt&&(t.bAssembly=!0)}loadMmcifOpmDataPart2(e,t){let s=this.icn3d,i=s.icn3dui;1==Object.keys(s.structures).length&&$("#"+s.pre+"alternateWrapper").hide();let l=void 0!==e.assembly?e.assembly:[];for(let e=0,t=l.length;e<t;++e){null==s.biomtMatrices[e]&&(s.biomtMatrices[e]=(new THREE.Matrix4).identity());for(let t=0,i=l[e].length;t<i;++t)s.biomtMatrices[e].elements[t]=l[e][t]}void 0!==s.biomtMatrices&&s.biomtMatrices.length>1?($("#"+s.pre+"assemblyWrapper").show(),s.asuCnt=s.biomtMatrices.length):$("#"+s.pre+"assemblyWrapper").hide(),s.setStyleCls.setAtomStyleByOptions(s.opts),s.setColorCls.setColorByOptions(s.opts,s.atoms),s.ParserUtilsCls.renderStructure(),void 0!==i.cfg.rotate&&s.resizeCanvasCls.rotStruc(i.cfg.rotate,!0)}}class xe{constructor(e){this.icn3d=e}selectSequenceNonMobile(){let e=this.icn3d;if(e.icn3dui.bNode)return;let t=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"dt_giseq]").add("[id^="+e.pre+"dt_custom]").add("[id^="+e.pre+"dt_site]").add("[id^="+e.pre+"dt_snp]").add("[id^="+e.pre+"dt_clinvar]").add("[id^="+e.pre+"dt_cdd]").add("[id^="+e.pre+"dt_domain]").add("[id^="+e.pre+"dt_interaction]").add("[id^="+e.pre+"dt_ssbond]").add("[id^="+e.pre+"dt_crosslink]").add("[id^="+e.pre+"dt_transmem]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_custom]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").add("[id^="+e.pre+"tt_crosslink]").add("[id^="+e.pre+"tt_transmem]").selectable({distance:1,stop:function(){let e=t.icn3d;$(this).attr("id")===e.pre+"dl_sequence2"?(e.bAlignSeq=!0,e.bAnnotations=!1):(e.bAlignSeq=!1,e.bAnnotations=!0),!1!==e.bSelectResidue||e.bShift||e.bCtrl||e.selectionCls.removeSelection(),$("span.ui-selected",this).each((function(){let e=$(this).attr("id");void 0!==e&&t.selectResidues(e,this)})),e.hlObjectsCls.addHlObjects();let s={};for(let t in e.selectedResidues){let e=t.lastIndexOf("_");s[t.substr(0,e)]=1}let i=Object.keys(s);e.hlUpdateCls.updateHl2D(i),$("div.ui-selected",this).each((function(){void 0!==$(this).attr("chain")&&t.selectTitle(this)}))}}),$("[id^="+e.pre+"ov_giseq]").add("[id^="+e.pre+"ov_custom]").add("[id^="+e.pre+"ov_site]").add("[id^="+e.pre+"ov_snp]").add("[id^="+e.pre+"ov_clinvar]").add("[id^="+e.pre+"ov_cdd]").add("[id^="+e.pre+"ov_domain]").add("[id^="+e.pre+"ov_interaction]").add("[id^="+e.pre+"ov_ssbond]").add("[id^="+e.pre+"ov_crosslink]").add("[id^="+e.pre+"ov_transmem]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_custom]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").add("[id^="+e.pre+"tt_crosslink]").add("[id^="+e.pre+"tt_transmem]").add("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"dt_giseq]").add("[id^="+e.pre+"dt_custom]").add("[id^="+e.pre+"dt_site]").add("[id^="+e.pre+"dt_snp]").add("[id^="+e.pre+"dt_clinvar]").add("[id^="+e.pre+"dt_cdd]").add("[id^="+e.pre+"dt_domain]").add("[id^="+e.pre+"dt_interaction]").add("[id^="+e.pre+"dt_ssbond]").add("[id^="+e.pre+"dt_crosslink]").add("[id^="+e.pre+"dt_transmem]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_custom]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").add("[id^="+e.pre+"tt_crosslink]").add("[id^="+e.pre+"tt_transmem]").on("click",".icn3d-seqTitle",(function(e){let s=t.icn3d;e.stopImmediatePropagation(),$(this).parents("div").attr("id")===s.pre+"dl_sequence2"?(s.bAlignSeq=!0,s.bAnnotations=!1):(s.bAlignSeq=!1,s.bAnnotations=!0),t.selectTitle(this),s.hlUpdateCls.hlSummaryDomain3ddomain(this),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}))}selectSequenceMobile(){let e=this.icn3d;if(e.icn3dui.bNode)return;let t=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"giseq]").add("[id^="+e.pre+"custom]").add("[id^="+e.pre+"site]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"snp]").add("[id^="+e.pre+"cdd]").add("[id^="+e.pre+"domain]").add("[id^="+e.pre+"interaction]").add("[id^="+e.pre+"ssbond]").add("[id^="+e.pre+"crosslink]").add("[id^="+e.pre+"transmem]").on("click",".icn3d-residue",(function(e){let s=t.icn3d;e.stopImmediatePropagation();let i=$(this).attr("id");void 0!==i&&t.selectResidues(i,this),s.hlObjectsCls.addHlObjects();let l={};for(let e in s.selectedResidues){let t=e.lastIndexOf("_");l[e.substr(0,t)]=1}s.hlUpdateCls.removeHl2D();let n=Object.keys(l);s.hlUpdateCls.updateHl2D(n)}))}selectChainMobile(){let e=this.icn3d;if(e.icn3dui.bNode)return;let t=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"giseq]").add("[id^="+e.pre+"custom]").add("[id^="+e.pre+"site]").add("[id^="+e.pre+"feat]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"snp]").add("[id^="+e.pre+"cdd]").add("[id^="+e.pre+"domain]").add("[id^="+e.pre+"interaction]").add("[id^="+e.pre+"ssbond]").add("[id^="+e.pre+"crosslink]").add("[id^="+e.pre+"transmem]").on("click",".icn3d-seqTitle",(function(e){let s=t.icn3d;e.stopImmediatePropagation(),$(this).parents("div").attr("id")===s.pre+"dl_sequence2"?(s.bAlignSeq=!0,s.bAnnotations=!1):(s.bAlignSeq=!1,s.bAnnotations=!0),t.selectTitle(this),s.hlUpdateCls.hlSummaryDomain3ddomain(this)}))}selectTitle(e){let t=this.icn3d,s=t.icn3dui;if(!s.bNode&&$(e).hasClass("icn3d-seqTitle")){let i,l,n,r=$(e).attr("chain");if(t.bAlignSeq?t.bSelectAlignResidue=!1:t.bSelectResidue=!1,t.bAnnotations||t.hlUpdateCls.removeSeqChainBkgd(r),t.bCtrl||t.bShift||(t.hlUpdateCls.removeSeqResidueBkgd(),t.hlUpdateCls.removeSeqChainBkgd(),t.currSelectedSets=[]),$(e).toggleClass("icn3d-highlightSeq"),t.bAnnotations?(i=$(e).attr("setname"),l=$(e).attr("title")):i=t.bAlignSeq?"align_"+r:r,$(e).hasClass("icn3d-highlightSeq"))if(t.bAnnotations){if($(e).hasClass("icn3d-highlightSeq"))if(t.hlUpdateCls.removeHl2D(),void 0!==$(e).attr("gi")){t.bCtrl||t.bShift?(t.currSelectedSets.push(r),t.selectionCls.selectAChain(r,r,!1,!0)):(t.currSelectedSets=[r],t.selectionCls.selectAChain(r,r,!1)),s.htmlCls.clickMenuCls.setLogCmd("select chain "+r,!0);let e=t.currSelectedSets.join(" or ");t.currSelectedSets.length>1&&s.htmlCls.clickMenuCls.setLogCmd("select sets "+e,!0)}else{let o={};if(void 0!==$(e).attr("domain")||void 0!==$(e).attr("feat")||void 0!==$(e).attr("3ddomain")||void 0!==$(e).attr("custom")){t.hlUpdateCls.hlSummaryDomain3ddomain(e);let a,d,c,h=$(e).attr("from").split(","),m=$(e).attr("to").split(","),p=r.substr(0,r.indexOf("_"));for(let s=0,i=h.length;s<i;++s){d=parseInt(h[s]),c=parseInt(m[s]);for(let s=d;s<=c;++s){if(!t.bNCBI||void 0===$(e).attr("domain")&&void 0===$(e).attr("feat")&&void 0===$(e).attr("3ddomain"))a=r+"_"+(s+1).toString();else{let e=r+"_"+(s+1).toString();a=p.length>4?e:t.residNCBI2resid[e]}o[a]=1}}t.bCtrl||t.bShift?t.selectionCls.selectResidueList(o,i,l,!0):t.selectionCls.selectResidueList(o,i,l,!1),a=r+"_"+parseInt((d+c)/2).toString(),n=t.applyCenterCls.centerAtoms(s.hashUtilsCls.hash2Atoms(t.residues[a],t.atoms))}else if(void 0!==$(e).attr("posarray")){let a,d=$(e).attr("posarray").split(","),c=r.substr(0,r.indexOf("_"));for(let s=0,i=d.length;s<i;++s){if(void 0!==$(e).attr("site"))if(t.bNCBI){let e=r+"_"+(parseInt(d[s])+1).toString();a=c.length>4?e:t.residNCBI2resid[e]}else a=r+"_"+(parseInt(d[s])+1).toString();else a=r+"_"+d[s];o[a]=1}t.bCtrl||t.bShift?t.selectionCls.selectResidueList(o,i,l,!0):t.selectionCls.selectResidueList(o,i,l,!1),a=r+"_"+d[parseInt((0+d.length)/2)].toString(),n=t.applyCenterCls.centerAtoms(s.hashUtilsCls.hash2Atoms(t.residues[a],t.atoms))}for(let e in t.labels)"schematic"!==e&&"distance"!==e&&(t.labels[e]=[]);let a=t.LABELSIZE,d="black"!=t.opts.background?t.colorWhitebkgd:t.colorBlackbkgd;void 0!==n&&t.analysisCls.addLabel(l,n.center.x,n.center.y,n.center.z,a,d,void 0,"custom"),t.drawCls.draw(),s.htmlCls.clickMenuCls.setLogCmd("select "+t.resid2specCls.residueids2spec(Object.keys(o))+" | name "+i,!0),t.bCtrl||t.bShift?t.currSelectedSets.push(i):t.currSelectedSets=[i];let c=t.currSelectedSets.join(" or ");t.currSelectedSets.length>1&&s.htmlCls.clickMenuCls.setLogCmd("select sets "+c,!0)}}else{t.bCtrl||t.bShift?(t.currSelectedSets.push(i),t.selectionCls.selectAChain(r,i,!0,!0)):(t.currSelectedSets=[i],t.selectionCls.selectAChain(r,i,t.bAlignSeq)),t.bAlignSeq?s.htmlCls.clickMenuCls.setLogCmd("select alignChain "+r,!0):s.htmlCls.clickMenuCls.setLogCmd("select chain "+r,!0);let e=t.currSelectedSets.join(" or ");t.currSelectedSets.length>1&&s.htmlCls.clickMenuCls.setLogCmd("select sets "+e,!0)}else t.hlObjectsCls.removeHlObjects(),t.hlUpdateCls.removeHl2D(),$("#"+t.pre+"atomsCustom").val("")}}selectResidues(e,t){let s=this.icn3d,i=s.icn3dui;if(!i.bNode&&(!1!==s.bSelectResidue||s.bShift||s.bCtrl||s.selectionCls.removeSelection(),void 0!==e&&""!==e)){e=e.substr(e.indexOf("_")+1),s.bSelectResidue=!0,$(t).toggleClass("icn3d-highlightSeq");let l=e.substr(e.indexOf("_")+1);if(s.residues.hasOwnProperty(l))if($(t).hasClass("icn3d-highlightSeq")){for(let e in s.residues[l])s.hAtoms[e]=1;if(s.selectedResidues[l]=1,s.bAnnotations&&void 0!==$(t).attr("disease")){let e=$(t).attr("disease"),n=s.applyCenterCls.centerAtoms(i.hashUtilsCls.hash2Atoms(s.residues[l],s.atoms)),r=15;e.length>r&&(e=e.substr(0,r)+"...");let o=s.LABELSIZE,a=i.htmlCls.GREYD;s.analysisCls.addLabel(e,n.center.x,n.center.y,n.center.z,o,a,void 0,"custom")}}else{for(let e in s.residues[l])delete s.hAtoms[e];delete s.selectedResidues[l],s.hlObjectsCls.removeHlObjects()}}}}class ke{constructor(e){this.icn3d=e}showAnnotations(){let e=this.icn3d,t=e.icn3dui,s=this;if(t.htmlCls.dialogCls.openDlg("dl_selectannotations","Sequences and Annotations"),(void 0===e.bAssemblyNote||!e.bAssemblyNote)&&void 0!==e.asuCnt){let t="     <br><div id='"+e.pre+"assembly_note' style='margin-left:5px;'><span class='icn3d-annoLargeTitle'>Assembly Tips:</span> Only the asymmetric unit is shown in the sequence window.<br>Click \"Assembly\" in the menu \"View\" to switch between asymmetric unit and biological assembly(<b>"+e.asuCnt+"</b> asymmetric unit).</div>";$("#"+e.pre+"dl_annotations_tabs").append(t),e.bAssemblyNote=!0}if(e.bResetAnno&&(e.giSeq={},e.currClin={},e.resi2disease_nonempty={},e.baseResi={},e.matchedPos={},$("#"+t.pre+"dl_annotations").empty(),e.annotationCls.setAnnoView("overview")),void 0===e.bAnnoShown||!e.bAnnoShown||e.bResetAnno){let i=Object.keys(e.chains);void 0===e.giSeq&&(e.giSeq={}),void 0===e.currClin&&(e.currClin={}),void 0===e.resi2disease_nonempty&&(e.resi2disease_nonempty={}),void 0===e.baseResi&&(e.baseResi={}),void 0===e.matchedPos&&(e.matchedPos={});let l=t.cfg.notebook?t.htmlCls.WIDTH/2:$("#"+e.pre+"dl_selectannotations").dialog("option","width");e.seqAnnWidth=l-120-60-50,e.maxAnnoLength=1;for(let t in e.chainsSeq)e.chainsSeq[t].length>e.maxAnnoLength&&(e.maxAnnoLength=e.chainsSeq[t].length);let n={},r={},o={};e.protein_chainid={};for(let s=0,l=i.length;s<l;++s){Math.round(i[s].indexOf("_"));let l=e.firstAtomObjCls.getFirstCalphaAtomObj(e.chains[i[s]]);if(void 0===l&&(l=e.firstAtomObjCls.getFirstAtomObj(e.chains[i[s]])),void 0===l)continue;let a,d=i[s].substr(i[s].indexOf("_")+1);if(-1!==d.indexOf("_")?(d=d.substr(0,d.indexOf("_")),a=i[s].substr(0,i[s].indexOf("_"))+"_"+d):a=i[s],e.proteins.hasOwnProperty(l.serial)&&e.chainsSeq[i[s]].length>1)e.protein_chainid[i[s]]=a;else if(e.nucleotides.hasOwnProperty(l.serial)&&e.chainsSeq[i[s]].length>1)n[i[s]]=a;else if(e.chainsSeq[i[s]].length>1)r[i[s]]=a;else{let t=e.chainsSeq[i[s]][0].name,l=i[s]+"_"+e.chainsSeq[i[s]][0].resi;void 0===o[t]&&(o[t]=[]),o[t].push(l)}if((void 0!==t.cfg.pdbid||void 0!==t.cfg.opmid||void 0!==t.cfg.mmcifid||void 0!==t.cfg.mmtfid)&&(e.proteins.hasOwnProperty(l.serial)||e.nucleotides.hasOwnProperty(l.serial)))for(let t=0,l=e.chainsSeq[i[s]].length;t<l;++t){let l=e.chainsSeq[i[s]][t];if(""!==l.name&&"-"!==l.name&&l.name==l.name.toUpperCase()){let t=i[s]+"_"+l.resi,n=e.firstAtomObjCls.getFirstCalphaAtomObj(e.residues[t]);if(void 0===n&&(n=e.firstAtomObjCls.getFirstAtomObj(e.chains[i[s]])),e.proteins.hasOwnProperty(n.serial)||e.nucleotides.hasOwnProperty(n.serial))continue;{let e=l.name.trim();void 0===o[e]&&(o[e]=[]),o[e].push(t)}}}}if(void 0===t.cfg.blast_rep_id){if(e.bFullUi)if(void 0!==t.cfg.mmtfid){let t=i[0].substr(0,i[0].indexOf("_"));$.when(e.mmcifParserCls.downloadMmcifSymmetry(t,"mmtfid")).then((function(){s.showAnnoSeqData(n,r,o)}))}else this.showAnnoSeqData(n,r,o)}else if(void 0===t.cfg.blast_rep_id||e.bSmithwm){if(void 0!==t.cfg.blast_rep_id&&e.bSmithwm){let i,l,a=[t.cfg.blast_rep_id];-1!=t.cfg.query_id.indexOf(">")?l=t.cfg.query_id.substr(t.cfg.query_id.indexOf("\n")+1):!/\d/.test(t.cfg.query_id)||t.cfg.query_id.length>50?l=t.cfg.query_id:a.push(t.cfg.query_id);let d=t.htmlCls.baseUrl+"/vastdyn/vastdyn.cgi?chainlist="+a;$.ajax({url:d,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(t){let a=0;for(let e in t)0==a?i=t[e]:l||(l=t[e]),++a;e.seqStructAlignDataSmithwm=e.alignSWCls.alignSW(i,l,1,-1,-1,-1),s.showAnnoSeqData(n,r,o)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):alert("Can not retrieve the sequence of the accession(s) "+a.join(", "))}})}}else{let i=t.htmlCls.baseUrl+"pwaln/pwaln.fcgi?from=querytarget",l={targets:t.cfg.blast_rep_id,queries:t.cfg.query_id};if(void 0!==t.cfg.query_from_to){let e=t.cfg.query_from_to.split(":");for(let t=0,s=e.length;t<s;++t)e[t]=parseInt(e[t])-1;l.queries=t.cfg.query_id+":"+e.join(":")}if(void 0!==t.cfg.target_from_to){let e=t.cfg.target_from_to.split(":");for(let t=0,s=e.length;t<s;++t)e[t]=parseInt(e[t])-1;l.targets=t.cfg.blast_rep_id+":"+e.join(":")}$.ajax({url:i,type:"POST",data:l,dataType:"jsonp",tryCount:0,retryLimit:0,success:function(t){e.seqStructAlignData=t,s.showAnnoSeqData(n,r,o)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}}e.bAnnoShown=!0}showAnnoSeqData(e,t,s){let i=this.icn3d,l=i.icn3dui;this.getAnnotationData();let n=0;for(let t in e)this.getSequenceData(t,e[t],"nucleotide",n),++n;i.interactChainbase=l.hashUtilsCls.unionHash(i.interactChainbase,i.protein_chainid),i.interactChainbase=l.hashUtilsCls.unionHash(i.interactChainbase,e),n=0;for(let e in t)this.getSequenceData(e,t[e],"chemical",n),++n;i.interactChainbase=l.hashUtilsCls.unionHash(i.interactChainbase,t),i.ssbondChainbase=l.hashUtilsCls.unionHash(i.ssbondChainbase,i.protein_chainid),i.ssbondChainbase=l.hashUtilsCls.unionHash(i.ssbondChainbase,t),i.crosslinkChainbase=l.hashUtilsCls.unionHash(i.crosslinkChainbase,i.protein_chainid),i.crosslinkChainbase=l.hashUtilsCls.unionHash(i.crosslinkChainbase,e),i.crosslinkChainbase=l.hashUtilsCls.unionHash(i.crosslinkChainbase,t);for(let e in s)this.getCombinedSequenceData(e,s[e],n),++n;this.enableHlSeq(),setTimeout((function(){i.annotationCls.hideAllAnno(),i.annotationCls.clickCdd()}),0)}getAnnotationData(){let e=this.icn3d,t=e.icn3dui,s=this,i=$.map(e.protein_chainid,(function(e){return e})),l=0;for(let s in e.protein_chainid){let i=t.utilsCls.isMobile()?"none":"button",n=e.showSeqCls.getProteinName(s),r=n,o=0==l?"<span class='icn3d-annoLargeTitle'><b>Proteins</b>: </span><br><br>":"",a=e.chainsGene[s]&&e.chainsGene[s].geneId?"(Gene: <a href='https://www.ncbi.nlm.nih.gov/gene/"+e.chainsGene[s].geneId+"' target='_blank' title='"+e.chainsGene[s].geneDesc+"'>"+e.chainsGene[s].geneSymbol+"</a>)":"",d="<div id='"+e.pre+"anno_"+s+"' class='icn3d-annotation'>"+o+"<span style='font-weight:bold;'>Annotations of "+s+"</span>: <a class='icn3d-blue' href='https://www.ncbi.nlm.nih.gov/protein?term="+s+"' target='_blank' title='"+n+"'>"+r+"</a>"+a+"&nbsp;&nbsp;&nbsp;"+this.addButton(s,"icn3d-addtrack","Add Track","Add a custom track",60,i)+"&nbsp;&nbsp;&nbsp;";d+=this.addButton(s,"icn3d-customcolor","Custom Color/Tube","Use a custom file to define the colors or tubes in 3D structure",110,i)+"&nbsp;&nbsp;&nbsp;",d+=this.addButton(s,"icn3d-helixsets","Helix Sets",'Define sets for each helix in this chain and add them to the menu of "Defined Sets"',60,i)+"&nbsp;"+this.addButton(s,"icn3d-sheetsets","Sheet Sets",'Define sets for each sheet in this chain and add them to the menu of "Defined Sets"',60,i)+"&nbsp;"+this.addButton(s,"icn3d-coilsets","Coil Sets",'Define sets for each coil in this chain and add them to the menu of "Defined Sets"',60,i),$("#"+e.pre+"dl_annotations").append(d);let c=["giseq","cdd","clinvar","snp","domain","site","interaction","custom","ssbond","crosslink","transmem"];for(let t in c){let i=c[t];$("#"+e.pre+"anno_"+s).append(this.getAnDiv(s,i))}$("#"+e.pre+"anno_"+s).append("<br><hr><br>"),++l}e.annoCddSiteCls.setToolTip();let n=t.htmlCls.baseUrl+"/vastdyn/vastdyn.cgi?chainlist="+i;void 0!==e.chainid_seq?this.processSeqData(e.chainid_seq):$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(t){e.chainid_seq=t,s.processSeqData(e.chainid_seq)},error:function(t,l,n){if(this.tryCount++,this.tryCount<=this.retryLimit)$.ajax(this);else{s.enableHlSeq(),console.log("No data were found for the protein "+i+"...");for(let t in e.protein_chainid){let s=e.protein_chainid[t];e.showSeqCls.setAlternativeSeq(t,s),e.showSeqCls.showSeq(t,s)}e.annoCddSiteCls.showCddSiteAll()}}})}getSequenceData(e,t,s,i){let l=this.icn3d;l.icn3dui;let n=l.showSeqCls.getProteinName(e),r=n;r.length>40&&(r=r.substr(0,40)+"...");let o="";0==i&&("protein"==s?o="<span class='icn3d-annoLargeTitle'><b>Proteins</b>: </span><br><br>":"nucleotide"==s?o="<span class='icn3d-annoLargeTitle'><b>Nucleotides</b>: </span><br><br>":"chemical"==s&&(o="<span class='icn3d-annoLargeTitle'><b>Chemicals/Ions/Water</b>: </span><br><br>")),$("#"+l.pre+"dl_annotations").append("<div id='"+l.pre+"anno_"+e+"' class='icn3d-annotation'>"+o+"<b>"+e+"</b>: <span title='"+n+"'>"+r+"</span> </div>"),$("#"+l.pre+"anno_"+e).append(this.getAnDiv(e,"giseq")),$("#"+l.pre+"anno_"+e).append(this.getAnDiv(e,"interaction")),$("#"+l.pre+"anno_"+e).append("<br><hr><br>"),l.giSeq[e]=[];for(let t=0;t<l.chainsSeq[e].length;++t){let s=l.chainsSeq[e][t].name;l.giSeq[e][t]=s}l.matchedPos[e]=0,l.baseResi[e]=l.chainsSeq[e][0].resi-l.matchedPos[e]-1,l.showSeqCls.showSeq(e,t,s)}getCombinedSequenceData(e,t,s){let i,l=this.icn3d,n=l.icn3dui,r=0==s?"<span class='icn3d-annoLargeTitle'><b>Chemicals/Ions/Water</b>: </span><br><br>":"",o=t[0].lastIndexOf("_"),a=t[0].substr(0,o),d=void 0!==n.cfg.mmdbid&&void 0!==l.chainid2sid?l.chainid2sid[a]:void 0;i=void 0!==d?"<b><a class='icn3d-blue' href='https://pubchem.ncbi.nlm.nih.gov/substance/"+d+"#section=2D-Structure' target='_blank'>"+e+" <img src='https://pubchem.ncbi.nlm.nih.gov/image/imgsrv.fcgi?sid="+d+"'></a></b>":"<b>"+e+"</b>",$("#"+l.pre+"dl_annotations").append("<div id='"+l.pre+"anno_"+e+"' class='icn3d-annotation'>"+r+i+"</div>"),$("#"+l.pre+"anno_"+e).append("<div id='"+l.pre+"giseq_"+e+"'><div id='"+l.pre+"dt_giseq_"+e+"' style='display:none'></div><div id='"+l.pre+"ov_giseq_"+e+"'></div></div>"),$("#"+l.pre+"anno_"+e).append("<br><hr><br>");let c='<div id="'+l.pre+'giseq_sequence" class="icn3d-dl_sequence">';c+='<div class="icn3d-seqTitle2" anno="sequence"><span style="white-space:nowrap;" title="Chemical '+e+'">Chem. '+e+"</span></div>",c+='<span class="icn3d-residueNum" style="width:60px!important;" title="starting protein sequence number">Count: '+t.length+"</span>",c+='<span class="icn3d-seqLine">';let h=c,m=c;for(let s=0,i=t.length;s<i;++s){let i=e,n=i;i.length>3&&(n=i.substr(0,3)),s<t.length-1&&(n+=",");let r=t[s],o=r.substr(r.lastIndexOf("_")+1);h+='<span id="giseq_'+l.pre+r+'" title="'+i+o+'" class="icn3d-residue icn3d-chemical">'+n+"</span>"}let p=n.htmlCls.GREY8,u=Math.round(l.seqAnnWidth*t.length/l.maxAnnoLength);u<1&&(u=1),m+='<div class="icn3d-seqTitle" style="display:inline-block; color:white; font-weight:bold; background-color:'+p+"; width:"+u+'px;">&nbsp;</div>',c="</span>",c+="<br>",c+="</div>",h+=c,m+=c,$("#"+l.pre+"dt_giseq_"+e).html(h),$("#"+l.pre+"ov_giseq_"+e).html(m)}processSeqData(e){let t=this.icn3d,s=t.icn3dui;for(let i in t.protein_chainid){let l=t.protein_chainid[i];if(e.hasOwnProperty(l)){let s=e[l];t.giSeq[i]=s;let n="";for(let e=0;e<10&&e<t.chainsSeq[i].length;++e)n+=t.chainsSeq[i][e].name.substr(0,1);let r=s.toLowerCase().indexOf(n.toLowerCase());-1==r?(console.log("The gi sequence didn't match the protein sequence. The start of 3D protein sequence: "+n+". The gi sequence: "+s.substr(0,10)+"."),t.showSeqCls.setAlternativeSeq(i,l)):(t.matchedPos[i]=r,t.baseResi[i]=t.chainsSeq[i][0].resi-t.matchedPos[i]-1)}else console.log("No data were found for the protein "+i+"..."),t.showSeqCls.setAlternativeSeq(i,l);if(s.cfg.blast_rep_id!=i)t.showSeqCls.showSeq(i,l);else if(s.cfg.blast_rep_id==i&&void 0===t.seqStructAlignData&&void 0===t.seqStructAlignDataSmithwm){let e;e=s.cfg.query_id.length>14?"Query: "+s.cfg.query_id.substr(0,6)+"...":isNaN(s.cfg.query_id)?"Query: "+s.cfg.query_id:"Query: gi "+s.cfg.query_id,compTitle=void 0,compText=void 0;let n="cannot be aligned";t.queryStart="",t.queryEnd="",alert("The sequence can NOT be aligned to the structure"),t.showSeqCls.showSeq(i,l,void 0,e,compTitle,n,compText)}else if(s.cfg.blast_rep_id==i&&(void 0!==t.seqStructAlignData||void 0!==t.seqStructAlignDataSmithwm)){let e,n,r,o,a;if(e=s.cfg.query_id.length>14?"Query: "+s.cfg.query_id.substr(0,6)+"...":isNaN(s.cfg.query_id)?"Query: "+s.cfg.query_id:"Query: gi "+s.cfg.query_id,void 0!==t.seqStructAlignData){let e,s,l=t.seqStructAlignData;void 0!==l.data&&(e=l.data[0].query,s=l.data[0].targets[i],s=void 0!==s&&s.hsps.length>0?s.hsps[0]:void 0),void 0!==e&&void 0!==s&&(n=s.scores.e_value.toPrecision(2),n>1e-200&&(n=parseFloat(n).toExponential()),s.scores.bit_score,r=l.targets[i].seqdata,o=e.seqdata,a=s.segs)}else{let e=t.seqStructAlignDataSmithwm;n=e.score,r=e.target.replace(/-/g,""),o=e.query.replace(/-/g,""),a=[];let s=-1,i=-1,l=!1,d={};for(let t=0,n=e.target.length;t<n;++t)"-"!=e.target[t]&&++s,"-"!=e.query[t]&&++i,l||"-"==e.target[t]||"-"==e.query[t]?!l||"-"!=e.target[t]&&"-"!=e.query[t]||(l=!1,d.orito="-"==e.target[t]?s:s-1,d.to="-"==e.query[t]?i:i-1,a.push(d),d={}):(l=!0,d.orifrom=s,d.from=i);"-"!=e.target[e.target.length-1]&&"-"!=e.query[e.target.length-1]&&(d.orito=s,d.to=i,a.push(d))}let d="",c="";if(t.queryStart="",t.queryEnd="",void 0!==a){let e={};void 0===t.targetGapHash&&(t.targetGapHash={}),t.fullpos2ConsTargetpos={},t.consrvResPosArray=[];let l=0,n=0;t.nTotalGap=0,t.queryStart=a[0].from+1,t.queryEnd=a[a.length-1].to+1;for(let s=0,i=a.length;s<i;++s){let i=a[s];if(s>0)if(i.orifrom-l<i.from-n)t.targetGapHash[i.orifrom]={from:n+1,to:i.from-1},t.nTotalGap+=t.targetGapHash[i.orifrom].to-t.targetGapHash[i.orifrom].from+1;else if(i.orifrom-l>i.from-n)for(let t=l+1;t<i.orifrom;++t)e[t]=-1;for(let t=0;t<=i.orito-i.orifrom;++t)e[t+i.orifrom]=t+i.from;l=i.orito,n=i.to}let h=0;t.alnChainsSeq[i]=[];let m=t.chainid2offset[i]?t.chainid2offset[i]:0;for(let l=0,n=r.length;l<n;++l){if(t.targetGapHash.hasOwnProperty(l))for(let e=t.targetGapHash[l].from;e<=t.targetGapHash[l].to;++e)d+=o[e];c+=t.showSeqCls.insertGap(i,l,"-",!0),t.targetGapHash.hasOwnProperty(l)&&(h+=t.targetGapHash[l].to-t.targetGapHash[l].from+1);let n=t.bUsePdbNum?l+1+m:l+1;if(e.hasOwnProperty(l)&&-1!==e[l]){d+=o[e[l]];let a=this.getColorhexFromBlosum62(r[l],o[e[l]]);r[l]==o[e[l]]?(c+=r[l],t.fullpos2ConsTargetpos[l+h]={same:1,pos:n,res:r[l],color:a},t.consrvResPosArray.push(n),t.alnChainsSeq[i].push({resi:n,color:"#FF0000",color2:"#"+a})):this.conservativeReplacement(r[l],o[e[l]])?(c+="+",t.fullpos2ConsTargetpos[l+h]={same:0,pos:n,res:r[l],color:a},t.consrvResPosArray.push(n),t.alnChainsSeq[i].push({resi:n,color:"#0000FF",color2:"#"+a})):(c+=" ",t.fullpos2ConsTargetpos[l+h]={same:-1,pos:n,res:r[l],color:a},t.alnChainsSeq[i].push({resi:n,color:s.htmlCls.GREYC,color2:"#"+a}))}else d+="-",c+=" "}}else d+="cannot be aligned",alert("The sequence can NOT be aligned to the structure");let h=void 0!==t.seqStructAlignData?"BLAST, E: "+n:"Score: "+n;t.showSeqCls.showSeq(i,l,void 0,e,h,d,c);let m,p={};if(void 0!==t.consrvResPosArray)for(let e=0,s=t.consrvResPosArray.length;e<s;++e)m=l+"_"+t.consrvResPosArray[e],p[m]=1;let u=s.hashUtilsCls.cloneHash(t.hAtoms);t.selectionCls.selectResidueList(p,"protein_aligned",h,!1),t.hAtoms=s.hashUtilsCls.cloneHash(u)}}this.enableHlSeq(),t.annoCddSiteCls.showCddSiteAll()}enableHlSeq(){let e=this.icn3d;e.icn3dui.utilsCls.isMobile()?(e.hlSeqCls.selectSequenceMobile(),e.hlSeqCls.selectChainMobile()):e.hlSeqCls.selectSequenceNonMobile(),Object.keys(e.hAtoms).length<Object.keys(e.dAtoms).length&&e.hlUpdateCls.updateHlSeq()}getAnDiv(e,t){let s=this.icn3d;s.icn3dui;let i="Loading "+t+"...";return"custom"==t?i="":"domain"==t&&(i="Loading 3D "+t+"..."),"<div id='"+s.pre+t+"_"+e+"'><div id='"+s.pre+"tt_"+t+"_"+e+"' class='icn3d-fixed-pos' style='display:none!important'></div><div id='"+s.pre+"dt_"+t+"_"+e+"' style='display:none'>"+i+"</div><div id='"+s.pre+"ov_"+t+"_"+e+"'>"+i+"</div></div>"}addButton(e,t,s,i,l,n){return this.icn3d.icn3dui,"<div class='"+t+"' chainid='"+e+"' style='display:inline-block; font-size:11px; font-weight:bold; width:"+l+"px!important;'><button style='-webkit-appearance:"+n+"; height:18px; width:"+l+"px;'><span style='white-space:nowrap; margin-left:-3px;' title='"+i+"'>"+s+"</span></button></div>"}addSnpButton(e,t,s,i,l,n){let r=this.icn3d;return r.icn3dui,"<div class='"+r.pre+t+"' snp='"+e+"' style='margin:3px 0 3px 0; display:inline-block; font-size:11px; font-weight:bold; width:"+l+"px!important;'><button style='-webkit-appearance:"+n+"; height:18px; width:"+l+"px;'><span style='white-space:nowrap; margin-left:-3px;' title='"+i+"'>"+s+"</span></button></div>"}conservativeReplacement(e,t){let s=this.icn3d.icn3dui,i=-1!==s.parasCls.b62ResArray.indexOf(e)?s.parasCls.b62ResArray.indexOf(e):s.parasCls.b62ResArray.length-1,l=-1!==s.parasCls.b62ResArray.indexOf(t)?s.parasCls.b62ResArray.indexOf(t):s.parasCls.b62ResArray.length-1;return s.parasCls.b62Matrix[i][l]>0}getColorhexFromBlosum62(e,t){let s=this.icn3d.icn3dui;e=e.toUpperCase(),t=t.toUpperCase();let i=-1!==s.parasCls.b62ResArray.indexOf(e)?s.parasCls.b62ResArray.indexOf(e):s.parasCls.b62ResArray.length-1,l=-1!==s.parasCls.b62ResArray.indexOf(t)?s.parasCls.b62ResArray.indexOf(t):s.parasCls.b62ResArray.length-1,n=s.parasCls.b62Matrix[i][l];if(void 0===n)return"333333";let r="333333";if(n>0){let e=221-parseInt(n/11*221),t=e<10?"0"+e.toString(16):e.toString(16);r="DD"+t+t}else{let e=221-parseInt(-1*n/4*221),t=e<10?"0"+e.toString(16):e.toString(16);r=t+t+"DD"}return r}}class Oe{constructor(e){this.icn3d=e}showInteraction(e,t){let s=this.icn3d,i=s.icn3dui,l=this;void 0!==s.chainname2residues||void 0===i.cfg.mmdbid&&void 0===i.cfg.gi&&void 0===i.cfg.blast_rep_id&&void 0===i.cfg.align&&void 0===i.cfg.chainalign?this.showInteraction_base(e,t):setTimeout((function(){l.showInteraction_base(e,t)}),1e3)}showInteraction_base(e,t){let s=this.icn3d,i=s.icn3dui;void 0===s.chainname2residues&&(s.chainname2residues={});let l=Object.keys(s.chains),n=e,r=Math.round(n.indexOf("_"));if(r>4)return;if(s.firstAtomObjCls.getFirstCalphaAtomObj(s.chains[n]),void 0===s.chainname2residues[n]){s.chainname2residues[n]={};let t=l.length;if(t>100&&void 0===i.cfg.mmdbid&&void 0===i.cfg.gi&&void 0===i.cfg.blast_rep_id&&void 0===i.cfg.align&&void 0===i.cfg.chainalign)return $("#"+s.pre+"dt_interaction_"+e).html(""),void $("#"+s.pre+"ov_interaction_"+e).html("");for(let e=0;e<t;++e){let t=l[e];if(t===n)continue;if(t.substr(0,t.indexOf("_"))!==n.substr(0,n.indexOf("_")))continue;if(r=Math.round(n.indexOf("_")),r>4)continue;let o,a=s.firstAtomObjCls.getFirstCalphaAtomObj(s.chains[t]);s.chemicals.hasOwnProperty(a.serial)?o="chemical":s.nucleotides.hasOwnProperty(a.serial)?o="nucleotide":s.ions.hasOwnProperty(a.serial)?o="ion":s.proteins.hasOwnProperty(a.serial)?o="protein":s.water.hasOwnProperty(a.serial)&&(o="water");let d=s.contactCls.getAtomsWithinAtom(i.hashUtilsCls.hash2Atoms(s.chains[n],s.atoms),i.hashUtilsCls.hash2Atoms(s.chains[t],s.atoms),4);if(0==Object.keys(d).length)continue;let c={};for(let e in d){let t=s.atoms[e];c[t.structure+"_"+t.chain+"_"+t.resi]=1}let h=t.substr(t.indexOf("_")+1)+"("+o+")";s.chainname2residues[n][h]=Object.keys(c)}}let o='<div id="'+s.pre+e+'_interseq_sequence" class="icn3d-dl_sequence">',a=o,d=o,c=0;for(let t in s.chainname2residues[e]){let l=s.chainname2residues[e][t],n="Interact ."+t;n.length>17&&(n=n.substr(0,17)+"...");let r="Interact ."+t,h=[];for(let e=0,t=l.length;e<t;++e){let t=l[e],i=Math.round(t.substr(l[e].lastIndexOf("_")+1));if(s.residues[t]){let e=Object.keys(s.residues[t])[0];(s.proteins.hasOwnProperty(e)||s.nucleotides.hasOwnProperty(e))&&h.push(i)}}let m=h.length;if(0==m)continue;let p=t.replace(/\s/g,""),u='<div class="icn3d-seqTitle icn3d-link icn3d-blue" interaction="'+(c+1).toString()+'" posarray="'+h.toString()+'" shorttitle="'+n+'" setname="'+e+"_"+p+'" anno="sequence" chain="'+e+'" title="'+r+'">'+n+" </div>",C='<span class="icn3d-residueNum" title="residue count">'+m.toString()+" Res</span>";d+=u+C+"<br>";let g='<span class="icn3d-seqLine">';o+=u+C+g,a+=u+C+g;let f="inter"+c.toString(),b=0,y=0,v=1;for(let t=0,l=s.giSeq[e].length;t<l;++t)if(o+=s.showSeqCls.insertGap(e,t,"-"),-1!=h.indexOf(t+1+s.baseResi[e])){let l=s.giSeq[e][t],n=l;l.length>1&&(n=l[0]+"..");let r=t>=s.matchedPos[e]&&t-s.matchedPos[e]<s.chainsSeq[e].length?s.chainsSeq[e][t-s.matchedPos[e]].resi:s.baseResi[e]+1+t;o+='<span id="'+f+"_"+s.pre+e+"_"+r+'" title="'+l+r+'" class="icn3d-residue">'+n+"</span>",a+=s.showSeqCls.insertGapOverview(e,t);let d=i.cfg.blast_rep_id==e?Math.round(s.seqAnnWidth*t/(s.maxAnnoLength+s.nTotalGap)-b-y):Math.round(s.seqAnnWidth*t/s.maxAnnoLength-b-y);d>=0&&(a+='<div style="display:inline-block; width:'+d+'px;">&nbsp;</div>',a+='<div style="display:inline-block; background-color:#000; width:'+v+'px;" title="'+n+r+'">&nbsp;</div>',b+=d,y+=v)}else o+="<span>-</span>";g='<span class="icn3d-residueNum" title="residue count">&nbsp;'+m.toString()+" Residues</span>",g+="</span>",g+="<br>",o+=g,a+=g,++c}o+="</div>",a+="</div>",d+="</div>",$("#"+s.pre+"dt_interaction_"+e).html(o),$("#"+s.pre+"ov_interaction_"+e).html(a),$("#"+s.pre+"tt_interaction_"+e).html(d),i.utilsCls.isMobile()?(s.hlSeqCls.selectSequenceMobile(),s.hlSeqCls.selectChainMobile()):s.hlSeqCls.selectSequenceNonMobile()}}class He{constructor(e){this.icn3d=e}showCrosslink(e,t){let s=this.icn3d;s.icn3dui;let i=this;void 0===s.clbondpnts?setTimeout((function(){i.showCrosslink_base(e,t)}),1e3):this.showCrosslink_base(e,t)}showCrosslink_base(e,t){let s=this.icn3d;s.icn3dui;let i=t,l={},n=i.substr(0,i.indexOf("_")),r=s.clbondpnts[n];if(void 0===r)return $("#"+s.pre+"dt_crosslink_"+e).html(""),$("#"+s.pre+"ov_crosslink_"+e).html(""),void $("#"+s.pre+"tt_crosslink_"+e).html("");for(let e=0,t=r.length;e<t;e+=2){let t=r[e],s=r[e+1];t.substr(0,t.lastIndexOf("_")),i===s.substr(0,s.lastIndexOf("_"))&&(void 0===l[s]&&(l[s]=[]),l[s].push(t))}let o=Object.keys(l);s.annoCddSiteCls.showAnnoType(e,t,"crosslink","Cross-Linkages",o,l)}}class De{constructor(e){this.icn3d=e}showDomainPerStructure(e){let t=this.icn3d,s=t.icn3dui,i=this,l=Object.keys(t.structures)[e];if(s.htmlCls.baseUrl,0==e&&void 0!==t.mmdb_data)for(let e in t.protein_chainid)-1!==e.indexOf(l)&&this.showDomainWithData(e,t.mmdb_data);else if(void 0!==t.mmdb_dataArray[e])for(let s in t.protein_chainid)-1!==s.indexOf(l)&&this.showDomainWithData(s,t.mmdb_dataArray[e]);else{let s={domains:{}};for(let e in t.chains){if(l==e.substr(0,e.indexOf("_"))&&t.protein_chainid.hasOwnProperty(e)){s.domains[e]={},s.domains[e].domains=[];let i=t.chains[e],l=t.domain3dCls.c2b_NewSplitChain(i).subdomains;for(let t=0,i=l.length;t<i;++t){let i={intervals:[]};for(let e=0,s=l[t].length;e<s;e+=2)i.intervals.push([l[t][e],l[t][e+1]]);s.domains[e].domains.push(i)}}}t.mmdb_dataArray[e]=s;let n=!0;for(let s in t.protein_chainid)-1!==s.indexOf(l)&&i.showDomainWithData(s,t.mmdb_dataArray[e],n);t.bAjax3ddomain=!0,t.bAjaxDoneArray[e]=!0}}showDomainAll(){let e=this.icn3d;e.icn3dui;let t=Object.keys(e.structures);e.mmdb_dataArray=[],e.bAjaxDoneArray=[];for(let s=0,i=t.length;s<i;++s)e.bAjaxDoneArray[s]=!1;for(let e=0,s=t.length;e<s;++e)this.showDomainPerStructure(e)}showDomainWithData(e,t,s){let i,l,n=this.icn3d,r=n.icn3dui,o='<div id="'+n.pre+e+'_domainseq_sequence" class="icn3d-dl_sequence">',a=o,d=o,c=e.indexOf("_"),h=e.substr(c+1);if(s)l=e,i=t.domains[e]?t.domains[e].domains:[];else{let e,s=t.moleculeInfor;for(let t in s)if(s[t].chain===h){e=t,l=s[t].name;break}void 0!==e&&void 0!==t.domains[e]&&(i=t.domains[e].domains),void 0===i&&(i=[])}for(let t=0,c=i.length;t<c;++t){let c="3D domain "+(t+1).toString()+" of "+l,h=c.length>17?c.substr(0,17)+"...":c,m=i[t].intervals,p={},u={},C=[],g=[],f={},b=0;for(let t=0,i=m.length;t<i;++t){let i=Math.round(m[t][0])-1,l=Math.round(m[t][1])-1;if(!p.hasOwnProperty(i)&&!u.hasOwnProperty(l)){p[i]=1,u[l]=1,n.bNCBI||s?(C.push(i),g.push(l)):(C.push(i+n.baseResi[e]),g.push(l+n.baseResi[e])),b+=l-i+1;for(let e=i;e<=l;++e)f[e+1]=1}}let y='<div class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(t+1).toString()+'" from="'+C+'" to="'+g+'" shorttitle="'+h+'" index="'+t+'" setname="'+e+"_3d_domain_"+(t+1).toString()+'" anno="sequence" chain="'+e+'" title="'+c+'">'+h+" </div>",v='<span class="icn3d-residueNum" title="residue count">'+b.toString()+" Res</span>";d+=y+v+"<br>";let _='<span class="icn3d-seqLine">';o+=y+v+_,a+=y+v+_;let S="domain3d"+t.toString();for(let t=0,s=n.giSeq[e].length;t<s;++t)if(o+=n.showSeqCls.insertGap(e,t,"-"),f.hasOwnProperty(t+1)){let s=n.giSeq[e][t],i=s;s.length>1&&(i=s[0]+"..");let l=t>=n.matchedPos[e]&&t-n.matchedPos[e]<n.chainsSeq[e].length?n.chainsSeq[e][t-n.matchedPos[e]].resi:n.baseResi[e]+1+t;o+='<span id="'+S+"_"+n.pre+e+"_"+l+'" title="'+i+l+'" class="icn3d-residue">'+s+"</span>"}else o+="<span>-</span>";let w=n.firstAtomObjCls.getFirstCalphaAtomObj(n.chains[e]),A=void 0===w.color||"FFFFFF"===w.color.getHexString()?"DDDDDD":w.color.getHexString(),x=void 0!==w.color?A:"CCCCCC";if(r.cfg.blast_rep_id!=e)for(let s=0,i=C.length;s<i;++s){a+='<div style="display:inline-block; width:'+(0==s?Math.round(n.seqAnnWidth*(C[s]-n.baseResi[e]-1)/n.maxAnnoLength):Math.round(n.seqAnnWidth*(C[s]-g[s-1]-1)/n.maxAnnoLength))+'px;">&nbsp;</div>',a+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+x+"; width:"+Math.round(n.seqAnnWidth*(g[s]-C[s]+1)/n.maxAnnoLength)+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(t+1).toString()+'" from="'+C+'" to="'+g+'" shorttitle="'+h+'" index="'+t+'" setname="'+e+"_3d_domain_"+(t+1).toString()+'" id="'+e+"_3d_domain_"+t+'" anno="sequence" chain="'+e+'" title="'+c+'">3D domain '+(t+1).toString()+"</div>"}else{let s=[],i=[];for(let e=0,t=C.length;e<t;++e){s.push(C[e]);for(let t=C[e];t<=g[e];++t)void 0!==n.targetGapHash&&n.targetGapHash.hasOwnProperty(t)&&(i.push(t-1),s.push(t));i.push(g[e])}for(let l=0,r=s.length;l<r;++l){a+=n.showSeqCls.insertGapOverview(e,s[l]),a+='<div style="display:inline-block; width:'+(0==l?Math.round(n.seqAnnWidth*(s[l]-n.baseResi[e]-1)/(n.maxAnnoLength+n.nTotalGap)):Math.round(n.seqAnnWidth*(s[l]-i[l-1]-1)/(n.maxAnnoLength+n.nTotalGap)))+'px;">&nbsp;</div>',a+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+x+"; width:"+Math.round(n.seqAnnWidth*(i[l]-s[l]+1)/(n.maxAnnoLength+n.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(t+1).toString()+'" from="'+s+'" to="'+i+'" shorttitle="'+h+'" index="'+t+'" setname="'+e+"_3d_domain_"+(t+1).toString()+'" id="'+e+"_3d_domain_"+t+'" anno="sequence" chain="'+e+'" title="'+c+'">3D domain '+(t+1).toString()+"</div>"}}_='<span class="icn3d-residueNum" title="residue count">&nbsp;'+b.toString()+" Residues</span>",_+="</span>",_+="<br>",o+=_,a+=_}o+="</div>",a+="</div>",d+="</div>",$("#"+n.pre+"dt_domain_"+e).html(o),$("#"+n.pre+"ov_domain_"+e).html(a),$("#"+n.pre+"tt_domain_"+e).html(d)}}class Re{constructor(e){this.icn3d=e}navClinVar(e){let t=this.icn3d;t.icn3dui;let s=this;t.currClin[e]=-1,$(document).on("click","#"+t.pre+e+"_prevclin",(function(t){let i=s.icn3d;t.stopImmediatePropagation();let l=void 0!==i.resi2disease_nonempty[e]?Object.keys(i.resi2disease_nonempty[e]).length:0;--i.currClin[e],i.currClin[e]<0&&(i.currClin[e]=l-1),s.showClinVarLabelOn3D(e)})),$(document).on("click","#"+t.pre+e+"_nextclin",(function(t){let i=s.icn3d;t.stopImmediatePropagation();let l=void 0!==i.resi2disease_nonempty[e]?Object.keys(i.resi2disease_nonempty[e]).length:0;++i.currClin[e],i.currClin[e]>l-1&&(i.currClin[e]=0),s.showClinVarLabelOn3D(e)}))}showClinVarLabelOn3D(e){let t,s,i=this.icn3d,l=i.icn3dui,n=Object.keys(i.resi2disease_nonempty[e]);t=e,s=t+"_"+(parseInt(n[i.currClin[e]])+i.baseResi[e]).toString();let r="",o=i.resi2disease_nonempty[e][n[i.currClin[e]]];for(let e=0,t=o.length;e<t;++e)if(""!=o[e]&&"not specified"!=o[e]&&"not provided"!=o[e]){r=o[e];break}""==r&&(r=o.length>0?o[0]:"N/A");let a=i.applyCenterCls.centerAtoms(l.hashUtilsCls.hash2Atoms(i.residues[s],i.atoms));r.length>30&&(r=r.substr(0,30)+"..."),i.selectionCls.removeSelection(),null==i.labels&&(i.labels={}),i.labels.clinvar=[];let d=i.LABELSIZE,c="black"!=i.opts.background?i.colorWhitebkgd:i.colorBlackbkgd;i.analysisCls.addLabel(r,a.center.x+1,a.center.y+1,a.center.z+1,d,c,void 0,"clinvar"),i.hAtoms={};for(let e in i.residues[s])i.hAtoms[e]=1;$("#clinvar_"+i.pre+s).addClass("icn3d-highlightSeq"),void 0===$("#"+i.pre+"modeswitch")[0]||$("#"+i.pre+"modeswitch")[0].checked||i.definedSetsCls.setMode("selection"),i.drawCls.draw()}getSnpLine(e,t,s,i,l,n,r,o,a,d,c,h,m,p,u,C){let g=this.icn3d,f=g.icn3dui,b="",y=p?"clinvar":"snp",v=!1;for(let e in i){for(let t=0,s=i[e].length;t<s;++t)if(0==i[e][t]){v=!0;break}if(v)break}if(c){let e="ClinVar",t="SNP",s="",i="";v||void 0===g.organism||"human"===g.organism||"homo sapiens"===g.organism||(s=" <span style='color:#FFA500'>(from human)</span>",i=" <span style='color:#FFA500'>(based on human sequences and mapped to this structure by sequence similarity)</span>"),b+=p?'<div class="icn3d-seqTitle icn3d-link icn3d-blue icn3d-clinvar-path" clinvar="clinvar" posarray="'+d+'" shorttitle="'+e+'" setname="'+h+"_"+e+'" anno="sequence" chain="'+h+'" title="'+e+i+'">'+e+s+"</div>":'<div class="icn3d-seqTitle icn3d-link icn3d-blue" clinvar="clinvar" posarray="'+a+'" shorttitle="'+t+'" setname="'+h+"_"+t+'" anno="sequence" chain="'+h+'" title="'+t+i+'">'+t+s+"</div>"}else if(2==e&&p){let e=f.utilsCls.isMobile()?"none":"button";b+='<div id="'+g.pre+h+'_prevclin" style="display:inline-block; font-size:11px; font-weight:bold; width:60px!important;"><button class="link" style="-webkit-appearance:'+e+'; height:18px; width:55px;"><span style="white-space:nowrap; margin-left:-40px;" title="Show the previous ClinVar on structure">&lt; ClinVar</span></button></div>',b+='<div id="'+g.pre+h+'_nextclin" style="display:inline-block; font-size:11px; font-weight:bold; width:60px!important;"><button class="link" style="-webkit-appearance:'+e+'; height:18px; width:55px;"><span style="white-space:nowrap; margin-left:-40px;" title="Show the next ClinVar on structure">ClinVar &gt;</span></button></div>'}else b+='<div class="icn3d-seqTitle"></div>';let _=y,S=0,w=0,A={},x={};for(let t=1,i=g.giSeq[h].length;t<=i;++t)if(void 0!==r[t]){++S;let i="";for(let l=0,r=s[t].length;l<r&&!C;++l){let s=n[t][l].split("; "),r=o[t][l].split("; "),a="";for(let e=0,t=s.length;e<t;++e)a+=s[e]+"("+r[e]+"); ";""!=a&&(A[t]="icn3d-clinvar",l==e-2&&(x[t]="icn3d-clinvar",-1!=a.indexOf("Pathogenic")&&(x[t]="icn3d-clinvar-path"))),i+=a+" | "}-1!=i.indexOf("Pathogenic")&&(A[t]="icn3d-clinvar-path"),"icn3d-clinvar"!=A[t]&&"icn3d-clinvar-path"!=A[t]||++w}if(0==S&&!p)return $("#"+g.pre+"dt_clinvar_"+h).html(""),$("#"+g.pre+"ov_clinvar_"+h).html(""),$("#"+g.pre+"tt_clinvar_"+h).html(""),$("#"+g.pre+"dt_snp_"+h).html(""),$("#"+g.pre+"ov_snp_"+h).html(""),$("#"+g.pre+"tt_snp_"+h).html(""),"";if(0==w&&p)return $("#"+g.pre+"dt_clinvar_"+h).html(""),$("#"+g.pre+"ov_clinvar_"+h).html(""),$("#"+g.pre+"tt_clinvar_"+h).html(""),"";let k=p?w:S;if(b+=1==e?'<span class="icn3d-residueNum" title="residue count">'+k+" Res</span>":'<span class="icn3d-residueNum"></span>',u)return b+"<br>";b+='<span class="icn3d-seqLine">';let O="",H=0,D=0;for(let t=1,a=g.giSeq[h].length;t<=a;++t)if(m){if(void 0!==r[t]){let e=g.giSeq[h][t-1],i=e;e.length>1&&(i=e[0]+"..");let l=(t>=g.matchedPos[h]&&t-1-g.matchedPos[h]<g.chainsSeq[h].length?g.chainsSeq[h][t-1-g.matchedPos[h]].resi:g.baseResi[h]+1+t-1)+i+">";for(let e=0,i=s[t].length;e<i;++e)if(l+=s[t][e],!C){let s=n[t][e].split("; "),i=o[t][e].split("; "),l="";for(let e=0,t=s.length;e<t;++e)l+=s[e]+"("+i[e]+"); "}b+=g.showSeqCls.insertGapOverview(h,t-1);let r=f.cfg.blast_rep_id==h?Math.round(g.seqAnnWidth*(t-1)/(g.maxAnnoLength+g.nTotalGap)-H-D):Math.round(g.seqAnnWidth*(t-1)/g.maxAnnoLength-H-D);p?"icn3d-clinvar"!=A[t]&&"icn3d-clinvar-path"!=A[t]||r>=0&&(b+='<div style="display:inline-block; width:'+r+'px;">&nbsp;</div>',b+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+l+'">&nbsp;</div>',H+=r,D+=1):r>0&&(b+='<div style="display:inline-block; width:'+r+'px;">&nbsp;</div>',b+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+l+'">&nbsp;</div>',H+=r,D+=1)}}else if(b+=g.showSeqCls.insertGap(h,t-1,"-"),void 0!==r[t])if(p||1!=e){let r=g.giSeq[h][t-1],a=r;r.length>1&&(a=r[0]+"..");let d,c=t>=g.matchedPos[h]&&t-1-g.matchedPos[h]<g.chainsSeq[h].length?g.chainsSeq[h][t-1-g.matchedPos[h]].resi:g.baseResi[h]+1+t-1,m="",u="<div class='snptip'>",y=s[t].length,v=0,S=0;if(2==e&&(v=0,S=y),p){d=1;let r=0;for(let e=v;e<y&&e<S;++e){let p=h+"_"+c+"_"+s[t][e],C=f.utilsCls.isMobile()?"none":"button",b=!0;g.residues.hasOwnProperty(h+"_"+c)||(b=!1);let v=n[t][e].split("; "),_=o[t][e].split("; "),S="",w=0;for(let t=0,s=v.length;t<s;++t)w>0?S+="; ":0!==e&&1!==e||(O='disease="'+v[t]+'"'),S+=v[t]+"("+_[t]+")",++w;""!=S&&(r<d&&(m+=s[t][e]),u+=c+a+">"+s[t][e],u+=": "+S,b&&!f.cfg.hidelicense&&(u+="<br>"+g.showAnnoCls.addSnpButton(p,"snpin3d","3D with scap","SNP in 3D with scap",70,C)+"&nbsp;&nbsp;",u+=g.showAnnoCls.addSnpButton(p,"snpinter","Interactions","SNP Interactions in 3D",70,C)+"&nbsp;&nbsp;",u+=g.showAnnoCls.addSnpButton(p,"snppdb","PDB","Download SNP PDB",35,C)),u+="<br>Links: <a href='https://www.ncbi.nlm.nih.gov/clinvar/?term="+l[t][e]+"[AlleleID]' target='_blank'>ClinVar</a>, <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+i[t][e]+"' target='_blank'>dbSNP(rs"+i[t][e]+")</a>",e<y-1&&(u+="<br><br>"),++r)}r>d&&2==e&&(m+="..")}else{d=1;for(let e=v;e<y&&e<S;++e){let r=h+"_"+c+"_"+s[t][e],p=f.utilsCls.isMobile()?"none":"button",b=!0;if(g.residues.hasOwnProperty(h+"_"+c)||(b=!1),e<d&&(m+=s[t][e]),u+=c+a+">"+s[t][e],C)b&&!f.cfg.hidelicense&&(u+="<br>"+g.showAnnoCls.addSnpButton(r,"snpin3d","3D with scap","SNP in 3D with scap",70,p)+"&nbsp;&nbsp;",u+=g.showAnnoCls.addSnpButton(r,"snpinter","Interactions","SNP Interactions in 3D",70,p)+"&nbsp;&nbsp;",u+=g.showAnnoCls.addSnpButton(r,"snppdb","PDB","Download SNP PDB",35,p)),0!=i[t][e]&&(u+="<br>Link: <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+i[t][e]+"' target='_blank'>dbSNP(rs"+i[t][e]+")</a>"),e<y-1&&(u+="<br><br>");else{let s=n[t][e].split("; "),a=o[t][e].split("; "),d="",c=0;for(let t=0,i=s.length;t<i;++t)c>0?d+="; ":0!==e&&1!==e||(O='disease="'+s[t]+'"'),d+=s[t]+"("+a[t]+")",++c;""!=d?(u+=": "+d,b&&!f.cfg.hidelicense&&(u+="<br>"+g.showAnnoCls.addSnpButton(r,"snpin3d","3D with scap","SNP in 3D with scap",70,p)+"&nbsp;&nbsp;",u+=g.showAnnoCls.addSnpButton(r,"snpinter","Interactions","SNP Interactions in 3D",70,p)+"&nbsp;&nbsp;",u+=g.showAnnoCls.addSnpButton(r,"snppdb","PDB","Download SNP PDB",35,p)),u+="<br>Links: <a href='https://www.ncbi.nlm.nih.gov/clinvar/?term="+l[t][e]+"[AlleleID]' target='_blank'>ClinVar</a>, <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+i[t][e]+"' target='_blank'>dbSNP(rs"+i[t][e]+")</a>"):(b&&!f.cfg.hidelicense&&(u+="<br>"+g.showAnnoCls.addSnpButton(r,"snpin3d","3D with scap","SNP in 3D with scap",70,p)+"&nbsp;&nbsp;",u+=g.showAnnoCls.addSnpButton(r,"snpinter","Interactions","SNP Interactions in 3D",70,p)+"&nbsp;&nbsp;",u+=g.showAnnoCls.addSnpButton(r,"snppdb","PDB","Download SNP PDB",35,p)),u+="<br>Link: <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+i[t][e]+"' target='_blank'>dbSNP(rs"+i[t][e]+")</a>"),e<y-1&&(u+="<br><br>")}}y>d&&2==e&&(m+="..")}u+="</div>",p?"icn3d-clinvar"==A[t]||"icn3d-clinvar-path"==A[t]?b+=1==e?"<span>&dArr;</span>":""==m||" "==m?"<span>-</span>":'<span id="'+_+"_"+g.pre+h+"_"+c+'" label title="'+u+'" '+O+' class="icn3d-tooltip icn3d-residue '+x[t]+'">'+m+"</span>":b+="<span>-</span>":b+=""==m||" "==m?"<span>-</span>":C?'<span id="'+_+"_"+g.pre+h+"_"+c+'" label title="'+u+'" class="icn3d-tooltip icn3d-residue '+x[t]+'">'+m+"</span>":'<span id="'+_+"_"+g.pre+h+"_"+c+'" label title="'+u+'" '+O+' class="icn3d-tooltip icn3d-residue '+x[t]+'">'+m+"</span>"}else b+="<span>&dArr;</span>";else b+="<span>-</span>";return b+=1==e?'<span class="icn3d-residueNum" title="residue count">&nbsp;'+k+" Residues</span>":'<span class="icn3d-residueNum"></span>',b+="</span>",b+="<br>",b}processSnpClinvar(e,t,s,i,l){let n=this.icn3d;n.icn3dui;let r='<div id="'+n.pre+t+'_snpseq_sequence" class="icn3d-dl_sequence">',o=r,a=r,d='<div id="'+n.pre+t+'_clinvarseq_sequence" class="icn3d-dl_sequence">',c=d,h=d,m=!i||l?e.data:e.split("\n"),p={},u={},C={};void 0===n.resi2disease_nonempty[t]&&(n.resi2disease_nonempty[t]={});let g={},f={},b={},y={},v={},_="";for(let e=0,s=m.length;e<s;++e)if(""!=m[e]){let s=!i||l?m[e]:m[e].split("\t"),r=s[3];if(r==_)continue;_=r;let o=r.substr(0,r.length-3),a=Math.round(o);r.substr(r.length-3,1);let d=r.substr(r.indexOf(">")+1),c=s[4],h=i?"":s[5],S=i?"":s[6],w=i?"":s[7];y[a+n.baseResi[t]]=1,""!=S&&(v[a+n.baseResi[t]]=1),u[a]=e+1,void 0===p[a]&&(p[a]=[]),p[a].push(d),void 0===f[a]&&(f[a]=[]),f[a].push(c),void 0===b[a]&&(b[a]=[]),b[a].push(h),void 0===C[a]&&(C[a]=[]),C[a].push(S),""!=S&&(void 0===n.resi2disease_nonempty[t][a]&&(n.resi2disease_nonempty[t][a]=[]),n.resi2disease_nonempty[t][a].push(S)),void 0===g[a]&&(g[a]=[]),g[a].push(w)}let S=Object.keys(y),w=Object.keys(v);if(i){let e=!1;r+=this.getSnpLine(1,2,p,f,b,C,u,g,S,w,1,t,!1,e,void 0,i),r+=this.getSnpLine(2,2,p,f,b,C,u,g,S,w,0,t,!1,e,void 0,i),a+=this.getSnpLine(1,2,p,f,b,C,u,g,S,w,1,t,!1,e,!0,i),a+=this.getSnpLine(2,2,p,f,b,C,u,g,S,w,0,t,!1,e,!0,i),o+=this.getSnpLine(1,2,p,f,b,C,u,g,S,w,1,t,!0,e,void 0,i),r+="</div>",o+="</div>",a+="</div>",$("#"+n.pre+"dt_snp_"+t).html(r),$("#"+n.pre+"ov_snp_"+t).html(o),$("#"+n.pre+"tt_snp_"+t).html(a)}else{let e=!0;d+=this.getSnpLine(1,2,p,f,b,C,u,g,S,w,1,t,!1,e,void 0,i),d+=this.getSnpLine(2,2,p,f,b,C,u,g,S,w,0,t,!1,e,void 0,i),h+=this.getSnpLine(1,2,p,f,b,C,u,g,S,w,1,t,!1,e,!0,i),h+=this.getSnpLine(2,2,p,f,b,C,u,g,S,w,0,t,!1,e,!0,i),c+=this.getSnpLine(1,2,p,f,b,C,u,g,S,w,1,t,!0,e,void 0,i),d+="</div>",c+="</div>",h+="</div>",$("#"+n.pre+"dt_clinvar_"+t).html(d),$("#"+n.pre+"ov_clinvar_"+t).html(c),$("#"+n.pre+"tt_clinvar_"+t).html(h),this.navClinVar(t,s)}n.showAnnoCls.enableHlSeq(),i?(n.bAjaxSnp=!0,void 0!==n.deferredSnp&&n.deferredSnp.resolve()):(n.bAjaxClinvar=!0,void 0!==n.deferredClinvar&&n.deferredClinvar.resolve())}showClinvarPart2(e,t,s){let i=this.icn3d;i.icn3dui;let l=this,n="https://www.ncbi.nlm.nih.gov/Structure/vastdyn/vastdyn.cgi?chainid_clinvar="+t;i.chainsGene[e]&&i.chainsGene[e].geneSymbol&&(n+="&gene="+i.chainsGene[e].geneSymbol),$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(s){if(s&&s.data&&s.data.length>0){let i=!1,n=s;l.processSnpClinvar(n,e,t,i)}else l.processNoClinvar(e)},error:function(t,s,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):this.processNoClinvar(e)}})}showSnp(e,t){this.icn3d.icn3dui,this.showSnpClinvar(e,t,!0)}showClinvar(e,t){this.icn3d.icn3dui,this.showSnpClinvar(e,t,!1)}showSnpClinvar(e,t,s){let i=this.icn3d.icn3dui,l=this,n=i.htmlCls.baseUrl+"vastdyn/vastdyn.cgi?chainid="+t;$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(i){let n=i.snpgi,r=i.gi;if(s)l.showSnpPart2(e,t,n);else{let s=n;[6137708,1942289,224510717,2624886,253723219,2554905,75765331,3660278,312207882,319443632,342350956,1827805,109157826,1065265,40889086,6730307,163931185,494469,163931091,60594093,55669745,18655489,17942684,6980537,166235465,6435586,4139398,4389047,364506122,78101667,262118402,20664221,2624640,158430173,494395,28948777,34810587,13399647,3660342,261278854,342350965,384482350,378792570,15988303,213424334,4558333,2098365,10835631,3318817,374074330,332639529,122919696,4389286,319443573,2781341,67464020,194709238,210061039,364506106,28949044,40889076,161172338,17943181,4557976,62738484,365813173,6137343,350610552,17942703,576308,223674070,15826518,1310997,93279697,4139395,255311799,157837067,361132363,357380836,146387678,383280379,1127268,299856826,13786789,1311054,46015217,3402130,381353319,30750059,218766885,340707375,27065817,355333104,2624634,62738384,241913553,304446010].includes(r)&&(s=r),l.showClinvarPart2(e,t,s)}},error:function(t,i,n){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):s?l.processNoSnp(e):l.processNoClinvar(e)}})}showSnpPart2(e,t,s){let i=this.icn3d;i.icn3dui;let l=this;if(void 0!==s){let s="https://www.ncbi.nlm.nih.gov/Structure/vastdyn/vastdyn.cgi?chainid_snp="+t;i.chainsGene[e]&&i.chainsGene[e].geneSymbol&&(s+="&gene="+i.chainsGene[e].geneSymbol),$.ajax({url:s,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(s){if(s&&s.data&&s.data.length>0){let i=!0,n=!0;l.processSnpClinvar(s,e,t,i,n)}else l.processNoSnp(e)},error:function(t,s,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):l.processNoSnp(e)}})}else this.processNoSnp(e),console.log("No gi was found for the chain "+t+"...")}processNoClinvar(e){let t=this.icn3d;t.icn3dui,console.log("No ClinVar data were found for the protein "+e+"..."),$("#"+t.pre+"dt_clinvar_"+e).html(""),$("#"+t.pre+"ov_clinvar_"+e).html(""),t.showAnnoCls.enableHlSeq(),t.bAjaxClinvar=!0,void 0!==t.deferredClinvar&&t.deferredClinvar.resolve()}processNoSnp(e){let t=this.icn3d;t.icn3dui,console.log("No SNP data were found for the protein "+e+"..."),$("#"+t.pre+"dt_snp_"+e).html(""),$("#"+t.pre+"ov_snp_"+e).html(""),t.showAnnoCls.enableHlSeq(),t.bAjaxSnp=!0,void 0!==t.deferredSnp&&t.deferredSnp.resolve()}}class Ie{constructor(e){this.icn3d=e}showTransmem(e,t){let s=this.icn3d;s.icn3dui;let i=this;void 0===s.ssbondpnts?setTimeout((function(){i.showTransmem_base(e,t)}),1e3):this.showTransmem_base(e,t)}showTransmem_base(e,t){let s=this.icn3d;s.icn3dui;let i={};for(let e in s.chains[t]){let t=s.atoms[e];if(t.coord.z<s.halfBilayerSize&&t.coord.z>-s.halfBilayerSize){i[t.structure+"_"+t.chain+"_"+t.resi]=1}}let l=Object.keys(i);s.annoCddSiteCls.showAnnoType(e,t,"transmem","Transmembrane domain",l)}}class Ee{constructor(e){this.icn3d=e}hideAllAnno(){let e=this.icn3d;e.icn3dui,this.hideAllAnnoBase(),$("[id^="+e.pre+"custom]").hide()}hideAllAnnoBase(){this.icn3d.icn3dui,this.setAnnoSeqBase(!1)}setAnnoSeqBase(e){let t=this.icn3d;t.icn3dui;let s=["site","snp","clinvar","cdd","domain","interaction","ssbond","crosslink","transmem"];for(let i in s){let l=s[i];e?$("[id^="+t.pre+l+"]").show():$("[id^="+t.pre+l+"]").hide()}}setAnnoTabBase(e){let t=this.icn3d;t.icn3dui;let s=["all","binding","snp","clinvar","cdd","3dd","interact","custom","ssbond","crosslink","transmem"];for(let i in s){let l=s[i];$("#"+t.pre+"anno_"+l).length&&($("#"+t.pre+"anno_"+l)[0].checked=e)}}setAnnoTabAll(){this.icn3d.icn3dui,this.setAnnoTabBase(!0),this.setAnnoSeqBase(!0),this.updateClinvar(),this.updateSnp(),this.updateDomain(),this.updateInteraction(),this.updateSsbond(),this.updateCrosslink(),this.updateTransmem()}hideAnnoTabAll(){this.icn3d.icn3dui,this.setAnnoTabBase(!1),this.hideAllAnno()}resetAnnoAll(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"dt_]").html(""),$("[id^="+e.pre+"tt_]").html(""),$("[id^="+e.pre+"ov_]").html(""),e.showAnnoCls.processSeqData(e.chainid_seq),this.setAnnoViewAndDisplay("detailed view"),this.resetAnnoTabAll()}resetAnnoTabAll(){let e=this.icn3d;e.icn3dui,$("#"+e.pre+"anno_binding").length&&$("#"+e.pre+"anno_binding")[0].checked&&$("[id^="+e.pre+"site]").show(),$("#"+e.pre+"anno_snp").length&&$("#"+e.pre+"anno_snp")[0].checked&&($("[id^="+e.pre+"snp]").show(),e.bSnpShown=!1,this.updateSnp()),$("#"+e.pre+"anno_clinvar").length&&$("#"+e.pre+"anno_clinvar")[0].checked&&($("[id^="+e.pre+"clinvar]").show(),e.bClinvarShown=!1,this.updateClinvar()),$("#"+e.pre+"anno_cdd").length&&$("#"+e.pre+"anno_cdd")[0].checked&&$("[id^="+e.pre+"cdd]").show(),$("#"+e.pre+"anno_3dd").length&&$("#"+e.pre+"anno_3dd")[0].checked&&($("[id^="+e.pre+"domain]").show(),e.bDomainShown=!1,this.updateDomain()),$("#"+e.pre+"anno_interact").length&&$("#"+e.pre+"anno_interact")[0].checked&&($("[id^="+e.pre+"interaction]").show(),e.bInteractionShown=!1,this.updateInteraction()),$("#"+e.pre+"anno_custom").length&&$("#"+e.pre+"anno_custom")[0].checked&&$("[id^="+e.pre+"custom]").show(),$("#"+e.pre+"anno_ssbond").length&&$("#"+e.pre+"anno_ssbond")[0].checked&&($("[id^="+e.pre+"ssbond]").show(),e.bSSbondShown=!1,this.updateSsbond()),$("#"+e.pre+"anno_crosslink").length&&$("#"+e.pre+"anno_crosslink")[0].checked&&($("[id^="+e.pre+"crosslink]").show(),e.bCrosslinkShown=!1,this.updateCrosslink()),$("#"+e.pre+"anno_transmem").length&&$("#"+e.pre+"anno_transmem")[0].checked&&($("[id^="+e.pre+"transmem]").show(),e.bTranememShown=!1,this.updateTransmem())}setAnnoTabCustom(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"custom]").show(),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!0)}hideAnnoTabCustom(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"custom]").hide(),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!1)}setAnnoTabClinvar(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"clinvar]").show(),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!0),this.updateClinvar()}hideAnnoTabClinvar(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"clinvar]").hide(),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!1)}setAnnoTabSnp(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"snp]").show(),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!0),this.updateSnp()}hideAnnoTabSnp(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"snp]").hide(),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!1)}setAnnoTabCdd(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"cdd]").show(),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!0)}hideAnnoTabCdd(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"cdd]").hide(),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!1)}setAnnoTab3ddomain(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"domain]").show(),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!0),this.updateDomain()}hideAnnoTab3ddomain(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"domain]").hide(),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!1)}setAnnoTabSite(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"site]").show(),$("[id^="+e.pre+"feat]").show(),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!0)}hideAnnoTabSite(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"site]").hide(),$("[id^="+e.pre+"feat]").hide(),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!1)}setAnnoTabInteraction(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"interaction]").show(),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!0),this.updateInteraction()}hideAnnoTabInteraction(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"interaction]").hide(),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!1)}setAnnoTabSsbond(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"ssbond]").show(),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!0),this.updateSsbond()}hideAnnoTabSsbond(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"ssbond]").hide(),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!1)}setAnnoTabCrosslink(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"crosslink]").show(),$("#"+e.pre+"anno_crosslink").length&&($("#"+e.pre+"anno_crosslink")[0].checked=!0),this.updateCrosslink()}hideAnnoTabCrosslink(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"crosslink]").hide(),$("#"+e.pre+"anno_crosslink").length&&($("#"+e.pre+"anno_crosslink")[0].checked=!1)}setAnnoTabTransmem(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"transmem]").show(),$("#"+e.pre+"anno_transmem").length&&($("#"+e.pre+"anno_transmem")[0].checked=!0),this.updateTransmem()}hideAnnoTabTransmem(){let e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"transmem]").hide(),$("#"+e.pre+"anno_transmem").length&&($("#"+e.pre+"anno_transmem")[0].checked=!1)}setTabs(){let e=this.icn3d,t=e.icn3dui,s=this;$("#"+e.pre+"dl_addtrack_tabs").tabs(),$("#"+e.pre+"dl_anno_view_tabs").tabs(),t.myEventCls.onIds("#"+e.pre+"anno_all","click",(function(i){$("#"+e.pre+"anno_all")[0].checked?(s.setAnnoTabAll(),t.htmlCls.clickMenuCls.setLogCmd("set annotation all",!0)):(s.hideAnnoTabAll(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation all",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_binding","click",(function(i){$("#"+e.pre+"anno_binding")[0].checked?(s.setAnnoTabSite(),t.htmlCls.clickMenuCls.setLogCmd("set annotation site",!0)):(s.hideAnnoTabSite(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation site",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_snp","click",(function(i){$("#"+e.pre+"anno_snp")[0].checked?(s.setAnnoTabSnp(),t.htmlCls.clickMenuCls.setLogCmd("set annotation snp",!0)):(s.hideAnnoTabSnp(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation snp",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_clinvar","click",(function(i){$("#"+e.pre+"anno_clinvar")[0].checked?(s.setAnnoTabClinvar(),t.htmlCls.clickMenuCls.setLogCmd("set annotation clinvar",!0)):(s.hideAnnoTabClinvar(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation clinvar",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_cdd","click",(function(e){s.clickCdd()})),t.myEventCls.onIds("#"+e.pre+"anno_3dd","click",(function(i){$("#"+e.pre+"anno_3dd")[0].checked?(s.setAnnoTab3ddomain(),t.htmlCls.clickMenuCls.setLogCmd("set annotation 3ddomain",!0)):(s.hideAnnoTab3ddomain(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation 3ddomain",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_interact","click",(function(i){$("#"+e.pre+"anno_interact")[0].checked?(s.setAnnoTabInteraction(),t.htmlCls.clickMenuCls.setLogCmd("set annotation interaction",!0)):(s.hideAnnoTabInteraction(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation interaction",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_custom","click",(function(i){$("#"+e.pre+"anno_custom")[0].checked?(s.setAnnoTabCustom(),t.htmlCls.clickMenuCls.setLogCmd("set annotation custom",!0)):(s.hideAnnoTabCustom(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation custom",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_ssbond","click",(function(i){$("#"+e.pre+"anno_ssbond")[0].checked?(s.setAnnoTabSsbond(),t.htmlCls.clickMenuCls.setLogCmd("set annotation ssbond",!0)):(s.hideAnnoTabSsbond(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation ssbond",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_crosslink","click",(function(i){$("#"+e.pre+"anno_crosslink")[0].checked?(s.setAnnoTabCrosslink(),t.htmlCls.clickMenuCls.setLogCmd("set annotation crosslink",!0)):(s.hideAnnoTabCrosslink(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation crosslink",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_transmem","click",(function(i){$("#"+e.pre+"anno_transmem").length&&$("#"+e.pre+"anno_transmem")[0].checked?(s.setAnnoTabTransmem(),t.htmlCls.clickMenuCls.setLogCmd("set annotation transmembrane",!0)):(s.hideAnnoTabTransmem(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation transmembrane",!0))}))}clickCdd(){let e=this.icn3d,t=e.icn3dui;$("[id^="+e.pre+"cdd]").length>0&&($("#"+e.pre+"anno_cdd")[0].checked?(this.setAnnoTabCdd(),t.htmlCls.clickMenuCls.setLogCmd("set annotation cdd",!0)):(this.hideAnnoTabCdd(),t.htmlCls.clickMenuCls.setLogCmd("hide annotation cdd",!0)))}showAnnoSelectedChains(){let e=this.icn3d,t=e.icn3dui,s={};for(let t in e.hAtoms){let i=e.atoms[t];s[i.structure+"_"+i.chain]=1}$("#"+e.pre+"dl_annotations > .icn3d-annotation").hide();for(let i in s){$("#"+e.pre+"anno_"+i).length&&$("#"+e.pre+"anno_"+i).show();let s=e.firstAtomObjCls.getFirstCalphaAtomObj(e.chains[i]);if(void 0!==s.resn){let i=t.utilsCls.residueName2Abbr(s.resn.substr(0,3));$("#"+e.pre+"anno_"+i).show()}}}showAnnoAllChains(){let e=this.icn3d;e.icn3dui,$("#"+e.pre+"dl_annotations > .icn3d-annotation").show()}setAnnoView(e){let t=this.icn3d;t.icn3dui,"detailed view"===e?(t.view="detailed view",$("#"+t.pre+"dl_anno_view_tabs").tabs("option","active",1)):(t.view="overview",$("#"+t.pre+"dl_anno_view_tabs").tabs("option","active",0))}setAnnoDisplay(e,t){let s=this.icn3d;s.icn3dui;let i=["giseq","custom","site","snp","clinvar","cdd","domain","interaction","ssbond","crosslink","transmem"];for(let l in i){let n=i[l];$("[id^="+s.pre+t+"_"+n+"]").attr("style",e)}}showFixedTitle(){this.icn3d.icn3dui;this.setAnnoDisplay("display:block;","tt")}hideFixedTitle(){this.icn3d.icn3dui;this.setAnnoDisplay("display:none!important;","tt")}setAnnoViewAndDisplay(e){let t=this.icn3d;if(t.icn3dui,"detailed view"===e){this.setAnnoView("detailed view");let e="display:block;";this.setAnnoDisplay(e,"dt"),$("#"+t.pre+"seqguide_wrapper").attr("style",e),e="display:none;",this.setAnnoDisplay(e,"ov")}else{this.setAnnoView("overview"),this.hideFixedTitle();let e="display:none;";this.setAnnoDisplay(e,"dt"),$("#"+t.pre+"seqguide_wrapper").attr("style",e),e="display:block;",this.setAnnoDisplay(e,"ov")}}updateClinvar(){let e=this.icn3d;if(e.icn3dui,void 0===e.bClinvarShown||!e.bClinvarShown)for(let t in e.protein_chainid){let s=e.protein_chainid[t];e.annoSnpClinVarCls.showClinvar(t,s)}e.bClinvarShown=!0}updateSnp(){let e=this.icn3d;if(e.icn3dui,void 0===e.bSnpShown||!e.bSnpShown)for(let t in e.protein_chainid){let s=e.protein_chainid[t];e.annoSnpClinVarCls.showSnp(t,s)}e.bSnpShown=!0}updateDomain(){let e=this.icn3d;e.icn3dui,void 0!==e.bDomainShown&&e.bDomainShown||e.annoDomainCls.showDomainAll(),e.bDomainShown=!0}updateInteraction(){let e=this.icn3d;if(e.icn3dui,void 0===e.bInteractionShown||!e.bInteractionShown)for(let t in e.interactChainbase){let s=e.interactChainbase[t];e.annoContactCls.showInteraction(t,s)}e.bInteractionShown=!0}updateSsbond(){let e=this.icn3d;if(e.icn3dui,void 0===e.bSSbondShown||!e.bSSbondShown)for(let t in e.ssbondChainbase){let s=e.ssbondChainbase[t];e.annoSsbondCls.showSsbond(t,s)}e.bSSbondShown=!0}updateCrosslink(){let e=this.icn3d;if(e.icn3dui,void 0===e.bCrosslinkShown||!e.bCrosslinkShown)for(let t in e.crosslinkChainbase){let s=e.crosslinkChainbase[t];e.annoCrossLinkCls.showCrosslink(t,s)}e.bCrosslinkShown=!0}updateTransmem(){let e=this.icn3d;if(e.icn3dui,void 0===e.bTranememShown||!e.bTranememShown)for(let t in e.protein_chainid){let s=e.protein_chainid[t];e.annoTransMemCls.showTransmem(t,s)}e.bTranememShown=!0}}class Te{constructor(e){this.icn3d=e}draw2Ddgm(e,t,s,i){let l=this.icn3d,n=l.icn3dui,r=.667,o={},a={},d={},c={},h={};if(void 0===e)return"";for(let i in e.moleculeInfor){let r="#"+("000000"+e.moleculeInfor[i].color.toString(16)).slice(-6),m=e.moleculeInfor[i].chain.trim();void 0===h[m]?h[m]=1:++h[m];let p=1===h[m]?m:m+h[m].toString(),u=t+"_"+p;void 0!==l.mmdbid_q&&l.mmdbid_q===l.mmdbid_t&&0===s&&(u=t+n.htmlCls.postfix+"_"+p),o[i]=u,a[i]=r,d[i]=e.moleculeInfor[i].name,c[u]=i}if(void 0===i||!i)for(let s=0,i=e.intracResidues.length;s<i;++s){let i,n,r=e.intracResidues[s],a=0;for(let e in r){let t;t=o[e],0===a?i=t:n=t,++a}if(void 0!==i&&void 0!==n){a=0;for(let e in r){let s,o,d=r[e];0===a?(s=i,o=n):(s=n,o=i),void 0===l.chainids2resids[s]&&(l.chainids2resids[s]={}),void 0===l.chainids2resids[s][o]&&(l.chainids2resids[s][o]=[]);for(let i=0,n=d.length;i<n;++i){let n=d[i],r=l.mmdbMolidResid2mmdbChainResi[t.toUpperCase()+"_"+e+"_"+n];l.chainids2resids[s][o].push(r)}if(void 0===l.chainname2residues&&(l.chainname2residues={}),n=o,!l.chains.hasOwnProperty(n))continue;let c,h=l.firstAtomObjCls.getFirstCalphaAtomObj(l.chains[n]);l.chemicals.hasOwnProperty(h.serial)?c="chemical":l.nucleotides.hasOwnProperty(h.serial)?c="nucleotide":l.ions.hasOwnProperty(h.serial)?c="ion":l.proteins.hasOwnProperty(h.serial)?c="protein":l.water.hasOwnProperty(h.serial)&&(c="water");let m=n.substr(n.indexOf("_")+1)+"("+c+")";void 0===l.chainname2residues[s]&&(l.chainname2residues[s]={}),l.chainname2residues[s][m]=l.chainids2resids[s][o],++a}}}let m="<div id='#"+l.pre+t+"'>";m+="<b>"+t.toUpperCase()+"</b><br/>",m+="<svg viewBox='0,0,"+n.htmlCls.width2d+","+n.htmlCls.width2d+"'>";let p={},u=[],C="",g="",f={};if(i)for(let e in l.dAtoms){let t=l.atoms[e];f[c[t.structure+"_"+t.chain]]=1}let b=Object.keys(e.moleculeInfor),y=Object.keys(e.intrac),v=[];for(let e=0,t=b.length;e<t;++e)-1===y.indexOf(b[e])&&v.push(b[e]);let _={};if(v.length>0)for(let t in e.intrac){let s=e.intrac[t];for(let e=0,i=s.intrac.length;e<i;++e){let i=s.intrac[e].toString();-1!==v.indexOf(i)&&(void 0===_[i]&&(_[i]=[]),_[i].push(t),u.push([i,t]))}if("rect"===s.shape){let e=s.coords[0]*r,i=s.coords[1]*r,l=s.coords[2]*r-e,n=s.coords[3]*r-i;p[t]=[e+l/2,i+n/2]}else if("circle"===s.shape){let e=s.coords[0]*r,i=s.coords[1]*r;s.coords[2],p[t]=[e,i]}else if("poly"===s.shape){let e=s.coords[0]*r;s.coords[1],s.coords[2];let i=s.coords[3]*r;s.coords[4],s.coords[5],s.coords[6],s.coords[7],p[t]=[e,i]}}let S=0;for(let t=0,n=b.length;t<n;++t){let n=b[t],c=o[n];if(i&&!f.hasOwnProperty(n))continue;let h=e.intrac[n],m="#FFFFFF",y=a[n];if(void 0!==c&&void 0!==l.chains[c]){let e=Object.keys(l.chains[c]);e.length>0&&(y="#"+l.atoms[e[0]].color.getHexString().toUpperCase())}let w="";l.bInitial&&void 0!==s&&(void 0!==l.alignmolid2color&&l.alignmolid2color[s].hasOwnProperty(n)?(w=l.alignmolid2color[s][n],y="#FF0000"):y="#FFFFFF");let A=d[n],x=" ",k=" ";if(void 0!==c){let e=c.indexOf("_");k=c.substr(e+1),x=k.length>1?k.substr(0,1)+"..":k}else c="Misc";void 0===y&&(y="#FFFFFF");let O=1;if(l.bInitial&&void 0!==l.alnChains[c]){let e=0;for(let t in l.alnChains[c]){let s=l.atoms[t].color.getHexString().toUpperCase();"FF0000"!==s&&"00FF00"!==s||++e}O=1*e/Object.keys(l.chains[c]).length}if(O<.2&&(O=.2),-1===v.indexOf(n)){for(let e=0,t=h.intrac.length;e<t;++e)parseInt(n)<parseInt(h.intrac[e])&&u.push([n,h.intrac[e]]);if("rect"===h.shape){let e=h.coords[0]*r,t=h.coords[1]*r,s=h.coords[2]*r-e,i=h.coords[3]*r-t;C+=this.draw2DNucleotide(e+.5*s,t+.5*i,c,k,x,A,w,m,y,r,O),p[n]=[e+s/2,t+i/2]}else if("circle"===h.shape){let e=h.coords[0]*r,t=h.coords[1]*r;C+=this.draw2DProtein(e,t,c,k,x,A,w,m,y,r,O),p[n]=[e,t]}else if("poly"===h.shape){let e=h.coords[0]*r;h.coords[1],h.coords[2];let t=h.coords[3]*r;h.coords[4],h.coords[5],h.coords[6],h.coords[7];let s=e,i=t;l.firstAtomObjCls.getFirstAtomObj(l.chains[c]),g+=this.draw2DChemical(s,i,c,k,x,A,w,m,y,r,O),p[n]=[e,t]}}else{let e,t,s=300,i=50;if(void 0!==_[n]&&_[n].length>1){let s=0,i=0;for(let e=0,t=_[n].length;e<t;++e){let t=_[n][e];if(p.hasOwnProperty(t)){let e=p[t];s+=e[0],i+=e[1]}}e=s/_[n].length,t=i/_[n].length}else{let l=s/i;S<l-1?(e=(S+1)*i*r,t=.1*s*r):S-(l-1)<l-1?(e=.1*s*r,t=(S-(l-1)+1)*i*r):(e=.25*s*r,t=e),++S}let o=e,a=t;l.firstAtomObjCls.getFirstAtomObj(l.chains[c]);let d=!0;g+=this.draw2DChemical(o,a,c,k,x,A,w,m,y,r,O,d),p[n]=[o,a]}}for(let e=0,t=u.length;e<t;++e){let t=u[e];if(i&&(!f.hasOwnProperty(t[0])||!f.hasOwnProperty(t[1])))continue;let s,l,n=p[parseInt(t[0])],r=p[parseInt(t[1])];if(void 0===n||void 0===r)continue;s=o[t[0]],l=o[t[1]];let a=s.indexOf("_"),d=l.indexOf("_"),c=s.substr(a+1),h=l.substr(d+1),C=n[0],g=n[1],b=r[0],y=r[1],v=.5*(C+b),_=.5*(g+y);m+="<g class='icn3d-interaction' chainid1='"+s+"' chainid2='"+l+"' >",m+="<title>Interaction of chain "+c+" with chain "+h+"</title>",m+="<line x1='"+C+"' y1='"+g+"' x2='"+v+"' y2='"+_+"' stroke='"+"#000000' stroke-width='2' /></g>",m+="<g class='icn3d-interaction' chainid1='"+l+"' chainid2='"+s+"' >",m+="<title>Interaction of chain "+h+" with chain "+c+"</title>",m+="<line x1='"+v+"' y1='"+_+"' x2='"+b+"' y2='"+y+"' stroke='"+"#000000' stroke-width='2' /></g>"}return m+=g+C,m+="</svg>",m+="</div>",l.html2ddgm+=m,$("#"+l.pre+"dl_2ddgm").html(l.html2ddgm),m}set2DdgmNote(e){let t="<div style='width:150px'><b>Nodes</b>:<br>";return this.icn3d.icn3dui.utilsCls.isMac()?(t+="<span style='margin-right:18px;'>&#9711;</span>Protein<br>",t+="<span style='margin-right:18px;'>&#9634;</span>Nucleotide<br>",t+="<span style='margin-right:18px;'>&#9826;</span>Chemical<br>",t+="<span style='margin-right:18px;display: inline-block;transform: skew(-25deg);'>&#9634;</span>Biopolymer<br>"):(t+="<span style='margin-right:18px;'>O</span>Protein<br>",t+="<span style='margin-right:18px;'>&#9634;</span>Nucleotide<br>",t+="<span style='margin-right:18px;'>&#9671;</span>Chemical<br>",t+="<span style='margin-right:18px;display: inline-block;transform: skew(-25deg);'>&#9634;</span>Biopolymer<br>"),t+="<br><b>Lines</b>:<br> Interactions at 4 &#197;<br>",e&&(t+="<b>Numbers in red</b>:<br> Aligned chains"),t+="</div><br/>",t}highlightNode(e,t,s,i){let l=this.icn3d.icn3dui;i<.2&&(i=.2);if("rect"===e){$(t).attr("stroke",l.htmlCls.ORANGE),$(t).attr("stroke-width",3);let e=Number($(s).attr("x")),n=Number($(s).attr("y")),r=Number($(s).attr("width")),o=Number($(s).attr("height"));$(t).attr("x",e+r/2*(1-i)),$(t).attr("y",n+o/2*(1-i)),$(t).attr("width",r*i),$(t).attr("height",o*i)}else if("circle"===e)$(t).attr("stroke",l.htmlCls.ORANGE),$(t).attr("stroke-width",3),$(t).attr("r",Number($(s).attr("r"))*i);else if("polygon"===e){$(t).attr("stroke",l.htmlCls.ORANGE),$(t).attr("stroke-width",3);let e=Number($(s).attr("x")),n=Number($(s).attr("y")),r=Number($(s).attr("x0d")),o=Number($(s).attr("y0d")),a=Number($(s).attr("x1d")),d=Number($(s).attr("y1d")),c=Number($(s).attr("x2d")),h=Number($(s).attr("y2d")),m=Number($(s).attr("x3d")),p=Number($(s).attr("y3d"));$(t).attr("points",(e+r*i).toString()+", "+(n+o*i).toString()+", "+(e+a*i).toString()+", "+(n+d*i).toString()+", "+(e+c*i).toString()+", "+(n+h*i).toString()+", "+(e+m*i).toString()+", "+(n+p*i).toString())}}removeLineGraphSelection(){let e=this.icn3d;e.icn3dui,$("#"+e.pre+"dl_linegraph circle").attr("stroke","#000000"),$("#"+e.pre+"dl_linegraph circle").attr("stroke-width",1),$("#"+e.pre+"dl_linegraph svg line.icn3d-hlline").attr("stroke","#FFF")}removeScatterplotSelection(){let e=this.icn3d;e.icn3dui,$("#"+e.pre+"dl_scatterplot circle").attr("stroke","#000000"),$("#"+e.pre+"dl_scatterplot circle").attr("stroke-width",1),$("#"+e.pre+"dl_scatterplot rect").attr("stroke","#000000"),$("#"+e.pre+"dl_scatterplot rect").attr("stroke-width",1)}click2Ddgm(){let e=this.icn3d,t=e.icn3dui,s=this;$(document).on("click","#"+e.pre+"dl_2ddgm .icn3d-node",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");let l=$(this).attr("chainid");i.bCtrl||i.bShift||(i.selectionCls.removeSelection(),i.lineArray2d=[]);let n=1;void 0!==i.alnChains[l]&&(n=1*Object.keys(i.alnChains[l]).length/Object.keys(i.chains[l]).length);let r=$(this).find("rect[class='icn3d-hlnode']"),o=$(this).find("rect[class='icn3d-basenode']");s.highlightNode("rect",r,o,n),r=$(this).find("circle[class='icn3d-hlnode']"),o=$(this).find("circle[class='icn3d-basenode']"),s.highlightNode("circle",r,o,n),r=$(this).find("polygon[class='icn3d-hlnode']"),o=$(this).find("polygon[class='icn3d-basenode']"),s.highlightNode("polygon",r,o,n),i.bCtrl||i.bShift?i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.chains[l]):i.hAtoms=t.hashUtilsCls.cloneHash(i.chains[l]),i.bCtrl||i.bShift?(void 0===i.chainArray2d&&(i.chainArray2d=[]),i.chainArray2d.push(l)):i.chainArray2d=[l],i.hlUpdateCls.updateHlAll(i.chainArray2d),i.annotationCls.showAnnoSelectedChains();let a="select chain "+l;t.htmlCls.clickMenuCls.setLogCmd(a,!0),i.bSelectResidue=!1})),$(document).on("click","#"+e.pre+"dl_2ddgm .icn3d-interaction",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection"),i.bClickInteraction=!0;let l=$(this).attr("chainid1"),n=$(this).attr("chainid2");$(this).find("line").attr("stroke",t.htmlCls.ORANGE),s.selectInteraction(l,n),i.annotationCls.showAnnoSelectedChains();let r="select interaction "+l+","+n;t.htmlCls.clickMenuCls.setLogCmd(r,!0),i.bClickInteraction=!1})),$(document).on("click","#"+e.pre+"dl_linegraph .icn3d-node",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");let l=$(this).attr("resid");i.bCtrl||i.bShift||(i.hAtoms={},s.removeLineGraphSelection());$(this).find("circle").attr("stroke",t.htmlCls.ORANGE),$(this).find("circle").attr("stroke-width",2),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[l]);let n="select "+i.resid2specCls.residueids2spec([l]);i.hlUpdateCls.updateHlAll(),t.htmlCls.clickMenuCls.setLogCmd(n,!0),i.bSelectResidue=!1})),$(document).on("click","#"+e.pre+"dl_scatterplot .icn3d-node",(function(e){s.icn3d,e.stopImmediatePropagation(),s.clickNode(this)})),$(document).on("click","#"+e.pre+"dl_linegraph .icn3d-interaction",(function(e){let i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");let l=$(this).attr("resid1"),n=$(this).attr("resid2");i.bCtrl||i.bShift||(i.hAtoms={},s.removeLineGraphSelection()),$(this).find("line.icn3d-hlline").attr("stroke",t.htmlCls.ORANGE),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[l]),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[n]);let r="select "+i.resid2specCls.residueids2spec([l,n]);i.hlUpdateCls.updateHlAll(),t.htmlCls.clickMenuCls.setLogCmd(r,!0)})),$(document).on("click","#"+e.pre+"dl_scatterplot .icn3d-interaction",(function(e){s.icn3d,e.stopImmediatePropagation(),s.clickInteraction(this)})),$(document).on("click","#"+e.pre+"dl_contactmap .icn3d-interaction",(function(e){s.icn3d,e.stopImmediatePropagation(),s.clickInteraction(this)})),$(document).on("click","#"+e.pre+"dl_contactmap .icn3d-node",(function(e){s.icn3d,e.stopImmediatePropagation(),s.clickNode(this)})),$(document).on("click","#"+e.pre+"dl_alignerrormap .icn3d-interaction",(function(e){s.icn3d,e.stopImmediatePropagation(),s.clickInteraction(this)})),$(document).on("click","#"+e.pre+"dl_alignerrormap .icn3d-node",(function(e){s.icn3d,e.stopImmediatePropagation(),s.clickNode(this)}))}clickNode(e){let t=this.icn3d,s=t.icn3dui;Object.keys(t.hAtoms).length<Object.keys(t.atoms).length&&t.definedSetsCls.setMode("selection");let i=$(e).attr("resid");t.bCtrl||t.bShift||(t.hAtoms={},this.removeScatterplotSelection());$(e).find("circle").attr("stroke",s.htmlCls.ORANGE),$(e).find("circle").attr("stroke-width",2),t.hAtoms=s.hashUtilsCls.unionHash(t.hAtoms,t.residues[i]);let l="select "+t.resid2specCls.residueids2spec([i]);t.hlUpdateCls.updateHlAll(),s.htmlCls.clickMenuCls.setLogCmd(l,!0),t.bSelectResidue=!1}clickInteraction(e){let t=this.icn3d,s=t.icn3dui;Object.keys(t.hAtoms).length<Object.keys(t.atoms).length&&t.definedSetsCls.setMode("selection");let i=$(e).attr("resid1"),l=$(e).attr("resid2");t.bCtrl||t.bShift||(t.hAtoms={},this.removeScatterplotSelection());$(e).find("rect").attr("stroke",s.htmlCls.ORANGE),$(e).find("rect").attr("stroke-width",2),t.hAtoms=s.hashUtilsCls.unionHash(t.hAtoms,t.residues[i]),t.hAtoms=s.hashUtilsCls.unionHash(t.hAtoms,t.residues[l]);let n="select "+t.resid2specCls.residueids2spec([i,l]);t.hlUpdateCls.updateHlAll(),s.htmlCls.clickMenuCls.setLogCmd(n,!0)}selectInteraction(e,t){let s=this.icn3d;s.icn3dui,s.hlUpdateCls.removeHl2D(),s.hlObjectsCls.removeHlObjects(),s.bCtrl||s.bShift?(void 0===s.lineArray2d&&(s.lineArray2d=[]),s.lineArray2d.push(e),s.lineArray2d.push(t)):s.lineArray2d=[e,t],this.selectInteractionAtoms(e,t),s.hlObjectsCls.addHlObjects(),s.hlUpdateCls.updateHlAll()}selectInteractionAtoms(e,t){let s,i,l=this.icn3d,n=l.icn3dui,r=l.chainids2resids[e][t];l.bCtrl||l.bShift||(l.hAtoms={});for(let e=0,t=r.length;e<t;++e)l.hAtoms=n.hashUtilsCls.unionHash(l.hAtoms,l.residues[r[e]]);if(Object.keys(l.structures).length>1)s="inter_"+e+"_"+t;else{let i=e.indexOf("_"),l=t.indexOf("_");s="inter_"+e.substr(i+1)+"_"+t.substr(l+1)}i="select the atoms in chain "+e+" interacting with chain "+t+" in a distance of 4 angstrom";let o="select interaction "+e+","+t;l.selectionCls.addCustomSelection(r,s,i,o,!0)}draw2DProtein(e,t,s,i,l,n,r,o,a,d,c){this.icn3d.icn3dui;let h=20*d,m="<g class='icn3d-node' chainid='"+s+"' >";return m+="<title>Chain "+i+": "+n+"</title>",m+="<circle class='icn3d-basenode' cx='"+e+"' cy='"+t+"' r='"+h+"' fill='"+o+"' stroke-width='1' stroke='"+"#000000' class='icn3d-node' chainid='"+s+"' />",m+="<circle class='icn3d-hlnode' cx='"+e+"' cy='"+t+"' r='"+(h*c).toString()+"' fill='"+a+"' stroke-width='1' stroke='"+"#000000' />",m+="<text x='"+(e-0).toString()+"' y='"+(t+4).toString()+"' style='fill:#000000; font-size:10; text-anchor:middle' >"+l+"</text>",""!==r&&(m+="<text x='"+(e-0).toString()+"' y='"+(t+h+4+6).toString()+"' style='fill:"+a+"; font-size:8; font-weight:bold; text-anchor:middle' >"+r+"</text>"),m+="</g>",m}draw2DNucleotide(e,t,s,i,l,n,r,o,a,d,c){this.icn3d.icn3dui;let h=30*d,m=30*d,p="<g class='icn3d-node' chainid='"+s+"' >";return p+="<title>Chain "+i+": "+n+"</title>",p+="<rect class='icn3d-basenode' x='"+(e-=.5*h)+"' y='"+(t-=.5*m)+"' width='"+h+"' height='"+m+"' fill='"+o+"' stroke-width='1' stroke='"+"#000000' />",p+="<rect class='icn3d-hlnode' x='"+(e+h/2*(1-c)).toString()+"' y='"+(t+m/2*(1-c)).toString()+"' width='"+(h*c).toString()+"' height='"+(m*c).toString()+"' fill='"+a+"' stroke-width='1' stroke='"+"#000000' />",p+="<text x='"+(e+h/2-0).toString()+"' y='"+(t+m/2+4).toString()+"' style='fill:#000000; font-size:10; text-anchor:middle' >"+l+"</text>",""!==r&&(p+="<text x='"+(e+h/2-0).toString()+"' y='"+(t+m+4+6).toString()+"' style='fill:"+a+"; font-size:8; font-weight:bold; text-anchor:middle' >"+r+"</text>"),p+="</g>",p}draw2DChemical(e,t,s,i,l,n,r,o,a,d,c,h){this.icn3d.icn3dui;let m,p,u,C,g,f,b,y,v=30*d;if(h){let s=.5*v/Math.sqrt(3),i=.5*v;m=e-s,p=t-i,u=e+3*s,C=t-i,g=e+s,f=t+i,b=e-3*s,y=t+i}else{let s=.5*v,i=.5*v;m=e-s,p=t,u=e,C=t+i,g=e+s,f=t,b=e,y=t-i}let _=m-e,S=p-t,w=u-e,A=C-t,x=g-e,k=f-t,O=b-e,H=y-t,D="<g class='icn3d-node' chainid='"+s+"' >";return D+="<title>Chain "+i+": "+n+"</title>",D+="<polygon class='icn3d-basenode' points='"+m+", "+p+","+u+", "+C+","+g+", "+f+","+b+", "+y+"' x='"+e+"' y='"+t+"' x0d='"+_+"' y0d='"+S+"' x1d='"+w+"' y1d='"+A+"' x2d='"+x+"' y2d='"+k+"' x3d='"+O+"' y3d='"+H+"' fill='"+o+"' stroke-width='1' stroke='"+"#000000' />",D+="<polygon class='icn3d-hlnode' points='"+(e+_*c).toString()+", "+(t+S*c).toString()+","+(e+w*c).toString()+", "+(t+A*c).toString()+","+(e+x*c).toString()+", "+(t+k*c).toString()+","+(e+O*c).toString()+", "+(t+H*c).toString()+"' fill='"+a+"' stroke-width='1' stroke='"+"#000000' />",D+="<text x='"+(e+1).toString()+"' y='"+(t+2).toString()+"' style='fill:#000000; font-size:8; text-anchor:middle' >"+l+"</text>",""!==r&&(D+="<text x='"+(e+1).toString()+"' y='"+(t+2+6).toString()+"' style='fill:"+a+"; font-size:8; font-weight:bold; text-anchor:middle' >"+r+"</text>"),D+="</g>",D}}class Me{constructor(e){this.icn3d=e}update2DdgmContent(){let e=this.icn3d,t=e.icn3dui,s="";void 0!==t.cfg.mmdbid||void 0!==t.cfg.gi?(s+=e.diagram2dCls.draw2Ddgm(e.interactionData,e.inputid,void 0,!0),s+=e.diagram2dCls.set2DdgmNote(),$("#"+e.pre+"dl_2ddgm").html(s)):e.mmdbidArray&&(void 0!==t.cfg.align||void 0!==t.cfg.chainalign||e.bRealign)&&(s+=e.diagram2dCls.draw2Ddgm(e.interactionData1,e.mmdbidArray[0].toUpperCase(),0,!0),void 0!==e.mmdbid_q&&e.mmdbid_q===e.mmdbid_t?s+=e.diagram2dCls.draw2Ddgm(e.interactionData2,e.mmdbidArray[0].toUpperCase(),1,!0):s+=e.diagram2dCls.draw2Ddgm(e.interactionData2,e.mmdbidArray[1].toUpperCase(),1,!0),s+=e.diagram2dCls.set2DdgmNote(!0),$("#"+e.pre+"dl_2ddgm").html(s))}changeSeqColor(e){let t=this.icn3d,s=t.icn3dui;for(let i=0,l=e.length;i<l;++i){let l=e[i],n=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[l]);if(!n)continue;let r=void 0===n.color||"FFFFFF"===n.color.getHexString().toUpperCase()?"DDDDDD":n.color.getHexString(),o=void 0!==n.color?r:"CCCCCC";$("[id=giseq_"+t.pre+l+"]").attr("style","color:#"+o),$("[id=align_"+t.pre+l+"]").attr("style","color:#"+o),(void 0!==s.cfg.align||void 0!==s.cfg.chainalign||t.bRealign||t.bSymd)&&$("[id=align_"+t.pre+l+"]").attr("style","color:#"+o)}}removeHlAll(){this.icn3d.icn3dui,this.removeHlObjects(),this.removeHlSeq(),this.removeHl2D(),this.removeHlMenus()}removeHlObjects(){let e=this.icn3d;e.icn3dui,e.hlObjectsCls.removeHlObjects()}removeHlSeq(){this.icn3d.icn3dui,this.removeSeqResidueBkgd()}removeHl2D(){let e=this.icn3d;e.icn3dui,$("#"+e.pre+"dl_2ddgm rect").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm circle").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm polygon").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm rect").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm circle").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm polygon").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm circle").length>0&&($("#"+e.pre+"dl_2ddgm svg line").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm line").attr("stroke-width",1))}removeHlMenus(){let e=this.icn3d;e.icn3dui,$("#"+e.pre+"atomsCustom").val(""),$("#"+e.pre+"atomsCustom")[0].blur()}updateHlAll(e,t,s,i){let l=this.icn3d,n=l.icn3dui;l.prevHighlightAtoms=n.hashUtilsCls.cloneHash(l.hAtoms),this.updateHlObjects(i),void 0!==e?this.updateHlSeqInChain(e,s):this.updateHlSeq(void 0,void 0,s),this.updateHl2D(),(void 0===t||t)&&this.updateHlMenus(e)}updateHlObjects(e){let t=this.icn3d;t.icn3dui,t.hlObjectsCls.removeHlObjects(),(t.hAtoms&&Object.keys(t.hAtoms).length<Object.keys(t.atoms).length||e)&&(t.hlObjectsCls.addHlObjects(),t.definedSetsCls.setMode("selection"))}updateHlSeq(e,t,s){let i=this.icn3d;i.icn3dui,void 0!==s&&s||this.removeHlSeq(),void 0===t&&(t=i.firstAtomObjCls.getResiduesFromCalphaAtoms(i.hAtoms)),i.hAtoms&&Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&this.hlSequence(Object.keys(t)),this.changeSeqColor(Object.keys(t))}updateHlSeqInChain(e,t){let s=this.icn3d;if(s.icn3dui,void 0!==t&&t||this.removeHlSeq(),!s.hAtoms||Object.keys(s.hAtoms).length!=Object.keys(s.atoms).length)for(let t=0,i=e.length;t<i;++t){let i=e[t];if(-1!==Object.keys(s.chains).indexOf(i))this.hlSeqInChain(i);else{let e=[];void 0!==s.defNames2Residues[i]&&s.defNames2Residues[i].length>0&&(e=s.defNames2Residues[i]);let t={};if(void 0!==s.defNames2Atoms[i]&&s.defNames2Atoms[i].length>0){for(let e=0,l=s.defNames2Atoms[i].length;e<l;++e){let l=s.defNames2Atoms[i][e],n=s.atoms[l];t[n.structure+"_"+n.chain+"_"+n.resi]=1}e=e.concat(Object.keys(t))}this.hlSequence(e)}}}updateHl2D(e){let t=this.icn3d,s=t.icn3dui;if(this.removeHl2D(),!t.hAtoms||Object.keys(t.hAtoms).length!=Object.keys(t.atoms).length){if(void 0===e){let s=t.firstAtomObjCls.getChainsFromAtoms(t.hAtoms);e=Object.keys(s)}if(void 0!==e)for(let i=0,l=e.length;i<l;++i){let l=s.hashUtilsCls.intHash(t.chains[e[i]],t.hAtoms),n=1*Object.keys(l).length/Object.keys(t.chains[e[i]]).length,r=t.firstAtomObjCls.getFirstCalphaAtomObj(l);if(void 0!==t.alnChains[e[i]]){let n=s.hashUtilsCls.intHash(t.alnChains[e[i]],l);Object.keys(n).length>0&&(r=t.firstAtomObjCls.getFirstCalphaAtomObj(n))}let o=void 0!==r&&void 0!==r.color?"#"+r.color.getHexString():"#FFFFFF",a=$("#"+t.pre+"dl_2ddgm g[chainid="+e[i]+"] rect[class='icn3d-hlnode']"),d=$("#"+t.pre+"dl_2ddgm g[chainid="+e[i]+"] rect[class='icn3d-basenode']");void 0!==a&&(t.diagram2dCls.highlightNode("rect",a,d,n),$(a).attr("fill",o)),a=$("#"+t.pre+"dl_2ddgm g[chainid="+e[i]+"] circle[class='icn3d-hlnode']"),d=$("#"+t.pre+"dl_2ddgm g[chainid="+e[i]+"] circle[class='icn3d-basenode']"),void 0!==a&&(t.diagram2dCls.highlightNode("circle",a,d,n),$(a).attr("fill",o)),a=$("#"+t.pre+"dl_2ddgm g[chainid="+e[i]+"] ellipse[class='icn3d-hlnode']"),void 0!==a&&t.diagram2dCls.highlightNode("ellipse",a,void 0,n),a=$("#"+t.pre+"dl_2ddgm g[chainid="+e[i]+"] polygon[class='icn3d-hlnode']"),d=$("#"+t.pre+"dl_2ddgm g[chainid="+e[i]+"] polygon[class='icn3d-basenode']"),void 0!==a&&(t.diagram2dCls.highlightNode("polygon",a,d,n),$(a).attr("fill",o))}if(void 0!==t.lineArray2d)for(let e=0,i=t.lineArray2d.length;e<i;e+=2)$("#"+t.pre+"dl_2ddgm g[chainid1="+t.lineArray2d[e]+"][chainid2="+t.lineArray2d[e+1]+"] line").attr("stroke",s.htmlCls.ORANGE);t.prevHighlightAtoms=s.hashUtilsCls.cloneHash(t.hAtoms),t.definedSetsCls.setMode("selection")}}updateHlMenus(e){let t=this.icn3d;t.icn3dui,void 0===e&&(e=[]);let s=t.definedSetsCls.setAtomMenu(e);$("#"+t.pre+"atomsCustom").length&&($("#"+t.pre+"atomsCustom").html(s),$("#"+t.pre+"atomsCustom")[0].blur())}hlSequence(e){let t=this.icn3d;t.icn3dui;let s={};for(let i=0,l=e.length;i<l;++i){let l=e[i],n=$("[id=giseq_"+t.pre+l+"]");0!==n.length&&n.addClass("icn3d-highlightSeq"),n=$("[id=align_"+t.pre+l+"]"),0!==n.length&&n.addClass("icn3d-highlightSeq");let r=l.lastIndexOf("_");s[l.substr(0,r)]=1}for(let e in s)0!==$("#giseq_summary_"+t.pre+e).length&&$("#giseq_summary_"+t.pre+e).addClass("icn3d-highlightSeqBox")}hlSeqInChain(e){let t=this.icn3d;t.icn3dui;for(let s=0,i=t.chainsSeq[e].length;s<i;++s){let i=e+"_"+t.chainsSeq[e][s].resi;0!==$("#giseq_"+t.pre+i).length&&$("#giseq_"+t.pre+i).addClass("icn3d-highlightSeq"),0!==$("#align_"+t.pre+i).length&&$("#align_"+t.pre+i).addClass("icn3d-highlightSeq")}0!==$("#giseq_summary_"+t.pre+e).length&&$("#giseq_summary_"+t.pre+e).addClass("icn3d-highlightSeqBox")}toggleHighlight(){let e=this.icn3d;e.icn3dui,e.bShowHighlight?(this.clearHighlight(),e.bShowHighlight=!1):(this.showHighlight(),e.bShowHighlight=!0)}clearHighlight(){let e=this.icn3d;e.icn3dui,e.labels.picking=[],e.drawCls.draw(),e.hlObjectsCls.removeHlObjects(),this.removeHl2D(),e.bRender&&e.drawCls.render(),this.removeSeqChainBkgd(),this.removeSeqResidueBkgd(),e.bSelectResidue=!1}showHighlight(){let e=this.icn3d;e.icn3dui,e.hlObjectsCls.addHlObjects(),this.updateHlAll()}highlightChains(e){let t=this.icn3d;t.icn3dui,t.hlObjectsCls.removeHlObjects(),this.removeHl2D(),t.hlObjectsCls.addHlObjects(),this.updateHl2D(e);let s={};for(let i=0,l=e.length;i<l;++i){let l=e[i];for(let e in t.chainsSeq[l]){let i=t.chainsSeq[l][e],n=l+"_"+i.resi;""!==i.name&&"-"!==i.name&&(s[n]=1)}}this.hlSequence(Object.keys(s))}hlSummaryDomain3ddomain(e){if(this.icn3d.icn3dui,void 0!==$(e).attr("domain")){let t=$(e).attr("index"),s=$(e).attr("chain");0!==$("[id^="+s+"_domain_"+t+"]").length&&$("[id^="+s+"_domain_"+t+"]").addClass("icn3d-highlightSeqBox")}if(void 0!==$(e).attr("3ddomain")){let t=$(e).attr("index"),s=$(e).attr("chain");0!==$("[id^="+s+"_3d_domain_"+t+"]").length&&$("[id^="+s+"_3d_domain_"+t+"]").addClass("icn3d-highlightSeqBox")}}removeSeqChainBkgd(e){void 0===e?$(".icn3d-seqTitle").each((function(e){$(this).removeClass("icn3d-highlightSeq"),$(this).removeClass("icn3d-highlightSeqBox")})):$(".icn3d-seqTitle").each((function(t){$(this).attr("chain")!==e&&($(this).removeClass("icn3d-highlightSeq"),$(this).removeClass("icn3d-highlightSeqBox"))}))}removeSeqResidueBkgd(){$(".icn3d-residue").each((function(e){$(this).removeClass("icn3d-highlightSeq")}))}}class Fe{constructor(e){this.icn3d=e}selectAll(){let e=this.icn3d;e.icn3dui,this.selectAll_base(),e.hlObjectsCls.removeHlObjects(),e.hlUpdateCls.removeHl2D(),e.hlUpdateCls.removeHlMenus(),e.bSelectResidue=!1,e.bSelectAlignResidue=!1,e.hlUpdateCls.removeSeqResidueBkgd(),e.hlUpdateCls.update2DdgmContent(),$("#"+e.pre+"dl_annotations > .icn3d-annotation").show(),e.definedSetsCls.setMode("all");let t=e.molTitle.length>40?e.molTitle.substr(0,40)+"...":e.molTitle;$("#"+e.pre+"title").html(t)}selectAll_base(){let e=this.icn3d,t=e.icn3dui;e.hAtoms={},e.dAtoms={};for(let s in e.chains)e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[s]);e.dAtoms=t.hashUtilsCls.cloneHash(e.hAtoms),e.viewSelectionAtoms=t.hashUtilsCls.cloneHash(e.hAtoms)}selectAChain(e,t,s,i){let l=this.icn3d,n=l.icn3dui;t=t.replace(/\s/g,"");let r=void 0!==s||s?"select alignChain "+e:"select chain "+e;void 0!==i&&i?(l.hAtoms=n.hashUtilsCls.unionHash(l.hAtoms,l.chains[e]),void 0===l.nameArray&&(l.nameArray=[])):(l.hAtoms={},l.nameArray=[]),l.nameArray.push(e);let o,a=s?l.alnChainsSeq[e]:l.chainsSeq[e];o=void 0===a?0:a.length;let d={};for(let t=0,s=o;t<s;++t){let s=a[t],i=e+"_"+s.resi,n=s.name;if(""!==n&&"-"!==n){d[i]=1;for(let e in l.residues[i])l.hAtoms[e]=1}}void 0!==l.defNames2Atoms&&l.defNames2Atoms.hasOwnProperty(t)||void 0!==l.defNames2Residues&&l.defNames2Residues.hasOwnProperty(t)||this.addCustomSelection(Object.keys(d),t,t,r,!0);s?l.hlUpdateCls.updateHlAll(void 0,void 0,i,true):l.hlUpdateCls.updateHlAll(l.nameArray,void 0,i,true)}selectResidueList(e,t,s,i,l,n){let r=this.icn3d;if(r.icn3dui,void 0!==e&&Object.keys(e).length>0){if(void 0!==i&&i?void 0===r.nameArray&&(r.nameArray=[]):(r.hAtoms={},r.nameArray=[]),n)for(let t in e)r.hAtoms[t]=1;else for(let t in e)for(let e in r.residues[t])r.hAtoms[e]=1;let o,a;t=t.replace(/\s/g,""),r.nameArray.push(t),n?(o="select "+r.resid2specCls.atoms2spec(r.hAtoms),a=!1):(o="select "+r.resid2specCls.residueids2spec(Object.keys(e)),a=!0);let d=Object.keys(e);this.addCustomSelection(d,t,s,o,a),(void 0===l||l)&&r.hlUpdateCls.updateHlAll(r.nameArray,void 0,i)}}selectMainChains(){let e=this.icn3d,t=e.icn3dui.hashUtilsCls.cloneHash(e.hAtoms);e.hAtoms=e.applyDisplayCls.selectMainChainSubset(t),e.hlUpdateCls.showHighlight()}selectSideChains(){let e=this.icn3d,t=e.icn3dui,s=t.hashUtilsCls.cloneHash(e.hAtoms);e.hAtoms={};for(let i in s)(e.proteins.hasOwnProperty(i)&&"N"!==e.atoms[i].name&&"C"!==e.atoms[i].name&&"O"!==e.atoms[i].name&&("CA"!==e.atoms[i].name||"C"!==e.atoms[i].elem)||e.nucleotides.hasOwnProperty(i)&&-1===t.parasCls.nuclMainArray.indexOf(e.atoms[i].name))&&(e.hAtoms[i]=1);e.hlUpdateCls.showHighlight()}selectMainSideChains(){let e=this.icn3d,t=e.icn3dui,s=e.firstAtomObjCls.getResiduesFromAtoms(e.hAtoms);e.hAtoms={};for(let i in s)e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[i]),e.dAtoms=t.hashUtilsCls.unionHash(e.dAtoms,e.residues[i]);e.drawCls.draw(),e.hlUpdateCls.showHighlight()}clickShow_selected(){let e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds(["#"+e.pre+"show_selected","#"+e.pre+"mn2_show_selected"],"click",(function(e){s.icn3d,s.showSelection(),t.htmlCls.clickMenuCls.setLogCmd("show selection",!0)}))}clickHide_selected(){let e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+e.pre+"mn2_hide_selected","click",(function(e){s.icn3d,s.hideSelection(),t.htmlCls.clickMenuCls.setLogCmd("hide selection",!0)}))}getGraphDataForDisplayed(){let e=this.icn3d;e.icn3dui;let t=JSON.parse(e.graphStr),s=e.firstAtomObjCls.getResiduesFromAtoms(e.dAtoms),i=[],l=[],n={};for(let e=0,l=t.nodes.length;e<l;++e){let l=t.nodes[e],r=l.r.substr(4);s.hasOwnProperty(r)&&(i.push(l),n[l.id]=1)}for(let e=0,s=t.links.length;e<s;++e){let s=t.links[e];n.hasOwnProperty(s.source)&&n.hasOwnProperty(s.target)&&l.push(s)}return t.nodes=i,t.links=l,e.graphStr=JSON.stringify(t),e.graphStr}updateSelectionNameDesc(){let e=this.icn3d;e.icn3dui;let t=Object.keys(e.defNames2Residues).length+Object.keys(e.defNames2Atoms).length;$("#"+e.pre+"seq_command_name").val("seq_"+t),$("#"+e.pre+"seq_command_name2").val("seq_"+t),$("#"+e.pre+"alignseq_command_name").val("alseq_"+t)}addCustomSelection(e,t,s,i,l){let n=this.icn3d;n.icn3dui,l?n.defNames2Residues[t]=e:n.defNames2Atoms[t]=e,n.defNames2Command[t]=i,n.defNames2Descr[t]=s,n.hlUpdateCls.updateHlMenus([t])}showSelection(){let e=this.icn3d,t=e.icn3dui;e.dAtoms={},0==Object.keys(e.hAtoms).length&&this.selectAll_base(),e.dAtoms=t.hashUtilsCls.cloneHash(e.hAtoms),e.viewSelectionAtoms=t.hashUtilsCls.cloneHash(e.hAtoms);let s=e.applyCenterCls.centerAtoms(t.hashUtilsCls.hash2Atoms(e.dAtoms,e.atoms));e.maxD=s.maxD,e.maxD<5&&(e.maxD=5),e.opts.rotationcenter="display center",this.saveSelectionIfSelected(),e.drawCls.draw(),e.hlUpdateCls.update2DdgmContent(),e.hlUpdateCls.updateHl2D(),e.annotationCls.showAnnoSelectedChains(),void 0!==e.graphStr&&(e.graphStr=this.getGraphDataForDisplayed())}hideSelection(){let e=this.icn3d,t=e.icn3dui;e.dAtoms=t.hashUtilsCls.exclHash(e.dAtoms,e.hAtoms),e.hAtoms=t.hashUtilsCls.cloneHash(e.dAtoms);let s=e.applyCenterCls.centerAtoms(t.hashUtilsCls.hash2Atoms(e.dAtoms,e.atoms));e.maxD=s.maxD,e.maxD<5&&(e.maxD=5),e.opts.rotationcenter="display center",this.saveSelectionIfSelected(),e.drawCls.draw(),e.hlUpdateCls.update2DdgmContent(),e.hlUpdateCls.updateHl2D(),e.annotationCls.showAnnoSelectedChains()}saveSelection(e,t){let s=this.icn3d,i=s.icn3dui;if(s.selectedResidues={},s.selectedResidues=s.firstAtomObjCls.getResiduesFromCalphaAtoms(s.hAtoms),Object.keys(s.selectedResidues).length>0)if(1==s.pk){let l=!0;this.selectResidueList(s.hAtoms,e,t,void 0,void 0,l),this.updateSelectionNameDesc(),i.htmlCls.clickMenuCls.setLogCmd("select "+s.resid2specCls.atoms2spec(s.hAtoms)+" | name "+e,!0)}else this.selectResidueList(s.selectedResidues,e,t),this.updateSelectionNameDesc(),i.htmlCls.clickMenuCls.setLogCmd("select "+s.resid2specCls.residueids2spec(Object.keys(s.selectedResidues))+" | name "+e,!0)}removeSelection(){let e=this.icn3d;e.icn3dui,e.bAnnotations||e.hlUpdateCls.removeSeqChainBkgd(),e.bCtrl||e.bShift||(e.hlUpdateCls.removeSeqResidueBkgd(),e.hlUpdateCls.removeSeqChainBkgd()),e.selectedResidues={},e.bSelectResidue=!1,e.hAtoms={},e.hlObjectsCls.removeHlObjects(),e.hlUpdateCls.removeHl2D()}resetAll(){let e=this.icn3d,t=e.icn3dui;e.maxD=e.oriMaxD,e.center=e.oriCenter.clone(),e.reinitAfterLoad(),e.loadScriptCls.renderFinalStep(1),e.definedSetsCls.setMode("all"),e.selectionCls.selectAll(),t.htmlCls.clickMenuCls.setLogCmd("reset",!0),e.hlUpdateCls.removeSeqChainBkgd(),e.hlUpdateCls.removeSeqResidueBkgd(),e.hlUpdateCls.removeHl2D(),e.hlUpdateCls.removeHlMenus()}loadSelection(e){let t=this.icn3d,s=t.icn3dui,i=e.trim().split("\n");for(let e=0,l=i.length;e<l;++e){let l=i[e].replace(/\t/g," "),n=l.indexOf(" "),r=l.substr(0,n),o=l.substr(n+1),a=o.indexOf(" ");t.selByCommCls.selectByCommand(o.substr(a+1),r,r),s.htmlCls.clickMenuCls.setLogCmd("select "+o.substr(a+1)+" | name "+r,!0)}}oneStructurePerWindow(){let e=this.icn3d,t=e.icn3dui,s=e.structures?Object.keys(e.structures):[];if(t.cfg.bSidebyside&&2==s.length){let i=s[Object.keys(window.icn3duiHash).indexOf(e.divid)],l=e.structures[i],n={};for(let s=0,i=l.length;s<i;++s)n=t.hashUtilsCls.unionHash(n,e.chains[l[s]]);e.dAtoms=t.hashUtilsCls.intHash(n,e.dAtoms),e.hAtoms=t.hashUtilsCls.cloneHash(e.dAtoms)}}showAll(){var e=this.icn3d,t=e.icn3dui;e.dAtoms=t.hashUtilsCls.cloneHash(e.atoms),e.maxD=e.oriMaxD,e.drawCls.draw()}saveSelectionIfSelected(e,t){var s=this.icn3d;if(s.icn3dui,s.bSelectResidue||s.bSelectAlignResidue){let e=$("#"+s.pre+"seq_command_name2").val().replace(/\s+/g,"_");""===e&&(e=$("#"+s.pre+"alignseq_command_name").val().replace(/\s+/g,"_")),""!==e&&this.saveSelection(e,e),s.bSelectResidue=!1,s.bSelectAlignResidue=!1}}saveSelectionPrep(){var e=this.icn3d,t=e.icn3dui;t.cfg.notebook?($("#"+e.pre+"dl_definedsets").show(),$("#"+e.pre+"atomsCustom").resizable()):$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+e.pre+"dl_definedsets").dialog("isOpen")||(t.htmlCls.dialogCls.openDlg("dl_definedsets","Select sets"),$("#"+e.pre+"atomsCustom").resizable()),e.bSelectResidue=!1,e.bSelectAlignResidue=!1}selectOneResid(e,t){var s=this.icn3d;s.icn3dui;let i=e.indexOf("$"),l=e.indexOf("."),n=e.indexOf(":"),r=e.indexOf("@");-1==r&&(r=e.length);let o=e.substr(i+1,l-i-1),a=e.substr(l+1,n-l-1),d=e.substr(n+1,r-n-1),c=o+"_"+a+"_"+d;for(let e in s.residues[c])t?delete s.hAtoms[e]:s.hAtoms[e]=1;return t?delete s.selectedResidues[c]:s.selectedResidues[c]=1,"$"+o+"."+a+":"+d}toggleSelection(){var e=this.icn3d,t=e.icn3dui;if(e.bHideSelection){for(let t in e.dAtoms)e.hAtoms.hasOwnProperty(t)&&delete e.dAtoms[t];e.bHideSelection=!1}else e.dAtoms=t.hashUtilsCls.unionHash(e.dAtoms,e.hAtoms),e.bHideSelection=!0;e.drawCls.draw()}toggleMembrane(e){var t=this.icn3d,s=t.icn3dui;let i=t.structures?Object.keys(t.structures):[];for(let l=0,n=i.length;l<n;++l){let n=i[l],r=t.residues[n+"_MEM_1"],o=t.firstAtomObjCls.getFirstAtomObj(r);if(void 0===o)continue;let a=o.style;t.dAtoms.hasOwnProperty(o.serial)||(t.dAtoms=s.hashUtilsCls.unionHash(t.dAtoms,r),a="nothing");for(let s in r){let i=t.atoms[s];i.style="nothing"!==a?"nothing":"stick",void 0!==e&&(i.style=e?"stick":"nothing")}}void 0===e&&t.drawCls.draw()}adjustMembrane(e,t){var s=this.icn3d;s.icn3dui;for(let i in s.chains[s.inputid.toUpperCase()+"_MEM"]){let l=s.atoms[i];"O"==l.name?l.coord.z=e:"N"==l.name&&(l.coord.z=t)}s.definedSetsCls.setTransmemInMenu(e,t,!0),s.hlUpdateCls.updateHlMenus(),s.drawCls.draw()}selectBtwPlanes(e,t){var s=this.icn3d;if(s.icn3dui,e<t){let s=t;t=e,e=s}let i={};for(let l in s.atoms){let n=s.atoms[l];if("DUM"!=n.resn&&(n.coord.z>=t&&n.coord.z<=e)){i[n.structure+"_"+n.chain+"_"+n.resi]=1}}let l="z_planes_"+e+"_"+t,n=l;this.selectResidueList(i,l,n,!1)}}class Pe{constructor(e){this.icn3d=e}setOption(e,t){var s=this.icn3d;s.icn3dui,s.opts[e]=t,s.selectionCls.saveSelectionIfSelected(),"color"===e?(s.setColorCls.setColorByOptions(s.opts,s.hAtoms),s.drawCls.draw(),s.hlUpdateCls.updateHlAll(),s.getGraphCls.updateGraphColor()):"surface"===e||"opacity"===e||"wireframe"===e?("opacity"!==e&&"wireframe"!==e||s.applyMapCls.removeLastSurface(),s.applyMapCls.applySurfaceOptions(),s.drawCls.draw()):"map"===e||"mapwireframe"===e?("mapwireframe"===e&&s.applyMapCls.removeLastMap(),s.applyMapCls.applyMapOptions(),s.drawCls.draw()):"emmap"===e||"emmapwireframe"===e?("emmapwireframe"===e&&s.applyMapCls.removeLastEmmap(),s.applyMapCls.applyEmmapOptions(),s.drawCls.draw()):"phimap"===e||"phimapwireframe"===e?("phimapwireframe"===e&&s.applyMapCls.removeLastPhimap(),s.applyMapCls.applyPhimapOptions(),s.drawCls.draw()):"phisurface"===e?(s.applyMapCls.applyphisurfaceOptions(),s.drawCls.draw()):"chemicalbinding"===e?(s.bSkipChemicalbinding=!1,s.drawCls.draw()):s.drawCls.draw()}setStyle(e,t){var s=this.icn3d,i=s.icn3dui;let l={};switch(e){case"proteins":if(l=i.hashUtilsCls.intHash(s.hAtoms,s.proteins),Object.keys(s.hAtoms).length,Object.keys(s.proteins).length,"nothing"==t){s.opts.ssbonds="no",s.lines.ssbond=[];for(let e in l)s.atoms[e].style2="nothing"}else s.opts.ssbonds="yes";break;case"sidec":l=i.hashUtilsCls.intHash(s.hAtoms,s.sidec);break;case"nucleotides":l=i.hashUtilsCls.intHash(s.hAtoms,s.nucleotides),Object.keys(s.hAtoms).length,Object.keys(s.nucleotides).length;break;case"ntbase":l=i.hashUtilsCls.intHash(s.hAtoms,s.ntbase);break;case"chemicals":l=i.hashUtilsCls.intHash(s.hAtoms,s.chemicals);break;case"ions":l=i.hashUtilsCls.intHash(s.hAtoms,s.ions);break;case"water":l=i.hashUtilsCls.intHash(s.hAtoms,s.water)}if("sidec"===e||"ntbase"===e)for(let e in l)s.atoms[e].style2=t;else for(let e in l)s.atoms[e].style=t;s.opts[e]=t,s.selectionCls.saveSelectionIfSelected(),s.drawCls.draw()}saveStyle(){var e=this.icn3d;e.icn3dui;for(let t in e.atoms){let s=e.atoms[t];s.styleSave=s.style,void 0!==s.style2&&(s.style2Save=s.style2)}}applySavedStyle(){var e=this.icn3d;e.icn3dui;for(let t in e.atoms){let s=e.atoms[t];void 0!==s.styleSave&&(s.style=s.styleSave),void 0!==s.style2Save&&(s.style2=s.style2Save)}e.drawCls.draw()}saveColor(){var e=this.icn3d;e.icn3dui;for(let t in e.atoms){let s=e.atoms[t];s.colorSave=s.color.clone()}}applySavedColor(){var e=this.icn3d;e.icn3dui;for(let t in e.atoms){let s=e.atoms[t];void 0!==s.colorSave&&(s.color=s.colorSave.clone(),e.atomPrevColors[t]=s.color)}e.hlUpdateCls.changeSeqColor(Object.keys(e.residues)),e.drawCls.draw()}}class Le{constructor(e){this.icn3d=e}setStyle2Atoms(e){let t=this.icn3d;t.icn3dui,t.style2atoms={};for(let s in e)void 0===t.style2atoms[t.atoms[s].style]&&(t.style2atoms[t.atoms[s].style]={}),t.style2atoms[t.atoms[s].style][s]=1,void 0!==t.atoms[s].style2&&"nothing"!==t.atoms[s].style2&&(void 0===t.style2atoms[t.atoms[s].style2]&&(t.style2atoms[t.atoms[s].style2]={}),t.style2atoms[t.atoms[s].style2][s]=1)}setAtomStyleByOptions(e){let t,s=this.icn3d,i=s.icn3dui;if(void 0===e&&(e=s.opts),void 0!==e.proteins){t=i.hashUtilsCls.intHash(s.hAtoms,s.proteins);for(let i in t)s.atoms[i].style=e.proteins.toLowerCase()}if(void 0!==e.sidec&&"nothing"!==e.sidec){t=i.hashUtilsCls.intHash(s.hAtoms,s.sidec);for(let i in t)s.atoms[i].style2=e.sidec.toLowerCase()}if(void 0!==e.ntbase&&"nothing"!==e.ntbase){t=i.hashUtilsCls.intHash(s.hAtoms,s.ntbase);for(let i in t)s.atoms[i].style2=e.ntbase.toLowerCase()}if(void 0!==e.chemicals){t=i.hashUtilsCls.intHash(s.hAtoms,s.chemicals);for(let i in t)s.atoms[i].style=e.chemicals.toLowerCase()}if(void 0!==e.ions){t=i.hashUtilsCls.intHash(s.hAtoms,s.ions);for(let i in t)s.atoms[i].style=e.ions.toLowerCase()}if(void 0!==e.water){t=i.hashUtilsCls.intHash(s.hAtoms,s.water);for(let i in t)s.atoms[i].style=e.water.toLowerCase()}if(void 0!==e.nucleotides){t=i.hashUtilsCls.intHash(s.hAtoms,s.nucleotides);for(let i in t)s.atoms[i].style=e.nucleotides.toLowerCase()}}setBackground(e){var t=this.icn3d,s=t.icn3dui;t.setOptionCls.setOption("background",e),s.htmlCls.clickMenuCls.setLogCmd("set background "+e,!0);let i="black"==e?s.htmlCls.GREYD:"black";$("#"+t.pre+"title").css("color",i),$("#"+t.pre+"titlelink").css("color",i)}saveCommandsToSession(){var e=this.icn3d;e.icn3dui;let t=e.commands.join("\n"),s=decodeURIComponent(t);sessionStorage.setItem("commands",s)}getCommandsBeforeCrash(){var e=this.icn3d,t=e.icn3dui;window.addEventListener("load",(function(){sessionStorage.setItem("good_exit","pending")})),window.addEventListener("beforeunload",(function(){sessionStorage.setItem("good_exit","true")})),sessionStorage.getItem("good_exit")&&"pending"===sessionStorage.getItem("good_exit")&&(t.utilsCls.isMac()||(e.bCrashed=!0),e.commandsBeforeCrash=sessionStorage.getItem("commands"),e.commandsBeforeCrash||(e.commandsBeforeCrash=""))}handleContextLost(){var e=this.icn3d;e.icn3dui;let t=$("#"+e.pre+"canvas")[0];t.addEventListener("webglcontextlost",(function(e){e.preventDefault()}),!1),t.addEventListener("webglcontextrestored",(function(t){console.log("WebGL context was lost. Reset WebGLRenderer and launch iCn3D again."),e.renderer=new THREE.WebGLRenderer({canvas:e.container.get(0),antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),e.drawCls.draw()}),!1)}adjustIcon(){var e=this.icn3d;e.icn3dui,1===e.STATENUMBER?$("#"+e.pre+"back").hasClass("icn3d-middleIcon")&&($("#"+e.pre+"back").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"back").toggleClass("icn3d-endIcon")):$("#"+e.pre+"back").hasClass("icn3d-endIcon")&&($("#"+e.pre+"back").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"back").toggleClass("icn3d-endIcon")),e.STATENUMBER===e.commands.length?$("#"+e.pre+"forward").hasClass("icn3d-middleIcon")&&($("#"+e.pre+"forward").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"forward").toggleClass("icn3d-endIcon")):$("#"+e.pre+"forward").hasClass("icn3d-endIcon")&&($("#"+e.pre+"forward").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"forward").toggleClass("icn3d-endIcon"))}}class Ne{constructor(e){this.icn3d=e}createStickRepresentation(e,t,s,i,l,n){let r=this.icn3d;if(r.icn3dui.bNode)return;let o=void 0!==n&&n?t/r.cylinderRadius:1,a=r.cylinderRadius*o*.4,d=r.cylinderRadius*o*.3;r.reprSubCls.createRepresentationSub(e,(function(e){r.sphereCls.createSphere(e,t,!i,i,l)}),(function(e,t){let i=e.coord.clone().add(t.coord).multiplyScalar(.5),n=e.serial+"_"+t.serial;if(r.doublebonds.hasOwnProperty(n)){let s,n,d,c,h=new THREE.Vector3(Math.random(),Math.random(),Math.random());if(1==e.bonds.length&&1==t.bonds.length){c=t.coord.clone(),c.sub(e.coord);let s=h.clone();c.cross(s).normalize().multiplyScalar(.2*o)}else{if(e.bonds.length>=t.bonds.length&&e.bonds.length>1)s=e.serial,n=e.bonds[0],d=e.bonds[1];else{if(!(t.bonds.length>=e.bonds.length&&t.bonds.length>1))return void console.log("Double bond was not drawn due to the undefined cross plane");s=t.serial,n=t.bonds[0],d=t.bonds[1]}let i=r.atoms[s].coord.clone();i.sub(r.atoms[n].coord);let l=r.atoms[s].coord.clone();l.sub(r.atoms[d].coord),i.cross(l),0==parseInt(1e4*i.length())&&(i=new THREE.Vector3(.2,.3,.5)),c=t.coord.clone(),c.sub(e.coord),c.cross(i).normalize().multiplyScalar(.2*o),0==parseInt(1e4*c.length())&&(i=new THREE.Vector3(.5,.3,.2),c.cross(i).normalize().multiplyScalar(.2*o))}e.color===t.color?r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord.clone().add(c),t.coord.clone().add(c),a,e.color,l),r.cylinderCls.createCylinder(e.coord.clone().sub(c),t.coord.clone().sub(c),a,e.color,l)):r.bImpo?r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord.clone().add(c),t.coord.clone().add(c),a,e.color,l,t.color),r.cylinderCls.createCylinder(e.coord.clone().sub(c),t.coord.clone().sub(c),a,e.color,l,t.color)):r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord.clone().add(c),i.clone().add(c),a,e.color,l),r.cylinderCls.createCylinder(t.coord.clone().add(c),i.clone().add(c),a,t.color,l),r.cylinderCls.createCylinder(e.coord.clone().sub(c),i.clone().sub(c),a,e.color,l),r.cylinderCls.createCylinder(t.coord.clone().sub(c),i.clone().sub(c),a,t.color,l))}else if(r.aromaticbonds.hasOwnProperty(n)){let s,n,d;if(e.bonds.length>t.bonds.length&&e.bonds.length>1)s=e.serial,n=e.bonds[0],d=e.bonds[1];else{if(!(t.bonds.length>1))return;s=t.serial,n=t.bonds[0],d=t.bonds[1]}let c=r.atoms[s].coord.clone();c.sub(r.atoms[n].coord);let h=r.atoms[s].coord.clone();h.sub(r.atoms[d].coord),c.cross(h);let m=t.coord.clone();m.sub(e.coord),m.cross(c).normalize().multiplyScalar(.2*o);let p=0;for(let s=0,i=e.bondOrder.length;s<i;++s)"1.5"===e.bondOrder[s]&&e.bonds[s]!==t.serial&&(p=e.bonds[s]);let u="add";if(0===p)u="add";else{let s=e.coord.clone().add(m),i=e.coord.clone().sub(m),l=t.coord.clone().sub(s).normalize(),n=r.atoms[p].coord.clone().sub(s).normalize(),o=t.coord.clone().sub(i).normalize(),a=r.atoms[p].coord.clone().sub(i).normalize();u=Math.acos(l.dot(n))<Math.acos(o.dot(a))?"sub":"add"}if(e.color===t.color){let s,i;"add"===u?(r.cylinderCls.createCylinder(e.coord.clone().sub(m),t.coord.clone().sub(m),a,e.color,l),s=e.coord.clone().add(m),i=t.coord.clone().add(m).sub(s).multiplyScalar(1/11)):(r.cylinderCls.createCylinder(e.coord.clone().add(m),t.coord.clone().add(m),a,e.color,l),s=e.coord.clone().sub(m),i=t.coord.clone().sub(m).sub(s).multiplyScalar(1/11));for(let t=0;t<=10;++t)if(t%2==0){let n=s.clone().add(i.clone().multiplyScalar(t)),o=s.clone().add(i.clone().multiplyScalar(t+1));r.cylinderCls.createCylinder(n,o,a,e.color,l)}}else{let s,n;"add"===u?(r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord.clone().sub(m),i.clone().sub(m),a,e.color,l),r.cylinderCls.createCylinder(t.coord.clone().sub(m),i.clone().sub(m),a,t.color,l)),s=e.coord.clone().add(m),n=t.coord.clone().add(m).sub(s).multiplyScalar(1/11)):(r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord.clone().add(m),i.clone().add(m),a,e.color,l),r.cylinderCls.createCylinder(t.coord.clone().add(m),i.clone().add(m),a,t.color,l)),s=e.coord.clone().sub(m),n=t.coord.clone().sub(m).sub(s).multiplyScalar(1/11));for(let i=0;i<=10;++i)if(i%2==0&&r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)){let o=s.clone().add(n.clone().multiplyScalar(i)),d=s.clone().add(n.clone().multiplyScalar(i+1));i<5?r.cylinderCls.createCylinder(o,d,a,e.color,l):r.cylinderCls.createCylinder(o,d,a,t.color,l)}}}else if(r.triplebonds.hasOwnProperty(n)){let s=new THREE.Vector3(Math.random(),Math.random(),Math.random()),n=t.coord.clone();n.sub(e.coord);let a=s.clone();a.cross(n).normalize().multiplyScalar(.3*o),e.color===t.color?r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord,t.coord,d,e.color,l),r.cylinderCls.createCylinder(e.coord.clone().add(a),t.coord.clone().add(a),d,e.color,l),r.cylinderCls.createCylinder(e.coord.clone().sub(a),t.coord.clone().sub(a),r.triBondRadius,e.color,l)):r.bImpo?r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord,t.coord,d,e.color,l,t.color),r.cylinderCls.createCylinder(e.coord.clone().add(a),t.coord.clone().add(a),d,e.color,l,t.color),r.cylinderCls.createCylinder(e.coord.clone().sub(a),t.coord.clone().sub(a),d,e.color,l,t.color)):r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord,i,d,e.color,l),r.cylinderCls.createCylinder(t.coord,i,d,t.color,l),r.cylinderCls.createCylinder(e.coord.clone().add(a),i.clone().add(a),d,e.color,l),r.cylinderCls.createCylinder(t.coord.clone().add(a),i.clone().add(a),d,t.color,l),r.cylinderCls.createCylinder(e.coord.clone().sub(a),i.clone().sub(a),d,e.color,l),r.cylinderCls.createCylinder(t.coord.clone().sub(a),i.clone().sub(a),d,t.color,l))}else e.color===t.color?r.cylinderCls.createCylinder(e.coord,t.coord,s,e.color,l):r.bImpo?r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&r.cylinderCls.createCylinder(e.coord,t.coord,s,e.color,l,t.color):r.dAtoms.hasOwnProperty(e.serial)&&r.dAtoms.hasOwnProperty(t.serial)&&(r.cylinderCls.createCylinder(e.coord,i,s,e.color,l),r.cylinderCls.createCylinder(t.coord,i,s,t.color,l))}))}}class $e{constructor(e){this.icn3d=e}drawCartoonNucleicAcid(e,t,s,i){this.drawStrandNucleicAcid(e,2,t,!0,void 0,s,i)}drawStrandNucleicAcid(e,t,s,i,l,n,r){let o,a,d,c=this.icn3d;if(c.icn3dui.bNode)return;2===r&&(t=void 0,n=void 0),l=l||c.nucleicAcidWidth,s=s||c.axisDIV,t=t||c.nucleicAcidStrandDIV;let h=[];for(d=0;d<t;d++)h[d]=[];let m,p,u,C=[],g=null;for(o in e){let f=e[o];if(void 0!==f&&(("O3'"===f.name||"OP2"===f.name||"O3*"===f.name||"O2P"===f.name)&&!f.het))if("O3'"===f.name||"O3*"===f.name){if(m!==f.chain||parseInt(p)+1!==parseInt(f.resi)){if(u&&g)for(a=0;a<t;a++){let e=2/(t-1)*a-1;h[a].push(new THREE.Vector3(u.x+g.x*e,u.y+g.y*e,u.z+g.z*e))}for(i&&c.stripCls.createStrip(h[0],h[1],C,s,n,r),a=0;!n&&a<t;a++)c.curveCls.createCurveSub(h[a],1,C,s,r);for(h=[],d=0;d<t;d++)h[d]=[];C=[],g=null}u=new THREE.Vector3(f.coord.x,f.coord.y,f.coord.z),m=f.chain,p=f.resi,1===r||2===r?C.push(c.hColor):C.push(f.color)}else if("OP2"===f.name||"O2P"===f.name){if(!u){g=null;continue}let e=new THREE.Vector3(f.coord.x,f.coord.y,f.coord.z);for(e.sub(u),e.normalize().multiplyScalar(l),null!==g&&e.dot(g)<0&&e.negate(),g=e,a=0;a<t;a++){let e=2/(t-1)*a-1;h[a].push(new THREE.Vector3(u.x+g.x*e,u.y+g.y*e,u.z+g.z*e))}u=null}}if(u&&g)for(a=0;a<t;a++){let e=2/(t-1)*a-1;h[a].push(new THREE.Vector3(u.x+g.x*e,u.y+g.y*e,u.z+g.z*e))}for(i&&c.stripCls.createStrip(h[0],h[1],C,s,n,r),a=0;!n&&a<t;a++)c.curveCls.createCurveSub(h[a],1,C,s,r)}drawNucleicAcidStick(e,t){let s=this.icn3d;if(s.icn3dui.bNode)return;let i,l,n,r=null,o=null;for(n in e){let a=e[n];void 0===a||a.het||(a.resi===l&&a.chain===i||(null!==r&&null!==o&&s.cylinderCls.createCylinder(new THREE.Vector3(r.coord.x,r.coord.y,r.coord.z),new THREE.Vector3(o.coord.x,o.coord.y,o.coord.z),s.cylinderRadius,r.color,t),r=null,o=null),"O3'"!==a.name&&"O3*"!==a.name||(r=a),"A"===a.resn.trim()||"G"===a.resn.trim()||"DA"===a.resn.trim()||"DG"===a.resn.trim()?"N9"===a.name&&(o=a):"N1"===a.name&&(o=a),l=a.resi,i=a.chain)}null!==r&&null!==o&&s.cylinderCls.createCylinder(new THREE.Vector3(r.coord.x,r.coord.y,r.coord.z),new THREE.Vector3(o.coord.x,o.coord.y,o.coord.z),s.cylinderRadius,r.color,t)}}class Ue{constructor(e){this.icn3d=e}makeTextSprite(e,t){let s=this.icn3d,i=s.icn3dui;if(i.bNode)return;void 0===t&&(t={});let l,n,r,o=t.hasOwnProperty("fontface")?t.fontface:"Arial",a=t.hasOwnProperty("fontsize")?t.fontsize:18,d=t.hasOwnProperty("factor")?t.factor:1,c=t.hasOwnProperty("alpha")?t.alpha:1,h=!1,m=!1;t.hasOwnProperty("bSchematic")&&t.bSchematic&&(m=!0,h=!0,a=40),t.hasOwnProperty("backgroundColor")&&void 0!==t.backgroundColor?(l=i.utilsCls.hexToRgb(t.backgroundColor,c),n=t.hasOwnProperty("borderColor")?i.utilsCls.hexToRgb(t.borderColor,c):{r:0,g:0,b:0,a:1},r=t.hasOwnProperty("borderThickness")?t.borderThickness:4):(h=!1,l=void 0,n=void 0,r=0);let p="black"!=s.opts.background?{r:0,g:0,b:0,a:1}:{r:255,g:255,b:0,a:1},u=t.hasOwnProperty("textColor")&&void 0!==t.textColor?i.utilsCls.hexToRgb(t.textColor,1):p;u||(u=p);let C=document.createElement("canvas"),g=C.getContext("2d");g.font="Bold "+a+"px "+o;let f=g.measureText(e).width,b=f+2*r,y=a+2*r;m&&(b>y?y=b:b=y);let v=.8*f/y;if(C.width=b,C.height=y,g.clearRect(0,0,b,y),h)if(g.fillStyle="rgba("+l.r+","+l.g+","+l.b+","+l.a+")",g.strokeStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",g.lineWidth=r,m){let e=.35*b;this.circle(g,0,0,b,y,e)}else{let e=0;this.roundRect(g,0,0,b,y,e)}g.font="Bold "+a+"px "+o,g.textAlign="center",g.textBaseline="middle",g.fillStyle="rgba("+u.r+", "+u.g+", "+u.b+", 1.0)",g.strokeStyle="rgba("+u.r+", "+u.g+", "+u.b+", 1.0)",g.fillText(e,.5*b,.5*y);let _=new THREE.Texture(C);_.needsUpdate=!0;let S=new THREE.SpriteMaterial({map:_,depthTest:!1,depthWrite:!1});S.map.minFilter=THREE.LinearFilter;let w=new THREE.Sprite(S);return m?w.scale.set(.3*d,.3*d,1):w.scale.set(v*d,d,1),w}roundRect(e,t,s,i,l,n){e.beginPath(),e.moveTo(t+n,s),e.lineTo(t+i-n,s),e.quadraticCurveTo(t+i,s,t+i,s+n),e.lineTo(t+i,s+l-n),e.quadraticCurveTo(t+i,s+l,t+i-n,s+l),e.lineTo(t+n,s+l),e.quadraticCurveTo(t,s+l,t,s+l-n),e.lineTo(t,s+n),e.quadraticCurveTo(t,s,t+n,s),e.closePath(),e.fill(),e.stroke()}circle(e,t,s,i,l,n){e.beginPath(),e.arc(t+i/2,s+l/2,n,0,2*Math.PI,!0),e.closePath(),e.fill(),e.stroke()}}class qe{constructor(e){this.icn3d=e,this.textSpriteCls=new Ue(e)}createLabelRepresentation(e){let t=this.icn3d;t.icn3dui;let s=t.oriMaxD/100;s<.4&&(s=.4);let i=3*s*t.labelScale;for(let s in e){let l=void 0!==e[s]?e[s]:[],n="black"!=t.opts.background?t.colorWhitebkgd:t.colorBlackbkgd;for(let e=0,r=l.length;e<r;++e){let r=l[e];0==r.size&&(r.size=void 0),0==r.color&&(r.color=void 0),0==r.background&&(r.background=void 0);let o=void 0!==r.size?r.size:t.LABELSIZE,a=void 0!==r.color?r.color:n;t.labelcolor&&(a=t.labelcolor);let d,c=void 0!==r.background?r.background:"#cccccc",h=void 0!==r.alpha?r.alpha:1;if(c=r.background,void 0!==a&&void 0!==c&&a.toLowerCase()===c.toString().toLowerCase()&&(a="#888888"),void 0!==r.bSchematic&&r.bSchematic)d=this.textSpriteCls.makeTextSprite(r.text,{fontsize:parseInt(o),textColor:a,borderColor:c,backgroundColor:c,alpha:h,bSchematic:1,factor:i});else if(1===r.text.length)d=this.textSpriteCls.makeTextSprite(r.text,{fontsize:parseInt(o),textColor:a,borderColor:c,backgroundColor:c,alpha:h,bSchematic:1,factor:i});else{let e=r.factor?i*r.factor:i;d=this.textSpriteCls.makeTextSprite(r.text,{fontsize:parseInt(o),textColor:a,borderColor:c,backgroundColor:c,alpha:h,bSchematic:0,factor:e})}let m="schematic"==s||"residue"==s?0:t.coilWidth;d.position.set(r.position.x+m,r.position.y+m,r.position.z+m),t.mdl.add(d)}}}hideLabels(){let e=this.icn3d;if(e.icn3dui,void 0!==e.mdl)for(let t=0,s=e.mdl.children.length;t<s;++t){let s=e.mdl.children[t];void 0!==s&&"Sprite"===s.type&&e.mdl.remove(s)}}}class Be{constructor(e){this.icn3d=e}applyDisplayOptions(e,t,s){let i=this.icn3d,l=i.icn3dui;if(!l.bNode&&""!=l.htmlCls.setHtmlCls.getCookie("lineRadius")){let e=parseFloat(l.htmlCls.setHtmlCls.getCookie("lineRadius")),t=parseFloat(l.htmlCls.setHtmlCls.getCookie("coilWidth")),s=parseFloat(l.htmlCls.setHtmlCls.getCookie("cylinderRadius")),n=parseFloat(l.htmlCls.setHtmlCls.getCookie("traceRadius")),r=parseFloat(l.htmlCls.setHtmlCls.getCookie("dotSphereScale")),o=parseFloat(l.htmlCls.setHtmlCls.getCookie("ribbonthickness")),a=parseFloat(l.htmlCls.setHtmlCls.getCookie("helixSheetWidth")),d=parseFloat(l.htmlCls.setHtmlCls.getCookie("nucleicAcidWidth"));i.lineRadius==e&&i.coilWidth==t&&i.cylinderRadius==s&&i.traceRadius==n&&i.dotSphereScale==r&&i.ribbonthickness==o&&i.helixSheetWidth==a&&i.nucleicAcidWidth==d||l.htmlCls.clickMenuCls.setLogCmd("set thickness | linerad "+e+" | coilrad "+t+" | stickrad "+s+" | tracerad "+n+" | ribbonthick "+o+" | proteinwidth "+a+" | nucleotidewidth "+d+" | ballscale "+r,!0),i.lineRadius=e,i.coilWidth=t,i.cylinderRadius=s,i.traceRadius=n,i.dotSphereScale=r,i.ribbonthickness=o,i.helixSheetWidth=a,i.nucleicAcidWidth=d}let n,r={},o={},a={};if(1===s&&Object.keys(t).length<Object.keys(i.atoms).length){a=l.hashUtilsCls.hash2Atoms(t,i.atoms),r=i.firstAtomObjCls.getResiduesFromAtoms(t,i.atoms);for(let e in r){n=e;let t=e.lastIndexOf("_"),s=e.substr(0,t+1),i=e.substr(t+1);if(isNaN(i))continue;let l=parseInt(i),a=s+(l-1).toString();(l+1).toString(),r.hasOwnProperty(a)||r.hasOwnProperty(a)||(o[e]=1)}if(1===Object.keys(a).length&&Object.keys(i.residues[n]).length>1&&"sphere"!==a[Object.keys(a)[0]].style&&"dot"!==a[Object.keys(a)[0]].style){if(void 0===i.bCid||!i.bCid)for(let e in a){let t=a[e],l=1;i.boxCls.createBox(t,void 0,void 0,l,void 0,s)}}else for(let e in o){let n=i.firstAtomObjCls.getFirstCalphaAtomObj(i.residues[e]),r=n,o=r.structure+"_"+r.chain+"_"+(parseInt(r.resi)-1).toString(),a=r.structure+"_"+r.chain+"_"+(parseInt(r.resi)+1).toString();if("cylinder and plate"===r.style&&"helix"===r.ss)for(let t in i.residues[e]){let e=i.atoms[t],l=1;i.boxCls.createBox(e,void 0,void 0,l,void 0,s)}else if("ribbon"===r.style&&"coil"===r.ss||"strand"===r.style&&"coil"===r.ss||"o3 trace"===r.style||"schematic"===r.style||"c alpha trace"===r.style||"b factor tube"===r.style||"cylinder and plate"===r.style&&"helix"!==r.ss){if(void 0!==n&&void 0!==n.style2&&"nothing"!==n.style2)continue;let e=!1;if(!isNaN(r.resi)&&!e&&i.residues.hasOwnProperty(a)){let s=Object.keys(i.residues[a])[0],n=l.hashUtilsCls.hash2Atoms(i.residues[a],i.atoms)[s];if(r.style===n.style&&!n.ssbegin||n.ssbegin){let s=i.residues[a];if(t=l.hashUtilsCls.unionHash(t,s),e=!0,n.ssbegin)for(let e in s)i.atoms[e].notshow=!0}}if(!isNaN(r.resi)&&!e&&i.residues.hasOwnProperty(o)){let s=Object.keys(i.residues[o])[0],n=l.hashUtilsCls.hash2Atoms(i.residues[o],i.atoms)[s];r.style===n.style&&(t=l.hashUtilsCls.unionHash(t,i.residues[o]),e=!0)}}else if("ribbon"===r.style&&"coil"!==r.ss&&r.ssend||"strand"===r.style&&"coil"!==r.ss&&r.ssend){if(void 0!==n&&void 0!==n.style2&&"nothing"!==n.style2)continue;let e=!1;if(!isNaN(r.resi)&&!e&&i.residues.hasOwnProperty(a)){let s=Object.keys(i.residues[a])[0];l.hashUtilsCls.hash2Atoms(i.residues[a],i.atoms)[s],t=l.hashUtilsCls.unionHash(t,i.residues[a]),e=!0}}}a={}}if(i.bInitial){if(""!=l.htmlCls.setHtmlCls.getCookie("membrane")){let e=parseInt(l.htmlCls.setHtmlCls.getCookie("membrane"));i.bMembrane!=e&&l.htmlCls.clickMenuCls.setLogCmd("set membrane "+e,!0),i.bMembrane=isNaN(e)?0:parseInt(e)}i.bMembrane?i.selectionCls.toggleMembrane(!0):i.selectionCls.toggleMembrane(!1)}i.setStyleCls.setStyle2Atoms(t);let d=.5*i.cylinderRadius;void 0!==i.labels&&delete i.labels.schematic;for(let e in i.style2atoms){let t=i.style2atoms[e],n=l.utilsCls.isCalphaPhosOnly(l.hashUtilsCls.hash2Atoms(t,i.atoms));if("ribbon"===e)i.strandCls.createStrand(l.hashUtilsCls.hash2Atoms(t,i.atoms),2,void 0,!0,void 0,void 0,!1,i.ribbonthickness,s);else if("strand"===e)i.strandCls.createStrand(l.hashUtilsCls.hash2Atoms(t,i.atoms),null,null,null,null,null,!1,void 0,s);else if("cylinder and plate"===e)i.cylinderCls.createCylinderHelix(l.hashUtilsCls.hash2Atoms(t,i.atoms),i.cylinderHelixRadius,s);else if("nucleotide cartoon"===e)n?i.cylinderCls.createCylinderCurve(l.hashUtilsCls.hash2Atoms(t,i.atoms),["P"],i.traceRadius,!1,s):(i.cartoonNuclCls.drawCartoonNucleicAcid(l.hashUtilsCls.hash2Atoms(t,i.atoms),null,i.ribbonthickness,s),2!==s&&i.cartoonNuclCls.drawNucleicAcidStick(l.hashUtilsCls.hash2Atoms(t,i.atoms),s));else if("o3 trace"===e)n?i.cylinderCls.createCylinderCurve(l.hashUtilsCls.hash2Atoms(t,i.atoms),["P"],i.traceRadius,!1,s):i.cylinderCls.createCylinderCurve(l.hashUtilsCls.hash2Atoms(t,i.atoms),["O3'","O3*"],i.traceRadius,!1,s);else if("schematic"===e){let e=i.firstAtomObjCls.getFirstAtomObj(t);if(i.chemicals.hasOwnProperty(e.serial)){i.residueLabelsCls.addNonCarbonAtomLabels(l.hashUtilsCls.hash2Atoms(t,i.atoms));let e=!0;i.stickCls.createStickRepresentation(l.hashUtilsCls.hash2Atoms(t,i.atoms),d,d,void 0,s,e)}else i.residueLabelsCls.addResidueLabels(l.hashUtilsCls.hash2Atoms(t,i.atoms),!0),n?i.cylinderCls.createCylinderCurve(l.hashUtilsCls.hash2Atoms(t,i.atoms),["P"],i.traceRadius,!1,s):i.cylinderCls.createCylinderCurve(l.hashUtilsCls.hash2Atoms(t,i.atoms),["O3'","O3*"],i.traceRadius,!1,s),i.cylinderCls.createCylinderCurve(l.hashUtilsCls.hash2Atoms(t,i.atoms),["CA"],i.traceRadius,!1,s)}else"c alpha trace"===e?i.cylinderCls.createCylinderCurve(l.hashUtilsCls.hash2Atoms(t,i.atoms),["CA"],i.traceRadius,!1,s):"b factor tube"===e?i.tubeCls.createTube(l.hashUtilsCls.hash2Atoms(t,i.atoms),"CA",null,s,!1,!0):"custom tube"===e?i.tubeCls.createTube(l.hashUtilsCls.hash2Atoms(t,i.atoms),"CA",null,s,!0,!0):"lines"===e||"lines2"===e?(1===s?i.stickCls.createStickRepresentation(l.hashUtilsCls.hash2Atoms(t,i.atoms),i.hlLineRadius,i.hlLineRadius,void 0,s):i.lineCls.createLineRepresentation(l.hashUtilsCls.hash2Atoms(t,i.atoms),s),i.lineCls.createConnCalphSidechain(l.hashUtilsCls.hash2Atoms(t,i.atoms),e)):"stick"===e||"stick2"===e?(i.stickCls.createStickRepresentation(l.hashUtilsCls.hash2Atoms(t,i.atoms),i.cylinderRadius,i.cylinderRadius,void 0,s,void 0),i.lineCls.createConnCalphSidechain(l.hashUtilsCls.hash2Atoms(t,i.atoms),e)):"backbone"===e?(t=this.selectMainChainSubset(t),i.stickCls.createStickRepresentation(l.hashUtilsCls.hash2Atoms(t,i.atoms),i.cylinderRadius,i.cylinderRadius,void 0,s,void 0)):"ball and stick"===e||"ball and stick2"===e?(i.stickCls.createStickRepresentation(l.hashUtilsCls.hash2Atoms(t,i.atoms),i.cylinderRadius,.5*i.cylinderRadius,i.dotSphereScale,s,void 0),i.lineCls.createConnCalphSidechain(l.hashUtilsCls.hash2Atoms(t,i.atoms),e)):"sphere"===e||"sphere2"===e?i.sphereCls.createSphereRepresentation(l.hashUtilsCls.hash2Atoms(t,i.atoms),i.sphereRadius,void 0,void 0,s):"dot"===e&&i.sphereCls.createSphereRepresentation(l.hashUtilsCls.hash2Atoms(t,i.atoms),i.sphereRadius,!1,i.dotSphereScale,s)}if(i.cnt>i.maxmaxatomcnt&&i.init_base(),void 0!==i.labels&&Object.keys(i.labels).length>0){i.labelCls.hideLabels();for(let e in i.labels)"schematic"!=e&&this.changeLabelColor(i.labels[e]);i.labelCls.createLabelRepresentation(i.labels)}}changeLabelColor(e){let t=this.icn3d;if(t.icn3dui,e)for(let s=0,i=e.length;s<i;++s){let i=e[s];"black"!=t.opts.background&&i.color==t.colorBlackbkgd?i.color=t.colorWhitebkgd:"black"==t.opts.background&&i.color==t.colorWhitebkgd&&(i.color=t.colorBlackbkgd)}}selectMainChainSubset(e){let t=this.icn3d;t.icn3dui;let s=["C1'","C1*","C2'","C2*","C3'","C3*","C4'","C4*","C5'","C5*","O3'","O3*","O4'","O4*","O5'","O5*","P","OP1","O1P","OP2","O2P"],i={};for(let l in e)(t.proteins.hasOwnProperty(l)&&("N"===t.atoms[l].name||"C"===t.atoms[l].name||"O"===t.atoms[l].name||"CA"===t.atoms[l].name&&"C"===t.atoms[l].elem)||t.nucleotides.hasOwnProperty(l)&&-1!==s.indexOf(t.atoms[l].name))&&(i[l]=1);return i}}class je{constructor(e){this.icn3d=e}showGlycans(){let e=this.icn3d,t=e.icn3dui;if(t.bNode)return;let s={},i=e.dAtoms;for(let l in i){let i=e.atoms[l];i.het&&-1!=t.parasCls.glycanHash.hasOwnProperty(i.resn)&&(void 0===s[i.resn]&&(s[i.resn]={}),"Misc"!=i.chain&&(s[i.resn][i.structure+"_"+i.chain+"_"+i.resi]=1))}let l=Object.keys(s);for(let i=0,n=l.length;i<n;++i){let n=l[i];if(!t.parasCls.glycanHash.hasOwnProperty(n))continue;let r=t.parasCls.glycanHash[n].s,o=new THREE.Color("#"+t.parasCls.glycanHash[n].c),a=Object.keys(s[n]);for(let t=0,s=a.length;t<s;++t){let s=e.applyCenterCls.centerAtoms(e.residues[a[t]]),i=s.center,l=.5*s.maxD*.6;if("cube"==r)e.boxCls.createBox_base(i,l,o,!1,!1,!0);else if("sphere"==r)e.sphereCls.createSphereBase(i,o,l,1,!1,!0);else if("cone"==r){let t=new THREE.Vector3(0,0,1),s=e.axesCls.createArrow(t,new THREE.Vector3(0,0,-1*l).add(i),0,o,2*l,2*l,!0);e.mdl.add(s),e.objects.push(s)}else if("cylinder"==r){let t=new THREE.Vector3(0,0,l).add(i),s=new THREE.Vector3(0,0,-1*l).add(i);e.cylinderCls.createCylinder(t,s,l,o,!1,o,!1,!0)}}}}}class ze{constructor(e){this.icn3d=e}applySymd(){let e=this.icn3d;e.icn3dui;for(let t=0,s=e.symdArray.length;t<s;++t){let s=e.symdArray[t],i=Object.keys(s)[0];this.applySymmetry(i,!0,s[i])}}applySymmetry(e,t,s){let i=this.icn3d,l=i.icn3dui,n=t?s:i.symmetryHash[e];n||(n=[]);let r=e.substr(0,1),o=parseInt(e.substring(1,e.indexOf(" "))),a=1.5*i.cylinderRadius,d=1*i.cylinderRadius,c=[];for(let e=0,s=n.length;e<s;++e){let s=n[e][0],h=n[e][1],m=n[e][2],p=n[e][3],u=n[e][4],C=n[e][5];if(i.cylinderCls.createCylinder(s,h,a,m,0),!i.bAxisOnly)if("C"==r||"D"==r&&u==o){let e={};Object.keys(i.chains).length;let n=!1,r={};if(t&&Object.keys(i.hAtoms).length<Object.keys(i.atoms).length){for(let e in i.hAtoms){let t=i.atoms[e];r[t.structure+"_"+t.chain]=1}Object.keys(r).length>1&&(n=!0)}if(t)if(n){let t=Object.keys(r)[0];e=i.chains[t]}else{0==Object.keys(i.hAtoms).length&&(i.hAtoms=l.hashUtilsCls.cloneHash(i.atoms));let t,s=parseInt(Object.keys(i.hAtoms).length/u),n=0;for(let l in i.hAtoms)if(e[l]=1,t=l,++n,n>s)break;let r=i.atoms[t].structure+"_"+i.atoms[t].chain+"_"+i.atoms[t].resi;e=l.hashUtilsCls.unionHash(e,i.residues[r])}else{let t=Object.keys(i.structures)[0]+"_"+C;if(i.chains.hasOwnProperty(t)||(t=Object.keys(i.structures)[0]+"_"+C.toLowerCase()),!i.chains.hasOwnProperty(t)){t=Object.keys(i.chains)[0];for(let e in i.chains){let s=Object.keys(i.chains[e])[0];if(i.proteins.hasOwnProperty(s)){t=e;break}}}e=i.chains[t]}let a=s.clone().add(h).multiplyScalar(.5),c=new THREE.Vector3,m=0,g=h.clone().sub(s).normalize(),f=new THREE.Vector3(0,0,1),b=new THREE.Quaternion;b.setFromUnitVectors(g,f);let y=-9999;for(let t in e){let e=i.atoms[t].coord.clone();c.add(e),e.sub(a).applyQuaternion(b);let s=e.x*e.x+e.y*e.y;s>y&&(y=s),++m}let v=i.ParserUtilsCls.getMassCenter(c,m),_=new THREE.Line3(s,h),S=new THREE.Vector3;_.closestPointToPoint(v,!0,S);let w,A,x,k,O=Math.sqrt(y),H=v.clone().sub(S).normalize().multiplyScalar(O),D=a.clone().add(s.clone().sub(a).multiplyScalar(.83)).add(H),R=a.clone().add(h.clone().sub(a).multiplyScalar(.83)).add(H),I=2*Math.PI/o;for(let e=0;e<o;++e){let t=(.5+e)*I,l=D.clone().sub(s);l.applyAxisAngle(g,t).add(s);let n=R.clone().sub(s);n.applyAxisAngle(g,t).add(s),i.cylinderCls.createCylinder(l,n,d,p,0),i.sphereCls.createSphereBase(l,p,d,1,0),i.sphereCls.createSphereBase(n,p,d,1,0),0==e?(w=l,A=n):(i.cylinderCls.createCylinder(l,x,d,p,0),i.cylinderCls.createCylinder(n,k,d,p,0)),x=l,k=n}w&&x&&i.cylinderCls.createCylinder(w,x,d,p,0),A&&k&&i.cylinderCls.createCylinder(A,k,d,p,0)}else("T"==r&&3==u||"O"==r&&4==u||"I"==r&&5==u)&&(c.push(s),c.push(h))}if("T"==r){let e=c[0];i.sphereCls.createSphereBase(e,colorPolygon,d,1,0);let t,s,l,n=e.distanceTo(c[2]),r=e.distanceTo(c[3]);n<r?(t=n,s=c[3]):(t=r,s=c[2]),i.sphereCls.createSphereBase(s,colorPolygon,d,1,0),i.cylinderCls.createCylinder(e,s,d,colorPolygon,0);for(let n=4,r=c.length;n<r;++n){let r=c[n];e.distanceTo(r)>t&&(i.sphereCls.createSphereBase(r,colorPolygon,d,1,0),i.cylinderCls.createCylinder(e,r,d,colorPolygon,0),i.cylinderCls.createCylinder(s,r,d,colorPolygon,0),void 0!==l&&i.cylinderCls.createCylinder(c[l],r,d,colorPolygon,0),l=n)}}else if("O"==r)for(let e=0,t=c.length;e<t;e+=2){let t=c[e],s=c[e+1];i.sphereCls.createSphereBase(t,colorPolygon,d,1,0),i.sphereCls.createSphereBase(s,colorPolygon,d,1,0);for(let l=e+2,n=c.length;l<n;++l){let e=c[l];i.sphereCls.createSphereBase(e,colorPolygon,d,1,0),i.cylinderCls.createCylinder(t,e,d,colorPolygon,0),i.cylinderCls.createCylinder(s,e,d,colorPolygon,0)}}else if("I"==r)for(let e=0,t=c.length;e<t;e+=2){let t=c[e],s=c[e+1];i.sphereCls.createSphereBase(t,colorPolygon,d,1,0),i.sphereCls.createSphereBase(s,colorPolygon,d,1,0);for(let l=e+2,n=c.length;l<n;l+=2){let e,n,r=c[l],o=c[l+1];t.distanceTo(r)<t.distanceTo(o)?(e=r,n=o):(e=o,n=r),i.sphereCls.createSphereBase(e,colorPolygon,d,1,0),i.sphereCls.createSphereBase(n,colorPolygon,d,1,0),i.cylinderCls.createCylinder(t,e,d,colorPolygon,0),i.cylinderCls.createCylinder(s,n,d,colorPolygon,0)}}}}class Ge{constructor(e){this.icn3d=e}applyOtherOptions(e){let t=this.icn3d,s=t.icn3dui;if(void 0===e&&(e=t.opts),t.hBondCls.setHbondsContacts(e,"contact"),t.hBondCls.setHbondsContacts(e,"halogen"),t.hBondCls.setHbondsContacts(e,"pi-cation"),t.hBondCls.setHbondsContacts(e,"pi-stacking"),t.hBondCls.setHbondsContacts(e,"hbond"),t.hBondCls.setHbondsContacts(e,"saltbridge"),void 0!==t.pairArray&&t.pairArray.length>0){this.updateStabilizer();let e="#FFFFFF",s=t.stabilizerpnts;t.lines.stabilizer=[];for(let i=0,l=Math.floor(s.length/2);i<l;i++){let l={};l.position1=s[2*i],l.position2=s[2*i+1],l.color=e,l.dashed=!1,t.lines.stabilizer.push(l)}}if(t.lineCls.createLines(t.lines),t.distPnts&&t.distPnts.length>0)for(let e=0,s=t.distPnts.length;e<s;++e)t.boxCls.createBox_base(t.distPnts[e],t.originSize,t.hColor,!1);if(void 0!==t.prevMaps)for(let e=0,s=t.prevMaps.length;e<s;++e)t.mdl.add(t.prevMaps[e]);if(void 0!==t.prevEmmaps)for(let e=0,s=t.prevEmmaps.length;e<s;++e)t.mdl.add(t.prevEmmaps[e]);if(void 0!==t.prevPhimaps)for(let e=0,s=t.prevPhimaps.length;e<s;++e)t.mdl.add(t.prevPhimaps[e]);if(void 0!==t.prevSurfaces)for(let e=0,s=t.prevSurfaces.length;e<s;++e)t.mdl.add(t.prevSurfaces[e]);if(void 0!==t.symmetryHash&&void 0!==t.symmetrytitle&&t.applySymdCls.applySymmetry(t.symmetrytitle),void 0!==t.symdArray&&t.symdArray.length>0&&t.applySymdCls.applySymd(),void 0!==t.prevOtherMesh)for(let e=0,s=t.prevOtherMesh.length;e<s;++e)t.mdl.add(t.prevOtherMesh[e]);if(t.bInitial&&""!=s.htmlCls.setHtmlCls.getCookie("glycan")){let e=parseInt(s.htmlCls.setHtmlCls.getCookie("glycan"));t.bGlycansCartoon!=e&&s.htmlCls.clickMenuCls.setLogCmd("set glycan "+e,!0),t.bGlycansCartoon=e}switch(t.bGlycansCartoon&&!t.bAlternate&&t.glycanCls.showGlycans(),t.applyCenterCls.applyCenterOptions(e),t.axesCls.buildAllAxes(void 0,!0),e.axis.toLowerCase()){case"yes":t.axis=!0,t.axesCls.buildAxes(t.maxD/2);break;case"no":t.axis=!1}switch(e.pk.toLowerCase()){case"atom":t.pk=1;break;case"no":t.pk=0;break;case"residue":t.pk=2;break;case"strand":t.pk=3}}applyChemicalbindingOptions(e){let t=this.icn3d,s=t.icn3dui;if(void 0===e&&(e=t.opts),"show"===e.chemicalbinding){let e;void 0!==t.chemicals&&Object.keys(t.chemicals).length>0&&(e=s.hashUtilsCls.hash2Atoms(t.chemicals,t.atoms));let i=4;if(void 0!==e){let l=t.contactCls.getAtomsWithinAtom(t.atoms,e,i),n=3.5;t.opts.hbonds="yes",Object.keys(l).length>0&&t.hBondCls.calculateChemicalHbonds(e,l,parseFloat(n)),t.bSetFog||t.transformCls.zoominSelection(s.hashUtilsCls.unionHash(e,l))}}else"hide"===e.chemicalbinding&&(t.hBondCls.hideHbonds(),t.bSetFog||t.transformCls.zoominSelection(t.atoms))}updateStabilizer(){let e=this.icn3d;if(e.icn3dui,e.stabilizerpnts=[],void 0!==e.pairArray)for(let t=0,s=e.pairArray.length;t<s;t+=2){let s=this.getResidueRepPos(e.pairArray[t]),i=this.getResidueRepPos(e.pairArray[t+1]);e.stabilizerpnts.push(s),e.stabilizerpnts.push(i)}}getResidueRepPos(e){let t=this.icn3d;t.icn3dui;let s,i=t.atoms[e],l=i.structure+"_"+i.chain+"_"+i.resi;if(t.proteins.hasOwnProperty(e)||t.nucleotides.hasOwnProperty(e))for(let e in t.residues[l]){let i=t.atoms[e];if("N3"===i.name){s=t.atoms[e].coord;break}if("CA"===i.name&&"coil"==i.ss){s=t.atoms[e].coord;break}if("CA"===i.name&&("helix"==i.ss||"sheet"==i.ss)){s=void 0!==t.atoms[e].coord2?t.atoms[e].coord2:t.atoms[e].coord;break}}else s=i.coord;return void 0===s&&(s=i.coord),s}}class Ve{constructor(e){this.icn3d=e}applySsbondsOptions(e){let t=this.icn3d,s=t.icn3dui;if(void 0===e&&(e=t.opts),"yes"===e.ssbonds.toLowerCase()&&void 0!==t.ssbondpnts){let e,i,l="#FFFF00",n=s.parasCls.thr(16776960),r=Object.keys(t.structures);if(t.bAlternate){let s=r.length;e=t.ALTERNATE_STRUCTURE%s,i=t.ALTERNATE_STRUCTURE%s+1}else e=0,i=r.length;t.lines.ssbond=[];for(let o=e,a=i;o<a;++o){let e=r[o];if(void 0!==t.ssbondpnts[e])for(let i=Math.floor(t.ssbondpnts[e].length/2)-1;i>=0;i--){let r=t.ssbondpnts[e][2*i],o=t.ssbondpnts[e][2*i+1],a={};a.color=l,a.dashed=!0;let d=[],c=[],h=[],m=[],p=!1,u=!1;for(let e in t.residues[r])"SG"===t.atoms[e].name&&(h.push(t.atoms[e].coord),d.push(t.atoms[e].serial),p=!0);if(!p)for(let e in t.residues[r])if("CA"===t.atoms[e].name){h.push(t.atoms[e].coord),d.push(t.atoms[e].serial),p=!0,u=!0;break}p=!1;for(let e in t.residues[o])"SG"===t.atoms[e].name&&(m.push(t.atoms[e].coord),c.push(t.atoms[e].serial),p=!0);if(!p)for(let e in t.residues[o])if("CA"===t.atoms[e].name){m.push(t.atoms[e].coord),c.push(t.atoms[e].serial),p=!0,u=!0;break}let C=u?7:3,g=!1;for(let e=0,t=h.length;e<t;++e)for(let t=0,s=m.length;t<s;++t)if(h[e].distanceTo(m[t])<C){g=!0,a.serial1=d[e],a.position1=h[e],a.serial2=c[t],a.position2=m[t];break}if(void 0!==a.serial1&&void 0!==a.serial2&&!t.dAtoms.hasOwnProperty(a.serial1)&&!t.dAtoms.hasOwnProperty(a.serial2))continue;if(!g){t.ssbondpnts[e].splice(2*i,2);continue}let f,b,y,v=t.atoms[a.serial1].bonds.indexOf(a.serial2);-1!=v&&(f=t.atoms[a.serial1].bonds.slice(0,v),b=t.atoms[a.serial1].bonds.slice(v+1),t.atoms[a.serial1].bonds=f.concat(b)),v=t.atoms[a.serial2].bonds.indexOf(a.serial1),-1!=v&&(f=t.atoms[a.serial2].bonds.slice(0,v),b=t.atoms[a.serial2].bonds.slice(v+1),t.atoms[a.serial2].bonds=f.concat(b)),t.lines.ssbond.push(a),t.cylinderCls.createCylinder(a.position1,a.position2,t.cylinderRadius,n),y=s.hashUtilsCls.unionHash(y,t.residues[r]),y=s.hashUtilsCls.unionHash(y,t.residues[o]);let _=s.hashUtilsCls.intHash(y,t.sidec);for(let e in _)t.atoms[e].style2="stick"}}}}}class We{constructor(e){this.icn3d=e}rebuildScene(e){let t=this.icn3d;t.icn3dui,void 0===e&&(e=t.opts),this.rebuildSceneBase(e),t.fogCls.setFog(),t.cameraCls.setCamera(),void 0!==t.bSkipChemicalbinding&&t.bSkipChemicalbinding||t.applyOtherCls.applyChemicalbindingOptions(),t.bSkipChemicalbinding=!0,"show"===e.chemicalbinding&&(t.opts.hbonds="yes"),t.applySsbondsCls.applySsbondsOptions(),t.applyClbondsCls.applyClbondsOptions(),t.applyDisplayCls.applyDisplayOptions(t.opts,t.dAtoms),t.applyOtherCls.applyOtherOptions(),t.scene_ghost.updateMatrixWorld(!0)}rebuildSceneBase(e){let t=this.icn3d,s=t.icn3dui;if($.extend(t.opts,e),t.cam_z=2*t.maxD,void 0!==t.scene)for(let e=t.scene.children.length-1;e>=0;e--){let s=t.scene.children[e];t.scene.remove(s)}else t.scene=new THREE.Scene;if(void 0!==t.scene_ghost)for(let e=t.scene_ghost.children.length-1;e>=0;e--){let s=t.scene_ghost.children[e];t.scene_ghost.remove(s)}else t.scene_ghost=new THREE.Scene;if(""!=s.htmlCls.setHtmlCls.getCookie("shininess")){let e=parseFloat(s.htmlCls.setHtmlCls.getCookie("shininess"));t.shininess!=e&&s.htmlCls.clickMenuCls.setLogCmd("set shininess "+e,!0),t.shininess=e}if(!s.bNode&&""!=s.htmlCls.setHtmlCls.getCookie("light1")){let e=parseFloat(s.htmlCls.setHtmlCls.getCookie("light1")),i=parseFloat(s.htmlCls.setHtmlCls.getCookie("light2")),l=parseFloat(s.htmlCls.setHtmlCls.getCookie("light3"));t.light1==e&&t.light2==i&&t.light3==l||s.htmlCls.clickMenuCls.setLogCmd("set light | light1 "+e+" | light2 "+i+" | light3 "+l,!0),t.light1=e,t.light2=i,t.light3=l}t.directionalLight=new THREE.DirectionalLight(16777215,t.light1),t.directionalLight2=new THREE.DirectionalLight(16777215,t.light2),t.directionalLight3=new THREE.DirectionalLight(16777215,t.light3),t.cam_z>0?(t.directionalLight.position.set(-1,1,1),t.directionalLight2.position.set(1,1,1),t.directionalLight3.position.set(1,1,-1),t.lightPos=new THREE.Vector3(-1,1,1),t.lightPos2=new THREE.Vector3(1,1,1),t.lightPos3=new THREE.Vector3(1,1,-1)):(t.directionalLight.position.set(-1,1,-1),t.directionalLight2.position.set(1,1,-1),t.directionalLight3.position.set(1,1,1),t.lightPos=new THREE.Vector3(-1,1,-1),t.lightPos2=new THREE.Vector3(1,1,-1),t.lightPos3=new THREE.Vector3(1,1,1));let i=new THREE.AmbientLight(8947848);if(t.scene.add(t.directionalLight),t.scene.add(i),void 0!==t.mdl)for(let e=t.mdl.children.length-1;e>=0;e--){let s=t.mdl.children[e];s.geometry&&s.geometry.dispose(),s.material&&s.material.dispose(),t.mdl.remove(s)}if(void 0!==t.mdlImpostor){for(let e=t.mdlImpostor.children.length-1;e>=0;e--){let s=t.mdlImpostor.children[e];s.geometry&&s.geometry.dispose(),s.material&&s.material.dispose(),t.mdlImpostor.remove(s)}t.mdlImpostor.children.length=0}s.bNode||t.renderer.renderLists.dispose(),t.mdl=new THREE.Object3D,t.mdlImpostor=new THREE.Object3D,t.scene.add(t.mdl),t.scene.add(t.mdlImpostor),t.mdl_ghost=new THREE.Object3D,t.scene_ghost.add(t.mdl_ghost),t.objects=[],t.objects_ghost=[],t.raycaster=new THREE.Raycaster,t.projector=new THREE.Projector,t.mouse=new THREE.Vector2;let l=s.parasCls.backgroundColors[t.opts.background.toLowerCase()];s.bNode||("transparent"===t.opts.background.toLowerCase()?t.renderer.setClearColor(l,0):t.renderer.setClearColor(l,1)),t.perspectiveCamera=new THREE.PerspectiveCamera(20,t.container.whratio,.1,1e4),t.perspectiveCamera.position.set(0,0,t.cam_z),t.perspectiveCamera.lookAt(new THREE.Vector3(0,0,0)),t.orthographicCamera=new THREE.OrthographicCamera,t.orthographicCamera.position.set(0,0,t.cam_z),t.orthographicCamera.lookAt(new THREE.Vector3(0,0,0)),t.cams={perspective:t.perspectiveCamera,orthographic:t.orthographicCamera}}}class Ye{constructor(e){this.icn3d=e}onBeforeRender(e,t,s,i,l,n){let r=l.uniforms,o=[];if(r.objectId&&(r.objectId.value=SupportsReadPixelsFloat?this.id:this.id/255,o.push("objectId")),(r.modelViewMatrixInverse||r.modelViewMatrixInverseTranspose||r.modelViewProjectionMatrix||r.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,this.matrixWorld),r.modelViewMatrixInverse&&(r.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert(),o.push("modelViewMatrixInverse")),r.modelViewMatrixInverseTranspose&&(r.modelViewMatrixInverse?r.modelViewMatrixInverseTranspose.value.copy(r.modelViewMatrixInverse.value).transpose():r.modelViewMatrixInverseTranspose.value.copy(this.modelViewMatrix).invert().transpose(),o.push("modelViewMatrixInverseTranspose")),r.modelViewProjectionMatrix&&(s.updateProjectionMatrix(),r.modelViewProjectionMatrix.value.multiplyMatrices(s.projectionMatrix,this.modelViewMatrix),o.push("modelViewProjectionMatrix")),r.modelViewProjectionMatrixInverse){let e=new THREE.Matrix4;r.modelViewProjectionMatrix?(e.copy(r.modelViewProjectionMatrix.value),r.modelViewProjectionMatrixInverse.value.copy(e).invert()):(s.updateProjectionMatrix(),e.multiplyMatrices(s.projectionMatrix,this.modelViewMatrix),r.modelViewProjectionMatrixInverse.value.copy(e).invert()),o.push("modelViewProjectionMatrixInverse")}if(r.projectionMatrix&&(s.updateProjectionMatrix(),r.projectionMatrix.value.copy(s.projectionMatrix),o.push("projectionMatrix")),r.projectionMatrixInverse&&(s.updateProjectionMatrix(),r.projectionMatrixInverse.value.copy(s.projectionMatrix).invert(),o.push("projectionMatrixInverse")),o.length){let t=e.properties.get(l);if(t.program){let s=e.getContext(),i=t.program;s.useProgram(i.program);let l=i.getUniforms();o.forEach((function(e){l.setValue(s,e,r[e].value)}))}}}setParametersForShader(e){let t,s=this.icn3d,i=s.icn3dui.parasCls.backgroundColors[s.opts.background.toLowerCase()],l=2.5*s.maxD,n=4*s.maxD,r=void 0!==s.biomtMatrices&&s.biomtMatrices.length*s.cnt>s.maxatomcnt;"yes"===s.opts.slab?r?t=.1:void 0!==s.camMaxDFactorFog?(t=s.maxD*s.camMaxDFactorFog-10,l=2.5*s.maxD-t<0?0:2.5*s.maxD-t,n=4*s.maxD-t):t=s.maxD*s.camMaxDFactor:t=.1;let o=void 0!==e?e:1,a=s.shininess/100*.5;s.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,{modelViewMatrix:{value:new THREE.Matrix4},modelViewMatrixInverse:{value:new THREE.Matrix4},modelViewMatrixInverseTranspose:{value:new THREE.Matrix4},modelViewProjectionMatrix:{value:new THREE.Matrix4},modelViewProjectionMatrixInverse:{value:new THREE.Matrix4},projectionMatrix:{value:new THREE.Matrix4},projectionMatrixInverse:{value:new THREE.Matrix4},diffuse:{type:"v3",value:[1,1,1]},emissive:{type:"v3",value:[.06,.06,.06]},roughness:{type:"f",value:.5},metalness:{type:"f",value:a},opacity:{type:"f",value:o},nearClip:{type:"f",value:t},ortho:{type:"f",value:0},shrink:{type:"f",value:.13},fogColor:{type:"v3",value:[i.r,i.g,i.b]},fogNear:{type:"f",value:l},fogFar:{type:"f",value:n},fogDensity:{type:"f",value:2}},THREE.UniformsLib.ambient,THREE.UniformsLib.lights]),s.defines={USE_COLOR:1,NEAR_CLIP:1,CAP:1},"yes"!==s.opts.fog||r||(s.defines.USE_FOG=1,"orthographic"===s.opts.camera&&(s.defines.FOG_EXP2=1)),s.bExtFragDepth&&(s.defines.USE_LOGDEPTHBUF_EXT=1)}drawImpostorShader(){this.icn3d.icn3dui.bNode||(this.setParametersForShader(),this.createImpostorShaderSphere("SphereImpostor"),this.createImpostorShaderCylinder("CylinderImpostor"))}getShader(e){this.icn3d.icn3dui;let t=$NGL_shaderTextHash[e];return t=t.replace(/#include\s+(\S+)/gim,(function(e,t){let s;return THREE.ShaderChunk.hasOwnProperty(t)&&(s=THREE.ShaderChunk[t]),s||""})),t}createImpostorShaderBase(e,t,s,i,l,n,r,o,a){let d=this.icn3d;d.icn3dui;let c=new THREE.ShaderMaterial({defines:d.defines,uniforms:d.uniforms,vertexShader:this.getShader(e+".vert"),fragmentShader:this.getShader(e+".frag"),depthTest:!0,depthWrite:!0,lights:!0});c.extensions.fragDepth=!0,"CylinderImpostor"==e?d.CylinderImpostorMaterial=c:"SphereImpostor"==e&&(d.SphereImpostorMaterial=c);let h,m,p=n*r,u=n*o,C=new(p>65535?Uint32Array:Uint16Array)(u);for(let e=0;e<n;e++){h=e*o,m=e*r,C.set(s,h);for(let e=0;e<o;++e)C[h+e]+=m}let g=new THREE.BufferGeometry;C&&(g.setIndex(new THREE.BufferAttribute(C,1)),g.getIndex().setUsage(THREE.DynamicDrawUsage));let f={f:1,v2:2,v3:3,c:3};for(let e in l){let t,s=l[e];t=new Float32Array(p*f[s.type]),g.setAttribute(e,new THREE.BufferAttribute(t,f[s.type]).setUsage(THREE.DynamicDrawUsage))}let b,y,v,_,S,w,A=g.attributes;for(let e in i){y=i[e],b=A[e],v=b.itemSize,_=b.array;for(let e=0;e<n;++e){u=e*v,S=u*r;for(let e=0;e<r;++e){w=S+v*e;for(let e=0;e<v;++e)_[w+e]=y[u+e]}}b.needsUpdate=!0}let x=g.attributes.mapping.array;for(let e=0;e<n;e++)x.set(t,e*a*r);let k=new THREE.Mesh(g,c);k.frustumCulled=!1,k.scale.x=k.scale.y=k.scale.z=1,"CylinderImpostor"==e?k.type="Cylinder":"SphereImpostor"==e&&(k.type="Sphere"),k.onBeforeRender=this.onBeforeRender,d.mdlImpostor.add(k)}createImpostorShaderCylinder(e){let t=this.icn3d;t.icn3dui;let s=new Float32Array(t.posArray),i=new Float32Array(t.colorArray),l=new Float32Array(t.pos2Array),n=new Float32Array(t.color2Array),r=new Float32Array(t.radiusArray),o=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),a=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]),d=s.length/3,c={position1:s,color:i,position2:l,color2:n,radius:r},h={position1:{type:"v3",value:null},color:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"v3",value:null},radius:{type:"f",value:null},mapping:{type:"v3",value:null}};this.createImpostorShaderBase(e,o,a,c,h,d,6,12,3),c=null,s=null,i=null,l=null,n=null,r=null,t.posArray=[],t.colorArray=[],t.pos2Array=[],t.color2Array=[],t.radiusArray=[]}createImpostorShaderSphere(e){let t=this.icn3d;t.icn3dui;let s=new Float32Array(t.posArraySphere),i=new Float32Array(t.colorArraySphere),l=new Float32Array(t.radiusArraySphere),n=new Float32Array([-1,1,-1,-1,1,1,1,-1]),r=new Uint16Array([0,1,2,1,3,2]),o=s.length/3,a={position:s,color:i,radius:l},d={position:{type:"v3",value:null},color:{type:"v3",value:null},radius:{type:"f",value:null},mapping:{type:"v2",value:null}};this.createImpostorShaderBase(e,n,r,a,d,o,4,6,2),a=null,s=null,i=null,l=null,t.posArraySphere=[],t.colorArraySphere=[],t.radiusArraySphere=[]}clearImpostors(){let e=this.icn3d;e.icn3dui,e.posArray=[],e.colorArray=[],e.pos2Array=[],e.color2Array=[],e.radiusArray=[],e.posArraySphere=[],e.colorArraySphere=[],e.radiusArraySphere=[]}}class Xe{constructor(e){this.icn3d=e}positionFromGeometry(e){this.icn3d.icn3dui;let t,s,i=e.geometry,l=i.vertices,n=e.position,r=e.scale,o=e.matrix,a=l.length,d=[];for(let e=0;e<a;e++)t=3*e,s="SphereGeometry"==i.type||"BoxGeometry"==i.type?l[e].clone().multiply(r).add(n):"CylinderGeometry"==i.type?l[e].clone().applyMatrix4(o):l[e],d[t+0]=s.x,d[t+1]=s.y,d[t+2]=s.z;return d}colorFromGeometry(e){let t=this.icn3d.icn3dui,s=e.geometry,i=t.parasCls.thr(1,1,1);"SphereGeometry"!=s.type&&"BoxGeometry"!=s.type&&"CylinderGeometry"!=s.type||void 0!==e.material&&(i=e.material.color);let l,n,r,o,a,d=s.faces;s.vertices.length,s.type;let c=d.length,h=[];for(let e=0;e<c;e++)n=d[e],"Surface"==s.type?(r=n.vertexColors[0],o=n.vertexColors[1],a=n.vertexColors[2]):"SphereGeometry"==s.type||"BoxGeometry"==s.type||"CylinderGeometry"==s.type?(r=i,o=i,a=i):(r=n.color,o=n.color,a=n.color),l=3*n.a,h[l+0]=r.r,h[l+1]=r.g,h[l+2]=r.b,l=3*n.b,h[l+0]=o.r,h[l+1]=o.g,h[l+2]=o.b,l=3*n.c,h[l+0]=a.r,h[l+1]=a.g,h[l+2]=a.b;return h}indexFromGeometry(e){this.icn3d.icn3dui;let t,s,i=e.geometry.faces,l=i.length,n=[];for(let e=0;e<l;e++)t=3*e,s=i[e],n[t+0]=s.a,n[t+1]=s.b,n[t+2]=s.c;return n}normalFromGeometry(e){this.icn3d.icn3dui;let t,s,i,l,n,r,o=e.geometry,a=o.faces;o.vertices.length;let d=a.length,c=[];for(let e=0;e<d;e++)s=a[e],i=s.vertexNormals,l=i[0],n=i[1],r=i[2],t=3*s.a,c[t+0]=l.x,c[t+1]=l.y,c[t+2]=l.z,t=3*s.b,c[t+0]=n.x,c[t+1]=n.y,c[t+2]=n.z,t=3*s.c,c[t+0]=r.x,c[t+1]=r.y,c[t+2]=r.z;return c}drawSymmetryMates(){let e=this.icn3d;e.icn3dui.bNode||(e.bInstanced?this.drawSymmetryMatesInstancing():this.drawSymmetryMatesNoInstancing())}applyMat(e,t,s){let i=this.icn3d;if(i.icn3dui,void 0===i.rmsd_supr)e.applyMatrix4(t);else{let s=i.rmsd_supr.rot,l=i.rmsd_supr.trans1,n=i.rmsd_supr.trans2,r=new THREE.Matrix4;r.set(s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1);let o=new THREE.Matrix4;o.copy(r).invert();let a=new THREE.Matrix4;a.makeTranslation(-n.x,-n.y,-n.z),e.applyMatrix4(a),e.applyMatrix4(o),a.makeTranslation(l.x,l.y,l.z),e.applyMatrix4(a),e.applyMatrix4(t),a.makeTranslation(-l.x,-l.y,-l.z),e.applyMatrix4(a),e.applyMatrix4(r),a.makeTranslation(n.x,n.y,n.z),e.applyMatrix4(a)}}drawSymmetryMatesNoInstancing(){let e=this.icn3d;if(e.icn3dui,void 0===e.biomtMatrices||0==e.biomtMatrices.length)return;let t=1,s=e.center.clone(),i=new THREE.Matrix4;i.identity();let l=new THREE.Object3D,n=new THREE.Object3D,r=new THREE.Object3D;for(let o=0;o<e.biomtMatrices.length&&1==Object.keys(e.structures).length;o++){let a,d=e.biomtMatrices[o];if(void 0===d)continue;if(d.equals(i))continue;if(void 0!==e.mdl&&(a=e.mdl.clone(),this.applyMat(a,d),l.add(a)),void 0!==e.mdlImpostor){a=e.mdlImpostor.clone(),this.applyMat(a,d);for(let t=a.children.length-1;t>=0;t--){let s=a.children[t];s.onBeforeRender=e.impostorCls.onBeforeRender,s.frustumCulled=!1}n.add(a)}void 0!==e.mdl_ghost&&(a=e.mdl_ghost.clone(),this.applyMat(a,d),r.add(a));let c=e.center.clone();this.applyMat(c,d,!0),s.add(c),++t}e.mdl.add(l),e.mdlImpostor.add(n),e.mdl_ghost.add(r),void 0!==e.bSetInstancing&&e.bSetInstancing?(e.maxD=e.maxDAssembly,e.center=e.centerAssembly.clone(),e.applyCenterCls.setCenter(e.center),e.cameraCls.setCamera()):(e.maxD*=Math.sqrt(t),e.center=e.ParserUtilsCls.getMassCenter(s,t),e.maxDAssembly=e.maxD,e.centerAssembly=e.center.clone(),e.applyCenterCls.setCenter(e.center),e.cameraCls.setCamera()),e.bSetInstancing=!0}createInstancedGeometry(e){let t=this.icn3d,s=t.icn3dui,i=e.geometry,l=new THREE.InstancedBufferGeometry,n=[],r=[],o=[],a=[],d=[],c=[],h=[],m=[];if(t.bImpo&&"Cylinder"==e.type){t.instancedMaterial=this.getInstancedMaterial("CylinderInstancing");let e=s.hashUtilsCls.hashvalue2array(i.attributes.position1.array),r=s.hashUtilsCls.hashvalue2array(i.attributes.color.array),p=s.hashUtilsCls.hashvalue2array(i.attributes.position2.array),u=s.hashUtilsCls.hashvalue2array(i.attributes.color2.array),C=s.hashUtilsCls.hashvalue2array(i.index.array),g=s.hashUtilsCls.hashvalue2array(i.attributes.radius.array),f=s.hashUtilsCls.hashvalue2array(i.attributes.mapping.array);n=n.concat(e),o=o.concat(r),h=h.concat(p),m=m.concat(u),a=a.concat(C),d=d.concat(g),c=c.concat(f),l.setAttribute("position1",new THREE.BufferAttribute(new Float32Array(n),3)),l.setAttribute("color",new THREE.BufferAttribute(new Float32Array(o),3)),l.setAttribute("position2",new THREE.BufferAttribute(new Float32Array(h),3)),l.setAttribute("color2",new THREE.BufferAttribute(new Float32Array(m),3)),l.setAttribute("radius",new THREE.BufferAttribute(new Float32Array(d),1)),l.setAttribute("mapping",new THREE.BufferAttribute(new Float32Array(c),3)),l.setIndex(new THREE.BufferAttribute(new Uint32Array(a),1)),e=null,r=null,p=null,u=null,C=null,g=null,f=null}else if(t.bImpo&&"Sphere"==e.type){t.instancedMaterial=this.getInstancedMaterial("SphereInstancing");let e=s.hashUtilsCls.hashvalue2array(i.attributes.position.array),r=s.hashUtilsCls.hashvalue2array(i.attributes.color.array),h=s.hashUtilsCls.hashvalue2array(i.index.array),m=s.hashUtilsCls.hashvalue2array(i.attributes.radius.array),p=s.hashUtilsCls.hashvalue2array(i.attributes.mapping.array);n=n.concat(e),o=o.concat(r),a=a.concat(h),d=d.concat(m),c=c.concat(p),l.setAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),l.setAttribute("color",new THREE.BufferAttribute(new Float32Array(o),3)),l.setAttribute("radius",new THREE.BufferAttribute(new Float32Array(d),1)),l.setAttribute("mapping",new THREE.BufferAttribute(new Float32Array(c),2)),l.setIndex(new THREE.BufferAttribute(new Uint32Array(a),1)),e=null,r=null,h=null,m=null,p=null}else{t.instancedMaterial=this.getInstancedMaterial("Instancing");let e=i.attributes.position?s.hashUtilsCls.hashvalue2array(i.attributes.position.array):[],d=i.attributes.normal?s.hashUtilsCls.hashvalue2array(i.attributes.normal.array):[],c=i.attributes.color?s.hashUtilsCls.hashvalue2array(i.attributes.color.array):[],h=i.index?s.hashUtilsCls.hashvalue2array(i.index.array):[];n=n.concat(e),r=r.concat(d),o=o.concat(c),a=a.concat(h);let m=[],p="CylinderGeometry"==i.type?1:0;for(let e=0,t=n.length/3;e<t;++e)m.push(p);l.setAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),l.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(r),3)),l.setAttribute("color",new THREE.BufferAttribute(new Float32Array(o),3)),l.setAttribute("cylinder",new THREE.BufferAttribute(new Float32Array(m),1)),l.setIndex(new THREE.BufferAttribute(new Uint32Array(a),1)),e=null,d=null,c=null,h=null}n=null,r=null,o=null,a=null,d=null,c=null,h=null,m=null;let p=new THREE.InstancedBufferAttribute(new Float32Array(t.matricesElements1),4),u=new THREE.InstancedBufferAttribute(new Float32Array(t.matricesElements2),4),C=new THREE.InstancedBufferAttribute(new Float32Array(t.matricesElements3),4),g=new THREE.InstancedBufferAttribute(new Float32Array(t.matricesElements4),4);return l.setAttribute("matrix1",p),l.setAttribute("matrix2",u),l.setAttribute("matrix3",C),l.setAttribute("matrix4",g),l}getInstancedMaterial(e){let t=this.icn3d;t.icn3dui;let s=new THREE.ShaderMaterial({defines:t.defines,uniforms:t.uniforms,vertexShader:t.impostorCls.getShader(e+".vert"),fragmentShader:t.impostorCls.getShader(e+".frag"),depthTest:!0,depthWrite:!0,lights:!0});return s.extensions.fragDepth=!0,s.extensions.derivatives="#extension GL_OES_standard_derivatives : enable",s}createInstancedMesh(e){let t=this.icn3d;t.icn3dui;for(let s=0,i=e.children.length;s<i;++s){let i=e.children[s];if("Sprite"===i.type)continue;let l=this.createInstancedGeometry(i),n=new THREE.Mesh(l,t.instancedMaterial);n.onBeforeRender=t.impostorCls.onBeforeRender,n.frustumCulled=!1,n.scale.x=n.scale.y=n.scale.z=1,n.type=i.type,l=null,e.add(n)}}drawSymmetryMatesInstancing(){let e=this.icn3d;if(e.icn3dui,void 0===e.biomtMatrices||0==e.biomtMatrices.length)return;let t=1,s=e.center.clone();if(e.impostorCls.setParametersForShader(),void 0===e.bSetInstancing||!e.bSetInstancing){e.matricesElements1=[],e.matricesElements2=[],e.matricesElements3=[],e.matricesElements4=[];let i=new THREE.Matrix4;i.identity();for(let l=0;l<e.biomtMatrices.length&&1==Object.keys(e.structures).length;l++){let n=e.biomtMatrices[l];if(void 0===n)continue;let r=n.toArray();if(n.equals(i))continue;e.matricesElements1.push(r[0],r[1],r[2],r[3]),e.matricesElements2.push(r[4],r[5],r[6],r[7]),e.matricesElements3.push(r[8],r[9],r[10],r[11]),e.matricesElements4.push(r[12],r[13],r[14],r[15]);let o=e.center.clone();o.applyMatrix4(n),s.add(o),++t}}this.createInstancedMesh(e.mdl),this.createInstancedMesh(e.mdlImpostor),void 0!==e.bSetInstancing&&e.bSetInstancing?(e.maxD=e.maxDAssembly,e.center=e.centerAssembly.clone(),e.applyCenterCls.setCenter(e.center),e.cameraCls.setCamera()):(e.maxD*=Math.sqrt(t),e.center=e.ParserUtilsCls.getMassCenter(s,t),e.maxDAssembly=e.maxD,e.centerAssembly=e.center.clone(),e.applyCenterCls.setCenter(e.center),e.cameraCls.setCamera()),e.bSetInstancing=!0}}class Je{constructor(e){this.icn3d=e}draw(){let e=this.icn3d,t=e.icn3dui;!e.bRender||e.hAtoms&&0!=Object.keys(e.hAtoms)||(e.hAtoms=t.hashUtilsCls.cloneHash(e.atoms)),e.sceneCls.rebuildScene(),e.bImpo&&e.impostorCls.drawImpostorShader(),e.setColorCls.applyPrevColor(),void 0!==e.biomtMatrices&&e.biomtMatrices.length>1&&(e.bAssembly&&1==Object.keys(e.structures).length&&(void 0===t.cfg.mmdbid&&1==t.cfg.bu||void 0!==t.cfg.mmdbid&&1==t.cfg.bu&&Object.keys(e.atoms).length*e.biomtMatrices.length>e.maxatomcnt)?e.instancingCls.drawSymmetryMates():e.applyCenterCls.centerSelection());let s=void 0!==e.hAtoms?Object.keys(e.hAtoms).length:0;s>0&&s<Object.keys(e.dAtoms).length&&(e.hlObjectsCls.removeHlObjects(),(void 0===e.bShowHighlight||e.bShowHighlight)&&e.hlObjectsCls.addHlObjects()),!0===e.bRender&&((e.bInitial||$("#"+e.pre+"wait").is(":visible"))&&($("#"+e.pre+"wait")&&$("#"+e.pre+"wait").hide(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").show(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").show()),this.applyTransformation(e._zoomFactor,e.mouseChange,e.quaternion),this.render()),e.impostorCls.clearImpostors()}applyTransformation(e,t,s){let i=this.icn3d,l=i.icn3dui;if(l.bNode)return;let n={update:!1};n._zoomFactor=e,n.mouseChange=new THREE.Vector2,n.mouseChange.copy(t),n.quaternion=new THREE.Quaternion,n.quaternion.copy(s),i.bControlGl&&!l.bNode?window.controls.update(n):i.controls.update(n)}render(){let e=this.icn3d,t=e.icn3dui;if(t.bNode)return;let s=e.bControlGl&&!t.bNode?window.cam:e.cam;if(e.directionalLight){let t=new THREE.Quaternion;t.setFromUnitVectors(new THREE.Vector3(0,0,e.cam_z).normalize(),s.position.clone().normalize()),e.directionalLight.position.copy(e.lightPos.clone().applyQuaternion(t).normalize()),e.directionalLight2.position.copy(e.lightPos2.clone().applyQuaternion(t).normalize()),e.directionalLight3.position.copy(e.lightPos3.clone().applyQuaternion(t).normalize())}e.renderer.setPixelRatio(window.devicePixelRatio),e.scene&&e.renderer.render(e.scene,s)}}class Ke{constructor(e){this.icn3d=e}resetOrientation(){let e=this.icn3d;e.icn3dui;let t=!1;if(e.commands.length>0){let s=e.commands[0].split("|||");if(2==s.length){let i=JSON.parse(s[1]);e._zoomFactor=i.factor,e.mouseChange.x=i.mouseChange.x,e.mouseChange.y=i.mouseChange.y,e.quaternion._x=i.quaternion._x,e.quaternion._y=i.quaternion._y,e.quaternion._z=i.quaternion._z,e.quaternion._w=i.quaternion._w,t=!0}}t||(e._zoomFactor=1,e.mouseChange=new THREE.Vector2(0,0),e.quaternion=new THREE.Quaternion(0,0,0,1)),e.maxD=e.oriMaxD,e.center=e.oriCenter.clone(),"show"==e.ori_chemicalbinding?e.bSkipChemicalbinding=!1:"hide"==e.ori_chemicalbinding&&(e.bSkipChemicalbinding=!0)}rotateLeft(e){let t=this.icn3d,s=t.icn3dui,i=new THREE.Vector3(0,1,0),l=-e/180*Math.PI;t.bControlGl&&!s.bNode?i.applyQuaternion(window.cam.quaternion).normalize():i.applyQuaternion(t.cam.quaternion).normalize();let n=new THREE.Quaternion;n.setFromAxisAngle(i,-l);let r={};r.quaternion=n,r.update=!0,t.bControlGl&&!s.bNode?window.controls.update(r):t.controls.update(r),t.bRender&&t.drawCls.render()}rotateRight(e){let t=this.icn3d,s=t.icn3dui,i=new THREE.Vector3(0,1,0),l=e/180*Math.PI;t.bControlGl&&!s.bNode?i.applyQuaternion(window.cam.quaternion).normalize():i.applyQuaternion(t.cam.quaternion).normalize();let n=new THREE.Quaternion;n.setFromAxisAngle(i,-l);let r={};r.quaternion=n,r.update=!0,t.bControlGl&&!s.bNode?window.controls.update(r):t.controls.update(r),t.bRender&&t.drawCls.render()}rotateUp(e){this.icn3d.icn3dui,this.rotate_base(-e)}rotateDown(e){this.icn3d.icn3dui,this.rotate_base(e)}rotate_base(e){let t=this.icn3d,s=t.icn3dui,i=new THREE.Vector3(1,0,0),l=e/180*Math.PI;t.bControlGl&&!s.bNode?i.applyQuaternion(window.cam.quaternion).normalize():i.applyQuaternion(t.cam.quaternion).normalize();let n=new THREE.Quaternion;n.setFromAxisAngle(i,-l);let r={};r.quaternion=n,r.update=!0,t.bControlGl&&!s.bNode?window.controls.update(r):t.controls.update(r),t.bRender&&t.drawCls.render()}setRotation(e,t){let s=this.icn3d,i=s.icn3dui;s.bControlGl&&!i.bNode?e.applyQuaternion(window.cam.quaternion).normalize():e.applyQuaternion(s.cam.quaternion).normalize();let l=new THREE.Quaternion;l.setFromAxisAngle(e,-t);let n={};n.quaternion=l,n.update=!0,s.bControlGl&&!i.bNode?window.controls.update(n):s.controls.update(n),s.bRender&&s.drawCls.render()}translateLeft(e){this.icn3d.icn3dui,this.translate_base(-e,0)}translateRight(e){this.icn3d.icn3dui,this.translate_base(e,0)}translateUp(e){this.icn3d.icn3dui,this.translate_base(0,-e)}translateDown(e){this.icn3d.icn3dui,this.translate_base(0,e)}translate_base(e,t){let s=this.icn3d,i=s.icn3dui,l=new THREE.Vector2(0,0);l.x+=e/100,l.y+=t/100;let n={};n.mouseChange=l,n.update=!0,s.bControlGl&&!i.bNode?window.controls.update(n):s.controls.update(n),s.bRender&&s.drawCls.render()}zoominSelection(e){let t=this.icn3d,s=t.icn3dui,i={};if(i._zoomFactor=1/t._zoomFactor,i.update=!0,t.bControlGl&&!s.bNode?window.controls.update(i):t.controls.update(i),void 0===e&&(e=s.hashUtilsCls.hash2Atoms(t.hAtoms,t.atoms)),Object.keys(e).length>1){let s=t.applyCenterCls.centerAtoms(e);t.maxD=s.maxD,t.maxD<5&&(t.maxD=5),t.center=s.center,t.applyCenterCls.setCenter(t.center),t.cameraCls.setCamera()}}getTransformationStr(e){this.icn3d.icn3dui;let t={factor:1,mouseChange:{x:0,y:0},quaternion:{_x:0,_y:0,_z:0,_w:1}};return t.factor=parseFloat(e.factor).toPrecision(4),t.mouseChange.x=parseFloat(e.mouseChange.x).toPrecision(4),t.mouseChange.y=parseFloat(e.mouseChange.y).toPrecision(4),t.quaternion._x=parseFloat(e.quaternion._x).toPrecision(4),t.quaternion._y=parseFloat(e.quaternion._y).toPrecision(4),t.quaternion._z=parseFloat(e.quaternion._z).toPrecision(4),t.quaternion._w=parseFloat(e.quaternion._w).toPrecision(4),"1.0000"==t.factor&&(t.factor=1),"0.0000"==t.mouseChange.x&&(t.mouseChange.x=0),"0.0000"==t.mouseChange.y&&(t.mouseChange.y=0),"0.0000"==t.quaternion._x&&(t.quaternion._x=0),"0.0000"==t.quaternion._y&&(t.quaternion._y=0),"0.0000"==t.quaternion._z&&(t.quaternion._z=0),"1.0000"==t.quaternion._w&&(t.quaternion._w=1),JSON.stringify(t)}}class Qe{constructor(e){this.icn3d=e}saveFile(e,t,s){let i,l=this.icn3d,n=l.icn3dui;if("command"===t){let e=l.loadCmd?l.loadCmd+"\n":"";for(let t=0,s=l.commands.length;t<s;++t){let i=l.commands[t].trim();if(t==s-1){let e=i.split("|||"),t={};t.factor=l._zoomFactor,t.mouseChange=l.mouseChange,t.quaternion=l.quaternion,i=e[0]+"|||"+l.transformCls.getTransformationStr(t)}e+=i+"\n"}let t=decodeURIComponent(e);i=new Blob([t],{type:"text;charset=utf-8;"})}else if("png"===t){let t=$("#"+l.pre+"canvas").width(),s=$("#"+l.pre+"canvas").height();l.applyCenterCls.setWidthHeight(t,s),l.bRender&&l.drawCls.render();let r=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob||(r=!1),n.utilsCls.isIE()){if(i=l.renderer.domElement.msToBlob(),!r)return void saveAs(i,e);{let t=new FileReader;t.onload=function(t){let s=t.target.result,r=l.shareLinkCls.getPngText();i=n.convertTypeCls.getBlobFromBufferAndText(s,r),saveAs(i,e)},t.readAsArrayBuffer(i)}}else l.renderer.domElement.toBlob((function(t){if(!r)return i=t,void saveAs(i,e);{let s=new FileReader;s.onload=function(t){let s=t.target.result,r=l.shareLinkCls.getPngText();i=n.convertTypeCls.getBlobFromBufferAndText(s,r),saveAs(i,e)},s.readAsArrayBuffer(t)}}));l.scaleFactor=1,l.applyCenterCls.setWidthHeight(t,s),l.bRender&&l.drawCls.render()}else if("html"===t){let e=decodeURIComponent(s);i=new Blob([e],{type:"text/html;charset=utf-8;"})}else if("text"===t){i=new Blob(s,{type:"text;charset=utf-8;"})}else if("binary"===t){i=new Blob(s,{type:"application/octet-stream"})}"png"!==t&&saveAs(i,e)}saveSvg(e,t,s){if(this.icn3d.icn3dui.bNode)return"";let i=$("#"+e).width(),l=$("#"+e).height();s&&(l=i);let n=this.getSvgXml(e,i,l,s),r=new Blob([n],{type:"image/svg+xml"});saveAs(r,t)}getSvgXml(e,t,s,i){if(this.icn3d.icn3dui.bNode)return"";return(t&&s?'<svg viewBox="0 0 '+t+" "+s+'"':"<svg")+' title="graph" xmlns:xl="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:dc="http://purl.org/dc/elements/1.1/">'+"<style>text {font-family: sans-serif; font-weight: bold; font-size: 18px;}</style>"+document.getElementById(e).innerHTML+"</svg>"}savePng(e,t,s){let i=this.icn3d,l=i.icn3dui;if(l.bNode)return"";let n=$("#"+e).width(),r=$("#"+e).height();s&&(r=n);let o=document.getElementById(e),a=o.getBBox(),d=o.cloneNode(!0);i.lineGraphCls.copyStylesInline(d,o);let c=document.createElement("CANVAS");c.width=n,c.height=r;let h=c.getContext("2d");h.clearRect(0,0,a.width,a.height);let m=this.getSvgXml(e,n,r,s),p=window.URL||window.webkitURL||window,u=new Blob([m],{type:"image/svg+xml;charset=utf-8"}),C=new Image;C.src=p.createObjectURL(u),C.onload=function(){if(h.drawImage(C,0,0),p.revokeObjectURL(this.src),l.utilsCls.isIE()){let e=c.msToBlob();e&&(saveAs(e,t),c.remove())}else c.toBlob((function(e){e&&(saveAs(e,t),c.remove())}))}}exportCustomAtoms(e){var t=this.icn3d;t.icn3dui;let s="",i=void 0!==t.defNames2Residues?Object.keys(t.defNames2Residues).sort():[];for(let l=0,n=i.length;l<n;++l){let n=i[l],r=t.defNames2Residues[n];t.defNames2Descr[n];let o=t.defNames2Command[n];o=o.replace(/,/g,", "),s+=this.exportResidues(n,r,e)}i=void 0!==t.defNames2Atoms?Object.keys(t.defNames2Atoms).sort():[];for(let l=0,n=i.length;l<n;++l){let n=i[l],r=t.defNames2Atoms[n];t.defNames2Descr[n];let o=t.defNames2Command[n];o=o.replace(/,/g,", ");let a=t.resid2specCls.atoms2residues(r);s+=this.exportResidues(n,a,e)}return s}exportResidues(e,t,s){var i=this.icn3d,l=i.icn3dui;let n="";if(t.length>0)if(s){let s={};for(let e=0,n=t.length;e<n;++e){let n=t[e],r=i.firstAtomObjCls.getFirstAtomObj(i.residues[n]),o=r.structure+"_"+r.chain,a=l.utilsCls.residueName2Abbr(r.resn)+r.resi;s.hasOwnProperty(o)||(s[o]=[]),s[o].push(a)}n+=e+":\n";for(let e in s){let t=1==s[e].length?"residue":"residues";n+=e+" ("+s[e].length+" "+t+"): ",n+=s[e].join(", "),n+="\n"}n+="\n"}else n+=e+"\tselect ",n+=i.resid2specCls.residueids2spec(t),n+="\n";return n}getAtomPDB(e,t,s,i){let l=this.icn3d,n=l.icn3dui,r="",o={},a={};for(let e in l.chemicals){let t=l.atoms[e];if("P"==t.elem){o[e]=1;for(let e=0,s=t.bonds.length;e<s;++e){let s=t.bonds[e];s&&"O"==l.atoms[s].elem&&(a[s]=1)}}}let d=n.hashUtilsCls.intHash(e,l.calphas),c=!1,h=!0,m=!1,p=!0,u={};for(let e in l.structures)u[e]="";for(let e in d){let t=l.atoms[e],s=t.structure;t.ssbegin&&("helix"==t.ss?(c=!0,h&&(u[s]+="HELIX".padEnd(15," ")+t.resn.padStart(3," ")+t.chain.replace(/_/gi,"").substr(0,2).padStart(2," ")+t.resi.toString().padStart(5," ")),h=!1):"sheet"==t.ss&&(m=!0,p&&(u[s]+="SHEET".padEnd(17," ")+t.resn.padStart(3," ")+t.chain.replace(/_/gi,"").substr(0,2).padStart(2," ")+t.resi.toString().padStart(4," ")),p=!1)),t.ssend&&("helix"==t.ss?(h=!0,c&&(u[s]+=t.resn.padStart(5," ")+t.chain.replace(/_/gi,"").substr(0,2).padStart(2," ")+t.resi.toString().padStart(5," ")+"\n"),c=!1):"sheet"==t.ss&&(p=!0,m&&(u[s]+=t.resn.padStart(5," ")+t.chain.replace(/_/gi,"").substr(0,2).padStart(2," ")+t.resi.toString().padStart(4," ")+"\n"),m=!1))}if(l.biomtMatrices){let e=Object.keys(l.structures)[0];for(let t=0,s=l.biomtMatrices.length;t<s;++t){let s=t+1;for(let i=0;i<3;++i){let n=i+1;u[e]+="REMARK 350   BIOMT"+n.toString()+"  "+s.toString().padStart(2," ")+" "+l.biomtMatrices[t].elements[i+0].toString().padStart(9," ")+" "+l.biomtMatrices[t].elements[i+4].toString().padStart(9," ")+" "+l.biomtMatrices[t].elements[i+8].toString().padStart(9," ")+" "+l.biomtMatrices[t].elements[i+12].toString().padStart(14," ")+"\n"}}}for(let e in l.chainMissingResidueArray){let t=e.indexOf("_"),s=e.substr(t+1,2),i=e.substr(0,t);for(let t=0,r=l.chainMissingResidueArray[e].length;t<r;++t){let r=l.chainMissingResidueArray[e][t].resi,o=n.utilsCls.residueAbbr2Name(l.chainMissingResidueArray[e][t].name);u[i]+="REMARK 465     "+o.padStart(3," ")+s.padStart(2," ")+" "+r.toString().padStart(5," ")+"\n"}}let C="",g=Object.keys(l.structures).length>1,f=1,b="";for(let d in e){let e=l.atoms[d];if(s&&e.het)continue;e.structure!=b&&(r+=C,C="",f>1&&(r+="\nENDMDL\n"),g&&(r+="MODEL        "+f+"\n"),i||(r+=this.getPDBHeader(f-1,u)),b=e.structure,++f);let c="";c+=e.het?"HETATM":"ATOM  ",c+=d.toString().padStart(5," "),c+=" ";let h=e.name.trim();isNaN(h.substr(0,1))||(h=h.substr(1)+h.substr(0,1)),4==h.length?c+=h:(c+=" ",h=h.replace(/\*/g,"'"),"O1P"==h?h="OP1":"O2P"==h?h="OP2":"C5M"==h&&(h="C7 "),c+=h.padEnd(3," ")),c+=" ";let m=e.resn;if(c+=m.length<=3?m.padStart(3," "):m.substr(0,3),e.chain.length>=2){c+=e.chain.replace(/_/gi,"").substr(0,2)}else 1==e.chain.length?c+=" "+e.chain.substr(0,1):0==e.chain.length&&(c+=" A");let p=e.resi;if(!isNaN(p)&&e.chain.length>3&&!isNaN(e.chain.substr(3))&&(p=p-1+parseInt(e.chain.substr(3))),c+=p.toString().length<=4?p.toString().padStart(4," "):p.toString().substr(0,4),c+=" ".padStart(4," "),c+=e.coord.x.toFixed(3).toString().padStart(8," "),c+=e.coord.y.toFixed(3).toString().padStart(8," "),c+=e.coord.z.toFixed(3).toString().padStart(8," "),t&&e.het||o.hasOwnProperty(d)||a.hasOwnProperty(d)){let t=1.5,s=0;"C"==e.elem?t=1.908:"N"==e.elem?t=1.824:"O"==e.elem?t=1.6612:"H"==e.elem?t=1.25:"S"==e.elem?t=2:"P"==e.elem?t=2.1:n.parasCls.vdwRadii.hasOwnProperty(e.elem)&&(t=n.parasCls.vdwRadii[e.elem]),void 0!==n.cfg.cid&&void 0!==e.crg?s=e.crg:o.hasOwnProperty(d)?s=1.38:a.hasOwnProperty(d)?s=-.595:n.parasCls.ionCharges.hasOwnProperty(e.elem)&&(s=n.parasCls.ionCharges[e.elem]),c+=s.toFixed(4).toString().padStart(8," "),c+=t.toFixed(4).toString().padStart(7," ")}else c+="1.00".padStart(6," "),c+=e.b?parseFloat(e.b).toFixed(2).toString().padStart(6," "):" ".padStart(6," "),c+=" ".padStart(10," "),c+=e.elem.padStart(2," "),c+=" ".padStart(2," ");if(e.het&&e.bonds.length>0){C+="CONECT"+d.toString().padStart(5," ");let t={};for(let s=0,i=e.bonds.length;s<i;++s)e.bonds[s]&&!t.hasOwnProperty(e.bonds[s])&&(C+=e.bonds[s].toString().padStart(5," "),t[e.bonds[s]]=1);C+="\n"}r+=c+"\n"}return r+=C,g&&(r+="\nENDMDL\n"),r}getSecondary(e){let t=this.icn3d,s=t.icn3dui,i='{"data": [\n',l="",n="",r={};for(let i in e){let e=t.atoms[i],o=e.structure+"_"+e.chain,a=e.resi,d=s.utilsCls.residueName2Abbr(e.resn),c=this.secondary2Abbr(e.ss);o!=l&&(r[o]={resi:[],resn:[],secondary:[]}),o==l&&a==n||(r[o].resi.push(a),r[o].resn.push(d),r[o].secondary.push(c)),l=o,n=a}let o=Object.keys(r),a=o.length;for(let e=0;e<a;++e){let t=o[e];i+='{"chain": "'+t+'",\n',i+='"resi": "'+r[t].resi.join(",")+'",\n',i+='"resn": "'+r[t].resn.join("")+'",\n',i+='"secondary": "'+r[t].secondary.join("")+'"',i+=e<a-1?"},\n":"}\n"}return i+="]}\n",i}secondary2Abbr(e){return this.icn3d.icn3dui,"helix"==e?"H":"sheet"==e?"E":"c"}getSelectedResiduePDB(){let e=this.icn3d,t="",s=e.icn3dui.hashUtilsCls.intHash(e.dAtoms,e.hAtoms);return t+=this.getAtomPDB(s),t}getPDBHeader(e,t){let s=this.icn3d;s.icn3dui,void 0===e&&(e=0);let i="",l=Object.keys(s.structures)[e];if(i+="HEADER    PDB From iCn3D".padEnd(62," ")+l+"\n",0==e){let e=s.molTitle.length>50?s.molTitle.substr(0,47)+"...":s.molTitle;-1!=e.indexOf('"')&&(e=""),i+="TITLE     "+e+"\n"}return t&&(i+=t[l]),i}showTitle(){var e=this.icn3d,t=e.icn3dui;if(void 0!==e.molTitle&&""!==e.molTitle){let s=e.molTitle,i="black"==e.opts.background?t.htmlCls.GREYD:"black";if(void 0===e.inputid)e.molTitle.length>40&&(s=e.molTitle.substr(0,40)+"..."),$("#"+e.pre+"title").html(s);else if(void 0!==t.cfg.cid){let t=this.getLinkToStructureSummary();$("#"+e.pre+"title").html("PubChem CID <a id='"+e.pre+"titlelink' href='"+t+"' style='color:"+i+"' target='_blank'>"+e.inputid.toUpperCase()+"</a>: "+s)}else if(void 0!==t.cfg.align)$("#"+e.pre+"title").html(s);else if(void 0!==t.cfg.chainalign){let i=t.cfg.chainalign.split(",");s="Dynamic Structure Alignment of Chain "+i[0]+" to Chain "+i[1],$("#"+e.pre+"title").html(s)}else if(void 0!==t.cfg.mmdbafid){s="Multiple structures: "+t.cfg.mmdbafid.split(","),$("#"+e.pre+"title").html(s)}else{let l=this.getLinkToStructureSummary();e.molTitle.length>40&&(s=e.molTitle.substr(0,40)+"...");let n="",r=t.cfg.afid?"AlphaFold UniProt ID":"PDB ID";$("#"+e.pre+"title").html(r+" <a id='"+e.pre+"titlelink' href='"+l+"' style='color:"+i+"' target='_blank'>"+e.inputid.toUpperCase()+"</a>"+n+": "+s)}}else $("#"+e.pre+"title").html("")}getLinkToStructureSummary(e){var t=this.icn3d,s=t.icn3dui;let i="https://www.ncbi.nlm.nih.gov/structure/?term=";if(i=void 0!==s.cfg.cid?"https://www.ncbi.nlm.nih.gov/pccompound/?term=":Object.keys(t.structures).length>1?"https://www.ncbi.nlm.nih.gov/structure/?term=":s.htmlCls.baseUrl+"pdb/",void 0===t.inputid)i="https://www.ncbi.nlm.nih.gov/pccompound/?term="+t.molTitle;else{let l=t.inputid.split("_");1===l.length?(i+=t.inputid,e&&s.htmlCls.clickMenuCls.setLogCmd("link to Structure Summary "+t.inputid+": "+i,!1)):2===l.length&&(i+=l[0]+" OR "+l[1],e&&s.htmlCls.clickMenuCls.setLogCmd("link to structures "+l[0]+" and "+l[1]+": "+i,!1))}return i}setEntrezLinks(e){var t=this.icn3d,s=t.icn3dui;let i,l=Object.keys(t.structures);1===l.length?(i="https://www.ncbi.nlm.nih.gov/"+e+"/?term="+l[0],s.htmlCls.clickMenuCls.setLogCmd("Entrez "+e+" about PDB "+l[0]+": "+i,!1),window.open(i,"_blank")):2===l.length&&(i="https://www.ncbi.nlm.nih.gov/"+e+"/?term="+l[0]+" OR "+l[1],s.htmlCls.clickMenuCls.setLogCmd("Entrez "+e+" about PDB "+l[0]+" OR "+l[1]+": "+i,!1),window.open(i,"_blank"))}}class Ze{constructor(e){this.icn3dui=e}setAlphaFoldLegend(){let e;return this.icn3dui.icn3d,e="<div>",e+='<span class="icn3d-square" style="background-color: rgb(0, 83, 204);">&nbsp;</span> <span>Very high (pLDDT &gt; 90)</span><br>',e+='<span class="icn3d-square" style="background-color: rgb(101, 203, 243);">&nbsp;</span> <span>Confident (90 &gt; pLDDT &gt; 70)</span><br>',e+='<span class="icn3d-square" style="background-color: rgb(255, 209, 19);">&nbsp;</span> <span>Low (70 &gt; pLDDT &gt; 50)</span><br>',e+='<span class="icn3d-square" style="background-color: rgb(255, 125, 69);">&nbsp;</span> <span>Very low (pLDDT &lt; 50)</span><br>',e+="</div>",'<div><span class="icn3d-square" style="background-color: rgb(0, 83, 204);">&nbsp;</span> <span>Very high (pLDDT &gt; 90)</span><br><span class="icn3d-square" style="background-color: rgb(101, 203, 243);">&nbsp;</span> <span>Confident (90 &gt; pLDDT &gt; 70)</span><br><span class="icn3d-square" style="background-color: rgb(255, 209, 19);">&nbsp;</span> <span>Low (70 &gt; pLDDT &gt; 50)</span><br><span class="icn3d-square" style="background-color: rgb(255, 125, 69);">&nbsp;</span> <span>Very low (pLDDT &lt; 50)</span><br></div>'}setLegendHtml(e){let t=this.icn3dui.icn3d,s="<br>";if(e)s+=this.setAlphaFoldLegend();else{s+="<div style='height: 20px; background: linear-gradient(to right, "+(("red"==t.startColor?"#F00":"green"==t.startColor?"#0F0":"#00F")+" 0%, "+("white"==t.midColor?"#FFF":"#000")+" 50%, "+("red"==t.endColor?"#F00":"green"==t.endColor?"#0F0":"#00F")+" 100%")+");'></div><table width='100%' border='0' cellspacing='0' cellpadding='0'><tr><td width='33%'>"+t.startValue+"</td><td width='33%' align='center'>"+t.midValue+"</td><td width='33%' align='right'>"+t.endValue+"</td></tr></table>"}return s}SetChainsAdvancedMenu(){let e=this.icn3dui,t=e.icn3d;if(void 0===t.bSetChainsAdvancedMenu||!t.bSetChainsAdvancedMenu){let s=e.hashUtilsCls.cloneHash(t.hAtoms);t.definedSetsCls.setPredefinedInMenu(),t.bSetChainsAdvancedMenu=!0,t.hAtoms=e.hashUtilsCls.cloneHash(s)}}setSetsMenus(e){let t=this.icn3dui,s=t.icn3d;this.SetChainsAdvancedMenu();let i=e?"atomsCustomDistTable":"atomsCustomDist",l=e?"atomsCustomDistTable2":"atomsCustomDist2",n=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+t.pre+i).length&&$("#"+t.pre+i).html("  <option value='selected'>selected</option>"+n),$("#"+t.pre+l).length&&$("#"+t.pre+l).html("  <option value='selected' selected>selected</option>"+n),$("#"+t.pre+i).resizable(),$("#"+t.pre+l).resizable()}clickMenu1(){let e=this.icn3dui;if(e.icn3d,e.bNode)return;let t=this;e.myEventCls.onIds("#"+e.pre+"mn1_vastplus","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_vastplus","Please input PDB ID for VAST+")})),e.myEventCls.onIds("#"+e.pre+"mn1_vast","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_vast","Please input chain or PDB file for VAST")})),e.myEventCls.onIds("#"+e.pre+"mn1_foldseek","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_foldseek","Please input AlphaFold Uniprot ID or PDB ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_mmtfid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmtfid","Please input MMTF ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_pdbid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_pdbid","Please input PDB ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_afid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_afid","Please input AlphaFold UniProt ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_opmid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_opmid","Please input OPM PDB ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_align","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_align","Align two PDB structures")})),e.myEventCls.onIds("#"+e.pre+"mn1_alignaf","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_alignaf","Align two AlphaFold structures")})),e.myEventCls.onIds("#"+e.pre+"mn1_chainalign","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_chainalign","Align multiple chains of 3D structures")})),e.myEventCls.onIds("#"+e.pre+"mn1_mutation","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mutation","Show the mutations in 3D")})),e.myEventCls.onIds("#"+e.pre+"mn1_pdbfile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_pdbfile","Please input PDB File")})),e.myEventCls.onIds("#"+e.pre+"mn1_pdbfile_app","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_pdbfile_app","Please append PDB Files")})),e.myEventCls.onIds("#"+e.pre+"mn1_mol2file","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mol2file","Please input Mol2 File")})),e.myEventCls.onIds("#"+e.pre+"mn1_sdffile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_sdffile","Please input SDF File")})),e.myEventCls.onIds("#"+e.pre+"mn1_xyzfile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_xyzfile","Please input XYZ File")})),e.myEventCls.onIds("#"+e.pre+"mn1_afmapfile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_afmapfile","Please input AlphaFold PAE File")})),e.myEventCls.onIds("#"+e.pre+"mn1_urlfile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_urlfile","Load data by URL")})),e.myEventCls.onIds("#"+e.pre+"mn1_fixedversion","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_fixedversion","Open Share Link URL in the archived version of iCn3D")})),e.myEventCls.onIds("#"+e.pre+"reload_fixedversion","click",(function(s){e.icn3d;let i=$("#"+e.pre+"sharelinkurl").val();t.setLogCmd("open "+i,!1),localStorage.setItem("fixedversion","1"),window.open(i,"_blank")})),e.myEventCls.onIds("#"+e.pre+"mn1_mmciffile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmciffile","Please input mmCIF File")})),e.myEventCls.onIds("#"+e.pre+"mn1_mmcifid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmcifid","Please input mmCIF ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_mmdbid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmdbid","Please input MMDB or PDB ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_mmdbafid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmdbafid","Please input MMDB, PDB, or AlphaFold UniProt IDs")})),e.myEventCls.onIds("#"+e.pre+"mn1_blast_rep_id","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_blast_rep_id","Align sequence to structure")})),e.myEventCls.onIds("#"+e.pre+"mn1_gi","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_gi","Please input protein gi")})),e.myEventCls.onIds("#"+e.pre+"mn1_uniprotid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_uniprotid","Please input UniProt ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_cid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_cid","Please input PubChem CID")})),e.myEventCls.onIds("#"+e.pre+"mn1_pngimage","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_pngimage","Please input the PNG image")})),e.myEventCls.onIds("#"+e.pre+"mn1_state","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_state","Please input the state file")})),e.myEventCls.onIds("#"+e.pre+"mn1_selection","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_selection","Please input the selection file")})),e.myEventCls.onIds("#"+e.pre+"mn1_dsn6","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_dsn6","Please input the DSN6 file to display electron density map")})),e.myEventCls.onIds(["#"+e.pre+"mn1_delphi","#"+e.pre+"mn1_delphi2"],"click",(function(t){e.icn3d.loadPhiFrom="delphi",$("#"+e.pre+"dl_delphi_tabs").tabs(),e.htmlCls.dialogCls.openDlg("dl_delphi","Please set parameters to display DelPhi potential map")})),e.myEventCls.onIds("#"+e.pre+"mn1_phi","click",(function(t){e.icn3d.loadPhiFrom="phi",$("#"+e.pre+"dl_phi_tabs").tabs(),$("#"+e.pre+"phitab1_tabs").tabs(),$("#"+e.pre+"phitab2_tabs").tabs(),e.htmlCls.dialogCls.openDlg("dl_phi","Please input local phi or cube file to display DelPhi potential map")})),e.myEventCls.onIds("#"+e.pre+"mn1_phiurl","click",(function(t){e.icn3d.loadPhiFrom="phiurl",$("#"+e.pre+"dl_phiurl_tabs").tabs(),$("#"+e.pre+"phiurltab1_tabs").tabs(),$("#"+e.pre+"phiurltab2_tabs").tabs(),e.htmlCls.dialogCls.openDlg("dl_phiurl","Please input URL phi or cube file to display DelPhi potential map")})),e.myEventCls.onIds("#"+e.pre+"mn1_dsn6url","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_dsn6url","Please input the DSN6 file to display electron density map")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportState","click",(function(s){let i=e.icn3d;t.setLogCmd("export state file",!1);let l=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(l+"_statefile.txt","command")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportPdbRes","click",(function(s){e.icn3d,e.htmlCls.setHtmlCls.exportPdb(),t.setLogCmd("export pdb",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportSecondary","click",(function(s){e.icn3d,e.htmlCls.setHtmlCls.exportSecondary(),t.setLogCmd("export secondary structure",!0)})),e.myEventCls.onIds(["#"+e.pre+"delphipdb","#"+e.pre+"phipdb"],"click",(function(s){let i=e.icn3d,l=i.saveFileCls.getSelectedResiduePDB();t.setLogCmd("export PDB of selected residues",!1);let n=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(n+"_icn3d_residues.pdb","text",[l])})),e.myEventCls.onIds(["#"+e.pre+"delphipqr","#"+e.pre+"phipqr","#"+e.pre+"phiurlpqr"],"click",(function(s){e.icn3d,e.htmlCls.setHtmlCls.exportPqr(),t.setLogCmd("export pqr",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportStl","click",(function(s){let i=e.icn3d;t.setLogCmd("export stl file",!1),i.export3DCls.exportStlFile("")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportVrml","click",(function(s){let i=e.icn3d;t.setLogCmd("export vrml file",!1),i.export3DCls.exportVrmlFile("")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportStlStab","click",(function(s){let i=e.icn3d;t.setLogCmd("export stl stabilizer file",!1),i.threeDPrintCls.hideStabilizer(),i.threeDPrintCls.resetAfter3Dprint(),i.threeDPrintCls.addStabilizer(),i.export3DCls.exportStlFile("_stab")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportVrmlStab","click",(function(s){let i=e.icn3d;t.setLogCmd("export vrml stabilizer file",!1),i.threeDPrintCls.hideStabilizer(),i.threeDPrintCls.resetAfter3Dprint(),i.threeDPrintCls.addStabilizer(),i.export3DCls.exportVrmlFile("_stab")})),e.myEventCls.onIds("#"+e.pre+"mn6_exportInteraction","click",(function(s){let i=e.icn3d;t.setLogCmd("export interactions",!1),void 0!==e.cfg.mmdbid&&i.viewInterPairsCls.retrieveInteractionData(),i.viewInterPairsCls.exportInteractions()})),e.myEventCls.onIds(["#"+e.pre+"mn1_exportCanvas","#"+e.pre+"saveimage"],"click",(function(s){let i=e.icn3d;t.setLogCmd("export canvas",!1);i.shareLinkCls.shareLink(!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCanvas1","click",(function(s){let i=e.icn3d;t.setLogCmd("export canvas 1",!0),i.scaleFactor=1,i.shareLinkCls.shareLink(!0,!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCanvas2","click",(function(s){let i=e.icn3d;t.setLogCmd("export canvas 2",!0),i.scaleFactor=2,i.shareLinkCls.shareLink(!0,!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCanvas4","click",(function(s){let i=e.icn3d;t.setLogCmd("export canvas 4",!0),i.scaleFactor=4,i.shareLinkCls.shareLink(!0,!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCanvas8","click",(function(s){let i=e.icn3d;t.setLogCmd("export canvas 8",!0),i.scaleFactor=8,i.shareLinkCls.shareLink(!0,!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCounts","click",(function(s){let i=e.icn3d;t.setLogCmd("export counts",!1);let l='<html><body><div style="text-align:center"><br><b>Total Count for atoms with coordinates</b>:<br/><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Structure Count</th><th>Chain Count</th><th>Residue Count</th><th>Atom Count</th></tr>';l+="<tr><td>"+Object.keys(i.structures).length+"</td><td>"+Object.keys(i.chains).length+"</td><td>"+Object.keys(i.residues).length+"</td><td>"+Object.keys(i.atoms).length+"</td></tr>",l+="</table><br/>",l+="<b>Counts by Chain for atoms with coordinates</b>:<br/><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Structure</th><th>Chain</th><th>Residue Count</th><th>Atom Count</th></tr>";let n=Object.keys(i.chains);for(let e=0,t=n.length;e<t;++e){let t=n[e],s=t.indexOf("_"),r=t.substr(0,s),o=t.substr(s+1),a={},d=i.chains[t];for(let e in d)a[i.atoms[e].resi]=1;l+="<tr><td>"+r+"</td><td>"+o+"</td><td>"+Object.keys(a).length+"</td><td>"+Object.keys(i.chains[t]).length+"</td></tr>"}l+="</table><br/></div></body></html>";let r=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(r+"_counts.html","html",l)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportSelections","click",(function(s){let i=e.icn3d;t.setLogCmd("export all selections",!1),t.SetChainsAdvancedMenu();let l=i.saveFileCls.exportCustomAtoms(),n=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(n+"_selections.txt","text",[l])})),e.myEventCls.onIds("#"+e.pre+"mn1_exportSelDetails","click",(function(s){let i=e.icn3d;t.setLogCmd("export all selections with details",!1),t.SetChainsAdvancedMenu();let l=i.saveFileCls.exportCustomAtoms(!0),n=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(n+"_sel_details.txt","text",[l])})),e.myEventCls.onIds("#"+e.pre+"mn1_sharelink","click",(function(t){e.icn3d.shareLinkCls.shareLink()})),e.myEventCls.onIds("#"+e.pre+"mn1_replayon","click",(function(s){e.icn3d.resizeCanvasCls.replayon(),t.setLogCmd("replay on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_replayoff","click",(function(s){e.icn3d.resizeCanvasCls.replayoff(),t.setLogCmd("replay off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_link_structure","click",(function(t){let s=e.icn3d.saveFileCls.getLinkToStructureSummary(!0);window.open(s,"_blank")})),e.myEventCls.onIds("#"+e.pre+"mn1_link_bind","click",(function(s){let i=e.icn3d;url="https://www.ncbi.nlm.nih.gov/pccompound?LinkName=pccompound_structure&from_uid="+i.inputid,t.setLogCmd("link to 3D protein structures bound to CID "+i.inputid+": "+url,!1),window.open(url,"_blank")})),e.myEventCls.onIds("#"+e.pre+"mn1_link_vast","click",(function(s){let i=e.icn3d;if(void 0===i.inputid)url="https://www.ncbi.nlm.nih.gov/pccompound?term="+i.molTitle,t.setLogCmd("link to compounds "+i.molTitle+": "+url,!1);else{let s;if(void 0!==e.cfg.cid)s="https://www.ncbi.nlm.nih.gov/pccompound?LinkName=pccompound_pccompound_3d&from_uid="+i.inputid,t.setLogCmd("link to compounds with structure similar to CID "+i.inputid+": "+s,!1);else{let l=i.inputid.split("_");1===l.length?(s=e.htmlCls.baseUrl+"vastplus/vastplus.cgi?uid="+i.inputid,t.setLogCmd("link to structures similar to "+i.inputid+": "+s,!1)):2===l.length&&(s=e.htmlCls.baseUrl+"vastplus/vastplus.cgi?uid="+l[0],t.setLogCmd("link to structures similar to "+l[0]+": "+s,!1))}window.open(s,"_blank")}})),e.myEventCls.onIds("#"+e.pre+"mn1_link_pubmed","click",(function(s){let i=e.icn3d;if(void 0===i.inputid){let e;e="https://www.ncbi.nlm.nih.gov/pubmed/?term="+i.molTitle,t.setLogCmd("link to literature about "+i.molTitle+": "+e,!1),window.open(e,"_blank")}else if(i.pmid){let e,s=i.pmid.toString().split("_");1===s.length?(e="https://www.ncbi.nlm.nih.gov/pubmed/"+i.pmid,t.setLogCmd("link to PubMed ID "+i.pmid+": "+e,!1)):2===s.length&&(e="https://www.ncbi.nlm.nih.gov/pubmed/?term="+s[0]+" OR "+s[1],t.setLogCmd("link to PubMed IDs "+s[0]+", "+s[1]+": "+e,!1)),window.open(e,"_blank")}else if(isNaN(i.inputid)){let e,s=i.inputid.toString().split("_");1===s.length?(e="https://www.ncbi.nlm.nih.gov/pubmed/?term="+i.inputid,t.setLogCmd("link to literature about PDB "+i.inputid+": "+e,!1)):2===s.length&&(e="https://www.ncbi.nlm.nih.gov/pubmed/?term="+s[0]+" OR "+s[1],t.setLogCmd("link to literature about PDB "+s[0]+" OR "+s[1]+": "+e,!1)),window.open(e,"_blank")}else void 0!==e.cfg.cid?alert("No literature information is available for this compound in the SDF file."):alert("No literature information is available for this structure.")})),e.myEventCls.onIds("#"+e.pre+"mn1_link_protein","click",(function(s){let i=e.icn3d,l=Object.keys(i.structures),n=Object.keys(i.chains),r="";for(let e=0,t=n.length;e<t;++e){let t=i.firstAtomObjCls.getFirstCalphaAtomObj(i.chains[n[e]]);i.proteins.hasOwnProperty(t.serial)&&6==n[e].length&&(r+=n[e]+"[accession] OR ")}r.length>0&&(r=r.substr(0,r.length-4));let o="https://www.ncbi.nlm.nih.gov/protein/?term="+r;t.setLogCmd("link to Entrez protein about PDB "+l+": "+o,!1),window.open(o,"_blank")}))}clickMenu2(){let e=this.icn3dui;if(e.icn3d,e.bNode)return;let t=this;e.myEventCls.onIds("#"+e.pre+"mn6_selectannotations","click",(function(s){e.icn3d.showAnnoCls.showAnnotations(),t.setLogCmd("view annotations",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_selectall","click",(function(s){let i=e.icn3d;t.setLogCmd("select all",!0),i.selectionCls.selectAll(),i.hlUpdateCls.removeHlAll(),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"clearall","click",(function(s){let i=e.icn3d;t.setLogCmd("clear all",!0),i.bSelectResidue=!1,i.selectionCls.selectAll(),i.hlUpdateCls.removeHlAll(),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn2_selectdisplayed","click",(function(s){let i=e.icn3d;t.setLogCmd("select displayed set",!0),i.hAtoms=e.hashUtilsCls.cloneHash(i.viewSelectionAtoms),i.hlUpdateCls.updateHlAll()})),e.myEventCls.onIds("#"+e.pre+"mn2_fullstru","click",(function(s){let i=e.icn3d;t.setLogCmd("show all",!0),i.selectionCls.showAll()})),e.myEventCls.onIds("#"+e.pre+"mn2_selectcomplement","click",(function(s){let i=e.icn3d;Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&(t.setLogCmd("select complement",!0),i.resid2specCls.selectComplement())})),e.myEventCls.onIds("#"+e.pre+"mn2_selectmainchains","click",(function(s){let i=e.icn3d;t.setLogCmd("select main chains",!0),i.selectionCls.selectMainChains()})),e.myEventCls.onIds("#"+e.pre+"mn2_selectsidechains","click",(function(s){let i=e.icn3d;t.setLogCmd("select side chains",!0),i.selectionCls.selectSideChains()})),e.myEventCls.onIds("#"+e.pre+"mn2_selectmainsidechains","click",(function(s){let i=e.icn3d;t.setLogCmd("select main side chains",!0),i.selectionCls.selectMainSideChains()})),e.myEventCls.onIds("#"+e.pre+"mn2_propPos","click",(function(s){let i=e.icn3d;t.setLogCmd("select prop positive",!0),i.resid2specCls.selectProperty("positive")})),e.myEventCls.onIds("#"+e.pre+"mn2_propNeg","click",(function(s){let i=e.icn3d;t.setLogCmd("select prop negative",!0),i.resid2specCls.selectProperty("negative")})),e.myEventCls.onIds("#"+e.pre+"mn2_propHydro","click",(function(s){let i=e.icn3d;t.setLogCmd("select prop hydrophobic",!0),i.resid2specCls.selectProperty("hydrophobic")})),e.myEventCls.onIds("#"+e.pre+"mn2_propPolar","click",(function(s){let i=e.icn3d;t.setLogCmd("select prop polar",!0),i.resid2specCls.selectProperty("polar")})),e.myEventCls.onIds("#"+e.pre+"mn2_propBfactor","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_propbybfactor","Select residue based on B-factor")})),e.myEventCls.onIds("#"+e.pre+"mn2_propSolAcc","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_propbypercentout","Select residue based on the percentage of solvent accessilbe surface area")})),e.myEventCls.onIds("#"+e.pre+"applypropbybfactor","click",(function(s){let i=e.icn3d,l=$("#"+e.pre+"minbfactor").val(),n=$("#"+e.pre+"maxbfactor").val();t.setLogCmd("select prop b factor | "+l+"_"+n,!0),i.resid2specCls.selectProperty("b factor",l,n)})),e.myEventCls.onIds("#"+e.pre+"applypropbypercentout","click",(function(s){let i=e.icn3d,l=$("#"+e.pre+"minpercentout").val(),n=$("#"+e.pre+"maxpercentout").val();t.setLogCmd("select prop percent out | "+l+"_"+n,!0),i.resid2specCls.selectProperty("percent out",l,n)})),e.myEventCls.onIds("#"+e.pre+"mn2_alignment","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),t.setLogCmd("window aligned sequences",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_window_table","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_allinteraction","Show interactions"),t.setLogCmd("window interaction table",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_window_linegraph","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_linegraph","Show interactions between two lines of residue nodes"),t.setLogCmd("window interaction graph",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_window_scatterplot","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_scatterplot","Show interactions as map"),t.setLogCmd("window interaction scatterplot",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_window_graph","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_graph","Force-directed graph"),t.setLogCmd("window force-directed graph",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_yournote","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_yournote","Your note about the current display")})),e.myEventCls.onIds("#"+e.pre+"applyyournote","click",(function(s){let i=e.icn3d;i.yournote=$("#"+e.pre+"yournote").val(),e.cfg.shownote&&(document.title=i.yournote),e.cfg.notebook||dialog.dialog("close"),t.setLogCmd("your note | "+i.yournote,!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_command","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_advanced2","Select by specification")})),e.myEventCls.onIds(["#"+e.pre+"mn2_definedsets","#"+e.pre+"definedsets","#"+e.pre+"definedsets2"],"click",(function(s){e.icn3d.definedSetsCls.showSets(),t.setLogCmd("defined sets",!0)})),e.myEventCls.onIds("#"+e.pre+"setOr","click",(function(t){e.icn3d.setOperation="or"})),e.myEventCls.onIds("#"+e.pre+"setAnd","click",(function(t){e.icn3d.setOperation="and"})),e.myEventCls.onIds("#"+e.pre+"setNot","click",(function(t){e.icn3d.setOperation="not"})),e.myEventCls.onIds("#"+e.pre+"mn2_pkNo","click",(function(s){let i=e.icn3d;i.pk=0,i.opts.pk="no",t.setLogCmd("set pk off",!0),i.drawCls.draw(),i.hlObjectsCls.removeHlObjects()})),e.myEventCls.onIds("#"+e.pre+"mn2_pkYes","click",(function(s){let i=e.icn3d;i.pk=1,i.opts.pk="atom",t.setLogCmd("set pk atom",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_pkResidue","click",(function(s){let i=e.icn3d;i.pk=2,i.opts.pk="residue",t.setLogCmd("set pk residue",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_pkStrand","click",(function(s){let i=e.icn3d;i.pk=3,i.opts.pk="strand",t.setLogCmd("set pk strand",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_pkDomain","click",(function(s){let i=e.icn3d;i.pk=4,i.opts.pk="domain",t.setLogCmd("set pk domain",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_pkChain","click",(function(s){let i=e.icn3d;i.pk=5,i.opts.pk="chain",t.setLogCmd("set pk chain",!0)})),e.myEventCls.onIds("#"+e.pre+"adjustmem","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_adjustmem","Adjust the Z-axis positions of the membrane")})),e.myEventCls.onIds("#"+e.pre+"togglemem","click",(function(s){e.icn3d.selectionCls.toggleMembrane(),t.setLogCmd("toggle membrane",!0)})),e.myEventCls.onIds("#"+e.pre+"selectplane","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_selectplane","Select a region between two planes")})),e.myEventCls.onIds("#"+e.pre+"mn2_aroundsphere","click",(function(s){let i=e.icn3d;t.SetChainsAdvancedMenu();let l=i.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomSphere").length&&$("#"+e.pre+"atomsCustomSphere").html("  <option value='non-selected' selected>non-selected</option><option value='selected'>selected</option>"+l),$("#"+e.pre+"atomsCustomSphere2").length&&$("#"+e.pre+"atomsCustomSphere2").html("  <option value='selected' selected>selected</option>"+l),e.htmlCls.dialogCls.openDlg("dl_aroundsphere","Select a sphere around a set of residues"),i.bSphereCalc=!1,$("#"+e.pre+"atomsCustomSphere").resizable(),$("#"+e.pre+"atomsCustomSphere2").resizable()})),e.myEventCls.onIds(["#"+e.pre+"mn2_select_chain","#"+e.pre+"definedSets"],"click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_select_chain","Select Structure/Chain/Custom Selection")}))}clickMenu3(){let e=this.icn3dui;if(e.icn3d,e.bNode)return;let t=this;e.myEventCls.onIds("#"+e.pre+"mn3_proteinsRibbon","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","ribbon"),t.setLogCmd("style proteins ribbon",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsStrand","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","strand"),t.setLogCmd("style proteins strand",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsCylinder","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","cylinder and plate"),t.setLogCmd("style proteins cylinder and plate",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsSchematic","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","schematic"),t.setLogCmd("style proteins schematic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsCalpha","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","c alpha trace"),t.setLogCmd("style proteins c alpha trace",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsBackbone","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","backbone"),t.setLogCmd("style proteins backbone",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsBfactor","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","b factor tube"),t.setLogCmd("style proteins b factor tube",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsLines","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","lines"),t.setLogCmd("style proteins lines",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsStick","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","stick"),t.setLogCmd("style proteins stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","ball and stick"),t.setLogCmd("style proteins ball and stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","sphere"),t.setLogCmd("style proteins sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsNo","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","nothing"),t.setLogCmd("style proteins nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecLines","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","lines2"),t.setLogCmd("style sidec lines2",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecStick","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","stick2"),t.setLogCmd("style sidec stick2",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","ball and stick2"),t.setLogCmd("style sidec ball and stick2",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","sphere2"),t.setLogCmd("style sidec sphere2",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecNo","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","nothing"),t.setLogCmd("style sidec nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ntbaseLines","click",(function(s){e.icn3d.setOptionCls.setStyle("ntbase","lines2"),t.setLogCmd("style ntbase lines2",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ntbaseStick","click",(function(s){e.icn3d.setOptionCls.setStyle("ntbase","stick2"),t.setLogCmd("style ntbase stick2",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ntbaseBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("ntbase","ball and stick2"),t.setLogCmd("style ntbase ball and stick2",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ntbaseSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("ntbase","sphere2"),t.setLogCmd("style ntbase sphere2",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ntbaseNo","click",(function(s){e.icn3d.setOptionCls.setStyle("ntbase","nothing"),t.setLogCmd("style ntbase nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclCartoon","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","nucleotide cartoon"),t.setLogCmd("style nucleotides nucleotide cartoon",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclBackbone","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","backbone"),t.setLogCmd("style nucleotides backbone",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclSchematic","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","schematic"),t.setLogCmd("style nucleotides schematic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclPhos","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","o3 trace"),t.setLogCmd("style nucleotides o3 trace",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclLines","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","lines"),t.setLogCmd("style nucleotides lines",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclStick","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","stick"),t.setLogCmd("style nucleotides stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","ball and stick"),t.setLogCmd("style nucleotides ball and stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","sphere"),t.setLogCmd("style nucleotides sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclNo","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","nothing"),t.setLogCmd("style nucleotides nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligLines","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","lines"),t.setLogCmd("style chemicals lines",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligStick","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","stick"),t.setLogCmd("style chemicals stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","ball and stick"),t.setLogCmd("style chemicals ball and stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligSchematic","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","schematic"),t.setLogCmd("style chemicals schematic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","sphere"),t.setLogCmd("style chemicals sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligNo","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","nothing"),t.setLogCmd("style chemicals nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_glycansCartYes","click",(function(s){let i=e.icn3d;i.bGlycansCartoon=!0,i.drawCls.draw(),t.setLogCmd("glycans cartoon yes",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_glycansCartNo","click",(function(s){let i=e.icn3d;i.bGlycansCartoon=!1,i.drawCls.draw(),t.setLogCmd("glycans cartoon no",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_hydrogensYes","click",(function(s){let i=e.icn3d;i.showInterCls.showHydrogens(),i.drawCls.draw(),t.setLogCmd("hydrogens",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_hydrogensNo","click",(function(s){let i=e.icn3d;i.showInterCls.hideHydrogens(),i.drawCls.draw(),t.setLogCmd("set hydrogens off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ionsSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("ions","sphere"),t.setLogCmd("style ions sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ionsDot","click",(function(s){e.icn3d.setOptionCls.setStyle("ions","dot"),t.setLogCmd("style ions dot",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ionsNo","click",(function(s){e.icn3d.setOptionCls.setStyle("ions","nothing"),t.setLogCmd("style ions nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_waterSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("water","sphere"),t.setLogCmd("style water sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_waterDot","click",(function(s){e.icn3d.setOptionCls.setStyle("water","dot"),t.setLogCmd("style water dot",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_waterNo","click",(function(s){e.icn3d.setOptionCls.setStyle("water","nothing"),t.setLogCmd("style water nothing",!0)}))}clickMenu4(){let e=this.icn3dui;if(e.icn3d,e.bNode)return;let t=this;e.myEventCls.onIds("#"+e.pre+"mn4_clrSpectrum","click",(function(s){e.icn3d.setOptionCls.setOption("color","spectrum"),t.setLogCmd("color spectrum",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSpectrumChain","click",(function(s){e.icn3d.setOptionCls.setOption("color","spectrum for chains"),t.setLogCmd("color spectrum for chains",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSpectrumSets","click",(function(t){let s=e.icn3d;if(void 0===s.bSetChainsAdvancedMenu||!s.bSetChainsAdvancedMenu){let t=e.hashUtilsCls.cloneHash(s.hAtoms);s.definedSetsCls.setPredefinedInMenu(),s.bSetChainsAdvancedMenu=!0,s.hAtoms=e.hashUtilsCls.cloneHash(t)}let i=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomColorSpectrum").length&&$("#"+e.pre+"atomsCustomColorSpectrum").html(i),s.bRender&&e.htmlCls.dialogCls.openDlg("dl_colorspectrumbysets","Please select sets to apply spectrum color"),$("#"+e.pre+"atomsCustomColorSpectrum").resizable()})),e.myEventCls.onIds("#"+e.pre+"mn4_clrRainbowSets","click",(function(t){let s=e.icn3d;if(void 0===s.bSetChainsAdvancedMenu||!s.bSetChainsAdvancedMenu){let t=e.hashUtilsCls.cloneHash(s.hAtoms);s.definedSetsCls.setPredefinedInMenu(),s.bSetChainsAdvancedMenu=!0,s.hAtoms=e.hashUtilsCls.cloneHash(t)}let i=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomColorRainbow").length&&$("#"+e.pre+"atomsCustomColorRainbow").html(i),s.bRender&&e.htmlCls.dialogCls.openDlg("dl_colorrainbowbysets","Please select sets to apply rainbow color"),$("#"+e.pre+"atomsCustomColorRainbow").resizable()})),e.myEventCls.onIds("#"+e.pre+"mn4_clrRainbow","click",(function(s){e.icn3d.setOptionCls.setOption("color","rainbow"),t.setLogCmd("color rainbow",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrRainbowChain","click",(function(s){e.icn3d.setOptionCls.setOption("color","rainbow for chains"),t.setLogCmd("color rainbow for chains",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrChain","click",(function(s){e.icn3d.setOptionCls.setOption("color","chain"),t.setLogCmd("color chain",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrStructure","click",(function(s){e.icn3d.setOptionCls.setOption("color","structure"),t.setLogCmd("color structure",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrdomain","click",(function(s){e.icn3d.setOptionCls.setOption("color","domain"),t.setLogCmd("color domain",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrsets","click",(function(s){e.icn3d.setOptionCls.setOption("color","defined sets"),t.setLogCmd("color defined sets",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSSGreen","click",(function(s){let i=e.icn3d;i.sheetcolor="green",i.setOptionCls.setOption("color","secondary structure green"),t.setLogCmd("color secondary structure green",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSSYellow","click",(function(s){let i=e.icn3d;i.sheetcolor="yellow",i.setOptionCls.setOption("color","secondary structure yellow"),t.setLogCmd("color secondary structure yellow",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSSSpectrum","click",(function(s){e.icn3d.setOptionCls.setOption("color","secondary structure spectrum"),t.setLogCmd("color secondary structure spectrum",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrResidue","click",(function(s){e.icn3d.setOptionCls.setOption("color","residue"),t.setLogCmd("color residue",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrResidueCustom","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_rescolorfile","Please input the file on residue colors")})),e.myEventCls.onIds("#"+e.pre+"reload_rescolorfile","click",(function(s){let i=e.icn3d;s.preventDefault(),e.cfg.notebook||dialog.dialog("close");let l=$("#"+e.pre+"rescolorfile")[0].files[0];if(l){e.htmlCls.setHtmlCls.fileSupport();let s=new FileReader;s.onload=function(s){let l=s.target.result.replace(/#/g,"");i.customResidueColors=JSON.parse(l);for(let t in i.customResidueColors)i.customResidueColors[t.toUpperCase()]=e.parasCls.thr("#"+i.customResidueColors[t]);i.setOptionCls.setOption("color","residue custom"),t.setLogCmd("color residue custom | "+l,!0)},s.readAsText(l)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_customcolorfile","click",(function(s){let i=e.icn3d;s.preventDefault(),e.cfg.notebook||dialog.dialog("close"),i.startColor=$("#"+e.pre+"startColor").val(),i.midColor=$("#"+e.pre+"midColor").val(),i.endColor=$("#"+e.pre+"endColor").val();let l=t.setLegendHtml();$("#"+e.pre+"dl_legend").html(l),e.htmlCls.dialogCls.openDlg("dl_legend","Color range"),i.addTrackCls.setCustomFile("color",i.startColor,i.midColor,i.endColor)})),e.myEventCls.onIds("#"+e.pre+"remove_legend","click",(function(s){e.icn3d,s.preventDefault(),$("#"+e.pre+"legend").hide(),t.setLogCmd("remove legend",!0)})),e.myEventCls.onIds("#"+e.pre+"reload_customtubefile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.addTrackCls.setCustomFile("tube")})),e.myEventCls.onIds("#"+e.pre+"mn4_clrCharge","click",(function(s){e.icn3d.setOptionCls.setOption("color","charge"),t.setLogCmd("color charge",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrHydrophobic","click",(function(s){e.icn3d.setOptionCls.setOption("color","hydrophobic"),t.setLogCmd("color hydrophobic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrNormalizedHP","click",(function(s){e.icn3d.setOptionCls.setOption("color","normalized hydrophobic"),t.setLogCmd("color normalized hydrophobic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrAtom","click",(function(s){e.icn3d.setOptionCls.setOption("color","atom"),t.setLogCmd("color atom",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrBfactor","click",(function(s){e.icn3d.setOptionCls.setOption("color","b factor"),t.setLogCmd("color b factor",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrConfidence","click",(function(s){e.icn3d.setOptionCls.setOption("color","confidence"),t.setLogCmd("color confidence",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrArea","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_colorbyarea","Color based on residue's solvent accessibility")})),e.myEventCls.onIds("#"+e.pre+"applycolorbyarea","click",(function(s){let i=e.icn3d;i.midpercent=$("#"+e.pre+"midpercent").val(),i.setOptionCls.setOption("color","area"),t.setLogCmd("color area | "+i.midpercent,!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrBfactorNorm","click",(function(s){e.icn3d.setOptionCls.setOption("color","b factor percentile"),t.setLogCmd("color b factor percentile",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrIdentity","click",(function(s){e.icn3d.setOptionCls.setOption("color","identity"),t.setLogCmd("color identity",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrConserved","click",(function(s){e.icn3d.setOptionCls.setOption("color","conservation"),t.setLogCmd("color conservation",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrCustom","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_clr","Color picker")})),$(document).on("click",".icn3d-color-rad-text",(function(s){let i=e.icn3d;s.stopImmediatePropagation();let l=$(this).attr("color");i.setOptionCls.setOption("color",l),t.setLogCmd("color "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSave","click",(function(s){e.icn3d.setOptionCls.saveColor(),t.setLogCmd("save color",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrApplySave","click",(function(s){e.icn3d.setOptionCls.applySavedColor(),t.setLogCmd("apply saved color",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_styleSave","click",(function(s){e.icn3d.setOptionCls.saveStyle(),t.setLogCmd("save style",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_styleApplySave","click",(function(s){e.icn3d.setOptionCls.applySavedStyle(),t.setLogCmd("apply saved style",!0)}))}clickMenu5(){let e=this.icn3dui;if(e.icn3d,e.bNode)return;let t=this;e.myEventCls.onIds("#"+e.pre+"mn5_neighborsYes","click",(function(s){let i=e.icn3d;i.bConsiderNeighbors=!0,i.applyMapCls.removeLastSurface(),i.applyMapCls.applySurfaceOptions(),i.bRender&&i.drawCls.render(),t.setLogCmd("set surface neighbors on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_neighborsNo","click",(function(s){let i=e.icn3d;i.bConsiderNeighbors=!1,i.applyMapCls.removeLastSurface(),i.applyMapCls.applySurfaceOptions(),i.bRender&&i.drawCls.render(),t.setLogCmd("set surface neighbors off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceVDW","click",(function(s){let i=e.icn3d;i.bConsiderNeighbors=!1,i.setOptionCls.setOption("surface","Van der Waals surface"),t.setLogCmd("set surface Van der Waals surface",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceSAS","click",(function(s){let i=e.icn3d;i.bConsiderNeighbors=!1,i.setOptionCls.setOption("surface","solvent accessible surface"),t.setLogCmd("set surface solvent accessible surface",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceMolecular","click",(function(s){let i=e.icn3d;i.bConsiderNeighbors=!1,i.setOptionCls.setOption("surface","molecular surface"),t.setLogCmd("set surface molecular surface",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceVDWContext","click",(function(s){let i=e.icn3d;i.bConsiderNeighbors=!0,i.setOptionCls.setOption("surface","Van der Waals surface with context"),t.setLogCmd("set surface Van der Waals surface with context",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceSASContext","click",(function(s){let i=e.icn3d;i.bConsiderNeighbors=!0,i.setOptionCls.setOption("surface","solvent accessible surface with context"),t.setLogCmd("set surface solvent accessible surface with context",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceMolecularContext","click",(function(s){let i=e.icn3d;i.bConsiderNeighbors=!0,i.setOptionCls.setOption("surface","molecular surface with context"),t.setLogCmd("set surface molecular surface with context",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceNo","click",(function(s){e.icn3d.setOptionCls.setOption("surface","nothing"),t.setLogCmd("set surface nothing",!0)})),$(document).on("click","."+e.pre+"mn5_opacity",(function(s){let i=e.icn3d,l=$(this).attr("v");i.setOptionCls.setOption("opacity",l),t.setLogCmd("set surface opacity "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_wireframeYes","click",(function(s){e.icn3d.setOptionCls.setOption("wireframe","yes"),t.setLogCmd("set surface wireframe on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_wireframeNo","click",(function(s){e.icn3d.setOptionCls.setOption("wireframe","no"),t.setLogCmd("set surface wireframe off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_elecmap2fofc","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_elecmap2fofc","2Fo-Fc Electron Density Map")})),e.myEventCls.onIds("#"+e.pre+"mn5_elecmapfofc","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_elecmapfofc","Fo-Fc Electron Density Map")})),e.myEventCls.onIds(["#"+e.pre+"mn5_elecmapNo","#"+e.pre+"elecmapNo2","#"+e.pre+"elecmapNo3","#"+e.pre+"elecmapNo4","#"+e.pre+"elecmapNo5"],"click",(function(s){e.icn3d.setOptionCls.setOption("map","nothing"),t.setLogCmd("setoption map nothing",!0)})),e.myEventCls.onIds(["#"+e.pre+"delphimapNo","#"+e.pre+"phimapNo","#"+e.pre+"phiurlmapNo","#"+e.pre+"mn1_phimapNo"],"click",(function(s){e.icn3d.setOptionCls.setOption("phimap","nothing"),t.setLogCmd("setoption phimap nothing",!0)})),e.myEventCls.onIds(["#"+e.pre+"delphimapNo2","#"+e.pre+"phimapNo2","#"+e.pre+"phiurlmapNo2"],"click",(function(s){e.icn3d.setOptionCls.setOption("phisurface","nothing"),t.setLogCmd("setoption phisurface nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"applymap2fofc","click",(function(s){let i=e.icn3d;s.preventDefault();let l=parseFloat($("#"+e.pre+"sigma2fofc").val());i.dsn6ParserCls.dsn6Parser(i.inputid,"2fofc",l),t.setLogCmd("set map 2fofc sigma "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"applymapfofc","click",(function(s){let i=e.icn3d;s.preventDefault();let l=parseFloat($("#"+e.pre+"sigmafofc").val());i.dsn6ParserCls.dsn6Parser(i.inputid,"fofc",l),t.setLogCmd("set map fofc sigma "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_mapwireframeYes","click",(function(s){e.icn3d.setOptionCls.setOption("mapwireframe","yes"),t.setLogCmd("set map wireframe on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_mapwireframeNo","click",(function(s){e.icn3d.setOptionCls.setOption("mapwireframe","no"),t.setLogCmd("set map wireframe off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_emmap","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_emmap","EM Density Map")})),e.myEventCls.onIds(["#"+e.pre+"mn5_emmapNo","#"+e.pre+"emmapNo2"],"click",(function(s){e.icn3d.setOptionCls.setOption("emmap","nothing"),t.setLogCmd("setoption emmap nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"applyemmap","click",(function(s){let i=e.icn3d;s.preventDefault();let l=parseFloat($("#"+e.pre+"empercentage").val());i.densityCifParserCls.densityCifParser(i.inputid,"em",l,i.emd),t.setLogCmd("set emmap percentage "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_emmapwireframeYes","click",(function(s){e.icn3d.setOptionCls.setOption("emmapwireframe","yes"),t.setLogCmd("set emmap wireframe on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_emmapwireframeNo","click",(function(s){e.icn3d.setOptionCls.setOption("emmapwireframe","no"),t.setLogCmd("set emmap wireframe off",!0)}))}clickMenu6(){let e=this.icn3dui;if(e.icn3d,e.bNode)return;let t=this;e.myEventCls.onIds("#"+e.pre+"mn6_assemblyYes","click",(function(s){let i=e.icn3d;i.bAssembly=!0,t.setLogCmd("set assembly on",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_assemblyNo","click",(function(s){let i=e.icn3d;i.bAssembly=!1,t.setLogCmd("set assembly off",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelAtoms","click",(function(s){let i=e.icn3d;i.residueLabelsCls.addAtomLabels(i.hAtoms),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add atom labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelElements","click",(function(s){let i=e.icn3d;i.residueLabelsCls.addAtomLabels(i.hAtoms,!0),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add element labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelResidues","click",(function(s){let i=e.icn3d;i.residueLabelsCls.addResidueLabels(i.hAtoms),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add residue labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelResnum","click",(function(s){let i=e.icn3d;i.residueLabelsCls.addResidueLabels(i.hAtoms,void 0,void 0,!0),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add residue number labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelChains","click",(function(s){let i=e.icn3d;i.analysisCls.addChainLabels(i.hAtoms),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add chain labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelTermini","click",(function(s){let i=e.icn3d;i.analysisCls.addTerminiLabels(i.hAtoms),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add terminal labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelYes","click",(function(t){let s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_addlabel","Add custom labels by selection"),s.pk=1,s.opts.pk="atom",s.pickpair=!0,s.pAtomNum=0})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelSelection","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_addlabelselection","Add custom labels by the selected")})),e.myEventCls.onIds("#"+e.pre+"mn6_labelColor","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_labelColor","Change color for all labels")})),e.myEventCls.onIds("#"+e.pre+"mn2_saveselection","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_saveselection","Save the selected")})),e.myEventCls.onIds(["#"+e.pre+"mn6_addlabelNo","#"+e.pre+"removeLabels"],"click",(function(s){let i=e.icn3d;i.labelcolor=void 0,i.pickpair=!1;t.setLogCmd("set labels off",!0);for(let e in i.labels)i.labels[e]=[];i.drawCls.draw()})),$(document).on("click","."+e.pre+"mn6_labelscale",(function(s){let i=e.icn3d,l=$(this).attr("v");i.labelScale=l,i.drawCls.draw(),t.setLogCmd("set label scale "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_distanceYes","click",(function(t){let s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_distance","Measure the distance of atoms"),s.pk=1,s.opts.pk="atom",s.pickpair=!0,s.pAtomNum=0,s.bMeasureDistance=!0})),e.myEventCls.onIds("#"+e.pre+"mn6_distTwoSets","click",(function(s){let i=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_disttwosets","Measure the distance between two sets"),t.setSetsMenus(),i.bMeasureDistance=!0})),e.myEventCls.onIds("#"+e.pre+"mn6_distManySets","click",(function(s){let i=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_distmanysets","Measure the pairwise distance among many sets"),t.setSetsMenus(!0),i.bMeasureDistance=!0})),e.myEventCls.onIds("#"+e.pre+"mn6_distanceNo","click",(function(s){let i=e.icn3d;i.pickpair=!1;t.setLogCmd("set lines off",!0),i.labels.distance=[],i.lines.distance=[],i.distPnts=[],i.pk=2,i.drawCls.draw()})),e.myEventCls.onIds(["#"+e.pre+"mn2_selectedcenter","#"+e.pre+"zoomin_selection"],"click",(function(s){let i=e.icn3d;i.transformCls.zoominSelection(),i.drawCls.draw(),t.setLogCmd("zoom selection",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_center","click",(function(s){let i=e.icn3d;i.applyCenterCls.centerSelection(),i.drawCls.draw(),t.setLogCmd("center selection",!0)})),e.myEventCls.onIds(["#"+e.pre+"mn6_resetOrientation","#"+e.pre+"resetOrientation"],"click",(function(s){let i=e.icn3d;i.transformCls.resetOrientation(),i.drawCls.draw(),t.setLogCmd("reset orientation",!0)})),e.myEventCls.onIds(["#"+e.pre+"mn6_chemicalbindingshow","#"+e.pre+"chemicalbindingshow"],"click",(function(s){e.icn3d.setOptionCls.setOption("chemicalbinding","show"),t.setLogCmd("set chemicalbinding show",!0)})),e.myEventCls.onIds(["#"+e.pre+"mn6_chemicalbindinghide","#"+e.pre+"chemicalbindinghide"],"click",(function(s){e.icn3d.setOptionCls.setOption("chemicalbinding","hide"),t.setLogCmd("set chemicalbinding hide",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_sidebyside","click",(function(s){let i=e.icn3d;if(i.bInputfile)return void alert("Side-by-Side does NOT work when the input is from a local file.");let l=i.shareLinkCls.shareLinkUrl(void 0);l=l.replace("full.html","full2.html"),l+="&closepopup=1",window.open(l,"_blank"),t.setLogCmd("side by side | "+l,!0)})),$(document).on("click","."+e.pre+"mn6_rotate",(function(s){let i=e.icn3d,l=$(this).attr("v").toLowerCase(),n=l.split(" ")[1];t.setLogCmd(l,!0),i.bStopRotate=!1,i.transformCls.rotateCount=0,i.transformCls.rotateCountMax=6e3,i.ROT_DIR=n,i.resizeCanvasCls.rotStruc(n)})),$(document).on("click","."+e.pre+"mn6_rotate90",(function(s){let i,l=e.icn3d,n=$(this).attr("v").toLowerCase(),r=n.split("-")[0];t.setLogCmd(n,!0),"x"==r?i=new THREE.Vector3(1,0,0):"y"==r?i=new THREE.Vector3(0,1,0):"z"==r&&(i=new THREE.Vector3(0,0,1));let o=.5*Math.PI;l.transformCls.setRotation(i,o)})),e.myEventCls.onIds("#"+e.pre+"mn6_cameraPers","click",(function(s){e.icn3d.setOptionCls.setOption("camera","perspective"),t.setLogCmd("set camera perspective",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_cameraOrth","click",(function(s){e.icn3d.setOptionCls.setOption("camera","orthographic"),t.setLogCmd("set camera orthographic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_bkgdBlack","click",(function(t){e.icn3d.setStyleCls.setBackground("black")})),e.myEventCls.onIds("#"+e.pre+"mn6_bkgdGrey","click",(function(t){e.icn3d.setStyleCls.setBackground("grey")})),e.myEventCls.onIds("#"+e.pre+"mn6_bkgdWhite","click",(function(t){e.icn3d.setStyleCls.setBackground("white")})),e.myEventCls.onIds("#"+e.pre+"mn6_bkgdTransparent","click",(function(t){e.icn3d.setStyleCls.setBackground("transparent")})),e.myEventCls.onIds("#"+e.pre+"mn6_showfogYes","click",(function(s){let i=e.icn3d;i.opts.fog="yes",i.fogCls.setFog(!0),i.drawCls.draw(),t.setLogCmd("set fog on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showfogNo","click",(function(s){let i=e.icn3d;i.opts.fog="no",i.fogCls.setFog(!0),i.drawCls.draw(),t.setLogCmd("set fog off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showslabYes","click",(function(s){e.icn3d.setOptionCls.setOption("slab","yes"),t.setLogCmd("set slab on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showslabNo","click",(function(s){e.icn3d.setOptionCls.setOption("slab","no"),t.setLogCmd("set slab off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showaxisYes","click",(function(s){e.icn3d.setOptionCls.setOption("axis","yes"),t.setLogCmd("set axis on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showaxisSel","click",(function(s){let i=e.icn3d;i.pc1=!0,i.axesCls.setPc1Axes(),t.setLogCmd("set pc1 axis",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showaxisNo","click",(function(s){let i=e.icn3d;i.pc1=!1,i.axes=[],i.setOptionCls.setOption("axis","no"),t.setLogCmd("set axis off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_symmetry","click",(function(t){let s=e.icn3d;s.bAxisOnly=!1,s.symdCls.retrieveSymmetry(Object.keys(s.structures)[0])})),e.myEventCls.onIds("#"+e.pre+"mn6_symd","click",(function(s){let i=e.icn3d;i.bAxisOnly=!1,i.symdCls.retrieveSymd(),i.bSymd=!0,t.setLogCmd("symd symmetry",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_clear_sym","click",(function(s){let i=e.icn3d;i.symdArray=[],i.drawCls.draw(),t.setLogCmd("clear symd symmetry",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_axes_only","click",(function(s){let i=e.icn3d;i.bAxisOnly=!0,i.drawCls.draw(),t.setLogCmd("show axis",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_area","click",(function(s){e.icn3d.analysisCls.calculateArea(),t.setLogCmd("area",!0)})),e.myEventCls.onIds("#"+e.pre+"applysymmetry","click",(function(s){let i=e.icn3d;i.bAxisOnly=!1;let l=$("#"+e.pre+"selectSymmetry").val();i.symmetrytitle="none"===l?void 0:l,i.drawCls.draw(),t.setLogCmd("symmetry "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"clearsymmetry","click",(function(s){let i=e.icn3d;i.symmetrytitle=void 0,i.drawCls.draw(),t.setLogCmd("symmetry none",!0)})),e.myEventCls.onIds(["#"+e.pre+"mn6_hbondsYes","#"+e.pre+"hbondsYes"],"click",(function(s){let i=e.icn3d;t.SetChainsAdvancedMenu();let l=i.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomHbond").length&&$("#"+e.pre+"atomsCustomHbond").html("  <option value='non-selected' selected>non-selected</option><option value='selected'>selected</option>"+l),$("#"+e.pre+"atomsCustomHbond2").length&&$("#"+e.pre+"atomsCustomHbond2").html("  <option value='selected' selected>selected</option>"+l),e.htmlCls.dialogCls.openDlg("dl_hbonds","Hydrogen bonds/interactions between two sets of atoms"),i.bHbondCalc=!1,$("#"+e.pre+"atomsCustomHbond").resizable(),$("#"+e.pre+"atomsCustomHbond2").resizable()})),e.myEventCls.onIds(["#"+e.pre+"mn6_contactmap"],"click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_contact","Set contact map")})),e.myEventCls.onIds("#"+e.pre+"mn6_hbondsNo","click",(function(t){let s=e.icn3d;s.showInterCls.hideHbondsContacts(),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn1_stabilizerYes","click",(function(s){let i=e.icn3d;i.threeDPrintCls.addStabilizer(),i.threeDPrintCls.prepareFor3Dprint(),t.setLogCmd("stabilizer",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_stabilizerNo","click",(function(s){let i=e.icn3d;t.setLogCmd("set stabilizer off",!0),i.threeDPrintCls.hideStabilizer(),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn1_stabilizerOne","click",(function(t){let s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_stabilizer","Add One Stabilizer"),s.pk=1,s.opts.pk="atom",s.pickpair=!0,s.pAtomNum=0})),e.myEventCls.onIds("#"+e.pre+"mn1_stabilizerRmOne","click",(function(t){let s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_stabilizer_rm","Remove One Stabilizer"),s.pk=1,s.opts.pk="atom",s.pickpair=!0,s.pAtomNum=0})),e.myEventCls.onIds("#"+e.pre+"mn1_thicknessSet","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_thickness","Set Thickness for 3D Printing")})),e.myEventCls.onIds("#"+e.pre+"mn3_setThickness","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_thickness2","Preferences")})),e.myEventCls.onIds("#"+e.pre+"mn6_ssbondsYes","click",(function(s){let i=e.icn3d;t.setLogCmd("disulfide bonds",!0),i.showInterCls.showSsbonds()})),e.myEventCls.onIds("#"+e.pre+"mn6_ssbondsExport","click",(function(s){e.icn3d.viewInterPairsCls.exportSsbondPairs(),t.setLogCmd("export disulfide bond pairs",!1)})),e.myEventCls.onIds("#"+e.pre+"mn6_ssbondsNo","click",(function(s){let i=e.icn3d;i.opts.ssbonds="no";t.setLogCmd("set disulfide bonds off",!0),i.lines.ssbond=[],i.setOptionCls.setStyle("sidec","nothing")})),e.myEventCls.onIds("#"+e.pre+"mn6_clbondsYes","click",(function(s){let i=e.icn3d;t.setLogCmd("cross linkage",!0),i.showInterCls.showClbonds()})),e.myEventCls.onIds("#"+e.pre+"mn6_clbondsExport","click",(function(s){e.icn3d.viewInterPairsCls.exportClbondPairs(),t.setLogCmd("export cross linkage pairs",!1)})),e.myEventCls.onIds("#"+e.pre+"mn6_clbondsNo","click",(function(s){let i=e.icn3d;i.opts.clbonds="no";t.setLogCmd("set cross linkage off",!0),i.lines.clbond=[],i.setOptionCls.setStyle("sidec","nothing")}))}setLogCmd(e,t,s){var i=this.icn3dui,l=i.icn3d;if(""===e.trim())return!1;let n=e.indexOf("|||");-1!==n&&(e=e.substr(0,n));let r={};if(r.factor=l._zoomFactor,r.mouseChange=l.mouseChange,r.quaternion={},r.quaternion._x=parseFloat(l.quaternion._x).toPrecision(5),r.quaternion._y=parseFloat(l.quaternion._y).toPrecision(5),r.quaternion._z=parseFloat(l.quaternion._z).toPrecision(5),r.quaternion._w=parseFloat(l.quaternion._w).toPrecision(5),t&&l.bAddCommands)if(l.STATENUMBER<l.commands.length){let t=l.commands[l.STATENUMBER-1],s=t.indexOf("|||");-1!=s&&e!==t.substr(0,s)&&(l.commands=l.commands.slice(0,l.STATENUMBER),l.commands.push(e+"|||"+l.transformCls.getTransformationStr(r)),l.optsHistory.push(i.hashUtilsCls.cloneHash(l.opts)),l.optsHistory[l.optsHistory.length-1].hlatomcount=Object.keys(l.hAtoms).length,i.utilsCls.isSessionStorageSupported()&&l.setStyleCls.saveCommandsToSession(),l.STATENUMBER=l.commands.length)}else l.commands.push(e+"|||"+l.transformCls.getTransformationStr(r)),l.optsHistory.push(i.hashUtilsCls.cloneHash(l.opts)),void 0!==l.hAtoms&&(l.optsHistory[l.optsHistory.length-1].hlatomcount=Object.keys(l.hAtoms).length),i.utilsCls.isSessionStorageSupported()&&l.setStyleCls.saveCommandsToSession(),l.STATENUMBER=l.commands.length;if(l.bAddLogs&&i.cfg.showcommand){let s=t?e:"[comment] "+e;l.logs.push(s),$("#"+i.pre+"logtext").val("> "+l.logs.join("\n> ")+"\n> ").scrollTop($("#"+i.pre+"logtext")[0].scrollHeight)}l.setStyleCls.adjustIcon()}}class et{constructor(e){this.icn3dui=e}setTopMenusHtml(e,t,s){let i=this.icn3dui;if(i.bNode)return"";let l="black"==i.htmlCls.opts.background?i.htmlCls.GREYD:"black",n="";n+="<div style='position:relative;'>",n+=i.htmlCls.divStr+"popup' class='icn3d-text icn3d-popup'></div>",n+=this.setReplayHtml(),n+="\x3c!--https://forum.jquery.com/topic/looking-for-a-jquery-horizontal-menu-bar--\x3e",n+=i.htmlCls.divStr+"mnlist' style='position:absolute; z-index:999; float:left; display:table-row; margin-top: -2px;'>",n+="<table border='0' cellpadding='0' cellspacing='0' width='100'><tr>";let r='<td valign="top">';if(n+=r+this.setMenu1()+"</td>",n+=r+this.setMenu2()+"</td>",n+=r+this.setMenu2b()+"</td>",n+=r+this.setMenu3()+"</td>",n+=r+this.setMenu4()+"</td>",n+=r+this.setMenu5()+"</td>",n+=r+this.setMenu6()+"</td>",n+=r+"<div style='position:relative; margin-left:6px;'>"+t,n+="<div class='icn3d-commandTitle' style='min-width:40px; margin-top: 3px; white-space: nowrap;'>"+s,n+=r+'<div class="icn3d-commandTitle" style="white-space:nowrap; margin-top:10px; border-left:solid 1px #888888"><span id="'+i.pre+'selection_expand" class="icn3d-expand icn3d-link" title="Expand">'+i.htmlCls.space2+'Toolbar <span class="ui-icon ui-icon-plus" style="width:15px"></span>'+i.htmlCls.space2+'</span><span id="'+i.pre+'selection_shrink" class="icn3d-shrink icn3d-link" style="display:none;" title="Shrink">'+i.htmlCls.space2+'Toolbar <span class="ui-icon ui-icon-minus" style="width:15px"></span>'+i.htmlCls.space2+"</span></div></td>",n+=r+'<div class="icn3d-commandTitle" style="white-space:nowrap; margin-top:8px; border-left:solid 1px #888888">'+i.htmlCls.space2+'<input type="text" id="'+i.pre+'search_seq" size="10" placeholder="one-letter seq."> <button style="white-space:nowrap;" id="'+i.pre+'search_seq_button">Search</button> <a style="text-decoration: none;" href="'+i.htmlCls.baseUrl+'icn3d/icn3d.html#selectb" target="_blank" title="Specification tips">?</a></div></td>',n+="</tr>",n+="</table>",n+="</div>",n+=this.setTools(),n+=i.htmlCls.divStr+"title' class='icn3d-commandTitle' style='font-size:1.2em; font-weight:normal; position:absolute; z-index:1; float:left; display:table-row; margin: 85px 0px 0px 5px; color:"+l+"; width:"+i.htmlCls.WIDTH+"px'></div>",n+=i.htmlCls.divStr+"viewer' style='position:relative; width:100%; height:100%; background-color: "+i.htmlCls.GREYD+";'>",n+=i.htmlCls.divStr+"mnLogSection'>",n+="<div style='height: "+i.htmlCls.MENU_HEIGHT+"px;'></div>",n+=" </div>",void 0===i.cfg.mmtfid){let e="top:180px; font-size: 1.8em;";n+=i.htmlCls.divStr+"wait' style='position:absolute; left:50px; "+e+" color: #444444;'>Loading data...</div>"}n+="<canvas id='"+i.pre+"canvas' style='width:100%; height: 100%; background-color: #FFF;'>Your browser does not support WebGL.</canvas>",(void 0===i.cfg.showcommand||i.cfg.showcommand)&&(n+=this.setLogWindow()),n+="</div>",n+="</div>",n+=i.htmlCls.setDialogCls.setDialogs(),n+=i.htmlCls.setDialogCls.setCustomDialogs(),$("#"+e).html(n),$("accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),$("accordion div").removeClass("ui-accordion-content ui-corner-all ui-corner-bottom ui-widget-content"),$(".icn3d-mn-item").menu({position:{my:"left top",at:"right top"}}),$(".icn3d-mn-item").hover((function(){}),(function(){$("accordion").accordion("option","active","none")})),$("#"+i.pre+"accordion1").hover((function(){$("#"+i.pre+"accordion1 div").css("display","block")}),(function(){$("#"+i.pre+"accordion1 div").css("display","none")})),$("#"+i.pre+"accordion2").hover((function(){$("#"+i.pre+"accordion2 div").css("display","block")}),(function(){$("#"+i.pre+"accordion2 div").css("display","none")})),$("#"+i.pre+"accordion2b").hover((function(){$("#"+i.pre+"accordion2b div").css("display","block")}),(function(){$("#"+i.pre+"accordion2b div").css("display","none")})),$("#"+i.pre+"accordion3").hover((function(){$("#"+i.pre+"accordion3 div").css("display","block")}),(function(){$("#"+i.pre+"accordion3 div").css("display","none")})),$("#"+i.pre+"accordion4").hover((function(){$("#"+i.pre+"accordion4 div").css("display","block")}),(function(){$("#"+i.pre+"accordion4 div").css("display","none")})),$("#"+i.pre+"accordion5").hover((function(){$("#"+i.pre+"accordion5 div").css("display","block")}),(function(){$("#"+i.pre+"accordion5 div").css("display","none")})),$("#"+i.pre+"accordion6").hover((function(){$("#"+i.pre+"accordion6 div").css("display","block")}),(function(){$("#"+i.pre+"accordion6 div").css("display","none")}))}setTopMenusHtmlMobile(e,t,s){let i=this.icn3dui;if(i.bNode)return"";let l="black"==i.htmlCls.opts.background?i.htmlCls.GREYD:"black",n="";if(n+="<div style='position:relative;'>",n+=i.htmlCls.divStr+"popup' class='icn3d-text icn3d-popup'></div>",n+=this.setReplayHtml(),!i.utilsCls.isMobile()){let e=i.htmlCls.WIDTH-40+5;n+=i.htmlCls.buttonStr+"fullscreen' style='position:absolute; z-index:1999; display:block; padding:0px; margin: 12px 0px 0px "+e+"px; width:30px; height:34px; border-radius:4px; border:none; background-color:#f6f6f6;' title='Full screen'>",n+="<svg fill='#1c94c4' viewBox='0 0 24 24' width='24' height='24'>",n+="<path d='M0 0h24v24H0z' fill='none'></path>",n+="<path d='M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z'></path>",n+="</svg>",n+="</button>"}n+="\x3c!--https://forum.jquery.com/topic/looking-for-a-jquery-horizontal-menu-bar--\x3e",n+=i.htmlCls.divStr+"mnlist' style='position:absolute; z-index:999; float:left; display:block; margin: 5px 0px 0px 5px;'>",n+="<div>",n+="<accordion id='"+i.pre+"accordion0' class='icn3d-accordion'>",i.cfg.notebook?n+="<h3 style='width:20px; height:24px; position:relative; padding: 0'><span style='position:absolute; left:3px; top:4px;'>&#9776;</span></h3>":n+="<h3 style='width:30px; height:34px; position:relative; padding: 0; margin-top:7px!important; background-color:#f6f6f6;'><span style='position:absolute; left:7px; top:8px;'>&#9776;</span></h3>",n+="<div>";let r="<li><span class='icn3d-menu-color'";if(n+="<ul class='icn3d-mn-item'>",n+=r+">File</span>",n+=this.setMenu1_base(),n+=r+">Select</span>",n+=this.setMenu2_base(),n+=r+">View</span>",n+=this.setMenu2b_base(),n+=r+" id='"+i.pre+"style'>Style</span>",n+=this.setMenu3_base(),n+=r+" id='"+i.pre+"color'>Color</span>",n+=this.setMenu4_base(),n+=r+">Analysis</span>",n+=this.setMenu5_base(),n+=r+">Help</span>",n+=this.setMenu6_base(),n+="<li><div style='position:relative; margin-top:-6px;'>"+t,n+="<div class='icn3d-commandTitle' style='margin-top: 3px; white-space: nowrap;'>"+s,n+="<li><span id='"+i.pre+"alternate2' class='icn3d-menu-color' title='Alternate the structures'>Alternate</span>",n+="</ul>",n+="</div>",n+="</accordion>",n+="</div>",n+="</div>",n+=i.htmlCls.divStr+"title' class='icn3d-commandTitle' style='font-size:1.2em; font-weight:normal; position:absolute; z-index:1; float:left; display:block; margin: 12px 0px 0px 40px; color:"+l+"; width:"+(i.htmlCls.WIDTH-40).toString()+"px'></div>",n+=i.htmlCls.divStr+"viewer' style='position:relative; width:100%; height:100%; background-color: "+i.htmlCls.GREYD+";'>",n+=i.htmlCls.divStr+"mnLogSection'>",n+="<div style='height: "+i.htmlCls.MENU_HEIGHT+"px;'></div>",n+="</div>",void 0===i.cfg.mmtfid){let e="top:180px; font-size: 1.8em;";n+=i.htmlCls.divStr+"wait' style='position:absolute; left:50px; "+e+" color: #444444;'>Loading data...</div>"}n+="<canvas id='"+i.pre+"canvas' style='width:100%; height: 100%; background-color: #FFF;'>Your browser does not support WebGL.</canvas>",(void 0===i.cfg.showcommand||i.cfg.showcommand)&&(n+=this.setLogWindow()),n+="</div>",n+="</div>",n+=i.htmlCls.setDialogCls.setDialogs(),n+=i.htmlCls.setDialogCls.setCustomDialogs(),$("#"+e).html(n),$("accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),$("accordion div").removeClass("ui-accordion-content ui-corner-all ui-corner-bottom ui-widget-content"),$(".icn3d-mn-item").menu({position:{my:"left top",at:"right top"}}),$(".icn3d-mn-item").hover((function(){}),(function(){$("accordion").accordion("option","active","none")})),$("#"+i.pre+"accordion0").hover((function(){$("#"+i.pre+"accordion0 div").css("display","block")}),(function(){$("#"+i.pre+"accordion0 div").css("display","none")}))}setReplayHtml(e){let t=this.icn3dui;if(t.bNode)return"";let s="";return s+=t.htmlCls.divStr+"replay' style='display:none; position:absolute; z-index:9999; top:"+parseInt(t.htmlCls.HEIGHT-100).toString()+"px; left:20px;'>",s+="<div title='Click to replay one step'><svg style='cursor:pointer;' fill='#f8b84e' viewBox='0 0 60 60' width='40' height='40'>",s+='<circle style="fill:#f8b84e;" cx="29" cy="29" r="29"/>',s+="<g>",s+='<polygon style="fill:#FFFFFF;" points="44,29 22,44 22,29.273 22,14"/>',s+='<path style="fill:#FFFFFF;" d="M22,45c-0.16,0-0.321-0.038-0.467-0.116C21.205,44.711,21,44.371,21,44V14c0-0.371,0.205-0.711,0.533-0.884c0.328-0.174,0.724-0.15,1.031,0.058l22,15C44.836,28.36,45,28.669,45,29s-0.164,0.64-0.437,0.826l-22,15C22.394,44.941,22.197,45,22,45z M23,15.893v26.215L42.225,29L23,15.893z"/>',s+="</g>",s+="</svg></div>",s+=t.htmlCls.divStr+"replay_menu' style='background-color:#DDDDDD; padding:3px; font-weight:bold;'></div>",s+=t.htmlCls.divStr+"replay_cmd' style='background-color:#DDDDDD; padding:3px; max-width:250px'></div>",s+="</div>",s}setTools(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+=e.htmlCls.divStr+"selection' style='display:none;'><div style='position:absolute; z-index:555; float:left; display:table-row; margin: 32px 0px 0px 3px;'>",t+="<table style='margin-top: 3px; width:100px;'><tr valign='center'>",t+=this.setTools_base(),t+="</tr></table>",t+="</div></div>",t}setButton(e,t,s,i,l){let n=this.icn3dui;return n.bNode?"":(l=void 0!==l?"color:"+l:"","<div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+e+"; height:36px;"+(n.utilsCls.isMobile()?" background-color:#DDDDDD;":"")+"' id='"+n.pre+t+"'><span style='white-space:nowrap;"+l+"' class='icn3d-commandTitle' title='"+s+"'>"+i+"</span></button></div>")}setTools_base(){let e=this.icn3dui;if(e.bNode)return"";let t="",s=e.utilsCls.isMobile()?"none":"button",i="<td valign='top'>";return t+=i+this.setButton(s,"alternate","Alternate the structures",'Alternate<br/>(Key "a")',e.htmlCls.ORANGE)+"</td>",t+=i+this.setButton(s,"saveimage","Save iCn3D PNG Image","Save iCn3D<br/>PNG Image")+"</td>",void 0===e.cfg.cid&&(t+=i+this.setButton(s,"hbondsYes","View H-Bonds & Interactions","H-Bonds &<br/> Interactions")+"</td>"),t+=i+this.setButton(s,"show_selected","View ONLY the selected atoms","View<br/> Selection")+"</td>",t+=i+this.setButton(s,"toggleHighlight","Turn on and off the 3D highlight in the viewer","Toggle<br/>Highlight")+"</td>",void 0===e.cfg.cid&&(t+=i+this.setButton(s,"removeLabels","Remove Labels","Remove<br/>Labels")+"</td>"),t}setTheme(e){let t,s,i,l,n,r=this.icn3dui;if(r.bNode)return"";r.htmlCls.themecolor=e,"orange"==e?(t="#e78f08",s="#f6a828",i="ui-bg_gloss-wave_35_f6a828_500x100.png",l="ui-icons_ef8c08_256x240.png",n="#eb8f00"):"black"==e?(t="#333333",s="#333333",i="ui-bg_gloss-wave_25_333333_500x100.png",l="ui-icons_222222_256x240.png",n="#222222"):"blue"==e&&(t="#4297d7",s="#5c9ccc",i="ui-bg_gloss-wave_55_5c9ccc_500x100.png",l="ui-icons_228ef1_256x240.png",n="#444"),$(".ui-widget-header").css({border:"1px solid "+t,background:s+' url("https://www.ncbi.nlm.nih.gov/Structure/icn3d/lib/images/'+i+'") 50% 50% repeat-x',color:"#fff","font-weight":"bold"}),$(".ui-button .ui-icon").css({"background-image":"url(https://www.ncbi.nlm.nih.gov/Structure/icn3d/lib/images/"+l+")"}),$(".ui-state-active a, .ui-state-active a:link, .ui-state-active a:visited").css({color:n,"text-decoration":"none"})}setLogWindow(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+=e.htmlCls.divStr+"cmdlog' style='float:left; margin-top: -5px; width: 100%;'>",t+="<textarea id='"+e.pre+"logtext' rows='2' style='width: 100%; height: "+e.htmlCls.CMD_HEIGHT+"px; padding: 0px; border: 0px; background-color: "+e.htmlCls.GREYD+";'></textarea>",t+="</div>",t}setMenu1(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion1' class='icn3d-accordion'>",t+="<h3>File</h3>",t+="<div>",t+=this.setMenu1_base(),t+="</div>",t+="</accordion>",t+="</div>",t}setMenu1_base(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<ul class='icn3d-mn-item'>",t+="<li><a href='https://www.ncbi.nlm.nih.gov/structure' target='_blank'>Search Structure "+e.htmlCls.wifiStr+"</a></li>",t+="<li><span>Search Similar</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_vastplus","NCBI VAST+ (PDB Assembly)"+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_vast","NCBI VAST (PDB)"+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_foldseek","Foldseek (PDB & AalphaFold)"+e.htmlCls.wifiStr),t+="</ul>",t+="<li><span>Retrieve by ID</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_mmdbid","MMDB ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_mmtfid","MMTF ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_pdbid","PDB ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_afid","AlphaFold UniProt ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_mmdbafid","MMDB or AlphaFold IDs"+e.htmlCls.wifiStr),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn1_opmid","OPM PDB ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_mmcifid","mmCIF ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_gi","NCBI gi "+e.htmlCls.wifiStr)),t+=e.htmlCls.setHtmlCls.getLink("mn1_cid","PubChem CID "+e.htmlCls.wifiStr),t+="</ul>",t+="</li>",t+="<li><span>Open File</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_pdbfile_app","PDB Files (appendable)"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn1_mmciffile","mmCIF File")),t+=e.htmlCls.setHtmlCls.getLink("mn1_mol2file","Mol2 File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_sdffile","SDF File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_xyzfile","XYZ File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_afmapfile","AlphaFold PAE File"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn1_urlfile","URL(Same Host) "+e.htmlCls.wifiStr)),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_pngimage","iCn3D PNG Image"),t+=e.htmlCls.setHtmlCls.getLink("mn1_state","State/Script File"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn1_fixedversion","Share Link in Archived Ver. "+e.htmlCls.wifiStr)),t+=e.htmlCls.setHtmlCls.getLink("mn1_selection","Selection File"),e.cfg.simplemenu||(t+="<li>-</li>",t+="<li><span>Electron Density(DSN6)</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_dsn6","Local File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_dsn6url","URL(Same Host) "+e.htmlCls.wifiStr),t+="</ul>"),t+="</ul>",t+="</li>",t+="<li><span>Align</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_blast_rep_id","Sequence to Structure"),t+="<li><span>Structure to Structure</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_align","Two PDB Structures "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_alignaf","Two AlphaFold Structures "+e.htmlCls.wifiStr),t+="</ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_chainalign","Multiple Chains "+e.htmlCls.wifiStr),t+="</ul>",t+="</li>",t+="<li id='"+e.pre+"mn2_realignWrap'><span>Realign Selection</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn2_realign","mn2_realignonstruct","by Structure Alignment "+e.htmlCls.wifiStr,!0),t+=e.htmlCls.setHtmlCls.getRadio("mn2_realign","mn2_realignonseqalign","by Sequence Alignment "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getRadio("mn2_realign","mn2_realignresbyres","Residue by Residue"),t+="</ul>",t+="</li>",t+="<li><span>3D Printing</span>",t+="<ul>",void 0===e.cfg.cid?(t+=e.htmlCls.setHtmlCls.getLink("mn1_exportVrmlStab","WRL/VRML(Color, W/ Stab.)"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportStlStab","STL(W/ Stabilizers)"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_exportVrml","WRL/VRML(Color)"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportStl","STL"),e.cfg.simplemenu||(t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_stabilizerYes","Add All Stabilizers"),t+=e.htmlCls.setHtmlCls.getLink("mn1_stabilizerNo","Remove All Stabilizers"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_stabilizerOne","Add One Stabilizer"),t+=e.htmlCls.setHtmlCls.getLink("mn1_stabilizerRmOne","Remove One Stabilizer"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_thicknessSet","Set Thickness"))):(t+=e.htmlCls.setHtmlCls.getLink("mn1_exportVrml","VRML(Color)"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportStl","STL")),t+="</ul>",t+="</li>",t+="<li><span>Save Files</span>",t+="<ul>",t+="<li><span>iCn3D PNG Image</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas","Original Size & HTML"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas1","Original Size"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas2","2X Large"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas4","4X Large"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas8","8X Large")),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_exportState","State File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportSelections","Selection File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportSelDetails","Selection Details"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCounts","Residue Counts"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportPdbRes","PDB"),void 0===e.cfg.cid&&(t+=e.htmlCls.setHtmlCls.getLink("mn1_exportSecondary","Secondary Structure")),t+="<li><br/></li>",t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_sharelink","Share Link "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_replayon","Replay Each Step"),t+="<li><br/></li>",t+="</ul>",t}setMenu2(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion2' class='icn3d-accordion'>",t+="<h3>Select</h3>",t+="<div>",t+=this.setMenu2_base(),t+="</div>",t+="</accordion>",t+="</div>",t}setMenu2_base(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<ul class='icn3d-mn-item'>",e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn2_definedsets","Defined Sets")),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectall","All"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn2_selectdisplayed","Displayed Set")),t+=e.htmlCls.setHtmlCls.getLink("mn2_aroundsphere","by Distance"),t+="<li><span>by Property</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn2_propPos","Positive"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propNeg","Negative"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propHydro","Hydrophobic"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propPolar","Polar"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propBfactor","B-factor"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propSolAcc","Solvent Accessibility"),t+="</ul>",t+="</li>",e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn2_selectcomplement","Inverse"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectmainchains","Main Chains"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectsidechains","Side Chains"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectmainsidechains","Main & Side Chains"),t+=e.htmlCls.setHtmlCls.getLink("mn2_command","Advanced")),void 0===e.cfg.cid?(t+="<li><span>Select on 3D</span>",t+="<ul>",t+='<li>"Alt"+Click: start selection</li>',t+='<li>"Ctrl"+Click: union selection</li>',t+='<li>"Shift"+Click: range Selection</li>',t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkChain","Chain"),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi||(t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkDomain","3D Domain")),t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkStrand","Strand/Helix"),t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkResidue","Residue",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkYes","Atom"),t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkNo","None"),t+="</ul>",t+="</li>"):e.utilsCls.isMobile()?t+="<li><span>Touch to pick</span>":t+='<li><span>Picking with<br>"Alt" + Click</span>',t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn2_saveselection","Save Selection"),t+=e.htmlCls.setHtmlCls.getLink("clearall","Clear Selection"),t+="<li>-</li>",e.cfg.simplemenu||(t+="<li><span>Highlight Color</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_clr","mn2_hl_clrYellow","Yellow",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_clr","mn2_hl_clrGreen","Green"),t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_clr","mn2_hl_clrRed","Red"),t+="</ul>",t+="</li>",t+="<li><span>Highlight Style</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_style","mn2_hl_styleOutline","Outline",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_style","mn2_hl_styleObject","3D Objects"),t+="</ul>",t+="</li>"),t+=e.htmlCls.setHtmlCls.getLink("toggleHighlight2","Toggle Highlight"),t+="<li><br/></li>",t+="</ul>",t}setMenu2b(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion2b' class='icn3d-accordion'>",t+="<h3>View</h3>",t+="<div>",t+=this.setMenu2b_base(),t+="</div>",t+="</accordion>",t+="</div>",t}setMenu2b_base(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<ul class='icn3d-mn-item'>",t+=e.htmlCls.setHtmlCls.getLink("mn2_show_selected","View Selection"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn2_hide_selected","Hide Selection")),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectedcenter","Zoom in Selection"),t+=e.htmlCls.setHtmlCls.getLink("mn6_center","Center Selection"),t+=e.htmlCls.setHtmlCls.getLink("mn2_fullstru","View Full Structure"),t+="<li id='"+e.pre+"mn2_alternateWrap'><span id='"+e.pre+"mn2_alternate' class='icn3d-link'>Alternate(Key \"a\")</span></li>",void 0!==e.cfg.opmid?(t+="<li id='"+e.pre+"togglememli'><span id='"+e.pre+"togglemem' class='icn3d-link'>Toggle Membrane</span></li>",t+="<li id='"+e.pre+"adjustmemli'><span id='"+e.pre+"adjustmem' class='icn3d-link'>Adjust Membrane</span></li>",t+="<li id='"+e.pre+"selectplaneli'><span id='"+e.pre+"selectplane' class='icn3d-link'>Select between<br>Two X-Y Planes</span></li>"):(t+="<li id='"+e.pre+"togglememli' style='display:none'><span id='"+e.pre+"togglemem' class='icn3d-link'>Toggle Membrane</span></li>",t+="<li id='"+e.pre+"adjustmemli' style='display:none'><span id='"+e.pre+"adjustmem' class='icn3d-link'>Adjust Membrane</span></li>",t+="<li id='"+e.pre+"selectplaneli' style='display:none'><span id='"+e.pre+"selectplane' class='icn3d-link'>Select between<br>Two X-Y Planes</span></li>"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn6_sidebyside","Side by Side"),t+="<li><span>Rotate</span>",t+="<ul>",t+="<li><span>Rotate 90&deg;</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate90","mn6_rotatex","X-axis(Shift + Key M)"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate90","mn6_rotatey","Y-axis(Shift + Key J)"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate90","mn6_rotatez","Z-axis"),t+="</ul>",t+="</li>",t+="<li><span>Auto Rotation</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate","mn6_rotateleft","Rotate Left"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate","mn6_rotateright","Rotate Right"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate","mn6_rotateup","Rotate Up"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate","mn6_rotatedown","Rotate Down"),t+="</ul>",t+="</li>",t+="</ul>",t+="</li>",t+="<li><span>Camera</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_camera","mn6_cameraPers","Perspective",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_camera","mn6_cameraOrth","Orthographic"),t+="</ul>",t+="</li>",t+="<li><span>Fog for Selection</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_showfog","mn6_showfogYes","On"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_showfog","mn6_showfogNo","Off",!0),t+="</ul>",t+="</li>",t+="<li><span>Slab for Selection</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_showslab","mn6_showslabYes","On"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_showslab","mn6_showslabNo","Off",!0),t+="</ul>",t+="</li>",t+="<li><span>XYZ-axes</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_showaxis","mn6_showaxisYes","Original"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_showaxis","mn6_showaxisSel","Prin. Axes on Sel."),t+=e.htmlCls.setHtmlCls.getRadio("mn6_showaxis","mn6_showaxisNo","Hide",!0),t+="</ul>",t+="</li>",t+="<li>-</li>",t+="<li><span>Reset</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_reset","reset","All"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_reset","mn6_resetOrientation","Orientation"),t+="</ul>",t+="</li>",e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn6_back","Undo"),t+=e.htmlCls.setHtmlCls.getLink("mn6_forward","Redo")),t+=e.htmlCls.setHtmlCls.getLink("mn6_fullscreen","Full Screen"),t+="<li><br/></li>",t+="</ul>",t}setMenu3(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion3' class='icn3d-accordion'>",t+="<h3 id='"+e.pre+"style'>Style</h3>",t+="<div>",t+=this.setMenu3_base(),t+="</div>",t+="</accordion>",t+="</div>",t}setMenu3_base(){let e=this.icn3dui;if(e.bNode)return"";let t="";t+="<ul class='icn3d-mn-item'>",void 0===e.cfg.cid&&(t+="<li><span>Proteins</span>",t+="<ul>",void 0!==e.cfg.align||void 0!==e.cfg.chainalign?t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsRibbon","Ribbon"):t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsRibbon","Ribbon",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsStrand","Strand"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsCylinder","Cylinder and Plate"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsSchematic","Schematic"),void 0!==e.cfg.align||void 0!==e.cfg.chainalign?t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsCalpha","C Alpha Trace",!0):t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsCalpha","C Alpha Trace"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsBackbone","Backbone"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsBfactor","B-factor Tube"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsLines","Lines"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsBallstick","Ball and Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsNo","Hide"),t+="</ul>",t+="</li>",t+="<li><span>Side Chains</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecLines","Lines"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecBallstick","Ball and Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecNo","Hide",!0),t+="</ul>",t+="</li>",t+="<li><span>Nucleotides</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclCartoon","Cartoon",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclPhos","O3' Trace"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclBackbone","Backbone"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclSchematic","Schematic"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclLines","Lines"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclBallstick","Ball and Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclNo","Hide"),t+="</ul>",t+="</li>",t+="<li><span>Nucl. Bases</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_ntbase","mn3_ntbaseLines","Lines"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_ntbase","mn3_ntbaseStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_ntbase","mn3_ntbaseBallstick","Ball and Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_ntbase","mn3_ntbaseSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_ntbase","mn3_ntbaseNo","Hide",!0),t+="</ul>",t+="</li>"),t+="<li><span>Chemicals</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligLines","Lines"),void 0===e.cfg.cid?(t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligStick","Stick",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligBallstick","Ball and Stick")):(t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligBallstick","Ball and Stick",!0)),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligSchematic","Schematic"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligNo","Hide"),t+="</ul>",t+="</li>",t+="<li><span>Hydrogens</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_hydrogens","mn3_hydrogensYes","Show",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_hydrogens","mn3_hydrogensNo","Hide"),t+="</ul>",t+="</li>",void 0===e.cfg.cid&&(t+="<li><span>Glycans</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_glycansCart","mn3_glycansCartYes","Show Cartoon"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_glycansCart","mn3_glycansCartNo","Hide Cartoon",!0),t+="</ul>",t+="</li>"),t+="<li><span>Ions</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_ions","mn3_ionsSphere","Sphere",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_ions","mn3_ionsDot","Dot"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_ions","mn3_ionsNo","Hide"),t+="</ul>",t+="</li>",t+="<li><span>Water</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_water","mn3_waterSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_water","mn3_waterDot","Dot"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_water","mn3_waterNo","Hide",!0),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn3_setThickness","Preferences"),e.cfg.simplemenu||(t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn3_styleSave","Save Style"),t+=e.htmlCls.setHtmlCls.getLink("mn3_styleApplySave","Apply Saved Style")),t+="<li>-</li>",t+="<li><span>Surface Type</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceVDW","Van der Waals"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceVDWContext","VDW with Context")),t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceMolecular","Molecular Surface"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceMolecularContext","MS with Context")),t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceSAS","Solvent Accessible"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceSASContext","SA with Context")),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn5_surfaceNo","Remove Surface"),t+="<li><span>Surface Opacity</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_opacity","mn5_opacity10","1.0",!0);for(let s=9;s>0;--s)t+=e.htmlCls.setHtmlCls.getRadio("mn5_opacity","mn5_opacity0"+s,"0."+s);return t+="</ul>",t+="</li>",t+="<li><span>Surface Wireframe</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_wireframe","mn5_wireframeYes","Yes"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_wireframe","mn5_wireframeNo","No",!0),t+="</ul>",t+="</li>",void 0===e.cfg.cid&&void 0===e.cfg.align&&void 0===e.cfg.chainalign&&void 0===e.cfg.mmdbaf&&(e.cfg.simplemenu||(t+="<li>-</li>",t+="<li id='"+e.pre+"mapWrapper1'><span>Electron Density</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_elecmap","mn5_elecmap2fofc","2Fo-Fc Map"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_elecmap","mn5_elecmapfofc","Fo-Fc Map"),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLinkWrapper("mn5_elecmapNo","Remove Map","mapWrapper2"),t+="<li id='"+e.pre+"mapWrapper3'><span>Map Wireframe</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_mapwireframe","mn5_mapwireframeYes","Yes",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn5_mapwireframe","mn5_mapwireframeNo","No"),t+="</ul>",t+="</li>",void 0===e.cfg.mmtfid&&(t+=e.htmlCls.setHtmlCls.getLinkWrapper("mn5_emmap","EM Density Map","emmapWrapper1"),t+=e.htmlCls.setHtmlCls.getLinkWrapper("mn5_emmapNo","Remove EM Map","emmapWrapper2"),t+="<li id='"+e.pre+"emmapWrapper3'><span>EM Map Wireframe</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_emmapwireframe","mn5_emmapwireframeYes","Yes",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn5_emmapwireframe","mn5_emmapwireframeNo","No"),t+="</ul>",t+="</li>"))),t+="<li>-</li>",t+="<li><span>Background</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_bkgd","mn6_bkgdTransparent","Transparent"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_bkgd","mn6_bkgdBlack","Black",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_bkgd","mn6_bkgdGrey","Gray"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_bkgd","mn6_bkgdWhite","White"),t+="</ul>",t+="</li>",e.cfg.simplemenu||(t+="<li><span>Dialog Color</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_theme","mn6_themeBlue","Blue",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_theme","mn6_themeOrange","Orange"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_theme","mn6_themeBlack","Black"),t+="</ul>",t+="</li>"),t+="<li><br/></li>",t+="</ul>",t}setMenu4(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion4' class='icn3d-accordion'>",t+="<h3 id='"+e.pre+"color'>Color</h3>",t+="<div>",t+=this.setMenu4_base(),t+="</div>",t+="</accordion>",t+="</div>",t}setMenu4_base(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<ul class='icn3d-mn-item'>",t+="<li><span style='padding-left:1.5em;'>Unicolor</span>",t+="<ul>",t+="<li><span>Red</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed1","Red","F00"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed2","Indian Red","CD5C5C"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed3","Light Coral","F08080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed4","Salmon","FA8072"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed5","Dark Salmon","E9967A"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed6","Light Salmon","FFA07A"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed7","Crimson","DC143C"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed8","Fire Brick","B22222"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed9","Dark Red","8B0000"),t+="</ul>",t+="<li><span>Pink</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink1","Pink","FFC0CB"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink2","Light Pink","FFB6C1"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink3","Hot Pink","FF69B4"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink4","Deep Pink","FF1493"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink5","Medium Violet Red","C71585"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink6","Pale Violet Red","DB7093"),t+="</ul>",t+="<li><span>Orange</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran1","Orange","FFA500"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran2","Dark Orange","FF8C00"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran3","Orange Red","FF4500"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran4","Tomato","FF6347"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran5","Coral","FF7F50"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran6","Light Salmon","FFA07A"),t+="</ul>",t+="<li><span>Yellow</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw1","Yellow","FF0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw2","Gold","FFD700"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw3","Light Yellow","FFFFE0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw4","Lemon Chiffon","FFFACD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw5","Light Golden Rod","FAFAD2"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw6","Papaya Whip","FFEFD5"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw7","Moccasin","FFE4B5"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw8","Peach Puff","FFDAB9"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw9","Pale Golden Rod","EEE8AA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw10","Khaki","F0E68C"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw11","Dark Khaki","BDB76B"),t+="</ul>",t+="<li><span>Magenta</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt1","Magenta","F0F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt2","Orchid","DA70D6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt3","Violet","EE82EE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt4","Plum","DDA0DD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt5","Thistle","D8BFD8"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt6","Lavender","E6E6FA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt7","Medium Orchid","BA55D3"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt8","Medium Purple","9370DB"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt9","Rebecca Purple","663399"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt10","Blue Violet","8A2BE2"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt11","Dark Violet","9400D3"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt12","Dark Orchid","9932CC"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt13","Dark Magenta","8B008B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt14","Purple","800080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt15","Indigo","4B0082"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt16","Slat Blue","6A5ACD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt17","Dark Slate Blue","483D8B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt18","Medium Slat Blue","6A5ACD"),t+="</ul>",t+="<li><span>Green</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn1","Green","0F0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn2","Dark Green","006400"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn3","Yellow Green","9ACD32"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn4","Olive Drab","6B8E23"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn5","Olive","808000"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn6","Dark Olive Green","556B2F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn7","Medium Aquamarine","66CDAA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn8","Dark Sea Green","8FBC8B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn9","Lignt Sea Green","20B2AA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn10","Dark Cyan","008B8B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn11","Teal","008080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn12","Forest Green","228B22"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn13","Sea Green","2E8B57"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn14","Medium Sea Green","3CB371"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn15","Spring Green","00FF7F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn16","Medium Spring","00FA9A"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn17","Light Green","90EE90"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn18","Pale Green","98FB98"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn19","Lime Green","32CD32"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn20","Lawn Green","7CFC00"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn21","Chartreuse","7FFF00"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn22","Green Yellow","ADFF2F"),t+="</ul>",t+="<li><span>Cyan</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan1","Cyan","0FF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan2","Light Cyan","E0FFFF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan3","Pale Turquoise","AFEEEE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan4","Aquamarine","7FFFD4"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan5","Turquoise","40E0D0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan6","Medium Turquoise","48D1CC"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan7","Dark Turquoise","00CED1"),t+="</ul>",t+="<li><span>Blue</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue1","Blue","00F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue2","Medium Blue","0000CD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue3","Dark Blue","00008B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue4","Navy","000080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue5","Midnight Blue","191970"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue6","Royal Blue","4169E1"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue7","Medium Slate Blue","7B68EE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue8","Corn Flower Blue","6495ED"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue9","Dodger Blue","1E90FF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue10","Deep Sky Blue","00BFFF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue11","Light Sky Blue","87CEFA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue12","Sky Blue","87CEEB"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue13","Light Blue","ADD8E6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue14","Powder Blue","B0E0E6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue15","Light Steel Blue","B0C4DE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue16","Steel Blue","4682B4"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue17","Cadet Blue","5F9EA0"),t+="</ul>",t+="<li><span>Brown</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown1","Brown","A52A2A"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown2","Maroon","800000"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown3","Sienna","A0522D"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown4","Saddle Brown","8B4513"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown5","Chocolate","D2691E"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown6","Peru","CD853F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown7","Dark Golden Rod","B8860B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown8","Golden Rod","DAA520"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown9","Sandy Brown","F4A460"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown10","Rosy Brown","BC8F8F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown11","Tan","D2B48C"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown12","Burlywood","DEB887"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown13","Wheat","F5DEB3"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown14","Navajo White","FFDEAD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown15","Bisque","FFE4C4"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown16","Blanched Almond","FFEBCD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown17","Corn Silk","FFF8DC"),t+="</ul>",t+="<li><span>White</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite1","White","FFF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite2","Snow","FFFAFA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite3","Honey Dew","F0FFF0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite4","Mint Cream","F5FFFA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite5","Azure","F0FFFF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite6","Alice Blue","F0F8FF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite7","Ghost White","F8F8FF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite8","White Smoke","F5F5F5"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite9","Sea Shell","FFF5EE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite10","Beige","F5F5DC"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite11","Old Lace","FDF5E6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite12","Floral White","FFFAF0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite13","Ivory","FFFFF0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite14","Antique White","FAEBD7"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite15","Linen","FAF0E6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite16","Lavenderblush","FFF0F5"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite17","Misty Rose","FFE4E1"),t+="</ul>",t+="<li><span>Gray</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray1","Gray","808080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray2","Dim Gray","696969"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray3","Light Slate Gray","778899"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray4","Slate Gray","708090"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray5","Dark Slate Gray","2F4F4F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray6","Black","000000"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray7","Dark Gray","A9A9A9"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray8","Silver","C0C0C0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray9","Light Gray","D3D3D3"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray10","Gainsboro","DCDCDC"),t+="</ul>",t+="</ul>",e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrCustom","Color Picker"),t+="<li>-</li>"),void 0===e.cfg.cid?(t+="<li><span style='padding-left:1.5em;'>Rainbow (R-V)</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrRainbow","for Selection"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrRainbowChain","for Chains"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrRainbowSets","for Sets"),t+="</ul>",e.cfg.simplemenu||(t+="<li><span style='padding-left:1.5em;'>Spectrum (V-R)</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSpectrum","for Selection"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSpectrumChain","for Chains"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSpectrumSets","for Sets"),t+="</ul>"),t+="<li><span style='padding-left:1.5em;'>Secondary</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSSGreen","Sheet in Green"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSSYellow","Sheet in Yellow"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSSSpectrum","Spectrum"),t+="</ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrCharge","Charge"),t+="<li><span style='padding-left:1.5em;'>Hydrophobicity</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrNormalizedHP","Normalized"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrHydrophobic","Wimley-White"),t+="</ul>",t+="<li><span style='padding-left:1.5em;'>B-factor</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrBfactor","Original"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrBfactorNorm","Percentile"),t+="</ul>",e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrArea",'Solvent<br><span style="padding-left:1.5em;">Accessibility</span>')),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrStructure","Structure"),void 0!==e.cfg.align||void 0!==e.cfg.chainalign||void 0!==e.cfg.blast_rep_id?t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrChain","Chain"):t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrChain","Chain",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrdomain","3D Domain"),void 0===e.cfg.cid&&(e.cfg.simplemenu||(t+="<li><span style='padding-left:1.5em;'>Defined Sets</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrsets",'Rainbow for Selected Sets<br>in "Analysis > Defined Sets"'),t+="</ul>")),t+="<li><span style='padding-left:1.5em;'>Residue</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrResidue","Default"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrResidueCustom","Custom"),t+="</ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrAtom","Atom"),void 0!==e.cfg.align||void 0!==e.cfg.chainalign?(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrIdentity","Identity",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrConserved","Conservation")):void 0!==e.cfg.blast_rep_id&&(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrIdentity","Identity"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrConserved","Conservation",!0)),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrConfidence",'AlphaFold<br><span style="padding-left:1.5em;">Confidence</span>')):t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrAtom","Atom",!0),e.cfg.simplemenu||(t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn4_clrSave","Save Color"),t+=e.htmlCls.setHtmlCls.getLink("mn4_clrApplySave","Apply Saved Color")),t+="<li><br/></li>",t+="</ul>",t}setMenu5(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion5' class='icn3d-accordion'>",t+="<h3 id='"+e.pre+"analysis' style='font-size:1.2em'>&nbsp;Analysis</h3>",t+="<div>",t+=this.setMenu5_base(),t+="</div>",t+="</accordion>",t+="</div>",t}setMenu5_base(){let e=this.icn3dui;if(e.bNode)return"";let t="";t+="<ul class='icn3d-mn-item'>",void 0===e.cfg.cid&&(t+=e.htmlCls.setHtmlCls.getLink("mn6_selectannotations","Seq. & Annotations "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn2_alignment","Aligned Seq. "+e.htmlCls.wifiStr),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi&&void 0===e.cfg.blast_rep_id&&void 0===e.cfg.align&&void 0===e.cfg.chainalign||(t+=e.htmlCls.setHtmlCls.getLink("mn2_2ddgm","2D Diagram "+e.htmlCls.wifiStr)),t+="<li><span>2D Cartoon</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("2dctn_chain","Chain Level"),t+=e.htmlCls.setHtmlCls.getLink("2dctn_domain","Domain Level"),t+=e.htmlCls.setHtmlCls.getLink("2dctn_secondary","Helix/Sheet Level"),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("definedsets2","Defined Sets"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn6_hbondsYes","Interactions"),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn6_contactmap","Contact Map")),e.cfg.notebook||(t+=e.htmlCls.setHtmlCls.getLink("mn1_mutation","Mutation "+e.htmlCls.wifiStr)),e.cfg.simplemenu||(t+="<li>-</li>")),e.cfg.notebook||e.cfg.hidelicense||(t+=e.htmlCls.setHtmlCls.getLink("mn1_delphi","DelPhi Potential "+e.htmlCls.licenseStr),e.cfg.simplemenu||(t+="<li><span>Load PQR/Phi</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_phi","Local PQR/Phi/Cube File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_phiurl","URL PQR/Phi/Cube File"),t+="</ul>",t+=e.htmlCls.setHtmlCls.getLink("delphipqr","Download PQR")),t+="<li>-</li>"),t+="<li><span>Distance</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_distance","mn6_distanceYes","between Two Atoms"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_distance","mn6_distTwoSets","between Two Sets"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_distance","mn6_distManySets","Among Many Sets"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_distance","mn6_distanceNo","Hide",!0),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn6_area","Surface Area"),t+="<li><span>Label</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelYes","by Picking Atoms"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelSelection","per Selection"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelAtoms","per Atom"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelElements","per Atom Element"),void 0===e.cfg.cid&&(t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelResidues","per Residue"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelResnum","per Residue & Number"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelChains","per Chain"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelTermini","N- & C-Termini")),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_labelColor","Change Label Color",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelNo","Remove",!0),t+="</ul>",t+="</li>",t+="<li><span>Label Scale</span>",t+="<ul>";for(let s=1;s<=4;++s){let i=2*s;t+=e.htmlCls.setHtmlCls.getRadio("mn6_labelscale","mn6_labelscale0"+i,"0."+i)}for(let s=1;s<=5;++s)t+=1==s?e.htmlCls.setHtmlCls.getRadio("mn6_labelscale","mn6_labelscale"+s+"0",s+".0",!0):e.htmlCls.setHtmlCls.getRadio("mn6_labelscale","mn6_labelscale"+s+"0",s+".0");if(t+="</ul>",t+="</li>",t+="<li>-</li>",void 0===e.cfg.cid){e.cfg.simplemenu||(t+="<li><span>Chem. Binding</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_chemicalbinding","mn6_chemicalbindingshow","Show"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_chemicalbinding","mn6_chemicalbindinghide","Hide",!0),t+="</ul>",t+="</li>"),t+="<li><span>Disulfide Bonds</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_ssbonds","mn6_ssbondsYes","Show",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_ssbonds","mn6_ssbondsExport","Export Pairs"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_ssbonds","mn6_ssbondsNo","Hide"),t+="</ul>",t+="</li>",e.cfg.simplemenu||(t+="<li><span>Cross-Linkages</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_clbonds","mn6_clbondsYes","Show",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_clbonds","mn6_clbondsExport","Export Pairs"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_clbonds","mn6_clbondsNo","Hide"),t+="</ul>",t+="</li>");let s=void 0!==e.cfg.mmtfid||void 0!==e.cfg.pdbid||void 0!==e.cfg.opmid||void 0!==e.cfg.mmcifid||void 0!==e.cfg.mmdbid||void 0!==e.cfg.gi||void 0!==e.cfg.blast_rep_id;s&&(t+="<li id='"+e.pre+"assemblyWrapper'><span>Assembly</span>",t+="<ul>",e.cfg.bu?(t+=e.htmlCls.setHtmlCls.getRadio("mn6_assembly","mn6_assemblyYes","Biological Assembly",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_assembly","mn6_assemblyNo","Asymmetric Unit")):(t+=e.htmlCls.setHtmlCls.getRadio("mn6_assembly","mn6_assemblyYes","Biological Assembly"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_assembly","mn6_assemblyNo","Asymmetric Unit",!0)),t+="</ul>",t+="</li>"),t+="<li><span>Symmetry</span>",t+="<ul>",s&&(t+=e.htmlCls.setHtmlCls.getLink("mn6_symmetry","from PDB(precalculated) "+e.htmlCls.wifiStr)),e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn6_symd","from SymD(Dynamic) "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn6_clear_sym","Clear SymD Symmetry"),t+=e.htmlCls.setHtmlCls.getLink("mn6_axes_only","Show Axes Only")),t+="</ul>",t+="</li>",t+="<li>-</li>"}return e.cfg.simplemenu||(t+=e.htmlCls.setHtmlCls.getLink("mn6_yournote","Window Title")),void 0!==e.cfg.cid?(t+="<li><span>Links</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_link_structure","Compound Summary "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_vast","Similar Compounds "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_bind","Structures Bound "+e.htmlCls.wifiStr),t+="</ul>",t+="</li>"):(t+="<li><span>Links</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_link_structure","Structure Summary "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_vast","Similar Structures "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_pubmed","Literature "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_protein","Protein "+e.htmlCls.wifiStr),t+="</ul>",t+="</li>"),t+="<li><br/></li>",t+="</ul>",t}setMenu6(){let e=this.icn3dui;if(e.bNode)return"";let t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion6' class='icn3d-accordion'>",t+="<h3>Help</h3>",t+="<div>",t+=this.setMenu6_base(),t+="</div>",t+="</accordion>",t+="</div>",t}setMenu6_base(){let e=this.icn3dui;if(e.bNode)return"";let t="",s="<li><a href='";return t+="<ul class='icn3d-mn-item'>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#about' target='_blank'>About iCn3D<span style='font-size:0.9em'> "+e.REVISION+"</span></a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#gallery' target='_blank'>Live Gallery "+e.htmlCls.wifiStr+"</a></li>",t+="<li><span>Tutorial</span>",t+="<ul>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#useicn3d' target='_blank'>Use iCn3D</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#videos' target='_blank'>iCn3D Videos</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#parameters' target='_blank'>URL Parameters</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#commands' target='_blank'>Commands</a></li>",t+="</ul>",t+="</li>",t+=s+"https://www.ncbi.nlm.nih.gov/structure' target='_blank'>Search Structure "+e.htmlCls.wifiStr+"</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#citing' target='_blank'>Citing iCn3D</a></li>",t+="<li><span>Source Code</span>",t+="<ul>",t+=s+"https://github.com/ncbi/icn3d' target='_blank'>GitHub (browser) "+e.htmlCls.wifiStr+"</a></li>",t+=s+"https://www.npmjs.com/package/icn3d' target='_blank'>npm (Node.js) "+e.htmlCls.wifiStr+"</a></li>",t+=s+"https://pypi.org/project/icn3dpy' target='_blank'>Jupyter Notebook "+e.htmlCls.wifiStr+"</a></li>",t+="</ul>",t+="</li>",e.cfg.simplemenu||(t+="<li><span>Develop</span>",t+="<ul>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#HowToUse' target='_blank'>How to Embed</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#datastructure' target='_blank'>Data Structure</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#classstructure' target='_blank'>Class Structure</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#addclass' target='_blank'>Add New Classes</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#modifyfunction' target='_blank'>Modify Functions</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#restfulapi' target='_blank'>RESTful APIs</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#contributors' target='_blank'>Codeathon Contributors</a></li>",t+="</ul>",t+="</li>"),t+=s+e.htmlCls.baseUrl+"icn3d/docs/icn3d_help.html' target='_blank'>Help Doc "+e.htmlCls.wifiStr+"</a></li>",t+="<li>-</li>",t+="<li><span>Transform Hints</span>",t+="<ul>",t+="<li><span>Rotate</span>",t+="<ul>",t+="<li>Left Mouse (Click & Drag)</li>",t+="<li>Key l: Left</li>",t+="<li>Key j: Right</li>",t+="<li>Key i: Up</li>",t+="<li>Key m: Down</li>",t+="<li>Shift + Key l: Left 90&deg;</li>",t+="<li>Shift + Key j: Right 90&deg;</li>",t+="<li>Shift + Key i: Up 90&deg;</li>",t+="<li>Shift + Key m: Down 90&deg;</li>",t+="</ul>",t+="</li>",t+="<li><span>Zoom</span>",t+="<ul>",t+="<li>Middle Mouse <br>(Pinch & Spread)</li>",t+="<li>Key z: Zoom in</li>",t+="<li>Key x: Zoom out</li>",t+="</ul>",t+="</li>",t+="<li><span>Translate</span>",t+="<ul>",t+="<li>Right Mouse <br>(Two Finger Click & Drag)</li>",t+="</ul>",t+="</li>",t+="</ul>",t+="</li>",e.cfg.simplemenu||(t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#HowToUseStep5' target='_blank'>Selection Hints</a></li>"),t+="<li><br/></li>",t+="</ul>",t}hideMenu(){let e=this.icn3dui;e.bNode||(void 0!==$("#"+e.pre+"mnlist")[0]&&($("#"+e.pre+"mnlist")[0].style.display="none"),void 0!==$("#"+e.pre+"mnLogSection")[0]&&($("#"+e.pre+"mnLogSection")[0].style.display="none"),void 0!==$("#"+e.pre+"cmdlog")[0]&&($("#"+e.pre+"cmdlog")[0].style.display="none"),$("#"+e.pre+"title")[0].style.margin="10px 0 0 10px")}showMenu(){let e=this.icn3dui;e.bNode||(void 0!==$("#"+e.pre+"mnlist")[0]&&($("#"+e.pre+"mnlist")[0].style.display="block"),void 0!==$("#"+e.pre+"mnLogSection")[0]&&($("#"+e.pre+"mnLogSection")[0].style.display="block"),void 0!==$("#"+e.pre+"cmdlog")[0]&&($("#"+e.pre+"cmdlog")[0].style.display="block"))}}class tt{constructor(e){this.icn3dui=e}openDlg(e,t){let s=this.icn3dui;s.icn3d,s.bNode||(e=s.pre+e,s.cfg.notebook?this.openDlgNotebook(e,t):this.openDlgRegular(e,t),s.htmlCls.themecolor||(s.htmlCls.themecolor="blue"),s.htmlCls.setMenuCls.setTheme(s.htmlCls.themecolor))}addSaveButton(e){let t=this.icn3dui;t.icn3d,t.bNode||void 0!==this.dialogHashSave&&this.dialogHashSave.hasOwnProperty(e)||($("#"+e).parent().children(".ui-dialog-titlebar").append("<span pid='"+e+"' class='icn3d-saveicon ui-icon ui-icon-disk' title='Save as an HTML file'></span>"),void 0===this.dialogHashSave&&(this.dialogHashSave={}),this.dialogHashSave[e]=1)}addHideButton(e){let t=this.icn3dui;t.icn3d,t.bNode||void 0!==this.dialogHashHide&&this.dialogHashHide.hasOwnProperty(e)||($("#"+e).parent().children(".ui-dialog-titlebar").append("<span pid='"+e+"' class='icn3d-hideicon ui-icon ui-icon-arrowthick-2-ne-sw' title='Resize the window'></span>"),void 0===this.dialogHashHide&&(this.dialogHashHide={}),this.dialogHashHide[e]=1)}getDialogStatus(){let e=this.icn3dui;if(e.icn3d,e.bNode)return;let t={},s=$("#"+e.pre+"dl_selectannotations").hasClass("ui-dialog-content"),i=$("#"+e.pre+"dl_graph").hasClass("ui-dialog-content"),l=$("#"+e.pre+"dl_linegraph").hasClass("ui-dialog-content"),n=$("#"+e.pre+"dl_scatterplot").hasClass("ui-dialog-content"),r=$("#"+e.pre+"dl_contactmap").hasClass("ui-dialog-content"),o=$("#"+e.pre+"dl_alignerrormap").hasClass("ui-dialog-content"),a=$("#"+e.pre+"dl_interactionsorted").hasClass("ui-dialog-content"),d=$("#"+e.pre+"dl_alignment").hasClass("ui-dialog-content"),c=$("#"+e.pre+"dl_2ddgm").hasClass("ui-dialog-content"),h=$("#"+e.pre+"dl_2dctn").hasClass("ui-dialog-content"),m=$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content");return t.bSelectannotationsInit2=!1,t.bGraph2=!1,t.bLineGraph2=!1,t.bScatterplot2=!1,t.bTable2=!1,t.bAlignmentInit2=!1,t.bTwoddgmInit2=!1,t.bTwodctnInit2=!1,t.bSetsInit2=!1,s&&(t.bSelectannotationsInit2=$("#"+e.pre+"dl_selectannotations").dialog("isOpen")),i&&(t.bGraph2=$("#"+e.pre+"dl_graph").dialog("isOpen")),l&&(t.bLineGraph2=$("#"+e.pre+"dl_linegraph").dialog("isOpen")),n&&(t.bScatterplot2=$("#"+e.pre+"dl_scatterplot").dialog("isOpen")),r&&(t.bContactmap2=$("#"+e.pre+"dl_contactmap").dialog("isOpen")),o&&(t.bAlignerror2=$("#"+e.pre+"dl_alignerrormap").dialog("isOpen")),a&&(t.bTable2=$("#"+e.pre+"dl_interactionsorted").dialog("isOpen")),d&&(t.bAlignmentInit2=$("#"+e.pre+"dl_alignment").dialog("isOpen")),c&&(t.bTwoddgmInit2=$("#"+e.pre+"dl_2ddgm").dialog("isOpen")),h&&(t.bTwodctnInit2=$("#"+e.pre+"dl_2dctn").dialog("isOpen")),m&&(t.bSetsInit2=$("#"+e.pre+"dl_definedsets").dialog("isOpen")),t}openDlgHalfWindow(e,t,s,i){let l=this.icn3dui,n=l.icn3d;if(l.bNode)return;let r=this,o=l.htmlCls.width2d+20;n.resizeCanvasCls.resizeCanvas(l.htmlCls.WIDTH-s,l.htmlCls.HEIGHT,i);let a,d=l.htmlCls.HEIGHT,c=s;a=!l.cfg.showmenu||l.utilsCls.isMobile()||l.cfg.mobilemenu?{my:"left top",at:"right top",of:"#"+l.pre+"viewer",collision:"none"}:{my:"left top",at:"right top+40",of:"#"+l.pre+"viewer",collision:"none"},l.cfg.resize=!1,window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:d,width:c,modal:!1,position:a,close:function(t){let s=r.getDialogStatus();if(!((e!==l.pre+"dl_selectannotations"||s.bAlignmentInit2||s.bGraph2||s.bTable2||s.bLineGraph2||s.bScatterplot2||s.bContactmap2||s.bAlignerrormap2)&&(e!==l.pre+"dl_graph"||s.bSelectannotationsInit2||s.bAlignmentInit2||s.bTable2||s.bLineGraph2||s.bScatterplot2||s.bContactmap2||s.bAlignerrormap2)&&(e!==l.pre+"dl_alignment"||s.bSelectannotationsInit2||s.bGraph2||s.bTable2||s.bLineGraph2||s.bScatterplot2||s.bContactmap2||s.bAlignerrormap2)&&(e!==l.pre+"dl_interactionsorted"||s.bSelectannotationsInit2||s.bGraph2||s.bAlignmentInit2||s.bLineGraph2||s.bScatterplot2||s.bContactmap2||s.bAlignerrormap2)&&(e!==l.pre+"dl_linegraph"||s.bSelectannotationsInit2||s.bGraph2||s.bAlignmentInit2||s.bTable2||s.bScatterplot2||s.bContactmap2||s.bAlignerrormap2)&&(e!==l.pre+"dl_scatterplot"||s.bSelectannotationsInit2||s.bGraph2||s.bAlignmentInit2||s.bTable2||s.bLineGraph2||s.bContactmap2||s.bAlignerrormap2)&&(e!==l.pre+"dl_contactmap"||s.bSelectannotationsInit2||s.bGraph2||s.bAlignmentInit2||s.bTable2||s.bLineGraph2||s.bScatterplot2||s.bAlignerrormap2)&&(e!==l.pre+"dl_alignerrormap"||s.bSelectannotationsInit2||s.bGraph2||s.bAlignmentInit2||s.bTable2||s.bLineGraph2||s.bScatterplot2||s.bContactmap2)))if(s.bTwoddgmInit2||s.bTwodctnInit2||s.bSetsInit2){let e=l.utilsCls.isMobile()?l.htmlCls.WIDTH:l.htmlCls.WIDTH-o;n.resizeCanvasCls.resizeCanvas(e,l.htmlCls.HEIGHT,!0),s.bTwoddgmInit2&&r.openDlg2Ddgm(l.pre+"dl_2ddgm",void 0,s.bSetsInit2),s.bTwodctnInit2&&r.openDlg2Ddgm(l.pre+"dl_2dctn",void 0,s.bSetsInit2),s.bSetsInit2&&r.openDlg2Ddgm(l.pre+"dl_definedsets")}else n.resizeCanvasCls.resizeCanvas(l.htmlCls.WIDTH,l.htmlCls.HEIGHT,!0)},resize:function(t){if(e==l.pre+"dl_selectannotations")n.annotationCls.hideFixedTitle();else if(e==l.pre+"dl_graph"){let t=$("#"+e).width(),s=$("#"+e).height();d3.select("#"+l.svgid).attr("width",t).attr("height",s)}else if(e==l.pre+"dl_linegraph"||e==l.pre+"dl_scatterplot"||e==l.pre+"dl_contactmap"||e==l.pre+"dl_alignerrormap"){let t=status.bTwoddgmInit2||status.bSetsInit2?(l.htmlCls.WIDTH-o)/2:l.htmlCls.WIDTH/2,s=$("#"+e).width()/t;if(e==l.pre+"dl_linegraph"){let e=n.linegraphWidth*s;$("#"+l.linegraphid).attr("width",e)}else if(e==l.pre+"dl_scatterplot"){let e=n.scatterplotWidth*s;$("#"+l.scatterplotid).attr("width",e)}else if(e==l.pre+"dl_contactmap"){let e=n.contactmapWidth*s;$("#"+l.contactmapid).attr("width",e)}else if(e==l.pre+"dl_alignerrormap"){let e=n.alignerrormapWidth*s;$("#"+l.alignerrormapid).attr("width",e)}}}}),this.addSaveButton(e),this.addHideButton(e)}openDlg2Ddgm(e,t,s){let i=this.icn3dui,l=i.icn3d;if(i.bNode)return;let n,r,o=this,a=i.htmlCls.width2d+20;e===i.pre+"dl_definedsets"?(n="right top",r="Select sets"):e!==i.pre+"dl_2ddgm"&&e!==i.pre+"dl_2dctn"||(n=s?"right top+240":"right top",r=e===i.pre+"dl_2ddgm"?"2D Diagram":"2D Cartoon");let d={my:"left top+"+i.htmlCls.MENU_HEIGHT,at:n,of:"#"+i.pre+"viewer",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:r,height:"auto",width:a,modal:!1,position:d,close:function(e){let t=o.getDialogStatus();t.bSelectannotationsInit2||t.bGraph2||t.bLineGraph2||t.bScatterplot2||t.bTable2||t.bAlignmentInit2||l.resizeCanvasCls.resizeCanvas(i.htmlCls.WIDTH,i.htmlCls.HEIGHT,!0)},resize:function(t,s){e==i.pre+"dl_2dctn"&&(l.resizeRatioX=s.size.width/i.htmlCls.width2d,l.resizeRatioY=s.size.height/(i.htmlCls.width2d+70))},resizeStop:function(e,t){l.resizeRatioX=t.size.width/i.htmlCls.width2d,l.resizeRatioY=t.size.height/(i.htmlCls.width2d+70)}}),this.addSaveButton(e),this.addHideButton(e)}openDlgRegular(e,t){let s=this.icn3dui,i=s.icn3d;if(s.bNode)return;let l=400,n=150,r=s.htmlCls.width2d+20,o=this.getDialogStatus();if(e===s.pre+"dl_selectannotations"||e===s.pre+"dl_graph"||e===s.pre+"dl_linegraph"||e===s.pre+"dl_scatterplot"||e===s.pre+"dl_contactmap"||e===s.pre+"dl_alignerrormap"||e===s.pre+"dl_interactionsorted"||e===s.pre+"dl_alignment"){let a=.5*s.htmlCls.WIDTH-.5*r;if(s.htmlCls.WIDTH>=s.htmlCls.HEIGHT)this.openDlgHalfWindow(e,t,a,!0),(o.bTwoddgmInit2||o.bTwodctnInit2||o.bSetsInit2)&&(i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH-a-r,s.htmlCls.HEIGHT,!0),o.bTwoddgmInit2&&this.openDlg2Ddgm(s.pre+"dl_2ddgm",void 0,o.bSetsInit2),o.bTwodctnInit2&&this.openDlg2Ddgm(s.pre+"dl_2dctn",void 0,o.bSetsInit2),o.bSetsInit2&&this.openDlg2Ddgm(s.pre+"dl_definedsets"));else{i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH,.5*s.htmlCls.HEIGHT,!0),n=.5*s.htmlCls.HEIGHT,l=s.htmlCls.WIDTH;let a={my:"left top",at:"left bottom+32",of:"#"+s.pre+"canvas",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:n,width:l,modal:!1,position:a,close:function(t){if(!((e!==s.pre+"dl_selectannotations"||o.bAlignmentInit2||o.bGraph2||o.bTable2||o.bLineGraph2||o.bScatterplot2||o.bContactmap2||o.bAlignerrormap2)&&(e!==s.pre+"dl_graph"||o.bSelectannotationsInit2||o.bAlignmentInit2||o.bTable2||o.bLineGraph2||o.bScatterplot2||o.bContactmap2||o.bAlignerrormap2)&&(e!==s.pre+"dl_alignment"||o.bSelectannotationsInit2||o.bGraph2||o.bTable2||o.bLineGraph2||o.bScatterplot2||o.bContactmap2||o.bAlignerrormap2)&&(e!==s.pre+"dl_interactionsorted"||o.bSelectannotationsInit2||o.bGraph2||o.bAlignmentInit2||o.bLineGraph2||o.bScatterplot2||o.bContactmap2||o.bAlignerrormap2)&&(e!==s.pre+"dl_linegraph"||o.bSelectannotationsInit2||o.bGraph2||o.bAlignmentInit2||o.bTable2||o.bScatterplot2||o.bContactmap2||o.bAlignerrormap2)&&(e!==s.pre+"dl_scatterplot"||o.bSelectannotationsInit2||o.bGraph2||o.bAlignmentInit2||o.bTable2||o.bLineGraph2||o.bContactmap2||o.bAlignerrormap2)&&(e!==s.pre+"dl_contactmap"||o.bSelectannotationsInit2||o.bGraph2||o.bAlignmentInit2||o.bTable2||o.bLineGraph2||o.bScatterplot2||o.bAlignerrormap2)&&(e!==s.pre+"dl_alignerrormap"||o.bSelectannotationsInit2||o.bGraph2||o.bAlignmentInit2||o.bTable2||o.bLineGraph2||o.bScatterplot2||o.bContactmap2)))if(o.bTwoddgmInit2||o.bTwodctnInit2||o.bSetsInit2){let e=s.utilsCls.isMobile()?s.htmlCls.WIDTH:s.htmlCls.WIDTH-r;i.resizeCanvasCls.resizeCanvas(e,s.htmlCls.HEIGHT,!0),o.bTwoddgmInit2&&thisClass.openDlg2Ddgm(s.pre+"dl_2ddgm",void 0,o.bSetsInit2),o.bTwodctnInit2&&thisClass.openDlg2Ddgm(s.pre+"dl_2dctn",void 0,o.bSetsInit2),o.bSetsInit2&&thisClass.openDlg2Ddgm(s.pre+"dl_definedsets")}else i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH,s.htmlCls.HEIGHT,!0)},resize:function(t){if(e==s.pre+"dl_selectannotations")i.annotationCls.hideFixedTitle();else if(e==s.pre+"dl_graph"){let t=$("#"+e).width(),i=$("#"+e).height();d3.select("#"+s.svgid).attr("width",t).attr("height",i)}else if(e==s.pre+"dl_linegraph"||e==s.pre+"dl_scatterplot"||e==s.pre+"dl_contactmap"||e==s.pre+"dl_alignerrormap"){let t=o.bTwoddgmInit2||o.bSetsInit2?(s.htmlCls.WIDTH-r)/2:s.htmlCls.WIDTH/2,l=$("#"+e).width()/t;if(e==s.pre+"dl_linegraph"){let e=i.linegraphWidth*l;$("#"+s.linegraphid).attr("width",e)}else if(e==s.pre+"dl_scatterplot"){let e=i.scatterplotWidth*l;$("#"+s.scatterplotid).attr("width",e)}else if(e==s.pre+"dl_contactmap"){let e=i.contactmapWidth*l;$("#"+s.contactmapid).attr("width",e)}else if(e==s.pre+"dl_alignerrormap"){let e=i.alignerrormapWidth*l;$("#"+s.alignerrormapid).attr("width",e)}}}}),this.addSaveButton(e),this.addHideButton(e)}}else if(e===s.pre+"dl_2ddgm"||e===s.pre+"dl_2dctn"){let t=0;if(s.htmlCls.WIDTH>=s.htmlCls.HEIGHT)(o.bSelectannotationsInit2||o.bGraph2||o.bLineGraph2||o.bScatterplot2||o.bTable2||o.bAlignmentInit2)&&(t=.5*s.htmlCls.WIDTH-.5*r),i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH-t-r,s.htmlCls.HEIGHT,!0),this.openDlg2Ddgm(e,void 0,o.bSetsInit2);else{let t=s.utilsCls.isMobile()?s.htmlCls.WIDTH:s.htmlCls.WIDTH-r;i.resizeCanvasCls.resizeCanvas(t,.5*s.htmlCls.HEIGHT,!0),this.openDlg2Ddgm(e,.5*s.htmlCls.HEIGHT),this.openDlg2Ddgm(e,.5*s.htmlCls.HEIGHT,o.bSetsInit2)}}else{let a;if(n="auto",l="auto",e===s.pre+"dl_addtrack"&&(l="50%"),e===s.pre+"dl_definedsets"){let t=0;if(s.htmlCls.WIDTH>=s.htmlCls.HEIGHT)(o.bSelectannotationsInit2||o.bGraph2||o.bLineGraph2||o.bScatterplot2||o.bTable2||o.bAlignmentInit2)&&(t=.5*s.htmlCls.WIDTH-.5*r),i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH-t-r,s.htmlCls.HEIGHT,!0),this.openDlg2Ddgm(e),o.bTwoddgmInit2&&this.openDlg2Ddgm(s.pre+"dl_2ddgm",void 0,!0),o.bTwodctnInit2&&this.openDlg2Ddgm(s.pre+"dl_2dctn",void 0,!0);else{let t=s.utilsCls.isMobile()?s.htmlCls.WIDTH:s.htmlCls.WIDTH-r;i.resizeCanvasCls.resizeCanvas(t,.5*s.htmlCls.HEIGHT,!0),this.openDlg2Ddgm(e,.5*s.htmlCls.HEIGHT),o.bTwoddgmInit2&&this.openDlg2Ddgm(s.pre+"dl_2ddgm",.5*s.htmlCls.HEIGHT,!0),o.bTwodctnInit2&&this.openDlg2Ddgm(s.pre+"dl_2dctn",.5*s.htmlCls.HEIGHT,!0)}}else s.utilsCls.isMobile()?a={my:"left top",at:"left bottom-50",of:"#"+s.pre+"canvas",collision:"none"}:e===s.pre+"dl_allinteraction"||e===s.pre+"dl_buriedarea"?(a={my:"right top",at:"right top+50",of:"#"+i.divid,collision:"none"},l=700,n=500):a=e===s.pre+"dl_rmsd"?{my:"right top",at:"right top",of:"#"+s.pre+"canvas",collision:"none"}:e===s.pre+"dl_legend"?{my:"right top",at:"right-20 top+60",of:"#"+s.pre+"canvas",collision:"none"}:e===s.pre+"dl_symd"?{my:"left top",at:"right-200 bottom-200",of:"#"+s.pre+"canvas",collision:"none"}:s.cfg.align?{my:"left top",at:"left top+90",of:"#"+s.pre+"canvas",collision:"none"}:{my:"left top",at:"left top+50",of:"#"+s.pre+"canvas",collision:"none"},window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:n,width:l,modal:!1,position:a}),this.addSaveButton(e),this.addHideButton(e)}$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")}openDlgNotebook(e,t){let s=this.icn3dui,i=s.icn3d;if(s.bNode)return;let l=400,n=150,r=s.htmlCls.width2d+20;e===s.pre+"dl_selectannotations"||e===s.pre+"dl_graph"||e===s.pre+"dl_linegraph"||e===s.pre+"dl_scatterplot"||e===s.pre+"dl_contactmap"||e===s.pre+"dl_alignerrormap"||e===s.pre+"dl_interactionsorted"||e===s.pre+"dl_alignment"?($("#"+e).show(),n=.5*s.htmlCls.HEIGHT,l=s.htmlCls.WIDTH,$("#"+e).width(l),$("#"+e).height(n),$("#"+e).resize((function(t){let l=s.htmlCls.WIDTH/2,n=$("#"+e).width()/l;if(e==s.pre+"dl_selectannotations")i.annotationCls.hideFixedTitle();else if(e==s.pre+"dl_graph"){let t=$("#"+e).width(),i=$("#"+e).height();d3.select("#"+s.svgid).attr("width",t).attr("height",i)}else if(e==s.pre+"dl_linegraph"){let e=i.linegraphWidth*n;$("#"+s.linegraphid).attr("width",e)}else if(e==s.pre+"dl_scatterplot"){let e=i.scatterplotWidth*n;$("#"+s.scatterplotid).attr("width",e)}else if(e==s.pre+"dl_contactmap"){let e=i.contactmapWidth*n;$("#"+s.contactmapid).attr("width",e)}else if(e==s.pre+"dl_alignerrormap"){let e=i.alignerrormapWidth*n;$("#"+s.alignerrormapid).attr("width",e)}}))):(i.bRender&&$("#"+e).show(),n="auto",l="auto",e===s.pre+"dl_addtrack"?l="50%":e===s.pre+"dl_2ddgm"||e===s.pre+"dl_2dctn"||e===s.pre+"dl_definedsets"?l=r:e!==s.pre+"dl_allinteraction"&&e!==s.pre+"dl_buriedarea"||(l=700,n=500),$("#"+e).width(l),$("#"+e).height(n))}}class st{constructor(e){this.icn3dui=e}setCustomDialogs(){var e=this.icn3dui;if(e.icn3d,e.bNode)return"";return""}setDialogs(){let e=this.icn3dui,t=e.icn3d;if(e.bNode)return"";let s="";e.htmlCls.optionStr="<option value=",s+="\x3c!-- dialog will not be part of the form --\x3e";let i=e.cfg.notebook?"":"icn3d-hidden",l=e.cfg.notebook?"icn3d-hidden":"";s+=e.htmlCls.divStr+"alldialogs' class='"+i+" icn3d-dialog'>",s+=e.htmlCls.divStr+"dl_2ddgm' class='"+l+" icn3d-dl_2ddgm' style='background-color:white'>",s+="</div>",s+=e.htmlCls.divStr+"dl_2dctn' class='"+l+" icn3d-dl_2dctn' style='background-color:white'>",e.svgid_ct=e.pre+"icn3d_cartoon";let n='<button class="icn3d-commandTitle" style="-webkit-appearance:button; height:24px;background-color:#DDD;" id="',r="icn3d-node-text";s+=e.htmlCls.divNowrapStr+"Dynamically generated for selected residues. <br>Nodes can be dragged or clicked.</div>",s+=e.htmlCls.divNowrapStr+n+e.svgid_ct+'_svg">SVG</button>'+e.htmlCls.space2,s+=n+e.svgid_ct+'_png">PNG</button>'+e.htmlCls.space2,s+=n+e.svgid_ct+'_json">JSON</button><br>',s+="<b>Label</b>: <select id='"+e.svgid_ct+"_label'>",s+=e.htmlCls.optionStr+"'"+r+"0'>No</option>",s+=e.htmlCls.optionStr+"'"+r+"4'>4px</option>",s+=e.htmlCls.optionStr+"'"+r+"8' selected>8px</option>",s+=e.htmlCls.optionStr+"'"+r+"12'>12px</option>",s+=e.htmlCls.optionStr+"'"+r+"16'>16px</option>",s+=e.htmlCls.optionStr+"'"+r+"24'>24px</option>",s+=e.htmlCls.optionStr+"'"+r+"32'>32px</option>",s+="</select>",s+="</div>",s+="<svg id='"+e.svgid_ct+"' viewBox='0,0,"+e.htmlCls.width2d+","+e.htmlCls.width2d+"'>",s+="</svg>",s+="</div>",s+=e.htmlCls.divStr+"dl_alignment' class='"+l+"' style='background-color:white;'>",s+=e.htmlCls.divStr+"symd_info'></div>",s+=e.htmlCls.divStr+"alignseqguide_wrapper'><br>"+e.htmlCls.setHtmlCls.setAlignSequenceGuide()+"</div>",s+=e.htmlCls.divStr+"dl_sequence2' class='icn3d-dl_sequence'>",s+="</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_definedsets' class='"+l+"'>",s+=e.htmlCls.divStr+"dl_setsmenu'>",s+="<b>Defined Sets:</b> <br/>",s+="<select id='"+e.pre+"atomsCustom' multiple size='6' style='min-width:130px;'>",s+="</select>",s+="<div style='margin: 6px 0 6px 0;'>"+e.htmlCls.buttonStr+"deletesets'><b>Delete Selected Sets</b></button></div>",s+='        <b>Set Operations</b>: <div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_command_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'dl_command_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',s+="</div>",s+=e.htmlCls.divStr+"dl_command' style='display:none;'>",s+=e.htmlCls.divStr+"dl_setoperations'>",s+="<label for='"+e.pre+"setOr'>"+e.htmlCls.inputRadioStr+"name='"+e.pre+"setOperation' id='"+e.pre+"setOr' checked> Union(or) </label><br/>",s+="<label for='"+e.pre+"setAnd'>"+e.htmlCls.inputRadioStr+"name='"+e.pre+"setOperation' id='"+e.pre+"setAnd'> Intersection(and) </label><br/>",s+="<label for='"+e.pre+"setNot'>"+e.htmlCls.inputRadioStr+"name='"+e.pre+"setOperation' id='"+e.pre+"setNot'> Exclusion(not) </label>",s+="</div><br>",s+=e.htmlCls.setHtmlCls.setAdvanced(),s+="</div>",s+="</div>",s+=e.htmlCls.setHtmlCls.setAdvanced(2),s+=e.htmlCls.divStr+"dl_vastplus' class='"+l+"' style='max-width:500px'>",s+="Note: <b>VAST+</b> finds other macromolecular structures that have a similar biological unit. To do this, VAST+ takes into consideration the complete set of 3D domains that VAST identified within a query structure, throughout all of its component protein molecules, and finds other macromolecular structures that have a similar set of proteins/3D domains.<br><br>",s+="PDB ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"vastpluspdbid' value='1HHO' size=8><br>",s+=e.htmlCls.buttonStr+"reload_vastplus'>VAST+</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_vast' class='"+l+"' style='max-width:500px'>",s+="Note: <b>VAST</b> identifies 3D domains (substructures) within each protein structure in the Molecular Modeling Database (MMDB), and then finds other protein structures that have one or more similar 3D domains, using purely geometric criteria. You have two ways to do a VAST search.<br><br>",s+="<b>Optione 1</b>, search with PDB ID and chain name:<br>",s+="PDB ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"vastpdbid' value='1HHO' size=8> &nbsp;&nbsp;",s+="Chain Name: "+e.htmlCls.inputTextStr+"id='"+e.pre+"vastchainid' value='A' size=8> <br>",s+=e.htmlCls.buttonStr+"reload_vast'>VAST</button><br><br>",s+="<b>Optione 2</b>, search with a PDB file:<br>",s+='<form method=post enctype=multipart/form-data action="https://www.ncbi.nlm.nih.gov/Structure/vast/VSMmdb.cgi" name="newvs" target="_blank">',s+="PDB File: "+e.htmlCls.inputFileStr+" name='pdbfile' size=8><br>",s+="Searching against: <input type='radio' name='dataset' value='Non-redundant subset' checked> Medium-redundancy Subset of PDB <a href='https://www.ncbi.nlm.nih.gov/Structure/VAST/vasthelp.html#VASTNR' title='Medium-redundancy Subset' target='_blank'>?</a> <input type='radio' name='dataset' value='All'>All of PDB <br>",s+='<input type="submit" name="cmdVSMmdb" value="Submit"></input>',s+="</form>",s+="</div>",s+=e.htmlCls.divStr+"dl_foldseek' class='"+l+"' style='max-width:500px'>",s+='Note: You can search similar PDB or AlphaFold structures for any structure at the fast <a href="https://search.foldseek.com/search" target="_blank">Foldseek</a> web server. <br><br>Once you see the structure neighbors, you can view the alignment in iCn3D by inputing a list of chain IDs below. <br><br>The PDB chain IDs are the same as the record names such as "1hho_A". The AlphaFold chain IDs are the UniProt ID plus "_A". For example, the UniProt ID for the record name "AF-P69905-F1-model_v2" is "P69905".<br><br>',s+="Chain ID List: "+e.htmlCls.inputTextStr+"id='"+e.pre+"foldseekchainids' value='P69905_A,P01942_A,1HHO_A' size=30> ",s+=e.htmlCls.buttonStr+"reload_foldseek'>Align</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_mmtfid' class='"+l+"'>",s+="MMTF ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"mmtfid' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_mmtf'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_pdbid' class='"+l+"'>",s+="PDB ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"pdbid' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_pdb'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_afid' class='"+l+"'>",s+="Note: AlphaFold produces a per-residue confidence score (pLDDT) between 0 and 100:<br>",s+=e.htmlCls.clickMenuCls.setAlphaFoldLegend()+"<br>";let o=e.cfg.afid?e.cfg.afid:"Q76EI6";s+="<a href='https://alphafold.ebi.ac.uk/' target='_blank'>AlphaFold Uniprot</a> ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"afid' value='"+o+"' size=10><br><br>",s+=e.htmlCls.buttonStr+"reload_af'>Load Structure</button>"+e.htmlCls.buttonStr+"reload_afmap' style='margin-left:30px'>Load Half PAE Map</button>"+e.htmlCls.buttonStr+"reload_afmapfull' style='margin-left:30px'>Load Full PAE Map (slow)</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_opmid' class='"+l+"'>",s+="<a href='https://opm.phar.umich.edu' target='_blank'>Orientations of Proteins in Membranes(OPM)</a> PDB ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"opmid' value='6JXR' size=8> ",s+=e.htmlCls.buttonStr+"reload_opm'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_pdbfile' class='"+l+"'>",s+='Note: Several PDB files could be concatenated into a single PDB file. Use the line "ENDMDL" to separate PDB files.<br><br>',s+="PDB File: "+e.htmlCls.inputFileStr+" id='"+e.pre+"pdbfile' size=8> ",s+=e.htmlCls.buttonStr+"reload_pdbfile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_pdbfile_app' class='"+l+"'>",s+="Multiple PDB Files: <input type='file' multiple id='"+e.pre+"pdbfile_app' size=8> ",s+=e.htmlCls.buttonStr+"reload_pdbfile_app'>Append</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_rescolorfile' class='"+l+"'>",s+='<div style="width:450px;">The custom JSON file on residue colors has the following format for proteins("ALA" and "ARG") and nucleotides("G" and "A"):<br>',s+='{"ALA":"#C8C8C8", "ARG":"#145AFF", ..., "G":"#008000", "A":"#6080FF", ...}</div><br>',s+="Residue Color File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"rescolorfile' size=8> ",s+=e.htmlCls.buttonStr+"reload_rescolorfile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_customcolor' class='"+l+"'>",s+=" <input type='hidden' id='"+e.pre+"customcolor_chainid' value=''>",s+='<div style="width:450px;">The custom file for the structure has two columns separated by space or tab: ',s+='residue number, and score in the range of 0-100. If you click "Apply Custom Color" button, ',s+='the scores 0, 50 and 100 correspond to the three colors specified below. If you click "Apply Custom Tube", ',s+='the selected residues will be displayed in a style similar to "B-factor Tube".</div><br>',s+="Custom File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"cstcolorfile' size=8> <br><br>",s+="1. "+e.htmlCls.buttonStr+"reload_customcolorfile'>Apply Custom Color</button>"+e.htmlCls.buttonStr+"remove_legend' style='margin-left:30px;'>Remove Legend</button><br>",s+="<span style='margin-left:15px'>Score to Color: 0:</span> <select id='"+e.pre+"startColor'>",s+=e.htmlCls.optionStr+"'red'>Red</option>",s+=e.htmlCls.optionStr+"'green'>Green</option>",s+=e.htmlCls.optionStr+"'blue' selected>Blue</option>",s+="</select>",s+="<span style='margin-left:30px'>50</span>: <select id='"+e.pre+"midColor'>",s+=e.htmlCls.optionStr+"'white' selected>White</option>",s+=e.htmlCls.optionStr+"'black'>Black</option>",s+="</select>",s+="<span style='margin-left:30px'>100</span>: <select id='"+e.pre+"endColor'>",s+=e.htmlCls.optionStr+"'red' selected>Red</option>",s+=e.htmlCls.optionStr+"'green'>Green</option>",s+=e.htmlCls.optionStr+"'blue'>Blue</option>",s+="</select><br>",s+="or<br><br>",s+="2. "+e.htmlCls.buttonStr+"reload_customtubefile'>Apply Custom Tube</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_align' class='"+l+"'>",s+="Enter the PDB IDs or MMDB IDs of two structures that have been found to be similar by <A HREF=' "+e.htmlCls.baseUrl+"vastplus/vastplus.cgi'>VAST+</A> : <br/><br/>ID1: "+e.htmlCls.inputTextStr+"id='"+e.pre+"alignid1' value='1HHO' size=8>"+e.htmlCls.space3+e.htmlCls.space3+"ID2: "+e.htmlCls.inputTextStr+"id='"+e.pre+"alignid2' value='4N7N' size=8><br/><br/>",s+=e.htmlCls.buttonStr+"reload_align_ori'>All Matching Molecules Superposed</button>"+e.htmlCls.space3+e.htmlCls.buttonStr+"reload_align_refined'>Invariant Substructure Superposed</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_alignaf' class='"+l+"'>",s+="Enter two <a href='https://alphafold.ebi.ac.uk/' target='_blank'>AlphaFold Uniprot</a> IDs: <br/><br/>ID1: "+e.htmlCls.inputTextStr+"id='"+e.pre+"alignafid1' value='P41327' size=8>"+e.htmlCls.space3+e.htmlCls.space3+"ID2: "+e.htmlCls.inputTextStr+"id='"+e.pre+"alignafid2' value='P41331' size=8><br/><br/>",s+=e.htmlCls.buttonStr+"reload_alignaf'>Align</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_chainalign' class='"+l+"'>",s+="<div style='width:550px'>",s+="All chains will be aligned to the first chain in the comma-separated chain IDs. Each chain ID has the form of PDBID_chain (e.g., 1HHO_A, case sensitive) or UniprotID_chain (e.g., P69905_A for AlphaFold structures).<br/><br/>",s+="<b>Chain IDs</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"chainalignids' value='P69905_A,P01942_A,1HHO_A' size=50><br/><br/>",s+="<b>Optional 1</b>, full chains are used for structure alignment<br/><br/>",s+="<b>Optional 2</b>, sequence alignment (followed by structure alignemnt) based on residue numbers in the First/Master chain: <br>"+e.htmlCls.inputTextStr+"id='"+e.pre+"resalignids' placeholder='1,5,10-50' size=50><br/><br/>",s+='<b>Optional 3</b>, predefined alignment with the first chain as the master. The rest chains are aligned to the master chain. Each alignment is defined as " | "-separated residue lists in one line. "10-50" means a range of residues from 10 to 50.<br><textarea id=\''+e.pre+"predefinedres' rows='5' style='width: 100%; height: "+e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;' placeholder='1,5,10-50 | 1,5,10-50     \n2,6,11-51 | 1,5,10-50'></textarea><br/><br/>",s+=e.htmlCls.buttonStr+"reload_chainalign_asym'>Align Asymmetric Unit</button>"+e.htmlCls.buttonStr+"reload_chainalign' style='margin-left:30px'>Align Biological Unit</button><br/><br/>",s+='(Note: To align chains in custom PDB files, you could load them in "File > Open File > PDB Files (appendable)" and click "Analysis > Defined Sets". Finally select multiple chains in Defined Sets and click "File > Realign Selection".)<br><br>',s+="</div></div>",s+=e.htmlCls.divStr+"dl_mutation' class='"+l+"'>",s+="<div style='width:500px'>",s+='Please specify the mutations with a comma separated mutation list. Each mutation can be specified as "[PDB ID]_[Chain ID]_[Residue Number]_[One Letter Mutatnt Residue]". E.g., the mutation of N501Y in the E chain of PDB 6M0J can be specified as "6M0J_E_501_Y". <br/><br/>',s+="<div style='display:inline-block; width:110px'>Mutations: </div>"+e.htmlCls.inputTextStr+"id='"+e.pre+"mutationids' value='6M0J_E_484_K,6M0J_E_501_Y,6M0J_E_417_N' size=50><br/><br/>",s+="<b>Data Source</b>: <select id='"+e.pre+"idsource'>",s+="<option value='mmdbid' selected>PDB ID</option>",s+="<option value='afid'>AlphaFold UniProt ID</option>",s+="</select><br/><br/>",s+=e.htmlCls.buttonStr+"reload_mutation_3d' title='Show the mutations in 3D using the scap program'>3D with scap</button>",s+=e.htmlCls.buttonStr+"reload_mutation_inter' style='margin-left:20px' title='Show the mutations in 3D and the change of interactions'>Interactions</button>",s+=e.htmlCls.buttonStr+"reload_mutation_pdb' style='margin-left:20px' title='Show the mutations in 3D and export the PDB of the mutant within 10 angstrom'>PDB</button>",s+="<br/><br/></div></div>",s+=e.htmlCls.divStr+"dl_mol2file' class='"+l+"'>",s+="Mol2 File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"mol2file' size=8> ",s+=e.htmlCls.buttonStr+"reload_mol2file'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_sdffile' class='"+l+"'>",s+="SDF File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"sdffile' size=8> ",s+=e.htmlCls.buttonStr+"reload_sdffile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_xyzfile' class='"+l+"'>",s+="XYZ File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"xyzfile' size=8> ",s+=e.htmlCls.buttonStr+"reload_xyzfile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_afmapfile' class='"+l+"'>",s+="AlphaFold PAE File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"afmapfile' size=8> <br><br>",s+=e.htmlCls.buttonStr+"reload_afmapfile'>Load Half PAE Map</button>"+e.htmlCls.buttonStr+"reload_afmapfilefull' style='margin-left:30px'>Load Full PAE Map (slow)</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_urlfile' class='"+l+"'>",s+="File type: ",s+="<select id='"+e.pre+"filetype'>",s+=e.htmlCls.optionStr+"'pdb' selected>PDB</option>",s+=e.htmlCls.optionStr+"'mol2'>Mol2</option>",s+=e.htmlCls.optionStr+"'sdf'>SDF</option>",s+=e.htmlCls.optionStr+"'xyz'>XYZ</option>",s+=e.htmlCls.optionStr+"'icn3dpng'>iCn3D PNG</option>",s+="</select><br/>",s+="URL in the same host: "+e.htmlCls.inputTextStr+"id='"+e.pre+"urlfile' size=20><br/> ",s+=e.htmlCls.buttonStr+"reload_urlfile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_mmciffile' class='"+l+"'>",s+="mmCIF File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"mmciffile' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_mmciffile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_mmcifid' class='"+l+"'>",s+="mmCIF ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"mmcifid' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_mmcif'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_mmdbid' class='"+l+"' style='max-width:500px'>",s+="MMDB or PDB ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"mmdbid' value='1TUP' size=8> <br><br>",s+=e.htmlCls.buttonStr+"reload_mmdb_asym'>Load Asymmetric Unit (All Chains)</button>"+e.htmlCls.buttonStr+"reload_mmdb' style='margin-left:30px'>Load Biological Unit</button><br/><br/><br>",s+='<b>Note</b>: The "<b>biological unit</b>" is the <b>biochemically active form of a biomolecule</b>, <div style="width:20px; margin:6px 0 0 20px; display:inline-block;"><span id="'+e.pre+'asu_bu_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'asu_bu_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div>',s+=e.htmlCls.divStr+"asu_bu' style='display:none;'>",s+='which can range from a monomer (single protein molecule) to an oligomer of 100+ protein molecules.<br><br>The "<b>asymmetric unit</b>" is the raw 3D structure data resolved by X-ray crystallography, NMR, or Cryo-electron microscopy. The asymmetric unit is equivalent to the biological unit in approximately 60% of structure records. In the remaining 40% of the records, the asymmetric unit represents a portion of the biological unit that can be reconstructed using crystallographic symmetry, or it represents multiple copies of the biological unit.</div>',s+="</div>",s+=e.htmlCls.divStr+"dl_mmdbafid' class='"+l+"' style='max-width:500px'>",s+="List of MMDB, PDB, or AlphaFold UniProt IDs: "+e.htmlCls.inputTextStr+"id='"+e.pre+"mmdbafid' value='1HHO,4N7N,P69905,P01942' size=30> <br><br>",s+=e.htmlCls.buttonStr+"reload_mmdbaf_asym'>Load Asymmetric Unit (All Chains)</button>"+e.htmlCls.buttonStr+"reload_mmdbaf' style='margin-left:30px'>Load Biological Unit</button><br/><br/><br>",s+='<b>Note</b>: The "<b>biological unit</b>" is the <b>biochemically active form of a biomolecule</b>, <div style="width:20px; margin:6px 0 0 20px; display:inline-block;"><span id="'+e.pre+'asu_bu2_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'asu_bu2_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div>',s+=e.htmlCls.divStr+"asu_bu2' style='display:none;'>",s+='which can range from a monomer (single protein molecule) to an oligomer of 100+ protein molecules.<br><br>The "<b>asymmetric unit</b>" is the raw 3D structure data resolved by X-ray crystallography, NMR, or Cryo-electron microscopy. The asymmetric unit is equivalent to the biological unit in approximately 60% of structure records. In the remaining 40% of the records, the asymmetric unit represents a portion of the biological unit that can be reconstructed using crystallographic symmetry, or it represents multiple copies of the biological unit.</div>',s+="</div>",s+=e.htmlCls.divStr+"dl_blast_rep_id' style='max-width:500px;' class='"+l+"'>",s+="Enter a Sequence ID (or FASTA sequence) and the aligned Structure ID, which can be found using the <a href='https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastp&PAGE_TYPE=BlastSearch&DATABASE=pdb' target='_blank'>BLAST</a> search against the pdb database with the Sequence ID or FASTA sequence as input.<br><br> ",s+="<b>Sequence ID</b>(NCBI protein accession of a sequence): "+e.htmlCls.inputTextStr+"id='"+e.pre+"query_id' value='NP_001108451.1' size=8><br> ",s+="or FASTA sequence: <br><textarea id='"+e.pre+"query_fasta' rows='5' style='width: 100%; height: "+e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",s+="<b>Structure ID</b>(NCBI protein accession of a chain of a 3D structure): "+e.htmlCls.inputTextStr+"id='"+e.pre+"blast_rep_id' value='1TSR_A' size=8><br> ",s+=e.htmlCls.buttonStr+"reload_blast_rep_id'>Align with BLAST</button> "+e.htmlCls.wifiStr+e.htmlCls.buttonStr+"reload_alignsw' style='margin-left:30px'>Align with Smith-Waterman</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_yournote' class='"+l+"'>",s+='Your note will be saved in the HTML file when you click "File > Save Files > iCn3D PNG Image".<br><br>',s+="<textarea id='"+e.pre+"yournote' rows='5' style='width: 100%; height: "+e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;' placeholder='Enter your note here'></textarea><br>",s+=e.htmlCls.buttonStr+"applyyournote'>Save</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_gi' class='"+l+"'>",s+="Protein gi: "+e.htmlCls.inputTextStr+"id='"+e.pre+"gi' value='1310960' size=8> ",s+=e.htmlCls.buttonStr+"reload_gi'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_uniprotid' class='"+l+"'>",s+='Note: A list of structures will be shown. Click "View in iCn3D" to view each structure in 3D.<br><br>',s+="UniProt ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"uniprotid' value='P0DTC2' size=8> ",s+=e.htmlCls.buttonStr+"reload_uniprotid'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_cid' class='"+l+"'>",s+="PubChem CID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"cid' value='2244' size=8> ",s+=e.htmlCls.buttonStr+"reload_cid'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_pngimage' class='"+l+"'>",s+="iCn3D PNG image: "+e.htmlCls.inputFileStr+"id='"+e.pre+"pngimage'><br/>",s+=e.htmlCls.buttonStr+"reload_pngimage' style='margin-top: 6px;'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_state' class='"+l+"'>",s+="State file: "+e.htmlCls.inputFileStr+"id='"+e.pre+"state'><br/>",s+=e.htmlCls.buttonStr+"reload_state' style='margin-top: 6px;'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_fixedversion' style='max-width:500px' class='"+l+"'>",s+='Since January 6, 2021, you can show the original view with the archived version of iCn3D by pasting your URL below and click "Show Originial View". Note the version in the parameter "v" was used to replace "full.html" with "full_[v].html" in the URL.<br><br>',s+="Share Link URL: "+e.htmlCls.inputTextStr+"id='"+e.pre+"sharelinkurl' size=60><br>",s+=e.htmlCls.buttonStr+"reload_fixedversion'>Show Original View</button><br><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_selection' class='"+l+"'>",s+="Selection file: "+e.htmlCls.inputFileStr+"id='"+e.pre+"selectionfile'><br/>",s+=e.htmlCls.buttonStr+"reload_selectionfile' style='margin-top: 6px;'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_dsn6' class='"+l+"'>",s+="<b>Note</b>: Always load a PDB file before loading DSN6 files. <br/><br/><br/>",s+="<span style='white-space:nowrap;font-weight:bold;'>2fofc contour at: <select id='"+e.pre+"dsn6sigma2fofc'>";let a=["0","0.5","1","1.5","2","3","4","5","6","7","8","9","10"];s+=e.htmlCls.setHtmlCls.getOptionHtml(a,3),s+="</select> &sigma;</span><br/>",s+=e.htmlCls.inputFileStr+"id='"+e.pre+"dsn6file2fofc'> "+e.htmlCls.buttonStr+"reload_dsn6file2fofc' style='margin-top: 6px;'>Load</button><br><br><br/>",s+="<span style='white-space:nowrap;font-weight:bold;'>fofc contour at: <select id='"+e.pre+"dsn6sigmafofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(a,5),s+="</select> &sigma;</span><br/>",s+=e.htmlCls.inputFileStr+"id='"+e.pre+"dsn6filefofc'> "+e.htmlCls.buttonStr+"reload_dsn6filefofc' style='margin-top: 6px;'>Load</button><br><br><br>",s+=e.htmlCls.buttonStr+"elecmapNo4'>Remove Map</button><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_dsn6url' class='"+l+"'>",s+="<b>Note</b>: Always load a PDB file before loading DSN6 files. <br/><br/><br/>",s+="<span style='white-space:nowrap;font-weight:bold;'>2fofc contour at: <select id='"+e.pre+"dsn6sigmaurl2fofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(a,3),s+="</select> &sigma;</span><br/>",s+="URL in the same host: "+e.htmlCls.inputTextStr+"id='"+e.pre+"dsn6fileurl2fofc' size=20>"+e.htmlCls.space3+e.htmlCls.buttonStr+"reload_dsn6fileurl2fofc' style='margin-top: 6px;'>Load</button><br><br><br/>",s+="<span style='white-space:nowrap;font-weight:bold;'>fofc contour at: <select id='"+e.pre+"dsn6sigmaurlfofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(a,5),s+="</select> &sigma;</span><br/>",s+="URL in the same host: "+e.htmlCls.inputTextStr+"id='"+e.pre+"dsn6fileurlfofc' size=20>"+e.htmlCls.space3+e.htmlCls.buttonStr+"reload_dsn6fileurlfofc' style='margin-top: 6px;'>Load</button><br><br><br/>",s+=e.htmlCls.buttonStr+"elecmapNo5'>Remove Map</button><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_clr' class='"+l+"'>",s+="Click in the input box to use the color picker:<br><br> ",s+="Custom Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"colorcustom' value='FF0000' size=8> ",s+=e.htmlCls.buttonStr+"applycustomcolor'>Apply</button>",s+="</div>",s+=e.htmlCls.setHtmlCls.getPotentialHtml("delphi",l),s+=e.htmlCls.setHtmlCls.getPotentialHtml("local",l),s+=e.htmlCls.setHtmlCls.getPotentialHtml("url",l),s+=e.htmlCls.divStr+"dl_symmetry' class='"+l+"'><br>",s+=e.htmlCls.divNowrapStr+"Symmetry: <select id='"+e.pre+"selectSymmetry'>",s+="</select>"+e.htmlCls.space3,s+=e.htmlCls.buttonStr+"applysymmetry'>Apply</button>"+e.htmlCls.space3,s+=e.htmlCls.buttonStr+"clearsymmetry'>Clear</button></div>",s+="</div>",s+=e.htmlCls.divStr+"dl_symd' style='max-width:400px' class='"+l+"'><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_contact' class='"+l+"'>",s+="<span style='white-space:nowrap;font-weight:bold;'>Distance: <select id='"+e.pre+"contactdist'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(["4","5","6","7","8","9","10"],4),s+="</select></span>",s+="<span style='margin-left:30px; white-space:nowrap;font-weight:bold;'>Contact Type: <select id='"+e.pre+"contacttype'>",s+=e.htmlCls.optionStr+"'calpha' >between C-alpha Atoms</option>",s+=e.htmlCls.optionStr+"'cbeta' selected>between C-beta Atoms</option>",s+=e.htmlCls.optionStr+"'heavyatoms' >between Heavy Atoms</option>",s+="</select></span><br><br>",s+="<span style='white-space:nowrap;'>"+e.htmlCls.buttonStr+"applycontactmap'>Display</button></span><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_hbonds' class='"+l+"'>",s+="1. Choose interaction types and their thresholds:<br>",s+="<div class='icn3d-box'><table border=0 width=450><tr>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_hbond' checked>Hydrogen Bonds <span style='background-color:#"+e.htmlCls.hbondColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"hbondthreshold'>";let d=["3.2","3.3","3.4","3.5","3.6","3.7","3.8","3.9","4.0","4.1","4.2"];s+=e.htmlCls.setHtmlCls.getOptionHtml(d,6),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_saltbridge' checked>Salt Bridge/Ionic <span style='background-color:#"+e.htmlCls.ionicColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"saltbridgethreshold'>";let c=["3","4","5","6","7","8"];s+=e.htmlCls.setHtmlCls.getOptionHtml(c,3),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_contact' checked>Contacts/Interactions <span style='background-color:#"+e.htmlCls.contactColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"contactthreshold'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(c,1),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="</tr>",s+="<tr>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_halogen' checked>Halogen Bonds <span style='background-color:#"+e.htmlCls.halogenColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"halogenthreshold'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(d,6),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_pication' checked>&pi;-Cation <span style='background-color:#"+e.htmlCls.picationColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"picationthreshold'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(c,3),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_pistacking' checked>&pi;-Stacking <span style='background-color:#"+e.htmlCls.pistackingColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"pistackingthreshold'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(["3","4","5"],99),s+=e.htmlCls.optionStr+"'5.5' selected>5.5</option>",s+=e.htmlCls.setHtmlCls.getOptionHtml(["6","7","8"],99),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="</tr></table></div>",s+="<table border=0 width=400 cellspacing=10><tr><td>",s+=e.htmlCls.divNowrapStr+"2. Select the first set:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomHbond2' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td><td>",s+=e.htmlCls.divNowrapStr+"3. Select the second set:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomHbond' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td></tr></table>",s+="<div>4. "+e.htmlCls.buttonStr+"applyhbonds'>3D Display Interactions</button></div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"hbondWindow'>Highlight Interactions in Table</button><span style='margin-left:30px; font-wieght:bold'>Sort Interactions on</span>: "+e.htmlCls.buttonStr+"sortSet1'> Set 1</button>"+e.htmlCls.buttonStr+"sortSet2' style='margin-left:20px'>Set 2</button></div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"hbondLineGraph'>2D Interaction Network</button> to show interactions between two lines of residue nodes</div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"hbondScatterplot'>2D Interaction Map</button> to show interactions as map</div><br>",r=': </td><td><input style="margin-left:-12px" type="text" id="',s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"hbondGraph'>2D Graph(Force-Directed)</button> to show interactions with strength parameters in 0-200:</div>",s+='<div style="text-indent:1.1em"><table><tr><td>Helix or Sheet'+r+e.pre+'dist_ss" size="4" value="100"></td>',s+="<td>Coil or Nucleotide"+r+e.pre+'dist_coil" size="4" value="50"></td>',s+="<td>Disulfide Bonds"+r+e.pre+'dist_ssbond" size="4" value="50"></td></tr>',s+="<tr><td>Hydrogen Bonds"+r+e.pre+'dist_hbond" size="4" value="50"></td>',s+="<td>Salt Bridge/Ionic"+r+e.pre+'dist_ionic" size="4" value="50"></td>',s+="<td>Contacts"+r+e.pre+'dist_inter" size="4" value="25"></td></tr>',s+="<tr><td>Halogen Bonds"+r+e.pre+'dist_halogen" size="4" value="50"></td>',s+="<td>&pi;-Cation"+r+e.pre+'dist_pication" size="4" value="50"></td>',s+="<td>&pi;-Stacking"+r+e.pre+'dist_pistacking" size="4" value="50"></td></tr></table></div>',s+='<div style="text-indent:1.1em">(Note: you can also adjust thresholds at #1 to add/remove interactions.)</div><br>',s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"areaWindow'>Buried Surface Area</button></div><br>",s+="<div>5. "+e.htmlCls.buttonStr+"hbondReset'>Reset</button> and select new sets</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_realign' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+"1. Select sets below <br>or use your current selection:</div><br>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomRealign' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="<div>2. "+e.htmlCls.buttonStr+"applyRealign'>Realign by Sequence</button></div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_realignbystruct' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+"1. Select sets below <br>or use your current selection:</div><br>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomRealignByStruct' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="<div>2. "+e.htmlCls.buttonStr+"applyRealignByStruct'>Realign by Structure</button></div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_colorspectrumbysets' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+"1. Select sets below:</div><br>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomColorSpectrum' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="<div>2. "+e.htmlCls.buttonStr+"applyColorSpectrumBySets'>Spectrum Color for Sets</button></div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_colorrainbowbysets' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+"1. Select sets below:</div><br>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomColorRainbow' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="<div>2. "+e.htmlCls.buttonStr+"applyColorRainbowBySets'>Rainbow Color for Sets</button></div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_allinteraction' style='background-color:white' class='"+l+"'>",s+="</div>",s+=e.htmlCls.divStr+"dl_interactionsorted' style='background-color:white' class='"+l+"'>",s+="</div>",s+=e.htmlCls.divStr+"dl_linegraph' style='background-color:white' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+'<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_linegraphcolor_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="display:none; width:15px;" title="Expand"></span><span id="'+e.pre+'dl_linegraphcolor_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="width:15px;" title="Shrink"></span></div>',s+=e.htmlCls.space2+"Hold Ctrl key to select multiple nodes/lines.</div>",s+=e.htmlCls.divStr+"dl_linegraphcolor' style='display:block;'>",s+=e.htmlCls.setHtmlCls.setColorHints(),s+="</div><br>",e.linegraphid=e.pre+"linegraph",s+=e.htmlCls.divNowrapStr+n+e.linegraphid+'_svg">SVG</button>'+e.htmlCls.space2,s+=n+e.linegraphid+'_png">PNG</button>'+e.htmlCls.space2,s+=n+e.linegraphid+'_json">JSON</button>'+e.htmlCls.space4,s+="<b>Scale</b>: <select id='"+e.linegraphid+"_scale'>";let h=["0.1","0.2","0.4","0.6","0.8","1","2","4","6","8","10"];s+=e.htmlCls.setHtmlCls.getOptionHtml(h,5),s+="</select></div><br>",s+='<div id="'+e.pre+'linegraphDiv"></div>',s+="</div>",s+=e.htmlCls.divStr+"dl_scatterplot' style='background-color:white' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+"Hold Ctrl key to select multiple nodes."+e.htmlCls.space3,s+='<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_scatterplotcolor_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'dl_scatterplotcolor_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div></div>',s+=e.htmlCls.divStr+"dl_scatterplotcolor' style='display:none;'>",s+=e.htmlCls.setHtmlCls.setColorHints(),s+="</div>",e.scatterplotid=e.pre+"scatterplot",s+=e.htmlCls.divNowrapStr+n+e.scatterplotid+'_svg">SVG</button>'+e.htmlCls.space2,s+=n+e.scatterplotid+'_png">PNG</button>'+e.htmlCls.space2,s+=n+e.scatterplotid+'_json">JSON</button>'+e.htmlCls.space4,s+="<b>Scale</b>: <select id='"+e.scatterplotid+"_scale'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(h,5),s+="</select></div><br>",s+='<div id="'+e.pre+'scatterplotDiv"></div>',s+="</div>",s+=e.htmlCls.divStr+"dl_contactmap' style='background-color:white' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+"Hold Ctrl key to select multiple nodes."+e.htmlCls.space3+"</div>",e.contactmapid=e.pre+"contactmap",s+=e.htmlCls.divNowrapStr+n+e.contactmapid+'_svg">SVG</button>'+e.htmlCls.space2,s+=n+e.contactmapid+'_png">PNG</button>'+e.htmlCls.space2,s+=n+e.contactmapid+'_json">JSON</button>'+e.htmlCls.space4,s+="<b>Scale</b>: <select id='"+e.contactmapid+"_scale'>";let m=["0.01","0.02","0.04","0.06","0.08","0.1","0.2","0.4","0.6","0.8","1"];s+=e.htmlCls.setHtmlCls.getOptionHtml(m,10),s+="</select></div><br>",s+='<div id="'+e.pre+'contactmapDiv"></div>',s+="</div>",s+=e.htmlCls.divStr+"dl_alignerrormap' style='background-color:white' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+"Hold Ctrl key to select multiple nodes."+e.htmlCls.space3+"</div>",e.alignerrormapid=e.pre+"alignerrormap",s+=e.htmlCls.divNowrapStr+n+e.alignerrormapid+'_svg">SVG</button>'+e.htmlCls.space2,s+=n+e.alignerrormapid+'_png">PNG (slow)</button>'+e.htmlCls.space2,s+=n+e.alignerrormapid+'_json">JSON</button>'+e.htmlCls.space4,s+='<b>Scale</b>: <select id="'+e.alignerrormapid+'_scale">',s+=e.htmlCls.setHtmlCls.getOptionHtml(m,2),s+="</select></div><br>";s+="<div style='width:200px'><div style='height: 12px; border: 1px solid #000; background: linear-gradient(to right, #004d00 0%, #FFFFFF 100%);'></div>",s+="<table width='100%' border='0' cellspacing='0' cellpadding='0'><tr><td width='15%'>0</td><td width='15%'>5</td><td width='15%'>10</td><td width='15%'>15</td><td width='15%'>20</td><td width='15%'>25</td><td>30</td></tr><tr><td colspan='7' align='center'>Expected position error (Angstroms)</td></tr></table></div><br>",s+='<div id="'+e.pre+'alignerrormapDiv"></div>',s+="</div>",s+=e.htmlCls.divStr+"dl_elecmap2fofc' class='"+l+"'>",s+="<span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"sigma2fofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(a,3),s+="</select> &sigma;</span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"applymap2fofc'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"elecmapNo2'>Remove Map</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_elecmapfofc' class='"+l+"'>",s+="<span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"sigmafofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(a,5),s+="</select> &sigma;</span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"applymapfofc'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"elecmapNo3'>Remove Map</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_emmap' class='"+l+"'>",s+="<span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"empercentage'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(["0","10","20","30","40","50","60","70","80","90","100"],3),s+="</select> % of maximum EM values</span><br><span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"applyemmap'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"emmapNo2'>Remove EM Map</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_aroundsphere' class='"+l+"'>",s+=e.htmlCls.divNowrapStr+"1. Select the first set:</div>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomSphere2' multiple size='3' style='min-width:130px;'>",s+="</select></div><br>",s+=e.htmlCls.divNowrapStr+"2. Sphere with a radius: "+e.htmlCls.inputTextStr+"id='"+e.pre+"radius_aroundsphere' value='4' size='2'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"3. Select the second set to apply the sphere:</div>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomSphere' multiple size='3' style='min-width:130px;'>",s+="</select></div><br>",s+=e.htmlCls.divNowrapStr+"4. "+e.htmlCls.buttonStr+"applypick_aroundsphere'>Display</button> the sphere around the first set of atoms</div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"sphereExport'>Save</button> interacting/contacting residue pairs in a file</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_adjustmem' class='"+l+"'>",s+="<b>Note</b>: The membranes are parallel to the X-Y plane. The center of the membranes is at Z = 0. <br/><br/>",s+=e.htmlCls.divNowrapStr+"1. Extracellular membrane Z-axis position: "+e.htmlCls.inputTextStr+"id='"+e.pre+"extra_mem_z' value='' size='3'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"2. intracellular membrane Z-axis position: "+e.htmlCls.inputTextStr+"id='"+e.pre+"intra_mem_z' value='' size='3'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"3. "+e.htmlCls.buttonStr+"apply_adjustmem'>Display</button> the adjusted membranes</div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_selectplane' class='"+l+"'>",s+="<b>Note</b>: The membranes are parallel to the X-Y plane. The center of the membranes is at Z = 0. <br/><br/>",s+=e.htmlCls.divNowrapStr+"1. Z-axis position of the first X-Y plane: "+e.htmlCls.inputTextStr+"id='"+e.pre+"selectplane_z1' value='15' size='3'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"2. Z-axis position of the second X-Y plane: "+e.htmlCls.inputTextStr+"id='"+e.pre+"selectplane_z2' value='-15' size='3'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"3. "+e.htmlCls.buttonStr+"apply_selectplane'>Save</button> the region between the planes to Defined Sets</div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_addlabel' class='"+l+"'>",s+="1. Text: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labeltext' value='Text' size=4><br/>",s+="2. Size: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelsize' value='18' size=4 maxlength=2><br/>",s+="3. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelcolor' value='"+"#ffff00' size=4><br/>",e.utilsCls.isMobile()?s+=e.htmlCls.spanNowrapStr+"4. Touch TWO atoms</span><br/>":s+=e.htmlCls.spanNowrapStr+'4. Pick TWO atoms while holding "Alt" key</span><br/>',s+=e.htmlCls.spanNowrapStr+"5. "+e.htmlCls.buttonStr+"applypick_labels'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_addlabelselection' class='"+l+"'>",s+="1. Text: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labeltext2' value='Text' size=4><br/>",s+="2. Size: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelsize2' value='18' size=4 maxlength=2><br/>",s+="3. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelcolor2' value='"+"#ffff00' size=4><br/>",s+=e.htmlCls.spanNowrapStr+"4. "+e.htmlCls.buttonStr+"applyselection_labels'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_labelColor' class='"+l+"'>",s+="Color for all labels: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelcolorall' value='"+"#ffff00' size=4><br/><br/>",s+=e.htmlCls.spanNowrapStr+e.htmlCls.buttonStr+"applylabelcolor'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_distance' class='"+l+"'>",e.utilsCls.isMobile()?s+=e.htmlCls.spanNowrapStr+"1. Touch TWO atoms</span><br/>":s+=e.htmlCls.spanNowrapStr+'1. Pick TWO atoms while holding "Alt" key</span><br/>',s+=e.htmlCls.spanNowrapStr+"2. Line Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"distancecolor' value='"+"#ffff00' size=4><br/>",s+=e.htmlCls.spanNowrapStr+"3. "+e.htmlCls.buttonStr+"applypick_measuredistance'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_stabilizer' class='"+l+"'>",e.utilsCls.isMobile()?s+=e.htmlCls.spanNowrapStr+"1. Touch TWO atoms</span><br/>":s+=e.htmlCls.spanNowrapStr+'1. Pick TWO atoms while holding "Alt" key</span><br/>',s+=e.htmlCls.spanNowrapStr+"2. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"stabilizercolor' value='ffffff' size=4><br/>",s+=e.htmlCls.spanNowrapStr+"3. "+e.htmlCls.buttonStr+"applypick_stabilizer'>Add</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_disttwosets' class='"+l+"'>",s+=e.htmlCls.spanNowrapStr+"1. Select two sets</span><br/>",s+="<table border=0 width=400 cellspacing=10><tr><td>",s+=e.htmlCls.divNowrapStr+"First set:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomDist2' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td><td>",s+=e.htmlCls.divNowrapStr+"Second set:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomDist' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td></tr></table>",s+=e.htmlCls.spanNowrapStr+"2. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"distancecolor2' value='"+"#ffff00' size=4><br/><br/>",s+=e.htmlCls.spanNowrapStr+"3. "+e.htmlCls.buttonStr+"applydist2'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_distmanysets' class='"+l+"'>",s+=e.htmlCls.spanNowrapStr+"1. Select sets for pairwise distances</span><br/>",s+="<table border=0 width=400 cellspacing=10><tr><td>",s+=e.htmlCls.divNowrapStr+"First sets:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomDistTable2' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td><td>",s+=e.htmlCls.divNowrapStr+"Second sets:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomDistTable' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td></tr></table>",s+=e.htmlCls.spanNowrapStr+"2. "+e.htmlCls.buttonStr+"applydisttable'>Distances in Table</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_stabilizer_rm' class='"+l+"'>",e.utilsCls.isMobile()?s+=e.htmlCls.spanNowrapStr+"1. Touch TWO atoms</span><br/>":s+=e.htmlCls.spanNowrapStr+'1. Pick TWO atoms while holding "Alt" key</span><br/>',s+=e.htmlCls.spanNowrapStr+"2. "+e.htmlCls.buttonStr+"applypick_stabilizer_rm'>Remove</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_thickness' class='"+l+"'>",s+=e.htmlCls.setHtmlCls.setThicknessHtml("3dprint"),s+="</div>",s+=e.htmlCls.divStr+"dl_thickness2' class='"+l+"'>",s+=e.htmlCls.setHtmlCls.setThicknessHtml("style"),s+="</div>",s+=e.htmlCls.divStr+"dl_addtrack' class='"+l+"'>",s+=" <input type='hidden' id='"+e.pre+"track_chainid' value=''>",s+=e.htmlCls.divStr+"dl_addtrack_tabs' style='border:0px;'>",s+="<ul>",s+="<li><a href='#"+e.pre+"tracktab1'>NCBI gi/Accession</a></li>",s+="<li><a href='#"+e.pre+"tracktab2'>FASTA</a></li>",s+="<li><a href='#"+e.pre+"tracktab2b'>FASTA Alignment</a></li>",s+="<li><a href='#"+e.pre+"tracktab3'>BED File</a></li>",s+="<li><a href='#"+e.pre+"tracktab4'>Custom</a></li>",s+="<li><a href='#"+e.pre+"tracktab5'>Current Selection</a></li>",s+="</ul>",s+=e.htmlCls.divStr+"tracktab1'>",s+="NCBI gi/Accession: "+e.htmlCls.inputTextStr+"id='"+e.pre+"track_gi' placeholder='gi' size=16> <br><br>",s+=e.htmlCls.buttonStr+"addtrack_button1'>Add Track</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab2'>",s+="FASTA Title: "+e.htmlCls.inputTextStr+"id='"+e.pre+"fasta_title' placeholder='track title' size=16> <br><br>",s+="FASTA sequence: <br><textarea id='"+e.pre+"track_fasta' rows='5' style='width: 100%; height: "+2*e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",s+=e.htmlCls.buttonStr+"addtrack_button2'>Add Track</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab2b'>",s+="<div style='width:600px'>The full protein sequences with gaps are listed one by one. The sequence of the structure is listed at the top. If there are non-gap residues(e.g., from RefSeq) outside of the sequence of the structure, please remove them. Each sequence has a title line starting with \">\".</div><br>",s+="<b>FASTA alignment sequences</b>:<br>",s+="<textarea id='"+e.pre+"track_fastaalign' rows='5' style='width: 100%; height: "+2*e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",s+="Position of the first residue in Sequences & Annotations window: "+e.htmlCls.inputTextStr+"id='"+e.pre+"fasta_startpos' value='1' size=2> <br><br>",s+="Color Sequence by: <select id='"+e.pre+"colorseqby'>",s+=e.htmlCls.optionStr+"'identity' selected>Identity</option>",s+=e.htmlCls.optionStr+"'conservation'>Conservation</option>",s+="</select> <br><br>",s+=e.htmlCls.buttonStr+"addtrack_button2b'>Add Track(s)</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab3'>",s+="BED file: "+e.htmlCls.inputFileStr+"id='"+e.pre+"track_bed' size=16> <br><br>",s+=e.htmlCls.buttonStr+"addtrack_button3'>Add Track</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab4'>",s+="Track Title: "+e.htmlCls.inputTextStr+"id='"+e.pre+"track_title' placeholder='track title' size=16> <br><br>",s+='Track Text(e.g., "152 G, 155-156 RR" defines a character "G" at the position 152 and two continuous characters "RR" at positions from 155 to 156. The starting position is 1): <br>',s+="<textarea id='"+e.pre+"track_text' rows='5' style='width: 100%; height: "+2*e.htmlCls.MENU_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",s+=e.htmlCls.buttonStr+"addtrack_button4'>Add Track</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab5'>",s+="Track Title: "+e.htmlCls.inputTextStr+"id='"+e.pre+"track_selection' placeholder='track title' size=16> <br><br>",s+=e.htmlCls.buttonStr+"addtrack_button5'>Add Track</button>",s+="</div>",s+="</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_saveselection' class='"+l+"'>";let p=t&&t.defNames2Atoms?Object.keys(t.defNames2Atoms).length:1;s+="Name: "+e.htmlCls.inputTextStr+"id='"+e.pre+"seq_command_name' value='seq_"+p+"' size='5'> <br>",s+="<button style='white-space:nowrap;' id='"+e.pre+"seq_saveselection'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+e.pre+"seq_clearselection'>Clear</button><br/><br/>",s+="</div>",s+=e.htmlCls.divStr+"dl_copyurl' style='width:520px;' class='"+l+"'>",s+='Please copy one of the URLs below. They show the same result.<br>(To add a title to share link, click "Windows > Your Note" and click "File > Share Link" again.)<br><br>',s+="Original URL with commands: <br><textarea id='"+e.pre+"ori_url' rows='4' style='width:100%'></textarea><br><br>",s+="Lifelong Short URL:(To replace this URL, send a pull request to update share.html at <a href='https://github.com/ncbi/icn3d' target='_blank'>iCn3D GitHub</a>)<br>"+e.htmlCls.inputTextStr+"id='"+e.pre+"short_url' value='' style='width:100%'><br><br>",s+='Lifelong Short URL + Window Title:(To update the window title, click "Analysis > Your Note/Window Title".)<br>'+e.htmlCls.inputTextStr+"id='"+e.pre+"short_url_title' value='' style='width:100%'><br><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_selectannotations' class='"+l+" icn3d-annotation' style='background-color:white;'>",s+=e.htmlCls.divStr+"dl_annotations_tabs'>",s+=e.htmlCls.divStr+"dl_anno_view_tabs' style='border:0px; height:33px;'>",s+="<ul>",s+="<li><a href='#"+e.pre+"anno_tmp1' id='"+e.pre+"anno_summary'>Summary</a></li>",s+="<li><a href='#"+e.pre+"anno_tmp2' id='"+e.pre+"anno_details'>Details</a></li>",s+="</ul>",s+=e.htmlCls.divStr+"anno_tmp1'>",s+="</div>",s+=e.htmlCls.divStr+"anno_tmp2'>",s+="</div>",s+="</div>",s+="<div class='icn3d-box' style='width:520px;'><b>Annotations:&nbsp;</b><br><table border=0><tr>";let u="<td style='min-width:110px;'><span style='white-space:nowrap'>",C="<td style='min-width:130px;'><span style='white-space:nowrap'>";return s+=u+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_all'>All"+e.htmlCls.space2+"</span></td>",s+=C+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_cdd' checked>Conserved Domains"+e.htmlCls.space2+"</span></td>",s+=u+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_clinvar'>ClinVar"+e.htmlCls.space2+"</span></td>",s+=u+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_binding'>Functional Sites"+e.htmlCls.space2+"</span></td>",s+="</tr><tr>",s+=u+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_custom'>Custom"+e.htmlCls.space2+"</span></td>",s+=C+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_3dd'>3D Domains"+e.htmlCls.space2+"</span></td>",s+=u+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_snp'>SNPs"+e.htmlCls.space2+"</span></td>",s+=u+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_interact'>Interactions"+e.htmlCls.space2+"</span></td>",s+="<td></td>",s+="</tr><tr>",s+=u+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_ssbond'>Disulfide Bonds"+e.htmlCls.space2+"</span></td>",s+=u+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_crosslink'>Cross-Linkages"+e.htmlCls.space2+"</span></td>",void 0!==e.cfg.opmid?s+="<td style='min-width:110px;'><span id='"+e.pre+"anno_transmemli' style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_transmem'>Transmembrane"+e.htmlCls.space2+"</span></td>":s+="<td style='min-width:110px;'><span id='"+e.pre+"anno_transmemli' style='display:none; white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_transmem'>Transmembrane"+e.htmlCls.space2+"</span></td>",s+="<td></td>",s+="</tr></table></div>",s+="<button style='white-space:nowrap; margin-left:5px;' id='"+e.pre+"showallchains'>Show All Chains</button><br>",s+=e.htmlCls.divStr+"seqguide_wrapper' style='display:none'><br>"+e.htmlCls.setHtmlCls.setSequenceGuide("2")+"</div>",s+="</div><br/><hr><br>",s+=e.htmlCls.divStr+"dl_annotations'>",s+="</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_graph' style='background-color:white;' class='"+l+"'>",e.svgid=e.pre+"icn3d_viz",s+="<style>",s+="#"+e.svgid+" svg { border: 1px solid; font: 13px sans-serif; text-anchor: end; }",s+="#"+e.svgid+" .node { stroke: #eee; stroke-width: 1.5px; }",s+=".node .selected { stroke: "+e.htmlCls.ORANGE+"; }",s+=".link { stroke: #999; stroke-opacity: 0.6; }",s+="</style>",s+=e.htmlCls.divNowrapStr+"<b>Zoom</b>: mouse wheel; "+e.htmlCls.space3+" <b>Move</b>: left button; "+e.htmlCls.space3+" <b>Select Multiple Nodes</b>: Ctrl Key and drag an Area"+e.htmlCls.space3,s+='<div id="'+e.pre+'interactionDesc" style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_svgcolor_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'dl_svgcolor_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div></div>',s+=e.htmlCls.divStr+"dl_svgcolor' style='display:none;'>",s+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px">Click "View > H-Bonds & Interactions" to adjust parameters and relaunch the graph</span></div>',s+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px; color:#00FF00; font-weight:bold">Green</span>: H-Bonds; ',s+='<span style="color:#00FFFF; font-weight:bold">Cyan</span>: Salt Bridge/Ionic; ',s+='<span style="font-weight:bold">Grey</span>: contacts; ',s+='<span style="color:'+e.htmlCls.ORANGE+'; font-weight:bold">Orange</span>: disulfide bonds</div>',s+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px; color:#FF00FF; font-weight:bold">Magenta</span>: Halogen Bonds; ',s+='<span style="color:#FF0000; font-weight:bold">Red</span>: &pi;-Cation; ',s+='<span style="color:#0000FF; font-weight:bold">Blue</span>: &pi;-Stacking</div>',s+="</div>",s+=e.htmlCls.divNowrapStr+n+e.svgid+'_svg">SVG</button>'+e.htmlCls.space2,s+=n+e.svgid+'_png">PNG</button>'+e.htmlCls.space2,s+=n+e.svgid+'_json">JSON</button>',s+=e.htmlCls.space3+"<div id='"+e.pre+"force' style='display:inline-block;'><b>Force on Nodes</b>: <select id='"+e.svgid+"_force'>",s+=e.htmlCls.optionStr+"'0'>No</option>",s+=e.htmlCls.optionStr+"'1'>X-axis</option>",s+=e.htmlCls.optionStr+"'2'>Y-axis</option>",s+=e.htmlCls.optionStr+"'3'>Circle</option>",s+=e.htmlCls.optionStr+"'4' selected>Random</option>",s+="</select></div>",s+=e.htmlCls.space3+"<b>Label Size</b>: <select id='"+e.svgid+"_label'>",r="icn3d-node-text",s+=e.htmlCls.optionStr+"'"+r+"0'>No</option>",s+=e.htmlCls.optionStr+"'"+r+"4'>4px</option>",s+=e.htmlCls.optionStr+"'"+r+"8' selected>8px</option>",s+=e.htmlCls.optionStr+"'"+r+"12'>12px</option>",s+=e.htmlCls.optionStr+"'"+r+"16'>16px</option>",s+=e.htmlCls.optionStr+"'"+r+"24'>24px</option>",s+=e.htmlCls.optionStr+"'"+r+"32'>32px</option>",s+="</select>",s+=e.htmlCls.space3+"<div id='"+e.pre+"internalEdges' style='display:inline-block;'><b>Internal Edges</b>: <select id='"+e.svgid+"_hideedges'>",s+=e.htmlCls.optionStr+"'1' selected>Hide</option>",s+=e.htmlCls.optionStr+"'0'>Show</option>",s+="</select></div>",s+="</div>",s+='<svg id="'+e.svgid+'" style="margin-top:6px;"></svg>',s+="</div>",s+=e.htmlCls.divStr+"dl_area' class='"+l+"'>",s+="Solvent Accessible Surface Area(SASA) calculated using the <a href='https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0008140' target='_blank'>EDTSurf algorithm</a>: <br>",s+='(0-20% out is considered "in". 50-100% out is considered "out".)<br><br>',s+="<b>Toal</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"areavalue' value='' size='10'> &#8491;<sup>2</sup><br><br>",s+="<div id='"+e.pre+"areatable' style='max-height:400px; overflow:auto'></div>",s+="</div>",s+=e.htmlCls.divStr+"dl_colorbyarea' class='"+l+"'>",s+="<div style='width:500px'>Color each residue based on the percentage of solvent accessilbe surface area. The color ranges from blue, to white, to red for a percentage of 0, 35(variable), and 100, respectively.</div><br>",s+="<b>Middle Percentage(White)</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"midpercent' value='35' size='10'>% <br><br>",s+="<button style='white-space:nowrap;' id='"+e.pre+"applycolorbyarea'>Color</button><br/><br/>",s+="</div>",s+=e.htmlCls.divStr+"dl_rmsd' class='"+l+"'>",s+="<br><b>Alignment RMSD</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"realignrmsd' value='35' size='10'>&#8491;<br><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_buriedarea' class='"+l+"'>",s+="</div>",s+=e.htmlCls.divStr+"dl_propbypercentout' class='"+l+"'>",s+="<div style='width:400px'>Select residue based on the percentage of solvent accessilbe surface area. The values are in the range of 0-100.</div><br>",s+="<b>Min Percentage</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"minpercentout' value='0' size='10'>% <br>",s+="<b>Max Percentage</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"maxpercentout' value='100' size='10'>% <br>",s+="<button style='white-space:nowrap;' id='"+e.pre+"applypropbypercentout'>Apply</button><br/><br/>",s+="</div>",s+=e.htmlCls.divStr+"dl_propbybfactor' class='"+l+"'>",s+="<div style='width:400px'>Select residue based on B-factor. The values are in the range of 0-100.</div><br>",s+="<b>Min B-factor</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"minbfactor' value='0' size='10'>% <br>",s+="<b>Max B-factor</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"maxbfactor' value='100' size='10'>% <br>",s+="<button style='white-space:nowrap;' id='"+e.pre+"applypropbybfactor'>Apply</button><br/><br/>",s+="</div>",s+=e.htmlCls.divStr+"dl_legend' class='"+l+"' style='max-width:500px'>",s+="</div>",s+=e.htmlCls.divStr+"dl_disttable' class='"+l+"'>",s+="</div>",s+="</div>",s+="\x3c!--/form--\x3e",s}}class it{constructor(e){this.icn3dui=e}fullScreenChange(){let e=this.icn3dui,t=e.icn3d;e.bNode||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement||(e.htmlCls.clickMenuCls.setLogCmd("exit full screen",!1),t.bFullscreen=!1,e.utilsCls.setViewerWidthHeight(e,!0),t.applyCenterCls.setWidthHeight(e.htmlCls.WIDTH,e.htmlCls.HEIGHT),t.drawCls.draw())}searchSeq(){let e=this.icn3dui,t=e.icn3d,s=$("#"+e.pre+"search_seq").val();isNaN(s)&&-1==s.indexOf("$")&&-1==s.indexOf(".")&&-1==s.indexOf(":")&&-1==s.indexOf("@")&&(s=":"+s);let i=s.replace(/\s+/g,"_"),l=i;t.selByCommCls.selectByCommand(s,i,l),e.htmlCls.clickMenuCls.setLogCmd("select "+s+" | name "+i,!0)}readFile(e,t,s,i){let l=this.icn3dui,n=l.icn3d,r=this,o=t[s],a=e?"append":"load",d=new FileReader;d.onload=function(d){let c=d.target.result;l.htmlCls.clickMenuCls.setLogCmd(a+" pdb file "+o.name,!1),e?(n.resetConfig(),n.bResetAnno=!0,n.bResetSets=!0):n.init(),n.bInputfile=!0,n.InputfileType="pdb",n.InputfileData=n.InputfileData?n.InputfileData+"\nENDMDL\n"+c:c,i=s>0?i+"\nENDMDL\n"+c:c,Object.keys(t).length==s+1?(e&&(n.hAtoms={},n.dAtoms={}),n.pdbParserCls.loadPdbData(i,void 0,void 0,e)):r.readFile(e,t,s+1,i)},"object"==typeof o&&d.readAsText(o)}loadPdbFile(e){let t=this.icn3dui,s=t.icn3d,i=e?"pdbfile_app":"pdbfile";s.bInitial=!0,t.cfg.notebook||dialog.dialog("close"),t.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");let l=$("#"+t.pre+i)[0].files;l[0]?(t.htmlCls.setHtmlCls.fileSupport(),s.molTitle="",s.dataStrAll="",this.readFile(e,l,0,""),e&&(s.bSetChainsAdvancedMenu&&s.definedSetsCls.showSets(),s.bAnnoShown&&s.showAnnoCls.showAnnotations())):alert("Please select a file before clicking 'Load'")}saveHtml(e){let t=this.icn3dui.icn3d,s="";s+='<link rel="stylesheet" href="https:///structure.ncbi.nlm.nih.gov/icn3d/lib/jquery-ui-1.12.1.min.css">\n',s+='<link rel="stylesheet" href="https:///structure.ncbi.nlm.nih.gov/icn3d/icn3d_full_ui.css">\n',s+=$("#"+e).html();let i=e.split("_"),l=i.length>2?i[2]:e,n=Object.keys(t.structures)[0];Object.keys(t.structures).length>1&&(n+="-"+Object.keys(t.structures)[1]),t.saveFileCls.saveFile(n+"-"+l+".html","html",encodeURIComponent(s))}allEventFunctions(){let e=this.icn3dui,t=e.icn3d,s=this;if(e.bNode)return;let i=document.URL,l=i.indexOf("?");i=-1==l?i:i.substr(0,l),t.definedSetsCls.clickCustomAtoms(),t.definedSetsCls.clickCommand_apply(),t.definedSetsCls.clickModeswitch(),t.selectionCls.clickShow_selected(),t.selectionCls.clickHide_selected(),t.diagram2dCls.click2Ddgm(),t.cartoon2dCls.click2Dcartoon(),t.addTrackCls.clickAddTrackButton(),t.resizeCanvasCls.windowResize(),t.annotationCls.setTabs(),t.resid2specCls.switchHighlightLevel(),e.utilsCls.isMobile()?(t.hlSeqCls.selectSequenceMobile(),t.hlSeqCls.selectChainMobile()):t.hlSeqCls.selectSequenceNonMobile(),e.htmlCls.clickMenuCls.clickMenu1(),e.htmlCls.clickMenuCls.clickMenu2(),e.htmlCls.clickMenuCls.clickMenu3(),e.htmlCls.clickMenuCls.clickMenu4(),e.htmlCls.clickMenuCls.clickMenu5(),e.htmlCls.clickMenuCls.clickMenu6(),e.myEventCls.onIds(["#"+e.pre+"back","#"+e.pre+"mn6_back"],"click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("back",!1),s.resizeCanvasCls.back()})),e.myEventCls.onIds(["#"+e.pre+"forward","#"+e.pre+"mn6_forward"],"click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("forward",!1),s.resizeCanvasCls.forward()})),e.myEventCls.onIds(["#"+e.pre+"fullscreen","#"+e.pre+"mn6_fullscreen"],"click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("enter full screen",!1),s.bFullscreen=!0,e.htmlCls.WIDTH=$(window).width(),e.htmlCls.HEIGHT=$(window).height(),s.applyCenterCls.setWidthHeight(e.htmlCls.WIDTH,e.htmlCls.HEIGHT),s.drawCls.draw(),s.resizeCanvasCls.openFullscreen($("#"+e.pre+"canvas")[0])})),document.addEventListener("fullscreenchange",this.fullScreenChange.bind(this)),document.addEventListener("webkitfullscreenchange",this.fullScreenChange.bind(this)),document.addEventListener("mozfullscreenchange",this.fullScreenChange.bind(this)),document.addEventListener("msfullscreenchange",this.fullScreenChange.bind(this)),e.myEventCls.onIds(["#"+e.pre+"toggle","#"+e.pre+"mn2_toggle"],"click",(function(t){e.icn3d.selectionCls.toggleSelection(),e.htmlCls.clickMenuCls.setLogCmd("toggle selection",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_clrYellow","click",(function(t){let s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight color yellow",!0),s.hColor=e.parasCls.thr(16776960),s.matShader=s.setColorCls.setOutlineColor("yellow"),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_clrGreen","click",(function(t){let s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight color green",!0),s.hColor=e.parasCls.thr(65280),s.matShader=s.setColorCls.setOutlineColor("green"),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_clrRed","click",(function(t){let s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight color red",!0),s.hColor=e.parasCls.thr(16711680),s.matShader=s.setColorCls.setOutlineColor("red"),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_styleOutline","click",(function(t){let s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight style outline",!0),s.bHighlight=1,s.hlUpdateCls.showHighlight()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_styleObject","click",(function(t){let s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight style 3d",!0),s.bHighlight=2,s.hlUpdateCls.showHighlight()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_styleNone","click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.hlUpdateCls.clearHighlight(),e.htmlCls.clickMenuCls.setLogCmd("clear selection",!0)})),e.myEventCls.onIds(["#"+e.pre+"alternate","#"+e.pre+"mn2_alternate","#"+e.pre+"alternate2"],"click",(function(t){let s=e.icn3d;s.bAlternate=!0,s.alternateCls.alternateStructures(),s.bAlternate=!1,e.htmlCls.clickMenuCls.setLogCmd("alternate structures",!1)})),e.myEventCls.onIds("#"+e.pre+"mn2_realignresbyres","click",(function(t){e.icn3d.realignParserCls.realign(),e.htmlCls.clickMenuCls.setLogCmd("realign",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_realignonseqalign","click",(function(t){let s=e.icn3d;if(void 0===s.bSetChainsAdvancedMenu||!s.bSetChainsAdvancedMenu){let t=e.hashUtilsCls.cloneHash(s.hAtoms);s.definedSetsCls.setPredefinedInMenu(),s.bSetChainsAdvancedMenu=!0,s.hAtoms=e.hashUtilsCls.cloneHash(t)}let i=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomRealign").length&&$("#"+e.pre+"atomsCustomRealign").html(i),s.bRender&&e.htmlCls.dialogCls.openDlg("dl_realign","Please select two sets to realign"),$("#"+e.pre+"atomsCustomRealign").resizable()})),e.myEventCls.onIds("#"+e.pre+"mn2_realignonstruct","click",(function(t){let s=e.icn3d;if(void 0===s.bSetChainsAdvancedMenu||!s.bSetChainsAdvancedMenu){let t=e.hashUtilsCls.cloneHash(s.hAtoms);s.definedSetsCls.setPredefinedInMenu(),s.bSetChainsAdvancedMenu=!0,s.hAtoms=e.hashUtilsCls.cloneHash(t)}let i=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomRealignByStruct").length&&$("#"+e.pre+"atomsCustomRealignByStruct").html(i),s.bRender&&e.htmlCls.dialogCls.openDlg("dl_realignbystruct","Please select two sets to realign"),$("#"+e.pre+"atomsCustomRealignByStruct").resizable()})),e.myEventCls.onIds("#"+e.pre+"applyRealign","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=$("#"+e.pre+"atomsCustomRealign").val();i.length>0&&(s.hAtoms=s.definedSetsCls.getAtomsFromNameArray(i)),s.selectionCls.saveSelectionPrep();let l="realignSetsBySeq";s.selectionCls.saveSelection(l,l),s.realignParserCls.realignOnSeqAlign(),i.length>0?e.htmlCls.clickMenuCls.setLogCmd("realign on seq align | "+i,!0):e.htmlCls.clickMenuCls.setLogCmd("realign on seq align",!0)})),e.myEventCls.onIds("#"+e.pre+"applyRealignByStruct","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=$("#"+e.pre+"atomsCustomRealignByStruct").val();i.length>0&&(s.hAtoms=s.definedSetsCls.getAtomsFromNameArray(i)),s.selectionCls.saveSelectionPrep();let l="realignSetsByStruct";s.selectionCls.saveSelection(l,l),s.realignParserCls.realignOnStructAlign(),i.length>0?e.htmlCls.clickMenuCls.setLogCmd("realign on structure align | "+i,!0):e.htmlCls.clickMenuCls.setLogCmd("realign on structure align",!0)})),e.myEventCls.onIds("#"+e.pre+"applyColorSpectrumBySets","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=$("#"+e.pre+"atomsCustomColorSpectrum").val();if(0==i.length)return void alert("Please select some sets");s.setColorCls.setColorBySets(i,!0),e.htmlCls.clickMenuCls.setLogCmd("set color spectrum | "+i,!0)})),e.myEventCls.onIds("#"+e.pre+"applyColorRainbowBySets","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=$("#"+e.pre+"atomsCustomColorRainbow").val();if(0==i.length)return void alert("Please select some sets");s.setColorCls.setColorBySets(i,!1),e.htmlCls.clickMenuCls.setLogCmd("set color rainbow | "+i,!0)})),e.myEventCls.onIds("#"+e.pre+"anno_summary","click",(function(t){let s=e.icn3d;t.preventDefault(),s.annotationCls.setAnnoViewAndDisplay("overview"),e.htmlCls.clickMenuCls.setLogCmd("set view overview",!0)})),e.myEventCls.onIds("#"+e.pre+"anno_details","click",(function(t){let s=e.icn3d;t.preventDefault(),s.annotationCls.setAnnoViewAndDisplay("detailed view"),e.htmlCls.clickMenuCls.setLogCmd("set view detailed view",!0)})),e.myEventCls.onIds("#"+e.pre+"show_annotations","click",(function(t){e.icn3d.showAnnoCls.showAnnotations(),e.htmlCls.clickMenuCls.setLogCmd("view annotations",!0)})),e.myEventCls.onIds("#"+e.pre+"showallchains","click",(function(t){e.icn3d.annotationCls.showAnnoAllChains(),e.htmlCls.clickMenuCls.setLogCmd("show annotations all chains",!0)})),e.myEventCls.onIds("#"+e.pre+"show_alignsequences","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences")})),e.myEventCls.onIds(["#"+e.pre+"show_2ddgm","#"+e.pre+"mn2_2ddgm"],"click",(function(t){let s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_2ddgm","2D Diagram"),s.viewInterPairsCls.retrieveInteractionData(),e.htmlCls.clickMenuCls.setLogCmd("view interactions",!0)})),e.myEventCls.onIds("#"+e.pre+"search_seq_button","click",(function(t){e.icn3d,t.stopImmediatePropagation(),s.searchSeq()})),e.myEventCls.onIds("#"+e.pre+"search_seq","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),s.searchSeq())})),e.myEventCls.onIds("#"+e.pre+"reload_vastplus","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("vast+ search "+$("#"+e.pre+"vastpluspdbid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid="+$("#"+e.pre+"vastpluspdbid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_vast","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("vast search "+$("#"+e.pre+"vastpdbid").val()+"_"+$("#"+e.pre+"vastchainid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/vast/vastsrv.cgi?pdbid="+$("#"+e.pre+"vastpdbid").val()+"&chain="+$("#"+e.pre+"vastchainid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_foldseek","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load chainalignment "+$("#"+e.pre+"foldseekchainids").val(),!0),window.open(i+"?chainalign="+$("#"+e.pre+"foldseekchainids").val(),"_self")})),e.myEventCls.onIds("#"+e.pre+"reload_mmtf","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load mmtf "+$("#"+e.pre+"mmtfid").val(),!1),window.open(i+"?mmtfid="+$("#"+e.pre+"mmtfid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"mmtfid","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load mmtf "+$("#"+e.pre+"mmtfid").val(),!1),window.open(i+"?mmtfid="+$("#"+e.pre+"mmtfid").val(),"_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_pdb","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load pdb "+$("#"+e.pre+"pdbid").val(),!1),window.open(i+"?pdbid="+$("#"+e.pre+"pdbid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"pdbid","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load pdb "+$("#"+e.pre+"pdbid").val(),!1),window.open(i+"?pdbid="+$("#"+e.pre+"pdbid").val(),"_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_af","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load af "+$("#"+e.pre+"afid").val(),!1),window.open(i+"?afid="+$("#"+e.pre+"afid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_afmap","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=e.cfg.afid?e.cfg.afid:$("#"+e.pre+"afid").val();e.htmlCls.clickMenuCls.setLogCmd("set half pae map "+i,!0),s.contactMapCls.afErrorMap(i)})),e.myEventCls.onIds("#"+e.pre+"reload_afmapfull","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=e.cfg.afid?e.cfg.afid:$("#"+e.pre+"afid").val();e.htmlCls.clickMenuCls.setLogCmd("set full pae map "+i,!0),s.contactMapCls.afErrorMap(i,!0)})),e.myEventCls.onIds("#"+e.pre+"afid","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load af "+$("#"+e.pre+"afid").val(),!1),window.open(i+"?afid="+$("#"+e.pre+"afid").val(),"_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_opm","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load opm "+$("#"+e.pre+"opmid").val(),!1),window.open(i+"?opmid="+$("#"+e.pre+"opmid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"opmid","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load opm "+$("#"+e.pre+"opmid").val(),!1),window.open(i+"?opmid="+$("#"+e.pre+"opmid").val(),"_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_align_refined","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"alignid1").val()+","+$("#"+e.pre+"alignid2").val();e.htmlCls.clickMenuCls.setLogCmd("load alignment "+s+" | parameters &atype=1&bu=1",!1),window.open(i+"?align="+s+"&showalignseq=1&atype=1&bu=1","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_align_ori","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"alignid1").val()+","+$("#"+e.pre+"alignid2").val();e.htmlCls.clickMenuCls.setLogCmd("load alignment "+s+" | parameters &atype=0&bu=1",!1),window.open(i+"?align="+s+"&showalignseq=1&atype=0&bu=1","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_alignaf","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"alignafid1").val()+"_A,"+$("#"+e.pre+"alignafid2").val()+"_A";e.htmlCls.clickMenuCls.setLogCmd("load chains "+s+" | residues | resdef ",!1),window.open(i+"?chainalign="+s+"&resnum=&resdef=&showalignseq=1","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_chainalign","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"chainalignids").val(),l=$("#"+e.pre+"resalignids").val(),n=$("#"+e.pre+"predefinedres").val().trim().replace(/\n/g,"; ");n&&s.split(",").length-1!=n.split("; ").length?alert("Please make sure the number of chains and the lines of predefined residues are the same..."):(e.htmlCls.clickMenuCls.setLogCmd("load chains "+s+" | residues "+l+" | resdef "+n,!1),window.open(i+"?chainalign="+s+"&resnum="+l+"&resdef="+n+"&showalignseq=1","_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_chainalign_asym","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"chainalignids").val(),l=$("#"+e.pre+"resalignids").val(),n=$("#"+e.pre+"predefinedres").val().trim().replace(/\n/g,"; ");n&&s.split(",").length-1!=n.split("; ").length?alert("Please make sure the number of chains and the lines of predefined residues are the same..."):(e.htmlCls.clickMenuCls.setLogCmd("load chains "+s+" on asymmetric unit | residues "+l+" | resdef "+n,!1),window.open(i+"?chainalign="+s+"&resnum="+l+"&resdef="+n+"&showalignseq=1&bu=0","_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_mutation_3d","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"mutationids").val(),l=$("#"+e.pre+"idsource").val(),n=s.substr(0,s.indexOf("_"));e.htmlCls.clickMenuCls.setLogCmd("3d of mutation "+s,!1),window.open(i+"?"+l+"="+n+"&command=scap 3d "+s+"; select displayed set","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mutation_pdb","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"mutationids").val(),l=$("#"+e.pre+"idsource").val(),n=s.substr(0,s.indexOf("_"));e.htmlCls.clickMenuCls.setLogCmd("pdb of mutation "+s,!1),window.open(i+"?"+l+"="+n+"&command=scap pdb "+s+"; select displayed set","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mutation_inter","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let l=$("#"+e.pre+"mutationids").val(),n=$("#"+e.pre+"idsource").val(),r=l.split(","),o=[];for(let e=0,t=r.length;e<t;++e){let t=r[e].lastIndexOf("_"),s=r[e].substr(0,t);o.push(s)}let a=l.substr(0,l.indexOf("_"));s.structures||(s.structures={},s.structures[a]=1),s.resid2specCls.residueids2spec(o),e.htmlCls.clickMenuCls.setLogCmd("interaction change of mutation "+l,!1),window.open(i+"?"+n+"="+a+"&command=scap interaction "+l,"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mmcif","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load mmcif "+$("#"+e.pre+"mmcifid").val(),!1),window.open(i+"?mmcifid="+$("#"+e.pre+"mmcifid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"mmcifid","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load mmcif "+$("#"+e.pre+"mmcifid").val(),!1),window.open(i+"?mmcifid="+$("#"+e.pre+"mmcifid").val(),"_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_mmdb","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("load mmdb1 "+$("#"+e.pre+"mmdbid").val(),!1),window.open(i+"?mmdbid="+$("#"+e.pre+"mmdbid").val()+"&bu=1","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mmdb_asym","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("load mmdb0 "+$("#"+e.pre+"mmdbid").val(),!1),window.open(i+"?mmdbid="+$("#"+e.pre+"mmdbid").val()+"&bu=0","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mmdbaf","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("load mmdbaf1 "+$("#"+e.pre+"mmdbafid").val(),!1),window.open(i+"?mmdbafid="+$("#"+e.pre+"mmdbafid").val()+"&bu=1","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mmdbaf_asym","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("load mmdbaf0 "+$("#"+e.pre+"mmdbafid").val(),!1),window.open(i+"?mmdbafid="+$("#"+e.pre+"mmdbafid").val()+"&bu=0","_blank")})),e.myEventCls.onIds("#"+e.pre+"mmdbid","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("load mmdb0 "+$("#"+e.pre+"mmdbid").val(),!1),window.open(i+"?mmdbid="+$("#"+e.pre+"mmdbid").val()+"&bu=0","_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_blast_rep_id","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"query_id").val(),l=encodeURIComponent($("#"+e.pre+"query_fasta").val()),n=$("#"+e.pre+"blast_rep_id").val();e.htmlCls.clickMenuCls.setLogCmd("load seq_struct_ids "+s+","+n,!1),s=""!==s&&void 0!==s?s:l,window.open(i+"?from=icn3d&alg=blast&blast_rep_id="+n+"&query_id="+s+"&command=view annotations; set annotation cdd; set annotation site; set view detailed view; select chain "+n+"; show selection","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_alignsw","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let s=$("#"+e.pre+"query_id").val(),l=encodeURIComponent($("#"+e.pre+"query_fasta").val()),n=$("#"+e.pre+"blast_rep_id").val();e.htmlCls.clickMenuCls.setLogCmd("load seq_struct_ids_smithwm "+s+","+n,!1),s=""!==s&&void 0!==s?s:l,window.open(i+"?from=icn3d&alg=smithwm&blast_rep_id="+n+"&query_id="+s+"&command=view annotations; set annotation cdd; set annotation site; set view detailed view; select chain "+n+"; show selection","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_gi","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load gi "+$("#"+e.pre+"gi").val(),!1),window.open(i+"?gi="+$("#"+e.pre+"gi").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"gi","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load gi "+$("#"+e.pre+"gi").val(),!1),window.open(i+"?gi="+$("#"+e.pre+"gi").val(),"_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_uniprotid","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load uniprotid "+$("#"+e.pre+"uniprotid").val(),!1),window.open(i+"?uniprotid="+$("#"+e.pre+"uniprotid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"uniprotid","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load uniprotid "+$("#"+e.pre+"uniprotid").val(),!1),window.open(i+"?uniprotid="+$("#"+e.pre+"uniprotid").val(),"_blank"))})),e.myEventCls.onIds("#"+e.pre+"reload_cid","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load cid "+$("#"+e.pre+"cid").val(),!1),window.open(i+"?cid="+$("#"+e.pre+"cid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"cid","keyup",(function(t){e.icn3d,13===t.keyCode&&(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load cid "+$("#"+e.pre+"cid").val(),!1),window.open(i+"?cid="+$("#"+e.pre+"cid").val(),"_blank"))})),e.htmlCls.setHtmlCls.clickReload_pngimage(),e.myEventCls.onIds("#"+e.pre+"reload_state","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close"),s.bInputfile||s.init();let i=$("#"+e.pre+"state")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();let t=new FileReader;t.onload=function(t){s.bStatefile=!0;let i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load state file "+$("#"+e.pre+"state").val(),!1),s.commands=[],s.optsHistory=[],s.loadScriptCls.loadScript(i,!0)},t.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_selectionfile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=$("#"+e.pre+"selectionfile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();let t=new FileReader;t.onload=function(t){let i=t.target.result;s.selectionCls.loadSelection(i),e.htmlCls.clickMenuCls.setLogCmd("load selection file "+$("#"+e.pre+"selectionfile").val(),!1)},t.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_dsn6file2fofc","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.dsn6ParserCls.loadDsn6File("2fofc")})),e.myEventCls.onIds("#"+e.pre+"reload_dsn6filefofc","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.dsn6ParserCls.loadDsn6File("fofc")})),e.myEventCls.onIds("#"+e.pre+"reload_delphifile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadDelphiFile("delphi")})),e.myEventCls.onIds("#"+e.pre+"reload_pqrfile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("pqr")})),e.myEventCls.onIds("#"+e.pre+"reload_phifile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("phi")})),e.myEventCls.onIds("#"+e.pre+"reload_cubefile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("cube")})),e.myEventCls.onIds("#"+e.pre+"reload_pqrurlfile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("pqrurl")})),e.myEventCls.onIds("#"+e.pre+"reload_phiurlfile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("phiurl")})),e.myEventCls.onIds("#"+e.pre+"reload_cubeurlfile","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("cubeurl")})),e.myEventCls.onIds("#"+e.pre+"reload_delphifile2","click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("delphi"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadDelphiFile("delphi2")})),e.myEventCls.onIds("#"+e.pre+"reload_pqrfile2","click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phi"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("pqr2")})),e.myEventCls.onIds("#"+e.pre+"reload_phifile2","click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phi"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("phi2")})),e.myEventCls.onIds("#"+e.pre+"reload_cubefile2","click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phi"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("cube2")})),e.myEventCls.onIds("#"+e.pre+"reload_pqrurlfile2","click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phiurl"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("pqrurl2")})),e.myEventCls.onIds("#"+e.pre+"reload_phiurlfile2","click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phiurl"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("phiurl2")})),e.myEventCls.onIds("#"+e.pre+"reload_cubeurlfile2","click",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phiurl"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("cubeurl2")})),e.myEventCls.onIds("#"+e.pre+"reload_dsn6fileurl2fofc","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.dsn6ParserCls.loadDsn6FileUrl("2fofc")})),e.myEventCls.onIds("#"+e.pre+"reload_dsn6fileurlfofc","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.dsn6ParserCls.loadDsn6FileUrl("fofc")})),e.myEventCls.onIds("#"+e.pre+"reload_pdbfile","click",(function(t){e.icn3d,t.preventDefault();s.loadPdbFile(!1)})),e.myEventCls.onIds("#"+e.pre+"reload_pdbfile_app","click",(function(t){let i=e.icn3d;t.preventDefault(),i.bAppend=!0,s.loadPdbFile(i.bAppend)})),e.myEventCls.onIds("#"+e.pre+"reload_mol2file","click",(function(t){let s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");let i=$("#"+e.pre+"mol2file")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();let t=new FileReader;t.onload=function(t){let i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load mol2 file "+$("#"+e.pre+"mol2file").val(),!1),s.molTitle="",s.inputid=void 0,s.init(),s.bInputfile=!0,s.InputfileData=s.InputfileData?s.InputfileData+"\nENDMDL\n"+i:i,s.InputfileType="mol2",s.mol2ParserCls.loadMol2Data(i)},t.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_sdffile","click",(function(t){let s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");let i=$("#"+e.pre+"sdffile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();let t=new FileReader;t.onload=function(t){let i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load sdf file "+$("#"+e.pre+"sdffile").val(),!1),s.molTitle="",s.inputid=void 0,s.init(),s.bInputfile=!0,s.InputfileData=s.InputfileData?s.InputfileData+"\nENDMDL\n"+i:i,s.InputfileType="sdf",s.sdfParserCls.loadSdfData(i)},t.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_xyzfile","click",(function(t){let s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");let i=$("#"+e.pre+"xyzfile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();let t=new FileReader;t.onload=function(t){let i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load xyz file "+$("#"+e.pre+"xyzfile").val(),!1),s.molTitle="",s.inputid=void 0,s.init(),s.bInputfile=!0,s.InputfileData=s.InputfileData?s.InputfileData+"\nENDMDL\n"+i:i,s.InputfileType="xyz",s.xyzParserCls.loadXyzData(i)},t.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_afmapfile","click",(function(t){let s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");let i=$("#"+e.pre+"afmapfile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();let t=new FileReader;t.onload=function(t){let i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load AlphaFold PAE file "+$("#"+e.pre+"afmapfile").val(),!1),e.htmlCls.dialogCls.openDlg("dl_alignerrormap","Show Predicted Aligned Error (PAE) map"),s.contactMapCls.processAfErrorMap(JSON.parse(i))},t.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_afmapfilefull","click",(function(t){let s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");let i=$("#"+e.pre+"afmapfile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();let t=new FileReader;t.onload=function(t){let i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load AlphaFold PAE file "+$("#"+e.pre+"afmapfile").val(),!1),e.htmlCls.dialogCls.openDlg("dl_alignerrormap","Show Predicted Aligned Error (PAE) map"),s.contactMapCls.processAfErrorMap(JSON.parse(i),!0)},t.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_urlfile","click",(function(t){let s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");let i=$("#"+e.pre+"filetype").val(),l=$("#"+e.pre+"urlfile").val();s.inputurl="type="+i+"&url="+encodeURIComponent(l),s.init(),s.bInputfile=!0,s.bInputUrlfile=!0,s.pdbParserCls.downloadUrl(l,i)})),e.myEventCls.onIds("#"+e.pre+"reload_mmciffile","click",(function(t){let s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");let i=$("#"+e.pre+"mmciffile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();let t=new FileReader;t.onload=function(t){let i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load mmcif file "+$("#"+e.pre+"mmciffile").val(),!1),s.molTitle="";let l=e.htmlCls.baseUrl+"mmcifparser/mmcifparser.cgi";s.bCid=void 0,$.ajax({url:l,type:"POST",data:{mmciffile:i},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){s.ParserUtilsCls.showLoading()},complete:function(){},success:function(e){s.init(),s.bInputfile=!0,s.InputfileData=s.InputfileData?s.InputfileData+"\nENDMDL\n"+e:e,s.InputfileType="mmcif",s.mmcifParserCls.loadMmcifData(e)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},t.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"applycustomcolor","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.setOptionCls.setOption("color",$("#"+e.pre+"colorcustom").val()),e.htmlCls.clickMenuCls.setLogCmd("color "+$("#"+e.pre+"colorcustom").val(),!0)})),e.myEventCls.onIds(["#"+e.pre+"atomsCustomSphere2","#"+e.pre+"atomsCustomSphere","#"+e.pre+"radius_aroundsphere"],"change",(function(t){e.icn3d.bSphereCalc=!1})),e.myEventCls.onIds("#"+e.pre+"applypick_aroundsphere","click",(function(t){let s=e.icn3d,i=parseFloat($("#"+e.pre+"radius_aroundsphere").val()),l=$("#"+e.pre+"atomsCustomSphere").val(),n=$("#"+e.pre+"atomsCustomSphere2").val();if(0==n.length)alert("Please select the first set at step #1");else{let t="select zone cutoff "+i+" | sets "+n+" "+l+" | "+s.bSphereCalc;s.bSphereCalc||s.showInterCls.pickCustomSphere(i,n,l,s.bSphereCalc),s.bSphereCalc=!0,s.hlUpdateCls.updateHlAll(),e.htmlCls.clickMenuCls.setLogCmd(t,!0)}})),e.myEventCls.onIds("#"+e.pre+"sphereExport","click",(function(t){let s=e.icn3d;t.preventDefault();let i=parseFloat($("#"+e.pre+"radius_aroundsphere").val()),l=$("#"+e.pre+"atomsCustomSphere").val(),n=$("#"+e.pre+"atomsCustomSphere2").val();if(0==n.length)alert("Please select the first set at step #1");else{s.showInterCls.pickCustomSphere(i,n,l,s.bSphereCalc),s.bSphereCalc=!0;let t=s.viewInterPairsCls.exportSpherePairs(),r=s.inputid?s.inputid:"custom";s.saveFileCls.saveFile(r+"_sphere_pairs.html","html",t),e.htmlCls.clickMenuCls.setLogCmd("export pairs | "+n+" "+l+" | dist "+i,!0)}})),e.myEventCls.onIds("#"+e.pre+"apply_adjustmem","click",(function(t){let s=e.icn3d;e.cfg.notebook||dialog.dialog("close");let i=parseFloat($("#"+e.pre+"extra_mem_z").val()),l=parseFloat($("#"+e.pre+"intra_mem_z").val());s.selectionCls.adjustMembrane(i,l);let n="adjust membrane z-axis "+i+" "+l;e.htmlCls.clickMenuCls.setLogCmd(n,!0)})),e.myEventCls.onIds("#"+e.pre+"apply_selectplane","click",(function(t){let s=e.icn3d;e.cfg.notebook||dialog.dialog("close");let i=parseFloat($("#"+e.pre+"selectplane_z1").val()),l=parseFloat($("#"+e.pre+"selectplane_z2").val());s.selectionCls.selectBtwPlanes(i,l);let n="select planes z-axis "+i+" "+l;e.htmlCls.clickMenuCls.setLogCmd(n,!0)})),e.myEventCls.onIds(["#"+e.pre+"atomsCustomHbond2","#"+e.pre+"atomsCustomHbond","#"+e.pre+"analysis_hbond","#"+e.pre+"analysis_saltbridge","#"+e.pre+"analysis_contact","#"+e.pre+"hbondthreshold","#"+e.pre+"saltbridgethreshold","#"+e.pre+"contactthreshold"],"change",(function(t){e.icn3d.bHbondCalc=!1})),e.myEventCls.onIds("#"+e.pre+"crossstrucinter","change",(function(t){let s=e.icn3d;t.preventDefault(),s.crossstrucinter=parseInt($("#"+e.pre+"crossstrucinter").val()),e.htmlCls.clickMenuCls.setLogCmd("cross structure interaction "+s.crossstrucinter,!0)})),e.myEventCls.onIds("#"+e.pre+"applyhbonds","click",(function(t){let s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("3d")})),e.myEventCls.onIds("#"+e.pre+"applycontactmap","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=parseFloat($("#"+s.pre+"contactdist").val()),l=$("#"+s.pre+"contacttype").val();s.contactMapCls.contactMap(i,l),e.htmlCls.clickMenuCls.setLogCmd("contact map | dist "+i+" | type "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"hbondWindow","click",(function(t){let s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("view")})),e.myEventCls.onIds("#"+e.pre+"areaWindow","click",(function(t){let s=e.icn3d;t.preventDefault();let i=$("#"+e.pre+"atomsCustomHbond").val(),l=$("#"+e.pre+"atomsCustomHbond2").val();s.analysisCls.calcBuriedSurface(l,i),e.htmlCls.clickMenuCls.setLogCmd("calc buried surface | "+l+" "+i,!0)})),e.myEventCls.onIds("#"+e.pre+"sortSet1","click",(function(t){let s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("save1")})),$(document).on("click","."+e.pre+"showintercntonly",(function(t){e.icn3d,t.stopImmediatePropagation(),$(".icn3d-border").hide(),e.htmlCls.clickMenuCls.setLogCmd("table inter count only",!0)})),$(document).on("click","."+e.pre+"showinterdetails",(function(t){e.icn3d,t.stopImmediatePropagation(),$(".icn3d-border").show(),e.htmlCls.clickMenuCls.setLogCmd("table inter details",!0)})),e.myEventCls.onIds("#"+e.pre+"sortSet2","click",(function(t){let s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("save2")})),e.myEventCls.onIds("#"+e.pre+"hbondGraph","click",(function(t){let s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("graph")})),e.myEventCls.onIds("#"+e.pre+"hbondLineGraph","click",(function(t){let s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("linegraph")})),e.myEventCls.onIds("#"+e.pre+"hbondScatterplot","click",(function(t){let s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("scatterplot")})),$(document).on("click","#"+e.svgid+" circle.selected",(function(t){let s=e.icn3d;t.stopImmediatePropagation();let i=$(this).attr("res");!1!==s.bSelectResidue||s.bShift||s.bCtrl||s.selectionCls.removeSelection(),void 0!==i&&(s.hlSeqCls.selectResidues(i,this),s.hlObjectsCls.addHlObjects())})),e.myEventCls.onIds("#"+e.svgid+"_svg","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.svgid,s.inputid+"_force_directed_graph.svg")})),e.myEventCls.onIds("#"+e.svgid+"_png","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.savePng(e.svgid,s.inputid+"_force_directed_graph.png")})),e.myEventCls.onIds("#"+e.svgid+"_json","click",(function(t){let s=e.icn3d;t.preventDefault();let i=s.graphStr.substr(0,s.graphStr.lastIndexOf("}"));i+=e.htmlCls.setHtmlCls.getLinkColor(),s.saveFileCls.saveFile(s.inputid+"_force_directed_graph.json","text",[i])})),$(document).on("click","#"+e.svgid_ct+"_svg",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.svgid_ct,s.inputid+"_cartoon.svg")})),$(document).on("click","#"+e.svgid_ct+"_png",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.savePng(e.svgid_ct,s.inputid+"_cartoon.png")})),$(document).on("click","#"+e.svgid_ct+"_json",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.saveFile(s.inputid+"_cartoon.json","text",[s.graphStr])})),$(document).on("change","#"+e.svgid_ct+"_label",(function(t){e.icn3d,t.preventDefault();let s=$("#"+e.svgid_ct+"_label").val();$("#"+e.svgid_ct+" text").removeClass(),$("#"+e.svgid_ct+" text").addClass(s),e.htmlCls.clickMenuCls.setLogCmd("cartoon label "+s,!0)})),e.myEventCls.onIds("#"+e.linegraphid+"_svg","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.linegraphid,s.inputid+"_line_graph.svg")})),e.myEventCls.onIds("#"+e.linegraphid+"_png","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.savePng(e.linegraphid,s.inputid+"_line_graph.png")})),e.myEventCls.onIds("#"+e.linegraphid+"_json","click",(function(t){let s=e.icn3d;t.preventDefault();let i=s.lineGraphStr.substr(0,s.lineGraphStr.lastIndexOf("}"));i+=e.htmlCls.setHtmlCls.getLinkColor(),s.saveFileCls.saveFile(s.inputid+"_line_graph.json","text",[i])})),e.myEventCls.onIds("#"+e.linegraphid+"_scale","change",(function(t){let s=e.icn3d;t.preventDefault();let i=$("#"+e.linegraphid+"_scale").val();$("#"+e.linegraphid).attr("width",(s.linegraphWidth*parseFloat(i)).toString()+"px"),e.htmlCls.clickMenuCls.setLogCmd("line graph scale "+i,!0)})),e.myEventCls.onIds("#"+e.scatterplotid+"_svg","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.scatterplotid,s.inputid+"_scatterplot.svg")})),e.myEventCls.onIds("#"+e.scatterplotid+"_png","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.savePng(e.scatterplotid,s.inputid+"_scatterplot.png")})),e.myEventCls.onIds("#"+e.scatterplotid+"_json","click",(function(t){let s=e.icn3d;t.preventDefault();let i=s.scatterplotStr.substr(0,s.scatterplotStr.lastIndexOf("}"));i+=e.htmlCls.setHtmlCls.getLinkColor(),s.saveFileCls.saveFile(s.inputid+"_scatterplot.json","text",[i])})),e.myEventCls.onIds("#"+e.scatterplotid+"_scale","change",(function(t){let s=e.icn3d;t.preventDefault();let i=$("#"+e.scatterplotid+"_scale").val();$("#"+e.scatterplotid).attr("width",(s.scatterplotWidth*parseFloat(i)).toString()+"px"),e.htmlCls.clickMenuCls.setLogCmd("scatterplot scale "+i,!0)})),e.myEventCls.onIds("#"+e.contactmapid+"_svg","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.contactmapid,s.inputid+"_contactmap.svg",!0)})),e.myEventCls.onIds("#"+e.contactmapid+"_png","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.savePng(e.contactmapid,s.inputid+"_contactmap.png",!0)})),e.myEventCls.onIds("#"+e.contactmapid+"_json","click",(function(t){let s=e.icn3d;t.preventDefault();let i=s.contactmapStr.substr(0,s.contactmapStr.lastIndexOf("}"));i+=e.htmlCls.setHtmlCls.getLinkColor(),s.saveFileCls.saveFile(s.inputid+"_contactmap.json","text",[i])})),e.myEventCls.onIds("#"+e.contactmapid+"_scale","change",(function(t){let s=e.icn3d;t.preventDefault();let i=$("#"+e.contactmapid+"_scale").val();$("#"+e.contactmapid).attr("width",(s.contactmapWidth*parseFloat(i)).toString()+"px"),e.htmlCls.clickMenuCls.setLogCmd("contactmap scale "+i,!0)})),e.myEventCls.onIds("#"+e.alignerrormapid+"_svg","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.alignerrormapid,s.inputid+"_alignerrormap.svg",!0)})),e.myEventCls.onIds("#"+e.alignerrormapid+"_png","click",(function(t){let s=e.icn3d;t.preventDefault(),s.saveFileCls.savePng(e.alignerrormapid,s.inputid+"_alignerrormap.png",!0)})),e.myEventCls.onIds("#"+e.alignerrormapid+"_full","click",(function(t){let s=e.icn3d;t.preventDefault(),s.contactMapCls.afErrorMap(afid,!0)})),e.myEventCls.onIds("#"+e.alignerrormapid+"_json","click",(function(t){let s=e.icn3d;t.preventDefault();let i=s.alignerrormapStr.substr(0,s.alignerrormapStr.lastIndexOf("}"));i+=e.htmlCls.setHtmlCls.getLinkColor(),s.saveFileCls.saveFile(s.inputid+"_alignerrormap.json","text",[i])})),e.myEventCls.onIds("#"+e.alignerrormapid+"_scale","change",(function(t){let s=e.icn3d;t.preventDefault();let i=$("#"+e.alignerrormapid+"_scale").val();$("#"+e.alignerrormapid).attr("width",(s.alignerrormapWidth*parseFloat(i)).toString()+"px"),e.htmlCls.clickMenuCls.setLogCmd("alignerrormap scale "+i,!0)})),e.myEventCls.onIds("#"+e.svgid+"_label","change",(function(t){e.icn3d,t.preventDefault();let s=$("#"+e.svgid+"_label").val();$("#"+e.svgid+" text").removeClass(),$("#"+e.svgid+" text").addClass(s),e.htmlCls.clickMenuCls.setLogCmd("graph label "+s,!0)})),e.myEventCls.onIds("#"+e.svgid+"_hideedges","change",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.hideedges=parseInt($("#"+e.svgid+"_hideedges").val()),e.htmlCls.hideedges?(e.htmlCls.contactInsideColor="FFF",e.htmlCls.hbondInsideColor="FFF",e.htmlCls.ionicInsideColor="FFF"):(e.htmlCls.contactInsideColor="DDD",e.htmlCls.hbondInsideColor="AFA",e.htmlCls.ionicInsideColor="8FF"),void 0!==s.graphStr&&(s.bRender&&e.htmlCls.force&&e.drawGraph(s.graphStr,e.pre+"dl_graph"),e.htmlCls.clickMenuCls.setLogCmd("hide edges "+e.htmlCls.hideedges,!0))})),e.myEventCls.onIds("#"+e.svgid+"_force","change",(function(t){let s=e.icn3d;t.preventDefault(),e.htmlCls.force=parseInt($("#"+e.svgid+"_force").val()),void 0!==s.graphStr&&(e.htmlCls.clickMenuCls.setLogCmd("graph force "+e.htmlCls.force,!0),s.getGraphCls.handleForce())})),e.myEventCls.onIds("#"+e.pre+"hbondReset","click",(function(t){let s=e.icn3d;t.preventDefault(),s.viewInterPairsCls.resetInteractionPairs(),e.htmlCls.clickMenuCls.setLogCmd("reset interaction pairs",!0)})),e.myEventCls.onIds("#"+e.pre+"applypick_labels","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=$("#"+e.pre+"labeltext").val(),l=$("#"+e.pre+"labelsize").val(),n=$("#"+e.pre+"labelcolor").val(),r=$("#"+e.pre+"labelbkgd").val();if("0"!==l&&""!==l&&"undefined"!==l||(l=0),"0"!==n&&""!==n&&"undefined"!==n||(n=0),"0"!==r&&""!==r&&"undefined"!==r||(r=0),void 0===s.pAtom||void 0===s.pAtom2)alert("Please pick another atom");else{let t=(s.pAtom.coord.x+s.pAtom2.coord.x)/2,o=(s.pAtom.coord.y+s.pAtom2.coord.y)/2,a=(s.pAtom.coord.z+s.pAtom2.coord.z)/2;s.analysisCls.addLabel(i,t,o,a,l,n,r,"custom"),s.pickpair=!1;let d="",c="",h="";0!=l&&(d=" | size "+l),0!=n&&(c=" | color "+n),0!=r&&(h=" | background "+r),e.htmlCls.clickMenuCls.setLogCmd("add label "+i+" | x "+t.toPrecision(4)+" y "+o.toPrecision(4)+" z "+a.toPrecision(4)+d+c+h+" | type custom",!0),s.drawCls.draw()}})),e.myEventCls.onIds("#"+e.pre+"applyselection_labels","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");let i=$("#"+e.pre+"labeltext2").val(),l=$("#"+e.pre+"labelsize2").val(),n=$("#"+e.pre+"labelcolor2").val(),r=$("#"+e.pre+"labelbkgd2").val();"0"!==l&&""!==l&&"undefined"!==l||(l=0),"0"!==n&&""!==n&&"undefined"!==n||(n=0),"0"!==r&&""!==r&&"undefined"!==r||(r=0);let o=s.applyCenterCls.centerAtoms(e.hashUtilsCls.hash2Atoms(s.hAtoms,s.atoms)),a=o.center.x,d=o.center.y,c=o.center.z;s.analysisCls.addLabel(i,a,d,c,l,n,r,"custom");let h="",m="",p="";0!=l&&(h=" | size "+l),0!=n&&(m=" | color "+n),0!=r&&(p=" | background "+r),e.htmlCls.clickMenuCls.setLogCmd("add label "+i+" | x "+a.toPrecision(4)+" y "+d.toPrecision(4)+" z "+c.toPrecision(4)+h+m+p+" | type custom",!0),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"applylabelcolor","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.labelcolor=$("#"+e.pre+"labelcolorall").val(),e.htmlCls.clickMenuCls.setLogCmd("set label color "+s.labelcolor,!0),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"applypick_stabilizer","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),void 0===s.pAtom||void 0===s.pAtom2?alert("Please pick another atom"):(s.pickpair=!1,e.htmlCls.clickMenuCls.setLogCmd("add one stabilizer | "+s.pAtom.serial+" "+s.pAtom2.serial,!0),void 0===s.pairArray&&(s.pairArray=[]),s.pairArray.push(s.pAtom.serial),s.pairArray.push(s.pAtom2.serial),s.threeDPrintCls.setThichknessFor3Dprint(),s.drawCls.draw())}));let n=new CP(document.querySelector("#"+e.pre+"colorcustom"));n.on("change",(function(e){this.target.value=e})),e.myEventCls.onIds("#"+e.pre+"colorcustom","input",(function(){let t=$("#"+e.pre+"colorcustom").val();n.set("#"+t).enter()})),e.myEventCls.onIds("#"+e.pre+"colorcustom","keyup",(function(){let t=$("#"+e.pre+"colorcustom").val();n.set("#"+t).enter()})),e.myEventCls.onIds("#"+e.pre+"colorcustom","paste",(function(){let t=$("#"+e.pre+"colorcustom").val();n.set("#"+t).enter()})),e.myEventCls.onIds("#"+e.pre+"colorcustom","cut",(function(){let t=$("#"+e.pre+"colorcustom").val();n.set("#"+t).enter()})),e.myEventCls.onIds("#"+e.pre+"applypick_stabilizer_rm","click",(function(t){let s=e.icn3d;if(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),void 0===s.pAtom||void 0===s.pAtom2)alert("Please pick another atom");else{s.pickpair=!1,e.htmlCls.clickMenuCls.setLogCmd("remove one stabilizer | "+s.pAtom.serial+" "+s.pAtom2.serial,!0);let t=[];t.push(s.pAtom.serial),t.push(s.pAtom2.serial),s.threeDPrintCls.removeOneStabilizer(t),s.drawCls.draw()}})),e.myEventCls.onIds("#"+e.pre+"applypick_measuredistance","click",(function(t){let s=e.icn3d;if(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.bMeasureDistance=!1,void 0===s.pAtom||void 0===s.pAtom2)alert("Please pick another atom");else{let t=0,i=0,l=$("#"+e.pre+"linecolor").val(),n=(s.pAtom.coord.x+s.pAtom2.coord.x)/2,r=(s.pAtom.coord.y+s.pAtom2.coord.y)/2,o=(s.pAtom.coord.z+s.pAtom2.coord.z)/2;s.analysisCls.addLineFromPicking("distance");let a=(parseInt(10*s.pAtom.coord.distanceTo(s.pAtom2.coord))/10).toString()+" A";s.analysisCls.addLabel(a,n,r,o,t,l,i,"distance");let d="",c="",h="";0!=l&&(c=" | color "+l),e.htmlCls.clickMenuCls.setLogCmd("add label "+a+" | x "+n.toPrecision(4)+" y "+r.toPrecision(4)+" z "+o.toPrecision(4)+d+c+h+" | type distance",!0),s.drawCls.draw(),s.pk=2}})),e.myEventCls.onIds("#"+e.pre+"applydist2","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.bMeasureDistance=!1;let i=$("#"+e.pre+"atomsCustomDist").val(),l=$("#"+e.pre+"atomsCustomDist2").val();s.analysisCls.measureDistTwoSets(i,l),e.htmlCls.clickMenuCls.setLogCmd("dist | "+l+" "+i,!0)})),$(document).on("click",".icn3d-distance",(function(t){let s=e.icn3d;t.preventDefault(),s.bMeasureDistance=!1,s.distPnts=[],s.labels.distance=[],s.lines.distance=[];let i=$(this).attr("sets").split("|"),l=[i[0]],n=[i[1]];s.analysisCls.measureDistTwoSets(l,n),e.htmlCls.clickMenuCls.setLogCmd("dist | "+n+" "+l,!0)})),e.myEventCls.onIds("#"+e.pre+"applydisttable","click",(function(t){let s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.bMeasureDistance=!1;let i=$("#"+e.pre+"atomsCustomDistTable").val(),l=$("#"+e.pre+"atomsCustomDistTable2").val();s.analysisCls.measureDistManySets(i,l),e.htmlCls.dialogCls.openDlg("dl_disttable","Distance among the sets"),e.htmlCls.clickMenuCls.setLogCmd("disttable | "+l+" "+i,!0)})),e.myEventCls.onIds("#"+e.pre+"apply_thickness_3dprint","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.setHtmlCls.setLineThickness("3dprint")})),e.myEventCls.onIds("#"+e.pre+"apply_thickness_style","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.setHtmlCls.setLineThickness("style")})),e.myEventCls.onIds("#"+e.pre+"reset_thickness_3dprint","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.setHtmlCls.setLineThickness("3dprint",!0)})),e.myEventCls.onIds("#"+e.pre+"reset_thickness_style","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.setHtmlCls.setLineThickness("style",!0)})),e.myEventCls.onIds("#"+e.pre+"reset","click",(function(t){let s=e.icn3d;s.selectionCls.resetAll(),s.bRender&&s.drawCls.draw()})),e.myEventCls.onIds(["#"+e.pre+"toggleHighlight","#"+e.pre+"toggleHighlight2"],"click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.hlUpdateCls.toggleHighlight(),e.htmlCls.clickMenuCls.setLogCmd("toggle highlight",!0)})),e.myEventCls.onIds("#"+e.pre+"seq_clearselection","click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),e.cfg.notebook||dialog.dialog("close"),s.hlUpdateCls.clearHighlight(),e.htmlCls.clickMenuCls.setLogCmd("clear selection",!0)})),e.myEventCls.onIds("#"+e.pre+"seq_clearselection2","click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),t.preventDefault(),s.hlUpdateCls.clearHighlight(),e.htmlCls.clickMenuCls.setLogCmd("clear selection",!0)})),e.myEventCls.onIds("#"+e.pre+"alignseq_clearselection","click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.hlUpdateCls.clearHighlight(),e.htmlCls.clickMenuCls.setLogCmd("clear selection",!0)})),e.myEventCls.onIds("#"+e.pre+"replay","click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.CURRENTNUMBER++;let i=e.cfg.replay?s.STATENUMBER:s.STATENUMBER-1;if(s.CURRENTNUMBER==i)s.bReplay=0,$("#"+e.pre+"replay").hide();else if(s.commands.length>0&&s.commands[s.CURRENTNUMBER]){s.loadScriptCls.execCommandsBase(s.CURRENTNUMBER,s.CURRENTNUMBER,s.STATENUMBER);let t=s.commands[s.CURRENTNUMBER].indexOf("|||"),i=-1!=t?s.commands[s.CURRENTNUMBER].substr(0,t):s.commands[s.CURRENTNUMBER],l=30,n=i.length>l?i.substr(0,l)+"...":i,r=s.applyCommandCls.getMenuFromCmd(n);$("#"+e.pre+"replay_cmd").html("Cmd: "+n),$("#"+e.pre+"replay_menu").html("Menu: "+r),e.htmlCls.clickMenuCls.setLogCmd(i,!0),s.drawCls.draw()}})),t.loadScriptCls.pressCommandtext(),e.myEventCls.onIds("#"+e.pre+"seq_saveselection","click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),e.cfg.notebook||dialog.dialog("close"),s.selectionCls.saveSelectionPrep();let i=$("#"+e.pre+"seq_command_name").val().replace(/\s+/g,"_");s.selectionCls.saveSelection(i,i)})),e.myEventCls.onIds("#"+e.pre+"seq_saveselection2","click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.selectionCls.saveSelectionPrep();let i=$("#"+e.pre+"seq_command_name2").val().replace(/\s+/g,"_");s.selectionCls.saveSelection(i,i)})),e.myEventCls.onIds("#"+e.pre+"alignseq_saveselection","click",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.selectionCls.saveSelectionPrep();let i=$("#"+e.pre+"alignseq_command_name").val().replace(/\s+/g,"_");s.selectionCls.saveSelection(i,i)})),$(document).on("click","."+e.pre+"outputselection",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.bSelectResidue=!1,s.bSelectAlignResidue=!1,e.htmlCls.clickMenuCls.setLogCmd("output selection",!0),s.threeDPrintCls.outputSelection()})),$(document).on("click",".icn3d-saveicon",(function(t){e.icn3d,t.stopImmediatePropagation();let i=$(this).attr("pid");s.saveHtml(i),e.htmlCls.clickMenuCls.setLogCmd("save html "+i,!0)})),$(document).on("click",".icn3d-hideicon",(function(t){let s=e.icn3d;t.stopImmediatePropagation();let i=$(this).attr("pid");if(!e.cfg.notebook)if(void 0===s.dialogHashHideDone&&(s.dialogHashHideDone={}),void 0===s.dialogHashPosToRight&&(s.dialogHashPosToRight={}),s.dialogHashHideDone.hasOwnProperty(i)){let e=s.dialogHashHideDone[i].width,t=s.dialogHashHideDone[i].height,l=s.dialogHashHideDone[i].position;$("#"+i).dialog("option","width",e),$("#"+i).dialog("option","height",t),$("#"+i).dialog("option","position",l),delete s.dialogHashHideDone[i]}else{s.dialogHashHideDone[i]={width:$("#"+i).dialog("option","width"),height:$("#"+i).dialog("option","height"),position:$("#"+i).dialog("option","position")};let e,t=160,l=80;$("#"+i).dialog("option","width",t),$("#"+i).dialog("option","height",l),s.dialogHashPosToRight.hasOwnProperty(i)?e=s.dialogHashPosToRight[i]:(e=Object.keys(s.dialogHashPosToRight).length*(t+10),s.dialogHashPosToRight[i]=e);let n={my:"right bottom",at:"right-"+e+" bottom+60",of:"#"+s.divid,collision:"none"};$("#"+i).dialog("option","position",n)}})),$(document).on("click","."+e.pre+"selres",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.bSelOneRes=!1;let i=$("."+e.pre+"seloneres");for(let e=0,t=i.length;e<t;++e)i[e].checked=!1;let l=$(this).attr("resid").split("|");s.hAtoms={},s.selectedResidues={};let n="select ";for(let e=0,t=l.length;e<t;++e){let t=l[e];e>0&&(n+=" or "),n+=s.selectionCls.selectOneResid(t)}s.hlUpdateCls.updateHlAll(),e.htmlCls.clickMenuCls.setLogCmd(n,!0)})),$(document).on("click","."+e.pre+"seloneres",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.bSelOneRes||(s.hAtoms={},s.selectedResidues={},s.bSelOneRes=!0);let i=$(this).attr("resid"),l=$(this).attr("id");$("#"+l).length&&$("#"+l)[0].checked?s.selectionCls.selectOneResid(i):$("#"+l).length&&!$("#"+l)[0].checked&&s.selectionCls.selectOneResid(i,!0),s.hlUpdateCls.updateHlAll()})),$(document).on("click","."+e.pre+"selset",(function(t){let s=e.icn3d;t.stopImmediatePropagation(),s.bSelOneRes=!1;let i=$("."+e.pre+"seloneres");for(let e=0,t=i.length;e<t;++e)i[e].checked=!1;let l=$(this).attr("cmd");s.selByCommCls.selectByCommand(l,"",""),s.hlObjectsCls.removeHlObjects(),s.hlObjectsCls.addHlObjects(),e.htmlCls.clickMenuCls.setLogCmd(l,!0)})),$(document).on("click",".icn3d-addtrack",(function(t){e.icn3d,t.stopImmediatePropagation(),$("#"+e.pre+"anno_custom")[0].checked=!0,$("[id^="+e.pre+"custom]").show();let s=$(this).attr("chainid");$("#"+e.pre+"track_chainid").val(s),e.htmlCls.dialogCls.openDlg("dl_addtrack","Add track for Chain: "+s),$("#"+e.pre+"track_gi").focus()})),$(document).on("click",".icn3d-customcolor",(function(t){e.icn3d,t.stopImmediatePropagation();let s=$(this).attr("chainid");$("#"+e.pre+"customcolor_chainid").val(s),e.htmlCls.dialogCls.openDlg("dl_customcolor","Apply custom color or tube for Chain: "+s)})),$(document).on("click",".icn3d-helixsets",(function(t){let s=e.icn3d;t.stopImmediatePropagation();let i=$(this).attr("chainid");s.addTrackCls.defineSecondary(i,"helix"),e.htmlCls.clickMenuCls.setLogCmd("define helix sets | chain "+i,!0)})),$(document).on("click",".icn3d-sheetsets",(function(t){let s=e.icn3d;t.stopImmediatePropagation();let i=$(this).attr("chainid");s.addTrackCls.defineSecondary(i,"sheet"),e.htmlCls.clickMenuCls.setLogCmd("define sheet sets | chain "+i,!0)})),$(document).on("click",".icn3d-coilsets",(function(t){let s=e.icn3d;t.stopImmediatePropagation();let i=$(this).attr("chainid");s.addTrackCls.defineSecondary(i,"coil"),e.htmlCls.clickMenuCls.setLogCmd("define coil sets | chain "+i,!0)})),e.myEventCls.onIds("#"+e.pre+"deletesets","click",(function(t){e.icn3d.definedSetsCls.deleteSelectedSets(),e.htmlCls.clickMenuCls.setLogCmd("delete selected sets",!0)})),$(document).on("mouseup touchend","accordion",(function(t){let s=e.icn3d;s.bControlGl&&!e.bNode?window.controls&&(window.controls.noRotate=!1,window.controls.noZoom=!1,window.controls.noPan=!1):s.controls&&(s.controls.noRotate=!1,s.controls.noZoom=!1,s.controls.noPan=!1)})),$(document).on("mousedown touchstart","accordion",(function(t){let s=e.icn3d;s.bControlGl&&!e.bNode?window.controls&&(window.controls.noRotate=!0,window.controls.noZoom=!0,window.controls.noPan=!0):s.controls&&(s.controls.noRotate=!0,s.controls.noZoom=!0,s.controls.noPan=!0)})),$(document).on("click",".icn3d-expand",(function(t){e.icn3d,t.stopImmediatePropagation();let s=$(this).attr("id"),i=s.lastIndexOf("_"),l=s.substr(0,i);$("#"+l).show(),$("#"+l+"_expand").hide(),$("#"+l+"_shrink").show()})),$(document).on("click",".icn3d-shrink",(function(t){e.icn3d,t.stopImmediatePropagation();let s=$(this).attr("id"),i=s.lastIndexOf("_"),l=s.substr(0,i);$("#"+l).hide(),$("#"+l+"_expand").show(),$("#"+l+"_shrink").hide()})),window.onscroll=function(t){let s=e.icn3d;"detailed view"==s.view&&0==$(window).scrollTop()&&0==$(window).scrollTop()&&0==$("#"+e.pre+"dl_selectannotations").scrollTop()?s.annotationCls.showFixedTitle():s.annotationCls.hideFixedTitle()},e.myEventCls.onIds("#"+e.pre+"dl_selectannotations","scroll",(function(){"detailed view"==t.view&&0==$(window).scrollTop()&&0==$(window).scrollTop()&&0==$("#"+e.pre+"dl_selectannotations").scrollTop()?t.annotationCls.showFixedTitle():t.annotationCls.hideFixedTitle()})),e.myEventCls.onIds("#"+e.pre+"mn6_themeBlue","click",(function(t){e.icn3d,e.htmlCls.setMenuCls.setTheme("blue"),e.htmlCls.clickMenuCls.setLogCmd("set theme blue",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_themeOrange","click",(function(t){e.icn3d,e.htmlCls.setMenuCls.setTheme("orange"),e.htmlCls.clickMenuCls.setLogCmd("set theme orange",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_themeBlack","click",(function(t){e.icn3d,e.htmlCls.setMenuCls.setTheme("black"),e.htmlCls.clickMenuCls.setLogCmd("set theme black",!0)})),$(document).on("click","."+e.pre+"snpin3d",(function(t){let s=e.icn3d;t.stopImmediatePropagation();let i=$(this).attr("snp");s.scapCls.retrieveScap(i),e.htmlCls.clickMenuCls.setLogCmd("scap 3d "+i,!0),e.htmlCls.clickMenuCls.setLogCmd("select displayed set",!0)})),$(document).on("click","."+e.pre+"snpinter",(function(t){let s=e.icn3d;t.stopImmediatePropagation();let i=$(this).attr("snp");s.scapCls.retrieveScap(i,!0),e.htmlCls.clickMenuCls.setLogCmd("scap interaction "+i,!0);let l=i.split("_"),n="."+l[1]+":"+l[2],r="snp_"+l[1]+"_"+l[2];e.htmlCls.clickMenuCls.setLogCmd("select "+n+" | name "+r,!0),e.htmlCls.clickMenuCls.setLogCmd("line graph interaction pairs | selected non-selected | hbonds,salt bridge,interactions,halogen,pi-cation,pi-stacking | false | threshold 3.8 6 4 3.8 6 5.5",!0),e.htmlCls.clickMenuCls.setLogCmd("adjust dialog dl_linegraph",!0),e.htmlCls.clickMenuCls.setLogCmd("select displayed set",!0)})),$(document).on("click","."+e.pre+"snppdb",(function(t){let s=e.icn3d;t.stopImmediatePropagation();let i=$(this).attr("snp");s.scapCls.retrieveScap(i,void 0,!0),e.htmlCls.clickMenuCls.setLogCmd("scap pdb "+i,!0)}))}}class lt{constructor(e){this.icn3dui=e}getAlignSequencesAnnotations(e,t,s,i,l,n){let r=this.icn3dui,o=r.icn3d,a="";e=Object.keys(o.alnChains),n&&(e=e.reverse());let d=0,c={};if(void 0!==e)for(let t=0,s=e.length;t<s;++t)c[e[t]]=1;let h,m=void 0===t||t;m&&(o.hAtoms={});let p,u,C=0,g=0;for(let t=0,n=e.length;t<n;++t){let n=e[t];0==C&&(p=n),u=l&&C>0?p:n,m&&(o.hAtoms=r.hashUtilsCls.unionHash(o.hAtoms,o.alnChains[n]));let f=[],b="",y=void 0!==o.alnChainsSeq[n]?o.alnChainsSeq[n].length:0;y>d&&(d=y);let v=u.indexOf("_"),_=u.substr(0,v),S=u.substr(v+1);b+="<span class='icn3d-residueNum' title='starting residue number'>"+(void 0!==o.alnChainsSeq[n][0]?o.alnChainsSeq[n][0].resi:"")+"</span>",h=!(void 0===e||!c.hasOwnProperty(u));for(let e=0,t=y;e<t;++e){let t="N/A",a="";""===o.alnChainsSeq[n][e].resi||isNaN(o.alnChainsSeq[n][e].resi)||(t=o.alnChainsSeq[n][e].resi,a=_+"_"+S+"_"+t,o.alnChainsSeq[n][e].color);let d,c="class='icn3d-residue";if((void 0===i||i)&&(h||void 0!==s&&""!==a&&-1!==s.indexOf(a))&&(c="class='icn3d-residue icn3d-highlightSeq"),c+=""===a?"'":" "+o.alnChainsSeq[n][e].class+"'",o.residues.hasOwnProperty(a)){let e=o.firstAtomObjCls.getFirstCalphaAtomObj(o.residues[a]);d=void 0!==e.color?"#"+e.color.getHexString()+";":"#000000;"}else d="#000000;";if("#FFFFFF;"===d.toUpperCase()&&(d=r.htmlCls.GREYD),l&&0==e){b+="<span style='width:"+g*10+"px'></span>"}""!==a?-1!=o.alnChainsSeq[n][e].resi?b+="<span id='align_"+r.pre+a+"' "+c+" style='color:"+d+"' title='"+o.alnChainsSeq[n][e].resn+o.alnChainsSeq[n][e].resi+"'>"+o.alnChainsSeq[n][e].resn+"</span>":b+="<span>"+o.alnChainsSeq[n][e].resn+"</span>":b+="<span title='"+o.alnChainsSeq[n][e].resn+o.alnChainsSeq[n][e].resi+"'>"+o.alnChainsSeq[n][e].resn+"</span>"}b+="<span class='icn3d-residueNum' title='ending residue number'>"+(void 0!==o.alnChainsSeq[n][y-1]?o.alnChainsSeq[n][y-1].resi:"")+"</span>";let w=void 0!==o.alnChainsAnno[n]?o.alnChainsAnno[n].length:0;for(let e=0,t=w;e<t;++e){f[e]="";let t=0==e&&w>=7?o.alnChainsAnTtl[n][4][0]:u;f[e]+="<span class='icn3d-residueNum'></span>";for(let s=0,i=o.alnChainsAnno[n][e].length;s<i;++s){let i=o.alnChainsAnno[n][e][s];if("H"==i||"E"==i||"c"==i||"o"==i)if("H"==i)f[e]+=s%2==0?'<span class="icn3d-helix">&nbsp;</span>':'<span class="icn3d-helix2">&nbsp;</span>';else if("E"==i){if(void 0!==o.alnChainsSeq[t][s]){let i=t+"_"+o.alnChainsSeq[t][s].resi;if(o.residues.hasOwnProperty(i)){o.firstAtomObjCls.getFirstCalphaAtomObj(o.residues[i]).ssend?f[e]+='<span class="icn3d-sheet2">&nbsp;</span>':f[e]+='<span class="icn3d-sheet">&nbsp;</span>'}}}else f[e]+="c"==i?'<span class="icn3d-coil">&nbsp;</span>':"o"==i?'<span class="icn3d-other">&nbsp;</span>':"<span></span>";else f[e]+="<span>"+i+"</span>"}f[e]+="<span class='icn3d-residueNum'></span>"}let A=n,x=void 0!==o.pdbid_chain2title?o.pdbid_chain2title[u]:"";for(let e=w-1;e>=0;--e){let t=o.alnChainsAnTtl[n][e][0];"SS"==t&&(t=""),a+="<div class='icn3d-residueLine' style='white-space:nowrap;'><div class='icn3d-seqTitle' anno='"+e+"'>"+t+"</div>"+f[e]+"<br/></div>"}a+='<div class="icn3d-seqTitle icn3d-link icn3d-blue" chain="'+n+'" anno="sequence" title="'+x+'">'+A+' </div><span class="icn3d-seqLine">'+b+"</span><br/>",C>0&&(g+=y),++C}return{sequencesHtml:a,maxSeqCnt:d}}}class nt{constructor(e){this.icn3dui=e}getLink(e,t){let s=this.icn3dui;return s.icn3d,"<li><span id='"+s.pre+e+"' class='icn3d-link'>"+t+"</span></li>"}getLinkWrapper(e,t,s){let i=this.icn3dui;return i.icn3d,"<li id='"+i.pre+s+"'><span id='"+i.pre+e+"' class='icn3d-link'>"+t+"</span></li>"}getRadio(e,t,s,i){let l=this.icn3dui;l.icn3d;let n=i?" checked":"";return"<li><label for='"+l.pre+t+"' class='icn3d-rad'>"+l.htmlCls.inputRadioStr+"name='"+l.pre+e+"' class='"+l.pre+e+"' v='"+s+"' id='"+l.pre+t+"'"+n+"><span class='ui-icon ui-icon-blank'></span> <span class='icn3d-rad-text'>"+s+"</span></label></li>"}getRadioColor(e,t,s,i,l){let n=this.icn3dui;n.icn3d;let r=l?" checked":"";return"<li><label for='"+n.pre+t+"' class='icn3d-rad'>"+n.htmlCls.inputRadioStr+"name='"+n.pre+e+"' id='"+n.pre+t+"'"+r+"><span class='ui-icon ui-icon-blank'></span> <span class='icn3d-color-rad-text' color='"+i+"'><span style='background-color:#"+i+"'>"+n.htmlCls.space3+"</span> "+s+"</span></label></li>"}setAdvanced(e){let t=this.icn3dui;t.icn3d;let s=void 0===e?"":e,i=t.cfg.notebook?"icn3d-hidden":"",l=t.htmlCls.divStr+"dl_advanced"+s+"' class='"+i+"'>";return l+="<table width='500'><tr><td valign='top'><table cellspacing='0'>",l+="<tr><td><b>Select:</b></td><td>"+t.htmlCls.inputTextStr+"id='"+t.pre+"command"+s+"' placeholder='$[structures].[chains]:[residues]@[atoms]' size='60'></td></tr>",l+="<tr><td><b>Name:</b></td><td>"+t.htmlCls.inputTextStr+"id='"+t.pre+"command_name"+s+"' placeholder='my_selection' size='60'></td></tr>",l+="<tr><td colspan='2' align='left'>"+t.htmlCls.space3+t.htmlCls.buttonStr+"command_apply"+s+"'><b>Save Selection to Defined Sets</b></button></td></tr>",l+="</table></td>",l+="</tr>",l+="<tr><td>",l+='Specification Tips: <div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+t.pre+"specguide"+s+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+t.pre+"specguide"+s+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',l+=t.htmlCls.divStr+"specguide"+s+"' style='display:none; width:500px' class='icn3d-box'>",l+='<b>Specification:</b> In the selection "$1HHO,4N7N.A,B,C:5-10,LV,3AlaVal,chemicals@CA,C":',l+='<ul><li>"$1HHO,4N7N" uses "$" to indicate structure selection.<br/>',l+='<li>".A,B,C" uses "." to indicate chain selection.<br/>',l+='<li>":5-10,LV,3LeuVal,chemicals" uses the colon ":" to indicate residue selection. Residue selection could be residue number(5-10), one-letter IUPAC residue name abbreviations(LV), three-letter residue names(AlaVal, "3" indicates each residue name has three letters), or predefined names: "proteins", "nucleotides", "chemicals", "ions", and "water". IUPAC abbreviations can be written either as a contiguous string(e.g., ":LV"), in order to find all instances of that sequence in the structure, or they can be separated by commas(e.g., ":L,V") to select all residues of a given type in the structure(in the latter case, select all Leucine and Valine in the structure).<br/>',l+='<li>"@CA,C" uses "@" to indicate atom selection.<br/>',l+='<li>Partial definition is allowed, e.g., ":1-10" selects all residue IDs 1-10 in all chains.<br/>',l+='<li>Different selections can be unioned(with "<b>or</b>", default), intersected(with "<b>and</b>"), or negated(with "<b>not</b>"). For example, ":1-10 or :K" selects all residues 1-10 and all Lys residues. ":1-10 and :K" selects all Lys residues in the range of residue number 1-10. ":1-10 or not :K" selects all residues 1-10, which are not Lys residues.<br/>',l+='<li>The wild card character "X" or "x" can be used to represent any character.',l+="</ul>",l+="<b>Set Operation:</b>",l+='<ul><li>Users can select multiple sets in the menu "Select > Defined Sets".<br/>',l+='<li>Different sets can be unioned(with "<b>or</b>", default), intersected(with "<b>and</b>"), or negated(with "<b>not</b>"). For example, if the "Defined Sets" menu has four sets ":1-10", ":11-20", ":5-15", and ":7-8", the command "saved atoms :1-10 or :11-20 and :5-15 not :7-8" unions all residues 1-10 and 11-20 to get the residues 1-20, then intersects with the residues 5-15 to get the residues 5-15, then exclude the residues 7-8 to get the final residues 5-6 and 9-15.</ul>',l+="<b>Full commands in url or command window:</b>",l+="<ul><li>Select without saving the set: select $1HHO,4N7N.A,B,C:5-10,LV,chemicals@CA,C<br/>",l+="<li>Select and save: select $1HHO,4N7N.A,B,C:5-10,LV,chemicals@CA,C | name my_name</ul>",l+="</div>",l+="</td></tr></table>",l+="</div>",l}getOptionHtml(e,t){let s=this.icn3dui;s.icn3d;let i="";for(let l=0,n=e.length;l<n;++l){let n=e[l];i+=l==t?s.htmlCls.optionStr+"'"+n+"' selected>"+n+"</option>":s.htmlCls.optionStr+"'"+n+"'>"+n+"</option>"}return i}setColorHints(){let e=this.icn3dui;e.icn3d;let t="";return t+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px; color:#00FF00; font-weight:bold">Green</span>: H-Bonds; ',t+='<span style="color:#00FFFF; font-weight:bold">Cyan</span>: Salt Bridge/Ionic; ',t+='<span style="font-weight:bold">Grey</span>: contacts</div>',t+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px; color:#FF00FF; font-weight:bold">Magenta</span>: Halogen Bonds; ',t+='<span style="color:#FF0000; font-weight:bold">Red</span>: &pi;-Cation; ',t+='<span style="color:#0000FF; font-weight:bold">Blue</span>: &pi;-Stacking</div>',t}setThicknessHtml(e){let t=this.icn3dui;t.icn3d;let s="",i="3dprint"==e?"1":"0.1",l="3dprint"==e?"1.2":"0.3",n="3dprint"==e?"0.8":"0.4",r="3dprint"==e?"1":"0.4",o="3dprint"==e?"0.6":"0.3",a="3dprint"==e?"1":"0.2",d="3dprint"==e?"2":"1.3",c="3dprint"==e?"1.4":"0.8",h=40,m=.6,p=.4,u=.2,C=0,g=1;return"style"==e&&(""!=this.getCookie("shininess")&&(h=parseFloat(this.getCookie("shininess"))),""!=this.getCookie("light1")&&(m=parseFloat(this.getCookie("light1")),p=parseFloat(this.getCookie("light2")),u=parseFloat(this.getCookie("light3"))),""!=this.getCookie("lineRadius")&&(i=parseFloat(this.getCookie("lineRadius")),l=parseFloat(this.getCookie("coilWidth")),n=parseFloat(this.getCookie("cylinderRadius")),r=parseFloat(this.getCookie("traceRadius")),o=parseFloat(this.getCookie("dotSphereScale")),a=parseFloat(this.getCookie("ribbonthickness")),d=parseFloat(this.getCookie("helixSheetWidth")),c=parseFloat(this.getCookie("nucleicAcidWidth"))),""!=this.getCookie("glycan")&&(C=parseFloat(this.getCookie("glycan"))),""!=this.getCookie("membrane")&&(g=parseFloat(this.getCookie("membrane"))),s+="<b>Note</b>: The following parameters will be saved in cache. You just need to set them once. <br><br>",s+="<b>1. Shininess</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"shininess' value='"+h+"' size=4>"+t.htmlCls.space3+"(for the shininess of the 3D objects, default 40)<br/><br/>",s+="<b>2. Three directional lights</b>: <br>",s+="<b>Key Light</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"light1' value='"+m+"' size=4>"+t.htmlCls.space3+"(for the light strength of the key light, default 0.6)<br/>",s+="<b>Fill Light</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"light2' value='"+p+"' size=4>"+t.htmlCls.space3+"(for the light strength of the fill light, default 0.4)<br/>",s+="<b>Back Light</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"light3' value='"+u+"' size=4>"+t.htmlCls.space3+"(for the light strength of the back light, default 0.2)<br/><br/>",s+="<b>3. Thickness</b>: <br>"),s+="<b>Line Radius</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"linerad_"+e+"' value='"+i+"' size=4>"+t.htmlCls.space3+"(for stabilizers, hydrogen bonds, distance lines, default 0.1)<br/>",s+="<b>Coil Radius</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"coilrad_"+e+"' value='"+l+"' size=4>"+t.htmlCls.space3+"(for coils, default 0.3)<br/>",s+="<b>Stick Radius</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"stickrad_"+e+"' value='"+n+"' size=4>"+t.htmlCls.space3+"(for sticks, default 0.4)<br/>",s+="<b>Trace Radius</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"tracerad_"+e+"' value='"+r+"' size=4>"+t.htmlCls.space3+"(for C alpha trace, O3' trace, default 0.4)<br/>",s+="<b>Ribbon Thickness</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"ribbonthick_"+e+"' value='"+a+"' size=4>"+t.htmlCls.space3+"(for helix and sheet ribbons, nucleotide ribbons, default 0.2)<br/>",s+="<b>Protein Ribbon Width</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"prtribbonwidth_"+e+"' value='"+d+"' size=4>"+t.htmlCls.space3+"(for helix and sheet ribbons, default 1.3)<br/>",s+="<b>Nucleotide Ribbon Width</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"nucleotideribbonwidth_"+e+"' value='"+c+"' size=4>"+t.htmlCls.space3+"(for nucleotide ribbons, default 0.8)<br/>",s+="<b>Ball Scale</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"ballscale_"+e+"' value='"+o+"' size=4>"+t.htmlCls.space3+"(for styles 'Ball and Stick' and 'Dot', default 0.3)<br/>","style"==e&&(s+="<br><b>4. Show Glycan Cartoon</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"glycan' value='"+C+"' size=4>"+t.htmlCls.space3+"(0: hide, 1: show, default 0)<br/>",s+="<br><b>5. Show Membrane</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"membrane' value='"+g+"' size=4>"+t.htmlCls.space3+"(0: hide, 1: show, default 1)<br/><br/>"),s+=t.htmlCls.spanNowrapStr+""+t.htmlCls.buttonStr+"apply_thickness_"+e+"'>Apply</button></span>&nbsp;&nbsp;&nbsp;",s+=t.htmlCls.spanNowrapStr+""+t.htmlCls.buttonStr+"reset_thickness_"+e+"'>Reset</button></span>",s}getCookie(e){let t=e+"=",s=decodeURIComponent(document.cookie).split(";");for(let e=0;e<s.length;e++){let i=s[e];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}setSequenceGuide(e,t){let s=this.icn3dui,i=s.icn3d,l="",n=i&&i.defNames2Atoms?Object.keys(i.defNames2Atoms).length:1;t?l+=s.htmlCls.divStr+"seqguide"+e+"'>":(l+='<div style="width:20px; margin-left:3px; display:inline-block;"><span id="'+s.pre+"seqguide"+e+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+s.pre+"seqguide"+e+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div> ',l+="<div style='min-width:200px; display:inline-block;'><b>Selection:</b> Name: "+s.htmlCls.inputTextStr+"id='"+s.pre+"seq_command_name"+e+"' value='seq_"+n+"' size='5'> "+s.htmlCls.space2+"<button style='white-space:nowrap;' id='"+s.pre+"seq_saveselection"+e+"'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+s.pre+"seq_clearselection"+e+"'>Clear</button></div><br/>",l+=s.htmlCls.divStr+"seqguide"+e+"' style='display:none; white-space:normal;' class='icn3d-box'>"),l+=this.getSelectionHints();return l+="<b>Residue labeling:</b> standard residue with coordinates: UPPER case letter; nonstandard residue with coordinates: the first UPPER case letter plus a period except that water residue uses the letter 'O'; residue missing coordinates: lower case letter."+(s.utilsCls.isMac()&&!s.utilsCls.isMobile()?"<br/><br/><b>Turn on scroll bar:</b> System preferences -> General -> show scroll bars -> check Always":"")+"<br/></div>",l}setAlignSequenceGuide(e,t){let s=this.icn3dui,i=s.icn3d,l="";let n=i&&i.defNames2Atoms?Object.keys(i.defNames2Atoms).length:1;l+='<div style="width:20px; margin-left:3px; display:inline-block;"><span id="'+s.pre+'alignseqguide_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+s.pre+'alignseqguide_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div> ',l+="<div style='min-width:200px; display:inline-block;''><b>Selection:</b> Name: "+s.htmlCls.inputTextStr+"id='"+s.pre+"alignseq_command_name' value='alseq_"+n+"' size='10'> "+s.htmlCls.space2+"<button style='white-space:nowrap;' id='"+s.pre+"alignseq_saveselection'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+s.pre+"alignseq_clearselection'>Clear</button></div><br/>",l+=s.htmlCls.divStr+"alignseqguide' style='display:none; white-space:normal;' class='icn3d-box'>",l+=this.getSelectionHints();return l+="<b>Residue labeling:</b> aligned residue with coordinates: UPPER case letter; non-aligned residue with coordinates: lower case letter which can be highlighted; residue missing coordinates: lower case letter which can NOT be highlighted."+(s.utilsCls.isMac()&&!s.utilsCls.isMobile()?"<br/><br/><b>Turn on scroll bar:</b> System preferences -> General -> show scroll bars -> check Always":"")+"<br/></div>",l}getSelectionHints(){let e=this.icn3dui;e.icn3d;let t="";if(e.utilsCls.isMobile())t+='<b>Select Aligned Sequences:</b> touch to select, touch again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/>';else{t+='<b>Select on 1D sequences:</b> drag to select, drag again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/><br/>',t+="<b>Select on 2D interaction diagram:</b> click on the nodes or lines. The nodes are chains and can be united with the Ctrl key. The lines are interactions and can NOT be united. Each click on the lines selects half of the lines, i.e., select the interacting residues in one of the two chains.<br/><br/>",t+="<b>Select on 3D structures:</b> "+(e.utilsCls.isMobile()?"use finger to pick":'hold "Alt" and use mouse to pick')+', click the second time to deselect, hold "Ctrl" to union selection, hold "Shift" to select a range, press the up/down arrow to switch among atom/residue/strand/chain/structure, click "Save Selection" to save the current selection.<br/><br/>',t+='<b>Save the current selection</b>(either on 3D structure, 2D interactions, or 1D sequence): open the menu "Select -> Save Selection", specify the name and description for the selection, and click "Save".<br/><br/>'}return t}addGsizeSalt(e){let t=this.icn3dui;t.icn3d;let s="";s+="<span style='white-space:nowrap;font-weight:bold;'>Grid Size: <select id='"+t.pre+e+"gsize'>";s+=this.getOptionHtml(["65","97","129"],0),s+="</select></span>",s+="<span style='white-space:nowrap;font-weight:bold;margin-left:30px;'>Salt Concentration: <select id='"+t.pre+e+"salt'>";return s+=this.getOptionHtml(["0","0.15"],1),s+="</select> M</span><br/>",s}getFootHtml(e,t){let s=this.icn3dui;s.icn3d;let i="<div style='width:500px;'>";return"delphi"==e?s.cfg.cid?i+="<b>Note</b>: Partial charges(MMFF94) are from PubChem Compound SDF files.<br/><br/>":(i+="<b>Note</b>: Only the selected residues are used for <a href='http://honig.c2b2.columbia.edu/delphi'>DelPhi</a> potential calculation by solving linear Poisson-Boltzmann equation.",i+='<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+s.pre+t+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+s.pre+t+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',i+=s.htmlCls.divStr+t+"' style='display:none;'>",i+="<br>The hydrogens and partial charges of proteins and nucleotides are added using <a href='http://compbio.clemson.edu/pka_webserver'>DelPhiPKa</a> with the Amber charge and size files. The hydrogens of ligands are added using <a href='http://openbabel.org/wiki/Main_Page'>Open Babel</a>. The partial charges of ligands are calculated using <a href='http://ambermd.org/antechamber/ac.html'>Antechamber</a> with the Gasteiger charge method. All partial charges are calculated at pH 7.<br/><br/>",i+='Lipids are treated as ligands. Please use "HETATM" instead of "ATOM  " for each lipid atom in your PDB file. Each phosphate in lipids is assigned with a charge of -1. You can download PQR and modify it, or prepare your PQR file using other tools. Then load the PQR file at the menu "Analysis > Load PQR/Potential".<br/><br/>',i+="</div>"):(i+="<b>Note</b>: Always load a PDB file before loading a PQR or DelPhi potential file.",i+='<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+s.pre+t+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+s.pre+t+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',i+=s.htmlCls.divStr+t+"' style='display:none;'>",i+='The PDB file can be loaded in the URL with "pdbid=" or at "File > Open File". The PQR file can be prepared at the menu "Analysis > Download PQR" with your modification or using other tools. The DelPhi potential file can be calculated at <a href=\'http://compbio.clemson.edu/sapp/delphi_webserver/\'>DelPhi Web Server</a> and be exported as a Cube file. ',"url"==e&&(i+="The PQR or potential file can be accessed in a URL if it is located in the same host as iCn3D."),i+="<br/><br/>",i+="</div>"),i+="</div>",i}getPotentialHtml(e,t){let s=this.icn3dui;s.icn3d;let i,l,n,r,o,a="";r="Equipotential Map",o="Surface with Potential","delphi"==e?l="delphi":"local"==e?(i="pqr",l="phi",n="cube"):"url"==e&&(i="pqrurl",l="phiurl",n="cubeurl"),a+=s.htmlCls.divStr+"dl_"+l+"' class='"+t+"'>",a+=s.htmlCls.divStr+"dl_"+l+"_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+l+"tab1'>Equipotential Map</a></li>",a+="<li><a href='#"+s.pre+l+"tab2'>Surface with Potential</a></li>",a+="</ul>",a+=s.htmlCls.divStr+l+"tab1'>","delphi"==e&&(a+=this.addGsizeSalt(l)+"<br>"),a+="<span style='white-space:nowrap;font-weight:bold;'>Potential contour at: <select id='"+s.pre+l+"contour'>";let d;a+=this.getOptionHtml(["0.5","1","2","3","4","5","6","7","8","9","10"],2),a+="</select> kT/e(25.6mV at 298K)</span><br/><br/>","delphi"==e?(a+=s.htmlCls.buttonStr+"reload_"+l+"file' style='margin-top: 6px;'>Equipotential Map</button>",a+=s.htmlCls.buttonStr+l+"mapNo' style='margin-left:30px;'>Remove Map</button><br>"):"local"==e?(a+=s.htmlCls.divStr+l+"tab1_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+l+"tab1_"+i+"'>PQR</a></li>",a+="<li><a href='#"+s.pre+l+"tab1_"+l+"'>Phi</a></li>",a+="<li><a href='#"+s.pre+l+"tab1_"+n+"'>Cube</a></li>",a+="</ul>",d="<span style='margin-left:30px'>"+s.htmlCls.buttonStr+l+"mapNo'>Remove Map</button></span></div>",a+=s.htmlCls.divStr+l+"tab1_"+i+"'>",a+=this.addGsizeSalt(i)+"<br>",a+="<b>PQR File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+i+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+i+"file' style='margin-top: 6px;'>Equipotential Map</button>"+d,a+=s.htmlCls.divStr+l+"tab1_"+l+"'>",a+="<b>Phi File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+l+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+l+"file' style='margin-top: 6px;'>Equipotential Map</button>"+d,a+=s.htmlCls.divStr+l+"tab1_"+n+"'>",a+="<b>Cube File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+n+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+n+"file' style='margin-top: 6px;'>Equipotential Map</button>"+d,a+="</div>"):"url"==e&&(a+=s.htmlCls.divStr+l+"tab1_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+l+"tab1_"+i+"2'>PQR</a></li>",a+="<li><a href='#"+s.pre+l+"tab1_"+l+"2'>Phi</a></li>",a+="<li><a href='#"+s.pre+l+"tab1_"+n+"2'>Cube</a></li>",a+="</ul>",d="<span style='margin-left:30px'>"+s.htmlCls.buttonStr+l+"mapNo'>Remove Map</button></span></div>",a+=s.htmlCls.divStr+l+"tab1_"+i+"2'>",a+=this.addGsizeSalt(i)+"<br>",a+="<b>PQR URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+i+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+i+"file' style='margin-top: 6px;'>Equipotential Map</button>"+d,a+=s.htmlCls.divStr+l+"tab1_"+l+"2'>",a+="<b>Phi URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+l+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+l+"file' style='margin-top: 6px;'>Equipotential Map</button>"+d,a+=s.htmlCls.divStr+l+"tab1_"+n+"2'>",a+="<b>Cube URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+n+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+n+"file' style='margin-top: 6px;'>Equipotential Map</button>"+d,a+="</div>"),a+="<br>"+this.getFootHtml(e,l+"tab1_foot"),a+="</div>",a+=s.htmlCls.divStr+l+"tab2'>","delphi"==e&&(a+=this.addGsizeSalt(l)+"<br>"),a+="<span style='white-space:nowrap;font-weight:bold;'>Surface with max potential at: <select id='"+s.pre+l+"contour2'>";a+=this.getOptionHtml(["0.5","1","2","3","4","5","6","7","8","9","10"],2),a+="</select> kT/e(25.6mV at 298K)</span><br/><br/>",a+="<b>Surface</b>: <select id='"+s.pre+l+"surftype'>",a+="<option value='21'>Van der Waals</option>",a+="<option value='22' selected>Molecular Surface</option>",a+="<option value='23'>Solvent Accessible</option>",a+="</select>",a+="<span style='margin-left:20px'><b>Opacity</b>: <select id='"+s.pre+l+"surfop'>";return a+=this.getOptionHtml(["1.0","0.9","0.8","0.7","0.6","0.5","0.4","0.3","0.2","0.1"],0),a+="</select></span>",a+="<span style='margin-left:20px'><b>Wireframe</b>: <select id='"+s.pre+l+"surfwf'>",a+="<option value='yes'>Yes</option>",a+="<option value='no' selected>No</option>",a+="</select></span><br/>",a+="<br/>","delphi"==e?(a+=s.htmlCls.buttonStr+"reload_"+l+"file2' style='margin-top: 6px;'>Surface with Potential</button>",a+=s.htmlCls.buttonStr+l+"mapNo2' style='margin-left:30px;'>Remove Surface</button><br>"):"local"==e?(a+=s.htmlCls.divStr+l+"tab2_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+l+"tab2_"+i+"'>PQR</a></li>",a+="<li><a href='#"+s.pre+l+"tab2_"+l+"'>Phi</a></li>",a+="<li><a href='#"+s.pre+l+"tab2_"+n+"'>Cube</a></li>",a+="</ul>",d="<span style='margin-left:30px'>"+s.htmlCls.buttonStr+l+"mapNo2'>Remove Surface</button></span></div>",a+=s.htmlCls.divStr+l+"tab2_"+i+"'>",a+=this.addGsizeSalt(i+"2")+"<br>",a+="<b>PQR File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+i+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+i+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+d,a+=s.htmlCls.divStr+l+"tab2_"+l+"'>",a+="<b>Phi File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+l+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+l+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+d,a+=s.htmlCls.divStr+l+"tab2_"+n+"'>",a+="<b>Cube File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+n+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+n+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+d,a+="</div>"):"url"==e&&(a+=s.htmlCls.divStr+l+"tab2_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+l+"tab2_"+i+"2'>PQR</a></li>",a+="<li><a href='#"+s.pre+l+"tab2_"+l+"2'>Phi</a></li>",a+="<li><a href='#"+s.pre+l+"tab2_"+n+"2'>Cube</a></li>",a+="</ul>",d="<span style='margin-left:30px'>"+s.htmlCls.buttonStr+l+"mapNo2'>Remove Surface</button></span></div>",a+=s.htmlCls.divStr+l+"tab2_"+i+"2'>",a+=this.addGsizeSalt(i+"2")+"<br>",a+="<b>PQR URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+i+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+i+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+d,a+=s.htmlCls.divStr+l+"tab2_"+l+"2'>",a+="<b>Phi URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+l+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+l+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+d,a+=s.htmlCls.divStr+l+"tab2_"+n+"2'>",a+="<b>Cube URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+n+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+n+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+d,a+="</div>"),a+="<br>"+this.getFootHtml(e,l+"tab2_foot"),a+="</div>",a+="</div>",a+="</div>",a}exportPqr(){let e=this.icn3dui,t=e.icn3d,s={},i={},l=e.hashUtilsCls.intHash(t.dAtoms,t.hAtoms);for(let e in l)t.atoms[e],t.ions.hasOwnProperty(e)?s[e]=1:i[e]=1;if(e.cfg.cid){let e="";e+=t.saveFileCls.getAtomPDB(i,!0)+t.saveFileCls.getAtomPDB(s,!0);let l=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(l+"_icn3d.pqr","text",[e])}else{if(e.utilsCls.isCalphaPhosOnly(e.hashUtilsCls.hash2Atoms(i,t.atoms)))return void alert("The potential will not be shown because the side chains are missing in the structure...");let l="";l+=t.saveFileCls.getAtomPDB(i),l+=t.saveFileCls.getAtomPDB(s,!0,void 0,!0);let n="https://www.ncbi.nlm.nih.gov/Structure/delphi/delphi.fcgi",r=e.cfg.cid?e.cfg.cid:Object.keys(t.structures).toString();$.ajax({url:n,type:"POST",data:{pdb2pqr:l,pdbid:r},dataType:"text",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){t.ParserUtilsCls.hideLoading()},success:function(e){let s=e,i=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(i+"_icn3d_residues.pqr","text",[s])},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}}clickReload_pngimage(){let e=this.icn3dui;if(e.icn3d,e.bNode)return;let t=this;e.myEventCls.onIds("#"+e.pre+"reload_pngimage","click",(function(s){let i=e.icn3d;s.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?i.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close"),i.init();let l=$("#"+e.pre+"pngimage")[0].files[0];if(l){t.fileSupport();let e=new FileReader;e.onload=function(e){let s=e.target.result;t.loadPng(s)},e.readAsText(l)}else alert("Please select a file before clicking 'Load'")}))}loadPng(e,t){let s=this.icn3dui,i=s.icn3d,l="Share Link: ",n=e.indexOf(l),r="Start of state file======\n",o=e.indexOf(r);if(-1==n&&-1==o)alert('Please load a PNG image saved by clicking "Save Datas > PNG Image" in the Data menu...');else if(-1!=n){let t=e.substr(n+l.length);s.htmlCls.clickMenuCls.setLogCmd("load iCn3D PNG image "+$("#"+s.pre+"pngimage").val(),!1),window.open(t)}else if(-1!=o){let l="Start of data file======\n",n=e.indexOf(l);i.bInputfile=-1!=n;let a=t?t.replace(/;/g,"\n"):"";if(i.bInputfile){let t=e.indexOf("End of data file======\n"),s=e.substr(n+l.length,t-n-l.length);i.InputfileData=i.InputfileData?i.InputfileData+"\nENDMDL\n"+s:s;let d="Start of type file======\n",c=e.indexOf(d),h=e.indexOf("End of type file======\n"),m=e.substr(c+d.length,h-c-d.length-1);i.InputfileType=m;let p=e.indexOf("End of state file======\n"),u=e.substr(o+r.length,p-o-r.length);u=decodeURIComponent(u+"\n"+a),"pdb"===m?$.when(i.pdbParserCls.loadPdbData(s)).then((function(){i.commands=[],i.optsHistory=[],i.loadScriptCls.loadScript(u,!0)})):("mol2"===m?i.mol2ParserCls.loadMol2Data(s):"sdf"===m?i.sdfParserCls.loadSdfData(s):"xyz"===m?i.xyzParserCls.loadXyzData(s):"mmcif"===m&&i.mmcifParserCls.loadMmcifData(s),i.commands=[],i.optsHistory=[],i.loadScriptCls.loadScript(u,!0))}else{let t=e.indexOf("End of state file======\n"),s=e.substr(o+r.length,t-o-r.length);s=decodeURIComponent(s+"\n"+a),i.commands=[],i.optsHistory=[],i.loadScriptCls.loadScript(s,!0)}s.htmlCls.clickMenuCls.setLogCmd("load iCn3D PNG image "+$("#"+s.pre+"pngimage").val(),!1)}}fileSupport(){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.")}getLinkColor(){let e="";return e+=", linkmap: {\n",e+='3: {"type": "peptidebond", "c":""},\n',e+='4: {"type": "ssbond", "c":"FFA500"},\n',e+='5: {"type": "ionic", "c":"0FF"},\n',e+='6: {"type": "ionicInside", "c":"FFF"},\n',e+='11: {"type": "contact", "c":"888"},\n',e+='12: {"type": "contactInside", "c":"FFF"},\n',e+='13: {"type": "hbond", "c":"0F0"},\n',e+='14: {"type": "hbondInside", "c":"FFF"},\n',e+='15: {"type": "clbond", "c":"006400"},\n',e+='17: {"type": "halogen", "c":"F0F"},\n',e+='18: {"type": "halogenInside", "c":"FFF"},\n',e+='19: {"type": "pication", "c":"F00"},\n',e+='20: {"type": "picationInside", "c":"FFF"},\n',e+='21: {"type": "pistacking", "c":"00F"},\n',e+='22: {"type": "pistackingInside", "c":"FFF"}\n',e+="}}\n",', linkmap: {\n3: {"type": "peptidebond", "c":""},\n4: {"type": "ssbond", "c":"FFA500"},\n5: {"type": "ionic", "c":"0FF"},\n6: {"type": "ionicInside", "c":"FFF"},\n11: {"type": "contact", "c":"888"},\n12: {"type": "contactInside", "c":"FFF"},\n13: {"type": "hbond", "c":"0F0"},\n14: {"type": "hbondInside", "c":"FFF"},\n15: {"type": "clbond", "c":"006400"},\n17: {"type": "halogen", "c":"F0F"},\n18: {"type": "halogenInside", "c":"FFF"},\n19: {"type": "pication", "c":"F00"},\n20: {"type": "picationInside", "c":"FFF"},\n21: {"type": "pistacking", "c":"00F"},\n22: {"type": "pistackingInside", "c":"FFF"}\n}}\n'}setCookieForThickness(){let e=this.icn3dui,t=e.icn3d;if(!e.bNode){let e=3650;this.setCookie("lineRadius",t.lineRadius,e),this.setCookie("coilWidth",t.coilWidth,e),this.setCookie("cylinderRadius",t.cylinderRadius,e),this.setCookie("traceRadius",t.traceRadius,e),this.setCookie("dotSphereScale",t.dotSphereScale,e),this.setCookie("ribbonthickness",t.ribbonthickness,e),this.setCookie("helixSheetWidth",t.helixSheetWidth,e),this.setCookie("nucleicAcidWidth",t.nucleicAcidWidth,e)}}setLineThickness(e,t){let s=this.icn3dui,i=s.icn3d;if(i.bSetThickness=!0,"style"==e&&(t&&($("#"+s.pre+"shininess").val("40"),$("#"+s.pre+"light1").val("0.6"),$("#"+s.pre+"light2").val("0.4"),$("#"+s.pre+"light3").val("0.2"),$("#"+s.pre+"glycan").val("0"),$("#"+s.pre+"membrane").val("1")),i.shininess=parseFloat($("#"+s.pre+"shininess").val()),i.light1=parseFloat($("#"+s.pre+"light1").val()),i.light2=parseFloat($("#"+s.pre+"light2").val()),i.light3=parseFloat($("#"+s.pre+"light3").val()),i.bGlycansCartoon=parseInt($("#"+s.pre+"glycan").val()),i.bMembrane=parseInt($("#"+s.pre+"membrane").val())),t&&($("#"+s.pre+"linerad_"+e).val(.1),$("#"+s.pre+"coilrad_"+e).val(.3),$("#"+s.pre+"stickrad_"+e).val(.4),$("#"+s.pre+"tracerad_"+e).val(.4),$("#"+s.pre+"ballscale_"+e).val(.3),$("#"+s.pre+"ribbonthick_"+e).val(.2),$("#"+s.pre+"prtribbonwidth_"+e).val(1.3),$("#"+s.pre+"nucleotideribbonwidth_"+e).val(.8)),i.lineRadius=parseFloat($("#"+s.pre+"linerad_"+e).val()),i.coilWidth=parseFloat($("#"+s.pre+"coilrad_"+e).val()),i.cylinderRadius=parseFloat($("#"+s.pre+"stickrad_"+e).val()),i.traceRadius=parseFloat($("#"+s.pre+"tracerad_"+e).val()),i.dotSphereScale=parseFloat($("#"+s.pre+"ballscale_"+e).val()),i.ribbonthickness=parseFloat($("#"+s.pre+"ribbonthick_"+e).val()),i.helixSheetWidth=parseFloat($("#"+s.pre+"prtribbonwidth_"+e).val()),i.nucleicAcidWidth=parseFloat($("#"+s.pre+"nucleotideribbonwidth_"+e).val()),!s.bNode){let e=3650;this.setCookie("shininess",i.shininess,e),this.setCookie("light1",i.light1,e),this.setCookie("light2",i.light2,e),this.setCookie("light3",i.light3,e),this.setCookie("glycan",i.bGlycansCartoon,e),this.setCookie("membrane",i.bMembrane,e)}if(this.setCookieForThickness(),e=t){let e="reset thickness";s.htmlCls.clickMenuCls.setLogCmd(e,!0),i.bSetThickness=!1,i.threeDPrintCls.resetAfter3Dprint()}else s.htmlCls.clickMenuCls.setLogCmd("set thickness | linerad "+i.lineRadius+" | coilrad "+i.coilWidth+" | stickrad "+i.cylinderRadius+" | tracerad "+i.traceRadius+" | ribbonthick "+i.ribbonthickness+" | proteinwidth "+i.helixSheetWidth+" | nucleotidewidth "+i.nucleicAcidWidth+" | ballscale "+i.dotSphereScale,!0),s.htmlCls.clickMenuCls.setLogCmd("set glycan "+i.bGlycansCartoon,!0),s.htmlCls.clickMenuCls.setLogCmd("set membrane "+i.bMembrane,!0);i.drawCls.draw()}setCookie(e,t,s){let i=new Date;i.setTime(i.getTime()+24*s*60*60*1e3);let l="expires="+i.toUTCString();document.cookie=e+"="+t+";"+l+";path=/"}updateSurfPara(e){let t=this.icn3dui,s=t.icn3d;s.phisurftype=$("#"+t.pre+e+"surftype").val(),s.phisurfop=$("#"+t.pre+e+"surfop").val(),s.phisurfwf=$("#"+t.pre+e+"surfwf").val()}exportPdb(){let e=this.icn3dui,t=e.icn3d,s="",i=e.hashUtilsCls.intHash(t.dAtoms,t.hAtoms);s+=t.saveFileCls.getAtomPDB(i);let l=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(l+"_icn3d.pdb","text",[s])}exportSecondary(){let e=this.icn3dui,t=e.icn3d,s="",i=e.hashUtilsCls.intHash(t.dAtoms,t.hAtoms);s+=t.saveFileCls.getSecondary(i);let l=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(l+"_icn3d_ss.txt","text",[s])}}class rt{constructor(e){let t=e;this.icn3dui=e,this.cfg=this.icn3dui.cfg,this.opts={},this.opts.background="black",this.WIDTH=400,this.HEIGHT=400,this.RESIDUE_WIDTH=10,t.utilsCls.isMobile()||this.cfg.mobilemenu?this.MENU_HEIGHT=0:this.MENU_HEIGHT=40,this.LOG_HEIGHT=65,this.MENU_WIDTH=750,this.LESSWIDTH=20,this.LESSWIDTH_RESIZE=20,this.LESSHEIGHT=20,this.width2d=200,this.CMD_HEIGHT=.8*this.LOG_HEIGHT,this.EXTRAHEIGHT=this.MENU_HEIGHT+this.CMD_HEIGHT,null!=this.cfg.showmenu&&0==this.cfg.showmenu&&(this.EXTRAHEIGHT-=this.MENU_HEIGHT),null!=this.cfg.showcommand&&0==this.cfg.showcommand&&(this.EXTRAHEIGHT-=this.CMD_HEIGHT),this.GREY8="#AAAAAA",this.GREYB="#CCCCCC",this.GREYC="#DDDDDD",this.GREYD="#EEEEEE",this.ORANGE="#FFA500",this.themecolor="blue",this.defaultValue=1,this.ssValue=3,this.coilValue=3,this.contactValue=11,this.contactInsideValue=12,this.hbondValue=13,this.hbondInsideValue=14,this.ssbondValue=4,this.ionicValue=5,this.ionicInsideValue=6,this.clbondValue=15,this.halogenValue=17,this.halogenInsideValue=18,this.picationValue=19,this.picationInsideValue=20,this.pistackingValue=21,this.pistackingInsideValue=22,this.contactColor="888",this.contactInsideColor="FFF",this.hbondColor="0F0",this.hbondInsideColor="FFF",this.ssbondColor="FFA500",this.ionicColor="0FF",this.ionicInsideColor="FFF",this.clbondColor="006400",this.halogenColor="F0F",this.halogenInsideColor="FFF",this.picationColor="F00",this.picationInsideColor="FFF",this.pistackingColor="00F",this.pistackingInsideColor="FFF",this.hideedges=1,this.force=4,this.simulation=void 0,this.baseUrl="https://www.ncbi.nlm.nih.gov/Structure/",this.divStr="<div id='"+this.icn3dui.pre,this.divNowrapStr="<div style='white-space:nowrap'>",this.spanNowrapStr="<span style='white-space:nowrap'>",this.inputTextStr="<input type='text' ",this.inputFileStr="<input type='file' ",this.inputRadioStr="<input type='radio' ",this.inputCheckStr="<input type='checkbox' ",this.optionStr="<option value=",this.buttonStr="<button id='"+this.icn3dui.pre,this.postfix="2",this.space2="&nbsp;&nbsp;",this.space3=this.space2+"&nbsp;",this.space4=this.space2+this.space2,this.wifiStr="",this.licenseStr="",this.closeAc={collapsible:!0,active:!1},this.clickMenuCls=new Ze(this.icn3dui),this.setMenuCls=new et(this.icn3dui),this.dialogCls=new tt(this.icn3dui),this.setDialogCls=new st(this.icn3dui),this.eventsCls=new it(this.icn3dui),this.alignSeqCls=new lt(this.icn3dui),this.setHtmlCls=new nt(this.icn3dui)}}class ot{constructor(e){this.icn3d=e}alternateStructures(){let e=this.icn3d,t=e.icn3dui;e.viewSelectionAtoms||(e.viewSelectionAtoms=t.hashUtilsCls.cloneHash(e.dAtoms));let s=Object.keys(e.viewSelectionAtoms).length,i=Object.keys(e.atoms).length;e.dAtoms={};let l=Object.keys(e.structures);for(let s=0,i=l.length;s<i;++s){let n,r=l[s];if(e.bShift?(e.ALTERNATE_STRUCTURE<0&&(e.ALTERNATE_STRUCTURE=1),n=s==e.ALTERNATE_STRUCTURE%i-1||e.ALTERNATE_STRUCTURE%i==0&&s===i-1):n=s==e.ALTERNATE_STRUCTURE%i+1||e.ALTERNATE_STRUCTURE%i==i-1&&0===s,n){for(let s in e.structures[r]){let i=e.structures[r][s];e.dAtoms=t.hashUtilsCls.unionHash(e.dAtoms,e.chains[i])}e.bShift?--e.ALTERNATE_STRUCTURE:++e.ALTERNATE_STRUCTURE,e.ALTERNATE_STRUCTURE<0&&(e.ALTERNATE_STRUCTURE+=i),$("#"+e.pre+"title").html(r);break}}if(s<i){let s=t.hashUtilsCls.intHash(e.dAtoms,e.viewSelectionAtoms);Object.keys(s).length>0&&(e.dAtoms=t.hashUtilsCls.cloneHash(s)),e.bShowHighlight=!1,e.opts.rotationcenter="highlight center"}e.applyMapCls.removeSurfaces(),e.applyMapCls.applySurfaceOptions(),e.applyMapCls.removeMaps(),e.applyMapCls.applyMapOptions(),e.applyMapCls.removeEmmaps(),e.applyMapCls.applyEmmapOptions(),e.applyMapCls.removePhimaps(),e.axes=[],e.pc1&&e.axesCls.setPc1Axes(),e.drawCls.draw(),e.bShowHighlight=!0,e.opts.rotationcenter="molecule center"}alternateWrapper(){let e=this.icn3d;e.icn3dui,e.bAlternate=!0,this.alternateStructures(),e.bAlternate=!1}}class at{constructor(e){this.icn3d=e}drawGraph(e,t){var s=this.icn3d,i=s.icn3dui;if(void 0===l)var l=d3;var n=JSON.parse(e),r=$("#"+t).width(),o=$("#"+t).height(),a=isNaN(r)?300:1*r,d=isNaN(o)?300:1*o,c=r,h=o,m=d3.select("#"+i.svgid).attr("width",r).attr("height",o).attr("viewBox","0,0,"+a+","+d);m.selectAll(".g-main").remove();var p=m.append("g").classed("g-main",!0),u=p.append("rect").attr("width",c).attr("height",h).style("fill","#FFF"),C=p.append("g"),g=l.zoom().on("zoom",(function(){C.attr("transform",l.event.transform)}));if(p.call(g),n.links){for(var f=[],b={},y=0,v=n.nodes.length;y<v;++y){b[(H=n.nodes[y]).id]=1}var _=!1;for(y=0,v=n.links.length;y<v;++y){var S=n.links[y];b.hasOwnProperty(S.source)&&b.hasOwnProperty(S.target)?f.push(S):(b.hasOwnProperty(S.source)||console.log("The node "+S.source+" is not found... "),b.hasOwnProperty(S.target)||console.log("The node "+S.target+" is not found... "),_=!0)}_&&console.log(JSON.stringify(n)),n.links=f;var w={};for(y=0;y<n.nodes.length;y++)i.htmlCls.force||(n.nodes[y].x*=10,n.nodes[y].y*=10),w[n.nodes[y].id]=n.nodes[y],n.nodes[y].weight=1.01;if(i.htmlCls.hideedges&&!i.htmlCls.force){var A=[];for(y=0;y<n.links.length;y++)"FFF"!=n.links[y].c&&A.push(n.links[y]);n.links=A}var x=C.append("g"),k=null,O=(S=C.append("g").attr("class","link").selectAll("line").data(n.links).enter().append("line").attr("stroke",(function(e){return e.v==i.htmlCls.contactInsideValue?"#"+i.htmlCls.contactInsideColor:e.v==i.htmlCls.hbondInsideValue?"#"+i.htmlCls.hbondInsideColor:e.v==i.htmlCls.ionicInsideValue?"#"+i.htmlCls.ionicInsideColor:e.v==i.htmlCls.halogenInsideValue?"#"+i.htmlCls.halogenInsideColor:e.v==i.htmlCls.picationInsideValue?"#"+i.htmlCls.picationInsideColor:e.v==i.htmlCls.pistackingInsideValue?"#"+i.htmlCls.pistackingInsideColor:"#"+e.c})).attr("stroke-width",(function(e){return e.v==i.htmlCls.contactValue||e.v==i.htmlCls.contactInsideValue||e.v==i.htmlCls.hbondInsideValue||e.v==i.htmlCls.ionicInsideValue||e.v==i.htmlCls.halogenInsideValue||e.v==i.htmlCls.picationInsideValue||e.v==i.htmlCls.pistackingInsideValue?"1px":e.v==i.htmlCls.hbondValue||e.v==i.htmlCls.ionicValue||e.v==i.htmlCls.halogenValue||e.v==i.htmlCls.picationValue||e.v==i.htmlCls.pistackingValue?"2px":e.v==i.htmlCls.ssbondValue||e.v==i.htmlCls.clbondValue?"3px":e.v+"px"})),C.append("g").attr("class","node")),H=O.selectAll("circle").data(n.nodes).enter().append("circle").attr("r",3).attr("fill",(function(e){return"#"+e.c})).attr("stroke",(function(e){return"#"+e.c})).attr("res",(function(e){return e.r})).attr("class","icn3d-node").call(l.drag().on("start",(function(e){l.event.active||i.htmlCls.simulation.alphaTarget(.9).restart();e.selected||U||H.classed("selected",(function(e){return e.selected=e.previouslySelected=!1}));l.select(this).classed("selected",(function(t){return e.previouslySelected=e.selected,e.selected=!0})),H.filter((function(e){return e.selected})).each((function(e){e.fx=e.x,e.fy=e.y}))})).on("drag",(function(e){H.filter((function(e){return e.selected})).each((function(e){e.fx+=l.event.dx,e.fy-=l.event.dy}))})).on("end",(function(e){l.event.active||i.htmlCls.simulation.alphaTarget(0);e.fx=null,e.fy=null,H.filter((function(e){return e.selected})).each((function(e){e.fx=null,e.fy=null}))}))),D=O.selectAll("text").data(n.nodes).enter().append("text").text((function(e){var t=e.id,s=t.indexOf(".");return-1!==s&&(t=t.substr(0,s)),t})).attr("fill",(function(e){return"#"+e.c})).attr("stroke","none").attr("class","icn3d-node-text8");H.append("title").text((function(e){return e.id}));var R=parseInt($("#"+s.pre+"dist_ss").val()),I=parseInt($("#"+s.pre+"dist_coil").val()),E=parseInt($("#"+s.pre+"dist_hbond").val()),T=parseInt($("#"+s.pre+"dist_inter").val()),M=parseInt($("#"+s.pre+"dist_ssbond").val()),F=parseInt($("#"+s.pre+"dist_ionic").val()),P=parseInt($("#"+s.pre+"dist_halogen").val()),L=parseInt($("#"+s.pre+"dist_pication").val()),N=parseInt($("#"+s.pre+"dist_pistacking").val());i.htmlCls.simulation=l.forceSimulation().force("link",l.forceLink().id((function(e){return e.id})).distance((function(e){return 30})).strength((function(e){return i.htmlCls.force?e.v==i.htmlCls.ssValue?isNaN(R)?1:R/100:e.v==i.htmlCls.coilValue||e.v==i.htmlCls.clbondValue?isNaN(I)?.5:I/100:e.v==i.htmlCls.hbondValue||e.v==i.htmlCls.hbondInsideValue?isNaN(E)?.5:E/100:e.v==i.htmlCls.contactValue||e.v==i.htmlCls.contactInsideValue?isNaN(T)?.25:T/100:e.v==i.htmlCls.ssbondValue?isNaN(M)?.5:M/100:e.v==i.htmlCls.ionicValue||e.v==i.htmlCls.ionicInsideValue?isNaN(F)?.5:F/100:e.v==i.htmlCls.halogenValue||e.v==i.htmlCls.halogenInsideValue?isNaN(P)?.5:P/100:e.v==i.htmlCls.picationValue||e.v==i.htmlCls.picationInsideValue?isNaN(L)?.5:L/100:e.v==i.htmlCls.pistackingValue||e.v==i.htmlCls.pistackingInsideValue?isNaN(N)?.5:N/100:0:0}))).force("center",l.forceCenter(c/2,h/2)),i.htmlCls.force&&i.htmlCls.simulation.force("charge",l.forceManyBody()),1==i.htmlCls.force?i.htmlCls.simulation.force("x",l.forceX((function(e){return"a"==e.s?c/4:.75*c})).strength((function(e){return.4}))).force("y",l.forceY(h/2).strength((function(e){return.02}))):2==i.htmlCls.force?i.htmlCls.simulation.force("y",l.forceY((function(e){return"a"==e.s?.75*h:h/4})).strength((function(e){return.4}))).force("x",l.forceX(c/2).strength((function(e){return.02}))):3==i.htmlCls.force?i.htmlCls.simulation.force("r",l.forceRadial((function(e){return"a"==e.s?200:100}),c/2,h/2).strength((function(e){return.8}))):i.htmlCls.force,i.htmlCls.simulation.nodes(n.nodes).on("tick",(function(){S.attr("x1",(function(e){var t=e.source.x;return isNaN(t)?0:t})).attr("y1",(function(e){var t=h-e.source.y;return isNaN(t)?0:t})).attr("x2",(function(e){var t=e.target.x;return isNaN(t)?0:t})).attr("y2",(function(e){var t=h-e.target.y;return isNaN(t)?0:t})),H.attr("cx",(function(e){var t=e.x;return isNaN(t)?0:t})).attr("cy",(function(e){var t=h-e.y;return isNaN(t)?0:t})),D.attr("x",(function(e){var t=e.x+6;return isNaN(t)?0:t})).attr("y",(function(e){var t=h-(e.y+3);return isNaN(t)?0:t}))})),i.htmlCls.simulation.force("link").links(n.links);var U,q=!1,B=!1,j=l.brush().on("start",(function(){B=!0,H.each((function(e){e.previouslySelected=U&&e.selected}))})).on("brush",(function(){if(!l.event.sourceEvent)return;if(!l.event.selection)return;var e=l.event.selection;H.classed("selected",(function(t){return t.selected=t.previouslySelected^(e[0][0]<=t.x&&t.x<e[1][0]&&e[0][1]<=h-t.y&&h-t.y<e[1][1])}))})).on("end",(function(){if(!l.event.sourceEvent)return;if(!l.event.selection)return;if(!k)return;k.call(j.move,null),q||(k.remove(),k=null);B=!1}));return u.on("click",(function(){H.each((function(e){e.selected=!1,e.previouslySelected=!1})),H.classed("selected",!1)})),l.select("body").on("keydown",(function(){if(U=l.event.ctrlKey){if(k)return;q=!0,k||(k=x.append("g")).call(j)}})),l.select("body").on("keyup",(function(){if(U=!1,q=!1,!k)return;B||(k.remove(),k=null)})),n}console.log("Graph is missing links")}}class dt{constructor(e){this.icn3d=e}contactMap(e,t){let s=this.icn3d;s.icn3dui;let i=["selected"],l=["selected"];if(0==l.length)alert("Please select the first set");else{s.definedSetsCls.setMode("selection");let n=!1,r=!1,o=!0,a=!1,d=!1,c=!1;s.viewInterPairsCls.viewInteractionPairs(l,i,!1,t,n,r,o,a,d,c,e)}}afErrorMap(e,t){let s,i,l=this.icn3d.icn3dui,n=this;l.htmlCls.dialogCls.openDlg("dl_alignerrormap","Show Predicted Aligned Error (PAE) map"),s="https://alphafold.ebi.ac.uk/files/AF-"+e+"-F1-predicted_aligned_error_v2.json",i="json",$.ajax({url:s,dataType:"json",cache:!0,tryCount:0,retryLimit:0,success:function(e){n.processAfErrorMap(e,t)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):alert("There are some problems in loading the PAE file...")}})}processAfErrorMap(e,t){let s=this.icn3d,i=s.icn3dui,l=e[0].distance,n=e[0].max_predicted_aligned_error;if(!l||!n)return void alert("The PAE file didn't have the right format...");let r,o='"nodes": [',a='"links": [',d=!1,c=!1;s.chains&&0!=Object.keys(s.chains).length?r=!0:(r=!1,s.init_base());let h=parseInt(Math.sqrt(l.length)),m=0,p={};for(let e in s.chains)for(let t=0,i=s.chainsSeq[e].length;t<i;++t)p[m]=s.chainsSeq[e][t],p[m].chainid=e,++m;m=0;for(let e=0;e<h;++e){let u=r?p[e].resi:e+1,C=r?p[e].name:"*",g=r?p[e].chainid:"stru_A",f=g+"_"+u,b=s.residues[f]?s.firstAtomObjCls.getFirstAtomObj(s.residues[f]):{color:i.parasCls.thr(8947848)},y=g.substr(g.indexOf("_")+1),v=b.color.getHexString();d&&(o+=", ");let _=C+u+"."+y;o+='{"id":"'+_+'","r":"1_1_'+f+'","s":"a","c":"'+v+'"}\n',o+=', {"id":"'+_+'.","r":"1_1_'+f+'","s":"b","c":"'+v+'"}',d=!0;for(let s=t?0:e;s<h;++s){m=e*h+s;let t=r?p[s].resi:s+1,i=r?p[s].name:"*",o=r?p[s].chainid:"stru_A",d=i+t+"."+o.substr(o.indexOf("_")+1),u=l[m]?l[m]/n:0,C=parseInt(255*u).toString(16),g=parseInt(255*(.698*u+.302)).toString(16),f=1==C.length?"0"+C:C;c&&(a+=", "),a+='{"source": "'+_+'", "target": "'+d+'.", "v": 11, "c": "'+(f+(1==g.length?"0"+g:g)+f)+'"}\n',c=!0}}e={};let u="{"+o+"], "+a+"]}";this.drawContactMap(u,!0,n),void 0!==s.deferredAfmap&&s.deferredAfmap.resolve()}drawContactMap(e,t,s){let i,l=this.icn3d,n=l.icn3dui,r=JSON.parse(e),o=r.links,a=[],d=[],c={};for(let e=0,t=r.nodes.length;e<t;++e){let t=r.nodes[e];t&&(c[t.id]=t,"a"==t.s?a.push(t):"b"==t.s?d.push(t):"ab"==t.s&&(a.push(t),d.push(t)))}a.sort((function(e,t){return l.getGraphCls.compNode(e,t)})),d.sort((function(e,t){return l.getGraphCls.compNode(e,t)}));let h,m,p,u,C="{\n",g=l.structures.length>0?l.structures[0]:"STRU";m=10*(a.length+2)+20+30,h=10*(d.length+2)+20+30,t?(l.alignerrormapWidth=2*h,u=l.alignerrormapWidth,p=n.alignerrormapid):(l.contactmapWidth=2*h,u=l.contactmapWidth,p=n.contactmapid),i=o.length>0?"":"No interactions found for these two sets<br><br>",i+="<svg xmlns='http://www.w3.org/2000/svg' id='"+p+"' viewBox='0,0,"+h+","+m+"' width='"+u+"px'>";if(t){l.hex2id={};let e=29/s;l.hex2skip={};let t=1e3;for(let s=0;s<t;++s){let i=1*s/t,r=parseInt(255*i).toString(16),o=parseInt(255*(.698*i+.302)).toString(16),a=1==r.length?"0"+r:r,d=a+(1==o.length?"0"+o:o)+a,c=n.pre+"afmap_"+s;l.hex2id[d]=c,i>e&&(l.hex2skip[d]=c)}}if(i+=l.lineGraphCls.drawScatterplot_base(a,d,o,c,0,!0,void 0,void 0,t),C+=l.getGraphCls.updateGraphJson(g,1,a,d,o),i+="</svg>",C+="}\n",t){l.alignerrormapStr=C,$("#"+l.pre+"alignerrormapDiv").html(i);let e=$("#"+n.alignerrormapid+"_scale").val();$("#"+n.alignerrormapid).attr("width",(l.alignerrormapWidth*parseFloat(e)).toString()+"px")}else l.contactmapStr=C,$("#"+l.pre+"contactmapDiv").html(i);return i}}class ct{constructor(e){this.icn3d=e}densityCifParser(e,t,s,i){let l,n=this.icn3d,r=n.icn3dui,o=this,a=r.utilsCls.isMobile()||r.cfg.notebook?0:4;if("2fofc"==t||"fofc"==t?l="https://www.ebi.ac.uk/pdbe/densities/x-ray/"+e.toLowerCase()+"/cell?detail="+a:"em"==t&&(l="https://www.ebi.ac.uk/pdbe/densities/emd/"+i.toLowerCase()+"/cell?detail="+a),"2fofc"==t&&n.bAjax2fofc)n.mapData.sigma2=s,n.setOptionCls.setOption("map",t);else if("fofc"==t&&n.bAjaxfofc)n.mapData.sigma=s,n.setOptionCls.setOption("map",t);else if("em"==t&&n.bAjaxEm)n.mapData.sigmaEm=s,n.setOptionCls.setOption("emmap",t);else{let e=new XMLHttpRequest;e.open("GET",l,!0),e.responseType="arraybuffer",e.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){let i=e.response;o.parseChannels(i,t,s),"2fofc"==t||"fofc"==t?(n.bAjax2fofc=!0,n.bAjaxfofc=!0,n.setOptionCls.setOption("map",t)):"em"==t&&(n.bAjaxEm=!0,n.setOptionCls.setOption("emmap",t))}else"2fofc"==t||"fofc"==t?alert("Density server at EBI has no corresponding electron density map for this structure."):"em"==t&&alert("Density server at EBI has no corresponding EM density map for this structure.");void 0!==n.deferredEmmap&&n.deferredEmmap.resolve()}else n.ParserUtilsCls.showLoading()},e.send()}}parseChannels(e,t,s){let i=this.icn3d;i.icn3dui;let l=this.BinaryParse(e);if("2fofc"==t||"fofc"==t){let e=this.getChannel(l,"2FO-FC"),n=this.getChannel(l,"FO-FC"),r=e,o=r.box.sampleCount,a={xExtent:o[0],yExtent:o[1],zExtent:o[2],mean:r.valuesInfo.mean,sigma:r.valuesInfo.sigma};i.mapData.header2=a,i.mapData.data2=r.data;let d=r.box.origin,c=r.box.dimensions,h=r.spacegroup.basis,m=(new THREE.Matrix4).makeScale(c[0]/o[0],c[1]/o[1],c[2]/o[2]),p=(new THREE.Matrix4).makeTranslation(d[0],d[1],d[2]),u=(new THREE.Matrix4).set(h.x[0],h.y[0],h.z[0],0,0,h.y[1],h.z[1],0,0,0,h.z[2],0,0,0,0,1),C=u.multiply(p).multiply(m);i.mapData.matrix2=C,i.mapData.type2=t,i.mapData.sigma2=s,r=n,o=r.box.sampleCount,a={xExtent:o[0],yExtent:o[1],zExtent:o[2],mean:r.valuesInfo.mean,sigma:r.valuesInfo.sigma},i.mapData.header=a,i.mapData.data=r.data,d=r.box.origin,c=r.box.dimensions,h=r.spacegroup.basis,m=(new THREE.Matrix4).makeScale(c[0]/o[0],c[1]/o[1],c[2]/o[2]),p=(new THREE.Matrix4).makeTranslation(d[0],d[1],d[2]),u=(new THREE.Matrix4).set(h.x[0],h.y[0],h.z[0],0,0,h.y[1],h.z[1],0,0,0,h.z[2],0,0,0,0,1),C=u.multiply(p).multiply(m),i.mapData.matrix=C,i.mapData.type=t,i.mapData.sigma=s}else if("em"==t){let e=this.getChannel(l,"EM"),n=e.box.sampleCount,r={xExtent:n[0],yExtent:n[1],zExtent:n[2],max:e.valuesInfo.max,min:e.valuesInfo.min};i.mapData.headerEm=r,i.mapData.dataEm=e.data;let o=e.box.origin,a=e.box.dimensions,d=e.spacegroup.basis,c=(new THREE.Matrix4).makeScale(a[0]/n[0],a[1]/n[1],a[2]/n[2]),h=(new THREE.Matrix4).makeTranslation(o[0],o[1],o[2]),m=(new THREE.Matrix4).set(d.x[0],d.y[0],d.z[0],0,0,d.y[1],d.z[1],0,0,0,d.z[2],0,0,0,0,1).multiply(h).multiply(c);i.mapData.matrixEm=m,i.mapData.typeEm=t,i.mapData.sigmaEm=s}}getChannel(e,t){this.icn3d.icn3dui;let s,i=e.toJSON();for(let l=0,n=i.length;l<n;++l)i[l].id==t&&(s=e.dataBlocks[l]);return this.CIFParse(s)}CIFParse(e){this.icn3d.icn3dui;let t=e.getCategory("_volume_data_3d_info");if(!t)return void conole.log("_volume_data_3d_info category is missing.");if(!e.getCategory("_volume_data_3d"))return void conole.log("_volume_data_3d category is missing.");function s(e){let s=[0,0,0];for(let i=0;i<3;i++)s[i]=t.getColumn(e+"["+i+"]").getFloat(0);return s}function i(e){return t.getColumn(e).getFloat(0)}let l={name:t.getColumn("name").getString(0),axisOrder:s("axis_order"),origin:s("origin"),dimensions:s("dimensions"),sampleCount:s("sample_count"),spacegroupNumber:0|i("spacegroup_number"),cellSize:s("spacegroup_cell_size"),cellAngles:s("spacegroup_cell_angles"),mean:i("mean_sampled"),sigma:i("sigma_sampled")},n=[0,0,0];function r(e){return[e[n[0]],e[n[1]],e[n[2]]]}n[l.axisOrder[0]]=0,n[l.axisOrder[1]]=1,n[l.axisOrder[2]]=2;let o=r(l.sampleCount),a=function(e,t,s,i){let l=new Float32Array(t[0]*t[1]*t[2]),n=[0,0,0],r=i[0],o=i[1],a=i[2],d=s[0],c=s[1],h=s[2];t[0],t[0],t[1];let m=t[2],p=t[1]*t[2],u=0,C=e.getFloat(0),g=C;for(let t=0;t<h;t++){n[2]=t;for(let t=0;t<c;t++){n[1]=t;for(let t=0;t<d;t++){n[0]=t;let s=e.getFloat(u);u+=1,l[n[a]+n[o]*m+n[r]*p]=s,s<C?C=s:s>g&&(g=s)}}}return{data:l,min:C,max:g}}(e.getCategory("_volume_data_3d").getColumn("values"),o,l.sampleCount,n);return{name:l.name,spacegroup:function(e,t,s){let i=Math.PI/180*s[0],l=Math.PI/180*s[1],n=Math.PI/180*s[2],r=t[0],o=t[1],a=t[2],d=Math.cos(l),c=(Math.cos(i)-Math.cos(l)*Math.cos(n))/Math.sin(n),h=Math.sqrt(1-d*d-c*c);return{number:e,size:t,angles:s,basis:{x:[r,0,0],y:[Math.cos(n)*o,Math.sin(n)*o,0],z:[d*a,c*a,h*a]}}}(l.spacegroupNumber,l.cellSize,l.cellAngles),box:{origin:r(l.origin),dimensions:r(l.dimensions),sampleCount:o},data:a.data,valuesInfo:{min:a.min,max:a.max,mean:l.mean,sigma:l.sigma}}}BinaryParse(e){this.icn3d.icn3dui;let t=new Uint8Array(e),s=this.MessagePackParse({buffer:t,offset:0,dataView:new DataView(t.buffer)}),i=function(){function e(e){this.additionalData={},this.header=e.header,this.categoryList=e.categories.map((function(e){return new l(e)})),this.categoryMap=new Map;for(let e=0,t=this.categoryList;e<t.length;e++){let s=t[e];this.categoryMap.set(s.name,s)}}return Object.defineProperty(e.prototype,"categories",{get:function(){return this.categoryList},enumerable:!0,configurable:!0}),e.prototype.getCategory=function(e){return this.categoryMap.get(e)},e.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map((function(e){return e.toJSON()})),additionalData:this.additionalData}},e}(),l=function(){function e(e){this.name=e.name,this.columnCount=e.columns.length,this.rowCount=e.rowCount,this.columnNameList=[],this.encodedColumns=new Map;for(let t=0,s=e.columns;t<s.length;t++){let e=s[t];this.encodedColumns.set(e.name,e),this.columnNameList.push(e.name)}}Object.defineProperty(e.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:!0,configurable:!0});let t=function(){function e(){this.isDefined=!1}return e.prototype.getString=function(e){return null},e.prototype.getInteger=function(e){return 0},e.prototype.getFloat=function(e){return 0},e.prototype.getValuePresence=function(e){return 1},e.prototype.areValuesEqual=function(e,t){return!0},e.prototype.stringEquals=function(e,t){return null===t},e}();return e.prototype.getColumn=function(e){let s=this.encodedColumns.get(e);return s?m(s):t},e.prototype.toJSON=function(){let e=this,t=[],s=this.columnNameList.map((function(t){return{name:t,column:e.getColumn(t)}}));for(let e=0;e<this.rowCount;e++){let i={};for(let t=0,l=s;t<l.length;t++){let s=l[t],n=s.column.getValuePresence(e);i[s.name]=0===n?s.column.getString(e):1===n?".":"?"}t[e]=i}return{name:this.name,columns:this.columnNames,rows:t}},e}();function n(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function r(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}let o=function(){let e=new ArrayBuffer(2),t=new Uint8Array(e),s=new Uint16Array(e);return t[0]=170,t[1]=187,48042===s[0]}();function a(e,t,s){return new s(o?e.buffer:function(e,t){let s=new ArrayBuffer(e.length),i=new Uint8Array(s);for(let s=0,l=e.length;s<l;s+=t)for(let l=0;l<t;l++)i[s+t-l-1]=e[s+l];return s}(e,t))}function d(e,t){return t.isUnsigned?function(e,t){let s=1===t.byteCount?255:65535,i=e.length,l=new Int32Array(t.srcSize),n=0,r=0;for(;n<i;){let t=0,i=e[n];for(;i===s;)t+=i,n++,i=e[n];t+=i,l[r]=t,n++,r++}return l}(e,t):function(e,t){let s=1===t.byteCount?127:32767,i=-s-1,l=e.length,n=new Int32Array(t.srcSize),r=0,o=0;for(;r<l;){let t=0,l=e[r];for(;l===s||l===i;)t+=l,r++,l=e[r];t+=l,n[o]=t,r++,o++}return n}(e,t)}function c(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return function(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case 2:return function(e){return a(e,2,Int16Array)}(e);case 5:return function(e){return a(e,2,Uint16Array)}(e);case 3:return function(e){return a(e,4,Int32Array)}(e);case 6:return function(e){return a(e,4,Uint32Array)}(e);case 32:return function(e){return a(e,4,Float32Array)}(e);case 33:return function(e){return a(e,8,Float64Array)}(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return function(e,t){let s=e.length,i=r(t.srcType,s),l=1/t.factor;for(let t=0;t<s;t++)i[t]=l*e[t];return i}(e,t);case"IntervalQuantization":return function(e,t){let s=e.length,i=r(t.srcType,s),l=(t.max-t.min)/(t.numSteps-1),n=t.min;for(let t=0;t<s;t++)i[t]=n+l*e[t];return i}(e,t);case"RunLength":return function(e,t){let s=n(t.srcType,t.srcSize),i=0;for(let t=0,l=e.length;t<l;t+=2){let l=e[t],n=e[t+1];for(let e=0;e<n;++e)s[i++]=l}return s}(e,t);case"Delta":return function(e,t){let s=e.length,i=n(t.srcType,s);if(!s)return i;i[0]=e[0]+(0|t.origin);for(let t=1;t<s;++t)i[t]=e[t]+i[t-1];return i}(e,t);case"IntegerPacking":return d(e,t);case"StringArray":return function(e,t){let s=t.stringData,i=h({encoding:t.offsetEncoding,data:t.offsets}),l=h({encoding:t.dataEncoding,data:e}),n=Object.create(null),r=new Array(l.length),o=0;for(let e=0,t=l;e<t.length;e++){let l=t[e];if(l<0){r[o++]=null;continue}let a=n[l];void 0===a&&(a=s.substring(i[l],i[l+1]),n[l]=a),r[o++]=a}return r}(e,t)}}function h(e){let t=e.data;for(let s=e.encoding.length-1;s>=0;s--)t=c(t,e.encoding[s]);return t}function m(e){if(!e.data.data)return _UndefinedColumn;let t,s=h(e.data);return e.mask&&(t=h(e.mask)),s.buffer&&s.byteLength&&s.BYTES_PER_ELEMENT?t?new g(s,t):new C(s):t?new b(s,t):new f(s)}function p(e,t,s){let i=0,l=1;for(45===e.charCodeAt(t)&&(l=-1,t++);t<s;t++){let s=e.charCodeAt(t)-48;if(s>9||s<0)return l*i|0;i=10*i+s|0}return l*i}function u(e,t,s){let i=1,l=0,n=0,r=1;for(45===e.charCodeAt(t)&&(i=-1,++t);t<s;){let o=e.charCodeAt(t)-48;if(!(o>=0&&o<10)){if(-2===o){for(++t;t<s;){if(o=e.charCodeAt(t)-48,!(o>=0&&o<10))return 53===o||21===o?parseScientific(i*(l+n/r),e,t+1,s):i*(l+n/r);n=10*n+o,r*=10,++t}return i*(l+n/r)}if(53===o||21===o)return parseScientific(i*l,e,t+1,s);break}l=10*l+o,++t}return i*l}let C=function(){function e(e){this.data=e,this.isDefined=!0}return e.prototype.getString=function(e){return""+this.data[e]},e.prototype.getInteger=function(e){return 0|this.data[e]},e.prototype.getFloat=function(e){return 1*this.data[e]},e.prototype.stringEquals=function(e,t){return this.data[e]===u(t,0,t.length)},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return 0},e}(),g=function(){function e(e,t){this.data=e,this.mask=t,this.isDefined=!0}return e.prototype.getString=function(e){return 0===this.mask[e]?""+this.data[e]:null},e.prototype.getInteger=function(e){return 0===this.mask[e]?this.data[e]:0},e.prototype.getFloat=function(e){return 0===this.mask[e]?this.data[e]:0},e.prototype.stringEquals=function(e,t){return 0===this.mask[e]?this.data[e]===u(t,0,t.length):null==t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return this.mask[e]},e}(),f=function(){function e(e){this.data=e,this.isDefined=!0}return e.prototype.getString=function(e){return this.data[e]},e.prototype.getInteger=function(e){let t=this.data[e];return p(t,0,t.length)},e.prototype.getFloat=function(e){let t=this.data[e];return u(t,0,t.length)},e.prototype.stringEquals=function(e,t){return this.data[e]===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return 0},e}(),b=function(){function e(e,t){this.data=e,this.mask=t,this.isDefined=!0}return e.prototype.getString=function(e){return 0===this.mask[e]?this.data[e]:null},e.prototype.getInteger=function(e){if(0!==this.mask[e])return 0;let t=this.data[e];return p(t||"",0,(t||"").length)},e.prototype.getFloat=function(e){if(0!==this.mask[e])return 0;let t=this.data[e];return u(t||"",0,(t||"").length)},e.prototype.stringEquals=function(e,t){return this.data[e]===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return this.mask[e]},e}(),y=function(){function e(e){this.dataBlocks=e.dataBlocks.map((function(e){return new i(e)}))}return e.prototype.toJSON=function(){return this.dataBlocks.map((function(e){return e.toJSON()}))},e}();return new y(s)}MessagePackParse(e){this.icn3d.icn3dui;let t=this;function s(e,s){let i={};for(let l=0;l<s;l++){i[t.MessagePackParse(e)]=t.MessagePackParse(e)}return i}function i(e,t){let s=new Uint8Array(t),i=e.offset;for(let l=0;l<t;l++)s[l]=e.buffer[l+i];return e.offset+=t,s}function l(e,s){let i=new Array(s);for(let l=0;l<s;l++)i[l]=t.MessagePackParse(e);return i}function n(e,t){let s=function(e,t,s){let i,l=r,n=[],o=512,a=0;for(let r=t,d=t+s;r<d;r++){let t=e[r];0==(128&t)?n[a++]=l[t]:192==(224&t)?n[a++]=l[(15&t)<<6|63&e[++r]]:224==(240&t)?n[a++]=String.fromCharCode((15&t)<<12|(63&e[++r])<<6|(63&e[++r])<<0):240==(248&t)?n[a++]=String.fromCharCode((7&t)<<18|(63&e[++r])<<12|(63&e[++r])<<6|(63&e[++r])<<0):throwError("Invalid byte "+t.toString(16)),a===o&&(i=i||[],i[i.length]=n.join(""),a=0)}if(!i)return n.slice(0,a).join("");a>0&&(i[i.length]=n.slice(0,a).join(""));return i.join("")}(e.buffer,e.offset,t);return e.offset+=t,s}let r=function(){let e=[];for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();let o,a,d=e.buffer[e.offset];if(0==(128&d))return e.offset++,d;if(128==(240&d))return a=15&d,e.offset++,s(e,a);if(144==(240&d))return a=15&d,e.offset++,l(e,a);if(160==(224&d))return a=31&d,e.offset++,n(e,a);if(224==(224&d))return o=e.dataView.getInt8(e.offset),e.offset++,o;switch(d){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return a=e.dataView.getUint8(e.offset+1),e.offset+=2,i(e,a);case 197:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,i(e,a);case 198:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,i(e,a);case 202:return o=e.dataView.getFloat32(e.offset+1),e.offset+=5,o;case 203:return o=e.dataView.getFloat64(e.offset+1),e.offset+=9,o;case 204:return o=e.buffer[e.offset+1],e.offset+=2,o;case 205:return o=e.dataView.getUint16(e.offset+1),e.offset+=3,o;case 206:return o=e.dataView.getUint32(e.offset+1),e.offset+=5,o;case 208:return o=e.dataView.getInt8(e.offset+1),e.offset+=2,o;case 209:return o=e.dataView.getInt16(e.offset+1),e.offset+=3,o;case 210:return o=e.dataView.getInt32(e.offset+1),e.offset+=5,o;case 217:return a=e.dataView.getUint8(e.offset+1),e.offset+=2,n(e,a);case 218:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,n(e,a);case 219:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,n(e,a);case 220:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,l(e,a);case 221:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,l(e,a);case 222:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,s(e,a);case 223:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,s(e,a)}}}class ht{constructor(e){this.icn3d=e}alignSW(e,t,s,i,l,n,r=!1){this.icn3d.icn3dui;let o=this.bsa_align(r,e,t,[s,i],[l,n]),a="score: "+o[0]+"\n";a+="start: "+o[1]+"\n",a+="cigar: "+this.bsa_cigar2str(o[2])+"\n\n",a+="alignment:\n\n";let d=this.bsa_cigar2gaps(e,t,o[1],o[2]),c={};return c.score=o[0],c.start=o[1],c.cigar=this.bsa_cigar2str(o[2]),c.target=d[0],c.query=d[1],c}bsg_enc_seq(e,t){if(this.icn3d.icn3dui,null==t)return null;let s=[];s.length=e.length;for(let i=0;i<e.length;++i)s[i]=t[e.charCodeAt(i)];return s}bsa_gen_score_matrix(e,t,s){this.icn3d.icn3dui;let i,l,n=[];for(s>0&&(s=-s),i=0;i<e-1;++i){for(n[i]=[],l=0;l<e-1;++l)n[i][l]=i==l?t:s;n[i][l]=0}n[e-1]=[];for(let t=0;t<e;++t)n[e-1][t]=0;return n}bsa_gen_query_profile(e,t,s){this.icn3d.icn3dui;let i,l="string"==typeof e?this.bsg_enc_seq(e,s):e,n=[];if(t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]){if(null==s)return null;let e="number"==typeof s?s:s[s.length-1]+1;i=this.bsa_gen_score_matrix(e,t[0],t[1])}else i=t;for(let e=0;e<i.length;++e){let t,s=i[e];t=n[e]=[];for(let e=0;e<l.length;++e)t[e]=s[l[e]]}return n}bsa_align(e,t,s,i,l,n,r){this.icn3d.icn3dui;null==r&&(r=[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,4,1,4,4,4,2,4,4,4,4,4,4,4,4,4,4,4,4,3,4,4,4,4,4,4,4,4,4,4,4,4,0,4,1,4,4,4,2,4,4,4,4,4,4,4,4,4,4,4,4,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]);let o=this.bsg_enc_seq(t,r),a=this.bsa_gen_query_profile(s,i,r),d=a[0].length,c=d>o.length?d:o.length;n=null==n||n<0?c:n;let h,m,p=o.target>d?o.target-d:d-o.target;n=n>p?n:p,"number"==typeof l?(h=0,m=l>0?l:-l):(h=l[0]>0?l[0]:-l[0],m=l[1]>0?l[1]:-l[1]);let u,C=h+m,g=-1073741824,f=[],b=[],y=[],v=0,_=-1,S=-1;if(e)for(let e=0;e<=d;++e)f[e]=b[e]=0;else{f[0]=0,b[0]=-C-C;for(let e=1;e<=d;++e)e>=n?f[e]=b[e]=g:(f[e]=-(C+m*(e-1)),b[e]=-(C+C+m*e))}for(let t=0;t<o.length;++t){let s,i=0,l=0,r=0,c=-1,h=a[o[t]];s=y[t]=[];let p=t>n?t-n:0,u=t+n+1<d?t+n+1:d;e||(i=p>0?g:-(C+m*t),l=p>0?g:-(C+C+m*t));for(let t=p;t<u;++t){let n,o=b[t],a=f[t];f[t]=i,a+=h[t],n=a>=o?0:1,a=a>=o?a:o,n=a>=l?n:2,a=a>=l?a:l,n=!e||a>0?n:64,i=a,c=r>a?c:t,r=r>a?r:a,a-=C,a=!e||a>0?a:0,o-=m,n|=o>a?4:0,o=o>a?o:a,b[t]=o,l-=m,n|=l>a?32:0,l=l>a?l:a,s[t]=n}f[u]=i,b[u]=e?0:g,r>v&&(v=r,_=t,S=c)}if(e&&0==v)return null;u=e?v:f[d];let w,A,x,k=[],O=0,H=0;for(e?(A=_,x=S,S!=d-1&&this.push_cigar(k,4,d-1-S)):(A=o.length-1,x=(A+n+1<d?A+n+1:d)-1);A>=0&&x>=0&&(w=y[A][x-(A>n?A-n:0)],O=w>>(O<<1)&3,!(0==O&&w>>6));)0==O&&(O=3&w),0==O?(this.push_cigar(k,0,1),--A,--x):1==O?(this.push_cigar(k,2,1),--A):(this.push_cigar(k,1,1),--x);e?(x>=0&&this.push_cigar(k,4,x+1),H=A+1):(A>=0&&this.push_cigar(k,2,A+1),x>=0&&this.push_cigar(k,1,x+1));for(let e=0;e<k.length>>1;++e)w=k[e],k[e]=k[k.length-1-e],k[k.length-1-e]=w;return[u,H,k]}push_cigar(e,t,s){this.icn3d.icn3dui,0==e.length||t!=(15&e[e.length-1])?e.push(s<<4|t):e[e.length-1]+=s<<4}bsa_cigar2gaps(e,t,s,i){this.icn3d.icn3dui;let l="",n="",r="",o=0,a=s;for(let s=0;s<i.length;++s){let r=15&i[s],d=i[s]>>4;0==r?(l+=t.substr(o,d),n+=e.substr(a,d),o+=d,a+=d):1==r?(l+=t.substr(o,d),n+=Array(d+1).join("-"),o+=d):2==r?(l+=Array(d+1).join("-"),n+=e.substr(a,d),a+=d):4==r&&(o+=d)}let d=n.toUpperCase(),c=l.toUpperCase();for(let e=0;e<d.length;++e)r+=d.charAt(e)==c.charAt(e)?"|":" ";return[n,l,r]}bsa_cigar2str(e){this.icn3d.icn3dui;let t=[];for(let s=0;s<e.length;++s)t.push((e[s]>>4).toString()+"MIDNSHP=XB".charAt(15&e[s]));return t.join("")}}class mt{constructor(e){this.icn3d=e}rayCaster(e,t){this.rayCasterBase(e,t)}rayCasterBase(e,t){let s=this.icn3d;s.icn3dui;let i=e.pageX,l=e.pageY;e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]&&(i=e.originalEvent.targetTouches[0].pageX,l=e.originalEvent.targetTouches[0].pageY);let n=s.oriContainer.offset().left,r=s.oriContainer.offset().top,o=s.oriContainer.width(),a=s.oriContainer.height(),d=i-n,c=l-r;s.mouse.x=d/o*2-1,s.mouse.y=-c/a*2+1;let h=new THREE.Vector3;h.x=s.mouse.x,h.y=s.mouse.y,s.cam_z>0?h.z=-1:h.z=1,s.cam===s.perspectiveCamera?(s.cam_z>0?h.z=-1:h.z=1,h.unproject(s.cam),s.raycaster.set(s.cam.position,h.sub(s.cam.position).normalize())):s.cam===s.orthographicCamera&&(s.cam_z>0?h.z=1:h.z=-1,h.unproject(s.cam),s.raycaster.set(h,new THREE.Vector3(0,0,-1).transformDirection(s.cam.matrixWorld)));let m=this.isIntersect(s.objects,s.mdl,t,d,c);m||(m=this.isIntersect(s.objects_ghost,s.mdl_ghost,t,d,c))}isIntersect(e,t,s,i,l){let n=this.icn3d;n.icn3dui;let r=n.raycaster.intersectObjects(e),o=!1,a=t.position;if(r.length>0){r[0].point.sub(a);let e=n.rayThreshold,t=this.getAtomsFromPosition(r[0].point,e);for(;!t&&e<10;)e+=.5,t=this.getAtomsFromPosition(r[0].point,e);t?(o=!0,n.pickpair?s&&(n.pAtomNum%2==0?n.pAtom=t:n.pAtom2=t,++n.pAtomNum):n.pAtom=t,s?n.pickingCls.showPicking(t):n.pickingCls.showPicking(t,i,l)):console.log("No atoms were found in 10 andstrom range")}return o}getAtomsFromPosition(e,t){let s,i=this.icn3d,l=i.icn3dui;for(s in null==t&&(t=1),i.dAtoms){let n=i.atoms[s];if(i.ions.hasOwnProperty(s)&&"sphere"===i.opts.ions){let s=l.parasCls.vdwRadii[n.elem.toUpperCase()];if(Math.abs(n.coord.x-e.x)-s>t)continue;if(Math.abs(n.coord.y-e.y)-s>t)continue;if(Math.abs(n.coord.z-e.z)-s>t)continue}else{if(n.coord.x<e.x-t||n.coord.x>e.x+t)continue;if(n.coord.y<e.y-t||n.coord.y>e.y+t)continue;if(n.coord.z<e.z-t||n.coord.z>e.z+t)continue}return n}return null}}class pt{constructor(e){this.icn3d=e}setControl(){let e=this.icn3d,t=e.icn3dui;if(t.bNode)return;let s=this;e.WIDTH=e.container.width(),e.HEIGHT=e.container.height(),e.applyCenterCls.setWidthHeight(e.WIDTH,e.HEIGHT),e._zoomFactor=1,e.mouseChange=new THREE.Vector2(0,0),e.quaternion=new THREE.Quaternion(0,0,0,1),e.container.bind("contextmenu",(function(e){e.preventDefault()})),e.typetext=!1,$(document).bind("keyup",(function(t){16===t.keyCode&&(e.bShift=!1),17!==t.keyCode&&224!==t.keyCode&&91!==t.keyCode||(e.bCtrl=!1)})),$("input[type=text], textarea").focus((function(){e.typetext=!0})),$("input[type=text], textarea").blur((function(){e.typetext=!1})),$(document).bind("keydown",(function(s){if((s.shiftKey||16===s.keyCode)&&(e.bShift=!0),(s.ctrlKey||17===s.keyCode||224===s.keyCode||91===s.keyCode)&&(e.bCtrl=!0),!e.bControlGl&&!e.controls||e.bControlGl&&!window.controls)return;e.bStopRotate=!0;let i=e.bShift?90:5;if(!e.typetext)if(90===s.keyCode){let s={};e.bControlGl&&!t.bNode?window.cam===e.perspectiveCamera?s._zoomFactor=.9:window.cam===e.orthographicCamera&&(e._zoomFactor<.1?e._zoomFactor=.1:e._zoomFactor>1&&(e._zoomFactor=1),s._zoomFactor=.8*e._zoomFactor,s._zoomFactor<.1&&(s._zoomFactor=.1)):e.cam===e.perspectiveCamera?s._zoomFactor=.9:e.cam===e.orthographicCamera&&(e._zoomFactor<.1?e._zoomFactor=.1:e._zoomFactor>1&&(e._zoomFactor=1),s._zoomFactor=.8*e._zoomFactor,s._zoomFactor<.1&&(s._zoomFactor=.1)),s.update=!0,e.bControlGl&&!t.bNode?window.controls.update(s):e.controls.update(s),e.bRender&&e.drawCls.render()}else if(88===s.keyCode){let s={};e.bControlGl&&!t.bNode?window.cam===e.perspectiveCamera?s._zoomFactor=1.03:window.cam===e.orthographicCamera&&(e._zoomFactor>10?e._zoomFactor=10:e._zoomFactor<1&&(e._zoomFactor=1),s._zoomFactor=1.01*e._zoomFactor,s._zoomFactor>10&&(s._zoomFactor=10)):e.cam===e.perspectiveCamera?s._zoomFactor=1.03:e.cam===e.orthographicCamera&&(e._zoomFactor>10?e._zoomFactor=10:e._zoomFactor<1&&(e._zoomFactor=1),s._zoomFactor=1.01*e._zoomFactor,s._zoomFactor>10&&(s._zoomFactor=10)),s.update=!0,e.bControlGl&&!t.bNode?window.controls.update(s):e.controls.update(s),e.bRender&&e.drawCls.render()}else if(76===s.keyCode){let t=new THREE.Vector3(0,1,0),s=-i/180*Math.PI;e.transformCls.setRotation(t,s)}else if(74===s.keyCode){let t=new THREE.Vector3(0,1,0),s=i/180*Math.PI;e.transformCls.setRotation(t,s)}else if(73===s.keyCode){let t=new THREE.Vector3(1,0,0),s=-i/180*Math.PI;e.transformCls.setRotation(t,s)}else if(77===s.keyCode){let t=new THREE.Vector3(1,0,0),s=i/180*Math.PI;e.transformCls.setRotation(t,s)}else 65===s.keyCode&&Object.keys(e.structures).length>1&&e.alternateCls.alternateWrapper()})),e.container.bind("mouseup",(function(t){e.isDragging=!1})),e.container.bind("touchend",(function(t){e.isDragging=!1})),e.container.bind("mousedown",(function(s){if(e.isDragging=!0,e.scene){if(e.bStopRotate=!0,e.pk&&(s.altKey||s.ctrlKey||s.shiftKey||18===s.keyCode||16===s.keyCode||17===s.keyCode||224===s.keyCode||91===s.keyCode)){e.highlightlevel=e.pk;let t=!0;e.rayCls.rayCaster(s,t)}e.bControlGl&&!t.bNode?(window.controls.handleResize(),window.controls.update()):(e.controls.handleResize(),e.controls.update()),e.bRender&&e.drawCls.render()}})),e.container.bind("touchstart",(function(s){if(s.preventDefault(),e.isDragging=!0,!e.scene)return;e.bStopRotate=!0,$("#"+e.pre+"popup").hide();e.rayCls.rayCaster(s,!0),e.bControlGl&&!t.bNode?(window.controls.handleResize(),window.controls.update()):(e.controls.handleResize(),e.controls.update()),e.bRender&&e.drawCls.render()})),e.container.bind("mousemove touchmove",(function(e){s.mouseMove(e)})),e.container.bind("mousewheel",(function(s){s.preventDefault(),e.scene&&(e.bStopRotate=!0,e.bControlGl&&!t.bNode?(window.controls.handleResize(),window.controls.update()):(e.controls.handleResize(),e.controls.update()),e.bRender&&e.drawCls.render())})),e.container.bind("DOMMouseScroll",(function(s){s.preventDefault(),e.scene&&(e.bStopRotate=!0,e.bControlGl&&!t.bNode?(window.controls.handleResize(),window.controls.update()):(e.controls.handleResize(),e.controls.update()),e.bRender&&e.drawCls.render())}))}mouseMove(e){let t=this.icn3d,s=t.icn3dui;if(s.bNode)return;if(e.preventDefault(),!t.scene)return;$("#"+t.pre+"popup").hide();if(t.rayCls.rayCaster(e,!1),t.bControlGl&&!s.bNode){window.controls.handleResize(),window.controls.update();for(let e in window.icn3duiHash){let t=window.icn3duiHash[e].icn3d;t.bRender&&t.drawCls.render()}}else t.controls.handleResize(),t.controls.update(),t.bRender&&t.drawCls.render()}}class ut{constructor(e){let t=e;if(this.icn3dui=e,this.id=this.icn3dui.pre+"canvas",this.pre=this.icn3dui.pre,this.container=$("#"+this.id),this.oriContainer=$("#"+this.id),this.bControlGl=!1,this.maxatomcnt=1e5,this.overdraw=0,this.bDrawn=!1,this.bOpm=!1,this.crossstrucinter=0,this.bSecondaryStructure=!1,this.bHighlight=1,this.renderOrderPicking=-1,this.bInitial=!0,this.bDoublecolor=!1,this.originSize=1,this.ALTERNATE_STRUCTURE=-1,this.bUsePdbNum=!0,!this.icn3dui.bNode){let e=document.createElement("canvas");!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))?(this.renderer=new THREE.WebGL1Renderer({canvas:this.oriContainer.get(0),antialias:!0,preserveDrawingBuffer:!0,sortObjects:!1,alpha:!0}),this.overdraw=0):alert("Currently your web browser has a problem on WebGL. If you are using Chrome, open a new tab for the same URL and WebGL may work again.")}this.frac=new THREE.Color(.1,.1,.1),this.shininess=40,this.emissive=1118481,this.light1=.6,this.light2=.4,this.light3=.2,this.lineRadius=.1,this.coilWidth=.3,this.cylinderRadius=.4,this.traceRadius=.4,this.dotSphereScale=.3,this.sphereRadius=1.5,this.cylinderHelixRadius=1.6,this.ribbonthickness=.2,this.helixSheetWidth=1.3,this.nucleicAcidWidth=.8,this.scaleFactor=1,this.labelScale=1,this.resizeRatioX=1,this.resizeRatioY=1,this.bImpo=!0,this.bInstanced=!0,this.chainMissingResidueArray={},this._zoomFactor=1,this.icn3dui.bNode||(this.bExtFragDepth=this.renderer.extensions.get("EXT_frag_depth"),this.bExtFragDepth?console.log("EXT_frag_depth is supported. All spheres and cylinders are drawn using shaders."):(this.bImpo=!1,console.log("EXT_frag_depth is NOT supported. All spheres and cylinders are drawn using geometry.")),this.bInstanced=this.renderer.extensions.get("ANGLE_instanced_arrays"),this.bInstanced?console.log("ANGLE_instanced_arrays is supported. Assembly is drawn with one copy of the asymmetric unit using hardware instancing."):console.log("ANGLE_instanced_arrays is NOT supported. Assembly is drawn by making copies of the asymmetric unit.")),this.posArray=new Array,this.colorArray=new Array,this.pos2Array=new Array,this.color2Array=new Array,this.radiusArray=new Array,this.posArraySphere=new Array,this.colorArraySphere=new Array,this.radiusArraySphere=new Array,this.axis=!1,this.pk=1,this.highlightlevel=1,this.pickpair=!1,this.pAtomNum=0,this.pAtom=void 0,this.pAtom2=void 0,this.bCtrl=!1,this.bShift=!1,this.bStopRotate=!1,this.bCalphaOnly=!1,this.bConsiderNeighbors=!1,this.bShowCrossResidueBond=!0,this.bExtrude=!0,this.effects={none:this.renderer},this.maxD=500,this.oriMaxD=this.maxD,this.cam_z=2*this.maxD,this.commands=[],this.optsHistory=[],this.logs=[],this.bRender=!0,this.hColor=new THREE.Color(16777011),this.sphereGeometry=new THREE.SphereGeometry(1,32,32),this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,32,1),this.cylinderGeometryOutline=new THREE.CylinderGeometry(1,1,1,32,1,!0),this.axisDIV=15,this.strandDIV=6,this.tubeDIV=8,this.nucleicAcidStrandDIV=6,this.linewidth=1,this.hlLineRadius=.1,this.threshbox=180,this.maxAtoms3DMultiFile=4e4,this.tsHbond=3.8,this.tsIonic=6,this.tsContact=4,this.tsHalogen=3.8,this.tsPication=6,this.tsPistacking=5.5,this.LABELSIZE=30,this.rayThreshold=.5,this.colorBlackbkgd="#ffff00",this.colorWhitebkgd="#000000",this.optsOri={},this.optsOri.camera="perspective",this.optsOri.background="black",this.optsOri.color="chain",this.optsOri.proteins="ribbon",this.optsOri.sidec="nothing",this.optsOri.nucleotides="nucleotide cartoon",this.optsOri.ntbase="nothing",this.optsOri.surface="nothing",this.optsOri.opacity="1.0",this.optsOri.wireframe="no",this.optsOri.map="nothing",this.optsOri.mapwireframe="yes",this.optsOri.emmap="nothing",this.optsOri.emmapwireframe="yes",this.optsOri.phimap="nothing",this.optsOri.phimapwireframe="yes",this.optsOri.phisurface="nothing",this.optsOri.phisurftype="nothing",this.optsOri.phisurfop="1.0",this.optsOri.phisurfwf="yes",this.optsOri.chemicals="stick",this.optsOri.water="nothing",this.optsOri.ions="sphere",this.optsOri.hbonds="no",this.optsOri.saltbridge="no",this.optsOri.contact="no",this.optsOri.halogen="no",this.optsOri["pi-cation"]="no",this.optsOri["pi-stacking"]="no",this.optsOri.ssbonds="yes",this.optsOri.clbonds="yes",this.optsOri.rotationcenter="molecule center",this.optsOri.axis="no",this.optsOri.fog="no",this.optsOri.slab="no",this.optsOri.pk="residue",this.optsOri.chemicalbinding="hide",this.opts=t.hashUtilsCls.cloneHash(this.optsOri),this.sheetcolor="green",this.bShowHighlight=!0,this.mapData={},this.bFullUi=!0,this.divid=this.icn3dui.cfg.divid,this.inputid="",this.setOperation="or",this.ROT_DIR="right",this.currSelectedSets=[],this.selectedResidues={},this.residNCBI2resid={},this.bHideSelection=!0,this.bSelectResidue=!1,this.bSelectAlignResidue=!1,this.bAnnoShown=!1,this.bSetChainsAdvancedMenu=!1,this.b2DShown=!1,this.bCrashed=!1,this.bAddCommands=!0,this.bAddLogs=!0,this.bNotLoadStructure=!1,this.InputfileData="",this.startColor="blue",this.midColor="white",this.endColor="red",this.startValue=0,this.midValue=50,this.endValue=100,this.sceneCls=new We(this),this.cameraCls=new a(this),this.fogCls=new c(this),this.boxCls=new g(this),this.brickCls=new y(this),this.curveStripArrowCls=new u(this),this.curveCls=new p(this),this.cylinderCls=new S(this),this.lineCls=new v(this),this.reprSubCls=new C(this),this.sphereCls=new _(this),this.stickCls=new Ne(this),this.strandCls=new b(this),this.stripCls=new m(this),this.tubeCls=new f(this),this.cartoonNuclCls=new $e(this),this.surfaceCls=new H(this),this.labelCls=new qe(this),this.axesCls=new z(this),this.glycanCls=new je(this),this.applyCenterCls=new d(this),this.applyClbondsCls=new w(this),this.applyDisplayCls=new Be(this),this.applyMapCls=new E(this),this.applyOtherCls=new Ge(this),this.applySsbondsCls=new Ve(this),this.applySymdCls=new ze(this),this.hlObjectsCls=new R(this),this.residueLabelsCls=new G(this),this.alternateCls=new ot(this),this.drawCls=new Je(this),this.firstAtomObjCls=new h(this),this.impostorCls=new Ye(this),this.instancingCls=new Xe(this),this.contactCls=new A(this),this.hBondCls=new F(this),this.piHalogenCls=new P(this),this.saltbridgeCls=new L(this),this.loadPDBCls=new X(this),this.transformCls=new Ke(this),this.setStyleCls=new Le(this),this.setColorCls=new j(this),this.threeDPrintCls=new I(this),this.export3DCls=new T(this),this.annoCddSiteCls=new ge(this),this.annoContactCls=new Oe(this),this.annoCrossLinkCls=new He(this),this.annoDomainCls=new De(this),this.annoSnpClinVarCls=new Re(this),this.annoSsbondCls=new fe(this),this.annoTransMemCls=new Ie(this),this.domain3dCls=new me(this),this.addTrackCls=new ue(this),this.annotationCls=new Ee(this),this.showAnnoCls=new ke(this),this.showSeqCls=new pe(this),this.hlSeqCls=new xe(this),this.hlUpdateCls=new Me(this),this.lineGraphCls=new U(this),this.getGraphCls=new N(this),this.showInterCls=new B(this),this.viewInterPairsCls=new q(this),this.drawGraphCls=new at(this),this.contactMapCls=new dt(this),this.alignParserCls=new ie(this),this.chainalignParserCls=new oe(this),this.dsn6ParserCls=new ae(this),this.mmcifParserCls=new Ae(this),this.mmdbParserCls=new ne(this),this.mmtfParserCls=new se(this),this.mol2ParserCls=new Z(this),this.opmParserCls=new le(this),this.pdbParserCls=new te(this),this.sdfParserCls=new K(this),this.xyzParserCls=new Q(this),this.realignParserCls=new re(this),this.densityCifParserCls=new ct(this),this.ParserUtilsCls=new we(this),this.loadAtomDataCls=new J(this),this.setSeqAlignCls=new Se(this),this.applyCommandCls=new ye(this),this.definedSetsCls=new M(this),this.loadScriptCls=new ce(this),this.selByCommCls=new ve(this),this.selectionCls=new Fe(this),this.resid2specCls=new _e(this),this.delphiCls=new V(this),this.dsspCls=new ee(this),this.scapCls=new W(this),this.symdCls=new Y(this),this.alignSWCls=new ht(this),this.analysisCls=new Ce(this),this.resizeCanvasCls=new he(this),this.saveFileCls=new Qe(this),this.setOptionCls=new Pe(this),this.shareLinkCls=new D(this),this.diagram2dCls=new Te(this),this.cartoon2dCls=new de(this),this.rayCls=new mt(this),this.controlCls=new pt(this),this.pickingCls=new be(this),this.matShader=this.setColorCls.setOutlineColor("yellow")}}ut.prototype.init=function(e){this.init_base(),this.molTitle="",this.ssbondpnts={},this.clbondpnts={},this.biomtMatrices=[],this.bAssembly=!0,this.bDrawn=!1,this.bSecondaryStructure=!1,this.bHighlight=1,this.axes=[]},ut.prototype.init_base=function(e){this.resetConfig(),this.structures={},this.chains={},this.tddomains={},this.residues={},this.secondaries={},this.alnChains={},this.chainsSeq={},this.chainsColor={},this.chainsGene={},this.chainsAn={},this.chainsAnTitle={},this.chainsMapping={},this.alnChainsSeq={},this.alnChainsAnno={},this.alnChainsAnTtl={},this.pickedAtomList={},this.prevHighlightObjects=[],this.prevHighlightObjects_ghost=[],this.prevSurfaces=[],this.prevMaps=[],this.prevEmmaps=[],this.prevPhimaps=[],this.prevOtherMesh=[],this.defNames2Residues={},this.defNames2Atoms={},this.defNames2Descr={},this.defNames2Command={},this.residueId2Name={},this.atoms={},this.dAtoms={},this.hAtoms={},this.proteins={},this.sidec={},this.ntbase={},this.nucleotides={},this.nucleotidesO3={},this.chemicals={},this.ions={},this.water={},this.calphas={},this.hbondpnts=[],this.saltbridgepnts=[],this.contactpnts=[],this.stabilizerpnts=[],this.halogenpnts=[],this.picationpnts=[],this.pistackingpnts=[],this.distPnts=[],this.doublebonds={},this.triplebonds={},this.aromaticbonds={},this.atomPrevColors={},this.style2atoms={},this.labels={},this.lines={},this.resids2inter={},this.resids2interAll={},this.transformCls.rotateCount=0,this.transformCls.rotateCountMax=20,e&&(this.commands=[]),this.axes=[],this.bGlycansCartoon=0,this.bMembrane=1,this.chainid2offset={},this.chainMissingResidueArray={},this.nTotalGap=0},ut.prototype.reinitAfterLoad=function(){let e=this,t=e.icn3dui;e.resetConfig(),e.setStyleCls.setAtomStyleByOptions(),e.setColorCls.setColorByOptions(e.opts,e.atoms),e.dAtoms=t.hashUtilsCls.cloneHash(e.atoms),e.hAtoms=t.hashUtilsCls.cloneHash(e.atoms),e.prevHighlightObjects=[],e.prevHighlightObjects_ghost=[],e.prevSurfaces=[],e.prevMaps=[],e.prevEmmaps=[],e.prevPhimaps=[],e.prevOtherMesh=[],e.labels={},e.lines={},e.bAssembly=!0},ut.prototype.resetConfig=function(){let e=this.icn3dui;this.opts=e.hashUtilsCls.cloneHash(this.optsOri),void 0===e.cfg.align&&void 0===e.cfg.chainalign||(this.opts.color="identity",this.opts.proteins="c alpha trace",this.opts.nucleotides="o3 trace"),void 0!==e.cfg.cid&&(this.opts.color="atom",this.opts.pk="atom",this.opts.chemicals="ball and stick"),void 0!==e.cfg.afid&&(this.opts.color="confidence"),void 0!==e.cfg.blast_rep_id&&(this.opts.color="conservation"),void 0!==e.cfg.mmdbafid&&(this.opts.color="structure"),void 0!==e.cfg.options&&$.extend(this.opts,e.cfg.options)};class Ct{constructor(e){this.cfg=e,this.pre=this.cfg.divid+"_",this.REVISION="3.11.5",this.bNode=Object.keys(window).length<2,void 0===this.cfg.command&&(this.cfg.command=""),void 0===this.cfg.width&&(this.cfg.width="100%"),void 0===this.cfg.height&&(this.cfg.height="100%"),void 0===this.cfg.resize&&(this.cfg.resize=!0),void 0===this.cfg.showmenu&&(this.cfg.showmenu=!0),void 0===this.cfg.showtitle&&(this.cfg.showtitle=!0),void 0===this.cfg.showcommand&&(this.cfg.showcommand=!0),void 0===this.cfg.simplemenu&&(this.cfg.simplemenu=!1),void 0===this.cfg.mobilemenu&&(this.cfg.mobilemenu=!1),void 0===this.cfg.closepopup&&(this.cfg.closepopup=!1),void 0===this.cfg.showanno&&(this.cfg.showanno=!1),void 0===this.cfg.showseq&&(this.cfg.showseq=!1),void 0===this.cfg.showalignseq&&(this.cfg.showalignseq=!1),void 0===this.cfg.show2d&&(this.cfg.show2d=!1),void 0===this.cfg.showsets&&(this.cfg.showsets=!1),void 0===this.cfg.rotate&&(this.cfg.rotate="right"),void 0===this.cfg.hidelicense&&(this.cfg.hidelicense=!1),this.hashUtilsCls=new t(this),this.utilsCls=new i(this),this.parasCls=new s(this),this.myEventCls=new l(this),this.rmsdSuprCls=new n(this),this.subdivideCls=new r(this),this.convertTypeCls=new o(this),this.htmlCls=new rt(this)}allCustomEvents(){}}Ct.prototype.show3DStructure=function(e){let t=this,s=this;return t.deferred=$.Deferred((function(){t.cfg.menuicon?(t.htmlCls.wifiStr='<i class="icn3d-wifi" title="requires internet">&nbsp;</i>',t.htmlCls.licenseStr='<i class="icn3d-license" title="requires license">&nbsp;</i>'):(t.htmlCls.wifiStr="",t.htmlCls.licenseStr=""),t.setIcn3d();let i=t.icn3d;t.utilsCls.isSessionStorageSupported()&&i.setStyleCls.getCommandsBeforeCrash();let l=t.htmlCls.WIDTH,n=t.htmlCls.HEIGHT;t.oriWidth=l,t.oriHeight=n,t.htmlCls.eventsCls.allEventFunctions(),s.allCustomEvents();let r=0;if((null==t.cfg.showmenu||t.cfg.showmenu)&&(r+=t.htmlCls.MENU_HEIGHT),(null==t.cfg.showcommand||t.cfg.showcommand)&&(r+=t.htmlCls.CMD_HEIGHT),null!=t.cfg.showmenu&&0==t.cfg.showmenu?t.htmlCls.setMenuCls.hideMenu():t.htmlCls.setMenuCls.showMenu(),null!=t.cfg.showtitle&&0==t.cfg.showtitle?$("#"+i.pre+"title").hide():$("#"+i.pre+"title").show(),$("#"+i.pre+"viewer").width(l).height(parseInt(n)+r),$("#"+i.pre+"canvas").width(l).height(parseInt(n)),$("#"+i.pre+"canvas").resizable({resize:function(e,s){t.htmlCls.WIDTH=s.size.width,t.htmlCls.HEIGHT=s.size.height,void 0===i||t.icn3d.bFullscreen||i.resizeCanvasCls.resizeCanvas(t.htmlCls.WIDTH,t.htmlCls.HEIGHT,!0)}}),void 0!==t.cfg.usepdbnum?t.icn3d.bUsePdbNum=t.cfg.usepdbnum:void 0!==t.cfg.date?t.icn3d.bUsePdbNum=parseInt(t.cfg.date)>=20201222:"1tup"==t.cfg.mmdbid&&1==t.cfg.showanno&&1==t.cfg.show2d&&1==t.cfg.showsets||"118496"==t.cfg.mmdbid&&0==t.cfg.showanno&&-1!=t.cfg.inpara.indexOf("bu=1")||"163605,1,91105,1,1,1"==t.cfg.align&&-1!=t.cfg.inpara.indexOf("atype=1")?t.icn3d.bUsePdbNum=!1:t.icn3d.bUsePdbNum=!0,t.cfg.replay?(i.bReplay=1,$("#"+i.pre+"replay").show()):(i.bReplay=0,$("#"+i.pre+"replay").hide()),t.utilsCls.isMobile()&&(i.threshbox=60),t.cfg.controlGl&&(i.bControlGl=!0,i.container=i.bControlGl&&!t.bNode?$(document):$("#"+i.id)),i.setStyleCls.handleContextLost(),i.applyCenterCls.setWidthHeight(l,n),i.ori_chemicalbinding=i.opts.chemicalbinding,void 0!==t.cfg.bCalphaOnly&&(i.bCalphaOnly=t.cfg.bCalphaOnly),i.opts=t.hashUtilsCls.cloneHash(i.opts),i.STATENUMBER=i.commands.length,t.utilsCls.isSessionStorageSupported()&&i.bCrashed){i.bCrashed=!1;let e=i.commandsBeforeCrash.split("|||")[0],s=e.substr(e.lastIndexOf(" ")+1);if(s===t.cfg.mmtfid||s===t.cfg.pdbid||s===t.cfg.opmid||s===t.cfg.mmdbid||s===t.cfg.gi||s===t.cfg.blast_rep_id||s===t.cfg.cid||s===t.cfg.mmcifid||s===t.cfg.align||s===t.cfg.chainalign||s===t.cfg.mmdbafid)return void i.loadScriptCls.loadScript(i.commandsBeforeCrash,!0)}if(i.molTitle="",i.loadCmd,e){if(i.init(),i.pdbParserCls.loadPdbData(e),void 0!==t.cfg.resdef&&void 0!==t.cfg.chains){let e=Object.keys(i.structures),s=t.cfg.chains.split(" | "),l=[];if(e.length==s.length){for(let t=0,i=e.length;t<i;++t)l.push(e[t]+"_"+s[t]);let t=!0,n=!0;i.realignParserCls.realignChainOnSeqAlign(void 0,l,t,n)}}else if(void 0!==t.cfg.resdef&&void 0!==t.cfg.matchedchains){let e=Object.keys(i.structures)[0]+"_"+t.cfg.masterchain,s=t.cfg.matchedchains.split(","),l="";for(let e=0,t=s.length;e<t;++e)e>0&&(l+=","),l+=s[e].substr(0,s[e].indexOf("_"));i.bNCBI=!0,i.bMmdbafid=!0,i.loadCmd="load mmdbaf0 "+l,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0);let n=!0;i.chainalignParserCls.downloadMmdbAf(l,n),i.chainidArray=[e].concat(s)}}else if(void 0!==t.cfg.url){i.bInputUrlfile=!0;let e=t.cfg.url.split("|"),s=e[0],l=e[1];i.molTitle="",i.inputid=l,i.inputurl="type="+s+"&url="+encodeURIComponent(l),i.loadCmd="load url "+l+" | type "+s,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.pdbParserCls.downloadUrl(l,s,t.cfg.command)}else if(void 0!==t.cfg.mmtfid)i.inputid=t.cfg.mmtfid,i.loadCmd="load mmtf "+t.cfg.mmtfid,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.mmtfParserCls.downloadMmtf(t.cfg.mmtfid);else if(void 0!==t.cfg.pdbid)i.inputid=t.cfg.pdbid,i.loadCmd="load pdb "+t.cfg.pdbid,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.pdbParserCls.downloadPdb(t.cfg.pdbid);else if(void 0!==t.cfg.afid){i.inputid=t.cfg.afid,i.loadCmd="load af "+t.cfg.afid,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0);let e=!0;i.pdbParserCls.downloadPdb(t.cfg.afid,e)}else if(void 0!==t.cfg.opmid)i.inputid=t.cfg.opmid,i.loadCmd="load opm "+t.cfg.opmid,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.opmParserCls.downloadOpm(t.cfg.opmid);else if(void 0!==t.cfg.mmdbid)i.inputid=t.cfg.mmdbid,i.bNCBI=!0,i.loadCmd="load mmdb "+t.cfg.mmdbid+" | parameters "+t.cfg.inpara,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.mmdbParserCls.downloadMmdb(t.cfg.mmdbid);else if(void 0!==t.cfg.gi)i.bNCBI=!0,i.loadCmd="load gi "+t.cfg.gi,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.mmdbParserCls.downloadGi(t.cfg.gi);else if(void 0!==t.cfg.uniprotid)i.loadCmd="load uniprotid "+t.cfg.uniprotid,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.mmdbParserCls.downloadUniprotid(t.cfg.uniprotid);else if(void 0!==t.cfg.blast_rep_id)if(i.bNCBI=!0,"Query"!==t.cfg.query_id.substr(0,5)&&void 0===t.cfg.rid)i.inputid=t.cfg.query_id+"_"+t.cfg.blast_rep_id,"smithwm"==t.cfg.alg?(i.loadCmd="load seq_struct_ids_smithwm "+t.cfg.query_id+","+t.cfg.blast_rep_id,i.bSmithwm=!0):(i.loadCmd="load seq_struct_ids "+t.cfg.query_id+","+t.cfg.blast_rep_id,i.bSmithwm=!1),t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.mmdbParserCls.downloadBlast_rep_id(t.cfg.query_id+","+t.cfg.blast_rep_id);else if(void 0!==t.cfg.rid){let e="https://blast.ncbi.nlm.nih.gov/Blast.cgi?RESULTS_FILE=on&FORMAT_TYPE=JSON2_S&FORMAT_OBJECT=Alignment&CMD=Get&RID="+t.cfg.rid;$.ajax({url:e,dataType:"json",tryCount:0,retryLimit:0,success:function(e){for(let s=0,l=e.BlastOutput2.length;s<l;++s){if(e.BlastOutput2[s].report.results.search.query_id!=t.cfg.query_id)continue;let l,n=e.BlastOutput2[s].report.results.search.hits;for(let e=0,s=n.length;e<s;++e){let s=n[e],i=!1;for(let e=0,l=s.description.length;e<l;++e){if(s.description[e].accession==t.cfg.blast_rep_id){i=!0;break}}if(i){l=s.hsps[0].qseq,l=l.replace(/-/g,"");break}}void 0!==l&&(t.cfg.query_id=l),i.inputid=t.cfg.query_id+"_"+t.cfg.blast_rep_id,i.loadCmd="load seq_struct_ids "+t.cfg.query_id+","+t.cfg.blast_rep_id,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.mmdbParserCls.downloadBlast_rep_id(t.cfg.query_id+","+t.cfg.blast_rep_id);break}},error:function(e,s,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):alert("The RID "+t.cfg.rid+" may have expired...")}})}else alert('BLAST "RID" is a required parameter...');else if(void 0!==t.cfg.cid){i.inputid=t.cfg.cid;let e="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+i.inputid+"/description/jsonp";$.ajax({url:e,dataType:"jsonp",tryCount:0,retryLimit:0,success:function(e){void 0!==e.InformationList&&void 0!==e.InformationList.Information&&(i.molTitle=e.InformationList.Information[0].Title)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}}),i.loadCmd="load cid "+t.cfg.cid,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.sdfParserCls.downloadCid(t.cfg.cid)}else if(void 0!==t.cfg.mmcifid)i.inputid=t.cfg.mmcifid,i.loadCmd="load mmcif "+t.cfg.mmcifid,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.mmcifParserCls.downloadMmcif(t.cfg.mmcifid);else if(void 0!==t.cfg.align){i.bNCBI=!0;let e=t.cfg.align.split(",");6===e.length?i.inputid=e[0]+"_"+e[3]:2===e.length&&(i.inputid=e[0]+"_"+e[1]),i.loadCmd="load alignment "+t.cfg.align+" | parameters "+t.cfg.inpara,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.alignParserCls.downloadAlignment(t.cfg.align)}else void 0!==t.cfg.chainalign?(i.bNCBI=!0,i.bChainAlign=!0,i.inputid=t.cfg.chainalign,i.loadCmd="load chainalignment "+t.cfg.chainalign+" | resnum "+t.cfg.resnum+" | resdef "+t.cfg.resdef+" | parameters "+t.cfg.inpara,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),i.chainalignParserCls.downloadChainalignment(t.cfg.chainalign,t.cfg.resnum,t.cfg.resdef)):void 0!==t.cfg.mmdbafid?(i.bNCBI=!0,i.bMmdbafid=!0,i.inputid=t.cfg.mmdbafid,1==t.cfg.bu?i.loadCmd="load mmdbaf1 "+t.cfg.mmdbafid+" | parameters "+t.cfg.inpara:i.loadCmd="load mmdbaf0 "+t.cfg.mmdbafid+" | parameters "+t.cfg.inpara,t.htmlCls.clickMenuCls.setLogCmd(i.loadCmd,!0),$.when(i.chainalignParserCls.downloadMmdbAf(t.cfg.mmdbafid)).then((function(){i.loadScriptCls.loadScript(t.cfg.command)}))):void 0!==t.cfg.command&&""!==t.cfg.command?(-1!==t.cfg.command.indexOf("url=")&&(i.bInputUrlfile=!0),i.loadScriptCls.loadScript(t.cfg.command)):t.htmlCls.dialogCls.openDlg("dl_mmdbid","Please input MMDB or PDB ID")})),t.deferred.promise()},Ct.prototype.setIcn3d=function(){let e=this,t="<label class='icn3d-switch'><input id='"+e.pre+"modeswitch' type='checkbox'><div class='icn3d-slider icn3d-round' style='width:34px; height:18px; margin: 6px 0px 0px 3px;' title='Left(\"All atoms\"): Style and color menu options will be applied to all atoms in the structure&#13;Right(\"Selection\"): Style and color menu options will be applied only to selected atoms'></div></label>",s="<span id='"+e.pre+"modeall' title='Style and color menu options will be applied to all atoms in the structure'>All atoms&nbsp;&nbsp;</span><span id='"+e.pre+"modeselection' class='icn3d-modeselection' style='display:none;' title='Style and color menu options will be applied only to selected atoms'>Selection&nbsp;&nbsp;</span></div></div></td>";e.utilsCls.setViewerWidthHeight(e),e.utilsCls.isMobile()||e.cfg.mobilemenu?e.htmlCls.setMenuCls.setTopMenusHtmlMobile(e.cfg.divid,t,s):e.htmlCls.setMenuCls.setTopMenusHtml(e.cfg.divid,t,s),e.icn3d=new ut(e),e.icn3d.controlCls.setControl(),e.setDialogAjax()},Ct.prototype.setDialogAjax=function(){this.bNode||$.ui.dialog.prototype._makeDraggableBase||($.ui.dialog.prototype._makeDraggableBase=$.ui.dialog.prototype._makeDraggable,$.ui.dialog.prototype._makeDraggable=function(){this._makeDraggableBase(),this.uiDialog.draggable("option","containment",!1)}),$.ajaxTransport("+binary",(function(e,t,s){if(window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(t,s){let i=new XMLHttpRequest,l=e.url,n=e.type,r=e.async||!0,o=e.responseType||"blob",a=e.data||null;i.addEventListener("load",(function(){let t={};t[e.dataType]=i.response,s(i.status,i.statusText,t,i.getAllResponseHeaders())})),i.open(n,l,r);for(let e in t)i.setRequestHeader(e,t[e]);i.responseType=o,i.send(a)},abort:function(){s.abort()}}}))};return e.AddTrack=ue,e.AlignParser=ie,e.AlignSW=ht,e.AlignSeq=lt,e.Alternate=ot,e.Analysis=Ce,e.AnnoCddSite=ge,e.AnnoContact=Oe,e.AnnoCrossLink=He,e.AnnoDomain=De,e.AnnoSnpClinVar=Re,e.AnnoSsbond=fe,e.AnnoTransMem=Ie,e.Annotation=Ee,e.ApplyCenter=d,e.ApplyClbonds=w,e.ApplyCommand=ye,e.ApplyDisplay=Be,e.ApplyMap=E,e.ApplyOther=Ge,e.ApplySsbonds=Ve,e.ApplySymd=ze,e.Axes=z,e.Box=g,e.Brick=y,e.Camera=a,e.CartoonNucl=$e,e.ChainalignParser=oe,e.ClickMenu=Ze,e.Contact=A,e.Control=pt,e.ConvertTypeCls=o,e.Curve=p,e.CurveStripArrow=u,e.Cylinder=S,e.DefinedSets=M,e.Delphi=V,e.DensityCifParser=ct,e.Diagram2d=Te,e.Dialog=tt,e.Domain3d=me,e.Draw=Je,e.DrawGraph=at,e.Dsn6Parser=ae,e.Dssp=ee,e.ElectronMap=O,e.Events=it,e.Export3D=T,e.FirstAtomObj=h,e.Fog=c,e.GetGraph=N,e.Glycan=je,e.HBond=F,e.HashUtilsCls=t,e.HlObjects=R,e.HlSeq=xe,e.HlUpdate=Me,e.Html=rt,e.Impostor=Ye,e.Instancing=Xe,e.Label=qe,e.Line=v,e.LineGraph=U,e.LoadAtomData=J,e.LoadPDB=X,e.LoadScript=ce,e.MarchingCube=x,e.MmcifParser=Ae,e.MmdbParser=ne,e.MmtfParser=se,e.Mol2Parser=Z,e.MyEventCls=l,e.OpmParser=le,e.ParasCls=s,e.ParserUtils=we,e.PdbParser=te,e.PiHalogen=P,e.Picking=be,e.ProteinSurface=k,e.Ray=mt,e.RealignParser=re,e.ReprSub=C,e.Resid2spec=_e,e.ResidueLabels=G,e.ResizeCanvas=he,e.RmsdSuprCls=n,e.Saltbridge=L,e.SaveFile=Qe,e.Scap=W,e.Scene=We,e.SdfParser=K,e.SelectByCommand=ve,e.Selection=Fe,e.SetColor=j,e.SetDialog=st,e.SetHtml=nt,e.SetMenu=et,e.SetOption=Pe,e.SetSeqAlign=Se,e.SetStyle=Le,e.ShareLink=D,e.ShowAnno=ke,e.ShowInter=B,e.ShowSeq=pe,e.Sphere=_,e.Stick=Ne,e.Strand=b,e.Strip=m,e.SubdivideCls=r,e.Surface=H,e.Symd=Y,e.ThreeDPrint=I,e.Transform=Ke,e.Tube=f,e.UtilsCls=i,e.ViewInterPairs=q,e.XyzParser=Q,e.iCn3D=ut,e.iCn3DUI=Ct,e.printMsg=class{constructor(){console.log("This is a message from the icn3d package")}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
