{"ast":null,"code":"/**\r\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { __assign } from \"tslib\";\nimport { StateTransformer } from './transformer';\nimport { UUID } from '../mol-util';\nexport { Transform as StateTransform };\nvar Transform;\n\n(function (Transform) {\n  Transform.RootRef = '-=root=-';\n\n  function areStatesEqual(a, b) {\n    return !!a.isHidden !== !!b.isHidden || !!a.isCollapsed !== !!b.isCollapsed || !!a.isGhost !== !!b.isGhost || !!a.isLocked !== !!b.isLocked;\n  }\n\n  Transform.areStatesEqual = areStatesEqual;\n\n  function isStateChange(a, b) {\n    if (!b) return false;\n    if (typeof b.isCollapsed !== 'undefined' && a.isCollapsed !== b.isCollapsed) return true;\n    if (typeof b.isHidden !== 'undefined' && a.isHidden !== b.isHidden) return true;\n    if (typeof b.isGhost !== 'undefined' && a.isGhost !== b.isGhost) return true;\n    if (typeof b.isLocked !== 'undefined' && a.isLocked !== b.isLocked) return true;\n    return false;\n  }\n\n  Transform.isStateChange = isStateChange;\n\n  function assignState(a, b) {\n    if (!b) return false;\n    var changed = false;\n\n    for (var _i = 0, _a = Object.keys(b); _i < _a.length; _i++) {\n      var k = _a[_i];\n      var s = b[k],\n          t = a[k];\n      if (!!s === !!t) continue;\n      changed = true;\n      a[k] = s;\n    }\n\n    return changed;\n  }\n\n  Transform.assignState = assignState;\n\n  function syncState(a, b) {\n    if (!b) return false;\n    var changed = false;\n\n    for (var _i = 0, _a = Object.keys(b); _i < _a.length; _i++) {\n      var k = _a[_i];\n      var s = b[k],\n          t = a[k];\n      if (!!s === !!t) continue;\n      changed = true;\n      a[k] = s;\n    }\n\n    for (var _b = 0, _c = Object.keys(a); _b < _c.length; _b++) {\n      var k = _c[_b];\n      var s = b[k],\n          t = a[k];\n      if (!!s === !!t) continue;\n      changed = true;\n      a[k] = s;\n    }\n\n    return changed;\n  }\n\n  Transform.syncState = syncState;\n\n  function create(parent, transformer, params, options) {\n    var ref = options && options.ref ? options.ref : UUID.create22();\n    var tags = void 0;\n\n    if (options && options.tags) {\n      tags = typeof options.tags === 'string' ? [options.tags] : options.tags;\n      if (tags.length === 0) tags = void 0;else tags.sort();\n    }\n\n    return {\n      parent: parent,\n      transformer: transformer,\n      state: (options === null || options === void 0 ? void 0 : options.state) || {},\n      tags: tags,\n      ref: ref,\n      dependsOn: options && options.dependsOn,\n      params: params,\n      version: UUID.create22()\n    };\n  }\n\n  Transform.create = create;\n\n  function withParams(t, params) {\n    return __assign(__assign({}, t), {\n      params: params,\n      version: UUID.create22()\n    });\n  }\n\n  Transform.withParams = withParams;\n\n  function withState(t, state) {\n    if (!state) return t;\n    return __assign(__assign({}, t), {\n      state: __assign(__assign({}, t.state), state)\n    });\n  }\n\n  Transform.withState = withState;\n\n  function withTags(t, newTags) {\n    var tags = void 0;\n\n    if (newTags) {\n      tags = typeof newTags === 'string' ? [newTags] : newTags;\n      if (tags.length === 0) tags = void 0;else tags.sort();\n    }\n\n    return __assign(__assign({}, t), {\n      tags: tags,\n      version: UUID.create22()\n    });\n  }\n\n  Transform.withTags = withTags;\n\n  function withParent(t, parent) {\n    return __assign(__assign({}, t), {\n      parent: parent,\n      version: UUID.create22()\n    });\n  }\n\n  Transform.withParent = withParent;\n\n  function createRoot(state) {\n    return create(Transform.RootRef, StateTransformer.ROOT, {}, {\n      ref: Transform.RootRef,\n      state: state\n    });\n  }\n\n  Transform.createRoot = createRoot;\n\n  function hasTag(t, tag) {\n    if (!t.tags) return false;\n    return t.tags.indexOf(tag) >= 0;\n  }\n\n  Transform.hasTag = hasTag;\n\n  function hasTags(t, tags) {\n    if (!t.tags) return typeof tags !== 'string' && tags.length === 0;\n    if (typeof tags === 'string') return hasTag(t, tags);\n\n    for (var _i = 0, tags_1 = tags; _i < tags_1.length; _i++) {\n      var tag = tags_1[_i];\n      if (t.tags.indexOf(tag) < 0) return false;\n    }\n\n    return true;\n  }\n\n  Transform.hasTags = hasTags;\n\n  function _id(x) {\n    return x;\n  }\n\n  function toJSON(t) {\n    var pToJson = t.transformer.definition.customSerialization ? t.transformer.definition.customSerialization.toJSON : _id;\n    var state = void 0;\n\n    for (var _i = 0, _a = Object.keys(t.state); _i < _a.length; _i++) {\n      var k = _a[_i];\n      var s = t.state[k];\n      if (!s) continue;\n      if (!state) state = {};\n      state[k] = true;\n    }\n\n    return {\n      parent: t.parent,\n      transformer: t.transformer.id,\n      params: t.params ? pToJson(t.params) : void 0,\n      state: state,\n      tags: t.tags,\n      ref: t.ref,\n      dependsOn: t.dependsOn,\n      version: t.version\n    };\n  }\n\n  Transform.toJSON = toJSON;\n\n  function fromJSON(t) {\n    var transformer = StateTransformer.get(t.transformer);\n    var pFromJson = transformer.definition.customSerialization ? transformer.definition.customSerialization.fromJSON : _id;\n    return {\n      parent: t.parent,\n      transformer: transformer,\n      params: t.params ? pFromJson(t.params) : void 0,\n      state: t.state || {},\n      tags: t.tags,\n      ref: t.ref,\n      dependsOn: t.dependsOn,\n      version: t.version\n    };\n  }\n\n  Transform.fromJSON = fromJSON;\n})(Transform || (Transform = {}));","map":{"version":3,"sources":["../../src/mol-state/transform.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { __assign } from \"tslib\";\r\nimport { StateTransformer } from './transformer';\r\nimport { UUID } from '../mol-util';\r\nexport { Transform as StateTransform };\r\nvar Transform;\r\n(function (Transform) {\r\n    Transform.RootRef = '-=root=-';\r\n    function areStatesEqual(a, b) {\r\n        return !!a.isHidden !== !!b.isHidden || !!a.isCollapsed !== !!b.isCollapsed\r\n            || !!a.isGhost !== !!b.isGhost || !!a.isLocked !== !!b.isLocked;\r\n    }\r\n    Transform.areStatesEqual = areStatesEqual;\r\n    function isStateChange(a, b) {\r\n        if (!b)\r\n            return false;\r\n        if (typeof b.isCollapsed !== 'undefined' && a.isCollapsed !== b.isCollapsed)\r\n            return true;\r\n        if (typeof b.isHidden !== 'undefined' && a.isHidden !== b.isHidden)\r\n            return true;\r\n        if (typeof b.isGhost !== 'undefined' && a.isGhost !== b.isGhost)\r\n            return true;\r\n        if (typeof b.isLocked !== 'undefined' && a.isLocked !== b.isLocked)\r\n            return true;\r\n        return false;\r\n    }\r\n    Transform.isStateChange = isStateChange;\r\n    function assignState(a, b) {\r\n        if (!b)\r\n            return false;\r\n        var changed = false;\r\n        for (var _i = 0, _a = Object.keys(b); _i < _a.length; _i++) {\r\n            var k = _a[_i];\r\n            var s = b[k], t = a[k];\r\n            if (!!s === !!t)\r\n                continue;\r\n            changed = true;\r\n            a[k] = s;\r\n        }\r\n        return changed;\r\n    }\r\n    Transform.assignState = assignState;\r\n    function syncState(a, b) {\r\n        if (!b)\r\n            return false;\r\n        var changed = false;\r\n        for (var _i = 0, _a = Object.keys(b); _i < _a.length; _i++) {\r\n            var k = _a[_i];\r\n            var s = b[k], t = a[k];\r\n            if (!!s === !!t)\r\n                continue;\r\n            changed = true;\r\n            a[k] = s;\r\n        }\r\n        for (var _b = 0, _c = Object.keys(a); _b < _c.length; _b++) {\r\n            var k = _c[_b];\r\n            var s = b[k], t = a[k];\r\n            if (!!s === !!t)\r\n                continue;\r\n            changed = true;\r\n            a[k] = s;\r\n        }\r\n        return changed;\r\n    }\r\n    Transform.syncState = syncState;\r\n    function create(parent, transformer, params, options) {\r\n        var ref = options && options.ref ? options.ref : UUID.create22();\r\n        var tags = void 0;\r\n        if (options && options.tags) {\r\n            tags = typeof options.tags === 'string' ? [options.tags] : options.tags;\r\n            if (tags.length === 0)\r\n                tags = void 0;\r\n            else\r\n                tags.sort();\r\n        }\r\n        return {\r\n            parent: parent,\r\n            transformer: transformer,\r\n            state: (options === null || options === void 0 ? void 0 : options.state) || {},\r\n            tags: tags,\r\n            ref: ref,\r\n            dependsOn: options && options.dependsOn,\r\n            params: params,\r\n            version: UUID.create22()\r\n        };\r\n    }\r\n    Transform.create = create;\r\n    function withParams(t, params) {\r\n        return __assign(__assign({}, t), { params: params, version: UUID.create22() });\r\n    }\r\n    Transform.withParams = withParams;\r\n    function withState(t, state) {\r\n        if (!state)\r\n            return t;\r\n        return __assign(__assign({}, t), { state: __assign(__assign({}, t.state), state) });\r\n    }\r\n    Transform.withState = withState;\r\n    function withTags(t, newTags) {\r\n        var tags = void 0;\r\n        if (newTags) {\r\n            tags = typeof newTags === 'string' ? [newTags] : newTags;\r\n            if (tags.length === 0)\r\n                tags = void 0;\r\n            else\r\n                tags.sort();\r\n        }\r\n        return __assign(__assign({}, t), { tags: tags, version: UUID.create22() });\r\n    }\r\n    Transform.withTags = withTags;\r\n    function withParent(t, parent) {\r\n        return __assign(__assign({}, t), { parent: parent, version: UUID.create22() });\r\n    }\r\n    Transform.withParent = withParent;\r\n    function createRoot(state) {\r\n        return create(Transform.RootRef, StateTransformer.ROOT, {}, { ref: Transform.RootRef, state: state });\r\n    }\r\n    Transform.createRoot = createRoot;\r\n    function hasTag(t, tag) {\r\n        if (!t.tags)\r\n            return false;\r\n        return t.tags.indexOf(tag) >= 0;\r\n    }\r\n    Transform.hasTag = hasTag;\r\n    function hasTags(t, tags) {\r\n        if (!t.tags)\r\n            return typeof tags !== 'string' && tags.length === 0;\r\n        if (typeof tags === 'string')\r\n            return hasTag(t, tags);\r\n        for (var _i = 0, tags_1 = tags; _i < tags_1.length; _i++) {\r\n            var tag = tags_1[_i];\r\n            if (t.tags.indexOf(tag) < 0)\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    Transform.hasTags = hasTags;\r\n    function _id(x) { return x; }\r\n    function toJSON(t) {\r\n        var pToJson = t.transformer.definition.customSerialization\r\n            ? t.transformer.definition.customSerialization.toJSON\r\n            : _id;\r\n        var state = void 0;\r\n        for (var _i = 0, _a = Object.keys(t.state); _i < _a.length; _i++) {\r\n            var k = _a[_i];\r\n            var s = t.state[k];\r\n            if (!s)\r\n                continue;\r\n            if (!state)\r\n                state = {};\r\n            state[k] = true;\r\n        }\r\n        return {\r\n            parent: t.parent,\r\n            transformer: t.transformer.id,\r\n            params: t.params ? pToJson(t.params) : void 0,\r\n            state: state,\r\n            tags: t.tags,\r\n            ref: t.ref,\r\n            dependsOn: t.dependsOn,\r\n            version: t.version\r\n        };\r\n    }\r\n    Transform.toJSON = toJSON;\r\n    function fromJSON(t) {\r\n        var transformer = StateTransformer.get(t.transformer);\r\n        var pFromJson = transformer.definition.customSerialization\r\n            ? transformer.definition.customSerialization.fromJSON\r\n            : _id;\r\n        return {\r\n            parent: t.parent,\r\n            transformer: transformer,\r\n            params: t.params ? pFromJson(t.params) : void 0,\r\n            state: t.state || {},\r\n            tags: t.tags,\r\n            ref: t.ref,\r\n            dependsOn: t.dependsOn,\r\n            version: t.version\r\n        };\r\n    }\r\n    Transform.fromJSON = fromJSON;\r\n})(Transform || (Transform = {}));\r\n//# sourceMappingURL=transform.js.map"]},"metadata":{},"sourceType":"module"}