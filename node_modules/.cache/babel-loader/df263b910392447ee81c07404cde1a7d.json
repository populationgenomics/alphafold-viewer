{"ast":null,"code":"import { __assign, __spreadArray } from \"tslib\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\n/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\n\nimport * as React from 'react';\nimport { useEffect, useLayoutEffect, useRef, useState } from 'react';\nimport { shallowEqual } from '../../mol-util/object';\nimport { useBehavior } from '../hooks/use-behavior';\n\nvar _ScreenshotPreview = function (props) {\n  var plugin = props.plugin,\n      cropFrameColor = props.cropFrameColor;\n  var helper = plugin.helpers.viewportScreenshot;\n\n  var _a = useState(null),\n      currentCanvas = _a[0],\n      setCurrentCanvas = _a[1];\n\n  var canvasRef = useRef(null);\n  var propsRef = useRef(props);\n  useEffect(function () {\n    propsRef.current = props;\n  }, Object.values(props));\n  useEffect(function () {\n    if (currentCanvas !== canvasRef.current) {\n      setCurrentCanvas(canvasRef.current);\n    }\n  });\n  useEffect(function () {\n    var _a;\n\n    var isDirty = false;\n    var subs = [];\n\n    function subscribe(xs, f) {\n      if (!xs) return;\n      subs.push(xs.subscribe(f));\n    }\n\n    function preview() {\n      var p = propsRef.current;\n\n      if (!p.suspend && canvasRef.current) {\n        drawPreview(helper, canvasRef.current, p.customBackground, p.borderColor, p.borderWidth);\n      }\n\n      if (!canvasRef.current) isDirty = true;\n    }\n\n    var interval = setInterval(function () {\n      if (isDirty) {\n        isDirty = false;\n        preview();\n      }\n    }, 1000 / 8);\n    subscribe(plugin.events.canvas3d.settingsUpdated, function () {\n      return isDirty = true;\n    });\n    subscribe((_a = plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.didDraw, function () {\n      return isDirty = true;\n    });\n    subscribe(plugin.state.data.behaviors.isUpdating, function (v) {\n      if (!v) isDirty = true;\n    });\n    subscribe(helper.behaviors.values, function () {\n      return isDirty = true;\n    });\n    subscribe(helper.behaviors.cropParams, function () {\n      return isDirty = true;\n    });\n    var resizeObserver = void 0;\n\n    if (typeof ResizeObserver !== 'undefined') {\n      resizeObserver = new ResizeObserver(function () {\n        return isDirty = true;\n      });\n    }\n\n    var canvas = canvasRef.current;\n    resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.observe(canvas);\n    preview();\n    return function () {\n      clearInterval(interval);\n      subs.forEach(function (s) {\n        return s.unsubscribe();\n      });\n      resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.unobserve(canvas);\n    };\n  }, [helper]);\n  useLayoutEffect(function () {\n    if (canvasRef.current) {\n      drawPreview(helper, canvasRef.current, props.customBackground, props.borderColor, props.borderWidth);\n    }\n  }, __spreadArray([], Object.values(props), true));\n  return _jsx(_Fragment, {\n    children: _jsxs(\"div\", __assign({\n      style: {\n        position: 'relative',\n        width: '100%',\n        height: '100%'\n      }\n    }, {\n      children: [_jsx(\"canvas\", {\n        ref: canvasRef,\n        onContextMenu: function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n        },\n        style: {\n          display: 'block',\n          width: '100%',\n          height: '100%'\n        }\n      }, void 0), _jsx(ViewportFrame, {\n        plugin: plugin,\n        canvas: currentCanvas,\n        color: cropFrameColor\n      }, void 0)]\n    }), void 0)\n  }, void 0);\n};\n\nexport var ScreenshotPreview = React.memo(_ScreenshotPreview, function (prev, next) {\n  return shallowEqual(prev, next);\n});\n\nfunction drawPreview(helper, target, customBackground, borderColor, borderWidth) {\n  var _a = helper.getPreview(),\n      canvas = _a.canvas,\n      width = _a.width,\n      height = _a.height;\n\n  var ctx = target.getContext('2d');\n  if (!ctx) return;\n  var w = target.clientWidth;\n  var h = target.clientHeight;\n  target.width = w;\n  target.height = h;\n  ctx.clearRect(0, 0, w, h);\n  var frame = getViewportFrame(width, height, w, h);\n\n  if (customBackground) {\n    ctx.fillStyle = customBackground;\n    ctx.fillRect(frame.x, frame.y, frame.width, frame.height);\n  } else if (helper.values.transparent) {\n    // must be an odd number\n    var s = 13;\n\n    for (var i = 0; i < frame.width; i += s) {\n      for (var j = 0; j < frame.height; j += s) {\n        ctx.fillStyle = (i + j) % 2 ? '#ffffff' : '#bfbfbf';\n        var x = frame.x + i,\n            y = frame.y + j;\n        var w_1 = i + s > frame.width ? frame.width - i : s;\n        var h_1 = j + s > frame.height ? frame.height - j : s;\n        ctx.fillRect(x, y, w_1, h_1);\n      }\n    }\n  }\n\n  ctx.drawImage(canvas, frame.x, frame.y, frame.width, frame.height);\n\n  if (borderColor && borderWidth) {\n    var w_2 = borderWidth;\n    ctx.rect(frame.x, frame.y, frame.width, frame.height);\n    ctx.rect(frame.x + w_2, frame.y + w_2, frame.width - 2 * w_2, frame.height - 2 * w_2);\n    ctx.fillStyle = borderColor;\n    ctx.fill('evenodd');\n  }\n}\n\nfunction ViewportFrame(_a) {\n  var _b;\n\n  var plugin = _a.plugin,\n      canvas = _a.canvas,\n      _c = _a.color,\n      color = _c === void 0 ? 'rgba(255, 87, 45, 0.75)' : _c;\n  var helper = plugin.helpers.viewportScreenshot;\n  var params = useBehavior(helper === null || helper === void 0 ? void 0 : helper.behaviors.values);\n  var cropParams = useBehavior(helper === null || helper === void 0 ? void 0 : helper.behaviors.cropParams);\n  var crop = useBehavior(helper === null || helper === void 0 ? void 0 : helper.behaviors.relativeCrop);\n  var cropFrameRef = useRef({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0\n  });\n  useBehavior((params === null || params === void 0 ? void 0 : params.resolution.name) === 'viewport' ? (_b = plugin.canvas3d) === null || _b === void 0 ? void 0 : _b.resized : void 0);\n\n  var _d = React.useState(''),\n      drag = _d[0],\n      setDrag = _d[1];\n\n  var _e = useState([0, 0]),\n      start = _e[0],\n      setStart = _e[1];\n\n  var _f = useState([0, 0]),\n      current = _f[0],\n      setCurrent = _f[1];\n\n  if (!helper || !canvas) return null;\n\n  var _g = helper.getSizeAndViewport(),\n      width = _g.width,\n      height = _g.height;\n\n  var frame = getViewportFrame(width, height, canvas.clientWidth, canvas.clientHeight);\n  var cropFrame = {\n    x: frame.x + Math.floor(frame.width * crop.x),\n    y: frame.y + Math.floor(frame.height * crop.y),\n    width: Math.ceil(frame.width * crop.width),\n    height: Math.ceil(frame.height * crop.height)\n  };\n  var rectCrop = toRect(cropFrame);\n  var rectFrame = toRect(frame);\n\n  if (drag === 'move') {\n    rectCrop.l += current[0] - start[0];\n    rectCrop.r += current[0] - start[0];\n    rectCrop.t += current[1] - start[1];\n    rectCrop.b += current[1] - start[1];\n  } else if (drag) {\n    if (drag.indexOf('left') >= 0) {\n      rectCrop.l += current[0] - start[0];\n    } else if (drag.indexOf('right') >= 0) {\n      rectCrop.r += current[0] - start[0];\n    }\n\n    if (drag.indexOf('top') >= 0) {\n      rectCrop.t += current[1] - start[1];\n    } else if (drag.indexOf('bottom') >= 0) {\n      rectCrop.b += current[1] - start[1];\n    }\n  }\n\n  if (rectCrop.l > rectCrop.r) {\n    var t = rectCrop.l;\n    rectCrop.l = rectCrop.r;\n    rectCrop.r = t;\n  }\n\n  if (rectCrop.t > rectCrop.b) {\n    var t = rectCrop.t;\n    rectCrop.t = rectCrop.b;\n    rectCrop.b = t;\n  }\n\n  var pad = 40;\n  rectCrop.l = Math.min(rectFrame.r - pad, Math.max(rectFrame.l, rectCrop.l));\n  rectCrop.r = Math.max(rectFrame.l + pad, Math.min(rectFrame.r, rectCrop.r));\n  rectCrop.t = Math.min(rectFrame.b - pad, Math.max(rectFrame.t, rectCrop.t));\n  rectCrop.b = Math.max(rectFrame.t + pad, Math.min(rectFrame.b, rectCrop.b));\n  cropFrame.x = rectCrop.l;\n  cropFrame.y = rectCrop.t;\n  cropFrame.width = rectCrop.r - rectCrop.l + 1;\n  cropFrame.height = rectCrop.b - rectCrop.t + 1;\n  cropFrameRef.current = cropFrame;\n\n  var onMove = function (e) {\n    e.preventDefault();\n    setCurrent([e.pageX, e.pageY]);\n  };\n\n  var onTouchMove = function (e) {\n    e.preventDefault();\n    var t = e.touches[0];\n    setCurrent([t.pageX, t.pageY]);\n  };\n\n  var onTouchStart = function (e) {\n    e.preventDefault();\n    setDrag(e.currentTarget.getAttribute('data-drag'));\n    var t = e.touches[0];\n    var p = [t.pageX, t.pageY];\n    setStart(p);\n    setCurrent(p);\n    window.addEventListener('touchend', onTouchEnd);\n    window.addEventListener('touchmove', onTouchMove);\n  };\n\n  var onStart = function (e) {\n    e.preventDefault();\n    setDrag(e.currentTarget.getAttribute('data-drag'));\n    var p = [e.pageX, e.pageY];\n    setStart(p);\n    setCurrent(p);\n    window.addEventListener('mouseup', onEnd);\n    window.addEventListener('mousemove', onMove);\n  };\n\n  var onEnd = function () {\n    window.removeEventListener('mouseup', onEnd);\n    window.removeEventListener('mousemove', onMove);\n    finish();\n  };\n\n  var onTouchEnd = function () {\n    window.removeEventListener('touchend', onTouchEnd);\n    window.removeEventListener('touchmove', onTouchMove);\n    finish();\n  };\n\n  function finish() {\n    var cropFrame = cropFrameRef.current;\n\n    if (cropParams.auto) {\n      helper === null || helper === void 0 ? void 0 : helper.behaviors.cropParams.next(__assign(__assign({}, cropParams), {\n        auto: false\n      }));\n    }\n\n    helper === null || helper === void 0 ? void 0 : helper.behaviors.relativeCrop.next({\n      x: (cropFrame.x - frame.x) / frame.width,\n      y: (cropFrame.y - frame.y) / frame.height,\n      width: cropFrame.width / frame.width,\n      height: cropFrame.height / frame.height\n    });\n    setDrag('');\n    var p = [0, 0];\n    setStart(p);\n    setCurrent(p);\n  }\n\n  var contextMenu = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  var d = 4;\n  var border = \"3px solid \" + color;\n  var transparent = 'transparent';\n  return _jsxs(_Fragment, {\n    children: [_jsx(\"div\", {\n      \"data-drag\": 'move',\n      style: {\n        position: 'absolute',\n        left: cropFrame.x,\n        top: cropFrame.y,\n        width: cropFrame.width,\n        height: cropFrame.height,\n        border: border,\n        cursor: 'move'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0), _jsx(\"div\", {\n      \"data-drag\": 'left',\n      style: {\n        position: 'absolute',\n        left: cropFrame.x - d,\n        top: cropFrame.y + d,\n        width: 4 * d,\n        height: cropFrame.height - d,\n        background: transparent,\n        cursor: 'w-resize'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0), _jsx(\"div\", {\n      \"data-drag\": 'right',\n      style: {\n        position: 'absolute',\n        left: rectCrop.r - 2 * d,\n        top: cropFrame.y,\n        width: 4 * d,\n        height: cropFrame.height - d,\n        background: transparent,\n        cursor: 'w-resize'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0), _jsx(\"div\", {\n      \"data-drag\": 'top',\n      style: {\n        position: 'absolute',\n        left: cropFrame.x - d,\n        top: cropFrame.y - d,\n        width: cropFrame.width + 2 * d,\n        height: 4 * d,\n        background: transparent,\n        cursor: 'n-resize'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0), _jsx(\"div\", {\n      \"data-drag\": 'bottom',\n      style: {\n        position: 'absolute',\n        left: cropFrame.x - d,\n        top: rectCrop.b - 2 * d,\n        width: cropFrame.width + 2 * d,\n        height: 4 * d,\n        background: transparent,\n        cursor: 'n-resize'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0), _jsx(\"div\", {\n      \"data-drag\": 'top, left',\n      style: {\n        position: 'absolute',\n        left: rectCrop.l - d,\n        top: rectCrop.t - d,\n        width: 4 * d,\n        height: 4 * d,\n        background: transparent,\n        cursor: 'nw-resize'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0), _jsx(\"div\", {\n      \"data-drag\": 'bottom, right',\n      style: {\n        position: 'absolute',\n        left: rectCrop.r - 2 * d,\n        top: rectCrop.b - 2 * d,\n        width: 4 * d,\n        height: 4 * d,\n        background: transparent,\n        cursor: 'nw-resize'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0), _jsx(\"div\", {\n      \"data-drag\": 'top, right',\n      style: {\n        position: 'absolute',\n        left: rectCrop.r - 2 * d,\n        top: rectCrop.t - d,\n        width: 4 * d,\n        height: 4 * d,\n        background: transparent,\n        cursor: 'ne-resize'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0), _jsx(\"div\", {\n      \"data-drag\": 'bottom, left',\n      style: {\n        position: 'absolute',\n        left: rectCrop.l - d,\n        top: rectCrop.b - 2 * d,\n        width: 4 * d,\n        height: 4 * d,\n        background: transparent,\n        cursor: 'ne-resize'\n      },\n      onMouseDown: onStart,\n      onTouchStart: onTouchStart,\n      draggable: false,\n      onContextMenu: contextMenu\n    }, void 0)]\n  }, void 0);\n}\n\nfunction toRect(viewport) {\n  return {\n    l: viewport.x,\n    t: viewport.y,\n    r: viewport.x + viewport.width - 1,\n    b: viewport.y + viewport.height - 1\n  };\n}\n\nfunction getViewportFrame(srcWidth, srcHeight, w, h) {\n  var a0 = srcWidth / srcHeight;\n  var a1 = w / h;\n\n  if (a0 <= a1) {\n    var t = h * a0;\n    return {\n      x: Math.round((w - t) / 2),\n      y: 0,\n      width: Math.round(t),\n      height: h\n    };\n  } else {\n    var t = w / a0;\n    return {\n      x: 0,\n      y: Math.round((h - t) / 2),\n      width: w,\n      height: Math.round(t)\n    };\n  }\n}","map":{"version":3,"sources":["../../../src/mol-plugin-ui/controls/screenshot.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __spreadArray } from \"tslib\";\r\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\r\n/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport * as React from 'react';\r\nimport { useEffect, useLayoutEffect, useRef, useState } from 'react';\r\nimport { shallowEqual } from '../../mol-util/object';\r\nimport { useBehavior } from '../hooks/use-behavior';\r\nvar _ScreenshotPreview = function (props) {\r\n    var plugin = props.plugin, cropFrameColor = props.cropFrameColor;\r\n    var helper = plugin.helpers.viewportScreenshot;\r\n    var _a = useState(null), currentCanvas = _a[0], setCurrentCanvas = _a[1];\r\n    var canvasRef = useRef(null);\r\n    var propsRef = useRef(props);\r\n    useEffect(function () {\r\n        propsRef.current = props;\r\n    }, Object.values(props));\r\n    useEffect(function () {\r\n        if (currentCanvas !== canvasRef.current) {\r\n            setCurrentCanvas(canvasRef.current);\r\n        }\r\n    });\r\n    useEffect(function () {\r\n        var _a;\r\n        var isDirty = false;\r\n        var subs = [];\r\n        function subscribe(xs, f) {\r\n            if (!xs)\r\n                return;\r\n            subs.push(xs.subscribe(f));\r\n        }\r\n        function preview() {\r\n            var p = propsRef.current;\r\n            if (!p.suspend && canvasRef.current) {\r\n                drawPreview(helper, canvasRef.current, p.customBackground, p.borderColor, p.borderWidth);\r\n            }\r\n            if (!canvasRef.current)\r\n                isDirty = true;\r\n        }\r\n        var interval = setInterval(function () {\r\n            if (isDirty) {\r\n                isDirty = false;\r\n                preview();\r\n            }\r\n        }, 1000 / 8);\r\n        subscribe(plugin.events.canvas3d.settingsUpdated, function () { return isDirty = true; });\r\n        subscribe((_a = plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.didDraw, function () { return isDirty = true; });\r\n        subscribe(plugin.state.data.behaviors.isUpdating, function (v) {\r\n            if (!v)\r\n                isDirty = true;\r\n        });\r\n        subscribe(helper.behaviors.values, function () { return isDirty = true; });\r\n        subscribe(helper.behaviors.cropParams, function () { return isDirty = true; });\r\n        var resizeObserver = void 0;\r\n        if (typeof ResizeObserver !== 'undefined') {\r\n            resizeObserver = new ResizeObserver(function () { return isDirty = true; });\r\n        }\r\n        var canvas = canvasRef.current;\r\n        resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.observe(canvas);\r\n        preview();\r\n        return function () {\r\n            clearInterval(interval);\r\n            subs.forEach(function (s) { return s.unsubscribe(); });\r\n            resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.unobserve(canvas);\r\n        };\r\n    }, [helper]);\r\n    useLayoutEffect(function () {\r\n        if (canvasRef.current) {\r\n            drawPreview(helper, canvasRef.current, props.customBackground, props.borderColor, props.borderWidth);\r\n        }\r\n    }, __spreadArray([], Object.values(props), true));\r\n    return _jsx(_Fragment, { children: _jsxs(\"div\", __assign({ style: { position: 'relative', width: '100%', height: '100%' } }, { children: [_jsx(\"canvas\", { ref: canvasRef, onContextMenu: function (e) { e.preventDefault(); e.stopPropagation(); }, style: { display: 'block', width: '100%', height: '100%' } }, void 0), _jsx(ViewportFrame, { plugin: plugin, canvas: currentCanvas, color: cropFrameColor }, void 0)] }), void 0) }, void 0);\r\n};\r\nexport var ScreenshotPreview = React.memo(_ScreenshotPreview, function (prev, next) { return shallowEqual(prev, next); });\r\nfunction drawPreview(helper, target, customBackground, borderColor, borderWidth) {\r\n    var _a = helper.getPreview(), canvas = _a.canvas, width = _a.width, height = _a.height;\r\n    var ctx = target.getContext('2d');\r\n    if (!ctx)\r\n        return;\r\n    var w = target.clientWidth;\r\n    var h = target.clientHeight;\r\n    target.width = w;\r\n    target.height = h;\r\n    ctx.clearRect(0, 0, w, h);\r\n    var frame = getViewportFrame(width, height, w, h);\r\n    if (customBackground) {\r\n        ctx.fillStyle = customBackground;\r\n        ctx.fillRect(frame.x, frame.y, frame.width, frame.height);\r\n    }\r\n    else if (helper.values.transparent) {\r\n        // must be an odd number\r\n        var s = 13;\r\n        for (var i = 0; i < frame.width; i += s) {\r\n            for (var j = 0; j < frame.height; j += s) {\r\n                ctx.fillStyle = (i + j) % 2 ? '#ffffff' : '#bfbfbf';\r\n                var x = frame.x + i, y = frame.y + j;\r\n                var w_1 = i + s > frame.width ? frame.width - i : s;\r\n                var h_1 = j + s > frame.height ? frame.height - j : s;\r\n                ctx.fillRect(x, y, w_1, h_1);\r\n            }\r\n        }\r\n    }\r\n    ctx.drawImage(canvas, frame.x, frame.y, frame.width, frame.height);\r\n    if (borderColor && borderWidth) {\r\n        var w_2 = borderWidth;\r\n        ctx.rect(frame.x, frame.y, frame.width, frame.height);\r\n        ctx.rect(frame.x + w_2, frame.y + w_2, frame.width - 2 * w_2, frame.height - 2 * w_2);\r\n        ctx.fillStyle = borderColor;\r\n        ctx.fill('evenodd');\r\n    }\r\n}\r\nfunction ViewportFrame(_a) {\r\n    var _b;\r\n    var plugin = _a.plugin, canvas = _a.canvas, _c = _a.color, color = _c === void 0 ? 'rgba(255, 87, 45, 0.75)' : _c;\r\n    var helper = plugin.helpers.viewportScreenshot;\r\n    var params = useBehavior(helper === null || helper === void 0 ? void 0 : helper.behaviors.values);\r\n    var cropParams = useBehavior(helper === null || helper === void 0 ? void 0 : helper.behaviors.cropParams);\r\n    var crop = useBehavior(helper === null || helper === void 0 ? void 0 : helper.behaviors.relativeCrop);\r\n    var cropFrameRef = useRef({ x: 0, y: 0, width: 0, height: 0 });\r\n    useBehavior((params === null || params === void 0 ? void 0 : params.resolution.name) === 'viewport' ? (_b = plugin.canvas3d) === null || _b === void 0 ? void 0 : _b.resized : void 0);\r\n    var _d = React.useState(''), drag = _d[0], setDrag = _d[1];\r\n    var _e = useState([0, 0]), start = _e[0], setStart = _e[1];\r\n    var _f = useState([0, 0]), current = _f[0], setCurrent = _f[1];\r\n    if (!helper || !canvas)\r\n        return null;\r\n    var _g = helper.getSizeAndViewport(), width = _g.width, height = _g.height;\r\n    var frame = getViewportFrame(width, height, canvas.clientWidth, canvas.clientHeight);\r\n    var cropFrame = {\r\n        x: frame.x + Math.floor(frame.width * crop.x),\r\n        y: frame.y + Math.floor(frame.height * crop.y),\r\n        width: Math.ceil(frame.width * crop.width),\r\n        height: Math.ceil(frame.height * crop.height)\r\n    };\r\n    var rectCrop = toRect(cropFrame);\r\n    var rectFrame = toRect(frame);\r\n    if (drag === 'move') {\r\n        rectCrop.l += current[0] - start[0];\r\n        rectCrop.r += current[0] - start[0];\r\n        rectCrop.t += current[1] - start[1];\r\n        rectCrop.b += current[1] - start[1];\r\n    }\r\n    else if (drag) {\r\n        if (drag.indexOf('left') >= 0) {\r\n            rectCrop.l += current[0] - start[0];\r\n        }\r\n        else if (drag.indexOf('right') >= 0) {\r\n            rectCrop.r += current[0] - start[0];\r\n        }\r\n        if (drag.indexOf('top') >= 0) {\r\n            rectCrop.t += current[1] - start[1];\r\n        }\r\n        else if (drag.indexOf('bottom') >= 0) {\r\n            rectCrop.b += current[1] - start[1];\r\n        }\r\n    }\r\n    if (rectCrop.l > rectCrop.r) {\r\n        var t = rectCrop.l;\r\n        rectCrop.l = rectCrop.r;\r\n        rectCrop.r = t;\r\n    }\r\n    if (rectCrop.t > rectCrop.b) {\r\n        var t = rectCrop.t;\r\n        rectCrop.t = rectCrop.b;\r\n        rectCrop.b = t;\r\n    }\r\n    var pad = 40;\r\n    rectCrop.l = Math.min(rectFrame.r - pad, Math.max(rectFrame.l, rectCrop.l));\r\n    rectCrop.r = Math.max(rectFrame.l + pad, Math.min(rectFrame.r, rectCrop.r));\r\n    rectCrop.t = Math.min(rectFrame.b - pad, Math.max(rectFrame.t, rectCrop.t));\r\n    rectCrop.b = Math.max(rectFrame.t + pad, Math.min(rectFrame.b, rectCrop.b));\r\n    cropFrame.x = rectCrop.l;\r\n    cropFrame.y = rectCrop.t;\r\n    cropFrame.width = rectCrop.r - rectCrop.l + 1;\r\n    cropFrame.height = rectCrop.b - rectCrop.t + 1;\r\n    cropFrameRef.current = cropFrame;\r\n    var onMove = function (e) {\r\n        e.preventDefault();\r\n        setCurrent([e.pageX, e.pageY]);\r\n    };\r\n    var onTouchMove = function (e) {\r\n        e.preventDefault();\r\n        var t = e.touches[0];\r\n        setCurrent([t.pageX, t.pageY]);\r\n    };\r\n    var onTouchStart = function (e) {\r\n        e.preventDefault();\r\n        setDrag(e.currentTarget.getAttribute('data-drag'));\r\n        var t = e.touches[0];\r\n        var p = [t.pageX, t.pageY];\r\n        setStart(p);\r\n        setCurrent(p);\r\n        window.addEventListener('touchend', onTouchEnd);\r\n        window.addEventListener('touchmove', onTouchMove);\r\n    };\r\n    var onStart = function (e) {\r\n        e.preventDefault();\r\n        setDrag(e.currentTarget.getAttribute('data-drag'));\r\n        var p = [e.pageX, e.pageY];\r\n        setStart(p);\r\n        setCurrent(p);\r\n        window.addEventListener('mouseup', onEnd);\r\n        window.addEventListener('mousemove', onMove);\r\n    };\r\n    var onEnd = function () {\r\n        window.removeEventListener('mouseup', onEnd);\r\n        window.removeEventListener('mousemove', onMove);\r\n        finish();\r\n    };\r\n    var onTouchEnd = function () {\r\n        window.removeEventListener('touchend', onTouchEnd);\r\n        window.removeEventListener('touchmove', onTouchMove);\r\n        finish();\r\n    };\r\n    function finish() {\r\n        var cropFrame = cropFrameRef.current;\r\n        if (cropParams.auto) {\r\n            helper === null || helper === void 0 ? void 0 : helper.behaviors.cropParams.next(__assign(__assign({}, cropParams), { auto: false }));\r\n        }\r\n        helper === null || helper === void 0 ? void 0 : helper.behaviors.relativeCrop.next({\r\n            x: (cropFrame.x - frame.x) / frame.width,\r\n            y: (cropFrame.y - frame.y) / frame.height,\r\n            width: cropFrame.width / frame.width,\r\n            height: cropFrame.height / frame.height\r\n        });\r\n        setDrag('');\r\n        var p = [0, 0];\r\n        setStart(p);\r\n        setCurrent(p);\r\n    }\r\n    var contextMenu = function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    };\r\n    var d = 4;\r\n    var border = \"3px solid \" + color;\r\n    var transparent = 'transparent';\r\n    return _jsxs(_Fragment, { children: [_jsx(\"div\", { \"data-drag\": 'move', style: { position: 'absolute', left: cropFrame.x, top: cropFrame.y, width: cropFrame.width, height: cropFrame.height, border: border, cursor: 'move' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0), _jsx(\"div\", { \"data-drag\": 'left', style: { position: 'absolute', left: cropFrame.x - d, top: cropFrame.y + d, width: 4 * d, height: cropFrame.height - d, background: transparent, cursor: 'w-resize' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0), _jsx(\"div\", { \"data-drag\": 'right', style: { position: 'absolute', left: rectCrop.r - 2 * d, top: cropFrame.y, width: 4 * d, height: cropFrame.height - d, background: transparent, cursor: 'w-resize' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0), _jsx(\"div\", { \"data-drag\": 'top', style: { position: 'absolute', left: cropFrame.x - d, top: cropFrame.y - d, width: cropFrame.width + 2 * d, height: 4 * d, background: transparent, cursor: 'n-resize' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0), _jsx(\"div\", { \"data-drag\": 'bottom', style: { position: 'absolute', left: cropFrame.x - d, top: rectCrop.b - 2 * d, width: cropFrame.width + 2 * d, height: 4 * d, background: transparent, cursor: 'n-resize' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0), _jsx(\"div\", { \"data-drag\": 'top, left', style: { position: 'absolute', left: rectCrop.l - d, top: rectCrop.t - d, width: 4 * d, height: 4 * d, background: transparent, cursor: 'nw-resize' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0), _jsx(\"div\", { \"data-drag\": 'bottom, right', style: { position: 'absolute', left: rectCrop.r - 2 * d, top: rectCrop.b - 2 * d, width: 4 * d, height: 4 * d, background: transparent, cursor: 'nw-resize' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0), _jsx(\"div\", { \"data-drag\": 'top, right', style: { position: 'absolute', left: rectCrop.r - 2 * d, top: rectCrop.t - d, width: 4 * d, height: 4 * d, background: transparent, cursor: 'ne-resize' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0), _jsx(\"div\", { \"data-drag\": 'bottom, left', style: { position: 'absolute', left: rectCrop.l - d, top: rectCrop.b - 2 * d, width: 4 * d, height: 4 * d, background: transparent, cursor: 'ne-resize' }, onMouseDown: onStart, onTouchStart: onTouchStart, draggable: false, onContextMenu: contextMenu }, void 0)] }, void 0);\r\n}\r\nfunction toRect(viewport) {\r\n    return { l: viewport.x, t: viewport.y, r: viewport.x + viewport.width - 1, b: viewport.y + viewport.height - 1 };\r\n}\r\nfunction getViewportFrame(srcWidth, srcHeight, w, h) {\r\n    var a0 = srcWidth / srcHeight;\r\n    var a1 = w / h;\r\n    if (a0 <= a1) {\r\n        var t = h * a0;\r\n        return { x: Math.round((w - t) / 2), y: 0, width: Math.round(t), height: h };\r\n    }\r\n    else {\r\n        var t = w / a0;\r\n        return { x: 0, y: Math.round((h - t) / 2), width: w, height: Math.round(t) };\r\n    }\r\n}\r\n//# sourceMappingURL=screenshot.js.map"]},"metadata":{},"sourceType":"module"}