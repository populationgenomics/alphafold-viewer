{"ast":null,"code":"/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __spreadArray } from \"tslib\";\nimport { Vec3 } from '../linear-algebra/3d/vec3';\nimport { CentroidHelper } from './centroid-helper';\nimport { Sphere3D } from '../geometry';\nimport { Box3D } from './primitives/box3d'; // implementing http://www.ep.liu.se/ecp/034/009/ecp083409.pdf\n\nvar BoundaryHelper =\n/** @class */\nfunction () {\n  function BoundaryHelper(quality) {\n    this.minDist = [];\n    this.maxDist = [];\n    this.extrema = [];\n    this.centroidHelper = new CentroidHelper();\n    this.dir = getEposDir(quality);\n    this.reset();\n  }\n\n  BoundaryHelper.prototype.computeExtrema = function (i, p) {\n    var d = Vec3.dot(this.dir[i], p);\n\n    if (d < this.minDist[i]) {\n      this.minDist[i] = d;\n      Vec3.copy(this.extrema[i * 2], p);\n    }\n\n    if (d > this.maxDist[i]) {\n      this.maxDist[i] = d;\n      Vec3.copy(this.extrema[i * 2 + 1], p);\n    }\n  };\n\n  BoundaryHelper.prototype.computeSphereExtrema = function (i, center, radius) {\n    var d = Vec3.dot(this.dir[i], center);\n\n    if (d - radius < this.minDist[i]) {\n      this.minDist[i] = d - radius;\n      Vec3.scaleAndSub(this.extrema[i * 2], center, this.dir[i], radius);\n    }\n\n    if (d + radius > this.maxDist[i]) {\n      this.maxDist[i] = d + radius;\n      Vec3.scaleAndAdd(this.extrema[i * 2 + 1], center, this.dir[i], radius);\n    }\n  };\n\n  BoundaryHelper.prototype.includeSphere = function (s) {\n    if (Sphere3D.hasExtrema(s) && s.extrema.length > 1) {\n      for (var _i = 0, _a = s.extrema; _i < _a.length; _i++) {\n        var e = _a[_i];\n        this.includePosition(e);\n      }\n    } else {\n      this.includePositionRadius(s.center, s.radius);\n    }\n  };\n\n  BoundaryHelper.prototype.includePosition = function (p) {\n    for (var i = 0, il = this.dir.length; i < il; ++i) {\n      this.computeExtrema(i, p);\n    }\n  };\n\n  BoundaryHelper.prototype.includePositionRadius = function (center, radius) {\n    for (var i = 0, il = this.dir.length; i < il; ++i) {\n      this.computeSphereExtrema(i, center, radius);\n    }\n  };\n\n  BoundaryHelper.prototype.finishedIncludeStep = function () {\n    for (var i = 0; i < this.extrema.length; i++) {\n      this.centroidHelper.includeStep(this.extrema[i]);\n    }\n\n    this.centroidHelper.finishedIncludeStep();\n  };\n\n  BoundaryHelper.prototype.radiusSphere = function (s) {\n    if (Sphere3D.hasExtrema(s) && s.extrema.length > 1) {\n      for (var _i = 0, _a = s.extrema; _i < _a.length; _i++) {\n        var e = _a[_i];\n        this.radiusPosition(e);\n      }\n    } else {\n      this.radiusPositionRadius(s.center, s.radius);\n    }\n  };\n\n  BoundaryHelper.prototype.radiusPosition = function (p) {\n    this.centroidHelper.radiusStep(p);\n  };\n\n  BoundaryHelper.prototype.radiusPositionRadius = function (center, radius) {\n    this.centroidHelper.radiusSphereStep(center, radius);\n  };\n\n  BoundaryHelper.prototype.getSphere = function (sphere) {\n    return Sphere3D.setExtrema(this.centroidHelper.getSphere(sphere), __spreadArray([], this.extrema, true));\n  };\n\n  BoundaryHelper.prototype.getBox = function (box) {\n    return Box3D.fromVec3Array(box || Box3D(), this.extrema);\n  };\n\n  BoundaryHelper.prototype.reset = function () {\n    for (var i = 0, il = this.dir.length; i < il; ++i) {\n      this.minDist[i] = Infinity;\n      this.maxDist[i] = -Infinity;\n      this.extrema[i * 2] = Vec3();\n      this.extrema[i * 2 + 1] = Vec3();\n    }\n\n    this.centroidHelper.reset();\n  };\n\n  return BoundaryHelper;\n}();\n\nexport { BoundaryHelper };\n\nfunction getEposDir(quality) {\n  var dir;\n\n  switch (quality) {\n    case '6':\n      dir = __spreadArray([], Type001, true);\n      break;\n\n    case '14':\n      dir = __spreadArray(__spreadArray([], Type001, true), Type111, true);\n      break;\n\n    case '26':\n      dir = __spreadArray(__spreadArray(__spreadArray([], Type001, true), Type111, true), Type011, true);\n      break;\n\n    case '98':\n      dir = __spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([], Type001, true), Type111, true), Type011, true), Type012, true), Type112, true), Type122, true);\n      break;\n  }\n\n  return dir.map(function (a) {\n    var v = Vec3.create(a[0], a[1], a[2]);\n    return Vec3.normalize(v, v);\n  });\n}\n\nvar Type001 = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];\nvar Type111 = [[1, 1, 1], [-1, 1, 1], [-1, -1, 1], [1, -1, 1]];\nvar Type011 = [[1, 1, 0], [1, -1, 0], [1, 0, 1], [1, 0, -1], [0, 1, 1], [0, 1, -1]];\nvar Type012 = [[0, 1, 2], [0, 2, 1], [1, 0, 2], [2, 0, 1], [1, 2, 0], [2, 1, 0], [0, 1, -2], [0, 2, -1], [1, 0, -2], [2, 0, -1], [1, -2, 0], [2, -1, 0]];\nvar Type112 = [[1, 1, 2], [2, 1, 1], [1, 2, 1], [1, -1, 2], [1, 1, -2], [1, -1, -2], [2, -1, 1], [2, 1, -1], [2, -1, -1], [1, -2, 1], [1, 2, -1], [1, -2, -1]];\nvar Type122 = [[2, 2, 1], [1, 2, 2], [2, 1, 2], [2, -2, 1], [2, 2, -1], [2, -2, -1], [1, -2, 2], [1, 2, -2], [1, -2, -2], [2, -1, 2], [2, 1, -2], [2, -1, -2]];","map":{"version":3,"sources":["../../../src/mol-math/geometry/boundary-helper.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __spreadArray } from \"tslib\";\r\nimport { Vec3 } from '../linear-algebra/3d/vec3';\r\nimport { CentroidHelper } from './centroid-helper';\r\nimport { Sphere3D } from '../geometry';\r\nimport { Box3D } from './primitives/box3d';\r\n// implementing http://www.ep.liu.se/ecp/034/009/ecp083409.pdf\r\nvar BoundaryHelper = /** @class */ (function () {\r\n    function BoundaryHelper(quality) {\r\n        this.minDist = [];\r\n        this.maxDist = [];\r\n        this.extrema = [];\r\n        this.centroidHelper = new CentroidHelper();\r\n        this.dir = getEposDir(quality);\r\n        this.reset();\r\n    }\r\n    BoundaryHelper.prototype.computeExtrema = function (i, p) {\r\n        var d = Vec3.dot(this.dir[i], p);\r\n        if (d < this.minDist[i]) {\r\n            this.minDist[i] = d;\r\n            Vec3.copy(this.extrema[i * 2], p);\r\n        }\r\n        if (d > this.maxDist[i]) {\r\n            this.maxDist[i] = d;\r\n            Vec3.copy(this.extrema[i * 2 + 1], p);\r\n        }\r\n    };\r\n    BoundaryHelper.prototype.computeSphereExtrema = function (i, center, radius) {\r\n        var d = Vec3.dot(this.dir[i], center);\r\n        if (d - radius < this.minDist[i]) {\r\n            this.minDist[i] = d - radius;\r\n            Vec3.scaleAndSub(this.extrema[i * 2], center, this.dir[i], radius);\r\n        }\r\n        if (d + radius > this.maxDist[i]) {\r\n            this.maxDist[i] = d + radius;\r\n            Vec3.scaleAndAdd(this.extrema[i * 2 + 1], center, this.dir[i], radius);\r\n        }\r\n    };\r\n    BoundaryHelper.prototype.includeSphere = function (s) {\r\n        if (Sphere3D.hasExtrema(s) && s.extrema.length > 1) {\r\n            for (var _i = 0, _a = s.extrema; _i < _a.length; _i++) {\r\n                var e = _a[_i];\r\n                this.includePosition(e);\r\n            }\r\n        }\r\n        else {\r\n            this.includePositionRadius(s.center, s.radius);\r\n        }\r\n    };\r\n    BoundaryHelper.prototype.includePosition = function (p) {\r\n        for (var i = 0, il = this.dir.length; i < il; ++i) {\r\n            this.computeExtrema(i, p);\r\n        }\r\n    };\r\n    BoundaryHelper.prototype.includePositionRadius = function (center, radius) {\r\n        for (var i = 0, il = this.dir.length; i < il; ++i) {\r\n            this.computeSphereExtrema(i, center, radius);\r\n        }\r\n    };\r\n    BoundaryHelper.prototype.finishedIncludeStep = function () {\r\n        for (var i = 0; i < this.extrema.length; i++) {\r\n            this.centroidHelper.includeStep(this.extrema[i]);\r\n        }\r\n        this.centroidHelper.finishedIncludeStep();\r\n    };\r\n    BoundaryHelper.prototype.radiusSphere = function (s) {\r\n        if (Sphere3D.hasExtrema(s) && s.extrema.length > 1) {\r\n            for (var _i = 0, _a = s.extrema; _i < _a.length; _i++) {\r\n                var e = _a[_i];\r\n                this.radiusPosition(e);\r\n            }\r\n        }\r\n        else {\r\n            this.radiusPositionRadius(s.center, s.radius);\r\n        }\r\n    };\r\n    BoundaryHelper.prototype.radiusPosition = function (p) {\r\n        this.centroidHelper.radiusStep(p);\r\n    };\r\n    BoundaryHelper.prototype.radiusPositionRadius = function (center, radius) {\r\n        this.centroidHelper.radiusSphereStep(center, radius);\r\n    };\r\n    BoundaryHelper.prototype.getSphere = function (sphere) {\r\n        return Sphere3D.setExtrema(this.centroidHelper.getSphere(sphere), __spreadArray([], this.extrema, true));\r\n    };\r\n    BoundaryHelper.prototype.getBox = function (box) {\r\n        return Box3D.fromVec3Array(box || Box3D(), this.extrema);\r\n    };\r\n    BoundaryHelper.prototype.reset = function () {\r\n        for (var i = 0, il = this.dir.length; i < il; ++i) {\r\n            this.minDist[i] = Infinity;\r\n            this.maxDist[i] = -Infinity;\r\n            this.extrema[i * 2] = Vec3();\r\n            this.extrema[i * 2 + 1] = Vec3();\r\n        }\r\n        this.centroidHelper.reset();\r\n    };\r\n    return BoundaryHelper;\r\n}());\r\nexport { BoundaryHelper };\r\nfunction getEposDir(quality) {\r\n    var dir;\r\n    switch (quality) {\r\n        case '6':\r\n            dir = __spreadArray([], Type001, true);\r\n            break;\r\n        case '14':\r\n            dir = __spreadArray(__spreadArray([], Type001, true), Type111, true);\r\n            break;\r\n        case '26':\r\n            dir = __spreadArray(__spreadArray(__spreadArray([], Type001, true), Type111, true), Type011, true);\r\n            break;\r\n        case '98':\r\n            dir = __spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([], Type001, true), Type111, true), Type011, true), Type012, true), Type112, true), Type122, true);\r\n            break;\r\n    }\r\n    return dir.map(function (a) {\r\n        var v = Vec3.create(a[0], a[1], a[2]);\r\n        return Vec3.normalize(v, v);\r\n    });\r\n}\r\nvar Type001 = [\r\n    [1, 0, 0], [0, 1, 0], [0, 0, 1]\r\n];\r\nvar Type111 = [\r\n    [1, 1, 1], [-1, 1, 1], [-1, -1, 1], [1, -1, 1]\r\n];\r\nvar Type011 = [\r\n    [1, 1, 0], [1, -1, 0], [1, 0, 1], [1, 0, -1], [0, 1, 1], [0, 1, -1]\r\n];\r\nvar Type012 = [\r\n    [0, 1, 2], [0, 2, 1], [1, 0, 2], [2, 0, 1], [1, 2, 0], [2, 1, 0],\r\n    [0, 1, -2], [0, 2, -1], [1, 0, -2], [2, 0, -1], [1, -2, 0], [2, -1, 0]\r\n];\r\nvar Type112 = [\r\n    [1, 1, 2], [2, 1, 1], [1, 2, 1], [1, -1, 2], [1, 1, -2], [1, -1, -2],\r\n    [2, -1, 1], [2, 1, -1], [2, -1, -1], [1, -2, 1], [1, 2, -1], [1, -2, -1]\r\n];\r\nvar Type122 = [\r\n    [2, 2, 1], [1, 2, 2], [2, 1, 2], [2, -2, 1], [2, 2, -1], [2, -2, -1],\r\n    [1, -2, 2], [1, 2, -2], [1, -2, -2], [2, -1, 2], [2, 1, -2], [2, -1, -2]\r\n];\r\n//# sourceMappingURL=boundary-helper.js.map"]},"metadata":{},"sourceType":"module"}