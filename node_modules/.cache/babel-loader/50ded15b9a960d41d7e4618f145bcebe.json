{"ast":null,"code":"/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n *\r\n * ported from https://github.com/photopea/UZIP.js/blob/master/UZIP.js\r\n * MIT License, Copyright (c) 2018 Photopea\r\n */\nexport function _hufTree(hst, tree, MAXL) {\n  var list = [];\n  var hl = hst.length,\n      tl = tree.length;\n\n  for (var i = 0; i < tl; i += 2) {\n    tree[i] = 0;\n    tree[i + 1] = 0;\n  }\n\n  for (var i = 0; i < hl; i++) if (hst[i] !== 0) list.push({\n    lit: i,\n    f: hst[i],\n    d: undefined\n  });\n\n  var end = list.length,\n      l2 = list.slice(0);\n  if (end === 0) return 0; // empty histogram (usually for dist)\n\n  if (end === 1) {\n    var lit = list[0].lit,\n        l2_1 = lit === 0 ? 1 : 0;\n    tree[(lit << 1) + 1] = 1;\n    tree[(l2_1 << 1) + 1] = 1;\n    return 1;\n  }\n\n  list.sort(function (a, b) {\n    return a.f - b.f;\n  });\n  var a = list[0],\n      b = list[1],\n      i0 = 0,\n      i1 = 1,\n      i2 = 2;\n  list[0] = {\n    lit: -1,\n    f: a.f + b.f,\n    l: a,\n    r: b,\n    d: 0\n  };\n\n  while (i1 !== end - 1) {\n    if (i0 !== i1 && (i2 === end || list[i0].f < list[i2].f)) {\n      a = list[i0++];\n    } else {\n      a = list[i2++];\n    }\n\n    if (i0 !== i1 && (i2 === end || list[i0].f < list[i2].f)) {\n      b = list[i0++];\n    } else {\n      b = list[i2++];\n    }\n\n    list[i1++] = {\n      lit: -1,\n      f: a.f + b.f,\n      l: a,\n      r: b,\n      d: undefined\n    };\n  }\n\n  var maxl = setDepth(list[i1 - 1], 0);\n\n  if (maxl > MAXL) {\n    restrictDepth(l2, MAXL, maxl);\n    maxl = MAXL;\n  }\n\n  for (var i = 0; i < end; i++) tree[(l2[i].lit << 1) + 1] = l2[i].d;\n\n  return maxl;\n}\n\nfunction setDepth(t, d) {\n  if (t.lit !== -1) {\n    t.d = d;\n    return d;\n  }\n\n  return Math.max(setDepth(t.l, d + 1), setDepth(t.r, d + 1));\n}\n\nfunction restrictDepth(dps, MD, maxl) {\n  var i = 0,\n      dbt = 0;\n  var bCost = 1 << maxl - MD;\n  dps.sort(function (a, b) {\n    return b.d === a.d ? a.f - b.f : b.d - a.d;\n  });\n\n  for (i = 0; i < dps.length; i++) {\n    if (dps[i].d > MD) {\n      var od = dps[i].d;\n      dps[i].d = MD;\n      dbt += bCost - (1 << maxl - od);\n    } else {\n      break;\n    }\n  }\n\n  dbt = dbt >>> maxl - MD;\n\n  while (dbt > 0) {\n    var od = dps[i].d;\n\n    if (od < MD) {\n      dps[i].d++;\n      dbt -= 1 << MD - od - 1;\n    } else {\n      i++;\n    }\n  }\n\n  for (; i >= 0; i--) {\n    if (dps[i].d === MD && dbt < 0) {\n      dps[i].d--;\n      dbt++;\n    }\n  }\n\n  if (dbt !== 0) console.log('debt left');\n}","map":{"version":3,"sources":["../../../src/mol-util/zip/huffman.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n *\r\n * ported from https://github.com/photopea/UZIP.js/blob/master/UZIP.js\r\n * MIT License, Copyright (c) 2018 Photopea\r\n */\r\nexport function _hufTree(hst, tree, MAXL) {\r\n    var list = [];\r\n    var hl = hst.length, tl = tree.length;\r\n    for (var i = 0; i < tl; i += 2) {\r\n        tree[i] = 0;\r\n        tree[i + 1] = 0;\r\n    }\r\n    for (var i = 0; i < hl; i++)\r\n        if (hst[i] !== 0)\r\n            list.push({ lit: i, f: hst[i], d: undefined });\r\n    var end = list.length, l2 = list.slice(0);\r\n    if (end === 0)\r\n        return 0; // empty histogram (usually for dist)\r\n    if (end === 1) {\r\n        var lit = list[0].lit, l2_1 = lit === 0 ? 1 : 0;\r\n        tree[(lit << 1) + 1] = 1;\r\n        tree[(l2_1 << 1) + 1] = 1;\r\n        return 1;\r\n    }\r\n    list.sort(function (a, b) { return a.f - b.f; });\r\n    var a = list[0], b = list[1], i0 = 0, i1 = 1, i2 = 2;\r\n    list[0] = {\r\n        lit: -1,\r\n        f: a.f + b.f,\r\n        l: a,\r\n        r: b,\r\n        d: 0\r\n    };\r\n    while (i1 !== end - 1) {\r\n        if (i0 !== i1 && (i2 === end || list[i0].f < list[i2].f)) {\r\n            a = list[i0++];\r\n        }\r\n        else {\r\n            a = list[i2++];\r\n        }\r\n        if (i0 !== i1 && (i2 === end || list[i0].f < list[i2].f)) {\r\n            b = list[i0++];\r\n        }\r\n        else {\r\n            b = list[i2++];\r\n        }\r\n        list[i1++] = {\r\n            lit: -1,\r\n            f: a.f + b.f,\r\n            l: a,\r\n            r: b,\r\n            d: undefined\r\n        };\r\n    }\r\n    var maxl = setDepth(list[i1 - 1], 0);\r\n    if (maxl > MAXL) {\r\n        restrictDepth(l2, MAXL, maxl);\r\n        maxl = MAXL;\r\n    }\r\n    for (var i = 0; i < end; i++)\r\n        tree[(l2[i].lit << 1) + 1] = l2[i].d;\r\n    return maxl;\r\n}\r\nfunction setDepth(t, d) {\r\n    if (t.lit !== -1) {\r\n        t.d = d;\r\n        return d;\r\n    }\r\n    return Math.max(setDepth(t.l, d + 1), setDepth(t.r, d + 1));\r\n}\r\nfunction restrictDepth(dps, MD, maxl) {\r\n    var i = 0, dbt = 0;\r\n    var bCost = 1 << (maxl - MD);\r\n    dps.sort(function (a, b) { return b.d === a.d ? a.f - b.f : b.d - a.d; });\r\n    for (i = 0; i < dps.length; i++) {\r\n        if (dps[i].d > MD) {\r\n            var od = dps[i].d;\r\n            dps[i].d = MD;\r\n            dbt += bCost - (1 << (maxl - od));\r\n        }\r\n        else {\r\n            break;\r\n        }\r\n    }\r\n    dbt = dbt >>> (maxl - MD);\r\n    while (dbt > 0) {\r\n        var od = dps[i].d;\r\n        if (od < MD) {\r\n            dps[i].d++;\r\n            dbt -= (1 << (MD - od - 1));\r\n        }\r\n        else {\r\n            i++;\r\n        }\r\n    }\r\n    for (; i >= 0; i--) {\r\n        if (dps[i].d === MD && dbt < 0) {\r\n            dps[i].d--;\r\n            dbt++;\r\n        }\r\n    }\r\n    if (dbt !== 0)\r\n        console.log('debt left');\r\n}\r\n//# sourceMappingURL=huffman.js.map"]},"metadata":{},"sourceType":"module"}