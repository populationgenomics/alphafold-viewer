{"ast":null,"code":"/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __assign } from \"tslib\";\nimport { SubstitutionMatrices } from './substitution-matrix';\nvar DefaultAlignmentOptions = {\n  gapPenalty: -11,\n  gapExtensionPenalty: -1,\n  substMatrix: 'default'\n};\nexport function align(seqA, seqB, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var o = __assign(__assign({}, DefaultAlignmentOptions), options);\n\n  var alignment = new Alignment(seqA, seqB, o);\n  alignment.calculate();\n  return alignment.trace();\n}\n\nvar Alignment =\n/** @class */\nfunction () {\n  function Alignment(seqA, seqB, options) {\n    this.seqA = seqA;\n    this.seqB = seqB;\n    this.S = [];\n    this.V = [];\n    this.H = [];\n    this.gapPenalty = options.gapPenalty;\n    this.gapExtensionPenalty = options.gapExtensionPenalty;\n    this.substMatrix = options.substMatrix === 'default' ? undefined : SubstitutionMatrices[options.substMatrix];\n    this.n = this.seqA.length;\n    this.m = this.seqB.length;\n  }\n\n  Alignment.prototype.initMatrices = function () {\n    var _a = this,\n        n = _a.n,\n        m = _a.m,\n        gapPenalty = _a.gapPenalty,\n        S = _a.S,\n        V = _a.V,\n        H = _a.H;\n\n    for (var i = 0; i <= n; ++i) {\n      S[i] = [], V[i] = [], H[i] = [];\n\n      for (var j = 0; j <= m; ++j) {\n        S[i][j] = 0, V[i][j] = 0, H[i][j] = 0;\n      }\n    }\n\n    for (var i = 0; i <= n; ++i) {\n      S[i][0] = gapPenalty;\n      H[i][0] = -Infinity;\n    }\n\n    for (var j = 0; j <= m; ++j) {\n      S[0][j] = gapPenalty;\n      V[0][j] = -Infinity;\n    }\n\n    S[0][0] = 0;\n  };\n\n  Alignment.prototype.makeScoreFn = function () {\n    var _a = this,\n        seqA = _a.seqA,\n        seqB = _a.seqB,\n        substMatrix = _a.substMatrix;\n\n    if (substMatrix) {\n      return function score(i, j) {\n        var _a, _b;\n\n        var cA = seqA[i];\n        var cB = seqB[j];\n        return (_b = (_a = substMatrix[cA]) === null || _a === void 0 ? void 0 : _a[cB]) !== null && _b !== void 0 ? _b : -4;\n      };\n    } else {\n      return function scoreNoSubstMat(i, j) {\n        var cA = seqA[i];\n        var cB = seqB[j];\n        return cA === cB ? 5 : -3;\n      };\n    }\n  };\n\n  Alignment.prototype.calculate = function () {\n    this.initMatrices();\n    var scoreFn = this.makeScoreFn();\n\n    var _a = this,\n        V = _a.V,\n        H = _a.H,\n        S = _a.S,\n        n = _a.n,\n        m = _a.m,\n        gapExtensionPenalty = _a.gapExtensionPenalty,\n        gapPenalty = _a.gapPenalty;\n\n    var Vi1, Si1, Vi, Hi, Si;\n\n    for (var i = 1; i <= n; ++i) {\n      Si1 = S[i - 1], Vi1 = V[i - 1];\n      Vi = V[i], Hi = H[i], Si = S[i];\n\n      for (var j = 1; j <= m; ++j) {\n        Vi[j] = Math.max(Si1[j] + gapPenalty, Vi1[j] + gapExtensionPenalty);\n        Hi[j] = Math.max(Si[j - 1] + gapPenalty, Hi[j - 1] + gapExtensionPenalty);\n        Si[j] = Math.max(Si1[j - 1] + scoreFn(i - 1, j - 1), // match\n        Vi[j], // del\n        Hi[j] // ins\n        );\n      }\n    }\n  };\n\n  Alignment.prototype.trace = function () {\n    var scoreFn = this.makeScoreFn();\n\n    var _a = this,\n        V = _a.V,\n        H = _a.H,\n        S = _a.S,\n        seqA = _a.seqA,\n        seqB = _a.seqB,\n        gapExtensionPenalty = _a.gapExtensionPenalty,\n        gapPenalty = _a.gapPenalty;\n\n    var i = this.n;\n    var j = this.m;\n    var mat;\n    var score;\n    var aliA = '';\n    var aliB = '';\n\n    if (S[i][j] >= V[i][j]) {\n      mat = 'S';\n      score = S[i][j];\n    } else if (V[i][j] >= H[i][j]) {\n      mat = 'V';\n      score = V[i][j];\n    } else {\n      mat = 'H';\n      score = H[i][j];\n    }\n\n    while (i > 0 && j > 0) {\n      if (mat === 'S') {\n        if (S[i][j] === S[i - 1][j - 1] + scoreFn(i - 1, j - 1)) {\n          aliA = seqA[i - 1] + aliA;\n          aliB = seqB[j - 1] + aliB;\n          --i;\n          --j;\n          mat = 'S';\n        } else if (S[i][j] === V[i][j]) {\n          mat = 'V';\n        } else if (S[i][j] === H[i][j]) {\n          mat = 'H';\n        } else {\n          --i;\n          --j;\n        }\n      } else if (mat === 'V') {\n        if (V[i][j] === V[i - 1][j] + gapExtensionPenalty) {\n          aliA = seqA[i - 1] + aliA;\n          aliB = '-' + aliB;\n          --i;\n          mat = 'V';\n        } else if (V[i][j] === S[i - 1][j] + gapPenalty) {\n          aliA = seqA[i - 1] + aliA;\n          aliB = '-' + aliB;\n          --i;\n          mat = 'S';\n        } else {\n          --i;\n        }\n      } else if (mat === 'H') {\n        if (H[i][j] === H[i][j - 1] + gapExtensionPenalty) {\n          aliA = '-' + aliA;\n          aliB = seqB[j - 1] + aliB;\n          --j;\n          mat = 'H';\n        } else if (H[i][j] === S[i][j - 1] + gapPenalty) {\n          aliA = '-' + aliA;\n          aliB = seqB[j - 1] + aliB;\n          --j;\n          mat = 'S';\n        } else {\n          --j;\n        }\n      }\n    }\n\n    while (i > 0) {\n      aliA = seqA[i - 1] + aliA;\n      aliB = '-' + aliB;\n      --i;\n    }\n\n    while (j > 0) {\n      aliA = '-' + aliA;\n      aliB = seqB[j - 1] + aliB;\n      --j;\n    }\n\n    return {\n      aliA: aliA,\n      aliB: aliB,\n      score: score\n    };\n  };\n\n  return Alignment;\n}();","map":{"version":3,"sources":["../../../../src/mol-model/sequence/alignment/alignment.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __assign } from \"tslib\";\r\nimport { SubstitutionMatrices } from './substitution-matrix';\r\nvar DefaultAlignmentOptions = {\r\n    gapPenalty: -11,\r\n    gapExtensionPenalty: -1,\r\n    substMatrix: 'default'\r\n};\r\nexport function align(seqA, seqB, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var o = __assign(__assign({}, DefaultAlignmentOptions), options);\r\n    var alignment = new Alignment(seqA, seqB, o);\r\n    alignment.calculate();\r\n    return alignment.trace();\r\n}\r\nvar Alignment = /** @class */ (function () {\r\n    function Alignment(seqA, seqB, options) {\r\n        this.seqA = seqA;\r\n        this.seqB = seqB;\r\n        this.S = [];\r\n        this.V = [];\r\n        this.H = [];\r\n        this.gapPenalty = options.gapPenalty;\r\n        this.gapExtensionPenalty = options.gapExtensionPenalty;\r\n        this.substMatrix = options.substMatrix === 'default' ? undefined : SubstitutionMatrices[options.substMatrix];\r\n        this.n = this.seqA.length;\r\n        this.m = this.seqB.length;\r\n    }\r\n    Alignment.prototype.initMatrices = function () {\r\n        var _a = this, n = _a.n, m = _a.m, gapPenalty = _a.gapPenalty, S = _a.S, V = _a.V, H = _a.H;\r\n        for (var i = 0; i <= n; ++i) {\r\n            S[i] = [], V[i] = [], H[i] = [];\r\n            for (var j = 0; j <= m; ++j) {\r\n                S[i][j] = 0, V[i][j] = 0, H[i][j] = 0;\r\n            }\r\n        }\r\n        for (var i = 0; i <= n; ++i) {\r\n            S[i][0] = gapPenalty;\r\n            H[i][0] = -Infinity;\r\n        }\r\n        for (var j = 0; j <= m; ++j) {\r\n            S[0][j] = gapPenalty;\r\n            V[0][j] = -Infinity;\r\n        }\r\n        S[0][0] = 0;\r\n    };\r\n    Alignment.prototype.makeScoreFn = function () {\r\n        var _a = this, seqA = _a.seqA, seqB = _a.seqB, substMatrix = _a.substMatrix;\r\n        if (substMatrix) {\r\n            return function score(i, j) {\r\n                var _a, _b;\r\n                var cA = seqA[i];\r\n                var cB = seqB[j];\r\n                return (_b = (_a = substMatrix[cA]) === null || _a === void 0 ? void 0 : _a[cB]) !== null && _b !== void 0 ? _b : -4;\r\n            };\r\n        }\r\n        else {\r\n            return function scoreNoSubstMat(i, j) {\r\n                var cA = seqA[i];\r\n                var cB = seqB[j];\r\n                return cA === cB ? 5 : -3;\r\n            };\r\n        }\r\n    };\r\n    Alignment.prototype.calculate = function () {\r\n        this.initMatrices();\r\n        var scoreFn = this.makeScoreFn();\r\n        var _a = this, V = _a.V, H = _a.H, S = _a.S, n = _a.n, m = _a.m, gapExtensionPenalty = _a.gapExtensionPenalty, gapPenalty = _a.gapPenalty;\r\n        var Vi1, Si1, Vi, Hi, Si;\r\n        for (var i = 1; i <= n; ++i) {\r\n            Si1 = S[i - 1], Vi1 = V[i - 1];\r\n            Vi = V[i], Hi = H[i], Si = S[i];\r\n            for (var j = 1; j <= m; ++j) {\r\n                Vi[j] = Math.max(Si1[j] + gapPenalty, Vi1[j] + gapExtensionPenalty);\r\n                Hi[j] = Math.max(Si[j - 1] + gapPenalty, Hi[j - 1] + gapExtensionPenalty);\r\n                Si[j] = Math.max(Si1[j - 1] + scoreFn(i - 1, j - 1), // match\r\n                Vi[j], // del\r\n                Hi[j] // ins\r\n                );\r\n            }\r\n        }\r\n    };\r\n    Alignment.prototype.trace = function () {\r\n        var scoreFn = this.makeScoreFn();\r\n        var _a = this, V = _a.V, H = _a.H, S = _a.S, seqA = _a.seqA, seqB = _a.seqB, gapExtensionPenalty = _a.gapExtensionPenalty, gapPenalty = _a.gapPenalty;\r\n        var i = this.n;\r\n        var j = this.m;\r\n        var mat;\r\n        var score;\r\n        var aliA = '';\r\n        var aliB = '';\r\n        if (S[i][j] >= V[i][j]) {\r\n            mat = 'S';\r\n            score = S[i][j];\r\n        }\r\n        else if (V[i][j] >= H[i][j]) {\r\n            mat = 'V';\r\n            score = V[i][j];\r\n        }\r\n        else {\r\n            mat = 'H';\r\n            score = H[i][j];\r\n        }\r\n        while (i > 0 && j > 0) {\r\n            if (mat === 'S') {\r\n                if (S[i][j] === S[i - 1][j - 1] + scoreFn(i - 1, j - 1)) {\r\n                    aliA = seqA[i - 1] + aliA;\r\n                    aliB = seqB[j - 1] + aliB;\r\n                    --i;\r\n                    --j;\r\n                    mat = 'S';\r\n                }\r\n                else if (S[i][j] === V[i][j]) {\r\n                    mat = 'V';\r\n                }\r\n                else if (S[i][j] === H[i][j]) {\r\n                    mat = 'H';\r\n                }\r\n                else {\r\n                    --i;\r\n                    --j;\r\n                }\r\n            }\r\n            else if (mat === 'V') {\r\n                if (V[i][j] === V[i - 1][j] + gapExtensionPenalty) {\r\n                    aliA = seqA[i - 1] + aliA;\r\n                    aliB = '-' + aliB;\r\n                    --i;\r\n                    mat = 'V';\r\n                }\r\n                else if (V[i][j] === S[i - 1][j] + gapPenalty) {\r\n                    aliA = seqA[i - 1] + aliA;\r\n                    aliB = '-' + aliB;\r\n                    --i;\r\n                    mat = 'S';\r\n                }\r\n                else {\r\n                    --i;\r\n                }\r\n            }\r\n            else if (mat === 'H') {\r\n                if (H[i][j] === H[i][j - 1] + gapExtensionPenalty) {\r\n                    aliA = '-' + aliA;\r\n                    aliB = seqB[j - 1] + aliB;\r\n                    --j;\r\n                    mat = 'H';\r\n                }\r\n                else if (H[i][j] === S[i][j - 1] + gapPenalty) {\r\n                    aliA = '-' + aliA;\r\n                    aliB = seqB[j - 1] + aliB;\r\n                    --j;\r\n                    mat = 'S';\r\n                }\r\n                else {\r\n                    --j;\r\n                }\r\n            }\r\n        }\r\n        while (i > 0) {\r\n            aliA = seqA[i - 1] + aliA;\r\n            aliB = '-' + aliB;\r\n            --i;\r\n        }\r\n        while (j > 0) {\r\n            aliA = '-' + aliA;\r\n            aliB = seqB[j - 1] + aliB;\r\n            --j;\r\n        }\r\n        return { aliA: aliA, aliB: aliB, score: score };\r\n    };\r\n    return Alignment;\r\n}());\r\n//# sourceMappingURL=alignment.js.map"]},"metadata":{},"sourceType":"module"}