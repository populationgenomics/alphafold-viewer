{"ast":null,"code":"/**\r\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { __assign } from \"tslib\";\nimport { Subject } from 'rxjs';\nimport { Vec2, EPSILON } from '../../mol-math/linear-algebra';\nimport { BitFlags, noop } from '../../mol-util';\nexport function getButtons(event) {\n  if (typeof event === 'object') {\n    if ('buttons' in event) {\n      return event.buttons;\n    } else if ('which' in event) {\n      var b = event.which; // 'any' to support older browsers\n\n      if (b === 2) {\n        return 4;\n      } else if (b === 3) {\n        return 2;\n      } else if (b > 0) {\n        return 1 << b - 1;\n      }\n    }\n  }\n\n  return 0;\n}\nexport function getButton(event) {\n  if (typeof event === 'object') {\n    if ('button' in event) {\n      var b = event.button;\n\n      if (b === 1) {\n        return 4;\n      } else if (b === 2) {\n        return 2;\n      } else if (b >= 0) {\n        return 1 << b;\n      }\n    }\n  }\n\n  return 0;\n}\nexport function getModifiers(event) {\n  return {\n    alt: 'altKey' in event ? event.altKey : false,\n    shift: 'shiftKey' in event ? event.shiftKey : false,\n    control: 'ctrlKey' in event ? event.ctrlKey : false,\n    meta: 'metaKey' in event ? event.metaKey : false\n  };\n}\nexport var DefaultInputObserverProps = {\n  noScroll: true,\n  noMiddleClickScroll: true,\n  noContextMenu: true,\n  noPinchZoom: true,\n  noTextSelect: true,\n  preventGestures: false,\n  mask: function (x, y) {\n    return true;\n  },\n  pixelScale: 1\n};\nexport var ModifiersKeys;\n\n(function (ModifiersKeys) {\n  ModifiersKeys.None = create();\n\n  function areEqual(a, b) {\n    return a.shift === b.shift && a.alt === b.alt && a.control === b.control && a.meta === b.meta;\n  }\n\n  ModifiersKeys.areEqual = areEqual;\n\n  function size(a) {\n    if (!a) return 0;\n    var ret = 0;\n    if (!!a.shift) ret++;\n    if (!!a.alt) ret++;\n    if (!!a.control) ret++;\n    if (!!a.meta) ret++;\n    return ret;\n  }\n\n  ModifiersKeys.size = size;\n\n  function create(modifierKeys) {\n    if (modifierKeys === void 0) {\n      modifierKeys = {};\n    }\n\n    return {\n      shift: !!modifierKeys.shift,\n      alt: !!modifierKeys.alt,\n      control: !!modifierKeys.control,\n      meta: !!modifierKeys.meta\n    };\n  }\n\n  ModifiersKeys.create = create;\n})(ModifiersKeys || (ModifiersKeys = {}));\n\nexport var ButtonsType;\n\n(function (ButtonsType) {\n  ButtonsType.has = BitFlags.has;\n  ButtonsType.create = BitFlags.create;\n})(ButtonsType || (ButtonsType = {}));\n\nfunction createEvents() {\n  return {\n    drag: new Subject(),\n    interactionEnd: new Subject(),\n    click: new Subject(),\n    move: new Subject(),\n    wheel: new Subject(),\n    pinch: new Subject(),\n    gesture: new Subject(),\n    resize: new Subject(),\n    leave: new Subject(),\n    enter: new Subject(),\n    modifiers: new Subject(),\n    key: new Subject()\n  };\n}\n\nvar AllowedNonPrintableKeys = ['Backspace', 'Delete'];\nvar InputObserver;\n\n(function (InputObserver) {\n  function create(props) {\n    if (props === void 0) {\n      props = {};\n    }\n\n    var _a = __assign(__assign({}, DefaultInputObserverProps), props),\n        noScroll = _a.noScroll,\n        noContextMenu = _a.noContextMenu;\n\n    return __assign(__assign({\n      noScroll: noScroll,\n      noContextMenu: noContextMenu,\n      width: 0,\n      height: 0,\n      pixelRatio: 1\n    }, createEvents()), {\n      dispose: noop\n    });\n  }\n\n  InputObserver.create = create;\n\n  function fromElement(element, props) {\n    if (props === void 0) {\n      props = {};\n    }\n\n    var _a = __assign(__assign({}, DefaultInputObserverProps), props),\n        noScroll = _a.noScroll,\n        noMiddleClickScroll = _a.noMiddleClickScroll,\n        noContextMenu = _a.noContextMenu,\n        noPinchZoom = _a.noPinchZoom,\n        noTextSelect = _a.noTextSelect,\n        mask = _a.mask,\n        pixelScale = _a.pixelScale,\n        preventGestures = _a.preventGestures;\n\n    var width = element.clientWidth * pixelRatio();\n    var height = element.clientHeight * pixelRatio();\n    var lastTouchDistance = 0,\n        lastTouchFraction = 0;\n    var pointerDown = Vec2();\n    var pointerStart = Vec2();\n    var pointerEnd = Vec2();\n    var pointerDelta = Vec2();\n    var rectSize = Vec2();\n    var modifierKeys = {\n      shift: false,\n      alt: false,\n      control: false,\n      meta: false\n    };\n\n    function pixelRatio() {\n      return window.devicePixelRatio * pixelScale;\n    }\n\n    function getModifierKeys() {\n      return __assign({}, modifierKeys);\n    }\n\n    var dragging = 0\n    /* Stopped */\n    ;\n    var disposed = false;\n    var buttons = ButtonsType.create(0\n    /* None */\n    );\n    var button = 0\n    /* None */\n    ;\n    var isInside = false;\n    var events = createEvents();\n    var drag = events.drag,\n        interactionEnd = events.interactionEnd,\n        wheel = events.wheel,\n        pinch = events.pinch,\n        gesture = events.gesture,\n        click = events.click,\n        move = events.move,\n        leave = events.leave,\n        enter = events.enter,\n        resize = events.resize,\n        modifiers = events.modifiers,\n        key = events.key;\n    attach();\n    return __assign(__assign({\n      get noScroll() {\n        return noScroll;\n      },\n\n      set noScroll(value) {\n        noScroll = value;\n      },\n\n      get noContextMenu() {\n        return noContextMenu;\n      },\n\n      set noContextMenu(value) {\n        noContextMenu = value;\n      },\n\n      get width() {\n        return width;\n      },\n\n      get height() {\n        return height;\n      },\n\n      get pixelRatio() {\n        return pixelRatio();\n      }\n\n    }, events), {\n      dispose: dispose\n    });\n\n    function attach() {\n      element.addEventListener('contextmenu', onContextMenu, false);\n      element.addEventListener('wheel', onMouseWheel, false);\n      element.addEventListener('mousedown', onMouseDown, false); // for dragging to work outside canvas bounds,\n      // mouse move/up events have to be added to a parent, i.e. window\n\n      window.addEventListener('mousemove', onMouseMove, false);\n      window.addEventListener('mouseup', onMouseUp, false);\n      element.addEventListener('mouseenter', onMouseEnter, false);\n      element.addEventListener('mouseleave', onMouseLeave, false);\n      element.addEventListener('touchstart', onTouchStart, false);\n      element.addEventListener('touchmove', onTouchMove, false);\n      element.addEventListener('touchend', onTouchEnd, false);\n      element.addEventListener('gesturechange', onGestureChange, false);\n      element.addEventListener('gesturestart', onGestureStart, false);\n      element.addEventListener('gestureend', onGestureEnd, false); // reset buttons and modifier keys state when browser window looses focus\n\n      window.addEventListener('blur', handleBlur);\n      window.addEventListener('keyup', handleKeyUp, false);\n      window.addEventListener('keydown', handleKeyDown, false);\n      window.addEventListener('keypress', handleKeyPress, false);\n      window.addEventListener('resize', onResize, false);\n    }\n\n    function dispose() {\n      if (disposed) return;\n      disposed = true;\n      element.removeEventListener('contextmenu', onContextMenu, false);\n      element.removeEventListener('wheel', onMouseWheel, false);\n      element.removeEventListener('mousedown', onMouseDown, false);\n      window.removeEventListener('mousemove', onMouseMove, false);\n      window.removeEventListener('mouseup', onMouseUp, false);\n      element.removeEventListener('mouseenter', onMouseEnter, false);\n      element.removeEventListener('mouseleave', onMouseLeave, false);\n      element.removeEventListener('touchstart', onTouchStart, false);\n      element.removeEventListener('touchmove', onTouchMove, false);\n      element.removeEventListener('touchend', onTouchEnd, false);\n      element.removeEventListener('gesturechange', onGestureChange, false);\n      element.removeEventListener('gesturestart', onGestureStart, false);\n      element.removeEventListener('gestureend', onGestureEnd, false);\n      window.removeEventListener('blur', handleBlur);\n      window.removeEventListener('keyup', handleKeyUp, false);\n      window.removeEventListener('keydown', handleKeyDown, false);\n      window.removeEventListener('keypress', handleKeyPress, false);\n      window.removeEventListener('resize', onResize, false);\n    }\n\n    function onContextMenu(event) {\n      if (!mask(event.clientX, event.clientY)) return;\n\n      if (noContextMenu) {\n        event.preventDefault();\n      }\n    }\n\n    function updateModifierKeys(event) {\n      modifierKeys.alt = event.altKey;\n      modifierKeys.shift = event.shiftKey;\n      modifierKeys.control = event.ctrlKey;\n      modifierKeys.meta = event.metaKey;\n    }\n\n    function handleBlur() {\n      if (buttons || modifierKeys.shift || modifierKeys.alt || modifierKeys.meta || modifierKeys.control) {\n        buttons = 0;\n        modifierKeys.shift = modifierKeys.alt = modifierKeys.control = modifierKeys.meta = false;\n      }\n    }\n\n    function handleKeyDown(event) {\n      var changed = false;\n\n      if (!modifierKeys.alt && event.altKey) {\n        changed = true;\n        modifierKeys.alt = true;\n      }\n\n      if (!modifierKeys.shift && event.shiftKey) {\n        changed = true;\n        modifierKeys.shift = true;\n      }\n\n      if (!modifierKeys.control && event.ctrlKey) {\n        changed = true;\n        modifierKeys.control = true;\n      }\n\n      if (!modifierKeys.meta && event.metaKey) {\n        changed = true;\n        modifierKeys.meta = true;\n      }\n\n      if (changed && isInside) modifiers.next(getModifierKeys());\n    }\n\n    function handleKeyUp(event) {\n      var changed = false;\n\n      if (modifierKeys.alt && !event.altKey) {\n        changed = true;\n        modifierKeys.alt = false;\n      }\n\n      if (modifierKeys.shift && !event.shiftKey) {\n        changed = true;\n        modifierKeys.shift = false;\n      }\n\n      if (modifierKeys.control && !event.ctrlKey) {\n        changed = true;\n        modifierKeys.control = false;\n      }\n\n      if (modifierKeys.meta && !event.metaKey) {\n        changed = true;\n        modifierKeys.meta = false;\n      }\n\n      if (changed && isInside) modifiers.next(getModifierKeys());\n      if (AllowedNonPrintableKeys.includes(event.key)) handleKeyPress(event);\n    }\n\n    function handleKeyPress(event) {\n      key.next({\n        key: event.key,\n        modifiers: getModifierKeys()\n      });\n    }\n\n    function getCenterTouch(ev) {\n      var t0 = ev.touches[0];\n      var t1 = ev.touches[1];\n      return {\n        clientX: (t0.clientX + t1.clientX) / 2,\n        clientY: (t0.clientY + t1.clientY) / 2,\n        pageX: (t0.pageX + t1.pageX) / 2,\n        pageY: (t0.pageY + t1.pageY) / 2\n      };\n    }\n\n    function getTouchDistance(ev) {\n      var dx = ev.touches[0].pageX - ev.touches[1].pageX;\n      var dy = ev.touches[0].pageY - ev.touches[1].pageY;\n      return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    function onTouchStart(ev) {\n      ev.preventDefault();\n\n      if (ev.touches.length === 1) {\n        buttons = button = 1\n        /* Primary */\n        ;\n        onPointerDown(ev.touches[0]);\n      } else if (ev.touches.length === 2) {\n        buttons = 2\n        /* Secondary */\n        & 4\n        /* Auxilary */\n        ;\n        button = 2\n        /* Secondary */\n        ;\n        onPointerDown(getCenterTouch(ev));\n        var touchDistance = getTouchDistance(ev);\n        lastTouchDistance = touchDistance;\n        pinch.next({\n          distance: touchDistance,\n          fraction: 1,\n          fractionDelta: 0,\n          delta: 0,\n          isStart: true,\n          buttons: buttons,\n          button: button,\n          modifiers: getModifierKeys()\n        });\n      } else if (ev.touches.length === 3) {\n        buttons = button = 8\n        /* Forth */\n        ;\n        onPointerDown(getCenterTouch(ev));\n      }\n    }\n\n    function onTouchEnd(ev) {\n      endDrag();\n    }\n\n    function onTouchMove(ev) {\n      button = 0\n      /* None */\n      ;\n\n      if (noPinchZoom) {\n        ev.preventDefault();\n        ev.stopPropagation();\n\n        if (ev.originalEvent) {\n          ev.originalEvent.preventDefault();\n          ev.originalEvent.stopPropagation();\n        }\n      }\n\n      if (ev.touches.length === 1) {\n        buttons = 1\n        /* Primary */\n        ;\n        onPointerMove(ev.touches[0]);\n      } else if (ev.touches.length === 2) {\n        var touchDistance = getTouchDistance(ev);\n        var touchDelta = lastTouchDistance - touchDistance;\n\n        if (Math.abs(touchDelta) < 4) {\n          buttons = 2\n          /* Secondary */\n          ;\n          onPointerMove(getCenterTouch(ev));\n        } else {\n          buttons = 4\n          /* Auxilary */\n          ;\n          updateModifierKeys(ev);\n          var fraction = lastTouchDistance / touchDistance;\n          pinch.next({\n            delta: touchDelta,\n            fraction: fraction,\n            fractionDelta: lastTouchFraction - fraction,\n            distance: touchDistance,\n            isStart: false,\n            buttons: buttons,\n            button: button,\n            modifiers: getModifierKeys()\n          });\n          lastTouchFraction = fraction;\n        }\n\n        lastTouchDistance = touchDistance;\n      } else if (ev.touches.length === 3) {\n        buttons = 8\n        /* Forth */\n        ;\n        onPointerMove(getCenterTouch(ev));\n      }\n    }\n\n    function onMouseDown(ev) {\n      updateModifierKeys(ev);\n      buttons = getButtons(ev);\n      button = getButton(ev);\n\n      if (noMiddleClickScroll && buttons === 4\n      /* Auxilary */\n      ) {\n        ev.preventDefault;\n      }\n\n      onPointerDown(ev);\n    }\n\n    function onMouseMove(ev) {\n      updateModifierKeys(ev);\n      buttons = getButtons(ev);\n      button = 0\n      /* None */\n      ;\n      onPointerMove(ev);\n    }\n\n    function onMouseUp(ev) {\n      updateModifierKeys(ev);\n      buttons = getButtons(ev);\n      button = getButton(ev);\n      onPointerUp(ev);\n      endDrag();\n    }\n\n    function endDrag() {\n      interactionEnd.next(void 0);\n    }\n\n    function onPointerDown(ev) {\n      if (!mask(ev.clientX, ev.clientY)) return;\n      eventOffset(pointerStart, ev);\n      Vec2.copy(pointerDown, pointerStart);\n\n      if (insideBounds(pointerStart)) {\n        dragging = 1\n        /* Started */\n        ;\n      }\n    }\n\n    function onPointerUp(ev) {\n      dragging = 0\n      /* Stopped */\n      ;\n      if (!mask(ev.clientX, ev.clientY)) return;\n      eventOffset(pointerEnd, ev);\n\n      if (Vec2.distance(pointerEnd, pointerDown) < 4) {\n        var pageX = ev.pageX,\n            pageY = ev.pageY;\n        var x = pointerEnd[0],\n            y = pointerEnd[1];\n        click.next({\n          x: x,\n          y: y,\n          pageX: pageX,\n          pageY: pageY,\n          buttons: buttons,\n          button: button,\n          modifiers: getModifierKeys()\n        });\n      }\n    }\n\n    function onPointerMove(ev) {\n      var _a;\n\n      eventOffset(pointerEnd, ev);\n      var pageX = ev.pageX,\n          pageY = ev.pageY;\n      var x = pointerEnd[0],\n          y = pointerEnd[1];\n      var inside = insideBounds(pointerEnd);\n      move.next({\n        x: x,\n        y: y,\n        pageX: pageX,\n        pageY: pageY,\n        buttons: buttons,\n        button: button,\n        modifiers: getModifierKeys(),\n        inside: inside\n      });\n      if (dragging === 0\n      /* Stopped */\n      ) return;\n\n      if (noTextSelect) {\n        (_a = ev.preventDefault) === null || _a === void 0 ? void 0 : _a.call(ev);\n      }\n\n      Vec2.div(pointerDelta, Vec2.sub(pointerDelta, pointerEnd, pointerStart), getClientSize(rectSize));\n      if (Vec2.magnitude(pointerDelta) < EPSILON) return;\n      var isStart = dragging === 1\n      /* Started */\n      ;\n      if (isStart && !mask(ev.clientX, ev.clientY)) return;\n      var dx = pointerDelta[0],\n          dy = pointerDelta[1];\n      drag.next({\n        x: x,\n        y: y,\n        dx: dx,\n        dy: dy,\n        pageX: pageX,\n        pageY: pageY,\n        buttons: buttons,\n        button: button,\n        modifiers: getModifierKeys(),\n        isStart: isStart\n      });\n      Vec2.copy(pointerStart, pointerEnd);\n      dragging = 2\n      /* Moving */\n      ;\n    }\n\n    function onMouseWheel(ev) {\n      if (!mask(ev.clientX, ev.clientY)) return;\n      eventOffset(pointerEnd, ev);\n      var pageX = ev.pageX,\n          pageY = ev.pageY;\n      var x = pointerEnd[0],\n          y = pointerEnd[1];\n\n      if (noScroll) {\n        ev.preventDefault();\n      }\n\n      var normalized = normalizeWheel(ev);\n      buttons = button = 4\n      /* Auxilary */\n      ;\n\n      if (normalized.dx || normalized.dy || normalized.dz) {\n        wheel.next(__assign(__assign({\n          x: x,\n          y: y,\n          pageX: pageX,\n          pageY: pageY\n        }, normalized), {\n          buttons: buttons,\n          button: button,\n          modifiers: getModifierKeys()\n        }));\n      }\n    }\n\n    function tryPreventGesture(ev) {\n      var _a, _b; // console.log(ev, preventGestures);\n\n\n      if (!preventGestures) return;\n      ev.preventDefault();\n      (_a = ev.stopImmediatePropagation) === null || _a === void 0 ? void 0 : _a.call(ev);\n      (_b = ev.stopPropagation) === null || _b === void 0 ? void 0 : _b.call(ev);\n    }\n\n    var prevGestureScale = 0,\n        prevGestureRotation = 0;\n\n    function onGestureStart(ev) {\n      tryPreventGesture(ev);\n      prevGestureScale = ev.scale;\n      prevGestureRotation = ev.rotation;\n      gesture.next({\n        scale: ev.scale,\n        rotation: ev.rotation,\n        deltaRotation: 0,\n        deltaScale: 0,\n        isStart: true\n      });\n    }\n\n    function gestureDelta(ev, isEnd) {\n      gesture.next({\n        scale: ev.scale,\n        rotation: ev.rotation,\n        deltaRotation: prevGestureRotation - ev.rotation,\n        deltaScale: prevGestureScale - ev.scale,\n        isEnd: isEnd\n      });\n      prevGestureRotation = ev.rotation;\n      prevGestureScale = ev.scale;\n    }\n\n    function onGestureChange(ev) {\n      tryPreventGesture(ev);\n      gestureDelta(ev);\n    }\n\n    function onGestureEnd(ev) {\n      tryPreventGesture(ev);\n      gestureDelta(ev, true);\n    }\n\n    function onMouseEnter(ev) {\n      isInside = true;\n      enter.next(void 0);\n    }\n\n    function onMouseLeave(ev) {\n      isInside = false;\n      leave.next(void 0);\n    }\n\n    function onResize(ev) {\n      resize.next({});\n    }\n\n    function insideBounds(pos) {\n      if (element instanceof Window || element instanceof Document || element === document.body) {\n        return true;\n      } else {\n        var rect = element.getBoundingClientRect();\n        return pos[0] >= 0 && pos[1] >= 0 && pos[0] < rect.width && pos[1] < rect.height;\n      }\n    }\n\n    function getClientSize(out) {\n      out[0] = element.clientWidth;\n      out[1] = element.clientHeight;\n      return out;\n    }\n\n    function eventOffset(out, ev) {\n      width = element.clientWidth * pixelRatio();\n      height = element.clientHeight * pixelRatio();\n      var cx = ev.clientX || 0;\n      var cy = ev.clientY || 0;\n      var rect = element.getBoundingClientRect();\n      out[0] = cx - rect.left;\n      out[1] = cy - rect.top;\n      return out;\n    }\n  }\n\n  InputObserver.fromElement = fromElement;\n})(InputObserver || (InputObserver = {})); // Adapted from https://stackoverflow.com/a/30134826\n// License: https://creativecommons.org/licenses/by-sa/3.0/\n\n\nfunction normalizeWheel(event) {\n  // Reasonable defaults\n  var PIXEL_STEP = 10;\n  var LINE_HEIGHT = 40;\n  var PAGE_HEIGHT = 800;\n  var spinX = 0,\n      spinY = 0,\n      dx = 0,\n      dy = 0,\n      dz = 0; // pixelX, pixelY, pixelZ\n  // Legacy\n\n  if ('detail' in event) {\n    spinY = event.detail;\n  }\n\n  if ('wheelDelta' in event) {\n    spinY = -event.wheelDelta / 120;\n  }\n\n  if ('wheelDeltaY' in event) {\n    spinY = -event.wheelDeltaY / 120;\n  }\n\n  if ('wheelDeltaX' in event) {\n    spinX = -event.wheelDeltaX / 120;\n  } // side scrolling on FF with DOMMouseScroll\n\n\n  if ('axis' in event && event.axis === event.HORIZONTAL_AXIS) {\n    spinX = spinY;\n    spinY = 0;\n  }\n\n  dx = spinX * PIXEL_STEP;\n  dy = spinY * PIXEL_STEP;\n\n  if ('deltaY' in event) {\n    dy = event.deltaY;\n  }\n\n  if ('deltaX' in event) {\n    dx = event.deltaX;\n  }\n\n  if ('deltaZ' in event) {\n    dz = event.deltaZ;\n  }\n\n  if ((dx || dy || dz) && event.deltaMode) {\n    if (event.deltaMode === 1) {\n      // delta in LINE units\n      dx *= LINE_HEIGHT;\n      dy *= LINE_HEIGHT;\n      dz *= LINE_HEIGHT;\n    } else {\n      // delta in PAGE units\n      dx *= PAGE_HEIGHT;\n      dy *= PAGE_HEIGHT;\n      dz *= PAGE_HEIGHT;\n    }\n  } // Fall-back if spin cannot be determined\n\n\n  if (dx && !spinX) {\n    spinX = dx < 1 ? -1 : 1;\n  }\n\n  if (dy && !spinY) {\n    spinY = dy < 1 ? -1 : 1;\n  }\n\n  return {\n    spinX: spinX,\n    spinY: spinY,\n    dx: dx,\n    dy: dy,\n    dz: dz\n  };\n}\n\nexport { InputObserver };","map":{"version":3,"sources":["../../../src/mol-util/input/input-observer.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { __assign } from \"tslib\";\r\nimport { Subject } from 'rxjs';\r\nimport { Vec2, EPSILON } from '../../mol-math/linear-algebra';\r\nimport { BitFlags, noop } from '../../mol-util';\r\nexport function getButtons(event) {\r\n    if (typeof event === 'object') {\r\n        if ('buttons' in event) {\r\n            return event.buttons;\r\n        }\r\n        else if ('which' in event) {\r\n            var b = event.which; // 'any' to support older browsers\r\n            if (b === 2) {\r\n                return 4;\r\n            }\r\n            else if (b === 3) {\r\n                return 2;\r\n            }\r\n            else if (b > 0) {\r\n                return 1 << (b - 1);\r\n            }\r\n        }\r\n    }\r\n    return 0;\r\n}\r\nexport function getButton(event) {\r\n    if (typeof event === 'object') {\r\n        if ('button' in event) {\r\n            var b = event.button;\r\n            if (b === 1) {\r\n                return 4;\r\n            }\r\n            else if (b === 2) {\r\n                return 2;\r\n            }\r\n            else if (b >= 0) {\r\n                return 1 << b;\r\n            }\r\n        }\r\n    }\r\n    return 0;\r\n}\r\nexport function getModifiers(event) {\r\n    return {\r\n        alt: 'altKey' in event ? event.altKey : false,\r\n        shift: 'shiftKey' in event ? event.shiftKey : false,\r\n        control: 'ctrlKey' in event ? event.ctrlKey : false,\r\n        meta: 'metaKey' in event ? event.metaKey : false\r\n    };\r\n}\r\nexport var DefaultInputObserverProps = {\r\n    noScroll: true,\r\n    noMiddleClickScroll: true,\r\n    noContextMenu: true,\r\n    noPinchZoom: true,\r\n    noTextSelect: true,\r\n    preventGestures: false,\r\n    mask: function (x, y) { return true; },\r\n    pixelScale: 1\r\n};\r\nexport var ModifiersKeys;\r\n(function (ModifiersKeys) {\r\n    ModifiersKeys.None = create();\r\n    function areEqual(a, b) {\r\n        return a.shift === b.shift && a.alt === b.alt && a.control === b.control && a.meta === b.meta;\r\n    }\r\n    ModifiersKeys.areEqual = areEqual;\r\n    function size(a) {\r\n        if (!a)\r\n            return 0;\r\n        var ret = 0;\r\n        if (!!a.shift)\r\n            ret++;\r\n        if (!!a.alt)\r\n            ret++;\r\n        if (!!a.control)\r\n            ret++;\r\n        if (!!a.meta)\r\n            ret++;\r\n        return ret;\r\n    }\r\n    ModifiersKeys.size = size;\r\n    function create(modifierKeys) {\r\n        if (modifierKeys === void 0) { modifierKeys = {}; }\r\n        return {\r\n            shift: !!modifierKeys.shift,\r\n            alt: !!modifierKeys.alt,\r\n            control: !!modifierKeys.control,\r\n            meta: !!modifierKeys.meta\r\n        };\r\n    }\r\n    ModifiersKeys.create = create;\r\n})(ModifiersKeys || (ModifiersKeys = {}));\r\nexport var ButtonsType;\r\n(function (ButtonsType) {\r\n    ButtonsType.has = BitFlags.has;\r\n    ButtonsType.create = BitFlags.create;\r\n})(ButtonsType || (ButtonsType = {}));\r\nfunction createEvents() {\r\n    return {\r\n        drag: new Subject(),\r\n        interactionEnd: new Subject(),\r\n        click: new Subject(),\r\n        move: new Subject(),\r\n        wheel: new Subject(),\r\n        pinch: new Subject(),\r\n        gesture: new Subject(),\r\n        resize: new Subject(),\r\n        leave: new Subject(),\r\n        enter: new Subject(),\r\n        modifiers: new Subject(),\r\n        key: new Subject(),\r\n    };\r\n}\r\nvar AllowedNonPrintableKeys = ['Backspace', 'Delete'];\r\nvar InputObserver;\r\n(function (InputObserver) {\r\n    function create(props) {\r\n        if (props === void 0) { props = {}; }\r\n        var _a = __assign(__assign({}, DefaultInputObserverProps), props), noScroll = _a.noScroll, noContextMenu = _a.noContextMenu;\r\n        return __assign(__assign({ noScroll: noScroll, noContextMenu: noContextMenu, width: 0, height: 0, pixelRatio: 1 }, createEvents()), { dispose: noop });\r\n    }\r\n    InputObserver.create = create;\r\n    function fromElement(element, props) {\r\n        if (props === void 0) { props = {}; }\r\n        var _a = __assign(__assign({}, DefaultInputObserverProps), props), noScroll = _a.noScroll, noMiddleClickScroll = _a.noMiddleClickScroll, noContextMenu = _a.noContextMenu, noPinchZoom = _a.noPinchZoom, noTextSelect = _a.noTextSelect, mask = _a.mask, pixelScale = _a.pixelScale, preventGestures = _a.preventGestures;\r\n        var width = element.clientWidth * pixelRatio();\r\n        var height = element.clientHeight * pixelRatio();\r\n        var lastTouchDistance = 0, lastTouchFraction = 0;\r\n        var pointerDown = Vec2();\r\n        var pointerStart = Vec2();\r\n        var pointerEnd = Vec2();\r\n        var pointerDelta = Vec2();\r\n        var rectSize = Vec2();\r\n        var modifierKeys = {\r\n            shift: false,\r\n            alt: false,\r\n            control: false,\r\n            meta: false\r\n        };\r\n        function pixelRatio() {\r\n            return window.devicePixelRatio * pixelScale;\r\n        }\r\n        function getModifierKeys() {\r\n            return __assign({}, modifierKeys);\r\n        }\r\n        var dragging = 0 /* Stopped */;\r\n        var disposed = false;\r\n        var buttons = ButtonsType.create(0 /* None */);\r\n        var button = 0 /* None */;\r\n        var isInside = false;\r\n        var events = createEvents();\r\n        var drag = events.drag, interactionEnd = events.interactionEnd, wheel = events.wheel, pinch = events.pinch, gesture = events.gesture, click = events.click, move = events.move, leave = events.leave, enter = events.enter, resize = events.resize, modifiers = events.modifiers, key = events.key;\r\n        attach();\r\n        return __assign(__assign({ get noScroll() { return noScroll; },\r\n            set noScroll(value) { noScroll = value; },\r\n            get noContextMenu() { return noContextMenu; },\r\n            set noContextMenu(value) { noContextMenu = value; },\r\n            get width() { return width; },\r\n            get height() { return height; },\r\n            get pixelRatio() { return pixelRatio(); } }, events), { dispose: dispose });\r\n        function attach() {\r\n            element.addEventListener('contextmenu', onContextMenu, false);\r\n            element.addEventListener('wheel', onMouseWheel, false);\r\n            element.addEventListener('mousedown', onMouseDown, false);\r\n            // for dragging to work outside canvas bounds,\r\n            // mouse move/up events have to be added to a parent, i.e. window\r\n            window.addEventListener('mousemove', onMouseMove, false);\r\n            window.addEventListener('mouseup', onMouseUp, false);\r\n            element.addEventListener('mouseenter', onMouseEnter, false);\r\n            element.addEventListener('mouseleave', onMouseLeave, false);\r\n            element.addEventListener('touchstart', onTouchStart, false);\r\n            element.addEventListener('touchmove', onTouchMove, false);\r\n            element.addEventListener('touchend', onTouchEnd, false);\r\n            element.addEventListener('gesturechange', onGestureChange, false);\r\n            element.addEventListener('gesturestart', onGestureStart, false);\r\n            element.addEventListener('gestureend', onGestureEnd, false);\r\n            // reset buttons and modifier keys state when browser window looses focus\r\n            window.addEventListener('blur', handleBlur);\r\n            window.addEventListener('keyup', handleKeyUp, false);\r\n            window.addEventListener('keydown', handleKeyDown, false);\r\n            window.addEventListener('keypress', handleKeyPress, false);\r\n            window.addEventListener('resize', onResize, false);\r\n        }\r\n        function dispose() {\r\n            if (disposed)\r\n                return;\r\n            disposed = true;\r\n            element.removeEventListener('contextmenu', onContextMenu, false);\r\n            element.removeEventListener('wheel', onMouseWheel, false);\r\n            element.removeEventListener('mousedown', onMouseDown, false);\r\n            window.removeEventListener('mousemove', onMouseMove, false);\r\n            window.removeEventListener('mouseup', onMouseUp, false);\r\n            element.removeEventListener('mouseenter', onMouseEnter, false);\r\n            element.removeEventListener('mouseleave', onMouseLeave, false);\r\n            element.removeEventListener('touchstart', onTouchStart, false);\r\n            element.removeEventListener('touchmove', onTouchMove, false);\r\n            element.removeEventListener('touchend', onTouchEnd, false);\r\n            element.removeEventListener('gesturechange', onGestureChange, false);\r\n            element.removeEventListener('gesturestart', onGestureStart, false);\r\n            element.removeEventListener('gestureend', onGestureEnd, false);\r\n            window.removeEventListener('blur', handleBlur);\r\n            window.removeEventListener('keyup', handleKeyUp, false);\r\n            window.removeEventListener('keydown', handleKeyDown, false);\r\n            window.removeEventListener('keypress', handleKeyPress, false);\r\n            window.removeEventListener('resize', onResize, false);\r\n        }\r\n        function onContextMenu(event) {\r\n            if (!mask(event.clientX, event.clientY))\r\n                return;\r\n            if (noContextMenu) {\r\n                event.preventDefault();\r\n            }\r\n        }\r\n        function updateModifierKeys(event) {\r\n            modifierKeys.alt = event.altKey;\r\n            modifierKeys.shift = event.shiftKey;\r\n            modifierKeys.control = event.ctrlKey;\r\n            modifierKeys.meta = event.metaKey;\r\n        }\r\n        function handleBlur() {\r\n            if (buttons || modifierKeys.shift || modifierKeys.alt || modifierKeys.meta || modifierKeys.control) {\r\n                buttons = 0;\r\n                modifierKeys.shift = modifierKeys.alt = modifierKeys.control = modifierKeys.meta = false;\r\n            }\r\n        }\r\n        function handleKeyDown(event) {\r\n            var changed = false;\r\n            if (!modifierKeys.alt && event.altKey) {\r\n                changed = true;\r\n                modifierKeys.alt = true;\r\n            }\r\n            if (!modifierKeys.shift && event.shiftKey) {\r\n                changed = true;\r\n                modifierKeys.shift = true;\r\n            }\r\n            if (!modifierKeys.control && event.ctrlKey) {\r\n                changed = true;\r\n                modifierKeys.control = true;\r\n            }\r\n            if (!modifierKeys.meta && event.metaKey) {\r\n                changed = true;\r\n                modifierKeys.meta = true;\r\n            }\r\n            if (changed && isInside)\r\n                modifiers.next(getModifierKeys());\r\n        }\r\n        function handleKeyUp(event) {\r\n            var changed = false;\r\n            if (modifierKeys.alt && !event.altKey) {\r\n                changed = true;\r\n                modifierKeys.alt = false;\r\n            }\r\n            if (modifierKeys.shift && !event.shiftKey) {\r\n                changed = true;\r\n                modifierKeys.shift = false;\r\n            }\r\n            if (modifierKeys.control && !event.ctrlKey) {\r\n                changed = true;\r\n                modifierKeys.control = false;\r\n            }\r\n            if (modifierKeys.meta && !event.metaKey) {\r\n                changed = true;\r\n                modifierKeys.meta = false;\r\n            }\r\n            if (changed && isInside)\r\n                modifiers.next(getModifierKeys());\r\n            if (AllowedNonPrintableKeys.includes(event.key))\r\n                handleKeyPress(event);\r\n        }\r\n        function handleKeyPress(event) {\r\n            key.next({\r\n                key: event.key,\r\n                modifiers: getModifierKeys()\r\n            });\r\n        }\r\n        function getCenterTouch(ev) {\r\n            var t0 = ev.touches[0];\r\n            var t1 = ev.touches[1];\r\n            return {\r\n                clientX: (t0.clientX + t1.clientX) / 2,\r\n                clientY: (t0.clientY + t1.clientY) / 2,\r\n                pageX: (t0.pageX + t1.pageX) / 2,\r\n                pageY: (t0.pageY + t1.pageY) / 2\r\n            };\r\n        }\r\n        function getTouchDistance(ev) {\r\n            var dx = ev.touches[0].pageX - ev.touches[1].pageX;\r\n            var dy = ev.touches[0].pageY - ev.touches[1].pageY;\r\n            return Math.sqrt(dx * dx + dy * dy);\r\n        }\r\n        function onTouchStart(ev) {\r\n            ev.preventDefault();\r\n            if (ev.touches.length === 1) {\r\n                buttons = button = 1 /* Primary */;\r\n                onPointerDown(ev.touches[0]);\r\n            }\r\n            else if (ev.touches.length === 2) {\r\n                buttons = 2 /* Secondary */ & 4 /* Auxilary */;\r\n                button = 2 /* Secondary */;\r\n                onPointerDown(getCenterTouch(ev));\r\n                var touchDistance = getTouchDistance(ev);\r\n                lastTouchDistance = touchDistance;\r\n                pinch.next({\r\n                    distance: touchDistance,\r\n                    fraction: 1,\r\n                    fractionDelta: 0,\r\n                    delta: 0,\r\n                    isStart: true,\r\n                    buttons: buttons,\r\n                    button: button,\r\n                    modifiers: getModifierKeys()\r\n                });\r\n            }\r\n            else if (ev.touches.length === 3) {\r\n                buttons = button = 8 /* Forth */;\r\n                onPointerDown(getCenterTouch(ev));\r\n            }\r\n        }\r\n        function onTouchEnd(ev) {\r\n            endDrag();\r\n        }\r\n        function onTouchMove(ev) {\r\n            button = 0 /* None */;\r\n            if (noPinchZoom) {\r\n                ev.preventDefault();\r\n                ev.stopPropagation();\r\n                if (ev.originalEvent) {\r\n                    ev.originalEvent.preventDefault();\r\n                    ev.originalEvent.stopPropagation();\r\n                }\r\n            }\r\n            if (ev.touches.length === 1) {\r\n                buttons = 1 /* Primary */;\r\n                onPointerMove(ev.touches[0]);\r\n            }\r\n            else if (ev.touches.length === 2) {\r\n                var touchDistance = getTouchDistance(ev);\r\n                var touchDelta = lastTouchDistance - touchDistance;\r\n                if (Math.abs(touchDelta) < 4) {\r\n                    buttons = 2 /* Secondary */;\r\n                    onPointerMove(getCenterTouch(ev));\r\n                }\r\n                else {\r\n                    buttons = 4 /* Auxilary */;\r\n                    updateModifierKeys(ev);\r\n                    var fraction = lastTouchDistance / touchDistance;\r\n                    pinch.next({\r\n                        delta: touchDelta,\r\n                        fraction: fraction,\r\n                        fractionDelta: lastTouchFraction - fraction,\r\n                        distance: touchDistance,\r\n                        isStart: false,\r\n                        buttons: buttons,\r\n                        button: button,\r\n                        modifiers: getModifierKeys()\r\n                    });\r\n                    lastTouchFraction = fraction;\r\n                }\r\n                lastTouchDistance = touchDistance;\r\n            }\r\n            else if (ev.touches.length === 3) {\r\n                buttons = 8 /* Forth */;\r\n                onPointerMove(getCenterTouch(ev));\r\n            }\r\n        }\r\n        function onMouseDown(ev) {\r\n            updateModifierKeys(ev);\r\n            buttons = getButtons(ev);\r\n            button = getButton(ev);\r\n            if (noMiddleClickScroll && buttons === 4 /* Auxilary */) {\r\n                ev.preventDefault;\r\n            }\r\n            onPointerDown(ev);\r\n        }\r\n        function onMouseMove(ev) {\r\n            updateModifierKeys(ev);\r\n            buttons = getButtons(ev);\r\n            button = 0 /* None */;\r\n            onPointerMove(ev);\r\n        }\r\n        function onMouseUp(ev) {\r\n            updateModifierKeys(ev);\r\n            buttons = getButtons(ev);\r\n            button = getButton(ev);\r\n            onPointerUp(ev);\r\n            endDrag();\r\n        }\r\n        function endDrag() {\r\n            interactionEnd.next(void 0);\r\n        }\r\n        function onPointerDown(ev) {\r\n            if (!mask(ev.clientX, ev.clientY))\r\n                return;\r\n            eventOffset(pointerStart, ev);\r\n            Vec2.copy(pointerDown, pointerStart);\r\n            if (insideBounds(pointerStart)) {\r\n                dragging = 1 /* Started */;\r\n            }\r\n        }\r\n        function onPointerUp(ev) {\r\n            dragging = 0 /* Stopped */;\r\n            if (!mask(ev.clientX, ev.clientY))\r\n                return;\r\n            eventOffset(pointerEnd, ev);\r\n            if (Vec2.distance(pointerEnd, pointerDown) < 4) {\r\n                var pageX = ev.pageX, pageY = ev.pageY;\r\n                var x = pointerEnd[0], y = pointerEnd[1];\r\n                click.next({ x: x, y: y, pageX: pageX, pageY: pageY, buttons: buttons, button: button, modifiers: getModifierKeys() });\r\n            }\r\n        }\r\n        function onPointerMove(ev) {\r\n            var _a;\r\n            eventOffset(pointerEnd, ev);\r\n            var pageX = ev.pageX, pageY = ev.pageY;\r\n            var x = pointerEnd[0], y = pointerEnd[1];\r\n            var inside = insideBounds(pointerEnd);\r\n            move.next({ x: x, y: y, pageX: pageX, pageY: pageY, buttons: buttons, button: button, modifiers: getModifierKeys(), inside: inside });\r\n            if (dragging === 0 /* Stopped */)\r\n                return;\r\n            if (noTextSelect) {\r\n                (_a = ev.preventDefault) === null || _a === void 0 ? void 0 : _a.call(ev);\r\n            }\r\n            Vec2.div(pointerDelta, Vec2.sub(pointerDelta, pointerEnd, pointerStart), getClientSize(rectSize));\r\n            if (Vec2.magnitude(pointerDelta) < EPSILON)\r\n                return;\r\n            var isStart = dragging === 1 /* Started */;\r\n            if (isStart && !mask(ev.clientX, ev.clientY))\r\n                return;\r\n            var dx = pointerDelta[0], dy = pointerDelta[1];\r\n            drag.next({ x: x, y: y, dx: dx, dy: dy, pageX: pageX, pageY: pageY, buttons: buttons, button: button, modifiers: getModifierKeys(), isStart: isStart });\r\n            Vec2.copy(pointerStart, pointerEnd);\r\n            dragging = 2 /* Moving */;\r\n        }\r\n        function onMouseWheel(ev) {\r\n            if (!mask(ev.clientX, ev.clientY))\r\n                return;\r\n            eventOffset(pointerEnd, ev);\r\n            var pageX = ev.pageX, pageY = ev.pageY;\r\n            var x = pointerEnd[0], y = pointerEnd[1];\r\n            if (noScroll) {\r\n                ev.preventDefault();\r\n            }\r\n            var normalized = normalizeWheel(ev);\r\n            buttons = button = 4 /* Auxilary */;\r\n            if (normalized.dx || normalized.dy || normalized.dz) {\r\n                wheel.next(__assign(__assign({ x: x, y: y, pageX: pageX, pageY: pageY }, normalized), { buttons: buttons, button: button, modifiers: getModifierKeys() }));\r\n            }\r\n        }\r\n        function tryPreventGesture(ev) {\r\n            var _a, _b;\r\n            // console.log(ev, preventGestures);\r\n            if (!preventGestures)\r\n                return;\r\n            ev.preventDefault();\r\n            (_a = ev.stopImmediatePropagation) === null || _a === void 0 ? void 0 : _a.call(ev);\r\n            (_b = ev.stopPropagation) === null || _b === void 0 ? void 0 : _b.call(ev);\r\n        }\r\n        var prevGestureScale = 0, prevGestureRotation = 0;\r\n        function onGestureStart(ev) {\r\n            tryPreventGesture(ev);\r\n            prevGestureScale = ev.scale;\r\n            prevGestureRotation = ev.rotation;\r\n            gesture.next({ scale: ev.scale, rotation: ev.rotation, deltaRotation: 0, deltaScale: 0, isStart: true });\r\n        }\r\n        function gestureDelta(ev, isEnd) {\r\n            gesture.next({\r\n                scale: ev.scale,\r\n                rotation: ev.rotation,\r\n                deltaRotation: prevGestureRotation - ev.rotation,\r\n                deltaScale: prevGestureScale - ev.scale,\r\n                isEnd: isEnd\r\n            });\r\n            prevGestureRotation = ev.rotation;\r\n            prevGestureScale = ev.scale;\r\n        }\r\n        function onGestureChange(ev) {\r\n            tryPreventGesture(ev);\r\n            gestureDelta(ev);\r\n        }\r\n        function onGestureEnd(ev) {\r\n            tryPreventGesture(ev);\r\n            gestureDelta(ev, true);\r\n        }\r\n        function onMouseEnter(ev) {\r\n            isInside = true;\r\n            enter.next(void 0);\r\n        }\r\n        function onMouseLeave(ev) {\r\n            isInside = false;\r\n            leave.next(void 0);\r\n        }\r\n        function onResize(ev) {\r\n            resize.next({});\r\n        }\r\n        function insideBounds(pos) {\r\n            if (element instanceof Window || element instanceof Document || element === document.body) {\r\n                return true;\r\n            }\r\n            else {\r\n                var rect = element.getBoundingClientRect();\r\n                return pos[0] >= 0 && pos[1] >= 0 && pos[0] < rect.width && pos[1] < rect.height;\r\n            }\r\n        }\r\n        function getClientSize(out) {\r\n            out[0] = element.clientWidth;\r\n            out[1] = element.clientHeight;\r\n            return out;\r\n        }\r\n        function eventOffset(out, ev) {\r\n            width = element.clientWidth * pixelRatio();\r\n            height = element.clientHeight * pixelRatio();\r\n            var cx = ev.clientX || 0;\r\n            var cy = ev.clientY || 0;\r\n            var rect = element.getBoundingClientRect();\r\n            out[0] = cx - rect.left;\r\n            out[1] = cy - rect.top;\r\n            return out;\r\n        }\r\n    }\r\n    InputObserver.fromElement = fromElement;\r\n})(InputObserver || (InputObserver = {}));\r\n// Adapted from https://stackoverflow.com/a/30134826\r\n// License: https://creativecommons.org/licenses/by-sa/3.0/\r\nfunction normalizeWheel(event) {\r\n    // Reasonable defaults\r\n    var PIXEL_STEP = 10;\r\n    var LINE_HEIGHT = 40;\r\n    var PAGE_HEIGHT = 800;\r\n    var spinX = 0, spinY = 0, dx = 0, dy = 0, dz = 0; // pixelX, pixelY, pixelZ\r\n    // Legacy\r\n    if ('detail' in event) {\r\n        spinY = event.detail;\r\n    }\r\n    if ('wheelDelta' in event) {\r\n        spinY = -event.wheelDelta / 120;\r\n    }\r\n    if ('wheelDeltaY' in event) {\r\n        spinY = -event.wheelDeltaY / 120;\r\n    }\r\n    if ('wheelDeltaX' in event) {\r\n        spinX = -event.wheelDeltaX / 120;\r\n    }\r\n    // side scrolling on FF with DOMMouseScroll\r\n    if ('axis' in event && event.axis === event.HORIZONTAL_AXIS) {\r\n        spinX = spinY;\r\n        spinY = 0;\r\n    }\r\n    dx = spinX * PIXEL_STEP;\r\n    dy = spinY * PIXEL_STEP;\r\n    if ('deltaY' in event) {\r\n        dy = event.deltaY;\r\n    }\r\n    if ('deltaX' in event) {\r\n        dx = event.deltaX;\r\n    }\r\n    if ('deltaZ' in event) {\r\n        dz = event.deltaZ;\r\n    }\r\n    if ((dx || dy || dz) && event.deltaMode) {\r\n        if (event.deltaMode === 1) { // delta in LINE units\r\n            dx *= LINE_HEIGHT;\r\n            dy *= LINE_HEIGHT;\r\n            dz *= LINE_HEIGHT;\r\n        }\r\n        else { // delta in PAGE units\r\n            dx *= PAGE_HEIGHT;\r\n            dy *= PAGE_HEIGHT;\r\n            dz *= PAGE_HEIGHT;\r\n        }\r\n    }\r\n    // Fall-back if spin cannot be determined\r\n    if (dx && !spinX) {\r\n        spinX = (dx < 1) ? -1 : 1;\r\n    }\r\n    if (dy && !spinY) {\r\n        spinY = (dy < 1) ? -1 : 1;\r\n    }\r\n    return { spinX: spinX, spinY: spinY, dx: dx, dy: dy, dz: dz };\r\n}\r\nexport { InputObserver };\r\n//# sourceMappingURL=input-observer.js.map"]},"metadata":{},"sourceType":"module"}