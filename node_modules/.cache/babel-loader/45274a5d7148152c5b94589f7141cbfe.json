{"ast":null,"code":"/**\r\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { PluginStateObject as SO } from '../../../mol-plugin-state/objects';\nexport function registerDefault(ctx) {\n  SyncRepresentationToCanvas(ctx);\n  SyncStructureRepresentation3DState(ctx); // should be AFTER SyncRepresentationToCanvas\n\n  UpdateRepresentationVisibility(ctx);\n}\nexport function SyncRepresentationToCanvas(ctx) {\n  var events = ctx.state.data.events;\n  events.object.created.subscribe(function (e) {\n    var _a;\n\n    if (!SO.isRepresentation3D(e.obj)) return;\n    updateVisibility(e.state.cells.get(e.ref), e.obj.data.repr);\n    e.obj.data.repr.setState({\n      syncManually: true\n    });\n    (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.add(e.obj.data.repr);\n  });\n  events.object.updated.subscribe(function (e) {\n    var _a, _b;\n\n    if (e.oldObj && SO.isRepresentation3D(e.oldObj)) {\n      (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.remove(e.oldObj.data.repr);\n      e.oldObj.data.repr.destroy();\n    }\n\n    if (!SO.isRepresentation3D(e.obj)) {\n      return;\n    }\n\n    updateVisibility(e.state.cells.get(e.ref), e.obj.data.repr);\n\n    if (e.action === 'recreate') {\n      e.obj.data.repr.setState({\n        syncManually: true\n      });\n    }\n\n    (_b = ctx.canvas3d) === null || _b === void 0 ? void 0 : _b.add(e.obj.data.repr);\n  });\n  events.object.removed.subscribe(function (e) {\n    var _a;\n\n    if (!SO.isRepresentation3D(e.obj)) return;\n    (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.remove(e.obj.data.repr);\n    e.obj.data.repr.destroy();\n  });\n}\nexport function SyncStructureRepresentation3DState(ctx) {\n  // TODO: figure out how to do transform composition here?\n  var events = ctx.state.data.events;\n  events.object.created.subscribe(function (e) {\n    var _a;\n\n    if (!SO.Molecule.Structure.Representation3DState.is(e.obj)) return;\n    var data = e.obj.data;\n    data.repr.setState(data.state);\n    (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.update(data.repr);\n  });\n  events.object.updated.subscribe(function (e) {\n    var _a;\n\n    if (!SO.Molecule.Structure.Representation3DState.is(e.obj)) return;\n    var data = e.obj.data;\n    data.repr.setState(data.state);\n    (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.update(data.repr);\n  });\n  events.object.removed.subscribe(function (e) {\n    var _a;\n\n    if (!SO.Molecule.Structure.Representation3DState.is(e.obj)) return;\n    var data = e.obj.data;\n    data.repr.setState(data.initialState);\n    (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.update(data.repr);\n  });\n}\nexport function UpdateRepresentationVisibility(ctx) {\n  ctx.state.data.events.cell.stateUpdated.subscribe(function (e) {\n    var _a;\n\n    var cell = e.state.cells.get(e.ref);\n    if (!SO.isRepresentation3D(cell.obj)) return;\n\n    if (updateVisibility(cell, cell.obj.data.repr)) {\n      (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.syncVisibility();\n    }\n  });\n}\n\nfunction updateVisibility(cell, r) {\n  if (r.state.visible === cell.state.isHidden) {\n    r.setState({\n      visible: !cell.state.isHidden\n    });\n    return true;\n  } else {\n    return false;\n  }\n}","map":{"version":3,"sources":["../../../../src/mol-plugin/behavior/static/representation.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { PluginStateObject as SO } from '../../../mol-plugin-state/objects';\r\nexport function registerDefault(ctx) {\r\n    SyncRepresentationToCanvas(ctx);\r\n    SyncStructureRepresentation3DState(ctx); // should be AFTER SyncRepresentationToCanvas\r\n    UpdateRepresentationVisibility(ctx);\r\n}\r\nexport function SyncRepresentationToCanvas(ctx) {\r\n    var events = ctx.state.data.events;\r\n    events.object.created.subscribe(function (e) {\r\n        var _a;\r\n        if (!SO.isRepresentation3D(e.obj))\r\n            return;\r\n        updateVisibility(e.state.cells.get(e.ref), e.obj.data.repr);\r\n        e.obj.data.repr.setState({ syncManually: true });\r\n        (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.add(e.obj.data.repr);\r\n    });\r\n    events.object.updated.subscribe(function (e) {\r\n        var _a, _b;\r\n        if (e.oldObj && SO.isRepresentation3D(e.oldObj)) {\r\n            (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.remove(e.oldObj.data.repr);\r\n            e.oldObj.data.repr.destroy();\r\n        }\r\n        if (!SO.isRepresentation3D(e.obj)) {\r\n            return;\r\n        }\r\n        updateVisibility(e.state.cells.get(e.ref), e.obj.data.repr);\r\n        if (e.action === 'recreate') {\r\n            e.obj.data.repr.setState({ syncManually: true });\r\n        }\r\n        (_b = ctx.canvas3d) === null || _b === void 0 ? void 0 : _b.add(e.obj.data.repr);\r\n    });\r\n    events.object.removed.subscribe(function (e) {\r\n        var _a;\r\n        if (!SO.isRepresentation3D(e.obj))\r\n            return;\r\n        (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.remove(e.obj.data.repr);\r\n        e.obj.data.repr.destroy();\r\n    });\r\n}\r\nexport function SyncStructureRepresentation3DState(ctx) {\r\n    // TODO: figure out how to do transform composition here?\r\n    var events = ctx.state.data.events;\r\n    events.object.created.subscribe(function (e) {\r\n        var _a;\r\n        if (!SO.Molecule.Structure.Representation3DState.is(e.obj))\r\n            return;\r\n        var data = e.obj.data;\r\n        data.repr.setState(data.state);\r\n        (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.update(data.repr);\r\n    });\r\n    events.object.updated.subscribe(function (e) {\r\n        var _a;\r\n        if (!SO.Molecule.Structure.Representation3DState.is(e.obj))\r\n            return;\r\n        var data = e.obj.data;\r\n        data.repr.setState(data.state);\r\n        (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.update(data.repr);\r\n    });\r\n    events.object.removed.subscribe(function (e) {\r\n        var _a;\r\n        if (!SO.Molecule.Structure.Representation3DState.is(e.obj))\r\n            return;\r\n        var data = e.obj.data;\r\n        data.repr.setState(data.initialState);\r\n        (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.update(data.repr);\r\n    });\r\n}\r\nexport function UpdateRepresentationVisibility(ctx) {\r\n    ctx.state.data.events.cell.stateUpdated.subscribe(function (e) {\r\n        var _a;\r\n        var cell = e.state.cells.get(e.ref);\r\n        if (!SO.isRepresentation3D(cell.obj))\r\n            return;\r\n        if (updateVisibility(cell, cell.obj.data.repr)) {\r\n            (_a = ctx.canvas3d) === null || _a === void 0 ? void 0 : _a.syncVisibility();\r\n        }\r\n    });\r\n}\r\nfunction updateVisibility(cell, r) {\r\n    if (r.state.visible === cell.state.isHidden) {\r\n        r.setState({ visible: !cell.state.isHidden });\r\n        return true;\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n}\r\n//# sourceMappingURL=representation.js.map"]},"metadata":{},"sourceType":"module"}