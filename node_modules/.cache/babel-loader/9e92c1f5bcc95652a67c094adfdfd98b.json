{"ast":null,"code":"/**\r\n * Copyright (c) 2019-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __assign } from \"tslib\";\nimport { Loci } from '../../mol-model/loci';\nimport { BoundaryHelper } from '../../mol-math/geometry/boundary-helper';\nimport { StructureElement } from '../../mol-model/structure'; // TODO: make this customizable somewhere?\n\nvar DefaultCameraFocusOptions = {\n  minRadius: 5,\n  extraRadius: 4,\n  durationMs: 250\n};\n\nvar CameraManager =\n/** @class */\nfunction () {\n  function CameraManager(plugin) {\n    this.plugin = plugin;\n    this.boundaryHelper = new BoundaryHelper('98');\n  }\n\n  CameraManager.prototype.transformedLoci = function (loci) {\n    var _a, _b;\n\n    if (StructureElement.Loci.is(loci)) {\n      // use decorated (including 3d transforms) parent structure\n      var parent_1 = (_b = (_a = this.plugin.helpers.substructureParent.get(loci.structure)) === null || _a === void 0 ? void 0 : _a.obj) === null || _b === void 0 ? void 0 : _b.data;\n      if (parent_1) loci = StructureElement.Loci.remap(loci, parent_1);\n    }\n\n    return loci;\n  };\n\n  CameraManager.prototype.focusRenderObjects = function (objects, options) {\n    if (!objects) return;\n    var spheres = [];\n\n    for (var _i = 0, objects_1 = objects; _i < objects_1.length; _i++) {\n      var o = objects_1[_i];\n      var s = o.values.boundingSphere.ref.value;\n      if (s.radius === 0) continue;\n      spheres.push(s);\n    }\n\n    this.focusSpheres(spheres, function (s) {\n      return s;\n    }, options);\n  };\n\n  CameraManager.prototype.focusLoci = function (loci, options) {\n    // TODO: allow computation of principal axes here?\n    // perhaps have an optimized function, that does exact axes small Loci and approximate/sampled from big ones?\n    var sphere;\n\n    if (Array.isArray(loci) && loci.length > 1) {\n      var spheres = [];\n\n      for (var _i = 0, loci_1 = loci; _i < loci_1.length; _i++) {\n        var l = loci_1[_i];\n        var s = Loci.getBoundingSphere(this.transformedLoci(l));\n        if (s) spheres.push(s);\n      }\n\n      if (spheres.length === 0) return;\n      this.boundaryHelper.reset();\n\n      for (var _a = 0, spheres_1 = spheres; _a < spheres_1.length; _a++) {\n        var s = spheres_1[_a];\n        this.boundaryHelper.includeSphere(s);\n      }\n\n      this.boundaryHelper.finishedIncludeStep();\n\n      for (var _b = 0, spheres_2 = spheres; _b < spheres_2.length; _b++) {\n        var s = spheres_2[_b];\n        this.boundaryHelper.radiusSphere(s);\n      }\n\n      sphere = this.boundaryHelper.getSphere();\n    } else if (Array.isArray(loci)) {\n      if (loci.length === 0) return;\n      sphere = Loci.getBoundingSphere(this.transformedLoci(loci[0]));\n    } else {\n      sphere = Loci.getBoundingSphere(this.transformedLoci(loci));\n    }\n\n    if (sphere) {\n      this.focusSphere(sphere, options);\n    }\n  };\n\n  CameraManager.prototype.focusSpheres = function (xs, sphere, options) {\n    var spheres = [];\n\n    for (var _i = 0, xs_1 = xs; _i < xs_1.length; _i++) {\n      var x = xs_1[_i];\n      var s = sphere(x);\n      if (s) spheres.push(s);\n    }\n\n    if (spheres.length === 0) return;\n    if (spheres.length === 1) return this.focusSphere(spheres[0], options);\n    this.boundaryHelper.reset();\n\n    for (var _a = 0, spheres_3 = spheres; _a < spheres_3.length; _a++) {\n      var s = spheres_3[_a];\n      this.boundaryHelper.includeSphere(s);\n    }\n\n    this.boundaryHelper.finishedIncludeStep();\n\n    for (var _b = 0, spheres_4 = spheres; _b < spheres_4.length; _b++) {\n      var s = spheres_4[_b];\n      this.boundaryHelper.radiusSphere(s);\n    }\n\n    this.focusSphere(this.boundaryHelper.getSphere(), options);\n  };\n\n  CameraManager.prototype.focusSphere = function (sphere, options) {\n    var _a, _b, _c, _d;\n\n    var _e = __assign(__assign({}, DefaultCameraFocusOptions), options),\n        extraRadius = _e.extraRadius,\n        minRadius = _e.minRadius,\n        durationMs = _e.durationMs;\n\n    var radius = Math.max(sphere.radius + extraRadius, minRadius);\n\n    if (options === null || options === void 0 ? void 0 : options.principalAxes) {\n      var _f = options === null || options === void 0 ? void 0 : options.principalAxes.boxAxes,\n          origin_1 = _f.origin,\n          dirA = _f.dirA,\n          dirC = _f.dirC;\n\n      var snapshot = (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.camera.getFocus(origin_1, radius, dirA, dirC);\n      (_b = this.plugin.canvas3d) === null || _b === void 0 ? void 0 : _b.requestCameraReset({\n        durationMs: durationMs,\n        snapshot: snapshot\n      }); // this.plugin.canvas3d?.camera.focus(origin, radius, durationMs, dirA, dirC);\n    } else {\n      var snapshot = (_c = this.plugin.canvas3d) === null || _c === void 0 ? void 0 : _c.camera.getFocus(sphere.center, radius);\n      (_d = this.plugin.canvas3d) === null || _d === void 0 ? void 0 : _d.requestCameraReset({\n        durationMs: durationMs,\n        snapshot: snapshot\n      }); // this.plugin.canvas3d?.camera.focus(sphere.center, radius, durationMs);\n    }\n  };\n\n  CameraManager.prototype.setSnapshot = function (snapshot, durationMs) {\n    var _a; // TODO: setState and requestCameraReset are very similar now: unify them?\n\n\n    (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.requestCameraReset({\n      snapshot: snapshot,\n      durationMs: durationMs\n    });\n  };\n\n  CameraManager.prototype.reset = function (snapshot, durationMs) {\n    var _a;\n\n    (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.requestCameraReset({\n      snapshot: snapshot,\n      durationMs: durationMs\n    });\n  };\n\n  return CameraManager;\n}();\n\nexport { CameraManager };","map":{"version":3,"sources":["../../../src/mol-plugin-state/manager/camera.ts"],"names":[],"mappings":"AAAA;;;;;AAKG;;AAMH,SAAS,IAAT,QAAqB,sBAArB;AACA,SAAS,cAAT,QAA+B,yCAA/B;AAEA,SAAS,gBAAT,QAAiC,2BAAjC,C,CAEA;;AACA,IAAM,yBAAyB,GAAG;AAC9B,EAAA,SAAS,EAAE,CADmB;AAE9B,EAAA,WAAW,EAAE,CAFiB;AAG9B,EAAA,UAAU,EAAE;AAHkB,CAAlC;;AAQA,IAAA,aAAA;AAAA;AAAA,YAAA;AA6GI,WAAA,aAAA,CAAqB,MAArB,EAA0C;AAArB,SAAA,MAAA,GAAA,MAAA;AA5Gb,SAAA,cAAA,GAAiB,IAAI,cAAJ,CAAmB,IAAnB,CAAjB;AA6GP;;AA3GO,EAAA,aAAA,CAAA,SAAA,CAAA,eAAA,GAAR,UAAwB,IAAxB,EAAkC;;;AAC9B,QAAI,gBAAgB,CAAC,IAAjB,CAAsB,EAAtB,CAAyB,IAAzB,CAAJ,EAAoC;AAChC;AACA,UAAM,QAAM,GAAG,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,KAAK,MAAL,CAAY,OAAZ,CAAoB,kBAApB,CAAuC,GAAvC,CAA2C,IAAI,CAAC,SAAhD,CAAA,MAA0D,IAA1D,IAA0D,EAAA,KAAA,KAAA,CAA1D,GAA0D,KAAA,CAA1D,GAA0D,EAAA,CAAE,GAA5D,MAA+D,IAA/D,IAA+D,EAAA,KAAA,KAAA,CAA/D,GAA+D,KAAA,CAA/D,GAA+D,EAAA,CAAE,IAAhF;AACA,UAAI,QAAJ,EAAY,IAAI,GAAG,gBAAgB,CAAC,IAAjB,CAAsB,KAAtB,CAA4B,IAA5B,EAAkC,QAAlC,CAAP;AACf;;AACD,WAAO,IAAP;AACH,GAPO;;AASR,EAAA,aAAA,CAAA,SAAA,CAAA,kBAAA,GAAA,UAAmB,OAAnB,EAAkE,OAAlE,EAAuG;AACnG,QAAI,CAAC,OAAL,EAAc;AACd,QAAM,OAAO,GAAe,EAA5B;;AAEA,SAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,SAAA,GAAA,OAAhB,EAAgB,EAAA,GAAA,SAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAyB;AAApB,UAAM,CAAC,GAAA,SAAA,CAAA,EAAA,CAAP;AACD,UAAM,CAAC,GAAG,CAAC,CAAC,MAAF,CAAS,cAAT,CAAwB,GAAxB,CAA4B,KAAtC;AACA,UAAI,CAAC,CAAC,MAAF,KAAa,CAAjB,EAAoB;AACpB,MAAA,OAAO,CAAC,IAAR,CAAa,CAAb;AACH;;AAED,SAAK,YAAL,CAAkB,OAAlB,EAA2B,UAAA,CAAA,EAAC;AAAI,aAAA,CAAA;AAAC,KAAjC,EAAmC,OAAnC;AACH,GAXD;;AAaA,EAAA,aAAA,CAAA,SAAA,CAAA,SAAA,GAAA,UAAU,IAAV,EAA+B,OAA/B,EAAoE;AAChE;AACA;AAEA,QAAI,MAAJ;;AAEA,QAAI,KAAK,CAAC,OAAN,CAAc,IAAd,KAAuB,IAAI,CAAC,MAAL,GAAc,CAAzC,EAA4C;AACxC,UAAM,OAAO,GAAG,EAAhB;;AACA,WAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,MAAA,GAAA,IAAhB,EAAgB,EAAA,GAAA,MAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAsB;AAAjB,YAAM,CAAC,GAAA,MAAA,CAAA,EAAA,CAAP;AACD,YAAM,CAAC,GAAG,IAAI,CAAC,iBAAL,CAAuB,KAAK,eAAL,CAAqB,CAArB,CAAvB,CAAV;AACA,YAAI,CAAJ,EAAO,OAAO,CAAC,IAAR,CAAa,CAAb;AACV;;AAED,UAAI,OAAO,CAAC,MAAR,KAAmB,CAAvB,EAA0B;AAE1B,WAAK,cAAL,CAAoB,KAApB;;AACA,WAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,SAAA,GAAA,OAAhB,EAAgB,EAAA,GAAA,SAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAyB;AAApB,YAAM,CAAC,GAAA,SAAA,CAAA,EAAA,CAAP;AACD,aAAK,cAAL,CAAoB,aAApB,CAAkC,CAAlC;AACH;;AACD,WAAK,cAAL,CAAoB,mBAApB;;AACA,WAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,SAAA,GAAA,OAAhB,EAAgB,EAAA,GAAA,SAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAyB;AAApB,YAAM,CAAC,GAAA,SAAA,CAAA,EAAA,CAAP;AACD,aAAK,cAAL,CAAoB,YAApB,CAAiC,CAAjC;AACH;;AACD,MAAA,MAAM,GAAG,KAAK,cAAL,CAAoB,SAApB,EAAT;AACH,KAlBD,MAkBO,IAAI,KAAK,CAAC,OAAN,CAAc,IAAd,CAAJ,EAAyB;AAC5B,UAAI,IAAI,CAAC,MAAL,KAAgB,CAApB,EAAuB;AACvB,MAAA,MAAM,GAAG,IAAI,CAAC,iBAAL,CAAuB,KAAK,eAAL,CAAqB,IAAI,CAAC,CAAD,CAAzB,CAAvB,CAAT;AACH,KAHM,MAGA;AACH,MAAA,MAAM,GAAG,IAAI,CAAC,iBAAL,CAAuB,KAAK,eAAL,CAAqB,IAArB,CAAvB,CAAT;AACH;;AAED,QAAI,MAAJ,EAAY;AACR,WAAK,WAAL,CAAiB,MAAjB,EAAyB,OAAzB;AACH;AACJ,GAlCD;;AAoCA,EAAA,aAAA,CAAA,SAAA,CAAA,YAAA,GAAA,UAAgB,EAAhB,EAAsC,MAAtC,EAA8E,OAA9E,EAAmH;AAC/G,QAAM,OAAO,GAAG,EAAhB;;AAEA,SAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,IAAA,GAAA,EAAhB,EAAgB,EAAA,GAAA,IAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAoB;AAAf,UAAM,CAAC,GAAA,IAAA,CAAA,EAAA,CAAP;AACD,UAAM,CAAC,GAAG,MAAM,CAAC,CAAD,CAAhB;AACA,UAAI,CAAJ,EAAO,OAAO,CAAC,IAAR,CAAa,CAAb;AACV;;AAED,QAAI,OAAO,CAAC,MAAR,KAAmB,CAAvB,EAA0B;AAC1B,QAAI,OAAO,CAAC,MAAR,KAAmB,CAAvB,EAA0B,OAAO,KAAK,WAAL,CAAiB,OAAO,CAAC,CAAD,CAAxB,EAA6B,OAA7B,CAAP;AAE1B,SAAK,cAAL,CAAoB,KAApB;;AACA,SAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,SAAA,GAAA,OAAhB,EAAgB,EAAA,GAAA,SAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAyB;AAApB,UAAM,CAAC,GAAA,SAAA,CAAA,EAAA,CAAP;AACD,WAAK,cAAL,CAAoB,aAApB,CAAkC,CAAlC;AACH;;AACD,SAAK,cAAL,CAAoB,mBAApB;;AACA,SAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,SAAA,GAAA,OAAhB,EAAgB,EAAA,GAAA,SAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAyB;AAApB,UAAM,CAAC,GAAA,SAAA,CAAA,EAAA,CAAP;AACD,WAAK,cAAL,CAAoB,YAApB,CAAiC,CAAjC;AACH;;AACD,SAAK,WAAL,CAAiB,KAAK,cAAL,CAAoB,SAApB,EAAjB,EAAkD,OAAlD;AACH,GApBD;;AAsBA,EAAA,aAAA,CAAA,SAAA,CAAA,WAAA,GAAA,UAAY,MAAZ,EAA8B,OAA9B,EAAuG;;;AAC7F,QAAA,EAAA,GAAA,QAAA,CAAA,QAAA,CAAA,EAAA,EAA8C,yBAA9C,CAAA,EAA4E,OAA5E,CAAA;AAAA,QAAE,WAAW,GAAA,EAAA,CAAA,WAAb;AAAA,QAAe,SAAS,GAAA,EAAA,CAAA,SAAxB;AAAA,QAA0B,UAAU,GAAA,EAAA,CAAA,UAApC;;AACN,QAAM,MAAM,GAAG,IAAI,CAAC,GAAL,CAAS,MAAM,CAAC,MAAP,GAAgB,WAAzB,EAAsC,SAAtC,CAAf;;AAEA,QAAI,OAAO,KAAA,IAAP,IAAA,OAAO,KAAA,KAAA,CAAP,GAAO,KAAA,CAAP,GAAA,OAAO,CAAE,aAAb,EAA4B;AAClB,UAAA,EAAA,GAAyB,OAAO,KAAA,IAAP,IAAA,OAAO,KAAA,KAAA,CAAP,GAAO,KAAA,CAAP,GAAA,OAAO,CAAE,aAAT,CAAuB,OAAhD;AAAA,UAAE,QAAM,GAAA,EAAA,CAAA,MAAR;AAAA,UAAU,IAAI,GAAA,EAAA,CAAA,IAAd;AAAA,UAAgB,IAAI,GAAA,EAAA,CAAA,IAApB;;AACN,UAAM,QAAQ,GAAG,CAAA,EAAA,GAAA,KAAK,MAAL,CAAY,QAAZ,MAAoB,IAApB,IAAoB,EAAA,KAAA,KAAA,CAApB,GAAoB,KAAA,CAApB,GAAoB,EAAA,CAAE,MAAF,CAAS,QAAT,CAAkB,QAAlB,EAA0B,MAA1B,EAAkC,IAAlC,EAAwC,IAAxC,CAArC;AACA,OAAA,EAAA,GAAA,KAAK,MAAL,CAAY,QAAZ,MAAoB,IAApB,IAAoB,EAAA,KAAA,KAAA,CAApB,GAAoB,KAAA,CAApB,GAAoB,EAAA,CAAE,kBAAF,CAAqB;AAAE,QAAA,UAAU,EAAA,UAAZ;AAAc,QAAA,QAAQ,EAAA;AAAtB,OAArB,CAApB,CAHwB,CAIxB;AACH,KALD,MAKO;AACH,UAAM,QAAQ,GAAG,CAAA,EAAA,GAAA,KAAK,MAAL,CAAY,QAAZ,MAAoB,IAApB,IAAoB,EAAA,KAAA,KAAA,CAApB,GAAoB,KAAA,CAApB,GAAoB,EAAA,CAAE,MAAF,CAAS,QAAT,CAAkB,MAAM,CAAC,MAAzB,EAAiC,MAAjC,CAArC;AACA,OAAA,EAAA,GAAA,KAAK,MAAL,CAAY,QAAZ,MAAoB,IAApB,IAAoB,EAAA,KAAA,KAAA,CAApB,GAAoB,KAAA,CAApB,GAAoB,EAAA,CAAE,kBAAF,CAAqB;AAAE,QAAA,UAAU,EAAA,UAAZ;AAAc,QAAA,QAAQ,EAAA;AAAtB,OAArB,CAApB,CAFG,CAIH;AACH;AACJ,GAfD;;AAiBA,EAAA,aAAA,CAAA,SAAA,CAAA,WAAA,GAAA,UAAY,QAAZ,EAAgD,UAAhD,EAAmE;WAAA,CAC/D;;;AACA,KAAA,EAAA,GAAA,KAAK,MAAL,CAAY,QAAZ,MAAoB,IAApB,IAAoB,EAAA,KAAA,KAAA,CAApB,GAAoB,KAAA,CAApB,GAAoB,EAAA,CAAE,kBAAF,CAAqB;AAAE,MAAA,QAAQ,EAAA,QAAV;AAAY,MAAA,UAAU,EAAA;AAAtB,KAArB,CAApB;AACH,GAHD;;AAKA,EAAA,aAAA,CAAA,SAAA,CAAA,KAAA,GAAA,UAAM,QAAN,EAA2C,UAA3C,EAA8D;;;AAC1D,KAAA,EAAA,GAAA,KAAK,MAAL,CAAY,QAAZ,MAAoB,IAApB,IAAoB,EAAA,KAAA,KAAA,CAApB,GAAoB,KAAA,CAApB,GAAoB,EAAA,CAAE,kBAAF,CAAqB;AAAE,MAAA,QAAQ,EAAA,QAAV;AAAY,MAAA,UAAU,EAAA;AAAtB,KAArB,CAApB;AACH,GAFD;;AAMJ,SAAA,aAAA;AAAC,CA/GD,EAAA","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2019-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __assign } from \"tslib\";\r\nimport { Loci } from '../../mol-model/loci';\r\nimport { BoundaryHelper } from '../../mol-math/geometry/boundary-helper';\r\nimport { StructureElement } from '../../mol-model/structure';\r\n// TODO: make this customizable somewhere?\r\nvar DefaultCameraFocusOptions = {\r\n    minRadius: 5,\r\n    extraRadius: 4,\r\n    durationMs: 250\r\n};\r\nvar CameraManager = /** @class */ (function () {\r\n    function CameraManager(plugin) {\r\n        this.plugin = plugin;\r\n        this.boundaryHelper = new BoundaryHelper('98');\r\n    }\r\n    CameraManager.prototype.transformedLoci = function (loci) {\r\n        var _a, _b;\r\n        if (StructureElement.Loci.is(loci)) {\r\n            // use decorated (including 3d transforms) parent structure\r\n            var parent_1 = (_b = (_a = this.plugin.helpers.substructureParent.get(loci.structure)) === null || _a === void 0 ? void 0 : _a.obj) === null || _b === void 0 ? void 0 : _b.data;\r\n            if (parent_1)\r\n                loci = StructureElement.Loci.remap(loci, parent_1);\r\n        }\r\n        return loci;\r\n    };\r\n    CameraManager.prototype.focusRenderObjects = function (objects, options) {\r\n        if (!objects)\r\n            return;\r\n        var spheres = [];\r\n        for (var _i = 0, objects_1 = objects; _i < objects_1.length; _i++) {\r\n            var o = objects_1[_i];\r\n            var s = o.values.boundingSphere.ref.value;\r\n            if (s.radius === 0)\r\n                continue;\r\n            spheres.push(s);\r\n        }\r\n        this.focusSpheres(spheres, function (s) { return s; }, options);\r\n    };\r\n    CameraManager.prototype.focusLoci = function (loci, options) {\r\n        // TODO: allow computation of principal axes here?\r\n        // perhaps have an optimized function, that does exact axes small Loci and approximate/sampled from big ones?\r\n        var sphere;\r\n        if (Array.isArray(loci) && loci.length > 1) {\r\n            var spheres = [];\r\n            for (var _i = 0, loci_1 = loci; _i < loci_1.length; _i++) {\r\n                var l = loci_1[_i];\r\n                var s = Loci.getBoundingSphere(this.transformedLoci(l));\r\n                if (s)\r\n                    spheres.push(s);\r\n            }\r\n            if (spheres.length === 0)\r\n                return;\r\n            this.boundaryHelper.reset();\r\n            for (var _a = 0, spheres_1 = spheres; _a < spheres_1.length; _a++) {\r\n                var s = spheres_1[_a];\r\n                this.boundaryHelper.includeSphere(s);\r\n            }\r\n            this.boundaryHelper.finishedIncludeStep();\r\n            for (var _b = 0, spheres_2 = spheres; _b < spheres_2.length; _b++) {\r\n                var s = spheres_2[_b];\r\n                this.boundaryHelper.radiusSphere(s);\r\n            }\r\n            sphere = this.boundaryHelper.getSphere();\r\n        }\r\n        else if (Array.isArray(loci)) {\r\n            if (loci.length === 0)\r\n                return;\r\n            sphere = Loci.getBoundingSphere(this.transformedLoci(loci[0]));\r\n        }\r\n        else {\r\n            sphere = Loci.getBoundingSphere(this.transformedLoci(loci));\r\n        }\r\n        if (sphere) {\r\n            this.focusSphere(sphere, options);\r\n        }\r\n    };\r\n    CameraManager.prototype.focusSpheres = function (xs, sphere, options) {\r\n        var spheres = [];\r\n        for (var _i = 0, xs_1 = xs; _i < xs_1.length; _i++) {\r\n            var x = xs_1[_i];\r\n            var s = sphere(x);\r\n            if (s)\r\n                spheres.push(s);\r\n        }\r\n        if (spheres.length === 0)\r\n            return;\r\n        if (spheres.length === 1)\r\n            return this.focusSphere(spheres[0], options);\r\n        this.boundaryHelper.reset();\r\n        for (var _a = 0, spheres_3 = spheres; _a < spheres_3.length; _a++) {\r\n            var s = spheres_3[_a];\r\n            this.boundaryHelper.includeSphere(s);\r\n        }\r\n        this.boundaryHelper.finishedIncludeStep();\r\n        for (var _b = 0, spheres_4 = spheres; _b < spheres_4.length; _b++) {\r\n            var s = spheres_4[_b];\r\n            this.boundaryHelper.radiusSphere(s);\r\n        }\r\n        this.focusSphere(this.boundaryHelper.getSphere(), options);\r\n    };\r\n    CameraManager.prototype.focusSphere = function (sphere, options) {\r\n        var _a, _b, _c, _d;\r\n        var _e = __assign(__assign({}, DefaultCameraFocusOptions), options), extraRadius = _e.extraRadius, minRadius = _e.minRadius, durationMs = _e.durationMs;\r\n        var radius = Math.max(sphere.radius + extraRadius, minRadius);\r\n        if (options === null || options === void 0 ? void 0 : options.principalAxes) {\r\n            var _f = options === null || options === void 0 ? void 0 : options.principalAxes.boxAxes, origin_1 = _f.origin, dirA = _f.dirA, dirC = _f.dirC;\r\n            var snapshot = (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.camera.getFocus(origin_1, radius, dirA, dirC);\r\n            (_b = this.plugin.canvas3d) === null || _b === void 0 ? void 0 : _b.requestCameraReset({ durationMs: durationMs, snapshot: snapshot });\r\n            // this.plugin.canvas3d?.camera.focus(origin, radius, durationMs, dirA, dirC);\r\n        }\r\n        else {\r\n            var snapshot = (_c = this.plugin.canvas3d) === null || _c === void 0 ? void 0 : _c.camera.getFocus(sphere.center, radius);\r\n            (_d = this.plugin.canvas3d) === null || _d === void 0 ? void 0 : _d.requestCameraReset({ durationMs: durationMs, snapshot: snapshot });\r\n            // this.plugin.canvas3d?.camera.focus(sphere.center, radius, durationMs);\r\n        }\r\n    };\r\n    CameraManager.prototype.setSnapshot = function (snapshot, durationMs) {\r\n        var _a;\r\n        // TODO: setState and requestCameraReset are very similar now: unify them?\r\n        (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.requestCameraReset({ snapshot: snapshot, durationMs: durationMs });\r\n    };\r\n    CameraManager.prototype.reset = function (snapshot, durationMs) {\r\n        var _a;\r\n        (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.requestCameraReset({ snapshot: snapshot, durationMs: durationMs });\r\n    };\r\n    return CameraManager;\r\n}());\r\nexport { CameraManager };\r\n//# sourceMappingURL=camera.js.map"]},"metadata":{},"sourceType":"module"}