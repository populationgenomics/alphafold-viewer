{"ast":null,"code":"/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __assign, __extends } from \"tslib\";\nimport { PluginBehavior } from '../../../behavior/behavior';\nimport { Structure, Model } from '../../../../mol-model/structure';\nimport { PluginStateObject } from '../../../../mol-plugin-state/objects';\nimport { StateSelection } from '../../../../mol-state';\nexport var StructureInfo = PluginBehavior.create({\n  name: 'structure-info-prop',\n  category: 'custom-props',\n  display: {\n    name: 'Structure Info'\n  },\n  ctor:\n  /** @class */\n  function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      return _super !== null && _super.apply(this, arguments) || this;\n    }\n\n    Object.defineProperty(class_1.prototype, \"maxModelIndex\", {\n      get: function () {\n        var _a, _b;\n\n        var maxIndex = -1;\n        var cells = this.ctx.state.data.select(StateSelection.Generators.rootsOfType(PluginStateObject.Molecule.Model));\n\n        for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\n          var c = cells_1[_i];\n          var index = ((_a = c.obj) === null || _a === void 0 ? void 0 : _a.data) && Model.Index.get((_b = c.obj) === null || _b === void 0 ? void 0 : _b.data).value;\n          if (index !== undefined && index > maxIndex) maxIndex = index;\n        }\n\n        return maxIndex;\n      },\n      enumerable: false,\n      configurable: true\n    });\n    Object.defineProperty(class_1.prototype, \"maxStructureIndex\", {\n      get: function () {\n        var _a, _b;\n\n        var maxIndex = -1;\n        var cells = this.ctx.state.data.select(StateSelection.Generators.rootsOfType(PluginStateObject.Molecule.Structure));\n\n        for (var _i = 0, cells_2 = cells; _i < cells_2.length; _i++) {\n          var c = cells_2[_i];\n          var index = ((_a = c.obj) === null || _a === void 0 ? void 0 : _a.data) && Structure.Index.get((_b = c.obj) === null || _b === void 0 ? void 0 : _b.data).value;\n          if (index !== undefined && index > maxIndex) maxIndex = index;\n        }\n\n        return maxIndex;\n      },\n      enumerable: false,\n      configurable: true\n    });\n    Object.defineProperty(class_1.prototype, \"asymIdOffset\", {\n      get: function () {\n        var _a;\n\n        var auth = 0;\n        var label = 0;\n        var cells = this.ctx.state.data.select(StateSelection.Generators.rootsOfType(PluginStateObject.Molecule.Model));\n\n        for (var _i = 0, cells_3 = cells; _i < cells_3.length; _i++) {\n          var c = cells_3[_i];\n          var m = (_a = c.obj) === null || _a === void 0 ? void 0 : _a.data;\n\n          if (m) {\n            var count = Model.AsymIdCount.get(m);\n            var offset = Model.AsymIdOffset.get(m).value;\n\n            if (count !== undefined && offset !== undefined) {\n              auth = Math.max(auth, offset.auth + count.auth);\n              label = Math.max(label, offset.label + count.label);\n            }\n          }\n        }\n\n        return {\n          auth: auth,\n          label: label\n        };\n      },\n      enumerable: false,\n      configurable: true\n    });\n\n    class_1.prototype.handleModel = function (model, oldModel) {\n      if (Model.Index.get(model).value === undefined) {\n        var oldIndex = oldModel && Model.Index.get(oldModel).value;\n        var value = oldIndex !== null && oldIndex !== void 0 ? oldIndex : this.maxModelIndex + 1;\n        Model.Index.set(model, {\n          value: value\n        });\n      }\n\n      if (Model.AsymIdOffset.get(model).value === undefined) {\n        var oldOffset = oldModel && Model.AsymIdOffset.get(oldModel).value;\n        var value = oldOffset !== null && oldOffset !== void 0 ? oldOffset : __assign({}, this.asymIdOffset);\n        Model.AsymIdOffset.set(model, {\n          value: value\n        });\n      }\n    };\n\n    class_1.prototype.handleStructure = function (structure, oldStructure) {\n      if (structure.parent !== undefined) return;\n      if (Structure.Index.get(structure).value !== undefined) return;\n      var oldIndex = oldStructure && Structure.Index.get(oldStructure).value;\n      var value = oldIndex !== null && oldIndex !== void 0 ? oldIndex : this.maxStructureIndex + 1;\n      Structure.Index.set(structure, {\n        value: value\n      });\n    };\n\n    class_1.prototype.handle = function (ref, obj, oldObj) {\n      if (PluginStateObject.Molecule.Structure.is(obj)) {\n        var transform = this.ctx.state.data.tree.transforms.get(ref);\n\n        if (!transform.transformer.definition.isDecorator && obj.data.parent === undefined) {\n          this.handleStructure(obj.data, oldObj === null || oldObj === void 0 ? void 0 : oldObj.data);\n        }\n      } else if (PluginStateObject.Molecule.Model.is(obj)) {\n        var transform = this.ctx.state.data.tree.transforms.get(ref);\n\n        if (!transform.transformer.definition.isDecorator) {\n          this.handleModel(obj.data, oldObj === null || oldObj === void 0 ? void 0 : oldObj.data);\n        }\n      }\n    };\n\n    class_1.prototype.register = function () {\n      var _this = this;\n\n      this.ctx.customModelProperties.register(Model.AsymIdOffset, true);\n      this.ctx.customModelProperties.register(Model.Index, true);\n      this.ctx.customStructureProperties.register(Structure.Index, true);\n      this.subscribeObservable(this.ctx.state.data.events.object.created, function (o) {\n        _this.handle(o.ref, o.obj);\n      });\n      this.subscribeObservable(this.ctx.state.data.events.object.updated, function (o) {\n        _this.handle(o.ref, o.obj, o.oldObj);\n      });\n    };\n\n    class_1.prototype.unregister = function () {\n      this.ctx.customModelProperties.unregister(Model.AsymIdOffset.descriptor.name);\n      this.ctx.customModelProperties.unregister(Model.Index.descriptor.name);\n      this.ctx.customStructureProperties.unregister(Structure.Index.descriptor.name);\n    };\n\n    return class_1;\n  }(PluginBehavior.Handler)\n});","map":{"version":3,"sources":["../../../../../src/mol-plugin/behavior/dynamic/custom-props/structure-info.ts"],"names":[],"mappings":"AAAA;;;;AAIG;;AAEH,SAAS,cAAT,QAA+B,4BAA/B;AACA,SAAS,SAAT,EAAoB,KAApB,QAAiC,iCAAjC;AACA,SAAS,iBAAT,QAAkC,sCAAlC;AACA,SAAS,cAAT,QAA4C,uBAA5C;AAEA,OAAO,IAAM,aAAa,GAAG,cAAc,CAAC,MAAf,CAAsB;AAC/C,EAAA,IAAI,EAAE,qBADyC;AAE/C,EAAA,QAAQ,EAAE,cAFqC;AAG/C,EAAA,OAAO,EAAE;AAAE,IAAA,IAAI,EAAE;AAAR,GAHsC;AAI/C,EAAA,IAAI;AAAA;AAAA,YAAA,MAAA,EAAA;AAAgB,IAAA,SAAA,CAAA,OAAA,EAAA,MAAA,CAAA;;AAAd,aAAA,OAAA,GAAA;;AA+FL;;AA9FG,IAAA,MAAA,CAAA,cAAA,CAAY,OAAA,CAAA,SAAZ,EAAY,eAAZ,EAAyB;WAAzB,YAAA;;;AACI,YAAI,QAAQ,GAAG,CAAC,CAAhB;AACA,YAAM,KAAK,GAAG,KAAK,GAAL,CAAS,KAAT,CAAe,IAAf,CAAoB,MAApB,CAA2B,cAAc,CAAC,UAAf,CAA0B,WAA1B,CAAsC,iBAAiB,CAAC,QAAlB,CAA2B,KAAjE,CAA3B,CAAd;;AACA,aAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,OAAA,GAAA,KAAhB,EAAgB,EAAA,GAAA,OAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAuB;AAAlB,cAAM,CAAC,GAAA,OAAA,CAAA,EAAA,CAAP;AACD,cAAM,KAAK,GAAG,CAAA,CAAA,EAAA,GAAA,CAAC,CAAC,GAAF,MAAK,IAAL,IAAK,EAAA,KAAA,KAAA,CAAL,GAAK,KAAA,CAAL,GAAK,EAAA,CAAE,IAAP,KAAe,KAAK,CAAC,KAAN,CAAY,GAAZ,CAAgB,CAAA,EAAA,GAAA,CAAC,CAAC,GAAF,MAAK,IAAL,IAAK,EAAA,KAAA,KAAA,CAAL,GAAK,KAAA,CAAL,GAAK,EAAA,CAAE,IAAvB,EAA6B,KAA1D;AACA,cAAI,KAAK,KAAK,SAAV,IAAuB,KAAK,GAAG,QAAnC,EAA6C,QAAQ,GAAG,KAAX;AAChD;;AACD,eAAO,QAAP;AACH,OARwB;uBAAA;;AAAA,KAAzB;AAUA,IAAA,MAAA,CAAA,cAAA,CAAY,OAAA,CAAA,SAAZ,EAAY,mBAAZ,EAA6B;WAA7B,YAAA;;;AACI,YAAI,QAAQ,GAAG,CAAC,CAAhB;AACA,YAAM,KAAK,GAAG,KAAK,GAAL,CAAS,KAAT,CAAe,IAAf,CAAoB,MAApB,CAA2B,cAAc,CAAC,UAAf,CAA0B,WAA1B,CAAsC,iBAAiB,CAAC,QAAlB,CAA2B,SAAjE,CAA3B,CAAd;;AACA,aAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,OAAA,GAAA,KAAhB,EAAgB,EAAA,GAAA,OAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAuB;AAAlB,cAAM,CAAC,GAAA,OAAA,CAAA,EAAA,CAAP;AACD,cAAM,KAAK,GAAG,CAAA,CAAA,EAAA,GAAA,CAAC,CAAC,GAAF,MAAK,IAAL,IAAK,EAAA,KAAA,KAAA,CAAL,GAAK,KAAA,CAAL,GAAK,EAAA,CAAE,IAAP,KAAe,SAAS,CAAC,KAAV,CAAgB,GAAhB,CAAoB,CAAA,EAAA,GAAA,CAAC,CAAC,GAAF,MAAK,IAAL,IAAK,EAAA,KAAA,KAAA,CAAL,GAAK,KAAA,CAAL,GAAK,EAAA,CAAE,IAA3B,EAAiC,KAA9D;AACA,cAAI,KAAK,KAAK,SAAV,IAAuB,KAAK,GAAG,QAAnC,EAA6C,QAAQ,GAAG,KAAX;AAChD;;AACD,eAAO,QAAP;AACH,OAR4B;uBAAA;;AAAA,KAA7B;AAUA,IAAA,MAAA,CAAA,cAAA,CAAY,OAAA,CAAA,SAAZ,EAAY,cAAZ,EAAwB;WAAxB,YAAA;;;AACI,YAAI,IAAI,GAAG,CAAX;AACA,YAAI,KAAK,GAAG,CAAZ;AACA,YAAM,KAAK,GAAG,KAAK,GAAL,CAAS,KAAT,CAAe,IAAf,CAAoB,MAApB,CAA2B,cAAc,CAAC,UAAf,CAA0B,WAA1B,CAAsC,iBAAiB,CAAC,QAAlB,CAA2B,KAAjE,CAA3B,CAAd;;AACA,aAAgB,IAAA,EAAA,GAAA,CAAA,EAAA,OAAA,GAAA,KAAhB,EAAgB,EAAA,GAAA,OAAA,CAAA,MAAhB,EAAgB,EAAA,EAAhB,EAAuB;AAAlB,cAAM,CAAC,GAAA,OAAA,CAAA,EAAA,CAAP;AACD,cAAM,CAAC,GAAG,CAAA,EAAA,GAAA,CAAC,CAAC,GAAF,MAAK,IAAL,IAAK,EAAA,KAAA,KAAA,CAAL,GAAK,KAAA,CAAL,GAAK,EAAA,CAAE,IAAjB;;AACA,cAAI,CAAJ,EAAO;AACH,gBAAM,KAAK,GAAG,KAAK,CAAC,WAAN,CAAkB,GAAlB,CAAsB,CAAtB,CAAd;AACA,gBAAM,MAAM,GAAG,KAAK,CAAC,YAAN,CAAmB,GAAnB,CAAuB,CAAvB,EAA0B,KAAzC;;AACA,gBAAI,KAAK,KAAK,SAAV,IAAuB,MAAM,KAAK,SAAtC,EAAiD;AAC7C,cAAA,IAAI,GAAG,IAAI,CAAC,GAAL,CAAS,IAAT,EAAe,MAAM,CAAC,IAAP,GAAc,KAAK,CAAC,IAAnC,CAAP;AACA,cAAA,KAAK,GAAG,IAAI,CAAC,GAAL,CAAS,KAAT,EAAgB,MAAM,CAAC,KAAP,GAAe,KAAK,CAAC,KAArC,CAAR;AACH;AACJ;AACJ;;AACD,eAAO;AAAE,UAAA,IAAI,EAAA,IAAN;AAAQ,UAAA,KAAK,EAAA;AAAb,SAAP;AACH,OAhBuB;uBAAA;;AAAA,KAAxB;;AAkBQ,IAAA,OAAA,CAAA,SAAA,CAAA,WAAA,GAAR,UAAoB,KAApB,EAAkC,QAAlC,EAAkD;AAC9C,UAAI,KAAK,CAAC,KAAN,CAAY,GAAZ,CAAgB,KAAhB,EAAuB,KAAvB,KAAiC,SAArC,EAAgD;AAC5C,YAAM,QAAQ,GAAG,QAAQ,IAAI,KAAK,CAAC,KAAN,CAAY,GAAZ,CAAgB,QAAhB,EAA0B,KAAvD;AACA,YAAM,KAAK,GAAG,QAAQ,KAAA,IAAR,IAAA,QAAQ,KAAA,KAAA,CAAR,GAAA,QAAA,GAAa,KAAK,aAAL,GAAqB,CAAhD;AACA,QAAA,KAAK,CAAC,KAAN,CAAY,GAAZ,CAAgB,KAAhB,EAAuB;AAAE,UAAA,KAAK,EAAA;AAAP,SAAvB;AACH;;AAED,UAAI,KAAK,CAAC,YAAN,CAAmB,GAAnB,CAAuB,KAAvB,EAA8B,KAA9B,KAAwC,SAA5C,EAAuD;AACnD,YAAM,SAAS,GAAG,QAAQ,IAAI,KAAK,CAAC,YAAN,CAAmB,GAAnB,CAAuB,QAAvB,EAAiC,KAA/D;AACA,YAAM,KAAK,GAAG,SAAS,KAAA,IAAT,IAAA,SAAS,KAAA,KAAA,CAAT,GAAA,SAAA,GAAS,QAAA,CAAA,EAAA,EAAS,KAAK,YAAd,CAAvB;AACA,QAAA,KAAK,CAAC,YAAN,CAAmB,GAAnB,CAAuB,KAAvB,EAA8B;AAAE,UAAA,KAAK,EAAA;AAAP,SAA9B;AACH;AACJ,KAZO;;AAcA,IAAA,OAAA,CAAA,SAAA,CAAA,eAAA,GAAR,UAAwB,SAAxB,EAA8C,YAA9C,EAAsE;AAClE,UAAI,SAAS,CAAC,MAAV,KAAqB,SAAzB,EAAoC;AACpC,UAAI,SAAS,CAAC,KAAV,CAAgB,GAAhB,CAAoB,SAApB,EAA+B,KAA/B,KAAyC,SAA7C,EAAwD;AAExD,UAAM,QAAQ,GAAG,YAAY,IAAI,SAAS,CAAC,KAAV,CAAgB,GAAhB,CAAoB,YAApB,EAAkC,KAAnE;AACA,UAAM,KAAK,GAAG,QAAQ,KAAA,IAAR,IAAA,QAAQ,KAAA,KAAA,CAAR,GAAA,QAAA,GAAa,KAAK,iBAAL,GAAyB,CAApD;AACA,MAAA,SAAS,CAAC,KAAV,CAAgB,GAAhB,CAAoB,SAApB,EAA+B;AAAE,QAAA,KAAK,EAAA;AAAP,OAA/B;AACH,KAPO;;AASA,IAAA,OAAA,CAAA,SAAA,CAAA,MAAA,GAAR,UAAe,GAAf,EAA4B,GAA5B,EAA0E,MAA1E,EAA0H;AACtH,UAAI,iBAAiB,CAAC,QAAlB,CAA2B,SAA3B,CAAqC,EAArC,CAAwC,GAAxC,CAAJ,EAAkD;AAC9C,YAAM,SAAS,GAAG,KAAK,GAAL,CAAS,KAAT,CAAe,IAAf,CAAoB,IAApB,CAAyB,UAAzB,CAAoC,GAApC,CAAwC,GAAxC,CAAlB;;AACA,YAAI,CAAC,SAAS,CAAC,WAAV,CAAsB,UAAtB,CAAiC,WAAlC,IAAiD,GAAG,CAAC,IAAJ,CAAS,MAAT,KAAoB,SAAzE,EAAoF;AAChF,eAAK,eAAL,CAAqB,GAAG,CAAC,IAAzB,EAA+B,MAAM,KAAA,IAAN,IAAA,MAAM,KAAA,KAAA,CAAN,GAAM,KAAA,CAAN,GAAA,MAAM,CAAE,IAAvC;AACH;AACJ,OALD,MAKO,IAAI,iBAAiB,CAAC,QAAlB,CAA2B,KAA3B,CAAiC,EAAjC,CAAoC,GAApC,CAAJ,EAA8C;AACjD,YAAM,SAAS,GAAG,KAAK,GAAL,CAAS,KAAT,CAAe,IAAf,CAAoB,IAApB,CAAyB,UAAzB,CAAoC,GAApC,CAAwC,GAAxC,CAAlB;;AACA,YAAI,CAAC,SAAS,CAAC,WAAV,CAAsB,UAAtB,CAAiC,WAAtC,EAAmD;AAC/C,eAAK,WAAL,CAAiB,GAAG,CAAC,IAArB,EAA2B,MAAM,KAAA,IAAN,IAAA,MAAM,KAAA,KAAA,CAAN,GAAM,KAAA,CAAN,GAAA,MAAM,CAAE,IAAnC;AACH;AACJ;AACJ,KAZO;;AAcR,IAAA,OAAA,CAAA,SAAA,CAAA,QAAA,GAAA,YAAA;AAAA,UAAA,KAAA,GAAA,IAAA;;AACI,WAAK,GAAL,CAAS,qBAAT,CAA+B,QAA/B,CAAwC,KAAK,CAAC,YAA9C,EAA4D,IAA5D;AACA,WAAK,GAAL,CAAS,qBAAT,CAA+B,QAA/B,CAAwC,KAAK,CAAC,KAA9C,EAAqD,IAArD;AACA,WAAK,GAAL,CAAS,yBAAT,CAAmC,QAAnC,CAA4C,SAAS,CAAC,KAAtD,EAA6D,IAA7D;AAEA,WAAK,mBAAL,CAAyB,KAAK,GAAL,CAAS,KAAT,CAAe,IAAf,CAAoB,MAApB,CAA2B,MAA3B,CAAkC,OAA3D,EAAoE,UAAA,CAAA,EAAC;AACjE,QAAA,KAAI,CAAC,MAAL,CAAY,CAAC,CAAC,GAAd,EAAmB,CAAC,CAAC,GAArB;AACH,OAFD;AAIA,WAAK,mBAAL,CAAyB,KAAK,GAAL,CAAS,KAAT,CAAe,IAAf,CAAoB,MAApB,CAA2B,MAA3B,CAAkC,OAA3D,EAAoE,UAAA,CAAA,EAAC;AACjE,QAAA,KAAI,CAAC,MAAL,CAAY,CAAC,CAAC,GAAd,EAAmB,CAAC,CAAC,GAArB,EAA0B,CAAC,CAAC,MAA5B;AACH,OAFD;AAGH,KAZD;;AAcA,IAAA,OAAA,CAAA,SAAA,CAAA,UAAA,GAAA,YAAA;AACI,WAAK,GAAL,CAAS,qBAAT,CAA+B,UAA/B,CAA0C,KAAK,CAAC,YAAN,CAAmB,UAAnB,CAA8B,IAAxE;AACA,WAAK,GAAL,CAAS,qBAAT,CAA+B,UAA/B,CAA0C,KAAK,CAAC,KAAN,CAAY,UAAZ,CAAuB,IAAjE;AACA,WAAK,GAAL,CAAS,yBAAT,CAAmC,UAAnC,CAA8C,SAAS,CAAC,KAAV,CAAgB,UAAhB,CAA2B,IAAzE;AACH,KAJD;;AAKJ,WAAA,OAAA;AAAC,GA/FG,CAAgB,cAAc,CAAC,OAA/B;AAJ2C,CAAtB,CAAtB","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __assign, __extends } from \"tslib\";\r\nimport { PluginBehavior } from '../../../behavior/behavior';\r\nimport { Structure, Model } from '../../../../mol-model/structure';\r\nimport { PluginStateObject } from '../../../../mol-plugin-state/objects';\r\nimport { StateSelection } from '../../../../mol-state';\r\nexport var StructureInfo = PluginBehavior.create({\r\n    name: 'structure-info-prop',\r\n    category: 'custom-props',\r\n    display: { name: 'Structure Info' },\r\n    ctor: /** @class */ (function (_super) {\r\n        __extends(class_1, _super);\r\n        function class_1() {\r\n            return _super !== null && _super.apply(this, arguments) || this;\r\n        }\r\n        Object.defineProperty(class_1.prototype, \"maxModelIndex\", {\r\n            get: function () {\r\n                var _a, _b;\r\n                var maxIndex = -1;\r\n                var cells = this.ctx.state.data.select(StateSelection.Generators.rootsOfType(PluginStateObject.Molecule.Model));\r\n                for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\r\n                    var c = cells_1[_i];\r\n                    var index = ((_a = c.obj) === null || _a === void 0 ? void 0 : _a.data) && Model.Index.get((_b = c.obj) === null || _b === void 0 ? void 0 : _b.data).value;\r\n                    if (index !== undefined && index > maxIndex)\r\n                        maxIndex = index;\r\n                }\r\n                return maxIndex;\r\n            },\r\n            enumerable: false,\r\n            configurable: true\r\n        });\r\n        Object.defineProperty(class_1.prototype, \"maxStructureIndex\", {\r\n            get: function () {\r\n                var _a, _b;\r\n                var maxIndex = -1;\r\n                var cells = this.ctx.state.data.select(StateSelection.Generators.rootsOfType(PluginStateObject.Molecule.Structure));\r\n                for (var _i = 0, cells_2 = cells; _i < cells_2.length; _i++) {\r\n                    var c = cells_2[_i];\r\n                    var index = ((_a = c.obj) === null || _a === void 0 ? void 0 : _a.data) && Structure.Index.get((_b = c.obj) === null || _b === void 0 ? void 0 : _b.data).value;\r\n                    if (index !== undefined && index > maxIndex)\r\n                        maxIndex = index;\r\n                }\r\n                return maxIndex;\r\n            },\r\n            enumerable: false,\r\n            configurable: true\r\n        });\r\n        Object.defineProperty(class_1.prototype, \"asymIdOffset\", {\r\n            get: function () {\r\n                var _a;\r\n                var auth = 0;\r\n                var label = 0;\r\n                var cells = this.ctx.state.data.select(StateSelection.Generators.rootsOfType(PluginStateObject.Molecule.Model));\r\n                for (var _i = 0, cells_3 = cells; _i < cells_3.length; _i++) {\r\n                    var c = cells_3[_i];\r\n                    var m = (_a = c.obj) === null || _a === void 0 ? void 0 : _a.data;\r\n                    if (m) {\r\n                        var count = Model.AsymIdCount.get(m);\r\n                        var offset = Model.AsymIdOffset.get(m).value;\r\n                        if (count !== undefined && offset !== undefined) {\r\n                            auth = Math.max(auth, offset.auth + count.auth);\r\n                            label = Math.max(label, offset.label + count.label);\r\n                        }\r\n                    }\r\n                }\r\n                return { auth: auth, label: label };\r\n            },\r\n            enumerable: false,\r\n            configurable: true\r\n        });\r\n        class_1.prototype.handleModel = function (model, oldModel) {\r\n            if (Model.Index.get(model).value === undefined) {\r\n                var oldIndex = oldModel && Model.Index.get(oldModel).value;\r\n                var value = oldIndex !== null && oldIndex !== void 0 ? oldIndex : (this.maxModelIndex + 1);\r\n                Model.Index.set(model, { value: value });\r\n            }\r\n            if (Model.AsymIdOffset.get(model).value === undefined) {\r\n                var oldOffset = oldModel && Model.AsymIdOffset.get(oldModel).value;\r\n                var value = oldOffset !== null && oldOffset !== void 0 ? oldOffset : __assign({}, this.asymIdOffset);\r\n                Model.AsymIdOffset.set(model, { value: value });\r\n            }\r\n        };\r\n        class_1.prototype.handleStructure = function (structure, oldStructure) {\r\n            if (structure.parent !== undefined)\r\n                return;\r\n            if (Structure.Index.get(structure).value !== undefined)\r\n                return;\r\n            var oldIndex = oldStructure && Structure.Index.get(oldStructure).value;\r\n            var value = oldIndex !== null && oldIndex !== void 0 ? oldIndex : (this.maxStructureIndex + 1);\r\n            Structure.Index.set(structure, { value: value });\r\n        };\r\n        class_1.prototype.handle = function (ref, obj, oldObj) {\r\n            if (PluginStateObject.Molecule.Structure.is(obj)) {\r\n                var transform = this.ctx.state.data.tree.transforms.get(ref);\r\n                if (!transform.transformer.definition.isDecorator && obj.data.parent === undefined) {\r\n                    this.handleStructure(obj.data, oldObj === null || oldObj === void 0 ? void 0 : oldObj.data);\r\n                }\r\n            }\r\n            else if (PluginStateObject.Molecule.Model.is(obj)) {\r\n                var transform = this.ctx.state.data.tree.transforms.get(ref);\r\n                if (!transform.transformer.definition.isDecorator) {\r\n                    this.handleModel(obj.data, oldObj === null || oldObj === void 0 ? void 0 : oldObj.data);\r\n                }\r\n            }\r\n        };\r\n        class_1.prototype.register = function () {\r\n            var _this = this;\r\n            this.ctx.customModelProperties.register(Model.AsymIdOffset, true);\r\n            this.ctx.customModelProperties.register(Model.Index, true);\r\n            this.ctx.customStructureProperties.register(Structure.Index, true);\r\n            this.subscribeObservable(this.ctx.state.data.events.object.created, function (o) {\r\n                _this.handle(o.ref, o.obj);\r\n            });\r\n            this.subscribeObservable(this.ctx.state.data.events.object.updated, function (o) {\r\n                _this.handle(o.ref, o.obj, o.oldObj);\r\n            });\r\n        };\r\n        class_1.prototype.unregister = function () {\r\n            this.ctx.customModelProperties.unregister(Model.AsymIdOffset.descriptor.name);\r\n            this.ctx.customModelProperties.unregister(Model.Index.descriptor.name);\r\n            this.ctx.customStructureProperties.unregister(Structure.Index.descriptor.name);\r\n        };\r\n        return class_1;\r\n    }(PluginBehavior.Handler))\r\n});\r\n//# sourceMappingURL=structure-info.js.map"]},"metadata":{},"sourceType":"module"}