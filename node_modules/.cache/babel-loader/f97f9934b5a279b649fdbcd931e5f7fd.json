{"ast":null,"code":"import { __assign, __extends, __spreadArray } from \"tslib\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { debounceTime, filter } from 'rxjs/operators';\nimport { PluginCommands } from '../../mol-plugin/commands';\nimport { StateObject, StateTransform } from '../../mol-state';\nimport { StateTreeSpine } from '../../mol-state/tree/spine';\nimport { PluginUIComponent } from '../base';\nimport { ActionMenu } from '../controls/action-menu';\nimport { Button, ControlGroup, IconButton } from '../controls/common';\nimport { Icon, HomeOutlinedSvg, ArrowRightSvg, ArrowDropDownSvg, DeleteOutlinedSvg, VisibilityOffOutlinedSvg, VisibilityOutlinedSvg, CloseSvg } from '../controls/icons';\nimport { ApplyActionControl } from './apply-action';\nimport { UpdateTransformControl } from './update-transform';\n\nvar StateTree =\n/** @class */\nfunction (_super) {\n  __extends(StateTree, _super);\n\n  function StateTree() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      showActions: true\n    };\n    return _this;\n  }\n\n  StateTree.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.state.events.cell.created, function (e) {\n      if (e.cell.transform.parent === StateTransform.RootRef) _this.forceUpdate();\n    });\n    this.subscribe(this.plugin.state.events.cell.removed, function (e) {\n      if (e.parent === StateTransform.RootRef) _this.forceUpdate();\n    });\n  };\n\n  StateTree.getDerivedStateFromProps = function (props, state) {\n    var n = props.state.tree.root.ref;\n    var children = props.state.tree.children.get(n);\n    var showActions = children.size === 0;\n    if (state.showActions === showActions) return null;\n    return {\n      showActions: showActions\n    };\n  };\n\n  StateTree.prototype.render = function () {\n    var ref = this.props.state.tree.root.ref;\n\n    if (this.state.showActions) {\n      return _jsxs(\"div\", __assign({\n        style: {\n          margin: '10px',\n          cursor: 'default'\n        }\n      }, {\n        children: [_jsx(\"p\", {\n          children: \"Nothing to see here yet.\"\n        }, void 0), _jsxs(\"p\", {\n          children: [\"Structures and Volumes can be loaded from the \", _jsx(Icon, {\n            svg: HomeOutlinedSvg\n          }, void 0), \" tab.\"]\n        }, void 0)]\n      }), void 0);\n    }\n\n    return _jsx(StateTreeNode, {\n      cell: this.props.state.cells.get(ref),\n      depth: 0\n    }, void 0);\n  };\n\n  return StateTree;\n}(PluginUIComponent);\n\nexport { StateTree };\n\nvar StateTreeNode =\n/** @class */\nfunction (_super) {\n  __extends(StateTreeNode, _super);\n\n  function StateTreeNode() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      isCollapsed: !!_this.props.cell.state.isCollapsed,\n      isNull: StateTreeNode.isNull(_this.props.cell),\n      showLabel: StateTreeNode.showLabel(_this.props.cell)\n    };\n    return _this;\n  }\n\n  StateTreeNode.prototype.is = function (e) {\n    return e.ref === this.ref && e.state === this.props.cell.parent;\n  };\n\n  Object.defineProperty(StateTreeNode.prototype, \"ref\", {\n    get: function () {\n      return this.props.cell.transform.ref;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateTreeNode.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.state.events.cell.stateUpdated, function (e) {\n      if (_this.props.cell === e.cell && _this.is(e) && e.state.cells.has(_this.ref)) {\n        if (_this.state.isCollapsed !== !!e.cell.state.isCollapsed || _this.state.isNull !== StateTreeNode.isNull(e.cell) || _this.state.showLabel !== StateTreeNode.showLabel(e.cell)) {\n          _this.forceUpdate();\n        }\n      }\n    });\n    this.subscribe(this.plugin.state.events.cell.created, function (e) {\n      if (_this.props.cell.parent === e.state && _this.ref === e.cell.transform.parent) {\n        _this.forceUpdate();\n      }\n    });\n    this.subscribe(this.plugin.state.events.cell.removed, function (e) {\n      if (_this.props.cell.parent === e.state && _this.ref === e.parent) {\n        _this.forceUpdate();\n      }\n    });\n  };\n\n  StateTreeNode.getDerivedStateFromProps = function (props, state) {\n    var isNull = StateTreeNode.isNull(props.cell);\n    var showLabel = StateTreeNode.showLabel(props.cell);\n    if (!!props.cell.state.isCollapsed === state.isCollapsed && state.isNull === isNull && state.showLabel === showLabel) return null;\n    return {\n      isCollapsed: !!props.cell.state.isCollapsed,\n      isNull: isNull,\n      showLabel: showLabel\n    };\n  };\n\n  StateTreeNode.hasDecorator = function (cell) {\n    var _a;\n\n    var children = cell.parent.tree.children.get(cell.transform.ref);\n    if (children.size !== 1) return false;\n    return !!((_a = cell.parent) === null || _a === void 0 ? void 0 : _a.tree.transforms.get(children.first()).transformer.definition.isDecorator);\n  };\n\n  StateTreeNode.isNull = function (cell) {\n    return !cell || !cell.parent || cell.obj === StateObject.Null || !cell.parent.tree.transforms.has(cell.transform.ref);\n  };\n\n  StateTreeNode.showLabel = function (cell) {\n    return cell.transform.ref !== StateTransform.RootRef && (cell.status !== 'ok' || !cell.state.isGhost && !StateTreeNode.hasDecorator(cell));\n  };\n\n  StateTreeNode.prototype.render = function () {\n    var _this = this;\n\n    if (this.state.isNull) {\n      return null;\n    }\n\n    var cell = this.props.cell;\n    var children = cell.parent.tree.children.get(this.ref);\n\n    if (!this.state.showLabel) {\n      if (children.size === 0) return null;\n      return _jsx(_Fragment, {\n        children: children.map(function (c) {\n          return _jsx(StateTreeNode, {\n            cell: cell.parent.cells.get(c),\n            depth: _this.props.depth\n          }, c);\n        })\n      }, void 0);\n    }\n\n    var newDepth = this.props.depth + 1;\n    return _jsxs(_Fragment, {\n      children: [_jsx(StateTreeNodeLabel, {\n        cell: cell,\n        depth: this.props.depth\n      }, void 0), children.size === 0 ? void 0 : _jsx(\"div\", __assign({\n        style: {\n          display: this.state.isCollapsed ? 'none' : 'block'\n        }\n      }, {\n        children: children.map(function (c) {\n          return _jsx(StateTreeNode, {\n            cell: cell.parent.cells.get(c),\n            depth: newDepth\n          }, c);\n        })\n      }), void 0)]\n    }, void 0);\n  };\n\n  return StateTreeNode;\n}(PluginUIComponent);\n\nvar StateTreeNodeLabel =\n/** @class */\nfunction (_super) {\n  __extends(StateTreeNodeLabel, _super);\n\n  function StateTreeNodeLabel() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      isCurrent: _this.props.cell.parent.current === _this.ref,\n      isCollapsed: !!_this.props.cell.state.isCollapsed,\n      action: void 0,\n      currentAction: void 0\n    };\n\n    _this.setCurrent = function (e) {\n      e === null || e === void 0 ? void 0 : e.preventDefault();\n      e === null || e === void 0 ? void 0 : e.currentTarget.blur();\n      PluginCommands.State.SetCurrentObject(_this.plugin, {\n        state: _this.props.cell.parent,\n        ref: _this.ref\n      });\n    };\n\n    _this.setCurrentRoot = function (e) {\n      e === null || e === void 0 ? void 0 : e.preventDefault();\n      e === null || e === void 0 ? void 0 : e.currentTarget.blur();\n      PluginCommands.State.SetCurrentObject(_this.plugin, {\n        state: _this.props.cell.parent,\n        ref: StateTransform.RootRef\n      });\n    };\n\n    _this.remove = function (e) {\n      e === null || e === void 0 ? void 0 : e.preventDefault();\n      PluginCommands.State.RemoveObject(_this.plugin, {\n        state: _this.props.cell.parent,\n        ref: _this.ref,\n        removeParentGhosts: true\n      });\n    };\n\n    _this.toggleVisible = function (e) {\n      e.preventDefault();\n      PluginCommands.State.ToggleVisibility(_this.plugin, {\n        state: _this.props.cell.parent,\n        ref: _this.ref\n      });\n      e.currentTarget.blur();\n    };\n\n    _this.toggleExpanded = function (e) {\n      e.preventDefault();\n      PluginCommands.State.ToggleExpanded(_this.plugin, {\n        state: _this.props.cell.parent,\n        ref: _this.ref\n      });\n      e.currentTarget.blur();\n    };\n\n    _this.highlight = function (e) {\n      e.preventDefault();\n      PluginCommands.Interactivity.Object.Highlight(_this.plugin, {\n        state: _this.props.cell.parent,\n        ref: _this.ref\n      });\n      e.currentTarget.blur();\n    };\n\n    _this.clearHighlight = function (e) {\n      e.preventDefault();\n      PluginCommands.Interactivity.ClearHighlights(_this.plugin);\n      e.currentTarget.blur();\n    };\n\n    _this.hideApply = function () {\n      _this.setCurrentRoot();\n    };\n\n    _this.selectAction = function (item) {\n      if (!item) return;\n      (item === null || item === void 0 ? void 0 : item.value)();\n    };\n\n    return _this;\n  }\n\n  StateTreeNodeLabel.prototype.is = function (e) {\n    return e.ref === this.ref && e.state === this.props.cell.parent;\n  };\n\n  Object.defineProperty(StateTreeNodeLabel.prototype, \"ref\", {\n    get: function () {\n      return this.props.cell.transform.ref;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateTreeNodeLabel.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(filter(function (e) {\n      return _this.is(e);\n    }), debounceTime(33)), function (e) {\n      _this.forceUpdate();\n    });\n    this.subscribe(this.props.cell.parent.behaviors.currentObject, function (e) {\n      if (!_this.is(e)) {\n        if (_this.state.isCurrent && e.state.transforms.has(_this.ref)) {\n          _this._setCurrent(_this.props.cell.parent.current === _this.ref, _this.state.isCollapsed);\n        }\n\n        return;\n      }\n\n      if (e.state.transforms.has(_this.ref)) {\n        _this._setCurrent(_this.props.cell.parent.current === _this.ref, !!_this.props.cell.state.isCollapsed);\n      }\n    });\n  };\n\n  StateTreeNodeLabel.prototype._setCurrent = function (isCurrent, isCollapsed) {\n    if (isCurrent) {\n      this.setState({\n        isCurrent: isCurrent,\n        action: 'options',\n        currentAction: void 0,\n        isCollapsed: isCollapsed\n      });\n    } else {\n      this.setState({\n        isCurrent: isCurrent,\n        action: void 0,\n        currentAction: void 0,\n        isCollapsed: isCollapsed\n      });\n    }\n  };\n\n  StateTreeNodeLabel.getDerivedStateFromProps = function (props, state) {\n    var isCurrent = props.cell.parent.current === props.cell.transform.ref;\n    var isCollapsed = !!props.cell.state.isCollapsed;\n    if (state.isCollapsed === isCollapsed && state.isCurrent === isCurrent) return null;\n    return {\n      isCurrent: isCurrent,\n      isCollapsed: isCollapsed,\n      action: void 0,\n      currentAction: void 0\n    };\n  };\n\n  Object.defineProperty(StateTreeNodeLabel.prototype, \"actions\", {\n    get: function () {\n      var _this = this;\n\n      var cell = this.props.cell;\n\n      var actions = __spreadArray([], cell.parent.actions.fromCell(cell, this.plugin), true);\n\n      if (actions.length === 0) return;\n      actions.sort(function (a, b) {\n        return a.definition.display.name < b.definition.display.name ? -1 : a.definition.display.name === b.definition.display.name ? 0 : 1;\n      });\n      return __spreadArray([ActionMenu.Header('Apply Action')], actions.map(function (a) {\n        return ActionMenu.Item(a.definition.display.name, function () {\n          return _this.setState({\n            action: 'apply',\n            currentAction: a\n          });\n        });\n      }), true);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateTreeNodeLabel.prototype.updates = function (margin) {\n    var cell = this.props.cell;\n    var decoratorChain = StateTreeSpine.getDecoratorChain(cell.parent, cell.transform.ref);\n    var decorators = [];\n\n    for (var i = decoratorChain.length - 1; i >= 0; i--) {\n      var d = decoratorChain[i];\n      decorators.push(_jsx(UpdateTransformControl, {\n        state: cell.parent,\n        transform: d.transform,\n        noMargin: true,\n        wrapInExpander: true,\n        expanderHeaderLeftMargin: margin\n      }, d.transform.transformer.id + \"-\" + i));\n    }\n\n    return _jsx(\"div\", __assign({\n      className: 'msp-tree-updates-wrapper'\n    }, {\n      children: decorators\n    }), void 0);\n  };\n\n  StateTreeNodeLabel.prototype.render = function () {\n    var cell = this.props.cell;\n    var n = cell.transform;\n    if (!cell) return null;\n    var isCurrent = this.is(cell.parent.behaviors.currentObject.value);\n    var disabled = cell.status !== 'error' && cell.status !== 'ok';\n    var label;\n\n    if (cell.status === 'error' || !cell.obj) {\n      var name_1 = cell.status === 'error' ? cell.errorText : n.transformer.definition.display.name;\n      label = _jsxs(Button, __assign({\n        className: 'msp-btn-tree-label msp-no-hover-outline',\n        noOverflow: true,\n        title: name_1,\n        onClick: this.state.isCurrent ? this.setCurrentRoot : this.setCurrent,\n        disabled: disabled\n      }, {\n        children: [cell.status === 'error' && _jsxs(\"b\", {\n          children: [\"[\", cell.status, \"]\"]\n        }, void 0), \" \", _jsx(\"span\", {\n          children: name_1\n        }, void 0)]\n      }), void 0);\n    } else {\n      var obj = cell.obj;\n      var title = obj.label + \" \" + (obj.description ? obj.description : '');\n      label = _jsxs(Button, __assign({\n        className: \"msp-btn-tree-label msp-type-class-\" + obj.type.typeClass,\n        noOverflow: true,\n        disabled: disabled,\n        title: title,\n        onClick: this.state.isCurrent ? this.setCurrentRoot : this.setCurrent\n      }, {\n        children: [_jsx(\"span\", {\n          children: obj.label\n        }, void 0), \" \", obj.description ? _jsx(\"small\", {\n          children: obj.description\n        }, void 0) : void 0]\n      }), void 0);\n    }\n\n    var children = cell.parent.tree.children.get(this.ref);\n    var cellState = cell.state;\n\n    var expand = _jsx(IconButton, {\n      svg: cellState.isCollapsed ? ArrowRightSvg : ArrowDropDownSvg,\n      flex: '20px',\n      disabled: disabled,\n      onClick: this.toggleExpanded,\n      transparent: true,\n      className: 'msp-no-hover-outline',\n      style: {\n        visibility: children.size > 0 ? 'visible' : 'hidden'\n      }\n    }, void 0);\n\n    var remove = !cell.state.isLocked ? _jsx(IconButton, {\n      svg: DeleteOutlinedSvg,\n      onClick: this.remove,\n      disabled: disabled,\n      small: true,\n      toggleState: false\n    }, void 0) : void 0;\n\n    var visibility = _jsx(IconButton, {\n      svg: cellState.isHidden ? VisibilityOffOutlinedSvg : VisibilityOutlinedSvg,\n      toggleState: false,\n      disabled: disabled,\n      small: true,\n      onClick: this.toggleVisible\n    }, void 0);\n\n    var marginStyle = {\n      marginLeft: this.props.depth * 8 + \"px\"\n    };\n\n    var row = _jsxs(\"div\", __assign({\n      className: \"msp-flex-row msp-tree-row\" + (isCurrent ? ' msp-tree-row-current' : ''),\n      onMouseEnter: this.highlight,\n      onMouseLeave: this.clearHighlight,\n      style: marginStyle\n    }, {\n      children: [expand, label, remove, visibility]\n    }), void 0);\n\n    if (!isCurrent) return row;\n\n    if (this.state.action === 'apply' && this.state.currentAction) {\n      return _jsxs(\"div\", __assign({\n        style: {\n          marginBottom: '1px'\n        }\n      }, {\n        children: [row, _jsx(ControlGroup, __assign({\n          header: \"Apply \" + this.state.currentAction.definition.display.name,\n          initialExpanded: true,\n          hideExpander: true,\n          hideOffset: false,\n          onHeaderClick: this.hideApply,\n          topRightIcon: CloseSvg,\n          headerLeftMargin: this.props.depth * 8 + 21 + \"px\"\n        }, {\n          children: _jsx(ApplyActionControl, {\n            onApply: this.hideApply,\n            state: this.props.cell.parent,\n            action: this.state.currentAction,\n            nodeRef: this.props.cell.transform.ref,\n            hideHeader: true,\n            noMargin: true\n          }, void 0)\n        }), void 0)]\n      }), void 0);\n    }\n\n    if (this.state.action === 'options') {\n      var actions = this.actions;\n      var updates = this.updates(this.props.depth * 8 + 21 + \"px\");\n      return _jsxs(\"div\", __assign({\n        style: {\n          marginBottom: '1px'\n        }\n      }, {\n        children: [row, updates, actions && _jsx(\"div\", __assign({\n          style: {\n            marginLeft: this.props.depth * 8 + 21 + \"px\",\n            marginTop: '-1px'\n          }\n        }, {\n          children: _jsx(ActionMenu, {\n            items: actions,\n            onSelect: this.selectAction\n          }, void 0)\n        }), void 0)]\n      }), void 0);\n    }\n\n    return row;\n  };\n\n  return StateTreeNodeLabel;\n}(PluginUIComponent);","map":{"version":3,"sources":["../../../src/mol-plugin-ui/state/tree.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __extends, __spreadArray } from \"tslib\";\r\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\r\nimport { debounceTime, filter } from 'rxjs/operators';\r\nimport { PluginCommands } from '../../mol-plugin/commands';\r\nimport { StateObject, StateTransform } from '../../mol-state';\r\nimport { StateTreeSpine } from '../../mol-state/tree/spine';\r\nimport { PluginUIComponent } from '../base';\r\nimport { ActionMenu } from '../controls/action-menu';\r\nimport { Button, ControlGroup, IconButton } from '../controls/common';\r\nimport { Icon, HomeOutlinedSvg, ArrowRightSvg, ArrowDropDownSvg, DeleteOutlinedSvg, VisibilityOffOutlinedSvg, VisibilityOutlinedSvg, CloseSvg } from '../controls/icons';\r\nimport { ApplyActionControl } from './apply-action';\r\nimport { UpdateTransformControl } from './update-transform';\r\nvar StateTree = /** @class */ (function (_super) {\r\n    __extends(StateTree, _super);\r\n    function StateTree() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = { showActions: true };\r\n        return _this;\r\n    }\r\n    StateTree.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.state.events.cell.created, function (e) {\r\n            if (e.cell.transform.parent === StateTransform.RootRef)\r\n                _this.forceUpdate();\r\n        });\r\n        this.subscribe(this.plugin.state.events.cell.removed, function (e) {\r\n            if (e.parent === StateTransform.RootRef)\r\n                _this.forceUpdate();\r\n        });\r\n    };\r\n    StateTree.getDerivedStateFromProps = function (props, state) {\r\n        var n = props.state.tree.root.ref;\r\n        var children = props.state.tree.children.get(n);\r\n        var showActions = children.size === 0;\r\n        if (state.showActions === showActions)\r\n            return null;\r\n        return { showActions: showActions };\r\n    };\r\n    StateTree.prototype.render = function () {\r\n        var ref = this.props.state.tree.root.ref;\r\n        if (this.state.showActions) {\r\n            return _jsxs(\"div\", __assign({ style: { margin: '10px', cursor: 'default' } }, { children: [_jsx(\"p\", { children: \"Nothing to see here yet.\" }, void 0), _jsxs(\"p\", { children: [\"Structures and Volumes can be loaded from the \", _jsx(Icon, { svg: HomeOutlinedSvg }, void 0), \" tab.\"] }, void 0)] }), void 0);\r\n        }\r\n        return _jsx(StateTreeNode, { cell: this.props.state.cells.get(ref), depth: 0 }, void 0);\r\n    };\r\n    return StateTree;\r\n}(PluginUIComponent));\r\nexport { StateTree };\r\nvar StateTreeNode = /** @class */ (function (_super) {\r\n    __extends(StateTreeNode, _super);\r\n    function StateTreeNode() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            isCollapsed: !!_this.props.cell.state.isCollapsed,\r\n            isNull: StateTreeNode.isNull(_this.props.cell),\r\n            showLabel: StateTreeNode.showLabel(_this.props.cell)\r\n        };\r\n        return _this;\r\n    }\r\n    StateTreeNode.prototype.is = function (e) {\r\n        return e.ref === this.ref && e.state === this.props.cell.parent;\r\n    };\r\n    Object.defineProperty(StateTreeNode.prototype, \"ref\", {\r\n        get: function () {\r\n            return this.props.cell.transform.ref;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StateTreeNode.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.state.events.cell.stateUpdated, function (e) {\r\n            if (_this.props.cell === e.cell && _this.is(e) && e.state.cells.has(_this.ref)) {\r\n                if (_this.state.isCollapsed !== !!e.cell.state.isCollapsed\r\n                    || _this.state.isNull !== StateTreeNode.isNull(e.cell)\r\n                    || _this.state.showLabel !== StateTreeNode.showLabel(e.cell)) {\r\n                    _this.forceUpdate();\r\n                }\r\n            }\r\n        });\r\n        this.subscribe(this.plugin.state.events.cell.created, function (e) {\r\n            if (_this.props.cell.parent === e.state && _this.ref === e.cell.transform.parent) {\r\n                _this.forceUpdate();\r\n            }\r\n        });\r\n        this.subscribe(this.plugin.state.events.cell.removed, function (e) {\r\n            if (_this.props.cell.parent === e.state && _this.ref === e.parent) {\r\n                _this.forceUpdate();\r\n            }\r\n        });\r\n    };\r\n    StateTreeNode.getDerivedStateFromProps = function (props, state) {\r\n        var isNull = StateTreeNode.isNull(props.cell);\r\n        var showLabel = StateTreeNode.showLabel(props.cell);\r\n        if (!!props.cell.state.isCollapsed === state.isCollapsed && state.isNull === isNull && state.showLabel === showLabel)\r\n            return null;\r\n        return { isCollapsed: !!props.cell.state.isCollapsed, isNull: isNull, showLabel: showLabel };\r\n    };\r\n    StateTreeNode.hasDecorator = function (cell) {\r\n        var _a;\r\n        var children = cell.parent.tree.children.get(cell.transform.ref);\r\n        if (children.size !== 1)\r\n            return false;\r\n        return !!((_a = cell.parent) === null || _a === void 0 ? void 0 : _a.tree.transforms.get(children.first()).transformer.definition.isDecorator);\r\n    };\r\n    StateTreeNode.isNull = function (cell) {\r\n        return !cell || !cell.parent || cell.obj === StateObject.Null || !cell.parent.tree.transforms.has(cell.transform.ref);\r\n    };\r\n    StateTreeNode.showLabel = function (cell) {\r\n        return (cell.transform.ref !== StateTransform.RootRef) && (cell.status !== 'ok' || (!cell.state.isGhost && !StateTreeNode.hasDecorator(cell)));\r\n    };\r\n    StateTreeNode.prototype.render = function () {\r\n        var _this = this;\r\n        if (this.state.isNull) {\r\n            return null;\r\n        }\r\n        var cell = this.props.cell;\r\n        var children = cell.parent.tree.children.get(this.ref);\r\n        if (!this.state.showLabel) {\r\n            if (children.size === 0)\r\n                return null;\r\n            return _jsx(_Fragment, { children: children.map(function (c) { return _jsx(StateTreeNode, { cell: cell.parent.cells.get(c), depth: _this.props.depth }, c); }) }, void 0);\r\n        }\r\n        var newDepth = this.props.depth + 1;\r\n        return _jsxs(_Fragment, { children: [_jsx(StateTreeNodeLabel, { cell: cell, depth: this.props.depth }, void 0), children.size === 0\r\n                    ? void 0\r\n                    : _jsx(\"div\", __assign({ style: { display: this.state.isCollapsed ? 'none' : 'block' } }, { children: children.map(function (c) { return _jsx(StateTreeNode, { cell: cell.parent.cells.get(c), depth: newDepth }, c); }) }), void 0)] }, void 0);\r\n    };\r\n    return StateTreeNode;\r\n}(PluginUIComponent));\r\nvar StateTreeNodeLabel = /** @class */ (function (_super) {\r\n    __extends(StateTreeNodeLabel, _super);\r\n    function StateTreeNodeLabel() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            isCurrent: _this.props.cell.parent.current === _this.ref,\r\n            isCollapsed: !!_this.props.cell.state.isCollapsed,\r\n            action: void 0,\r\n            currentAction: void 0\r\n        };\r\n        _this.setCurrent = function (e) {\r\n            e === null || e === void 0 ? void 0 : e.preventDefault();\r\n            e === null || e === void 0 ? void 0 : e.currentTarget.blur();\r\n            PluginCommands.State.SetCurrentObject(_this.plugin, { state: _this.props.cell.parent, ref: _this.ref });\r\n        };\r\n        _this.setCurrentRoot = function (e) {\r\n            e === null || e === void 0 ? void 0 : e.preventDefault();\r\n            e === null || e === void 0 ? void 0 : e.currentTarget.blur();\r\n            PluginCommands.State.SetCurrentObject(_this.plugin, { state: _this.props.cell.parent, ref: StateTransform.RootRef });\r\n        };\r\n        _this.remove = function (e) {\r\n            e === null || e === void 0 ? void 0 : e.preventDefault();\r\n            PluginCommands.State.RemoveObject(_this.plugin, { state: _this.props.cell.parent, ref: _this.ref, removeParentGhosts: true });\r\n        };\r\n        _this.toggleVisible = function (e) {\r\n            e.preventDefault();\r\n            PluginCommands.State.ToggleVisibility(_this.plugin, { state: _this.props.cell.parent, ref: _this.ref });\r\n            e.currentTarget.blur();\r\n        };\r\n        _this.toggleExpanded = function (e) {\r\n            e.preventDefault();\r\n            PluginCommands.State.ToggleExpanded(_this.plugin, { state: _this.props.cell.parent, ref: _this.ref });\r\n            e.currentTarget.blur();\r\n        };\r\n        _this.highlight = function (e) {\r\n            e.preventDefault();\r\n            PluginCommands.Interactivity.Object.Highlight(_this.plugin, { state: _this.props.cell.parent, ref: _this.ref });\r\n            e.currentTarget.blur();\r\n        };\r\n        _this.clearHighlight = function (e) {\r\n            e.preventDefault();\r\n            PluginCommands.Interactivity.ClearHighlights(_this.plugin);\r\n            e.currentTarget.blur();\r\n        };\r\n        _this.hideApply = function () {\r\n            _this.setCurrentRoot();\r\n        };\r\n        _this.selectAction = function (item) {\r\n            if (!item)\r\n                return;\r\n            (item === null || item === void 0 ? void 0 : item.value)();\r\n        };\r\n        return _this;\r\n    }\r\n    StateTreeNodeLabel.prototype.is = function (e) {\r\n        return e.ref === this.ref && e.state === this.props.cell.parent;\r\n    };\r\n    Object.defineProperty(StateTreeNodeLabel.prototype, \"ref\", {\r\n        get: function () {\r\n            return this.props.cell.transform.ref;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StateTreeNodeLabel.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(filter(function (e) { return _this.is(e); }), debounceTime(33)), function (e) {\r\n            _this.forceUpdate();\r\n        });\r\n        this.subscribe(this.props.cell.parent.behaviors.currentObject, function (e) {\r\n            if (!_this.is(e)) {\r\n                if (_this.state.isCurrent && e.state.transforms.has(_this.ref)) {\r\n                    _this._setCurrent(_this.props.cell.parent.current === _this.ref, _this.state.isCollapsed);\r\n                }\r\n                return;\r\n            }\r\n            if (e.state.transforms.has(_this.ref)) {\r\n                _this._setCurrent(_this.props.cell.parent.current === _this.ref, !!_this.props.cell.state.isCollapsed);\r\n            }\r\n        });\r\n    };\r\n    StateTreeNodeLabel.prototype._setCurrent = function (isCurrent, isCollapsed) {\r\n        if (isCurrent) {\r\n            this.setState({ isCurrent: isCurrent, action: 'options', currentAction: void 0, isCollapsed: isCollapsed });\r\n        }\r\n        else {\r\n            this.setState({ isCurrent: isCurrent, action: void 0, currentAction: void 0, isCollapsed: isCollapsed });\r\n        }\r\n    };\r\n    StateTreeNodeLabel.getDerivedStateFromProps = function (props, state) {\r\n        var isCurrent = props.cell.parent.current === props.cell.transform.ref;\r\n        var isCollapsed = !!props.cell.state.isCollapsed;\r\n        if (state.isCollapsed === isCollapsed && state.isCurrent === isCurrent)\r\n            return null;\r\n        return { isCurrent: isCurrent, isCollapsed: isCollapsed, action: void 0, currentAction: void 0 };\r\n    };\r\n    Object.defineProperty(StateTreeNodeLabel.prototype, \"actions\", {\r\n        get: function () {\r\n            var _this = this;\r\n            var cell = this.props.cell;\r\n            var actions = __spreadArray([], cell.parent.actions.fromCell(cell, this.plugin), true);\r\n            if (actions.length === 0)\r\n                return;\r\n            actions.sort(function (a, b) { return a.definition.display.name < b.definition.display.name ? -1 : a.definition.display.name === b.definition.display.name ? 0 : 1; });\r\n            return __spreadArray([\r\n                ActionMenu.Header('Apply Action')\r\n            ], actions.map(function (a) { return ActionMenu.Item(a.definition.display.name, function () { return _this.setState({ action: 'apply', currentAction: a }); }); }), true);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StateTreeNodeLabel.prototype.updates = function (margin) {\r\n        var cell = this.props.cell;\r\n        var decoratorChain = StateTreeSpine.getDecoratorChain(cell.parent, cell.transform.ref);\r\n        var decorators = [];\r\n        for (var i = decoratorChain.length - 1; i >= 0; i--) {\r\n            var d = decoratorChain[i];\r\n            decorators.push(_jsx(UpdateTransformControl, { state: cell.parent, transform: d.transform, noMargin: true, wrapInExpander: true, expanderHeaderLeftMargin: margin }, d.transform.transformer.id + \"-\" + i));\r\n        }\r\n        return _jsx(\"div\", __assign({ className: 'msp-tree-updates-wrapper' }, { children: decorators }), void 0);\r\n    };\r\n    StateTreeNodeLabel.prototype.render = function () {\r\n        var cell = this.props.cell;\r\n        var n = cell.transform;\r\n        if (!cell)\r\n            return null;\r\n        var isCurrent = this.is(cell.parent.behaviors.currentObject.value);\r\n        var disabled = cell.status !== 'error' && cell.status !== 'ok';\r\n        var label;\r\n        if (cell.status === 'error' || !cell.obj) {\r\n            var name_1 = cell.status === 'error' ? cell.errorText : n.transformer.definition.display.name;\r\n            label = _jsxs(Button, __assign({ className: 'msp-btn-tree-label msp-no-hover-outline', noOverflow: true, title: name_1, onClick: this.state.isCurrent ? this.setCurrentRoot : this.setCurrent, disabled: disabled }, { children: [cell.status === 'error' && _jsxs(\"b\", { children: [\"[\", cell.status, \"]\"] }, void 0), \" \", _jsx(\"span\", { children: name_1 }, void 0)] }), void 0);\r\n        }\r\n        else {\r\n            var obj = cell.obj;\r\n            var title = obj.label + \" \" + (obj.description ? obj.description : '');\r\n            label = _jsxs(Button, __assign({ className: \"msp-btn-tree-label msp-type-class-\" + obj.type.typeClass, noOverflow: true, disabled: disabled, title: title, onClick: this.state.isCurrent ? this.setCurrentRoot : this.setCurrent }, { children: [_jsx(\"span\", { children: obj.label }, void 0), \" \", obj.description ? _jsx(\"small\", { children: obj.description }, void 0) : void 0] }), void 0);\r\n        }\r\n        var children = cell.parent.tree.children.get(this.ref);\r\n        var cellState = cell.state;\r\n        var expand = _jsx(IconButton, { svg: cellState.isCollapsed ? ArrowRightSvg : ArrowDropDownSvg, flex: '20px', disabled: disabled, onClick: this.toggleExpanded, transparent: true, className: 'msp-no-hover-outline', style: { visibility: children.size > 0 ? 'visible' : 'hidden' } }, void 0);\r\n        var remove = !cell.state.isLocked ? _jsx(IconButton, { svg: DeleteOutlinedSvg, onClick: this.remove, disabled: disabled, small: true, toggleState: false }, void 0) : void 0;\r\n        var visibility = _jsx(IconButton, { svg: cellState.isHidden ? VisibilityOffOutlinedSvg : VisibilityOutlinedSvg, toggleState: false, disabled: disabled, small: true, onClick: this.toggleVisible }, void 0);\r\n        var marginStyle = {\r\n            marginLeft: this.props.depth * 8 + \"px\"\r\n        };\r\n        var row = _jsxs(\"div\", __assign({ className: \"msp-flex-row msp-tree-row\" + (isCurrent ? ' msp-tree-row-current' : ''), onMouseEnter: this.highlight, onMouseLeave: this.clearHighlight, style: marginStyle }, { children: [expand, label, remove, visibility] }), void 0);\r\n        if (!isCurrent)\r\n            return row;\r\n        if (this.state.action === 'apply' && this.state.currentAction) {\r\n            return _jsxs(\"div\", __assign({ style: { marginBottom: '1px' } }, { children: [row, _jsx(ControlGroup, __assign({ header: \"Apply \" + this.state.currentAction.definition.display.name, initialExpanded: true, hideExpander: true, hideOffset: false, onHeaderClick: this.hideApply, topRightIcon: CloseSvg, headerLeftMargin: this.props.depth * 8 + 21 + \"px\" }, { children: _jsx(ApplyActionControl, { onApply: this.hideApply, state: this.props.cell.parent, action: this.state.currentAction, nodeRef: this.props.cell.transform.ref, hideHeader: true, noMargin: true }, void 0) }), void 0)] }), void 0);\r\n        }\r\n        if (this.state.action === 'options') {\r\n            var actions = this.actions;\r\n            var updates = this.updates(this.props.depth * 8 + 21 + \"px\");\r\n            return _jsxs(\"div\", __assign({ style: { marginBottom: '1px' } }, { children: [row, updates, actions && _jsx(\"div\", __assign({ style: { marginLeft: this.props.depth * 8 + 21 + \"px\", marginTop: '-1px' } }, { children: _jsx(ActionMenu, { items: actions, onSelect: this.selectAction }, void 0) }), void 0)] }), void 0);\r\n        }\r\n        return row;\r\n    };\r\n    return StateTreeNodeLabel;\r\n}(PluginUIComponent));\r\n//# sourceMappingURL=tree.js.map"]},"metadata":{},"sourceType":"module"}