{"ast":null,"code":"/**\r\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { CifWriter } from '../../../../mol-io/writer/cif';\nimport { StructureProperties as P } from '../../structure';\nvar CifField = CifWriter.Field;\nvar E = CifWriter.Encodings;\n\nfunction atom_site_label_asym_id(e) {\n  var l = P.chain.label_asym_id(e);\n  var suffix = e.unit.conformation.operator.suffix;\n  if (!suffix) return l;\n  return l + suffix;\n}\n\nfunction atom_site_auth_asym_id(e) {\n  var l = P.chain.auth_asym_id(e);\n  var suffix = e.unit.conformation.operator.suffix;\n  if (!suffix) return l;\n  return l + suffix;\n}\n\nvar atom_site_fields = function () {\n  return CifWriter.fields().str('group_PDB', P.residue.group_PDB).index('id').str('type_symbol', P.atom.type_symbol).str('label_atom_id', P.atom.label_atom_id).str('label_comp_id', P.atom.label_comp_id).int('label_seq_id', P.residue.label_seq_id, {\n    encoder: E.deltaRLE,\n    valueKind: function (k, d) {\n      var m = k.unit.model;\n      return m.atomicHierarchy.residues.label_seq_id.valueKind(m.atomicHierarchy.residueAtomSegments.index[k.element]);\n    }\n  }).str('label_alt_id', P.atom.label_alt_id).str('pdbx_PDB_ins_code', P.residue.pdbx_PDB_ins_code).str('label_asym_id', atom_site_label_asym_id).str('label_entity_id', P.chain.label_entity_id).float('Cartn_x', P.atom.x, {\n    digitCount: 3,\n    encoder: E.fixedPoint3\n  }).float('Cartn_y', P.atom.y, {\n    digitCount: 3,\n    encoder: E.fixedPoint3\n  }).float('Cartn_z', P.atom.z, {\n    digitCount: 3,\n    encoder: E.fixedPoint3\n  }).float('occupancy', P.atom.occupancy, {\n    digitCount: 2,\n    encoder: E.fixedPoint2\n  }).float('B_iso_or_equiv', P.atom.B_iso_or_equiv, {\n    digitCount: 2,\n    encoder: E.fixedPoint2\n  }).int('pdbx_formal_charge', P.atom.pdbx_formal_charge, {\n    encoder: E.deltaRLE,\n    valueKind: function (k, d) {\n      return k.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.valueKind(k.element);\n    }\n  }).str('auth_atom_id', P.atom.auth_atom_id).str('auth_comp_id', P.atom.auth_comp_id).int('auth_seq_id', P.residue.auth_seq_id, {\n    encoder: E.deltaRLE\n  }).str('auth_asym_id', atom_site_auth_asym_id).int('pdbx_PDB_model_num', P.unit.model_num, {\n    encoder: E.deltaRLE\n  }) // .str('operator_name', P.unit.operator_name, {\n  //     shouldInclude: structure => structure.units.some(u => !u.conformation.operator.isIdentity)\n  // })\n  .getFields();\n};\n\nexport var _atom_site = {\n  name: 'atom_site',\n  instance: function (_a) {\n    var structures = _a.structures;\n    return {\n      fields: atom_site_fields(),\n      source: structures.map(function (s) {\n        return {\n          data: s,\n          rowCount: s.elementCount,\n          keys: function () {\n            return s.elementLocations();\n          }\n        };\n      })\n    };\n  }\n};\n\nfunction prepostfixed(prefix, name) {\n  if (prefix) return prefix + \"_\" + name;\n  return name;\n}\n\nfunction prefixedInsCode(prefix) {\n  if (!prefix) return 'pdbx_PDB_ins_code';\n  return \"pdbx_\" + prefix + \"_PDB_ins_code\";\n}\n\nfunction mappedProp(loc, prop) {\n  return function (k, d) {\n    return prop(loc(k, d));\n  };\n}\n\nfunction addModelNum(fields, getLocation, options) {\n  if (options && options.includeModelNum) {\n    fields.int('pdbx_PDB_model_num', mappedProp(getLocation, P.unit.model_num));\n  }\n}\n\nexport function residueIdFields(getLocation, options) {\n  var prefix = options && options.prefix;\n  var ret = CifWriter.fields().str(prepostfixed(prefix, \"label_comp_id\"), mappedProp(getLocation, P.atom.label_comp_id)).int(prepostfixed(prefix, \"label_seq_id\"), mappedProp(getLocation, P.residue.label_seq_id), {\n    encoder: E.deltaRLE,\n    valueKind: function (k, d) {\n      var e = getLocation(k, d);\n      var m = e.unit.model;\n      return m.atomicHierarchy.residues.label_seq_id.valueKind(m.atomicHierarchy.residueAtomSegments.index[e.element]);\n    }\n  }).str(prefixedInsCode(prefix), mappedProp(getLocation, P.residue.pdbx_PDB_ins_code)).str(prepostfixed(prefix, \"label_asym_id\"), mappedProp(getLocation, P.chain.label_asym_id)).str(prepostfixed(prefix, \"label_entity_id\"), mappedProp(getLocation, P.chain.label_entity_id)).str(prepostfixed(prefix, \"auth_comp_id\"), mappedProp(getLocation, P.atom.auth_comp_id)).int(prepostfixed(prefix, \"auth_seq_id\"), mappedProp(getLocation, P.residue.auth_seq_id), {\n    encoder: E.deltaRLE\n  }).str(prepostfixed(prefix, \"auth_asym_id\"), mappedProp(getLocation, P.chain.auth_asym_id));\n  addModelNum(ret, getLocation, options);\n  return ret.getFields();\n}\nexport function chainIdFields(getLocation, options) {\n  var prefix = options && options.prefix;\n  var ret = CifField.build().str(prepostfixed(prefix, \"label_asym_id\"), mappedProp(getLocation, P.chain.label_asym_id)).str(prepostfixed(prefix, \"label_entity_id\"), mappedProp(getLocation, P.chain.label_entity_id)).str(prepostfixed(prefix, \"auth_asym_id\"), mappedProp(getLocation, P.chain.auth_asym_id));\n  addModelNum(ret, getLocation, options);\n  return ret.getFields();\n}\nexport function entityIdFields(getLocation, options) {\n  var prefix = options && options.prefix;\n  var ret = CifField.build().str(prepostfixed(prefix, \"label_entity_id\"), mappedProp(getLocation, P.chain.label_entity_id));\n  addModelNum(ret, getLocation, options);\n  return ret.getFields();\n}\nexport function atomIdFields(getLocation, options) {\n  var prefix = options && options.prefix;\n  var ret = CifWriter.fields().str(prepostfixed(prefix, \"label_atom_id\"), mappedProp(getLocation, P.atom.label_atom_id)).str(prepostfixed(prefix, \"label_comp_id\"), mappedProp(getLocation, P.atom.label_comp_id)).int(prepostfixed(prefix, \"label_seq_id\"), mappedProp(getLocation, P.residue.label_seq_id), {\n    encoder: E.deltaRLE,\n    valueKind: function (k, d) {\n      var e = getLocation(k, d);\n      var m = e.unit.model;\n      return m.atomicHierarchy.residues.label_seq_id.valueKind(m.atomicHierarchy.residueAtomSegments.index[e.element]);\n    }\n  }).str(prepostfixed(prefix, \"label_alt_id\"), mappedProp(getLocation, P.atom.label_alt_id)).str(prefixedInsCode(prefix), mappedProp(getLocation, P.residue.pdbx_PDB_ins_code)).str(prepostfixed(prefix, \"label_asym_id\"), mappedProp(getLocation, P.chain.label_asym_id)).str(prepostfixed(prefix, \"label_entity_id\"), mappedProp(getLocation, P.chain.label_entity_id)).str(prepostfixed(prefix, \"auth_atom_id\"), mappedProp(getLocation, P.atom.auth_atom_id)).str(prepostfixed(prefix, \"auth_comp_id\"), mappedProp(getLocation, P.atom.auth_comp_id)).int(prepostfixed(prefix, \"auth_seq_id\"), mappedProp(getLocation, P.residue.auth_seq_id), {\n    encoder: E.deltaRLE\n  }).str(prepostfixed(prefix, \"auth_asym_id\"), mappedProp(getLocation, P.chain.auth_asym_id));\n  addModelNum(ret, getLocation, options);\n  return ret.getFields();\n}","map":{"version":3,"sources":["../../../../../src/mol-model/structure/export/categories/atom_site.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { CifWriter } from '../../../../mol-io/writer/cif';\r\nimport { StructureProperties as P } from '../../structure';\r\nvar CifField = CifWriter.Field;\r\nvar E = CifWriter.Encodings;\r\nfunction atom_site_label_asym_id(e) {\r\n    var l = P.chain.label_asym_id(e);\r\n    var suffix = e.unit.conformation.operator.suffix;\r\n    if (!suffix)\r\n        return l;\r\n    return l + suffix;\r\n}\r\nfunction atom_site_auth_asym_id(e) {\r\n    var l = P.chain.auth_asym_id(e);\r\n    var suffix = e.unit.conformation.operator.suffix;\r\n    if (!suffix)\r\n        return l;\r\n    return l + suffix;\r\n}\r\nvar atom_site_fields = function () { return CifWriter.fields()\r\n    .str('group_PDB', P.residue.group_PDB)\r\n    .index('id')\r\n    .str('type_symbol', P.atom.type_symbol)\r\n    .str('label_atom_id', P.atom.label_atom_id)\r\n    .str('label_comp_id', P.atom.label_comp_id)\r\n    .int('label_seq_id', P.residue.label_seq_id, {\r\n    encoder: E.deltaRLE,\r\n    valueKind: function (k, d) {\r\n        var m = k.unit.model;\r\n        return m.atomicHierarchy.residues.label_seq_id.valueKind(m.atomicHierarchy.residueAtomSegments.index[k.element]);\r\n    }\r\n})\r\n    .str('label_alt_id', P.atom.label_alt_id)\r\n    .str('pdbx_PDB_ins_code', P.residue.pdbx_PDB_ins_code)\r\n    .str('label_asym_id', atom_site_label_asym_id)\r\n    .str('label_entity_id', P.chain.label_entity_id)\r\n    .float('Cartn_x', P.atom.x, { digitCount: 3, encoder: E.fixedPoint3 })\r\n    .float('Cartn_y', P.atom.y, { digitCount: 3, encoder: E.fixedPoint3 })\r\n    .float('Cartn_z', P.atom.z, { digitCount: 3, encoder: E.fixedPoint3 })\r\n    .float('occupancy', P.atom.occupancy, { digitCount: 2, encoder: E.fixedPoint2 })\r\n    .float('B_iso_or_equiv', P.atom.B_iso_or_equiv, { digitCount: 2, encoder: E.fixedPoint2 })\r\n    .int('pdbx_formal_charge', P.atom.pdbx_formal_charge, {\r\n    encoder: E.deltaRLE,\r\n    valueKind: function (k, d) { return k.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.valueKind(k.element); }\r\n})\r\n    .str('auth_atom_id', P.atom.auth_atom_id)\r\n    .str('auth_comp_id', P.atom.auth_comp_id)\r\n    .int('auth_seq_id', P.residue.auth_seq_id, { encoder: E.deltaRLE })\r\n    .str('auth_asym_id', atom_site_auth_asym_id)\r\n    .int('pdbx_PDB_model_num', P.unit.model_num, { encoder: E.deltaRLE })\r\n    // .str('operator_name', P.unit.operator_name, {\r\n    //     shouldInclude: structure => structure.units.some(u => !u.conformation.operator.isIdentity)\r\n    // })\r\n    .getFields(); };\r\nexport var _atom_site = {\r\n    name: 'atom_site',\r\n    instance: function (_a) {\r\n        var structures = _a.structures;\r\n        return {\r\n            fields: atom_site_fields(),\r\n            source: structures.map(function (s) { return ({\r\n                data: s,\r\n                rowCount: s.elementCount,\r\n                keys: function () { return s.elementLocations(); }\r\n            }); })\r\n        };\r\n    }\r\n};\r\nfunction prepostfixed(prefix, name) {\r\n    if (prefix)\r\n        return prefix + \"_\" + name;\r\n    return name;\r\n}\r\nfunction prefixedInsCode(prefix) {\r\n    if (!prefix)\r\n        return 'pdbx_PDB_ins_code';\r\n    return \"pdbx_\" + prefix + \"_PDB_ins_code\";\r\n}\r\nfunction mappedProp(loc, prop) {\r\n    return function (k, d) { return prop(loc(k, d)); };\r\n}\r\nfunction addModelNum(fields, getLocation, options) {\r\n    if (options && options.includeModelNum) {\r\n        fields.int('pdbx_PDB_model_num', mappedProp(getLocation, P.unit.model_num));\r\n    }\r\n}\r\nexport function residueIdFields(getLocation, options) {\r\n    var prefix = options && options.prefix;\r\n    var ret = CifWriter.fields()\r\n        .str(prepostfixed(prefix, \"label_comp_id\"), mappedProp(getLocation, P.atom.label_comp_id))\r\n        .int(prepostfixed(prefix, \"label_seq_id\"), mappedProp(getLocation, P.residue.label_seq_id), {\r\n        encoder: E.deltaRLE,\r\n        valueKind: function (k, d) {\r\n            var e = getLocation(k, d);\r\n            var m = e.unit.model;\r\n            return m.atomicHierarchy.residues.label_seq_id.valueKind(m.atomicHierarchy.residueAtomSegments.index[e.element]);\r\n        }\r\n    })\r\n        .str(prefixedInsCode(prefix), mappedProp(getLocation, P.residue.pdbx_PDB_ins_code))\r\n        .str(prepostfixed(prefix, \"label_asym_id\"), mappedProp(getLocation, P.chain.label_asym_id))\r\n        .str(prepostfixed(prefix, \"label_entity_id\"), mappedProp(getLocation, P.chain.label_entity_id))\r\n        .str(prepostfixed(prefix, \"auth_comp_id\"), mappedProp(getLocation, P.atom.auth_comp_id))\r\n        .int(prepostfixed(prefix, \"auth_seq_id\"), mappedProp(getLocation, P.residue.auth_seq_id), { encoder: E.deltaRLE })\r\n        .str(prepostfixed(prefix, \"auth_asym_id\"), mappedProp(getLocation, P.chain.auth_asym_id));\r\n    addModelNum(ret, getLocation, options);\r\n    return ret.getFields();\r\n}\r\nexport function chainIdFields(getLocation, options) {\r\n    var prefix = options && options.prefix;\r\n    var ret = CifField.build()\r\n        .str(prepostfixed(prefix, \"label_asym_id\"), mappedProp(getLocation, P.chain.label_asym_id))\r\n        .str(prepostfixed(prefix, \"label_entity_id\"), mappedProp(getLocation, P.chain.label_entity_id))\r\n        .str(prepostfixed(prefix, \"auth_asym_id\"), mappedProp(getLocation, P.chain.auth_asym_id));\r\n    addModelNum(ret, getLocation, options);\r\n    return ret.getFields();\r\n}\r\nexport function entityIdFields(getLocation, options) {\r\n    var prefix = options && options.prefix;\r\n    var ret = CifField.build()\r\n        .str(prepostfixed(prefix, \"label_entity_id\"), mappedProp(getLocation, P.chain.label_entity_id));\r\n    addModelNum(ret, getLocation, options);\r\n    return ret.getFields();\r\n}\r\nexport function atomIdFields(getLocation, options) {\r\n    var prefix = options && options.prefix;\r\n    var ret = CifWriter.fields()\r\n        .str(prepostfixed(prefix, \"label_atom_id\"), mappedProp(getLocation, P.atom.label_atom_id))\r\n        .str(prepostfixed(prefix, \"label_comp_id\"), mappedProp(getLocation, P.atom.label_comp_id))\r\n        .int(prepostfixed(prefix, \"label_seq_id\"), mappedProp(getLocation, P.residue.label_seq_id), {\r\n        encoder: E.deltaRLE,\r\n        valueKind: function (k, d) {\r\n            var e = getLocation(k, d);\r\n            var m = e.unit.model;\r\n            return m.atomicHierarchy.residues.label_seq_id.valueKind(m.atomicHierarchy.residueAtomSegments.index[e.element]);\r\n        }\r\n    })\r\n        .str(prepostfixed(prefix, \"label_alt_id\"), mappedProp(getLocation, P.atom.label_alt_id))\r\n        .str(prefixedInsCode(prefix), mappedProp(getLocation, P.residue.pdbx_PDB_ins_code))\r\n        .str(prepostfixed(prefix, \"label_asym_id\"), mappedProp(getLocation, P.chain.label_asym_id))\r\n        .str(prepostfixed(prefix, \"label_entity_id\"), mappedProp(getLocation, P.chain.label_entity_id))\r\n        .str(prepostfixed(prefix, \"auth_atom_id\"), mappedProp(getLocation, P.atom.auth_atom_id))\r\n        .str(prepostfixed(prefix, \"auth_comp_id\"), mappedProp(getLocation, P.atom.auth_comp_id))\r\n        .int(prepostfixed(prefix, \"auth_seq_id\"), mappedProp(getLocation, P.residue.auth_seq_id), { encoder: E.deltaRLE })\r\n        .str(prepostfixed(prefix, \"auth_asym_id\"), mappedProp(getLocation, P.chain.auth_asym_id));\r\n    addModelNum(ret, getLocation, options);\r\n    return ret.getFields();\r\n}\r\n//# sourceMappingURL=atom_site.js.map"]},"metadata":{},"sourceType":"module"}