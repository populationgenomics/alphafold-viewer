{"ast":null,"code":"/**\r\n * Copyright (c) 2018-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { Vec3 } from '../linear-algebra';\nimport { OrderedSet } from '../../mol-data/int';\nimport { BoundaryHelper } from './boundary-helper';\nimport { Box3D, Sphere3D } from '../geometry'; // avoiding namespace lookup improved performance in Chrome (Aug 2020)\n\nvar v3set = Vec3.set;\nvar boundaryHelperCoarse = new BoundaryHelper('14');\nvar boundaryHelperFine = new BoundaryHelper('98');\n\nfunction getBoundaryHelper(count) {\n  return count > 10000 ? boundaryHelperCoarse : boundaryHelperFine;\n}\n\nvar p = Vec3();\nexport function getBoundary(data) {\n  var x = data.x,\n      y = data.y,\n      z = data.z,\n      radius = data.radius,\n      indices = data.indices;\n  var n = OrderedSet.size(indices);\n\n  if (n > 250000) {\n    var box = Box3D.computeBounding(data);\n    return {\n      box: box,\n      sphere: Sphere3D.fromBox3D(Sphere3D(), box)\n    };\n  }\n\n  var boundaryHelper = getBoundaryHelper(n);\n  boundaryHelper.reset();\n\n  for (var t = 0; t < n; t++) {\n    var i = OrderedSet.getAt(indices, t);\n    v3set(p, x[i], y[i], z[i]);\n    boundaryHelper.includePositionRadius(p, radius && radius[i] || 0);\n  }\n\n  boundaryHelper.finishedIncludeStep();\n\n  for (var t = 0; t < n; t++) {\n    var i = OrderedSet.getAt(indices, t);\n    v3set(p, x[i], y[i], z[i]);\n    boundaryHelper.radiusPositionRadius(p, radius && radius[i] || 0);\n  }\n\n  var sphere = boundaryHelper.getSphere();\n\n  if (!radius && Sphere3D.hasExtrema(sphere) && n <= sphere.extrema.length) {\n    var extrema = [];\n\n    for (var t = 0; t < n; t++) {\n      var i = OrderedSet.getAt(indices, t);\n      extrema.push(Vec3.create(x[i], y[i], z[i]));\n    }\n\n    Sphere3D.setExtrema(sphere, extrema);\n  }\n\n  return {\n    box: boundaryHelper.getBox(),\n    sphere: sphere\n  };\n}","map":{"version":3,"sources":["../../../src/mol-math/geometry/boundary.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2018-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { Vec3 } from '../linear-algebra';\r\nimport { OrderedSet } from '../../mol-data/int';\r\nimport { BoundaryHelper } from './boundary-helper';\r\nimport { Box3D, Sphere3D } from '../geometry';\r\n// avoiding namespace lookup improved performance in Chrome (Aug 2020)\r\nvar v3set = Vec3.set;\r\nvar boundaryHelperCoarse = new BoundaryHelper('14');\r\nvar boundaryHelperFine = new BoundaryHelper('98');\r\nfunction getBoundaryHelper(count) {\r\n    return count > 10000 ? boundaryHelperCoarse : boundaryHelperFine;\r\n}\r\nvar p = Vec3();\r\nexport function getBoundary(data) {\r\n    var x = data.x, y = data.y, z = data.z, radius = data.radius, indices = data.indices;\r\n    var n = OrderedSet.size(indices);\r\n    if (n > 250000) {\r\n        var box = Box3D.computeBounding(data);\r\n        return { box: box, sphere: Sphere3D.fromBox3D(Sphere3D(), box) };\r\n    }\r\n    var boundaryHelper = getBoundaryHelper(n);\r\n    boundaryHelper.reset();\r\n    for (var t = 0; t < n; t++) {\r\n        var i = OrderedSet.getAt(indices, t);\r\n        v3set(p, x[i], y[i], z[i]);\r\n        boundaryHelper.includePositionRadius(p, (radius && radius[i]) || 0);\r\n    }\r\n    boundaryHelper.finishedIncludeStep();\r\n    for (var t = 0; t < n; t++) {\r\n        var i = OrderedSet.getAt(indices, t);\r\n        v3set(p, x[i], y[i], z[i]);\r\n        boundaryHelper.radiusPositionRadius(p, (radius && radius[i]) || 0);\r\n    }\r\n    var sphere = boundaryHelper.getSphere();\r\n    if (!radius && Sphere3D.hasExtrema(sphere) && n <= sphere.extrema.length) {\r\n        var extrema = [];\r\n        for (var t = 0; t < n; t++) {\r\n            var i = OrderedSet.getAt(indices, t);\r\n            extrema.push(Vec3.create(x[i], y[i], z[i]));\r\n        }\r\n        Sphere3D.setExtrema(sphere, extrema);\r\n    }\r\n    return { box: boundaryHelper.getBox(), sphere: sphere };\r\n}\r\n//# sourceMappingURL=boundary.js.map"]},"metadata":{},"sourceType":"module"}