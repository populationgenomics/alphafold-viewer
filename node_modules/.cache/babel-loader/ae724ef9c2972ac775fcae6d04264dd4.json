{"ast":null,"code":"import { __assign, __awaiter, __extends, __generator, __spreadArray } from \"tslib\";\nimport { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { StructureHierarchyManager } from '../../mol-plugin-state/manager/structure/hierarchy';\nimport { VolumeHierarchyManager } from '../../mol-plugin-state/manager/volume/hierarchy';\nimport { FocusLoci } from '../../mol-plugin/behavior/dynamic/representation';\nimport { VolumeStreaming } from '../../mol-plugin/behavior/dynamic/volume-streaming/behavior';\nimport { InitVolumeStreaming } from '../../mol-plugin/behavior/dynamic/volume-streaming/transformers';\nimport { State, StateSelection, StateTransform } from '../../mol-state';\nimport { CollapsableControls, PurePluginUIComponent } from '../base';\nimport { ActionMenu } from '../controls/action-menu';\nimport { Button, ExpandGroup, IconButton } from '../controls/common';\nimport { ApplyActionControl } from '../state/apply-action';\nimport { UpdateTransformControl } from '../state/update-transform';\nimport { BindingsHelp } from '../viewport/help';\nimport { PluginCommands } from '../../mol-plugin/commands';\nimport { BlurOnSvg, ErrorSvg, CheckSvg, AddSvg, VisibilityOffOutlinedSvg, VisibilityOutlinedSvg, DeleteOutlinedSvg, MoreHorizSvg } from '../controls/icons';\nimport { StateTransforms } from '../../mol-plugin-state/transforms';\nimport { createVolumeRepresentationParams } from '../../mol-plugin-state/helpers/volume-representation-params';\n\nvar VolumeStreamingControls =\n/** @class */\nfunction (_super) {\n  __extends(VolumeStreamingControls, _super);\n\n  function VolumeStreamingControls() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  VolumeStreamingControls.prototype.defaultState = function () {\n    return {\n      header: 'Volume Streaming',\n      isCollapsed: false,\n      isBusy: false,\n      isHidden: true,\n      brand: {\n        accent: 'cyan',\n        svg: BlurOnSvg\n      }\n    };\n  };\n\n  VolumeStreamingControls.prototype.componentDidMount = function () {\n    var _this = this; // TODO: do not hide this but instead show some help text??\n\n\n    this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection, function () {\n      _this.setState({\n        isHidden: !_this.canEnable(),\n        description: StructureHierarchyManager.getSelectedStructuresDescription(_this.plugin)\n      });\n    });\n    this.subscribe(this.plugin.state.events.cell.stateUpdated, function (e) {\n      if (StateTransform.hasTag(e.cell.transform, VolumeStreaming.RootTag)) _this.forceUpdate();\n    });\n    this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\n      _this.setState({\n        isBusy: v\n      });\n    });\n  };\n\n  Object.defineProperty(VolumeStreamingControls.prototype, \"pivot\", {\n    get: function () {\n      return this.plugin.managers.structure.hierarchy.selection.structures[0];\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  VolumeStreamingControls.prototype.canEnable = function () {\n    var _a, _b;\n\n    var selection = this.plugin.managers.structure.hierarchy.selection;\n    if (selection.structures.length !== 1) return false;\n    var pivot = this.pivot.cell;\n    if (!pivot.obj) return false;\n    return !!((_b = (_a = InitVolumeStreaming.definition).isApplicable) === null || _b === void 0 ? void 0 : _b.call(_a, pivot.obj, pivot.transform, this.plugin));\n  };\n\n  VolumeStreamingControls.prototype.renderEnable = function () {\n    var _a;\n\n    var pivot = this.pivot;\n    if (!pivot.cell.parent) return null;\n    var root = StateSelection.findTagInSubtree(pivot.cell.parent.tree, this.pivot.cell.transform.ref, VolumeStreaming.RootTag);\n    var rootCell = root && pivot.cell.parent.cells.get(root);\n    var simpleApply = rootCell && rootCell.status === 'error' ? {\n      header: 'Error enabling',\n      icon: ErrorSvg,\n      title: rootCell.errorText\n    } : rootCell && ((_a = rootCell.obj) === null || _a === void 0 ? void 0 : _a.data.entries.length) === 0 ? {\n      header: 'Error enabling',\n      icon: ErrorSvg,\n      title: 'No entry for streaming found'\n    } : {\n      header: 'Enable',\n      icon: CheckSvg,\n      title: 'Enable'\n    };\n    return _jsx(ApplyActionControl, {\n      state: pivot.cell.parent,\n      action: InitVolumeStreaming,\n      initiallyCollapsed: true,\n      nodeRef: pivot.cell.transform.ref,\n      simpleApply: simpleApply\n    }, void 0);\n  };\n\n  VolumeStreamingControls.prototype.renderParams = function () {\n    var _a, _b, _c, _d, _e;\n\n    var pivot = this.pivot;\n    if (!pivot.cell.parent) return null;\n    var bindings = ((_b = (_a = pivot.volumeStreaming) === null || _a === void 0 ? void 0 : _a.cell.transform.params) === null || _b === void 0 ? void 0 : _b.entry.params.view.name) === 'selection-box' && ((_e = (_d = (_c = this.plugin.state.behaviors.cells.get(FocusLoci.id)) === null || _c === void 0 ? void 0 : _c.params) === null || _d === void 0 ? void 0 : _d.values) === null || _e === void 0 ? void 0 : _e.bindings);\n    return _jsxs(_Fragment, {\n      children: [_jsx(UpdateTransformControl, {\n        state: pivot.cell.parent,\n        transform: pivot.volumeStreaming.cell.transform,\n        customHeader: 'none',\n        noMargin: true\n      }, void 0), bindings && _jsx(ExpandGroup, __assign({\n        header: 'Controls Help'\n      }, {\n        children: _jsx(BindingsHelp, {\n          bindings: bindings\n        }, void 0)\n      }), void 0)]\n    }, void 0);\n  };\n\n  VolumeStreamingControls.prototype.renderControls = function () {\n    var pivot = this.pivot;\n    if (!pivot) return null;\n    if (!pivot.volumeStreaming) return this.renderEnable();\n    return this.renderParams();\n  };\n\n  return VolumeStreamingControls;\n}(CollapsableControls);\n\nexport { VolumeStreamingControls };\n\nvar VolumeSourceControls =\n/** @class */\nfunction (_super) {\n  __extends(VolumeSourceControls, _super);\n\n  function VolumeSourceControls() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.item = function (ref) {\n      var _a;\n\n      var selected = _this.plugin.managers.volume.hierarchy.selection;\n      var label = ((_a = ref.cell.obj) === null || _a === void 0 ? void 0 : _a.label) || 'Volume';\n      var item = {\n        kind: 'item',\n        label: (ref.kind === 'lazy-volume' ? 'Load ' : '') + (label || ref.kind),\n        selected: selected === ref,\n        value: ref\n      };\n      return item;\n    };\n\n    _this.selectCurrent = function (item) {\n      _this.toggleHierarchy();\n\n      if (!item) return;\n      var current = item.value;\n\n      if (current.kind === 'volume') {\n        _this.plugin.managers.volume.hierarchy.setCurrent(current);\n      } else {\n        _this.lazyLoad(current.cell);\n      }\n    };\n\n    _this.selectAdd = function (item) {\n      if (!item) return;\n\n      _this.setState({\n        show: void 0\n      });\n\n      item.value();\n    };\n\n    _this.toggleHierarchy = function () {\n      return _this.setState({\n        show: _this.state.show !== 'hierarchy' ? 'hierarchy' : void 0\n      });\n    };\n\n    _this.toggleAddRepr = function () {\n      return _this.setState({\n        show: _this.state.show !== 'add-repr' ? 'add-repr' : void 0\n      });\n    };\n\n    return _this;\n  }\n\n  VolumeSourceControls.prototype.defaultState = function () {\n    return {\n      header: 'Volume',\n      isCollapsed: false,\n      isBusy: false,\n      isHidden: true,\n      brand: {\n        accent: 'purple',\n        svg: BlurOnSvg\n      }\n    };\n  };\n\n  VolumeSourceControls.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection, function (sel) {\n      _this.setState({\n        isHidden: sel.hierarchy.volumes.length === 0 && sel.hierarchy.lazyVolumes.length === 0\n      });\n    });\n    this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\n      _this.setState({\n        isBusy: v\n      });\n    });\n  };\n\n  Object.defineProperty(VolumeSourceControls.prototype, \"hierarchyItems\", {\n    get: function () {\n      var mng = this.plugin.managers.volume.hierarchy;\n      var current = mng.current;\n      var ret = [];\n\n      for (var _i = 0, _a = current.volumes; _i < _a.length; _i++) {\n        var ref = _a[_i];\n        ret.push(this.item(ref));\n      }\n\n      for (var _b = 0, _c = current.lazyVolumes; _b < _c.length; _b++) {\n        var ref = _c[_b];\n        ret.push(this.item(ref));\n      }\n\n      return ret;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(VolumeSourceControls.prototype, \"addActions\", {\n    get: function () {\n      var mng = this.plugin.managers.volume.hierarchy;\n      var current = mng.selection;\n\n      var ret = __spreadArray([], VolumeHierarchyManager.getRepresentationTypes(this.plugin, current).map(function (t) {\n        return ActionMenu.Item(t[1], function () {\n          return mng.addRepresentation(current, t[0]);\n        });\n      }), true);\n\n      return ret;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(VolumeSourceControls.prototype, \"isEmpty\", {\n    get: function () {\n      var _a = this.plugin.managers.volume.hierarchy.current,\n          volumes = _a.volumes,\n          lazyVolumes = _a.lazyVolumes;\n      return volumes.length === 0 && lazyVolumes.length === 0;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(VolumeSourceControls.prototype, \"label\", {\n    get: function () {\n      var _a;\n\n      if (this.state.loadingLabel) return \"Loading \" + this.state.loadingLabel + \"...\";\n      var selected = this.plugin.managers.volume.hierarchy.selection;\n      if (!selected) return 'Nothing Selected';\n      return ((_a = selected === null || selected === void 0 ? void 0 : selected.cell.obj) === null || _a === void 0 ? void 0 : _a.label) || 'Volume';\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  VolumeSourceControls.prototype.lazyLoad = function (cell) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, url, isBinary, format, entryId, isovalues, plugin_1;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = cell.obj.data, url = _a.url, isBinary = _a.isBinary, format = _a.format, entryId = _a.entryId, isovalues = _a.isovalues;\n            this.setState({\n              isBusy: true,\n              loadingLabel: cell.obj.label\n            });\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1,, 3, 4]);\n\n            plugin_1 = this.plugin;\n            return [4\n            /*yield*/\n            , plugin_1.dataTransaction(function () {\n              return __awaiter(_this, void 0, void 0, function () {\n                var data, parsed, firstVolume, repr, _i, isovalues_1, iso;\n\n                var _a, _b, _c, _d;\n\n                return __generator(this, function (_e) {\n                  switch (_e.label) {\n                    case 0:\n                      return [4\n                      /*yield*/\n                      , plugin_1.builders.data.download({\n                        url: url,\n                        isBinary: isBinary\n                      }, {\n                        state: {\n                          isGhost: true\n                        }\n                      })];\n\n                    case 1:\n                      data = _e.sent();\n                      return [4\n                      /*yield*/\n                      , plugin_1.dataFormats.get(format).parse(plugin_1, data, {\n                        entryId: entryId\n                      })];\n\n                    case 2:\n                      parsed = _e.sent();\n                      firstVolume = parsed.volume || parsed.volumes[0];\n                      if (!(firstVolume === null || firstVolume === void 0 ? void 0 : firstVolume.isOk)) throw new Error('Failed to parse any volume.');\n                      repr = plugin_1.build();\n\n                      for (_i = 0, isovalues_1 = isovalues; _i < isovalues_1.length; _i++) {\n                        iso = isovalues_1[_i];\n                        repr.to((_c = (_a = parsed.volumes) === null || _a === void 0 ? void 0 : _a[(_b = iso.volumeIndex) !== null && _b !== void 0 ? _b : 0]) !== null && _c !== void 0 ? _c : parsed.volume).apply(StateTransforms.Representation.VolumeRepresentation3D, createVolumeRepresentationParams(this.plugin, firstVolume.data, {\n                          type: 'isosurface',\n                          typeParams: {\n                            alpha: (_d = iso.alpha) !== null && _d !== void 0 ? _d : 1,\n                            isoValue: iso.type === 'absolute' ? {\n                              kind: 'absolute',\n                              absoluteValue: iso.value\n                            } : {\n                              kind: 'relative',\n                              relativeValue: iso.value\n                            }\n                          },\n                          color: 'uniform',\n                          colorParams: {\n                            value: iso.color\n                          }\n                        }));\n                      }\n\n                      return [4\n                      /*yield*/\n                      , repr.commit()];\n\n                    case 3:\n                      _e.sent();\n\n                      return [4\n                      /*yield*/\n                      , plugin_1.build().delete(cell).commit()];\n\n                    case 4:\n                      _e.sent();\n\n                      return [2\n                      /*return*/\n                      ];\n                  }\n                });\n              });\n            })];\n\n          case 2:\n            _b.sent();\n\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            this.setState({\n              isBusy: false,\n              loadingLabel: void 0\n            });\n            return [7\n            /*endfinally*/\n            ];\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  VolumeSourceControls.prototype.renderControls = function () {\n    var disabled = this.state.isBusy || this.isEmpty;\n    var label = this.label;\n    var selected = this.plugin.managers.volume.hierarchy.selection;\n    return _jsxs(_Fragment, {\n      children: [_jsxs(\"div\", __assign({\n        className: 'msp-flex-row',\n        style: {\n          marginTop: '1px'\n        }\n      }, {\n        children: [_jsx(Button, __assign({\n          noOverflow: true,\n          flex: true,\n          onClick: this.toggleHierarchy,\n          disabled: disabled,\n          title: label\n        }, {\n          children: label\n        }), void 0), !this.isEmpty && selected && _jsx(IconButton, {\n          svg: AddSvg,\n          onClick: this.toggleAddRepr,\n          title: 'Apply a structure presets to the current hierarchy.',\n          toggleState: this.state.show === 'add-repr',\n          disabled: disabled\n        }, void 0)]\n      }), void 0), this.state.show === 'hierarchy' && _jsx(ActionMenu, {\n        items: this.hierarchyItems,\n        onSelect: this.selectCurrent\n      }, void 0), this.state.show === 'add-repr' && _jsx(ActionMenu, {\n        items: this.addActions,\n        onSelect: this.selectAdd\n      }, void 0), selected && selected.representations.length > 0 && _jsx(\"div\", __assign({\n        style: {\n          marginTop: '6px'\n        }\n      }, {\n        children: selected.representations.map(function (r) {\n          return _jsx(VolumeRepresentationControls, {\n            representation: r\n          }, r.cell.transform.ref);\n        })\n      }), void 0)]\n    }, void 0);\n  };\n\n  return VolumeSourceControls;\n}(CollapsableControls);\n\nexport { VolumeSourceControls };\n\nvar VolumeRepresentationControls =\n/** @class */\nfunction (_super) {\n  __extends(VolumeRepresentationControls, _super);\n\n  function VolumeRepresentationControls() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      action: void 0\n    };\n\n    _this.remove = function () {\n      return _this.plugin.managers.volume.hierarchy.remove([_this.props.representation], true);\n    };\n\n    _this.toggleVisible = function (e) {\n      e.preventDefault();\n      e.currentTarget.blur();\n\n      _this.plugin.managers.volume.hierarchy.toggleVisibility([_this.props.representation]);\n    };\n\n    _this.toggleUpdate = function () {\n      return _this.setState({\n        action: _this.state.action === 'update' ? void 0 : 'update'\n      });\n    };\n\n    _this.highlight = function (e) {\n      e.preventDefault();\n      if (!_this.props.representation.cell.parent) return;\n      PluginCommands.Interactivity.Object.Highlight(_this.plugin, {\n        state: _this.props.representation.cell.parent,\n        ref: _this.props.representation.cell.transform.ref\n      });\n    };\n\n    _this.clearHighlight = function (e) {\n      e.preventDefault();\n      PluginCommands.Interactivity.ClearHighlights(_this.plugin);\n    };\n\n    _this.focus = function () {\n      var _a;\n\n      var repr = _this.props.representation;\n      var objects = (_a = _this.props.representation.cell.obj) === null || _a === void 0 ? void 0 : _a.data.repr.renderObjects;\n      if (repr.cell.state.isHidden) _this.plugin.managers.volume.hierarchy.toggleVisibility([_this.props.representation], 'show');\n\n      _this.plugin.managers.camera.focusRenderObjects(objects, {\n        extraRadius: 1\n      });\n    };\n\n    return _this;\n  }\n\n  VolumeRepresentationControls.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.state.events.cell.stateUpdated, function (e) {\n      if (State.ObjectEvent.isCell(e, _this.props.representation.cell)) _this.forceUpdate();\n    });\n  };\n\n  VolumeRepresentationControls.prototype.render = function () {\n    var _a, _b, _c;\n\n    var repr = this.props.representation.cell;\n    return _jsxs(_Fragment, {\n      children: [_jsxs(\"div\", __assign({\n        className: 'msp-flex-row'\n      }, {\n        children: [_jsxs(Button, __assign({\n          noOverflow: true,\n          className: 'msp-control-button-label',\n          title: ((_a = repr.obj) === null || _a === void 0 ? void 0 : _a.label) + \". Click to focus.\",\n          onClick: this.focus,\n          onMouseEnter: this.highlight,\n          onMouseLeave: this.clearHighlight,\n          style: {\n            textAlign: 'left'\n          }\n        }, {\n          children: [(_b = repr.obj) === null || _b === void 0 ? void 0 : _b.label, _jsx(\"small\", __assign({\n            className: 'msp-25-lower-contrast-text',\n            style: {\n              float: 'right'\n            }\n          }, {\n            children: (_c = repr.obj) === null || _c === void 0 ? void 0 : _c.description\n          }), void 0)]\n        }), void 0), _jsx(IconButton, {\n          svg: repr.state.isHidden ? VisibilityOffOutlinedSvg : VisibilityOutlinedSvg,\n          toggleState: false,\n          onClick: this.toggleVisible,\n          title: (repr.state.isHidden ? 'Show' : 'Hide') + \" component\",\n          small: true,\n          className: 'msp-form-control',\n          flex: true\n        }, void 0), _jsx(IconButton, {\n          svg: DeleteOutlinedSvg,\n          onClick: this.remove,\n          title: 'Remove',\n          small: true\n        }, void 0), _jsx(IconButton, {\n          svg: MoreHorizSvg,\n          onClick: this.toggleUpdate,\n          title: 'Actions',\n          toggleState: this.state.action === 'update'\n        }, void 0)]\n      }), void 0), this.state.action === 'update' && !!repr.parent && _jsx(\"div\", __assign({\n        style: {\n          marginBottom: '6px'\n        },\n        className: 'msp-accent-offset'\n      }, {\n        children: _jsx(UpdateTransformControl, {\n          state: repr.parent,\n          transform: repr.transform,\n          customHeader: 'none',\n          noMargin: true\n        }, void 0)\n      }), void 0)]\n    }, void 0);\n  };\n\n  return VolumeRepresentationControls;\n}(PurePluginUIComponent);","map":{"version":3,"sources":["../../../src/mol-plugin-ui/structure/volume.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __awaiter, __extends, __generator, __spreadArray } from \"tslib\";\r\nimport { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\r\nimport { StructureHierarchyManager } from '../../mol-plugin-state/manager/structure/hierarchy';\r\nimport { VolumeHierarchyManager } from '../../mol-plugin-state/manager/volume/hierarchy';\r\nimport { FocusLoci } from '../../mol-plugin/behavior/dynamic/representation';\r\nimport { VolumeStreaming } from '../../mol-plugin/behavior/dynamic/volume-streaming/behavior';\r\nimport { InitVolumeStreaming } from '../../mol-plugin/behavior/dynamic/volume-streaming/transformers';\r\nimport { State, StateSelection, StateTransform } from '../../mol-state';\r\nimport { CollapsableControls, PurePluginUIComponent } from '../base';\r\nimport { ActionMenu } from '../controls/action-menu';\r\nimport { Button, ExpandGroup, IconButton } from '../controls/common';\r\nimport { ApplyActionControl } from '../state/apply-action';\r\nimport { UpdateTransformControl } from '../state/update-transform';\r\nimport { BindingsHelp } from '../viewport/help';\r\nimport { PluginCommands } from '../../mol-plugin/commands';\r\nimport { BlurOnSvg, ErrorSvg, CheckSvg, AddSvg, VisibilityOffOutlinedSvg, VisibilityOutlinedSvg, DeleteOutlinedSvg, MoreHorizSvg } from '../controls/icons';\r\nimport { StateTransforms } from '../../mol-plugin-state/transforms';\r\nimport { createVolumeRepresentationParams } from '../../mol-plugin-state/helpers/volume-representation-params';\r\nvar VolumeStreamingControls = /** @class */ (function (_super) {\r\n    __extends(VolumeStreamingControls, _super);\r\n    function VolumeStreamingControls() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    VolumeStreamingControls.prototype.defaultState = function () {\r\n        return {\r\n            header: 'Volume Streaming',\r\n            isCollapsed: false,\r\n            isBusy: false,\r\n            isHidden: true,\r\n            brand: { accent: 'cyan', svg: BlurOnSvg }\r\n        };\r\n    };\r\n    VolumeStreamingControls.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        // TODO: do not hide this but instead show some help text??\r\n        this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection, function () {\r\n            _this.setState({\r\n                isHidden: !_this.canEnable(),\r\n                description: StructureHierarchyManager.getSelectedStructuresDescription(_this.plugin)\r\n            });\r\n        });\r\n        this.subscribe(this.plugin.state.events.cell.stateUpdated, function (e) {\r\n            if (StateTransform.hasTag(e.cell.transform, VolumeStreaming.RootTag))\r\n                _this.forceUpdate();\r\n        });\r\n        this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\r\n            _this.setState({ isBusy: v });\r\n        });\r\n    };\r\n    Object.defineProperty(VolumeStreamingControls.prototype, \"pivot\", {\r\n        get: function () {\r\n            return this.plugin.managers.structure.hierarchy.selection.structures[0];\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    VolumeStreamingControls.prototype.canEnable = function () {\r\n        var _a, _b;\r\n        var selection = this.plugin.managers.structure.hierarchy.selection;\r\n        if (selection.structures.length !== 1)\r\n            return false;\r\n        var pivot = this.pivot.cell;\r\n        if (!pivot.obj)\r\n            return false;\r\n        return !!((_b = (_a = InitVolumeStreaming.definition).isApplicable) === null || _b === void 0 ? void 0 : _b.call(_a, pivot.obj, pivot.transform, this.plugin));\r\n    };\r\n    VolumeStreamingControls.prototype.renderEnable = function () {\r\n        var _a;\r\n        var pivot = this.pivot;\r\n        if (!pivot.cell.parent)\r\n            return null;\r\n        var root = StateSelection.findTagInSubtree(pivot.cell.parent.tree, this.pivot.cell.transform.ref, VolumeStreaming.RootTag);\r\n        var rootCell = root && pivot.cell.parent.cells.get(root);\r\n        var simpleApply = rootCell && rootCell.status === 'error'\r\n            ? { header: 'Error enabling', icon: ErrorSvg, title: rootCell.errorText }\r\n            : rootCell && ((_a = rootCell.obj) === null || _a === void 0 ? void 0 : _a.data.entries.length) === 0\r\n                ? { header: 'Error enabling', icon: ErrorSvg, title: 'No entry for streaming found' }\r\n                : { header: 'Enable', icon: CheckSvg, title: 'Enable' };\r\n        return _jsx(ApplyActionControl, { state: pivot.cell.parent, action: InitVolumeStreaming, initiallyCollapsed: true, nodeRef: pivot.cell.transform.ref, simpleApply: simpleApply }, void 0);\r\n    };\r\n    VolumeStreamingControls.prototype.renderParams = function () {\r\n        var _a, _b, _c, _d, _e;\r\n        var pivot = this.pivot;\r\n        if (!pivot.cell.parent)\r\n            return null;\r\n        var bindings = ((_b = (_a = pivot.volumeStreaming) === null || _a === void 0 ? void 0 : _a.cell.transform.params) === null || _b === void 0 ? void 0 : _b.entry.params.view.name) === 'selection-box' && ((_e = (_d = (_c = this.plugin.state.behaviors.cells.get(FocusLoci.id)) === null || _c === void 0 ? void 0 : _c.params) === null || _d === void 0 ? void 0 : _d.values) === null || _e === void 0 ? void 0 : _e.bindings);\r\n        return _jsxs(_Fragment, { children: [_jsx(UpdateTransformControl, { state: pivot.cell.parent, transform: pivot.volumeStreaming.cell.transform, customHeader: 'none', noMargin: true }, void 0), bindings && _jsx(ExpandGroup, __assign({ header: 'Controls Help' }, { children: _jsx(BindingsHelp, { bindings: bindings }, void 0) }), void 0)] }, void 0);\r\n    };\r\n    VolumeStreamingControls.prototype.renderControls = function () {\r\n        var pivot = this.pivot;\r\n        if (!pivot)\r\n            return null;\r\n        if (!pivot.volumeStreaming)\r\n            return this.renderEnable();\r\n        return this.renderParams();\r\n    };\r\n    return VolumeStreamingControls;\r\n}(CollapsableControls));\r\nexport { VolumeStreamingControls };\r\nvar VolumeSourceControls = /** @class */ (function (_super) {\r\n    __extends(VolumeSourceControls, _super);\r\n    function VolumeSourceControls() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.item = function (ref) {\r\n            var _a;\r\n            var selected = _this.plugin.managers.volume.hierarchy.selection;\r\n            var label = ((_a = ref.cell.obj) === null || _a === void 0 ? void 0 : _a.label) || 'Volume';\r\n            var item = {\r\n                kind: 'item',\r\n                label: (ref.kind === 'lazy-volume' ? 'Load ' : '') + (label || ref.kind),\r\n                selected: selected === ref,\r\n                value: ref\r\n            };\r\n            return item;\r\n        };\r\n        _this.selectCurrent = function (item) {\r\n            _this.toggleHierarchy();\r\n            if (!item)\r\n                return;\r\n            var current = item.value;\r\n            if (current.kind === 'volume') {\r\n                _this.plugin.managers.volume.hierarchy.setCurrent(current);\r\n            }\r\n            else {\r\n                _this.lazyLoad(current.cell);\r\n            }\r\n        };\r\n        _this.selectAdd = function (item) {\r\n            if (!item)\r\n                return;\r\n            _this.setState({ show: void 0 });\r\n            item.value();\r\n        };\r\n        _this.toggleHierarchy = function () { return _this.setState({ show: _this.state.show !== 'hierarchy' ? 'hierarchy' : void 0 }); };\r\n        _this.toggleAddRepr = function () { return _this.setState({ show: _this.state.show !== 'add-repr' ? 'add-repr' : void 0 }); };\r\n        return _this;\r\n    }\r\n    VolumeSourceControls.prototype.defaultState = function () {\r\n        return {\r\n            header: 'Volume',\r\n            isCollapsed: false,\r\n            isBusy: false,\r\n            isHidden: true,\r\n            brand: { accent: 'purple', svg: BlurOnSvg }\r\n        };\r\n    };\r\n    VolumeSourceControls.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection, function (sel) {\r\n            _this.setState({ isHidden: sel.hierarchy.volumes.length === 0 && sel.hierarchy.lazyVolumes.length === 0 });\r\n        });\r\n        this.subscribe(this.plugin.behaviors.state.isBusy, function (v) {\r\n            _this.setState({ isBusy: v });\r\n        });\r\n    };\r\n    Object.defineProperty(VolumeSourceControls.prototype, \"hierarchyItems\", {\r\n        get: function () {\r\n            var mng = this.plugin.managers.volume.hierarchy;\r\n            var current = mng.current;\r\n            var ret = [];\r\n            for (var _i = 0, _a = current.volumes; _i < _a.length; _i++) {\r\n                var ref = _a[_i];\r\n                ret.push(this.item(ref));\r\n            }\r\n            for (var _b = 0, _c = current.lazyVolumes; _b < _c.length; _b++) {\r\n                var ref = _c[_b];\r\n                ret.push(this.item(ref));\r\n            }\r\n            return ret;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(VolumeSourceControls.prototype, \"addActions\", {\r\n        get: function () {\r\n            var mng = this.plugin.managers.volume.hierarchy;\r\n            var current = mng.selection;\r\n            var ret = __spreadArray([], VolumeHierarchyManager.getRepresentationTypes(this.plugin, current)\r\n                .map(function (t) { return ActionMenu.Item(t[1], function () { return mng.addRepresentation(current, t[0]); }); }), true);\r\n            return ret;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(VolumeSourceControls.prototype, \"isEmpty\", {\r\n        get: function () {\r\n            var _a = this.plugin.managers.volume.hierarchy.current, volumes = _a.volumes, lazyVolumes = _a.lazyVolumes;\r\n            return volumes.length === 0 && lazyVolumes.length === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(VolumeSourceControls.prototype, \"label\", {\r\n        get: function () {\r\n            var _a;\r\n            if (this.state.loadingLabel)\r\n                return \"Loading \" + this.state.loadingLabel + \"...\";\r\n            var selected = this.plugin.managers.volume.hierarchy.selection;\r\n            if (!selected)\r\n                return 'Nothing Selected';\r\n            return ((_a = selected === null || selected === void 0 ? void 0 : selected.cell.obj) === null || _a === void 0 ? void 0 : _a.label) || 'Volume';\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    VolumeSourceControls.prototype.lazyLoad = function (cell) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, url, isBinary, format, entryId, isovalues, plugin_1;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = cell.obj.data, url = _a.url, isBinary = _a.isBinary, format = _a.format, entryId = _a.entryId, isovalues = _a.isovalues;\r\n                        this.setState({ isBusy: true, loadingLabel: cell.obj.label });\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, , 3, 4]);\r\n                        plugin_1 = this.plugin;\r\n                        return [4 /*yield*/, plugin_1.dataTransaction(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                var data, parsed, firstVolume, repr, _i, isovalues_1, iso;\r\n                                var _a, _b, _c, _d;\r\n                                return __generator(this, function (_e) {\r\n                                    switch (_e.label) {\r\n                                        case 0: return [4 /*yield*/, plugin_1.builders.data.download({ url: url, isBinary: isBinary }, { state: { isGhost: true } })];\r\n                                        case 1:\r\n                                            data = _e.sent();\r\n                                            return [4 /*yield*/, plugin_1.dataFormats.get(format).parse(plugin_1, data, { entryId: entryId })];\r\n                                        case 2:\r\n                                            parsed = _e.sent();\r\n                                            firstVolume = (parsed.volume || parsed.volumes[0]);\r\n                                            if (!(firstVolume === null || firstVolume === void 0 ? void 0 : firstVolume.isOk))\r\n                                                throw new Error('Failed to parse any volume.');\r\n                                            repr = plugin_1.build();\r\n                                            for (_i = 0, isovalues_1 = isovalues; _i < isovalues_1.length; _i++) {\r\n                                                iso = isovalues_1[_i];\r\n                                                repr\r\n                                                    .to((_c = (_a = parsed.volumes) === null || _a === void 0 ? void 0 : _a[(_b = iso.volumeIndex) !== null && _b !== void 0 ? _b : 0]) !== null && _c !== void 0 ? _c : parsed.volume)\r\n                                                    .apply(StateTransforms.Representation.VolumeRepresentation3D, createVolumeRepresentationParams(this.plugin, firstVolume.data, {\r\n                                                    type: 'isosurface',\r\n                                                    typeParams: { alpha: (_d = iso.alpha) !== null && _d !== void 0 ? _d : 1, isoValue: iso.type === 'absolute' ? { kind: 'absolute', absoluteValue: iso.value } : { kind: 'relative', relativeValue: iso.value } },\r\n                                                    color: 'uniform',\r\n                                                    colorParams: { value: iso.color }\r\n                                                }));\r\n                                            }\r\n                                            return [4 /*yield*/, repr.commit()];\r\n                                        case 3:\r\n                                            _e.sent();\r\n                                            return [4 /*yield*/, plugin_1.build().delete(cell).commit()];\r\n                                        case 4:\r\n                                            _e.sent();\r\n                                            return [2 /*return*/];\r\n                                    }\r\n                                });\r\n                            }); })];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        this.setState({ isBusy: false, loadingLabel: void 0 });\r\n                        return [7 /*endfinally*/];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    VolumeSourceControls.prototype.renderControls = function () {\r\n        var disabled = this.state.isBusy || this.isEmpty;\r\n        var label = this.label;\r\n        var selected = this.plugin.managers.volume.hierarchy.selection;\r\n        return _jsxs(_Fragment, { children: [_jsxs(\"div\", __assign({ className: 'msp-flex-row', style: { marginTop: '1px' } }, { children: [_jsx(Button, __assign({ noOverflow: true, flex: true, onClick: this.toggleHierarchy, disabled: disabled, title: label }, { children: label }), void 0), !this.isEmpty && selected && _jsx(IconButton, { svg: AddSvg, onClick: this.toggleAddRepr, title: 'Apply a structure presets to the current hierarchy.', toggleState: this.state.show === 'add-repr', disabled: disabled }, void 0)] }), void 0), this.state.show === 'hierarchy' && _jsx(ActionMenu, { items: this.hierarchyItems, onSelect: this.selectCurrent }, void 0), this.state.show === 'add-repr' && _jsx(ActionMenu, { items: this.addActions, onSelect: this.selectAdd }, void 0), selected && selected.representations.length > 0 && _jsx(\"div\", __assign({ style: { marginTop: '6px' } }, { children: selected.representations.map(function (r) { return _jsx(VolumeRepresentationControls, { representation: r }, r.cell.transform.ref); }) }), void 0)] }, void 0);\r\n    };\r\n    return VolumeSourceControls;\r\n}(CollapsableControls));\r\nexport { VolumeSourceControls };\r\nvar VolumeRepresentationControls = /** @class */ (function (_super) {\r\n    __extends(VolumeRepresentationControls, _super);\r\n    function VolumeRepresentationControls() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = { action: void 0 };\r\n        _this.remove = function () { return _this.plugin.managers.volume.hierarchy.remove([_this.props.representation], true); };\r\n        _this.toggleVisible = function (e) {\r\n            e.preventDefault();\r\n            e.currentTarget.blur();\r\n            _this.plugin.managers.volume.hierarchy.toggleVisibility([_this.props.representation]);\r\n        };\r\n        _this.toggleUpdate = function () { return _this.setState({ action: _this.state.action === 'update' ? void 0 : 'update' }); };\r\n        _this.highlight = function (e) {\r\n            e.preventDefault();\r\n            if (!_this.props.representation.cell.parent)\r\n                return;\r\n            PluginCommands.Interactivity.Object.Highlight(_this.plugin, { state: _this.props.representation.cell.parent, ref: _this.props.representation.cell.transform.ref });\r\n        };\r\n        _this.clearHighlight = function (e) {\r\n            e.preventDefault();\r\n            PluginCommands.Interactivity.ClearHighlights(_this.plugin);\r\n        };\r\n        _this.focus = function () {\r\n            var _a;\r\n            var repr = _this.props.representation;\r\n            var objects = (_a = _this.props.representation.cell.obj) === null || _a === void 0 ? void 0 : _a.data.repr.renderObjects;\r\n            if (repr.cell.state.isHidden)\r\n                _this.plugin.managers.volume.hierarchy.toggleVisibility([_this.props.representation], 'show');\r\n            _this.plugin.managers.camera.focusRenderObjects(objects, { extraRadius: 1 });\r\n        };\r\n        return _this;\r\n    }\r\n    VolumeRepresentationControls.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.state.events.cell.stateUpdated, function (e) {\r\n            if (State.ObjectEvent.isCell(e, _this.props.representation.cell))\r\n                _this.forceUpdate();\r\n        });\r\n    };\r\n    VolumeRepresentationControls.prototype.render = function () {\r\n        var _a, _b, _c;\r\n        var repr = this.props.representation.cell;\r\n        return _jsxs(_Fragment, { children: [_jsxs(\"div\", __assign({ className: 'msp-flex-row' }, { children: [_jsxs(Button, __assign({ noOverflow: true, className: 'msp-control-button-label', title: ((_a = repr.obj) === null || _a === void 0 ? void 0 : _a.label) + \". Click to focus.\", onClick: this.focus, onMouseEnter: this.highlight, onMouseLeave: this.clearHighlight, style: { textAlign: 'left' } }, { children: [(_b = repr.obj) === null || _b === void 0 ? void 0 : _b.label, _jsx(\"small\", __assign({ className: 'msp-25-lower-contrast-text', style: { float: 'right' } }, { children: (_c = repr.obj) === null || _c === void 0 ? void 0 : _c.description }), void 0)] }), void 0), _jsx(IconButton, { svg: repr.state.isHidden ? VisibilityOffOutlinedSvg : VisibilityOutlinedSvg, toggleState: false, onClick: this.toggleVisible, title: (repr.state.isHidden ? 'Show' : 'Hide') + \" component\", small: true, className: 'msp-form-control', flex: true }, void 0), _jsx(IconButton, { svg: DeleteOutlinedSvg, onClick: this.remove, title: 'Remove', small: true }, void 0), _jsx(IconButton, { svg: MoreHorizSvg, onClick: this.toggleUpdate, title: 'Actions', toggleState: this.state.action === 'update' }, void 0)] }), void 0), this.state.action === 'update' && !!repr.parent && _jsx(\"div\", __assign({ style: { marginBottom: '6px' }, className: 'msp-accent-offset' }, { children: _jsx(UpdateTransformControl, { state: repr.parent, transform: repr.transform, customHeader: 'none', noMargin: true }, void 0) }), void 0)] }, void 0);\r\n    };\r\n    return VolumeRepresentationControls;\r\n}(PurePluginUIComponent));\r\n//# sourceMappingURL=volume.js.map"]},"metadata":{},"sourceType":"module"}