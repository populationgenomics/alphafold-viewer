{"ast":null,"code":"/**\r\n * Copyright (c) 2018-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { __assign } from \"tslib\";\nimport { Unit, StructureElement, StructureProperties as Props } from '../mol-model/structure';\nimport { Loci } from '../mol-model/loci';\nimport { OrderedSet } from '../mol-data/int';\nimport { capitalize, stripTags } from '../mol-util/string';\nimport { Vec3 } from '../mol-math/linear-algebra';\nimport { radToDeg } from '../mol-math/misc';\nimport { Volume } from '../mol-model/volume';\nexport var DefaultLabelOptions = {\n  granularity: 'element',\n  condensed: false,\n  reverse: false,\n  countsOnly: false,\n  hidePrefix: false,\n  htmlStyling: true\n};\nexport function lociLabel(loci, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  switch (loci.kind) {\n    case 'structure-loci':\n      return loci.structure.models.map(function (m) {\n        return m.entry;\n      }).filter(function (l) {\n        return !!l;\n      }).join(', ');\n\n    case 'element-loci':\n      return structureElementStatsLabel(StructureElement.Stats.ofLoci(loci), options);\n\n    case 'bond-loci':\n      var bond = loci.bonds[0];\n      return bond ? bondLabel(bond) : '';\n\n    case 'shape-loci':\n      return loci.shape.name;\n\n    case 'group-loci':\n      var g = loci.groups[0];\n      return g ? loci.shape.getLabel(OrderedSet.start(g.ids), g.instance) : '';\n\n    case 'every-loci':\n      return 'Everything';\n\n    case 'empty-loci':\n      return 'Nothing';\n\n    case 'data-loci':\n      return loci.getLabel();\n\n    case 'volume-loci':\n      return loci.volume.label || 'Volume';\n\n    case 'isosurface-loci':\n      return [\"\" + (loci.volume.label || 'Volume'), \"Isosurface at \" + Volume.IsoValue.toString(loci.isoValue)].join(' | ');\n\n    case 'cell-loci':\n      var size = OrderedSet.size(loci.indices);\n      var start = OrderedSet.start(loci.indices);\n      var absVal = Volume.IsoValue.absolute(loci.volume.grid.cells.data[start]);\n      var relVal = Volume.IsoValue.toRelative(absVal, loci.volume.grid.stats);\n      var label = [\"\" + (loci.volume.label || 'Volume'), \"\" + (size === 1 ? \"Cell #\" + start : size + \" Cells\")];\n\n      if (size === 1) {\n        label.push(Volume.IsoValue.toString(absVal) + \" (\" + Volume.IsoValue.toString(relVal) + \")\");\n      }\n\n      return label.join(' | ');\n  }\n}\n\nfunction countLabel(count, label) {\n  return count === 1 ? \"1 \" + label : count + \" \" + label + \"s\";\n}\n\nfunction otherLabel(count, location, granularity, hidePrefix, reverse, condensed) {\n  return elementLabel(location, {\n    granularity: granularity,\n    hidePrefix: hidePrefix,\n    reverse: reverse,\n    condensed: condensed\n  }) + \" <small>[+ \" + countLabel(count - 1, \"other \" + capitalize(granularity)) + \"]</small>\";\n}\n/** Gets residue count of the model chain segments the unit is a subset of */\n\n\nfunction getResidueCount(unit) {\n  var elements = unit.elements,\n      model = unit.model;\n  var _a = model.atomicHierarchy,\n      chainAtomSegments = _a.chainAtomSegments,\n      residueAtomSegments = _a.residueAtomSegments;\n  var elementStart = chainAtomSegments.offsets[chainAtomSegments.index[elements[0]]];\n  var elementEnd = chainAtomSegments.offsets[chainAtomSegments.index[elements[elements.length - 1]] + 1] - 1;\n  return residueAtomSegments.index[elementEnd] - residueAtomSegments.index[elementStart] + 1;\n}\n\nexport function structureElementStatsLabel(stats, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var o = __assign(__assign({}, DefaultLabelOptions), options);\n\n  var label = _structureElementStatsLabel(stats, o.countsOnly, o.hidePrefix, o.condensed, o.reverse);\n\n  return o.htmlStyling ? label : stripTags(label);\n}\n\nfunction _structureElementStatsLabel(stats, countsOnly, hidePrefix, condensed, reverse) {\n  if (countsOnly === void 0) {\n    countsOnly = false;\n  }\n\n  if (hidePrefix === void 0) {\n    hidePrefix = false;\n  }\n\n  if (condensed === void 0) {\n    condensed = false;\n  }\n\n  if (reverse === void 0) {\n    reverse = false;\n  }\n\n  var structureCount = stats.structureCount,\n      chainCount = stats.chainCount,\n      residueCount = stats.residueCount,\n      conformationCount = stats.conformationCount,\n      elementCount = stats.elementCount;\n\n  if (!countsOnly && elementCount === 1 && residueCount === 0 && chainCount === 0) {\n    return elementLabel(stats.firstElementLoc, {\n      hidePrefix: hidePrefix,\n      condensed: condensed,\n      granularity: 'element',\n      reverse: reverse\n    });\n  } else if (!countsOnly && elementCount === 0 && residueCount === 1 && chainCount === 0) {\n    return elementLabel(stats.firstResidueLoc, {\n      hidePrefix: hidePrefix,\n      condensed: condensed,\n      granularity: 'residue',\n      reverse: reverse\n    });\n  } else if (!countsOnly && elementCount === 0 && residueCount === 0 && chainCount === 1) {\n    var unit = stats.firstChainLoc.unit;\n    var granularity = Unit.isAtomic(unit) && getResidueCount(unit) === 1 ? 'residue' : Unit.Traits.is(unit.traits, 1\n    /* MultiChain */\n    ) ? 'residue' : 'chain';\n    return elementLabel(stats.firstChainLoc, {\n      hidePrefix: hidePrefix,\n      condensed: condensed,\n      granularity: granularity,\n      reverse: reverse\n    });\n  } else if (!countsOnly) {\n    var label = [];\n\n    if (structureCount > 0) {\n      label.push(structureCount === 1 ? elementLabel(stats.firstStructureLoc, {\n        hidePrefix: hidePrefix,\n        condensed: condensed,\n        granularity: 'structure',\n        reverse: reverse\n      }) : otherLabel(structureCount, stats.firstStructureLoc, 'structure', hidePrefix, reverse, condensed));\n    }\n\n    if (chainCount > 0) {\n      label.push(chainCount === 1 ? elementLabel(stats.firstChainLoc, {\n        condensed: condensed,\n        granularity: 'chain',\n        hidePrefix: hidePrefix,\n        reverse: reverse\n      }) : otherLabel(chainCount, stats.firstChainLoc, 'chain', hidePrefix, reverse, condensed));\n      hidePrefix = true;\n    }\n\n    if (residueCount > 0) {\n      label.push(residueCount === 1 ? elementLabel(stats.firstResidueLoc, {\n        condensed: condensed,\n        granularity: 'residue',\n        hidePrefix: hidePrefix,\n        reverse: reverse\n      }) : otherLabel(residueCount, stats.firstResidueLoc, 'residue', hidePrefix, reverse, condensed));\n      hidePrefix = true;\n    }\n\n    if (conformationCount > 0) {\n      label.push(conformationCount === 1 ? elementLabel(stats.firstConformationLoc, {\n        condensed: condensed,\n        granularity: 'conformation',\n        hidePrefix: hidePrefix,\n        reverse: reverse\n      }) : otherLabel(conformationCount, stats.firstConformationLoc, 'conformation', hidePrefix, reverse, condensed));\n      hidePrefix = true;\n    }\n\n    if (elementCount > 0) {\n      label.push(elementCount === 1 ? elementLabel(stats.firstElementLoc, {\n        condensed: condensed,\n        granularity: 'element',\n        hidePrefix: hidePrefix,\n        reverse: reverse\n      }) : otherLabel(elementCount, stats.firstElementLoc, 'element', hidePrefix, reverse, condensed));\n    }\n\n    return label.join('<small> + </small>');\n  } else {\n    var label = [];\n    if (structureCount > 0) label.push(countLabel(structureCount, 'Structure'));\n    if (chainCount > 0) label.push(countLabel(chainCount, 'Chain'));\n    if (residueCount > 0) label.push(countLabel(residueCount, 'Residue'));\n    if (conformationCount > 0) label.push(countLabel(conformationCount, 'Conformation'));\n    if (elementCount > 0) label.push(countLabel(elementCount, 'Element'));\n    return label.join('<small> + </small>');\n  }\n}\n\nexport function bondLabel(bond, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return bundleLabel({\n    loci: [StructureElement.Loci(bond.aStructure, [{\n      unit: bond.aUnit,\n      indices: OrderedSet.ofSingleton(bond.aIndex)\n    }]), StructureElement.Loci(bond.bStructure, [{\n      unit: bond.bUnit,\n      indices: OrderedSet.ofSingleton(bond.bIndex)\n    }])]\n  }, options);\n}\nexport function bundleLabel(bundle, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var o = __assign(__assign({}, DefaultLabelOptions), options);\n\n  var label = _bundleLabel(bundle, o);\n\n  return o.htmlStyling ? label : stripTags(label);\n}\nexport function _bundleLabel(bundle, options) {\n  var granularity = options.granularity,\n      hidePrefix = options.hidePrefix,\n      reverse = options.reverse,\n      condensed = options.condensed;\n  var isSingleElements = true;\n\n  for (var _i = 0, _a = bundle.loci; _i < _a.length; _i++) {\n    var l = _a[_i];\n\n    if (!StructureElement.Loci.is(l) || StructureElement.Loci.size(l) !== 1) {\n      isSingleElements = false;\n      break;\n    }\n  }\n\n  if (isSingleElements) {\n    var locations = bundle.loci.map(function (l) {\n      var _a = l.elements[0],\n          unit = _a.unit,\n          indices = _a.indices;\n      return StructureElement.Location.create(l.structure, unit, unit.elements[OrderedSet.start(indices)]);\n    });\n    var labels = locations.map(function (l) {\n      return _elementLabel(l, granularity, hidePrefix, reverse || condensed);\n    });\n\n    if (condensed) {\n      return labels.map(function (l) {\n        return l[0].replace(/\\[.*\\]/g, '').trim();\n      }).filter(function (l) {\n        return !!l;\n      }).join(' \\u2014 ');\n    }\n\n    var offset = 0;\n\n    for (var i = 0, il = Math.min.apply(Math, labels.map(function (l) {\n      return l.length;\n    })) - 1; i < il; ++i) {\n      var areIdentical = true;\n\n      for (var j = 1, jl = labels.length; j < jl; ++j) {\n        if (labels[0][i] !== labels[j][i]) {\n          areIdentical = false;\n          break;\n        }\n      }\n\n      if (areIdentical) offset += 1;else break;\n    }\n\n    if (offset > 0) {\n      var offsetLabels = [labels[0].join(' | ')];\n\n      for (var j = 1, jl = labels.length; j < jl; ++j) {\n        offsetLabels.push(labels[j].slice(offset).filter(function (l) {\n          return !!l;\n        }).join(' | '));\n      }\n\n      return offsetLabels.join(' \\u2014 ');\n    } else {\n      return labels.map(function (l) {\n        return l.filter(function (l) {\n          return !!l;\n        }).join(' | ');\n      }).filter(function (l) {\n        return !!l;\n      }).join('</br>');\n    }\n  } else {\n    var labels = bundle.loci.map(function (l) {\n      return lociLabel(l, options);\n    });\n    return labels.filter(function (l) {\n      return !!l;\n    }).join(condensed ? ' \\u2014 ' : '</br>');\n  }\n}\nexport function elementLabel(location, options) {\n  var _a, _b;\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  var o = __assign(__assign({}, DefaultLabelOptions), options);\n\n  var _label = _elementLabel(location, o.granularity, o.hidePrefix, o.reverse || o.condensed); // TODO: condensed label for single atom structure returns empty label.. handle this case here?\n\n\n  var label = o.condensed ? (_b = (_a = _label[0]) === null || _a === void 0 ? void 0 : _a.replace(/\\[.*\\]/g, '').trim()) !== null && _b !== void 0 ? _b : '' : _label.filter(function (l) {\n    return !!l;\n  }).join(' | ');\n  return o.htmlStyling ? label : stripTags(label);\n}\n\nfunction _elementLabel(location, granularity, hidePrefix, reverse) {\n  if (granularity === void 0) {\n    granularity = 'element';\n  }\n\n  if (hidePrefix === void 0) {\n    hidePrefix = false;\n  }\n\n  if (reverse === void 0) {\n    reverse = false;\n  }\n\n  var label = [];\n\n  if (!hidePrefix) {\n    var entry = location.unit.model.entry;\n    if (entry.length > 30) entry = entry.substr(0, 27) + '\\u2026'; // ellipsis\n\n    label.push(\"<small>\" + entry + \"</small>\"); // entry\n\n    if (granularity !== 'structure') {\n      label.push(\"<small>Model \" + location.unit.model.modelNum + \"</small>\"); // model\n\n      label.push(\"<small>Instance \" + location.unit.conformation.operator.name + \"</small>\"); // instance\n    }\n  }\n\n  if (Unit.isAtomic(location.unit)) {\n    label.push.apply(label, _atomicElementLabel(location, granularity, reverse));\n  } else if (Unit.isCoarse(location.unit)) {\n    label.push.apply(label, _coarseElementLabel(location, granularity));\n  } else {\n    label.push('Unknown');\n  }\n\n  return reverse ? label.reverse() : label;\n}\n\nfunction _atomicElementLabel(location, granularity, hideOccupancy) {\n  if (hideOccupancy === void 0) {\n    hideOccupancy = false;\n  }\n\n  var rI = StructureElement.Location.residueIndex(location);\n  var label_asym_id = Props.chain.label_asym_id(location);\n  var auth_asym_id = Props.chain.auth_asym_id(location);\n  var has_label_seq_id = location.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(rI) === 0\n  /* Present */\n  ;\n  var label_seq_id = Props.residue.label_seq_id(location);\n  var auth_seq_id = Props.residue.auth_seq_id(location);\n  var ins_code = Props.residue.pdbx_PDB_ins_code(location);\n  var comp_id = Props.atom.label_comp_id(location);\n  var atom_id = Props.atom.label_atom_id(location);\n  var alt_id = Props.atom.label_alt_id(location);\n  var occupancy = Props.atom.occupancy(location);\n  var microHetCompIds = Props.residue.microheterogeneityCompIds(location);\n  var compId = granularity === 'residue' && microHetCompIds.length > 1 ? \"(\" + microHetCompIds.join('|') + \")\" : comp_id;\n  var label = [];\n\n  switch (granularity) {\n    case 'element':\n      label.push(\"<b>\" + atom_id + \"</b>\" + (alt_id ? \"%\" + alt_id : ''));\n\n    case 'conformation':\n      if (granularity === 'conformation' && alt_id) {\n        label.push(\"<small>Conformation</small> <b>\" + alt_id + \"</b>\");\n      }\n\n    case 'residue':\n      var seq_id = label_seq_id === auth_seq_id || !has_label_seq_id ? auth_seq_id : label_seq_id;\n      label.push(\"<b>\" + compId + \" \" + seq_id + \"</b>\" + (seq_id !== auth_seq_id ? \" <small>[auth</small> <b>\" + auth_seq_id + \"</b><small>]</small>\" : '') + \"<b>\" + (ins_code ? ins_code : '') + \"</b>\");\n\n    case 'chain':\n      if (label_asym_id === auth_asym_id) {\n        label.push(\"<b>\" + label_asym_id + \"</b>\");\n      } else {\n        if (granularity === 'chain' && Unit.Traits.is(location.unit.traits, 1\n        /* MultiChain */\n        )) {\n          label.push(\"<small>[auth</small> <b>\" + auth_asym_id + \"</b><small>]</small>\");\n        } else {\n          label.push(\"<b>\" + label_asym_id + \"</b> <small>[auth</small> <b>\" + auth_asym_id + \"</b><small>]</small>\");\n        }\n      }\n\n  }\n\n  if (label.length > 0 && occupancy !== 1 && !hideOccupancy) {\n    label[0] = label[0] + \" <small>[occupancy</small> <b>\" + Math.round(100 * occupancy) / 100 + \"</b><small>]</small>\";\n  }\n\n  return label.reverse();\n}\n\nfunction _coarseElementLabel(location, granularity) {\n  var asym_id = Props.coarse.asym_id(location);\n  var seq_id_begin = Props.coarse.seq_id_begin(location);\n  var seq_id_end = Props.coarse.seq_id_end(location);\n  var label = [];\n\n  switch (granularity) {\n    case 'element':\n    case 'conformation':\n    case 'residue':\n      if (seq_id_begin === seq_id_end) {\n        var entityIndex = Props.coarse.entityKey(location);\n        var seq = location.unit.model.sequence.byEntityKey[entityIndex];\n        var comp_id = seq.sequence.compId.value(seq_id_begin - 1); // 1-indexed\n\n        label.push(\"<b>\" + comp_id + \" \" + seq_id_begin + \"</b>\");\n      } else {\n        label.push(\"<b>\" + seq_id_begin + \"-\" + seq_id_end + \"</b>\");\n      }\n\n    case 'chain':\n      label.push(\"<b>\" + asym_id + \"</b>\");\n  }\n\n  return label.reverse();\n} //\n\n\nexport function distanceLabel(pair, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var o = __assign(__assign(__assign({}, DefaultLabelOptions), {\n    measureOnly: false,\n    unitLabel: '\\u212B'\n  }), options);\n\n  var _a = pair.loci.map(function (l) {\n    return Loci.getCenter(l);\n  }),\n      cA = _a[0],\n      cB = _a[1];\n\n  var distance = Vec3.distance(cA, cB).toFixed(2) + \" \" + o.unitLabel;\n  if (o.measureOnly) return distance;\n  var label = bundleLabel(pair, o);\n  return o.condensed ? distance + \" | \" + label : \"Distance \" + distance + \"</br>\" + label;\n}\nexport function angleLabel(triple, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var o = __assign(__assign(__assign({}, DefaultLabelOptions), {\n    measureOnly: false\n  }), options);\n\n  var _a = triple.loci.map(function (l) {\n    return Loci.getCenter(l);\n  }),\n      cA = _a[0],\n      cB = _a[1],\n      cC = _a[2];\n\n  var vAB = Vec3.sub(Vec3(), cA, cB);\n  var vCB = Vec3.sub(Vec3(), cC, cB);\n  var angle = radToDeg(Vec3.angle(vAB, vCB)).toFixed(2) + \"\\u00B0\";\n  if (o.measureOnly) return angle;\n  var label = bundleLabel(triple, o);\n  return o.condensed ? angle + \" | \" + label : \"Angle \" + angle + \"</br>\" + label;\n}\nexport function dihedralLabel(quad, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var o = __assign(__assign(__assign({}, DefaultLabelOptions), {\n    measureOnly: false\n  }), options);\n\n  var _a = quad.loci.map(function (l) {\n    return Loci.getCenter(l);\n  }),\n      cA = _a[0],\n      cB = _a[1],\n      cC = _a[2],\n      cD = _a[3];\n\n  var dihedral = radToDeg(Vec3.dihedralAngle(cA, cB, cC, cD)).toFixed(2) + \"\\u00B0\";\n  if (o.measureOnly) return dihedral;\n  var label = bundleLabel(quad, o);\n  return o.condensed ? dihedral + \" | \" + label : \"Dihedral \" + dihedral + \"</br>\" + label;\n}","map":{"version":3,"sources":["../../src/mol-theme/label.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2018-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { __assign } from \"tslib\";\r\nimport { Unit, StructureElement, StructureProperties as Props } from '../mol-model/structure';\r\nimport { Loci } from '../mol-model/loci';\r\nimport { OrderedSet } from '../mol-data/int';\r\nimport { capitalize, stripTags } from '../mol-util/string';\r\nimport { Vec3 } from '../mol-math/linear-algebra';\r\nimport { radToDeg } from '../mol-math/misc';\r\nimport { Volume } from '../mol-model/volume';\r\nexport var DefaultLabelOptions = {\r\n    granularity: 'element',\r\n    condensed: false,\r\n    reverse: false,\r\n    countsOnly: false,\r\n    hidePrefix: false,\r\n    htmlStyling: true,\r\n};\r\nexport function lociLabel(loci, options) {\r\n    if (options === void 0) { options = {}; }\r\n    switch (loci.kind) {\r\n        case 'structure-loci':\r\n            return loci.structure.models.map(function (m) { return m.entry; }).filter(function (l) { return !!l; }).join(', ');\r\n        case 'element-loci':\r\n            return structureElementStatsLabel(StructureElement.Stats.ofLoci(loci), options);\r\n        case 'bond-loci':\r\n            var bond = loci.bonds[0];\r\n            return bond ? bondLabel(bond) : '';\r\n        case 'shape-loci':\r\n            return loci.shape.name;\r\n        case 'group-loci':\r\n            var g = loci.groups[0];\r\n            return g ? loci.shape.getLabel(OrderedSet.start(g.ids), g.instance) : '';\r\n        case 'every-loci':\r\n            return 'Everything';\r\n        case 'empty-loci':\r\n            return 'Nothing';\r\n        case 'data-loci':\r\n            return loci.getLabel();\r\n        case 'volume-loci':\r\n            return loci.volume.label || 'Volume';\r\n        case 'isosurface-loci':\r\n            return [\r\n                \"\" + (loci.volume.label || 'Volume'),\r\n                \"Isosurface at \" + Volume.IsoValue.toString(loci.isoValue)\r\n            ].join(' | ');\r\n        case 'cell-loci':\r\n            var size = OrderedSet.size(loci.indices);\r\n            var start = OrderedSet.start(loci.indices);\r\n            var absVal = Volume.IsoValue.absolute(loci.volume.grid.cells.data[start]);\r\n            var relVal = Volume.IsoValue.toRelative(absVal, loci.volume.grid.stats);\r\n            var label = [\r\n                \"\" + (loci.volume.label || 'Volume'),\r\n                \"\" + (size === 1 ? \"Cell #\" + start : size + \" Cells\")\r\n            ];\r\n            if (size === 1) {\r\n                label.push(Volume.IsoValue.toString(absVal) + \" (\" + Volume.IsoValue.toString(relVal) + \")\");\r\n            }\r\n            return label.join(' | ');\r\n    }\r\n}\r\nfunction countLabel(count, label) {\r\n    return count === 1 ? \"1 \" + label : count + \" \" + label + \"s\";\r\n}\r\nfunction otherLabel(count, location, granularity, hidePrefix, reverse, condensed) {\r\n    return elementLabel(location, { granularity: granularity, hidePrefix: hidePrefix, reverse: reverse, condensed: condensed }) + \" <small>[+ \" + countLabel(count - 1, \"other \" + capitalize(granularity)) + \"]</small>\";\r\n}\r\n/** Gets residue count of the model chain segments the unit is a subset of */\r\nfunction getResidueCount(unit) {\r\n    var elements = unit.elements, model = unit.model;\r\n    var _a = model.atomicHierarchy, chainAtomSegments = _a.chainAtomSegments, residueAtomSegments = _a.residueAtomSegments;\r\n    var elementStart = chainAtomSegments.offsets[chainAtomSegments.index[elements[0]]];\r\n    var elementEnd = chainAtomSegments.offsets[chainAtomSegments.index[elements[elements.length - 1]] + 1] - 1;\r\n    return residueAtomSegments.index[elementEnd] - residueAtomSegments.index[elementStart] + 1;\r\n}\r\nexport function structureElementStatsLabel(stats, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var o = __assign(__assign({}, DefaultLabelOptions), options);\r\n    var label = _structureElementStatsLabel(stats, o.countsOnly, o.hidePrefix, o.condensed, o.reverse);\r\n    return o.htmlStyling ? label : stripTags(label);\r\n}\r\nfunction _structureElementStatsLabel(stats, countsOnly, hidePrefix, condensed, reverse) {\r\n    if (countsOnly === void 0) { countsOnly = false; }\r\n    if (hidePrefix === void 0) { hidePrefix = false; }\r\n    if (condensed === void 0) { condensed = false; }\r\n    if (reverse === void 0) { reverse = false; }\r\n    var structureCount = stats.structureCount, chainCount = stats.chainCount, residueCount = stats.residueCount, conformationCount = stats.conformationCount, elementCount = stats.elementCount;\r\n    if (!countsOnly && elementCount === 1 && residueCount === 0 && chainCount === 0) {\r\n        return elementLabel(stats.firstElementLoc, { hidePrefix: hidePrefix, condensed: condensed, granularity: 'element', reverse: reverse });\r\n    }\r\n    else if (!countsOnly && elementCount === 0 && residueCount === 1 && chainCount === 0) {\r\n        return elementLabel(stats.firstResidueLoc, { hidePrefix: hidePrefix, condensed: condensed, granularity: 'residue', reverse: reverse });\r\n    }\r\n    else if (!countsOnly && elementCount === 0 && residueCount === 0 && chainCount === 1) {\r\n        var unit = stats.firstChainLoc.unit;\r\n        var granularity = (Unit.isAtomic(unit) && getResidueCount(unit) === 1)\r\n            ? 'residue' : Unit.Traits.is(unit.traits, 1 /* MultiChain */)\r\n            ? 'residue' : 'chain';\r\n        return elementLabel(stats.firstChainLoc, { hidePrefix: hidePrefix, condensed: condensed, granularity: granularity, reverse: reverse });\r\n    }\r\n    else if (!countsOnly) {\r\n        var label = [];\r\n        if (structureCount > 0) {\r\n            label.push(structureCount === 1 ? elementLabel(stats.firstStructureLoc, { hidePrefix: hidePrefix, condensed: condensed, granularity: 'structure', reverse: reverse }) : otherLabel(structureCount, stats.firstStructureLoc, 'structure', hidePrefix, reverse, condensed));\r\n        }\r\n        if (chainCount > 0) {\r\n            label.push(chainCount === 1 ? elementLabel(stats.firstChainLoc, { condensed: condensed, granularity: 'chain', hidePrefix: hidePrefix, reverse: reverse }) : otherLabel(chainCount, stats.firstChainLoc, 'chain', hidePrefix, reverse, condensed));\r\n            hidePrefix = true;\r\n        }\r\n        if (residueCount > 0) {\r\n            label.push(residueCount === 1 ? elementLabel(stats.firstResidueLoc, { condensed: condensed, granularity: 'residue', hidePrefix: hidePrefix, reverse: reverse }) : otherLabel(residueCount, stats.firstResidueLoc, 'residue', hidePrefix, reverse, condensed));\r\n            hidePrefix = true;\r\n        }\r\n        if (conformationCount > 0) {\r\n            label.push(conformationCount === 1 ? elementLabel(stats.firstConformationLoc, { condensed: condensed, granularity: 'conformation', hidePrefix: hidePrefix, reverse: reverse }) : otherLabel(conformationCount, stats.firstConformationLoc, 'conformation', hidePrefix, reverse, condensed));\r\n            hidePrefix = true;\r\n        }\r\n        if (elementCount > 0) {\r\n            label.push(elementCount === 1 ? elementLabel(stats.firstElementLoc, { condensed: condensed, granularity: 'element', hidePrefix: hidePrefix, reverse: reverse }) : otherLabel(elementCount, stats.firstElementLoc, 'element', hidePrefix, reverse, condensed));\r\n        }\r\n        return label.join('<small> + </small>');\r\n    }\r\n    else {\r\n        var label = [];\r\n        if (structureCount > 0)\r\n            label.push(countLabel(structureCount, 'Structure'));\r\n        if (chainCount > 0)\r\n            label.push(countLabel(chainCount, 'Chain'));\r\n        if (residueCount > 0)\r\n            label.push(countLabel(residueCount, 'Residue'));\r\n        if (conformationCount > 0)\r\n            label.push(countLabel(conformationCount, 'Conformation'));\r\n        if (elementCount > 0)\r\n            label.push(countLabel(elementCount, 'Element'));\r\n        return label.join('<small> + </small>');\r\n    }\r\n}\r\nexport function bondLabel(bond, options) {\r\n    if (options === void 0) { options = {}; }\r\n    return bundleLabel({ loci: [\r\n            StructureElement.Loci(bond.aStructure, [{ unit: bond.aUnit, indices: OrderedSet.ofSingleton(bond.aIndex) }]),\r\n            StructureElement.Loci(bond.bStructure, [{ unit: bond.bUnit, indices: OrderedSet.ofSingleton(bond.bIndex) }])\r\n        ] }, options);\r\n}\r\nexport function bundleLabel(bundle, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var o = __assign(__assign({}, DefaultLabelOptions), options);\r\n    var label = _bundleLabel(bundle, o);\r\n    return o.htmlStyling ? label : stripTags(label);\r\n}\r\nexport function _bundleLabel(bundle, options) {\r\n    var granularity = options.granularity, hidePrefix = options.hidePrefix, reverse = options.reverse, condensed = options.condensed;\r\n    var isSingleElements = true;\r\n    for (var _i = 0, _a = bundle.loci; _i < _a.length; _i++) {\r\n        var l = _a[_i];\r\n        if (!StructureElement.Loci.is(l) || StructureElement.Loci.size(l) !== 1) {\r\n            isSingleElements = false;\r\n            break;\r\n        }\r\n    }\r\n    if (isSingleElements) {\r\n        var locations = bundle.loci.map(function (l) {\r\n            var _a = l.elements[0], unit = _a.unit, indices = _a.indices;\r\n            return StructureElement.Location.create(l.structure, unit, unit.elements[OrderedSet.start(indices)]);\r\n        });\r\n        var labels = locations.map(function (l) { return _elementLabel(l, granularity, hidePrefix, reverse || condensed); });\r\n        if (condensed) {\r\n            return labels.map(function (l) { return l[0].replace(/\\[.*\\]/g, '').trim(); }).filter(function (l) { return !!l; }).join(' \\u2014 ');\r\n        }\r\n        var offset = 0;\r\n        for (var i = 0, il = Math.min.apply(Math, labels.map(function (l) { return l.length; })) - 1; i < il; ++i) {\r\n            var areIdentical = true;\r\n            for (var j = 1, jl = labels.length; j < jl; ++j) {\r\n                if (labels[0][i] !== labels[j][i]) {\r\n                    areIdentical = false;\r\n                    break;\r\n                }\r\n            }\r\n            if (areIdentical)\r\n                offset += 1;\r\n            else\r\n                break;\r\n        }\r\n        if (offset > 0) {\r\n            var offsetLabels = [labels[0].join(' | ')];\r\n            for (var j = 1, jl = labels.length; j < jl; ++j) {\r\n                offsetLabels.push(labels[j].slice(offset).filter(function (l) { return !!l; }).join(' | '));\r\n            }\r\n            return offsetLabels.join(' \\u2014 ');\r\n        }\r\n        else {\r\n            return labels.map(function (l) { return l.filter(function (l) { return !!l; }).join(' | '); }).filter(function (l) { return !!l; }).join('</br>');\r\n        }\r\n    }\r\n    else {\r\n        var labels = bundle.loci.map(function (l) { return lociLabel(l, options); });\r\n        return labels.filter(function (l) { return !!l; }).join(condensed ? ' \\u2014 ' : '</br>');\r\n    }\r\n}\r\nexport function elementLabel(location, options) {\r\n    var _a, _b;\r\n    if (options === void 0) { options = {}; }\r\n    var o = __assign(__assign({}, DefaultLabelOptions), options);\r\n    var _label = _elementLabel(location, o.granularity, o.hidePrefix, o.reverse || o.condensed);\r\n    // TODO: condensed label for single atom structure returns empty label.. handle this case here?\r\n    var label = o.condensed ? (_b = (_a = _label[0]) === null || _a === void 0 ? void 0 : _a.replace(/\\[.*\\]/g, '').trim()) !== null && _b !== void 0 ? _b : '' : _label.filter(function (l) { return !!l; }).join(' | ');\r\n    return o.htmlStyling ? label : stripTags(label);\r\n}\r\nfunction _elementLabel(location, granularity, hidePrefix, reverse) {\r\n    if (granularity === void 0) { granularity = 'element'; }\r\n    if (hidePrefix === void 0) { hidePrefix = false; }\r\n    if (reverse === void 0) { reverse = false; }\r\n    var label = [];\r\n    if (!hidePrefix) {\r\n        var entry = location.unit.model.entry;\r\n        if (entry.length > 30)\r\n            entry = entry.substr(0, 27) + '\\u2026'; // ellipsis\r\n        label.push(\"<small>\" + entry + \"</small>\"); // entry\r\n        if (granularity !== 'structure') {\r\n            label.push(\"<small>Model \" + location.unit.model.modelNum + \"</small>\"); // model\r\n            label.push(\"<small>Instance \" + location.unit.conformation.operator.name + \"</small>\"); // instance\r\n        }\r\n    }\r\n    if (Unit.isAtomic(location.unit)) {\r\n        label.push.apply(label, _atomicElementLabel(location, granularity, reverse));\r\n    }\r\n    else if (Unit.isCoarse(location.unit)) {\r\n        label.push.apply(label, _coarseElementLabel(location, granularity));\r\n    }\r\n    else {\r\n        label.push('Unknown');\r\n    }\r\n    return reverse ? label.reverse() : label;\r\n}\r\nfunction _atomicElementLabel(location, granularity, hideOccupancy) {\r\n    if (hideOccupancy === void 0) { hideOccupancy = false; }\r\n    var rI = StructureElement.Location.residueIndex(location);\r\n    var label_asym_id = Props.chain.label_asym_id(location);\r\n    var auth_asym_id = Props.chain.auth_asym_id(location);\r\n    var has_label_seq_id = location.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(rI) === 0 /* Present */;\r\n    var label_seq_id = Props.residue.label_seq_id(location);\r\n    var auth_seq_id = Props.residue.auth_seq_id(location);\r\n    var ins_code = Props.residue.pdbx_PDB_ins_code(location);\r\n    var comp_id = Props.atom.label_comp_id(location);\r\n    var atom_id = Props.atom.label_atom_id(location);\r\n    var alt_id = Props.atom.label_alt_id(location);\r\n    var occupancy = Props.atom.occupancy(location);\r\n    var microHetCompIds = Props.residue.microheterogeneityCompIds(location);\r\n    var compId = granularity === 'residue' && microHetCompIds.length > 1 ?\r\n        \"(\" + microHetCompIds.join('|') + \")\" : comp_id;\r\n    var label = [];\r\n    switch (granularity) {\r\n        case 'element':\r\n            label.push(\"<b>\" + atom_id + \"</b>\" + (alt_id ? \"%\" + alt_id : ''));\r\n        case 'conformation':\r\n            if (granularity === 'conformation' && alt_id) {\r\n                label.push(\"<small>Conformation</small> <b>\" + alt_id + \"</b>\");\r\n            }\r\n        case 'residue':\r\n            var seq_id = label_seq_id === auth_seq_id || !has_label_seq_id ? auth_seq_id : label_seq_id;\r\n            label.push(\"<b>\" + compId + \" \" + seq_id + \"</b>\" + (seq_id !== auth_seq_id ? \" <small>[auth</small> <b>\" + auth_seq_id + \"</b><small>]</small>\" : '') + \"<b>\" + (ins_code ? ins_code : '') + \"</b>\");\r\n        case 'chain':\r\n            if (label_asym_id === auth_asym_id) {\r\n                label.push(\"<b>\" + label_asym_id + \"</b>\");\r\n            }\r\n            else {\r\n                if (granularity === 'chain' && Unit.Traits.is(location.unit.traits, 1 /* MultiChain */)) {\r\n                    label.push(\"<small>[auth</small> <b>\" + auth_asym_id + \"</b><small>]</small>\");\r\n                }\r\n                else {\r\n                    label.push(\"<b>\" + label_asym_id + \"</b> <small>[auth</small> <b>\" + auth_asym_id + \"</b><small>]</small>\");\r\n                }\r\n            }\r\n    }\r\n    if (label.length > 0 && occupancy !== 1 && !hideOccupancy) {\r\n        label[0] = label[0] + \" <small>[occupancy</small> <b>\" + Math.round(100 * occupancy) / 100 + \"</b><small>]</small>\";\r\n    }\r\n    return label.reverse();\r\n}\r\nfunction _coarseElementLabel(location, granularity) {\r\n    var asym_id = Props.coarse.asym_id(location);\r\n    var seq_id_begin = Props.coarse.seq_id_begin(location);\r\n    var seq_id_end = Props.coarse.seq_id_end(location);\r\n    var label = [];\r\n    switch (granularity) {\r\n        case 'element':\r\n        case 'conformation':\r\n        case 'residue':\r\n            if (seq_id_begin === seq_id_end) {\r\n                var entityIndex = Props.coarse.entityKey(location);\r\n                var seq = location.unit.model.sequence.byEntityKey[entityIndex];\r\n                var comp_id = seq.sequence.compId.value(seq_id_begin - 1); // 1-indexed\r\n                label.push(\"<b>\" + comp_id + \" \" + seq_id_begin + \"</b>\");\r\n            }\r\n            else {\r\n                label.push(\"<b>\" + seq_id_begin + \"-\" + seq_id_end + \"</b>\");\r\n            }\r\n        case 'chain':\r\n            label.push(\"<b>\" + asym_id + \"</b>\");\r\n    }\r\n    return label.reverse();\r\n}\r\n//\r\nexport function distanceLabel(pair, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var o = __assign(__assign(__assign({}, DefaultLabelOptions), { measureOnly: false, unitLabel: '\\u212B' }), options);\r\n    var _a = pair.loci.map(function (l) { return Loci.getCenter(l); }), cA = _a[0], cB = _a[1];\r\n    var distance = Vec3.distance(cA, cB).toFixed(2) + \" \" + o.unitLabel;\r\n    if (o.measureOnly)\r\n        return distance;\r\n    var label = bundleLabel(pair, o);\r\n    return o.condensed ? distance + \" | \" + label : \"Distance \" + distance + \"</br>\" + label;\r\n}\r\nexport function angleLabel(triple, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var o = __assign(__assign(__assign({}, DefaultLabelOptions), { measureOnly: false }), options);\r\n    var _a = triple.loci.map(function (l) { return Loci.getCenter(l); }), cA = _a[0], cB = _a[1], cC = _a[2];\r\n    var vAB = Vec3.sub(Vec3(), cA, cB);\r\n    var vCB = Vec3.sub(Vec3(), cC, cB);\r\n    var angle = radToDeg(Vec3.angle(vAB, vCB)).toFixed(2) + \"\\u00B0\";\r\n    if (o.measureOnly)\r\n        return angle;\r\n    var label = bundleLabel(triple, o);\r\n    return o.condensed ? angle + \" | \" + label : \"Angle \" + angle + \"</br>\" + label;\r\n}\r\nexport function dihedralLabel(quad, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var o = __assign(__assign(__assign({}, DefaultLabelOptions), { measureOnly: false }), options);\r\n    var _a = quad.loci.map(function (l) { return Loci.getCenter(l); }), cA = _a[0], cB = _a[1], cC = _a[2], cD = _a[3];\r\n    var dihedral = radToDeg(Vec3.dihedralAngle(cA, cB, cC, cD)).toFixed(2) + \"\\u00B0\";\r\n    if (o.measureOnly)\r\n        return dihedral;\r\n    var label = bundleLabel(quad, o);\r\n    return o.condensed ? dihedral + \" | \" + label : \"Dihedral \" + dihedral + \"</br>\" + label;\r\n}\r\n//# sourceMappingURL=label.js.map"]},"metadata":{},"sourceType":"module"}