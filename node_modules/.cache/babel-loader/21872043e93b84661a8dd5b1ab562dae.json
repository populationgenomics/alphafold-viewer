{"ast":null,"code":"/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { arrayRemoveInPlace } from './array';\nimport { Subject } from 'rxjs';\n\nvar AsyncQueue =\n/** @class */\nfunction () {\n  function AsyncQueue() {\n    this.queue = [];\n    this.signal = new Subject();\n  }\n\n  Object.defineProperty(AsyncQueue.prototype, \"length\", {\n    get: function () {\n      return this.queue.length;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  AsyncQueue.prototype.enqueue = function (v) {\n    this.queue.push(v);\n    if (this.queue.length === 1) return true;\n    return this.waitFor(v);\n  };\n\n  AsyncQueue.prototype.handled = function (v) {\n    arrayRemoveInPlace(this.queue, v);\n\n    if (this.queue.length > 0) {\n      this.signal.next({\n        v: this.queue[0],\n        stillPresent: true\n      });\n    }\n  };\n\n  AsyncQueue.prototype.remove = function (v) {\n    var rem = arrayRemoveInPlace(this.queue, v);\n    if (rem) this.signal.next({\n      v: v,\n      stillPresent: false\n    });\n    return rem;\n  };\n\n  AsyncQueue.prototype.waitFor = function (t) {\n    var _this = this;\n\n    return new Promise(function (res) {\n      var sub = _this.signal.subscribe(function (_a) {\n        var v = _a.v,\n            removed = _a.stillPresent;\n\n        if (v === t) {\n          sub.unsubscribe();\n          res(removed);\n        }\n      });\n    });\n  };\n\n  return AsyncQueue;\n}();\n\nexport { AsyncQueue };","map":{"version":3,"sources":["../../src/mol-util/async-queue.ts"],"names":[],"mappings":"AAAA;;;;AAIG;AAEH,SAAS,kBAAT,QAAmC,SAAnC;AACA,SAAS,OAAT,QAAwB,MAAxB;;AAEA,IAAA,UAAA;AAAA;AAAA,YAAA;AAAA,WAAA,UAAA,GAAA;AACY,SAAA,KAAA,GAAa,EAAb;AACA,SAAA,MAAA,GAAS,IAAI,OAAJ,EAAT;AAkCX;;AAhCG,EAAA,MAAA,CAAA,cAAA,CAAI,UAAA,CAAA,SAAJ,EAAI,QAAJ,EAAU;SAAV,YAAA;AAAe,aAAO,KAAK,KAAL,CAAW,MAAlB;AAA2B,KAAhC;qBAAA;;AAAA,GAAV;;AAEA,EAAA,UAAA,CAAA,SAAA,CAAA,OAAA,GAAA,UAAQ,CAAR,EAAY;AACR,SAAK,KAAL,CAAW,IAAX,CAAgB,CAAhB;AACA,QAAI,KAAK,KAAL,CAAW,MAAX,KAAsB,CAA1B,EAA6B,OAAO,IAAP;AAC7B,WAAO,KAAK,OAAL,CAAa,CAAb,CAAP;AACH,GAJD;;AAMA,EAAA,UAAA,CAAA,SAAA,CAAA,OAAA,GAAA,UAAQ,CAAR,EAAY;AACR,IAAA,kBAAkB,CAAC,KAAK,KAAN,EAAa,CAAb,CAAlB;;AACA,QAAI,KAAK,KAAL,CAAW,MAAX,GAAoB,CAAxB,EAA2B;AACvB,WAAK,MAAL,CAAY,IAAZ,CAAiB;AAAE,QAAA,CAAC,EAAE,KAAK,KAAL,CAAW,CAAX,CAAL;AAAoB,QAAA,YAAY,EAAE;AAAlC,OAAjB;AACH;AACJ,GALD;;AAOA,EAAA,UAAA,CAAA,SAAA,CAAA,MAAA,GAAA,UAAO,CAAP,EAAW;AACP,QAAM,GAAG,GAAG,kBAAkB,CAAC,KAAK,KAAN,EAAa,CAAb,CAA9B;AACA,QAAI,GAAJ,EACI,KAAK,MAAL,CAAY,IAAZ,CAAiB;AAAE,MAAA,CAAC,EAAA,CAAH;AAAK,MAAA,YAAY,EAAE;AAAnB,KAAjB;AACJ,WAAO,GAAP;AACH,GALD;;AAOQ,EAAA,UAAA,CAAA,SAAA,CAAA,OAAA,GAAR,UAAgB,CAAhB,EAAoB;AAApB,QAAA,KAAA,GAAA,IAAA;;AACI,WAAO,IAAI,OAAJ,CAAY,UAAA,GAAA,EAAG;AAClB,UAAM,GAAG,GAAG,KAAI,CAAC,MAAL,CAAY,SAAZ,CAAsB,UAAC,EAAD,EAA6B;YAA1B,CAAC,GAAA,EAAA,CAAA,C;YAAgB,OAAO,GAAA,EAAA,CAAA,Y;;AACzD,YAAI,CAAC,KAAK,CAAV,EAAa;AACT,UAAA,GAAG,CAAC,WAAJ;AACA,UAAA,GAAG,CAAC,OAAD,CAAH;AACH;AACJ,OALW,CAAZ;AAMH,KAPM,CAAP;AAQH,GATO;;AAUZ,SAAA,UAAA;AAAC,CApCD,EAAA","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { arrayRemoveInPlace } from './array';\r\nimport { Subject } from 'rxjs';\r\nvar AsyncQueue = /** @class */ (function () {\r\n    function AsyncQueue() {\r\n        this.queue = [];\r\n        this.signal = new Subject();\r\n    }\r\n    Object.defineProperty(AsyncQueue.prototype, \"length\", {\r\n        get: function () { return this.queue.length; },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    AsyncQueue.prototype.enqueue = function (v) {\r\n        this.queue.push(v);\r\n        if (this.queue.length === 1)\r\n            return true;\r\n        return this.waitFor(v);\r\n    };\r\n    AsyncQueue.prototype.handled = function (v) {\r\n        arrayRemoveInPlace(this.queue, v);\r\n        if (this.queue.length > 0) {\r\n            this.signal.next({ v: this.queue[0], stillPresent: true });\r\n        }\r\n    };\r\n    AsyncQueue.prototype.remove = function (v) {\r\n        var rem = arrayRemoveInPlace(this.queue, v);\r\n        if (rem)\r\n            this.signal.next({ v: v, stillPresent: false });\r\n        return rem;\r\n    };\r\n    AsyncQueue.prototype.waitFor = function (t) {\r\n        var _this = this;\r\n        return new Promise(function (res) {\r\n            var sub = _this.signal.subscribe(function (_a) {\r\n                var v = _a.v, removed = _a.stillPresent;\r\n                if (v === t) {\r\n                    sub.unsubscribe();\r\n                    res(removed);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return AsyncQueue;\r\n}());\r\nexport { AsyncQueue };\r\n//# sourceMappingURL=async-queue.js.map"]},"metadata":{},"sourceType":"module"}