{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n/**\r\n * Copyright (c) 2018-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\n\nimport * as React from 'react';\nimport { PluginUIComponent } from '../base';\nimport { getButtons, getModifiers, getButton } from '../../mol-util/input/input-observer';\nimport { StructureElement, StructureProperties, Unit } from '../../mol-model/structure';\nimport { Subject } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\nimport { OrderedSet } from '../../mol-data/int';\nimport { Representation } from '../../mol-repr/representation';\n/** Note, if this is changed, the CSS for `msp-sequence-number` needs adjustment too */\n\nvar MaxSequenceNumberSize = 5; // TODO: this is somewhat inefficient and should be done using a canvas.\n\nvar Sequence =\n/** @class */\nfunction (_super) {\n  __extends(Sequence, _super);\n\n  function Sequence() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.parentDiv = React.createRef();\n    _this.lastMouseOverSeqIdx = -1;\n    _this.highlightQueue = new Subject();\n\n    _this.lociHighlightProvider = function (loci, action) {\n      var changed = _this.props.sequenceWrapper.markResidue(loci.loci, action);\n\n      if (changed) _this.updateMarker();\n    };\n\n    _this.lociSelectionProvider = function (loci, action) {\n      var changed = _this.props.sequenceWrapper.markResidue(loci.loci, action);\n\n      if (changed) _this.updateMarker();\n    };\n\n    _this.contextMenu = function (e) {\n      e.preventDefault();\n    };\n\n    _this.mouseDownLoci = undefined;\n\n    _this.mouseDown = function (e) {\n      e.stopPropagation();\n\n      var seqIdx = _this.getSeqIdx(e);\n\n      var loci = _this.getLoci(seqIdx);\n\n      var buttons = getButtons(e.nativeEvent);\n      var button = getButton(e.nativeEvent);\n      var modifiers = getModifiers(e.nativeEvent);\n\n      _this.click(loci, buttons, button, modifiers);\n\n      _this.mouseDownLoci = loci;\n    };\n\n    _this.mouseUp = function (e) {\n      e.stopPropagation(); // ignore mouse-up events without a bound loci\n\n      if (_this.mouseDownLoci === undefined) return;\n\n      var seqIdx = _this.getSeqIdx(e);\n\n      var loci = _this.getLoci(seqIdx);\n\n      if (loci && !StructureElement.Loci.areEqual(_this.mouseDownLoci, loci)) {\n        var buttons = getButtons(e.nativeEvent);\n        var button = getButton(e.nativeEvent);\n        var modifiers = getModifiers(e.nativeEvent);\n        var ref = _this.mouseDownLoci.elements[0];\n        var ext = loci.elements[0];\n        var min = Math.min(OrderedSet.min(ref.indices), OrderedSet.min(ext.indices));\n        var max = Math.max(OrderedSet.max(ref.indices), OrderedSet.max(ext.indices));\n        var range = StructureElement.Loci(loci.structure, [{\n          unit: ref.unit,\n          indices: OrderedSet.ofRange(min, max)\n        }]);\n\n        _this.click(StructureElement.Loci.subtract(range, _this.mouseDownLoci), buttons, button, modifiers);\n      }\n\n      _this.mouseDownLoci = undefined;\n    };\n\n    _this.location = StructureElement.Location.create(void 0);\n\n    _this.mouseMove = function (e) {\n      e.stopPropagation();\n      var buttons = getButtons(e.nativeEvent);\n      var button = getButton(e.nativeEvent);\n      var modifiers = getModifiers(e.nativeEvent);\n      var el = e.target;\n\n      if (!el || !el.getAttribute) {\n        if (_this.lastMouseOverSeqIdx === -1) return;\n        _this.lastMouseOverSeqIdx = -1;\n\n        _this.highlightQueue.next({\n          seqIdx: -1,\n          buttons: buttons,\n          button: button,\n          modifiers: modifiers\n        });\n\n        return;\n      }\n\n      var seqIdx = el.hasAttribute('data-seqid') ? +el.getAttribute('data-seqid') : -1;\n\n      if (_this.lastMouseOverSeqIdx === seqIdx) {\n        return;\n      } else {\n        _this.lastMouseOverSeqIdx = seqIdx;\n\n        if (_this.mouseDownLoci !== undefined) {\n          var loci = _this.getLoci(seqIdx);\n\n          _this.hover(loci, 0\n          /* None */\n          , 0\n          /* None */\n          , __assign(__assign({}, modifiers), {\n            shift: true\n          }));\n        } else {\n          _this.highlightQueue.next({\n            seqIdx: seqIdx,\n            buttons: buttons,\n            button: button,\n            modifiers: modifiers\n          });\n        }\n      }\n    };\n\n    _this.mouseLeave = function (e) {\n      e.stopPropagation();\n      _this.mouseDownLoci = undefined;\n      if (_this.lastMouseOverSeqIdx === -1) return;\n      _this.lastMouseOverSeqIdx = -1;\n      var buttons = getButtons(e.nativeEvent);\n      var button = getButton(e.nativeEvent);\n      var modifiers = getModifiers(e.nativeEvent);\n\n      _this.highlightQueue.next({\n        seqIdx: -1,\n        buttons: buttons,\n        button: button,\n        modifiers: modifiers\n      });\n    };\n\n    return _this;\n  }\n\n  Object.defineProperty(Sequence.prototype, \"sequenceNumberPeriod\", {\n    get: function () {\n      if (this.props.sequenceNumberPeriod !== undefined) {\n        return this.props.sequenceNumberPeriod;\n      }\n\n      if (this.props.sequenceWrapper.length > 10) return 10;\n      var lastSeqNum = this.getSequenceNumber(this.props.sequenceWrapper.length - 1);\n      if (lastSeqNum.length > 1) return 5;\n      return 1;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  Sequence.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider);\n    this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider);\n    this.subscribe(debounceTime(15)(this.highlightQueue), function (e) {\n      var loci = _this.getLoci(e.seqIdx < 0 ? void 0 : e.seqIdx);\n\n      _this.hover(loci, e.buttons, e.button, e.modifiers);\n    }); // this.updateMarker()\n  };\n\n  Sequence.prototype.componentWillUnmount = function () {\n    _super.prototype.componentWillUnmount.call(this);\n\n    this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider);\n    this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider);\n  };\n\n  Sequence.prototype.getLoci = function (seqIdx) {\n    if (seqIdx !== undefined) {\n      var loci = this.props.sequenceWrapper.getLoci(seqIdx);\n      if (!StructureElement.Loci.isEmpty(loci)) return loci;\n    }\n  };\n\n  Sequence.prototype.getSeqIdx = function (e) {\n    var seqIdx = undefined;\n    var el = e.target;\n\n    if (el && el.getAttribute) {\n      seqIdx = el.hasAttribute('data-seqid') ? +el.getAttribute('data-seqid') : undefined;\n    }\n\n    return seqIdx;\n  };\n\n  Sequence.prototype.hover = function (loci, buttons, button, modifiers) {\n    var ev = {\n      current: Representation.Loci.Empty,\n      buttons: buttons,\n      button: button,\n      modifiers: modifiers\n    };\n\n    if (loci !== undefined && !StructureElement.Loci.isEmpty(loci)) {\n      ev.current = {\n        loci: loci\n      };\n    }\n\n    this.plugin.behaviors.interaction.hover.next(ev);\n  };\n\n  Sequence.prototype.click = function (loci, buttons, button, modifiers) {\n    var ev = {\n      current: Representation.Loci.Empty,\n      buttons: buttons,\n      button: button,\n      modifiers: modifiers\n    };\n\n    if (loci !== undefined && !StructureElement.Loci.isEmpty(loci)) {\n      ev.current = {\n        loci: loci\n      };\n    }\n\n    this.plugin.behaviors.interaction.click.next(ev);\n  };\n\n  Sequence.prototype.getBackgroundColor = function (marker) {\n    // TODO: make marker color configurable\n    if (typeof marker === 'undefined') console.error('unexpected marker value');\n    return marker === 0 ? '' : marker % 2 === 0 ? 'rgb(51, 255, 25)' // selected\n    : 'rgb(255, 102, 153)'; // highlighted\n  };\n\n  Sequence.prototype.getResidueClass = function (seqIdx, label) {\n    return label.length > 1 ? this.props.sequenceWrapper.residueClass(seqIdx) + (seqIdx === 0 ? ' msp-sequence-residue-long-begin' : ' msp-sequence-residue-long') : this.props.sequenceWrapper.residueClass(seqIdx);\n  };\n\n  Sequence.prototype.residue = function (seqIdx, label, marker) {\n    return _jsx(\"span\", __assign({\n      \"data-seqid\": seqIdx,\n      style: {\n        backgroundColor: this.getBackgroundColor(marker)\n      },\n      className: this.getResidueClass(seqIdx, label)\n    }, {\n      children: \"\\u200B\" + label + \"\\u200B\"\n    }), seqIdx);\n  };\n\n  Sequence.prototype.getSequenceNumberClass = function (seqIdx, seqNum, label) {\n    var classList = ['msp-sequence-number'];\n\n    if (seqNum.startsWith('-')) {\n      if (label.length > 1 && seqIdx > 0) classList.push('msp-sequence-number-long-negative');else classList.push('msp-sequence-number-negative');\n    } else {\n      if (label.length > 1 && seqIdx > 0) classList.push('msp-sequence-number-long');\n    }\n\n    return classList.join(' ');\n  };\n\n  Sequence.prototype.getSequenceNumber = function (seqIdx) {\n    var seqNum = '';\n    var loci = this.props.sequenceWrapper.getLoci(seqIdx);\n    var l = StructureElement.Loci.getFirstLocation(loci, this.location);\n\n    if (l) {\n      if (Unit.isAtomic(l.unit)) {\n        var seqId = StructureProperties.residue.auth_seq_id(l);\n        var insCode = StructureProperties.residue.pdbx_PDB_ins_code(l);\n        seqNum = \"\" + seqId + (insCode ? insCode : '');\n      } else if (Unit.isCoarse(l.unit)) {\n        seqNum = \"\" + (seqIdx + 1);\n      }\n    }\n\n    return seqNum;\n  };\n\n  Sequence.prototype.padSeqNum = function (n) {\n    if (n.length < MaxSequenceNumberSize) return n + new Array(MaxSequenceNumberSize - n.length + 1).join('\\u00A0');\n    return n;\n  };\n\n  Sequence.prototype.getSequenceNumberSpan = function (seqIdx, label) {\n    var seqNum = this.getSequenceNumber(seqIdx);\n    return _jsx(\"span\", __assign({\n      className: this.getSequenceNumberClass(seqIdx, seqNum, label)\n    }, {\n      children: this.padSeqNum(seqNum)\n    }), \"marker-\" + seqIdx);\n  };\n\n  Sequence.prototype.updateMarker = function () {\n    if (!this.parentDiv.current) return;\n    var xs = this.parentDiv.current.children;\n    var markerArray = this.props.sequenceWrapper.markerArray;\n    var hasNumbers = !this.props.hideSequenceNumbers,\n        period = this.sequenceNumberPeriod; // let first: HTMLSpanElement | undefined;\n\n    var o = 0;\n\n    for (var i = 0, il = markerArray.length; i < il; i++) {\n      if (hasNumbers && i % period === 0 && i < il) o++; // o + 1 to account for help icon\n\n      var span = xs[o];\n      if (!span) return;\n      o++; // if (!first && markerArray[i] > 0) {\n      //     first = span;\n      // }\n\n      var backgroundColor = this.getBackgroundColor(markerArray[i]);\n      if (span.style.backgroundColor !== backgroundColor) span.style.backgroundColor = backgroundColor;\n    } // if (first) {\n    //     first.scrollIntoView({ block: 'nearest' });\n    // }\n\n  };\n\n  Sequence.prototype.render = function () {\n    var sw = this.props.sequenceWrapper;\n    var elems = [];\n    var hasNumbers = !this.props.hideSequenceNumbers,\n        period = this.sequenceNumberPeriod;\n\n    for (var i = 0, il = sw.length; i < il; ++i) {\n      var label = sw.residueLabel(i); // add sequence number before name so the html element do not get separated by a line-break\n\n      if (hasNumbers && i % period === 0 && i < il) {\n        elems[elems.length] = this.getSequenceNumberSpan(i, label);\n      }\n\n      elems[elems.length] = this.residue(i, label, sw.markerArray[i]);\n    } // calling .updateMarker here is neccesary to ensure existing\n    // residue spans are updated as react won't update them\n\n\n    this.updateMarker();\n    return _jsx(\"div\", __assign({\n      className: 'msp-sequence-wrapper',\n      onContextMenu: this.contextMenu,\n      onMouseDown: this.mouseDown,\n      onMouseUp: this.mouseUp,\n      onMouseMove: this.mouseMove,\n      onMouseLeave: this.mouseLeave,\n      ref: this.parentDiv\n    }, {\n      children: elems\n    }), void 0);\n  };\n\n  return Sequence;\n}(PluginUIComponent);\n\nexport { Sequence };","map":{"version":3,"sources":["../../../src/mol-plugin-ui/sequence/sequence.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __extends } from \"tslib\";\r\nimport { jsx as _jsx } from \"react/jsx-runtime\";\r\n/**\r\n * Copyright (c) 2018-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport * as React from 'react';\r\nimport { PluginUIComponent } from '../base';\r\nimport { getButtons, getModifiers, getButton } from '../../mol-util/input/input-observer';\r\nimport { StructureElement, StructureProperties, Unit } from '../../mol-model/structure';\r\nimport { Subject } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { OrderedSet } from '../../mol-data/int';\r\nimport { Representation } from '../../mol-repr/representation';\r\n/** Note, if this is changed, the CSS for `msp-sequence-number` needs adjustment too */\r\nvar MaxSequenceNumberSize = 5;\r\n// TODO: this is somewhat inefficient and should be done using a canvas.\r\nvar Sequence = /** @class */ (function (_super) {\r\n    __extends(Sequence, _super);\r\n    function Sequence() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.parentDiv = React.createRef();\r\n        _this.lastMouseOverSeqIdx = -1;\r\n        _this.highlightQueue = new Subject();\r\n        _this.lociHighlightProvider = function (loci, action) {\r\n            var changed = _this.props.sequenceWrapper.markResidue(loci.loci, action);\r\n            if (changed)\r\n                _this.updateMarker();\r\n        };\r\n        _this.lociSelectionProvider = function (loci, action) {\r\n            var changed = _this.props.sequenceWrapper.markResidue(loci.loci, action);\r\n            if (changed)\r\n                _this.updateMarker();\r\n        };\r\n        _this.contextMenu = function (e) {\r\n            e.preventDefault();\r\n        };\r\n        _this.mouseDownLoci = undefined;\r\n        _this.mouseDown = function (e) {\r\n            e.stopPropagation();\r\n            var seqIdx = _this.getSeqIdx(e);\r\n            var loci = _this.getLoci(seqIdx);\r\n            var buttons = getButtons(e.nativeEvent);\r\n            var button = getButton(e.nativeEvent);\r\n            var modifiers = getModifiers(e.nativeEvent);\r\n            _this.click(loci, buttons, button, modifiers);\r\n            _this.mouseDownLoci = loci;\r\n        };\r\n        _this.mouseUp = function (e) {\r\n            e.stopPropagation();\r\n            // ignore mouse-up events without a bound loci\r\n            if (_this.mouseDownLoci === undefined)\r\n                return;\r\n            var seqIdx = _this.getSeqIdx(e);\r\n            var loci = _this.getLoci(seqIdx);\r\n            if (loci && !StructureElement.Loci.areEqual(_this.mouseDownLoci, loci)) {\r\n                var buttons = getButtons(e.nativeEvent);\r\n                var button = getButton(e.nativeEvent);\r\n                var modifiers = getModifiers(e.nativeEvent);\r\n                var ref = _this.mouseDownLoci.elements[0];\r\n                var ext = loci.elements[0];\r\n                var min = Math.min(OrderedSet.min(ref.indices), OrderedSet.min(ext.indices));\r\n                var max = Math.max(OrderedSet.max(ref.indices), OrderedSet.max(ext.indices));\r\n                var range = StructureElement.Loci(loci.structure, [{\r\n                        unit: ref.unit,\r\n                        indices: OrderedSet.ofRange(min, max)\r\n                    }]);\r\n                _this.click(StructureElement.Loci.subtract(range, _this.mouseDownLoci), buttons, button, modifiers);\r\n            }\r\n            _this.mouseDownLoci = undefined;\r\n        };\r\n        _this.location = StructureElement.Location.create(void 0);\r\n        _this.mouseMove = function (e) {\r\n            e.stopPropagation();\r\n            var buttons = getButtons(e.nativeEvent);\r\n            var button = getButton(e.nativeEvent);\r\n            var modifiers = getModifiers(e.nativeEvent);\r\n            var el = e.target;\r\n            if (!el || !el.getAttribute) {\r\n                if (_this.lastMouseOverSeqIdx === -1)\r\n                    return;\r\n                _this.lastMouseOverSeqIdx = -1;\r\n                _this.highlightQueue.next({ seqIdx: -1, buttons: buttons, button: button, modifiers: modifiers });\r\n                return;\r\n            }\r\n            var seqIdx = el.hasAttribute('data-seqid') ? +el.getAttribute('data-seqid') : -1;\r\n            if (_this.lastMouseOverSeqIdx === seqIdx) {\r\n                return;\r\n            }\r\n            else {\r\n                _this.lastMouseOverSeqIdx = seqIdx;\r\n                if (_this.mouseDownLoci !== undefined) {\r\n                    var loci = _this.getLoci(seqIdx);\r\n                    _this.hover(loci, 0 /* None */, 0 /* None */, __assign(__assign({}, modifiers), { shift: true }));\r\n                }\r\n                else {\r\n                    _this.highlightQueue.next({ seqIdx: seqIdx, buttons: buttons, button: button, modifiers: modifiers });\r\n                }\r\n            }\r\n        };\r\n        _this.mouseLeave = function (e) {\r\n            e.stopPropagation();\r\n            _this.mouseDownLoci = undefined;\r\n            if (_this.lastMouseOverSeqIdx === -1)\r\n                return;\r\n            _this.lastMouseOverSeqIdx = -1;\r\n            var buttons = getButtons(e.nativeEvent);\r\n            var button = getButton(e.nativeEvent);\r\n            var modifiers = getModifiers(e.nativeEvent);\r\n            _this.highlightQueue.next({ seqIdx: -1, buttons: buttons, button: button, modifiers: modifiers });\r\n        };\r\n        return _this;\r\n    }\r\n    Object.defineProperty(Sequence.prototype, \"sequenceNumberPeriod\", {\r\n        get: function () {\r\n            if (this.props.sequenceNumberPeriod !== undefined) {\r\n                return this.props.sequenceNumberPeriod;\r\n            }\r\n            if (this.props.sequenceWrapper.length > 10)\r\n                return 10;\r\n            var lastSeqNum = this.getSequenceNumber(this.props.sequenceWrapper.length - 1);\r\n            if (lastSeqNum.length > 1)\r\n                return 5;\r\n            return 1;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Sequence.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider);\r\n        this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider);\r\n        this.subscribe(debounceTime(15)(this.highlightQueue), function (e) {\r\n            var loci = _this.getLoci(e.seqIdx < 0 ? void 0 : e.seqIdx);\r\n            _this.hover(loci, e.buttons, e.button, e.modifiers);\r\n        });\r\n        // this.updateMarker()\r\n    };\r\n    Sequence.prototype.componentWillUnmount = function () {\r\n        _super.prototype.componentWillUnmount.call(this);\r\n        this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider);\r\n        this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider);\r\n    };\r\n    Sequence.prototype.getLoci = function (seqIdx) {\r\n        if (seqIdx !== undefined) {\r\n            var loci = this.props.sequenceWrapper.getLoci(seqIdx);\r\n            if (!StructureElement.Loci.isEmpty(loci))\r\n                return loci;\r\n        }\r\n    };\r\n    Sequence.prototype.getSeqIdx = function (e) {\r\n        var seqIdx = undefined;\r\n        var el = e.target;\r\n        if (el && el.getAttribute) {\r\n            seqIdx = el.hasAttribute('data-seqid') ? +el.getAttribute('data-seqid') : undefined;\r\n        }\r\n        return seqIdx;\r\n    };\r\n    Sequence.prototype.hover = function (loci, buttons, button, modifiers) {\r\n        var ev = { current: Representation.Loci.Empty, buttons: buttons, button: button, modifiers: modifiers };\r\n        if (loci !== undefined && !StructureElement.Loci.isEmpty(loci)) {\r\n            ev.current = { loci: loci };\r\n        }\r\n        this.plugin.behaviors.interaction.hover.next(ev);\r\n    };\r\n    Sequence.prototype.click = function (loci, buttons, button, modifiers) {\r\n        var ev = { current: Representation.Loci.Empty, buttons: buttons, button: button, modifiers: modifiers };\r\n        if (loci !== undefined && !StructureElement.Loci.isEmpty(loci)) {\r\n            ev.current = { loci: loci };\r\n        }\r\n        this.plugin.behaviors.interaction.click.next(ev);\r\n    };\r\n    Sequence.prototype.getBackgroundColor = function (marker) {\r\n        // TODO: make marker color configurable\r\n        if (typeof marker === 'undefined')\r\n            console.error('unexpected marker value');\r\n        return marker === 0\r\n            ? ''\r\n            : marker % 2 === 0\r\n                ? 'rgb(51, 255, 25)' // selected\r\n                : 'rgb(255, 102, 153)'; // highlighted\r\n    };\r\n    Sequence.prototype.getResidueClass = function (seqIdx, label) {\r\n        return label.length > 1\r\n            ? this.props.sequenceWrapper.residueClass(seqIdx) + (seqIdx === 0 ? ' msp-sequence-residue-long-begin' : ' msp-sequence-residue-long')\r\n            : this.props.sequenceWrapper.residueClass(seqIdx);\r\n    };\r\n    Sequence.prototype.residue = function (seqIdx, label, marker) {\r\n        return _jsx(\"span\", __assign({ \"data-seqid\": seqIdx, style: { backgroundColor: this.getBackgroundColor(marker) }, className: this.getResidueClass(seqIdx, label) }, { children: \"\\u200B\" + label + \"\\u200B\" }), seqIdx);\r\n    };\r\n    Sequence.prototype.getSequenceNumberClass = function (seqIdx, seqNum, label) {\r\n        var classList = ['msp-sequence-number'];\r\n        if (seqNum.startsWith('-')) {\r\n            if (label.length > 1 && seqIdx > 0)\r\n                classList.push('msp-sequence-number-long-negative');\r\n            else\r\n                classList.push('msp-sequence-number-negative');\r\n        }\r\n        else {\r\n            if (label.length > 1 && seqIdx > 0)\r\n                classList.push('msp-sequence-number-long');\r\n        }\r\n        return classList.join(' ');\r\n    };\r\n    Sequence.prototype.getSequenceNumber = function (seqIdx) {\r\n        var seqNum = '';\r\n        var loci = this.props.sequenceWrapper.getLoci(seqIdx);\r\n        var l = StructureElement.Loci.getFirstLocation(loci, this.location);\r\n        if (l) {\r\n            if (Unit.isAtomic(l.unit)) {\r\n                var seqId = StructureProperties.residue.auth_seq_id(l);\r\n                var insCode = StructureProperties.residue.pdbx_PDB_ins_code(l);\r\n                seqNum = \"\" + seqId + (insCode ? insCode : '');\r\n            }\r\n            else if (Unit.isCoarse(l.unit)) {\r\n                seqNum = \"\" + (seqIdx + 1);\r\n            }\r\n        }\r\n        return seqNum;\r\n    };\r\n    Sequence.prototype.padSeqNum = function (n) {\r\n        if (n.length < MaxSequenceNumberSize)\r\n            return n + new Array(MaxSequenceNumberSize - n.length + 1).join('\\u00A0');\r\n        return n;\r\n    };\r\n    Sequence.prototype.getSequenceNumberSpan = function (seqIdx, label) {\r\n        var seqNum = this.getSequenceNumber(seqIdx);\r\n        return _jsx(\"span\", __assign({ className: this.getSequenceNumberClass(seqIdx, seqNum, label) }, { children: this.padSeqNum(seqNum) }), \"marker-\" + seqIdx);\r\n    };\r\n    Sequence.prototype.updateMarker = function () {\r\n        if (!this.parentDiv.current)\r\n            return;\r\n        var xs = this.parentDiv.current.children;\r\n        var markerArray = this.props.sequenceWrapper.markerArray;\r\n        var hasNumbers = !this.props.hideSequenceNumbers, period = this.sequenceNumberPeriod;\r\n        // let first: HTMLSpanElement | undefined;\r\n        var o = 0;\r\n        for (var i = 0, il = markerArray.length; i < il; i++) {\r\n            if (hasNumbers && i % period === 0 && i < il)\r\n                o++;\r\n            // o + 1 to account for help icon\r\n            var span = xs[o];\r\n            if (!span)\r\n                return;\r\n            o++;\r\n            // if (!first && markerArray[i] > 0) {\r\n            //     first = span;\r\n            // }\r\n            var backgroundColor = this.getBackgroundColor(markerArray[i]);\r\n            if (span.style.backgroundColor !== backgroundColor)\r\n                span.style.backgroundColor = backgroundColor;\r\n        }\r\n        // if (first) {\r\n        //     first.scrollIntoView({ block: 'nearest' });\r\n        // }\r\n    };\r\n    Sequence.prototype.render = function () {\r\n        var sw = this.props.sequenceWrapper;\r\n        var elems = [];\r\n        var hasNumbers = !this.props.hideSequenceNumbers, period = this.sequenceNumberPeriod;\r\n        for (var i = 0, il = sw.length; i < il; ++i) {\r\n            var label = sw.residueLabel(i);\r\n            // add sequence number before name so the html element do not get separated by a line-break\r\n            if (hasNumbers && i % period === 0 && i < il) {\r\n                elems[elems.length] = this.getSequenceNumberSpan(i, label);\r\n            }\r\n            elems[elems.length] = this.residue(i, label, sw.markerArray[i]);\r\n        }\r\n        // calling .updateMarker here is neccesary to ensure existing\r\n        // residue spans are updated as react won't update them\r\n        this.updateMarker();\r\n        return _jsx(\"div\", __assign({ className: 'msp-sequence-wrapper', onContextMenu: this.contextMenu, onMouseDown: this.mouseDown, onMouseUp: this.mouseUp, onMouseMove: this.mouseMove, onMouseLeave: this.mouseLeave, ref: this.parentDiv }, { children: elems }), void 0);\r\n    };\r\n    return Sequence;\r\n}(PluginUIComponent));\r\nexport { Sequence };\r\n//# sourceMappingURL=sequence.js.map"]},"metadata":{},"sourceType":"module"}