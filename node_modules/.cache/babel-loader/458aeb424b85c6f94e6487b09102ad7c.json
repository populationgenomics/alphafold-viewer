{"ast":null,"code":"/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __extends } from \"tslib\";\nimport { PluginBehavior } from '../../../behavior';\nimport { ParamDefinition as PD } from '../../../../../mol-util/param-definition';\nimport { ValenceModelProvider } from '../../../../../mol-model-props/computed/valence-model';\nimport { PluginStateObject } from '../../../../../mol-plugin-state/objects';\nimport { StateSelection } from '../../../../../mol-state';\nimport { StructureElement } from '../../../../../mol-model/structure';\nimport { OrderedSet } from '../../../../../mol-data/int';\nimport { geometryLabel } from '../../../../../mol-model-props/computed/chemistry/geometry';\nimport { arraySetAdd } from '../../../../../mol-util/array';\nexport var ValenceModel = PluginBehavior.create({\n  name: 'computed-valence-model-prop',\n  category: 'custom-props',\n  display: {\n    name: 'Valence Model'\n  },\n  ctor:\n  /** @class */\n  function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      var _this = _super !== null && _super.apply(this, arguments) || this;\n\n      _this.provider = ValenceModelProvider;\n      _this.labelProvider = {\n        label: function (loci) {\n          if (!_this.params.showTooltip) return void 0;\n\n          switch (loci.kind) {\n            case 'element-loci':\n              if (loci.elements.length === 0) return void 0;\n              var labels = [];\n\n              var structures = _this.getStructures(loci.structure);\n\n              for (var _i = 0, structures_1 = structures; _i < structures_1.length; _i++) {\n                var s = structures_1[_i];\n\n                var valenceModel = _this.provider.get(s).value;\n\n                if (!valenceModel) continue;\n                var l = StructureElement.Loci.remap(loci, s);\n                if (l.elements.length !== 1) continue;\n                var e = l.elements[0];\n                if (OrderedSet.size(e.indices) !== 1) continue;\n                var vm = valenceModel.get(e.unit.id);\n                if (!vm) continue;\n                var idx = OrderedSet.start(e.indices);\n                var charge = vm.charge[idx];\n                var idealGeometry = vm.idealGeometry[idx];\n                var implicitH = vm.implicitH[idx];\n                var totalH = vm.totalH[idx];\n                labels.push(\"Valence Model: <small>Charge</small> \" + charge + \" | <small>Ideal Geometry</small> \" + geometryLabel(idealGeometry) + \" | <small>Implicit H</small> \" + implicitH + \" | <small>Total H</small> \" + totalH);\n              }\n\n              return labels.length ? labels.join('<br/>') : undefined;\n\n            default:\n              return void 0;\n          }\n        }\n      };\n      return _this;\n    }\n\n    class_1.prototype.getStructures = function (structure) {\n      var structures = [];\n      var root = this.ctx.helpers.substructureParent.get(structure);\n\n      if (root) {\n        var state = this.ctx.state.data;\n        var selections = state.select(StateSelection.Generators.ofType(PluginStateObject.Molecule.Structure, root.transform.ref));\n\n        for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\n          var s = selections_1[_i];\n          if (s.obj) arraySetAdd(structures, s.obj.data);\n        }\n      }\n\n      return structures;\n    };\n\n    class_1.prototype.update = function (p) {\n      var updated = this.params.autoAttach !== p.autoAttach || this.params.showTooltip !== p.showTooltip;\n      this.params.autoAttach = p.autoAttach;\n      this.params.showTooltip = p.showTooltip;\n      this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name, this.params.autoAttach);\n      return updated;\n    };\n\n    class_1.prototype.register = function () {\n      this.ctx.customStructureProperties.register(this.provider, this.params.autoAttach);\n      this.ctx.managers.lociLabels.addProvider(this.labelProvider);\n    };\n\n    class_1.prototype.unregister = function () {\n      this.ctx.customStructureProperties.unregister(this.provider.descriptor.name);\n      this.ctx.managers.lociLabels.removeProvider(this.labelProvider);\n    };\n\n    return class_1;\n  }(PluginBehavior.Handler),\n  params: function () {\n    return {\n      autoAttach: PD.Boolean(false),\n      showTooltip: PD.Boolean(true)\n    };\n  }\n});","map":{"version":3,"sources":["../../../../../../src/mol-plugin/behavior/dynamic/custom-props/computed/valence-model.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __extends } from \"tslib\";\r\nimport { PluginBehavior } from '../../../behavior';\r\nimport { ParamDefinition as PD } from '../../../../../mol-util/param-definition';\r\nimport { ValenceModelProvider } from '../../../../../mol-model-props/computed/valence-model';\r\nimport { PluginStateObject } from '../../../../../mol-plugin-state/objects';\r\nimport { StateSelection } from '../../../../../mol-state';\r\nimport { StructureElement } from '../../../../../mol-model/structure';\r\nimport { OrderedSet } from '../../../../../mol-data/int';\r\nimport { geometryLabel } from '../../../../../mol-model-props/computed/chemistry/geometry';\r\nimport { arraySetAdd } from '../../../../../mol-util/array';\r\nexport var ValenceModel = PluginBehavior.create({\r\n    name: 'computed-valence-model-prop',\r\n    category: 'custom-props',\r\n    display: { name: 'Valence Model' },\r\n    ctor: /** @class */ (function (_super) {\r\n        __extends(class_1, _super);\r\n        function class_1() {\r\n            var _this = _super !== null && _super.apply(this, arguments) || this;\r\n            _this.provider = ValenceModelProvider;\r\n            _this.labelProvider = {\r\n                label: function (loci) {\r\n                    if (!_this.params.showTooltip)\r\n                        return void 0;\r\n                    switch (loci.kind) {\r\n                        case 'element-loci':\r\n                            if (loci.elements.length === 0)\r\n                                return void 0;\r\n                            var labels = [];\r\n                            var structures = _this.getStructures(loci.structure);\r\n                            for (var _i = 0, structures_1 = structures; _i < structures_1.length; _i++) {\r\n                                var s = structures_1[_i];\r\n                                var valenceModel = _this.provider.get(s).value;\r\n                                if (!valenceModel)\r\n                                    continue;\r\n                                var l = StructureElement.Loci.remap(loci, s);\r\n                                if (l.elements.length !== 1)\r\n                                    continue;\r\n                                var e = l.elements[0];\r\n                                if (OrderedSet.size(e.indices) !== 1)\r\n                                    continue;\r\n                                var vm = valenceModel.get(e.unit.id);\r\n                                if (!vm)\r\n                                    continue;\r\n                                var idx = OrderedSet.start(e.indices);\r\n                                var charge = vm.charge[idx];\r\n                                var idealGeometry = vm.idealGeometry[idx];\r\n                                var implicitH = vm.implicitH[idx];\r\n                                var totalH = vm.totalH[idx];\r\n                                labels.push(\"Valence Model: <small>Charge</small> \" + charge + \" | <small>Ideal Geometry</small> \" + geometryLabel(idealGeometry) + \" | <small>Implicit H</small> \" + implicitH + \" | <small>Total H</small> \" + totalH);\r\n                            }\r\n                            return labels.length ? labels.join('<br/>') : undefined;\r\n                        default: return void 0;\r\n                    }\r\n                }\r\n            };\r\n            return _this;\r\n        }\r\n        class_1.prototype.getStructures = function (structure) {\r\n            var structures = [];\r\n            var root = this.ctx.helpers.substructureParent.get(structure);\r\n            if (root) {\r\n                var state = this.ctx.state.data;\r\n                var selections = state.select(StateSelection.Generators.ofType(PluginStateObject.Molecule.Structure, root.transform.ref));\r\n                for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\r\n                    var s = selections_1[_i];\r\n                    if (s.obj)\r\n                        arraySetAdd(structures, s.obj.data);\r\n                }\r\n            }\r\n            return structures;\r\n        };\r\n        class_1.prototype.update = function (p) {\r\n            var updated = (this.params.autoAttach !== p.autoAttach ||\r\n                this.params.showTooltip !== p.showTooltip);\r\n            this.params.autoAttach = p.autoAttach;\r\n            this.params.showTooltip = p.showTooltip;\r\n            this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name, this.params.autoAttach);\r\n            return updated;\r\n        };\r\n        class_1.prototype.register = function () {\r\n            this.ctx.customStructureProperties.register(this.provider, this.params.autoAttach);\r\n            this.ctx.managers.lociLabels.addProvider(this.labelProvider);\r\n        };\r\n        class_1.prototype.unregister = function () {\r\n            this.ctx.customStructureProperties.unregister(this.provider.descriptor.name);\r\n            this.ctx.managers.lociLabels.removeProvider(this.labelProvider);\r\n        };\r\n        return class_1;\r\n    }(PluginBehavior.Handler)),\r\n    params: function () { return ({\r\n        autoAttach: PD.Boolean(false),\r\n        showTooltip: PD.Boolean(true)\r\n    }); }\r\n});\r\n//# sourceMappingURL=valence-model.js.map"]},"metadata":{},"sourceType":"module"}