{"ast":null,"code":"import { __assign, __awaiter, __extends, __generator } from \"tslib\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\n/**\r\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\n\nimport { OrderedMap } from 'immutable';\nimport { PluginCommands } from '../../mol-plugin/commands';\nimport { PluginConfig } from '../../mol-plugin/config';\nimport { PluginState } from '../../mol-plugin/state';\nimport { shallowEqualObjects } from '../../mol-util';\nimport { formatTimespan } from '../../mol-util/now';\nimport { ParamDefinition as PD } from '../../mol-util/param-definition';\nimport { urlCombine } from '../../mol-util/url';\nimport { PluginUIComponent, PurePluginUIComponent } from '../base';\nimport { Button, ExpandGroup, IconButton, SectionHeader } from '../controls/common';\nimport { Icon, SaveOutlinedSvg, GetAppSvg, OpenInBrowserSvg, WarningSvg, DeleteOutlinedSvg, AddSvg, ArrowUpwardSvg, SwapHorizSvg, ArrowDownwardSvg, RefreshSvg, CloudUploadSvg } from '../controls/icons';\nimport { ParameterControls } from '../controls/parameters';\n\nvar StateSnapshots =\n/** @class */\nfunction (_super) {\n  __extends(StateSnapshots, _super);\n\n  function StateSnapshots() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  StateSnapshots.prototype.render = function () {\n    var _a;\n\n    return _jsxs(\"div\", {\n      children: [_jsx(SectionHeader, {\n        icon: SaveOutlinedSvg,\n        title: 'Plugin State'\n      }, void 0), _jsx(\"div\", __assign({\n        style: {\n          marginBottom: '10px'\n        }\n      }, {\n        children: _jsx(ExpandGroup, __assign({\n          header: 'Save Options',\n          initiallyExpanded: false\n        }, {\n          children: _jsx(LocalStateSnapshotParams, {}, void 0)\n        }), void 0)\n      }), void 0), _jsx(LocalStateSnapshots, {}, void 0), _jsx(LocalStateSnapshotList, {}, void 0), _jsx(SectionHeader, {\n        title: 'Save as File',\n        accent: 'blue'\n      }, void 0), _jsx(StateExportImportControls, {}, void 0), ((_a = this.plugin.spec.components) === null || _a === void 0 ? void 0 : _a.remoteState) !== 'none' && _jsx(RemoteStateSnapshots, {}, void 0)]\n    }, void 0);\n  };\n\n  return StateSnapshots;\n}(PluginUIComponent);\n\nexport { StateSnapshots };\n\nvar StateExportImportControls =\n/** @class */\nfunction (_super) {\n  __extends(StateExportImportControls, _super);\n\n  function StateExportImportControls() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.downloadToFileJson = function () {\n      var _a, _b;\n\n      (_b = (_a = _this.props).onAction) === null || _b === void 0 ? void 0 : _b.call(_a);\n      PluginCommands.State.Snapshots.DownloadToFile(_this.plugin, {\n        type: 'json'\n      });\n    };\n\n    _this.downloadToFileZip = function () {\n      var _a, _b;\n\n      (_b = (_a = _this.props).onAction) === null || _b === void 0 ? void 0 : _b.call(_a);\n      PluginCommands.State.Snapshots.DownloadToFile(_this.plugin, {\n        type: 'zip'\n      });\n    };\n\n    _this.open = function (e) {\n      var _a, _b;\n\n      if (!e.target.files || !e.target.files[0]) {\n        _this.plugin.log.error('No state file selected');\n\n        return;\n      }\n\n      (_b = (_a = _this.props).onAction) === null || _b === void 0 ? void 0 : _b.call(_a);\n      PluginCommands.State.Snapshots.OpenFile(_this.plugin, {\n        file: e.target.files[0]\n      });\n    };\n\n    return _this;\n  }\n\n  StateExportImportControls.prototype.render = function () {\n    return _jsxs(_Fragment, {\n      children: [_jsxs(\"div\", __assign({\n        className: 'msp-flex-row'\n      }, {\n        children: [_jsx(Button, __assign({\n          icon: GetAppSvg,\n          onClick: this.downloadToFileJson,\n          title: 'Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input.'\n        }, {\n          children: \"State\"\n        }), void 0), _jsx(Button, __assign({\n          icon: GetAppSvg,\n          onClick: this.downloadToFileZip,\n          title: 'Save the state including the input data.'\n        }, {\n          children: \"Session\"\n        }), void 0), _jsxs(\"div\", __assign({\n          className: 'msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file'\n        }, {\n          children: [_jsx(Icon, {\n            svg: OpenInBrowserSvg,\n            inline: true\n          }, void 0), \" Open \", _jsx(\"input\", {\n            onChange: this.open,\n            type: 'file',\n            multiple: false,\n            accept: '.molx,.molj'\n          }, void 0)]\n        }), void 0)]\n      }), void 0), _jsxs(\"div\", __assign({\n        className: 'msp-help-text',\n        style: {\n          padding: '10px'\n        }\n      }, {\n        children: [_jsx(Icon, {\n          svg: WarningSvg\n        }, void 0), \" This is an experimental feature and stored states/sessions might not be openable in a future version.\"]\n      }), void 0)]\n    }, void 0);\n  };\n\n  return StateExportImportControls;\n}(PluginUIComponent);\n\nexport { StateExportImportControls };\n\nvar LocalStateSnapshotParams =\n/** @class */\nfunction (_super) {\n  __extends(LocalStateSnapshotParams, _super);\n\n  function LocalStateSnapshotParams() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  LocalStateSnapshotParams.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.state.snapshotParams, function () {\n      return _this.forceUpdate();\n    });\n  };\n\n  LocalStateSnapshotParams.prototype.render = function () {\n    return _jsx(ParameterControls, {\n      params: PluginState.SnapshotParams,\n      values: this.plugin.state.snapshotParams.value,\n      onChangeValues: this.plugin.state.setSnapshotParams\n    }, void 0);\n  };\n\n  return LocalStateSnapshotParams;\n}(PluginUIComponent);\n\nexport { LocalStateSnapshotParams };\n\nvar LocalStateSnapshots =\n/** @class */\nfunction (_super) {\n  __extends(LocalStateSnapshots, _super);\n\n  function LocalStateSnapshots() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      params: PD.getDefaultValues(LocalStateSnapshots.Params)\n    };\n\n    _this.add = function () {\n      PluginCommands.State.Snapshots.Add(_this.plugin, {\n        name: _this.state.params.name,\n        description: _this.state.params.description\n      });\n    };\n\n    _this.updateParams = function (params) {\n      return _this.setState({\n        params: params\n      });\n    };\n\n    _this.clear = function () {\n      PluginCommands.State.Snapshots.Clear(_this.plugin, {});\n    };\n\n    return _this;\n  }\n\n  LocalStateSnapshots.prototype.shouldComponentUpdate = function (nextProps, nextState) {\n    return !shallowEqualObjects(this.props, nextProps) || !shallowEqualObjects(this.state, nextState);\n  };\n\n  LocalStateSnapshots.prototype.render = function () {\n    return _jsxs(\"div\", {\n      children: [_jsx(ParameterControls, {\n        params: LocalStateSnapshots.Params,\n        values: this.state.params,\n        onEnter: this.add,\n        onChangeValues: this.updateParams\n      }, void 0), _jsxs(\"div\", __assign({\n        className: 'msp-flex-row'\n      }, {\n        children: [_jsx(IconButton, {\n          onClick: this.clear,\n          svg: DeleteOutlinedSvg,\n          title: 'Remove All'\n        }, void 0), _jsx(Button, __assign({\n          onClick: this.add,\n          icon: AddSvg,\n          style: {\n            textAlign: 'right'\n          },\n          commit: true\n        }, {\n          children: \"Add\"\n        }), void 0)]\n      }), void 0)]\n    }, void 0);\n  };\n\n  LocalStateSnapshots.Params = {\n    name: PD.Text(),\n    description: PD.Text()\n  };\n  return LocalStateSnapshots;\n}(PluginUIComponent);\n\nexport { LocalStateSnapshots };\n\nvar LocalStateSnapshotList =\n/** @class */\nfunction (_super) {\n  __extends(LocalStateSnapshotList, _super);\n\n  function LocalStateSnapshotList() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.apply = function (e) {\n      var id = e.currentTarget.getAttribute('data-id');\n      if (!id) return;\n      PluginCommands.State.Snapshots.Apply(_this.plugin, {\n        id: id\n      });\n    };\n\n    _this.remove = function (e) {\n      var id = e.currentTarget.getAttribute('data-id');\n      if (!id) return;\n      PluginCommands.State.Snapshots.Remove(_this.plugin, {\n        id: id\n      });\n    };\n\n    _this.moveUp = function (e) {\n      var id = e.currentTarget.getAttribute('data-id');\n      if (!id) return;\n      PluginCommands.State.Snapshots.Move(_this.plugin, {\n        id: id,\n        dir: -1\n      });\n    };\n\n    _this.moveDown = function (e) {\n      var id = e.currentTarget.getAttribute('data-id');\n      if (!id) return;\n      PluginCommands.State.Snapshots.Move(_this.plugin, {\n        id: id,\n        dir: 1\n      });\n    };\n\n    _this.replace = function (e) {\n      var id = e.currentTarget.getAttribute('data-id');\n      if (!id) return;\n      PluginCommands.State.Snapshots.Replace(_this.plugin, {\n        id: id\n      });\n    };\n\n    return _this;\n  }\n\n  LocalStateSnapshotList.prototype.componentDidMount = function () {\n    var _this = this;\n\n    this.subscribe(this.plugin.managers.snapshot.events.changed, function () {\n      return _this.forceUpdate();\n    });\n  };\n\n  LocalStateSnapshotList.prototype.render = function () {\n    var _this = this;\n\n    var current = this.plugin.managers.snapshot.state.current;\n    return _jsx(\"ul\", __assign({\n      style: {\n        listStyle: 'none',\n        marginTop: '10px'\n      },\n      className: 'msp-state-list'\n    }, {\n      children: this.plugin.managers.snapshot.state.entries.map(function (e) {\n        return _jsxs(\"li\", __assign({\n          className: 'msp-flex-row'\n        }, {\n          children: [_jsxs(Button, __assign({\n            \"data-id\": e.snapshot.id,\n            onClick: _this.apply,\n            className: 'msp-no-overflow'\n          }, {\n            children: [_jsx(\"span\", __assign({\n              style: {\n                fontWeight: e.snapshot.id === current ? 'bold' : void 0\n              }\n            }, {\n              children: e.name || new Date(e.timestamp).toLocaleString()\n            }), void 0), \" \", _jsx(\"small\", {\n              children: \"\" + (e.snapshot.durationInMs ? formatTimespan(e.snapshot.durationInMs, false) + (\"\" + (e.description ? ', ' : '')) : '') + (e.description ? e.description : '')\n            }, void 0)]\n          }), void 0), _jsx(IconButton, {\n            svg: ArrowUpwardSvg,\n            \"data-id\": e.snapshot.id,\n            title: 'Move Up',\n            onClick: _this.moveUp,\n            flex: '20px'\n          }, void 0), _jsx(IconButton, {\n            svg: ArrowDownwardSvg,\n            \"data-id\": e.snapshot.id,\n            title: 'Move Down',\n            onClick: _this.moveDown,\n            flex: '20px'\n          }, void 0), _jsx(IconButton, {\n            svg: SwapHorizSvg,\n            \"data-id\": e.snapshot.id,\n            title: 'Replace',\n            onClick: _this.replace,\n            flex: '20px'\n          }, void 0), _jsx(IconButton, {\n            svg: DeleteOutlinedSvg,\n            \"data-id\": e.snapshot.id,\n            title: 'Remove',\n            onClick: _this.remove,\n            flex: '20px'\n          }, void 0)]\n        }), e.snapshot.id);\n      })\n    }), void 0);\n  };\n\n  return LocalStateSnapshotList;\n}(PluginUIComponent);\n\nexport { LocalStateSnapshotList };\n\nvar RemoteStateSnapshots =\n/** @class */\nfunction (_super) {\n  __extends(RemoteStateSnapshots, _super);\n\n  function RemoteStateSnapshots() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.Params = {\n      name: PD.Text(),\n      options: PD.Group({\n        description: PD.Text(),\n        playOnLoad: PD.Boolean(false),\n        serverUrl: PD.Text(_this.plugin.config.get(PluginConfig.State.CurrentServer))\n      })\n    };\n    _this.state = {\n      params: PD.getDefaultValues(_this.Params),\n      entries: OrderedMap(),\n      isBusy: false\n    };\n    _this.ListOnlyParams = {\n      options: PD.Group({\n        serverUrl: PD.Text(_this.plugin.config.get(PluginConfig.State.CurrentServer))\n      }, {\n        isFlat: true\n      })\n    };\n    _this._mounted = false;\n\n    _this.refresh = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var json, entries, _i, json_1, e, e_1;\n\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 2,, 3]);\n\n              this.setState({\n                isBusy: true\n              });\n              this.plugin.config.set(PluginConfig.State.CurrentServer, this.state.params.options.serverUrl);\n              return [4\n              /*yield*/\n              , this.plugin.runTask(this.plugin.fetch({\n                url: this.serverUrl('list'),\n                type: 'json'\n              }))];\n\n            case 1:\n              json = _a.sent() || [];\n              json.sort(function (a, b) {\n                if (a.isSticky === b.isSticky) return a.timestamp - b.timestamp;\n                return a.isSticky ? -1 : 1;\n              });\n              entries = OrderedMap().asMutable();\n\n              for (_i = 0, json_1 = json; _i < json_1.length; _i++) {\n                e = json_1[_i];\n                entries.set(e.id, __assign(__assign({}, e), {\n                  url: this.serverUrl(\"get/\" + e.id),\n                  removeUrl: this.serverUrl(\"remove/\" + e.id)\n                }));\n              }\n\n              if (this._mounted) this.setState({\n                entries: entries.asImmutable(),\n                isBusy: false\n              });\n              return [3\n              /*break*/\n              , 3];\n\n            case 2:\n              e_1 = _a.sent();\n              this.plugin.log.error('Fetching Remote Snapshots: ' + e_1);\n              if (this._mounted) this.setState({\n                entries: OrderedMap(),\n                isBusy: false\n              });\n              return [3\n              /*break*/\n              , 3];\n\n            case 3:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.upload = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              this.setState({\n                isBusy: true\n              });\n              this.plugin.config.set(PluginConfig.State.CurrentServer, this.state.params.options.serverUrl);\n              return [4\n              /*yield*/\n              , PluginCommands.State.Snapshots.Upload(this.plugin, {\n                name: this.state.params.name,\n                description: this.state.params.options.description,\n                playOnLoad: this.state.params.options.playOnLoad,\n                serverUrl: this.state.params.options.serverUrl\n              })];\n\n            case 1:\n              _a.sent();\n\n              this.plugin.log.message('Snapshot uploaded.');\n\n              if (this._mounted) {\n                this.setState({\n                  isBusy: false\n                });\n                this.refresh();\n              }\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.fetch = function (e) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var id, entry;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              id = e.currentTarget.getAttribute('data-id');\n              if (!id) return [2\n              /*return*/\n              ];\n              entry = this.state.entries.get(id);\n              if (!entry) return [2\n              /*return*/\n              ];\n              this.setState({\n                isBusy: true\n              });\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1,, 3, 4]);\n\n              return [4\n              /*yield*/\n              , PluginCommands.State.Snapshots.Fetch(this.plugin, {\n                url: entry.url\n              })];\n\n            case 2:\n              _a.sent();\n\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              if (this._mounted) this.setState({\n                isBusy: false\n              });\n              return [7\n              /*endfinally*/\n              ];\n\n            case 4:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.remove = function (e) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var id, entry, _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              id = e.currentTarget.getAttribute('data-id');\n              if (!id) return [2\n              /*return*/\n              ];\n              entry = this.state.entries.get(id);\n              if (!entry) return [2\n              /*return*/\n              ];\n              this.setState({\n                entries: this.state.entries.remove(id)\n              });\n              _b.label = 1;\n\n            case 1:\n              _b.trys.push([1, 3,, 4]);\n\n              return [4\n              /*yield*/\n              , fetch(entry.removeUrl)];\n\n            case 2:\n              _b.sent();\n\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              _a = _b.sent();\n              return [3\n              /*break*/\n              , 4];\n\n            case 4:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    return _this;\n  }\n\n  RemoteStateSnapshots.prototype.componentDidMount = function () {\n    this.refresh(); // TODO: solve this by using \"PluginComponent\" with behaviors intead\n\n    this._mounted = true; // this.subscribe(UploadedEvent, this.refresh);\n  };\n\n  RemoteStateSnapshots.prototype.componentWillUnmount = function () {\n    this._mounted = false;\n  };\n\n  RemoteStateSnapshots.prototype.serverUrl = function (q) {\n    if (!q) return this.state.params.options.serverUrl;\n    return urlCombine(this.state.params.options.serverUrl, q);\n  };\n\n  RemoteStateSnapshots.prototype.render = function () {\n    var _this = this;\n\n    return _jsxs(_Fragment, {\n      children: [_jsx(SectionHeader, {\n        title: 'Remote States',\n        accent: 'blue'\n      }, void 0), !this.props.listOnly && _jsxs(_Fragment, {\n        children: [_jsx(ParameterControls, {\n          params: this.Params,\n          values: this.state.params,\n          onEnter: this.upload,\n          onChange: function (p) {\n            var _a;\n\n            _this.setState({\n              params: __assign(__assign({}, _this.state.params), (_a = {}, _a[p.name] = p.value, _a))\n            });\n          },\n          isDisabled: this.state.isBusy\n        }, void 0), _jsxs(\"div\", __assign({\n          className: 'msp-flex-row'\n        }, {\n          children: [_jsx(IconButton, {\n            onClick: this.refresh,\n            disabled: this.state.isBusy,\n            svg: RefreshSvg\n          }, void 0), _jsx(Button, __assign({\n            icon: CloudUploadSvg,\n            onClick: this.upload,\n            disabled: this.state.isBusy,\n            commit: true\n          }, {\n            children: \"Upload\"\n          }), void 0)]\n        }), void 0)]\n      }, void 0), _jsx(RemoteStateSnapshotList, {\n        entries: this.state.entries,\n        isBusy: this.state.isBusy,\n        serverUrl: this.state.params.options.serverUrl,\n        fetch: this.fetch,\n        remove: this.props.listOnly ? void 0 : this.remove\n      }, void 0), this.props.listOnly && _jsxs(\"div\", __assign({\n        style: {\n          marginTop: '10px'\n        }\n      }, {\n        children: [_jsx(ParameterControls, {\n          params: this.ListOnlyParams,\n          values: this.state.params,\n          onEnter: this.upload,\n          onChange: function (p) {\n            var _a;\n\n            _this.setState({\n              params: __assign(__assign({}, _this.state.params), (_a = {}, _a[p.name] = p.value, _a))\n            });\n          },\n          isDisabled: this.state.isBusy\n        }, void 0), _jsx(\"div\", __assign({\n          className: 'msp-flex-row'\n        }, {\n          children: _jsx(Button, __assign({\n            onClick: this.refresh,\n            disabled: this.state.isBusy,\n            icon: RefreshSvg\n          }, {\n            children: \"Refresh\"\n          }), void 0)\n        }), void 0)]\n      }), void 0)]\n    }, void 0);\n  };\n\n  return RemoteStateSnapshots;\n}(PluginUIComponent);\n\nexport { RemoteStateSnapshots };\n\nvar RemoteStateSnapshotList =\n/** @class */\nfunction (_super) {\n  __extends(RemoteStateSnapshotList, _super);\n\n  function RemoteStateSnapshotList() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.open = function (e) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var id, entry, url, qi;\n        return __generator(this, function (_a) {\n          id = e.currentTarget.getAttribute('data-id');\n          if (!id) return [2\n          /*return*/\n          ];\n          entry = this.props.entries.get(id);\n          if (!entry) return [2\n          /*return*/\n          ];\n          e.preventDefault();\n          url = \"\" + window.location;\n          qi = url.indexOf('?');\n          if (qi > 0) url = url.substr(0, qi);\n          window.open(url + \"?snapshot-url=\" + encodeURIComponent(entry.url), '_blank');\n          return [2\n          /*return*/\n          ];\n        });\n      });\n    };\n\n    return _this;\n  }\n\n  RemoteStateSnapshotList.prototype.render = function () {\n    var _this = this;\n\n    return _jsx(\"ul\", __assign({\n      style: {\n        listStyle: 'none',\n        marginTop: '10px'\n      },\n      className: 'msp-state-list'\n    }, {\n      children: this.props.entries.valueSeq().map(function (e) {\n        return _jsxs(\"li\", __assign({\n          className: 'msp-flex-row'\n        }, {\n          children: [_jsxs(Button, __assign({\n            \"data-id\": e.id,\n            onClick: _this.props.fetch,\n            disabled: _this.props.isBusy,\n            onContextMenu: _this.open,\n            title: 'Click to download, right-click to open in a new tab.'\n          }, {\n            children: [e.name || new Date(e.timestamp).toLocaleString(), \" \", _jsx(\"small\", {\n              children: e.description\n            }, void 0)]\n          }), void 0), !e.isSticky && _this.props.remove && _jsx(IconButton, {\n            svg: DeleteOutlinedSvg,\n            \"data-id\": e.id,\n            title: 'Remove',\n            onClick: _this.props.remove,\n            disabled: _this.props.isBusy,\n            small: true\n          }, void 0)]\n        }), e.id);\n      })\n    }), void 0);\n  };\n\n  return RemoteStateSnapshotList;\n}(PurePluginUIComponent);","map":{"version":3,"sources":["../../../src/mol-plugin-ui/state/snapshots.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __awaiter, __extends, __generator } from \"tslib\";\r\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\r\n/**\r\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { OrderedMap } from 'immutable';\r\nimport { PluginCommands } from '../../mol-plugin/commands';\r\nimport { PluginConfig } from '../../mol-plugin/config';\r\nimport { PluginState } from '../../mol-plugin/state';\r\nimport { shallowEqualObjects } from '../../mol-util';\r\nimport { formatTimespan } from '../../mol-util/now';\r\nimport { ParamDefinition as PD } from '../../mol-util/param-definition';\r\nimport { urlCombine } from '../../mol-util/url';\r\nimport { PluginUIComponent, PurePluginUIComponent } from '../base';\r\nimport { Button, ExpandGroup, IconButton, SectionHeader } from '../controls/common';\r\nimport { Icon, SaveOutlinedSvg, GetAppSvg, OpenInBrowserSvg, WarningSvg, DeleteOutlinedSvg, AddSvg, ArrowUpwardSvg, SwapHorizSvg, ArrowDownwardSvg, RefreshSvg, CloudUploadSvg } from '../controls/icons';\r\nimport { ParameterControls } from '../controls/parameters';\r\nvar StateSnapshots = /** @class */ (function (_super) {\r\n    __extends(StateSnapshots, _super);\r\n    function StateSnapshots() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    StateSnapshots.prototype.render = function () {\r\n        var _a;\r\n        return _jsxs(\"div\", { children: [_jsx(SectionHeader, { icon: SaveOutlinedSvg, title: 'Plugin State' }, void 0), _jsx(\"div\", __assign({ style: { marginBottom: '10px' } }, { children: _jsx(ExpandGroup, __assign({ header: 'Save Options', initiallyExpanded: false }, { children: _jsx(LocalStateSnapshotParams, {}, void 0) }), void 0) }), void 0), _jsx(LocalStateSnapshots, {}, void 0), _jsx(LocalStateSnapshotList, {}, void 0), _jsx(SectionHeader, { title: 'Save as File', accent: 'blue' }, void 0), _jsx(StateExportImportControls, {}, void 0), ((_a = this.plugin.spec.components) === null || _a === void 0 ? void 0 : _a.remoteState) !== 'none' && _jsx(RemoteStateSnapshots, {}, void 0)] }, void 0);\r\n    };\r\n    return StateSnapshots;\r\n}(PluginUIComponent));\r\nexport { StateSnapshots };\r\nvar StateExportImportControls = /** @class */ (function (_super) {\r\n    __extends(StateExportImportControls, _super);\r\n    function StateExportImportControls() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.downloadToFileJson = function () {\r\n            var _a, _b;\r\n            (_b = (_a = _this.props).onAction) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n            PluginCommands.State.Snapshots.DownloadToFile(_this.plugin, { type: 'json' });\r\n        };\r\n        _this.downloadToFileZip = function () {\r\n            var _a, _b;\r\n            (_b = (_a = _this.props).onAction) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n            PluginCommands.State.Snapshots.DownloadToFile(_this.plugin, { type: 'zip' });\r\n        };\r\n        _this.open = function (e) {\r\n            var _a, _b;\r\n            if (!e.target.files || !e.target.files[0]) {\r\n                _this.plugin.log.error('No state file selected');\r\n                return;\r\n            }\r\n            (_b = (_a = _this.props).onAction) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n            PluginCommands.State.Snapshots.OpenFile(_this.plugin, { file: e.target.files[0] });\r\n        };\r\n        return _this;\r\n    }\r\n    StateExportImportControls.prototype.render = function () {\r\n        return _jsxs(_Fragment, { children: [_jsxs(\"div\", __assign({ className: 'msp-flex-row' }, { children: [_jsx(Button, __assign({ icon: GetAppSvg, onClick: this.downloadToFileJson, title: 'Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input.' }, { children: \"State\" }), void 0), _jsx(Button, __assign({ icon: GetAppSvg, onClick: this.downloadToFileZip, title: 'Save the state including the input data.' }, { children: \"Session\" }), void 0), _jsxs(\"div\", __assign({ className: 'msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file' }, { children: [_jsx(Icon, { svg: OpenInBrowserSvg, inline: true }, void 0), \" Open \", _jsx(\"input\", { onChange: this.open, type: 'file', multiple: false, accept: '.molx,.molj' }, void 0)] }), void 0)] }), void 0), _jsxs(\"div\", __assign({ className: 'msp-help-text', style: { padding: '10px' } }, { children: [_jsx(Icon, { svg: WarningSvg }, void 0), \" This is an experimental feature and stored states/sessions might not be openable in a future version.\"] }), void 0)] }, void 0);\r\n    };\r\n    return StateExportImportControls;\r\n}(PluginUIComponent));\r\nexport { StateExportImportControls };\r\nvar LocalStateSnapshotParams = /** @class */ (function (_super) {\r\n    __extends(LocalStateSnapshotParams, _super);\r\n    function LocalStateSnapshotParams() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    LocalStateSnapshotParams.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.state.snapshotParams, function () { return _this.forceUpdate(); });\r\n    };\r\n    LocalStateSnapshotParams.prototype.render = function () {\r\n        return _jsx(ParameterControls, { params: PluginState.SnapshotParams, values: this.plugin.state.snapshotParams.value, onChangeValues: this.plugin.state.setSnapshotParams }, void 0);\r\n    };\r\n    return LocalStateSnapshotParams;\r\n}(PluginUIComponent));\r\nexport { LocalStateSnapshotParams };\r\nvar LocalStateSnapshots = /** @class */ (function (_super) {\r\n    __extends(LocalStateSnapshots, _super);\r\n    function LocalStateSnapshots() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = { params: PD.getDefaultValues(LocalStateSnapshots.Params) };\r\n        _this.add = function () {\r\n            PluginCommands.State.Snapshots.Add(_this.plugin, {\r\n                name: _this.state.params.name,\r\n                description: _this.state.params.description\r\n            });\r\n        };\r\n        _this.updateParams = function (params) { return _this.setState({ params: params }); };\r\n        _this.clear = function () {\r\n            PluginCommands.State.Snapshots.Clear(_this.plugin, {});\r\n        };\r\n        return _this;\r\n    }\r\n    LocalStateSnapshots.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n        return !shallowEqualObjects(this.props, nextProps) || !shallowEqualObjects(this.state, nextState);\r\n    };\r\n    LocalStateSnapshots.prototype.render = function () {\r\n        return _jsxs(\"div\", { children: [_jsx(ParameterControls, { params: LocalStateSnapshots.Params, values: this.state.params, onEnter: this.add, onChangeValues: this.updateParams }, void 0), _jsxs(\"div\", __assign({ className: 'msp-flex-row' }, { children: [_jsx(IconButton, { onClick: this.clear, svg: DeleteOutlinedSvg, title: 'Remove All' }, void 0), _jsx(Button, __assign({ onClick: this.add, icon: AddSvg, style: { textAlign: 'right' }, commit: true }, { children: \"Add\" }), void 0)] }), void 0)] }, void 0);\r\n    };\r\n    LocalStateSnapshots.Params = {\r\n        name: PD.Text(),\r\n        description: PD.Text()\r\n    };\r\n    return LocalStateSnapshots;\r\n}(PluginUIComponent));\r\nexport { LocalStateSnapshots };\r\nvar LocalStateSnapshotList = /** @class */ (function (_super) {\r\n    __extends(LocalStateSnapshotList, _super);\r\n    function LocalStateSnapshotList() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.apply = function (e) {\r\n            var id = e.currentTarget.getAttribute('data-id');\r\n            if (!id)\r\n                return;\r\n            PluginCommands.State.Snapshots.Apply(_this.plugin, { id: id });\r\n        };\r\n        _this.remove = function (e) {\r\n            var id = e.currentTarget.getAttribute('data-id');\r\n            if (!id)\r\n                return;\r\n            PluginCommands.State.Snapshots.Remove(_this.plugin, { id: id });\r\n        };\r\n        _this.moveUp = function (e) {\r\n            var id = e.currentTarget.getAttribute('data-id');\r\n            if (!id)\r\n                return;\r\n            PluginCommands.State.Snapshots.Move(_this.plugin, { id: id, dir: -1 });\r\n        };\r\n        _this.moveDown = function (e) {\r\n            var id = e.currentTarget.getAttribute('data-id');\r\n            if (!id)\r\n                return;\r\n            PluginCommands.State.Snapshots.Move(_this.plugin, { id: id, dir: 1 });\r\n        };\r\n        _this.replace = function (e) {\r\n            var id = e.currentTarget.getAttribute('data-id');\r\n            if (!id)\r\n                return;\r\n            PluginCommands.State.Snapshots.Replace(_this.plugin, { id: id });\r\n        };\r\n        return _this;\r\n    }\r\n    LocalStateSnapshotList.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        this.subscribe(this.plugin.managers.snapshot.events.changed, function () { return _this.forceUpdate(); });\r\n    };\r\n    LocalStateSnapshotList.prototype.render = function () {\r\n        var _this = this;\r\n        var current = this.plugin.managers.snapshot.state.current;\r\n        return _jsx(\"ul\", __assign({ style: { listStyle: 'none', marginTop: '10px' }, className: 'msp-state-list' }, { children: this.plugin.managers.snapshot.state.entries.map(function (e) { return _jsxs(\"li\", __assign({ className: 'msp-flex-row' }, { children: [_jsxs(Button, __assign({ \"data-id\": e.snapshot.id, onClick: _this.apply, className: 'msp-no-overflow' }, { children: [_jsx(\"span\", __assign({ style: { fontWeight: e.snapshot.id === current ? 'bold' : void 0 } }, { children: e.name || new Date(e.timestamp).toLocaleString() }), void 0), \" \", _jsx(\"small\", { children: \"\" + (e.snapshot.durationInMs ? formatTimespan(e.snapshot.durationInMs, false) + (\"\" + (e.description ? ', ' : '')) : '') + (e.description ? e.description : '') }, void 0)] }), void 0), _jsx(IconButton, { svg: ArrowUpwardSvg, \"data-id\": e.snapshot.id, title: 'Move Up', onClick: _this.moveUp, flex: '20px' }, void 0), _jsx(IconButton, { svg: ArrowDownwardSvg, \"data-id\": e.snapshot.id, title: 'Move Down', onClick: _this.moveDown, flex: '20px' }, void 0), _jsx(IconButton, { svg: SwapHorizSvg, \"data-id\": e.snapshot.id, title: 'Replace', onClick: _this.replace, flex: '20px' }, void 0), _jsx(IconButton, { svg: DeleteOutlinedSvg, \"data-id\": e.snapshot.id, title: 'Remove', onClick: _this.remove, flex: '20px' }, void 0)] }), e.snapshot.id); }) }), void 0);\r\n    };\r\n    return LocalStateSnapshotList;\r\n}(PluginUIComponent));\r\nexport { LocalStateSnapshotList };\r\nvar RemoteStateSnapshots = /** @class */ (function (_super) {\r\n    __extends(RemoteStateSnapshots, _super);\r\n    function RemoteStateSnapshots() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.Params = {\r\n            name: PD.Text(),\r\n            options: PD.Group({\r\n                description: PD.Text(),\r\n                playOnLoad: PD.Boolean(false),\r\n                serverUrl: PD.Text(_this.plugin.config.get(PluginConfig.State.CurrentServer))\r\n            })\r\n        };\r\n        _this.state = { params: PD.getDefaultValues(_this.Params), entries: OrderedMap(), isBusy: false };\r\n        _this.ListOnlyParams = {\r\n            options: PD.Group({\r\n                serverUrl: PD.Text(_this.plugin.config.get(PluginConfig.State.CurrentServer))\r\n            }, { isFlat: true })\r\n        };\r\n        _this._mounted = false;\r\n        _this.refresh = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var json, entries, _i, json_1, e, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        this.setState({ isBusy: true });\r\n                        this.plugin.config.set(PluginConfig.State.CurrentServer, this.state.params.options.serverUrl);\r\n                        return [4 /*yield*/, this.plugin.runTask(this.plugin.fetch({ url: this.serverUrl('list'), type: 'json' }))];\r\n                    case 1:\r\n                        json = (_a.sent()) || [];\r\n                        json.sort(function (a, b) {\r\n                            if (a.isSticky === b.isSticky)\r\n                                return a.timestamp - b.timestamp;\r\n                            return a.isSticky ? -1 : 1;\r\n                        });\r\n                        entries = OrderedMap().asMutable();\r\n                        for (_i = 0, json_1 = json; _i < json_1.length; _i++) {\r\n                            e = json_1[_i];\r\n                            entries.set(e.id, __assign(__assign({}, e), { url: this.serverUrl(\"get/\" + e.id), removeUrl: this.serverUrl(\"remove/\" + e.id) }));\r\n                        }\r\n                        if (this._mounted)\r\n                            this.setState({ entries: entries.asImmutable(), isBusy: false });\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        e_1 = _a.sent();\r\n                        this.plugin.log.error('Fetching Remote Snapshots: ' + e_1);\r\n                        if (this._mounted)\r\n                            this.setState({ entries: OrderedMap(), isBusy: false });\r\n                        return [3 /*break*/, 3];\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        _this.upload = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.setState({ isBusy: true });\r\n                        this.plugin.config.set(PluginConfig.State.CurrentServer, this.state.params.options.serverUrl);\r\n                        return [4 /*yield*/, PluginCommands.State.Snapshots.Upload(this.plugin, {\r\n                                name: this.state.params.name,\r\n                                description: this.state.params.options.description,\r\n                                playOnLoad: this.state.params.options.playOnLoad,\r\n                                serverUrl: this.state.params.options.serverUrl\r\n                            })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.plugin.log.message('Snapshot uploaded.');\r\n                        if (this._mounted) {\r\n                            this.setState({ isBusy: false });\r\n                            this.refresh();\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        _this.fetch = function (e) { return __awaiter(_this, void 0, void 0, function () {\r\n            var id, entry;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        id = e.currentTarget.getAttribute('data-id');\r\n                        if (!id)\r\n                            return [2 /*return*/];\r\n                        entry = this.state.entries.get(id);\r\n                        if (!entry)\r\n                            return [2 /*return*/];\r\n                        this.setState({ isBusy: true });\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, , 3, 4]);\r\n                        return [4 /*yield*/, PluginCommands.State.Snapshots.Fetch(this.plugin, { url: entry.url })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        if (this._mounted)\r\n                            this.setState({ isBusy: false });\r\n                        return [7 /*endfinally*/];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        _this.remove = function (e) { return __awaiter(_this, void 0, void 0, function () {\r\n            var id, entry, _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        id = e.currentTarget.getAttribute('data-id');\r\n                        if (!id)\r\n                            return [2 /*return*/];\r\n                        entry = this.state.entries.get(id);\r\n                        if (!entry)\r\n                            return [2 /*return*/];\r\n                        this.setState({ entries: this.state.entries.remove(id) });\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, fetch(entry.removeUrl)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        return _this;\r\n    }\r\n    RemoteStateSnapshots.prototype.componentDidMount = function () {\r\n        this.refresh();\r\n        // TODO: solve this by using \"PluginComponent\" with behaviors intead\r\n        this._mounted = true;\r\n        // this.subscribe(UploadedEvent, this.refresh);\r\n    };\r\n    RemoteStateSnapshots.prototype.componentWillUnmount = function () {\r\n        this._mounted = false;\r\n    };\r\n    RemoteStateSnapshots.prototype.serverUrl = function (q) {\r\n        if (!q)\r\n            return this.state.params.options.serverUrl;\r\n        return urlCombine(this.state.params.options.serverUrl, q);\r\n    };\r\n    RemoteStateSnapshots.prototype.render = function () {\r\n        var _this = this;\r\n        return _jsxs(_Fragment, { children: [_jsx(SectionHeader, { title: 'Remote States', accent: 'blue' }, void 0), !this.props.listOnly && _jsxs(_Fragment, { children: [_jsx(ParameterControls, { params: this.Params, values: this.state.params, onEnter: this.upload, onChange: function (p) {\r\n                                var _a;\r\n                                _this.setState({ params: __assign(__assign({}, _this.state.params), (_a = {}, _a[p.name] = p.value, _a)) });\r\n                            }, isDisabled: this.state.isBusy }, void 0), _jsxs(\"div\", __assign({ className: 'msp-flex-row' }, { children: [_jsx(IconButton, { onClick: this.refresh, disabled: this.state.isBusy, svg: RefreshSvg }, void 0), _jsx(Button, __assign({ icon: CloudUploadSvg, onClick: this.upload, disabled: this.state.isBusy, commit: true }, { children: \"Upload\" }), void 0)] }), void 0)] }, void 0), _jsx(RemoteStateSnapshotList, { entries: this.state.entries, isBusy: this.state.isBusy, serverUrl: this.state.params.options.serverUrl, fetch: this.fetch, remove: this.props.listOnly ? void 0 : this.remove }, void 0), this.props.listOnly && _jsxs(\"div\", __assign({ style: { marginTop: '10px' } }, { children: [_jsx(ParameterControls, { params: this.ListOnlyParams, values: this.state.params, onEnter: this.upload, onChange: function (p) {\r\n                                var _a;\r\n                                _this.setState({ params: __assign(__assign({}, _this.state.params), (_a = {}, _a[p.name] = p.value, _a)) });\r\n                            }, isDisabled: this.state.isBusy }, void 0), _jsx(\"div\", __assign({ className: 'msp-flex-row' }, { children: _jsx(Button, __assign({ onClick: this.refresh, disabled: this.state.isBusy, icon: RefreshSvg }, { children: \"Refresh\" }), void 0) }), void 0)] }), void 0)] }, void 0);\r\n    };\r\n    return RemoteStateSnapshots;\r\n}(PluginUIComponent));\r\nexport { RemoteStateSnapshots };\r\nvar RemoteStateSnapshotList = /** @class */ (function (_super) {\r\n    __extends(RemoteStateSnapshotList, _super);\r\n    function RemoteStateSnapshotList() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.open = function (e) { return __awaiter(_this, void 0, void 0, function () {\r\n            var id, entry, url, qi;\r\n            return __generator(this, function (_a) {\r\n                id = e.currentTarget.getAttribute('data-id');\r\n                if (!id)\r\n                    return [2 /*return*/];\r\n                entry = this.props.entries.get(id);\r\n                if (!entry)\r\n                    return [2 /*return*/];\r\n                e.preventDefault();\r\n                url = \"\" + window.location;\r\n                qi = url.indexOf('?');\r\n                if (qi > 0)\r\n                    url = url.substr(0, qi);\r\n                window.open(url + \"?snapshot-url=\" + encodeURIComponent(entry.url), '_blank');\r\n                return [2 /*return*/];\r\n            });\r\n        }); };\r\n        return _this;\r\n    }\r\n    RemoteStateSnapshotList.prototype.render = function () {\r\n        var _this = this;\r\n        return _jsx(\"ul\", __assign({ style: { listStyle: 'none', marginTop: '10px' }, className: 'msp-state-list' }, { children: this.props.entries.valueSeq().map(function (e) { return _jsxs(\"li\", __assign({ className: 'msp-flex-row' }, { children: [_jsxs(Button, __assign({ \"data-id\": e.id, onClick: _this.props.fetch, disabled: _this.props.isBusy, onContextMenu: _this.open, title: 'Click to download, right-click to open in a new tab.' }, { children: [e.name || new Date(e.timestamp).toLocaleString(), \" \", _jsx(\"small\", { children: e.description }, void 0)] }), void 0), !e.isSticky && _this.props.remove && _jsx(IconButton, { svg: DeleteOutlinedSvg, \"data-id\": e.id, title: 'Remove', onClick: _this.props.remove, disabled: _this.props.isBusy, small: true }, void 0)] }), e.id); }) }), void 0);\r\n    };\r\n    return RemoteStateSnapshotList;\r\n}(PurePluginUIComponent));\r\n//# sourceMappingURL=snapshots.js.map"]},"metadata":{},"sourceType":"module"}