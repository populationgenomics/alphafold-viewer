{"ast":null,"code":"/**\r\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { idFactory } from '../../mol-util/id-factory';\nimport { isWebGL2 } from './compat';\nimport { checkFramebufferStatus } from './framebuffer';\nimport { isDebugMode } from '../../mol-util/debug';\nvar getNextRenderbufferId = idFactory();\nexport function getFormat(gl, format) {\n  switch (format) {\n    case 'depth16':\n      return gl.DEPTH_COMPONENT16;\n\n    case 'stencil8':\n      return gl.STENCIL_INDEX8;\n\n    case 'rgba4':\n      return gl.RGBA4;\n\n    case 'depth-stencil':\n      return gl.DEPTH_STENCIL;\n\n    case 'depth32f':\n      if (isWebGL2(gl)) return gl.DEPTH_COMPONENT32F;else throw new Error('WebGL2 needed for `depth32f` renderbuffer format');\n  }\n}\nexport function getAttachment(gl, attachment) {\n  switch (attachment) {\n    case 'depth':\n      return gl.DEPTH_ATTACHMENT;\n\n    case 'stencil':\n      return gl.STENCIL_ATTACHMENT;\n\n    case 'depth-stencil':\n      return gl.DEPTH_STENCIL_ATTACHMENT;\n\n    case 'color0':\n      return gl.COLOR_ATTACHMENT0;\n  }\n}\n\nfunction getRenderbuffer(gl) {\n  var renderbuffer = gl.createRenderbuffer();\n\n  if (renderbuffer === null) {\n    throw new Error('Could not create WebGL renderbuffer');\n  }\n\n  return renderbuffer;\n}\n\nexport function createRenderbuffer(gl, format, attachment, _width, _height) {\n  var _renderbuffer = getRenderbuffer(gl);\n\n  var bind = function () {\n    return gl.bindRenderbuffer(gl.RENDERBUFFER, _renderbuffer);\n  };\n\n  var _format = getFormat(gl, format);\n\n  var _attachment = getAttachment(gl, attachment);\n\n  function init() {\n    bind();\n    gl.renderbufferStorage(gl.RENDERBUFFER, _format, _width, _height);\n  }\n\n  init();\n  var destroyed = false;\n  return {\n    id: getNextRenderbufferId(),\n    bind: bind,\n    attachFramebuffer: function (framebuffer) {\n      framebuffer.bind();\n      bind();\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, _attachment, gl.RENDERBUFFER, _renderbuffer);\n      if (isDebugMode) checkFramebufferStatus(gl);\n    },\n    setSize: function (width, height) {\n      _width = width;\n      _height = height;\n      init();\n    },\n    reset: function () {\n      _renderbuffer = getRenderbuffer(gl);\n      init();\n    },\n    destroy: function () {\n      if (destroyed) return;\n      gl.deleteRenderbuffer(_renderbuffer);\n      destroyed = true;\n    }\n  };\n}","map":{"version":3,"sources":["../../../src/mol-gl/webgl/renderbuffer.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { idFactory } from '../../mol-util/id-factory';\r\nimport { isWebGL2 } from './compat';\r\nimport { checkFramebufferStatus } from './framebuffer';\r\nimport { isDebugMode } from '../../mol-util/debug';\r\nvar getNextRenderbufferId = idFactory();\r\nexport function getFormat(gl, format) {\r\n    switch (format) {\r\n        case 'depth16': return gl.DEPTH_COMPONENT16;\r\n        case 'stencil8': return gl.STENCIL_INDEX8;\r\n        case 'rgba4': return gl.RGBA4;\r\n        case 'depth-stencil': return gl.DEPTH_STENCIL;\r\n        case 'depth32f':\r\n            if (isWebGL2(gl))\r\n                return gl.DEPTH_COMPONENT32F;\r\n            else\r\n                throw new Error('WebGL2 needed for `depth32f` renderbuffer format');\r\n    }\r\n}\r\nexport function getAttachment(gl, attachment) {\r\n    switch (attachment) {\r\n        case 'depth': return gl.DEPTH_ATTACHMENT;\r\n        case 'stencil': return gl.STENCIL_ATTACHMENT;\r\n        case 'depth-stencil': return gl.DEPTH_STENCIL_ATTACHMENT;\r\n        case 'color0': return gl.COLOR_ATTACHMENT0;\r\n    }\r\n}\r\nfunction getRenderbuffer(gl) {\r\n    var renderbuffer = gl.createRenderbuffer();\r\n    if (renderbuffer === null) {\r\n        throw new Error('Could not create WebGL renderbuffer');\r\n    }\r\n    return renderbuffer;\r\n}\r\nexport function createRenderbuffer(gl, format, attachment, _width, _height) {\r\n    var _renderbuffer = getRenderbuffer(gl);\r\n    var bind = function () { return gl.bindRenderbuffer(gl.RENDERBUFFER, _renderbuffer); };\r\n    var _format = getFormat(gl, format);\r\n    var _attachment = getAttachment(gl, attachment);\r\n    function init() {\r\n        bind();\r\n        gl.renderbufferStorage(gl.RENDERBUFFER, _format, _width, _height);\r\n    }\r\n    init();\r\n    var destroyed = false;\r\n    return {\r\n        id: getNextRenderbufferId(),\r\n        bind: bind,\r\n        attachFramebuffer: function (framebuffer) {\r\n            framebuffer.bind();\r\n            bind();\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, _attachment, gl.RENDERBUFFER, _renderbuffer);\r\n            if (isDebugMode)\r\n                checkFramebufferStatus(gl);\r\n        },\r\n        setSize: function (width, height) {\r\n            _width = width;\r\n            _height = height;\r\n            init();\r\n        },\r\n        reset: function () {\r\n            _renderbuffer = getRenderbuffer(gl);\r\n            init();\r\n        },\r\n        destroy: function () {\r\n            if (destroyed)\r\n                return;\r\n            gl.deleteRenderbuffer(_renderbuffer);\r\n            destroyed = true;\r\n        }\r\n    };\r\n}\r\n//# sourceMappingURL=renderbuffer.js.map"]},"metadata":{},"sourceType":"module"}