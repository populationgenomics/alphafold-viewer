{"ast":null,"code":"/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\nimport { __awaiter, __generator } from \"tslib\";\nimport { now } from '../mol-util/now';\n\nvar PluginAnimationLoop =\n/** @class */\nfunction () {\n  function PluginAnimationLoop(plugin) {\n    var _this = this;\n\n    this.plugin = plugin;\n    this.currentFrame = void 0;\n    this._isAnimating = false;\n\n    this.frame = function () {\n      _this.tick(now());\n\n      if (_this._isAnimating) {\n        _this.currentFrame = requestAnimationFrame(_this.frame);\n      }\n    };\n  }\n\n  Object.defineProperty(PluginAnimationLoop.prototype, \"isAnimating\", {\n    get: function () {\n      return this._isAnimating;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  PluginAnimationLoop.prototype.tick = function (t, options) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.plugin.managers.animation.tick(t, options === null || options === void 0 ? void 0 : options.isSynchronous)];\n\n          case 1:\n            _b.sent();\n\n            (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.tick(t, options);\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  PluginAnimationLoop.prototype.resetTime = function (t) {\n    var _a;\n\n    if (t === void 0) {\n      t = now();\n    }\n\n    (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.resetTime(t);\n  };\n\n  PluginAnimationLoop.prototype.start = function (options) {\n    var _a;\n\n    (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.resume();\n    this._isAnimating = true;\n    this.resetTime(); // TODO: should immediate be the default mode?\n\n    if (options === null || options === void 0 ? void 0 : options.immediate) this.frame();else this.currentFrame = requestAnimationFrame(this.frame);\n  };\n\n  PluginAnimationLoop.prototype.stop = function (options) {\n    var _a;\n\n    this._isAnimating = false;\n\n    if (this.currentFrame !== void 0) {\n      cancelAnimationFrame(this.currentFrame);\n      this.currentFrame = void 0;\n    }\n\n    if (options === null || options === void 0 ? void 0 : options.noDraw) {\n      (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.pause(options === null || options === void 0 ? void 0 : options.noDraw);\n    }\n  };\n\n  return PluginAnimationLoop;\n}();\n\nexport { PluginAnimationLoop };","map":{"version":3,"sources":["../../src/mol-plugin/animation-loop.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author David Sehnal <david.sehnal@gmail.com>\r\n */\r\nimport { __awaiter, __generator } from \"tslib\";\r\nimport { now } from '../mol-util/now';\r\nvar PluginAnimationLoop = /** @class */ (function () {\r\n    function PluginAnimationLoop(plugin) {\r\n        var _this = this;\r\n        this.plugin = plugin;\r\n        this.currentFrame = void 0;\r\n        this._isAnimating = false;\r\n        this.frame = function () {\r\n            _this.tick(now());\r\n            if (_this._isAnimating) {\r\n                _this.currentFrame = requestAnimationFrame(_this.frame);\r\n            }\r\n        };\r\n    }\r\n    Object.defineProperty(PluginAnimationLoop.prototype, \"isAnimating\", {\r\n        get: function () {\r\n            return this._isAnimating;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    PluginAnimationLoop.prototype.tick = function (t, options) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4 /*yield*/, this.plugin.managers.animation.tick(t, options === null || options === void 0 ? void 0 : options.isSynchronous)];\r\n                    case 1:\r\n                        _b.sent();\r\n                        (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.tick(t, options);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    PluginAnimationLoop.prototype.resetTime = function (t) {\r\n        var _a;\r\n        if (t === void 0) { t = now(); }\r\n        (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.resetTime(t);\r\n    };\r\n    PluginAnimationLoop.prototype.start = function (options) {\r\n        var _a;\r\n        (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.resume();\r\n        this._isAnimating = true;\r\n        this.resetTime();\r\n        // TODO: should immediate be the default mode?\r\n        if (options === null || options === void 0 ? void 0 : options.immediate)\r\n            this.frame();\r\n        else\r\n            this.currentFrame = requestAnimationFrame(this.frame);\r\n    };\r\n    PluginAnimationLoop.prototype.stop = function (options) {\r\n        var _a;\r\n        this._isAnimating = false;\r\n        if (this.currentFrame !== void 0) {\r\n            cancelAnimationFrame(this.currentFrame);\r\n            this.currentFrame = void 0;\r\n        }\r\n        if (options === null || options === void 0 ? void 0 : options.noDraw) {\r\n            (_a = this.plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.pause(options === null || options === void 0 ? void 0 : options.noDraw);\r\n        }\r\n    };\r\n    return PluginAnimationLoop;\r\n}());\r\nexport { PluginAnimationLoop };\r\n//# sourceMappingURL=animation-loop.js.map"]},"metadata":{},"sourceType":"module"}