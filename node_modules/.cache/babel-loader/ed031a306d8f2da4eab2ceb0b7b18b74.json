{"ast":null,"code":"/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __extends } from \"tslib\";\nimport { Structure, StructureElement, StructureProperties } from '../../mol-model/structure';\nimport { SequenceWrapper } from './wrapper';\nimport { OrderedSet, Interval } from '../../mol-data/int';\nimport { ColorNames } from '../../mol-util/color/names';\nimport { applyMarkerAction } from '../../mol-util/marker-action';\n\nvar ChainSequenceWrapper =\n/** @class */\nfunction (_super) {\n  __extends(ChainSequenceWrapper, _super);\n\n  function ChainSequenceWrapper(data) {\n    var _this = this;\n\n    var residueCount = 0;\n    var elementCount = 0;\n    var counts = [];\n    var l = StructureElement.Location.create(data.structure);\n    var unitIndices = new Map();\n    var lociElements = [];\n\n    for (var i = 0, il = data.units.length; i < il; ++i) {\n      var unit = data.units[i];\n      StructureElement.Location.set(l, data.structure, unit, unit.elements[0]);\n      var entitySeq = unit.model.sequence.byEntityKey[StructureProperties.entity.key(l)];\n      if (entitySeq) residueCount += entitySeq.sequence.length;\n      elementCount += unit.elements.length;\n      var indices = Interval.ofBounds(0, unit.elements.length);\n      unitIndices.set(unit.id, indices);\n      lociElements.push({\n        unit: unit,\n        indices: indices\n      });\n    }\n\n    if (residueCount > 0) counts.push(residueCount + \" residues\");\n    counts.push(elementCount + \" elements\");\n    var length = 1;\n    var markerArray = new Uint8Array(length);\n    _this = _super.call(this, data, markerArray, length) || this;\n    _this.label = \"Whole Chain (\" + counts.join(', ') + \")\";\n    _this.unitIndices = unitIndices;\n    _this.loci = StructureElement.Loci(_this.data.structure, lociElements);\n    return _this;\n  }\n\n  ChainSequenceWrapper.prototype.residueLabel = function (seqIdx) {\n    return this.label;\n  };\n\n  ChainSequenceWrapper.prototype.residueColor = function (seqIdx) {\n    return ColorNames.black;\n  };\n\n  ChainSequenceWrapper.prototype.residueClass = function (seqIdx) {\n    return 'msp-sequence-present';\n  };\n\n  ChainSequenceWrapper.prototype.mark = function (loci, action) {\n    var changed = false;\n    var structure = this.data.structure;\n\n    if (StructureElement.Loci.is(loci)) {\n      if (!Structure.areRootsEquivalent(loci.structure, structure)) return false;\n      loci = StructureElement.Loci.remap(loci, structure);\n\n      for (var _i = 0, _a = loci.elements; _i < _a.length; _i++) {\n        var e = _a[_i];\n        var indices = this.unitIndices.get(e.unit.id);\n\n        if (indices) {\n          if (OrderedSet.isSubset(indices, e.indices)) {\n            if (applyMarkerAction(this.markerArray, Interval.ofSingleton(0), action)) changed = true;\n          }\n        }\n      }\n    } else if (Structure.isLoci(loci)) {\n      if (!Structure.areRootsEquivalent(loci.structure, structure)) return false;\n      if (applyMarkerAction(this.markerArray, Interval.ofSingleton(0), action)) changed = true;\n    }\n\n    return changed;\n  };\n\n  ChainSequenceWrapper.prototype.getLoci = function (seqIdx) {\n    return this.loci;\n  };\n\n  return ChainSequenceWrapper;\n}(SequenceWrapper);\n\nexport { ChainSequenceWrapper };","map":{"version":3,"sources":["../../../src/mol-plugin-ui/sequence/chain.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __extends } from \"tslib\";\r\nimport { Structure, StructureElement, StructureProperties } from '../../mol-model/structure';\r\nimport { SequenceWrapper } from './wrapper';\r\nimport { OrderedSet, Interval } from '../../mol-data/int';\r\nimport { ColorNames } from '../../mol-util/color/names';\r\nimport { applyMarkerAction } from '../../mol-util/marker-action';\r\nvar ChainSequenceWrapper = /** @class */ (function (_super) {\r\n    __extends(ChainSequenceWrapper, _super);\r\n    function ChainSequenceWrapper(data) {\r\n        var _this = this;\r\n        var residueCount = 0;\r\n        var elementCount = 0;\r\n        var counts = [];\r\n        var l = StructureElement.Location.create(data.structure);\r\n        var unitIndices = new Map();\r\n        var lociElements = [];\r\n        for (var i = 0, il = data.units.length; i < il; ++i) {\r\n            var unit = data.units[i];\r\n            StructureElement.Location.set(l, data.structure, unit, unit.elements[0]);\r\n            var entitySeq = unit.model.sequence.byEntityKey[StructureProperties.entity.key(l)];\r\n            if (entitySeq)\r\n                residueCount += entitySeq.sequence.length;\r\n            elementCount += unit.elements.length;\r\n            var indices = Interval.ofBounds(0, unit.elements.length);\r\n            unitIndices.set(unit.id, indices);\r\n            lociElements.push({ unit: unit, indices: indices });\r\n        }\r\n        if (residueCount > 0)\r\n            counts.push(residueCount + \" residues\");\r\n        counts.push(elementCount + \" elements\");\r\n        var length = 1;\r\n        var markerArray = new Uint8Array(length);\r\n        _this = _super.call(this, data, markerArray, length) || this;\r\n        _this.label = \"Whole Chain (\" + counts.join(', ') + \")\";\r\n        _this.unitIndices = unitIndices;\r\n        _this.loci = StructureElement.Loci(_this.data.structure, lociElements);\r\n        return _this;\r\n    }\r\n    ChainSequenceWrapper.prototype.residueLabel = function (seqIdx) {\r\n        return this.label;\r\n    };\r\n    ChainSequenceWrapper.prototype.residueColor = function (seqIdx) {\r\n        return ColorNames.black;\r\n    };\r\n    ChainSequenceWrapper.prototype.residueClass = function (seqIdx) {\r\n        return 'msp-sequence-present';\r\n    };\r\n    ChainSequenceWrapper.prototype.mark = function (loci, action) {\r\n        var changed = false;\r\n        var structure = this.data.structure;\r\n        if (StructureElement.Loci.is(loci)) {\r\n            if (!Structure.areRootsEquivalent(loci.structure, structure))\r\n                return false;\r\n            loci = StructureElement.Loci.remap(loci, structure);\r\n            for (var _i = 0, _a = loci.elements; _i < _a.length; _i++) {\r\n                var e = _a[_i];\r\n                var indices = this.unitIndices.get(e.unit.id);\r\n                if (indices) {\r\n                    if (OrderedSet.isSubset(indices, e.indices)) {\r\n                        if (applyMarkerAction(this.markerArray, Interval.ofSingleton(0), action))\r\n                            changed = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (Structure.isLoci(loci)) {\r\n            if (!Structure.areRootsEquivalent(loci.structure, structure))\r\n                return false;\r\n            if (applyMarkerAction(this.markerArray, Interval.ofSingleton(0), action))\r\n                changed = true;\r\n        }\r\n        return changed;\r\n    };\r\n    ChainSequenceWrapper.prototype.getLoci = function (seqIdx) {\r\n        return this.loci;\r\n    };\r\n    return ChainSequenceWrapper;\r\n}(SequenceWrapper));\r\nexport { ChainSequenceWrapper };\r\n//# sourceMappingURL=chain.js.map"]},"metadata":{},"sourceType":"module"}