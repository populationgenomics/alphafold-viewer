{"ast":null,"code":"/**\r\n * Copyright (c) 2019-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\nimport { __assign, __awaiter, __generator } from \"tslib\";\nimport { ParamDefinition as PD } from '../../mol-util/param-definition';\nimport { ValueBox } from '../../mol-util';\nimport { CustomPropertyDescriptor } from '../../mol-model/custom-property';\nimport { stringToWords } from '../../mol-util/string';\nexport { CustomModelProperty };\nvar CustomModelProperty;\n\n(function (CustomModelProperty) {\n  function createProvider(builder) {\n    var _this = this;\n\n    var descriptorName = builder.descriptor.name;\n    var propertyDataName = builder.type === 'static' ? '_staticPropertyData' : '_dynamicPropertyData';\n\n    var get = function (data) {\n      if (!(descriptorName in data[propertyDataName])) {\n        data[propertyDataName][descriptorName] = {\n          props: __assign({}, PD.getDefaultValues(builder.getParams(data))),\n          data: ValueBox.create(undefined)\n        };\n      }\n\n      return data[propertyDataName][descriptorName];\n    };\n\n    var set = function (data, props, value) {\n      var property = get(data);\n      data[propertyDataName][descriptorName] = {\n        props: props,\n        data: ValueBox.withValue(property.data, value)\n      };\n    };\n\n    return {\n      label: builder.label,\n      descriptor: builder.descriptor,\n      isHidden: builder.isHidden,\n      getParams: function (data) {\n        var params = PD.clone(builder.getParams(data));\n        PD.setDefaultValues(params, get(data).props);\n        return params;\n      },\n      defaultParams: builder.defaultParams,\n      isApplicable: builder.isApplicable,\n      attach: function (ctx, data, props, addRef) {\n        if (props === void 0) {\n          props = {};\n        }\n\n        return __awaiter(_this, void 0, void 0, function () {\n          var property, p, _a, value, assets;\n\n          return __generator(this, function (_b) {\n            switch (_b.label) {\n              case 0:\n                if (addRef) data.customProperties.reference(builder.descriptor, true);\n                property = get(data);\n                p = PD.merge(builder.defaultParams, property.props, props);\n                if (property.data.value && PD.areEqual(builder.defaultParams, property.props, p)) return [2\n                /*return*/\n                ];\n                return [4\n                /*yield*/\n                , builder.obtain(ctx, data, p)];\n\n              case 1:\n                _a = _b.sent(), value = _a.value, assets = _a.assets;\n                data.customProperties.add(builder.descriptor);\n                data.customProperties.assets(builder.descriptor, assets);\n                set(data, p, value);\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      },\n      ref: function (data, add) {\n        return data.customProperties.reference(builder.descriptor, add);\n      },\n      get: function (data) {\n        var _a;\n\n        return (_a = get(data)) === null || _a === void 0 ? void 0 : _a.data;\n      },\n      set: function (data, props) {\n        if (props === void 0) {\n          props = {};\n        }\n\n        var property = get(data);\n        var p = PD.merge(builder.defaultParams, property.props, props);\n\n        if (!PD.areEqual(builder.defaultParams, property.props, p)) {\n          // this invalidates property.value\n          set(data, p, undefined); // dispose of assets\n\n          data.customProperties.assets(builder.descriptor);\n        }\n      },\n      props: function (data) {\n        return get(data).props;\n      }\n    };\n  }\n\n  CustomModelProperty.createProvider = createProvider;\n\n  function createSimple(name, type, defaultValue) {\n    var _this = this;\n\n    var defaultParams = {\n      value: PD.Value(defaultValue, {\n        isHidden: true\n      })\n    };\n    return createProvider({\n      label: stringToWords(name),\n      descriptor: CustomPropertyDescriptor({\n        name: name\n      }),\n      isHidden: true,\n      type: type,\n      defaultParams: defaultParams,\n      getParams: function () {\n        return {\n          value: PD.Value(defaultValue, {\n            isHidden: true\n          })\n        };\n      },\n      isApplicable: function () {\n        return true;\n      },\n      obtain: function (ctx, data, props) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var _a;\n\n          return __generator(this, function (_b) {\n            return [2\n            /*return*/\n            , {\n              value: (_a = props.value) !== null && _a !== void 0 ? _a : defaultValue\n            }];\n          });\n        });\n      }\n    });\n  }\n\n  CustomModelProperty.createSimple = createSimple;\n})(CustomModelProperty || (CustomModelProperty = {}));","map":{"version":3,"sources":["../../../src/mol-model-props/common/custom-model-property.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\r\n * Copyright (c) 2019-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\r\n *\r\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\r\n */\r\nimport { __assign, __awaiter, __generator } from \"tslib\";\r\nimport { ParamDefinition as PD } from '../../mol-util/param-definition';\r\nimport { ValueBox } from '../../mol-util';\r\nimport { CustomPropertyDescriptor } from '../../mol-model/custom-property';\r\nimport { stringToWords } from '../../mol-util/string';\r\nexport { CustomModelProperty };\r\nvar CustomModelProperty;\r\n(function (CustomModelProperty) {\r\n    function createProvider(builder) {\r\n        var _this = this;\r\n        var descriptorName = builder.descriptor.name;\r\n        var propertyDataName = builder.type === 'static' ? '_staticPropertyData' : '_dynamicPropertyData';\r\n        var get = function (data) {\r\n            if (!(descriptorName in data[propertyDataName])) {\r\n                data[propertyDataName][descriptorName] = {\r\n                    props: __assign({}, PD.getDefaultValues(builder.getParams(data))),\r\n                    data: ValueBox.create(undefined)\r\n                };\r\n            }\r\n            return data[propertyDataName][descriptorName];\r\n        };\r\n        var set = function (data, props, value) {\r\n            var property = get(data);\r\n            data[propertyDataName][descriptorName] = {\r\n                props: props,\r\n                data: ValueBox.withValue(property.data, value)\r\n            };\r\n        };\r\n        return {\r\n            label: builder.label,\r\n            descriptor: builder.descriptor,\r\n            isHidden: builder.isHidden,\r\n            getParams: function (data) {\r\n                var params = PD.clone(builder.getParams(data));\r\n                PD.setDefaultValues(params, get(data).props);\r\n                return params;\r\n            },\r\n            defaultParams: builder.defaultParams,\r\n            isApplicable: builder.isApplicable,\r\n            attach: function (ctx, data, props, addRef) {\r\n                if (props === void 0) { props = {}; }\r\n                return __awaiter(_this, void 0, void 0, function () {\r\n                    var property, p, _a, value, assets;\r\n                    return __generator(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (addRef)\r\n                                    data.customProperties.reference(builder.descriptor, true);\r\n                                property = get(data);\r\n                                p = PD.merge(builder.defaultParams, property.props, props);\r\n                                if (property.data.value && PD.areEqual(builder.defaultParams, property.props, p))\r\n                                    return [2 /*return*/];\r\n                                return [4 /*yield*/, builder.obtain(ctx, data, p)];\r\n                            case 1:\r\n                                _a = _b.sent(), value = _a.value, assets = _a.assets;\r\n                                data.customProperties.add(builder.descriptor);\r\n                                data.customProperties.assets(builder.descriptor, assets);\r\n                                set(data, p, value);\r\n                                return [2 /*return*/];\r\n                        }\r\n                    });\r\n                });\r\n            },\r\n            ref: function (data, add) { return data.customProperties.reference(builder.descriptor, add); },\r\n            get: function (data) { var _a; return (_a = get(data)) === null || _a === void 0 ? void 0 : _a.data; },\r\n            set: function (data, props) {\r\n                if (props === void 0) { props = {}; }\r\n                var property = get(data);\r\n                var p = PD.merge(builder.defaultParams, property.props, props);\r\n                if (!PD.areEqual(builder.defaultParams, property.props, p)) {\r\n                    // this invalidates property.value\r\n                    set(data, p, undefined);\r\n                    // dispose of assets\r\n                    data.customProperties.assets(builder.descriptor);\r\n                }\r\n            },\r\n            props: function (data) { return get(data).props; },\r\n        };\r\n    }\r\n    CustomModelProperty.createProvider = createProvider;\r\n    function createSimple(name, type, defaultValue) {\r\n        var _this = this;\r\n        var defaultParams = { value: PD.Value(defaultValue, { isHidden: true }) };\r\n        return createProvider({\r\n            label: stringToWords(name),\r\n            descriptor: CustomPropertyDescriptor({ name: name }),\r\n            isHidden: true,\r\n            type: type,\r\n            defaultParams: defaultParams,\r\n            getParams: function () { return ({ value: PD.Value(defaultValue, { isHidden: true }) }); },\r\n            isApplicable: function () { return true; },\r\n            obtain: function (ctx, data, props) { return __awaiter(_this, void 0, void 0, function () {\r\n                var _a;\r\n                return __generator(this, function (_b) {\r\n                    return [2 /*return*/, { value: (_a = props.value) !== null && _a !== void 0 ? _a : defaultValue }];\r\n                });\r\n            }); }\r\n        });\r\n    }\r\n    CustomModelProperty.createSimple = createSimple;\r\n})(CustomModelProperty || (CustomModelProperty = {}));\r\n//# sourceMappingURL=custom-model-property.js.map"]},"metadata":{},"sourceType":"module"}